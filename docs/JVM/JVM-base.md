# JVM åŸºç¡€

## ä»€ä¹ˆæ˜¯JVM

JVM å…¨ç§°æ˜¯ Java Virtual Machineï¼Œä¸­æ–‡è¯‘å Javaè™šæ‹Ÿæœºã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„ç¨‹åºï¼Œä»–çš„èŒè´£æ˜¯è¿è¡ŒJavaå­—èŠ‚ç æ–‡ä»¶ã€‚

![6d498c75-f60a-4bd8-b5e4-c6ccdc55ccd0](./images/6d498c75-f60a-4bd8-b5e4-c6ccdc55ccd0.png)

---

## JVMçš„åŠŸèƒ½

1. è§£é‡Šå’Œè¿è¡Œ
   
    - å¯¹å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå®æ—¶çš„è§£é‡Šæˆæœºå™¨ç ï¼Œè®©è®¡ç®—æœºæ‰§è¡Œ

2. å†…å­˜ç®¡ç†
   
    - è‡ªåŠ¨ä¸ºå¯¹è±¡ã€æ–¹æ³•ç­‰åˆ†é…å†…å­˜ï¼Œè‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡

3. å³æ—¶ç¼–è¯‘

    - å¯¹çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæå‡æ‰§è¡Œæ•ˆç‡



## å¸¸è§çš„JVM
| åç§° | ä½œè€… | æ”¯æŒç‰ˆæœ¬ | ç¤¾åŒºæ´»è·ƒåº¦ (github star) | ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|-------------------------|------|----------|
| HotSpot (Oracle JDKç‰ˆ) | Oracle | æ‰€æœ‰ç‰ˆæœ¬ | é«˜(é—­æº) | ä½¿ç”¨æœ€å¹¿æ³›ï¼Œç¨³å®šå¯é ï¼Œç¤¾åŒºæ´»è·ƒ<br>JITæ”¯æŒ<br>Oracle JDKé»˜è®¤è™šæ‹Ÿæœº | é»˜è®¤ |
| HotSpot (OpenJDKç‰ˆ) | Oracle | æ‰€æœ‰ç‰ˆæœ¬ | ä¸­(16.1k) | åŒä¸Š<br>å¼€æºï¼ŒOpenJDKé»˜è®¤è™šæ‹Ÿæœº | é»˜è®¤<br>å¯¹JDKæœ‰äºŒæ¬¡å¼€å‘éœ€æ±‚ |
| GraalVM | Oracle | 11, 17, 19<br>ä¼ä¸šç‰ˆæ”¯æŒ8 | é«˜(18.7k) | å¤šè¯­è¨€æ”¯æŒ<br>é«˜æ€§èƒ½ï¼ŒJITï¼ŒAOTæ”¯æŒ | å¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„<br>éœ€è¦å¤šè¯­è¨€æ··åˆç¼–ç¨‹ |
| Dragonwell JDK<br>é¾™äº• | Alibaba | æ ‡å‡†ç‰ˆ 8,11,17<br>æ‰©å±•ç‰ˆ11,17 | ä½(3.9k) | åŸºäºOpenJDKçš„å¢å¼º<br>é«˜æ€§èƒ½ï¼Œbugä¿®å¤ï¼Œå®‰å…¨æ€§æå‡<br>JWarmupï¼ŒElasticHeapï¼ŒWispç‰¹æ€§æ”¯æŒ | ç”µå•†ã€ç‰©æµã€é‡‘èé¢†åŸŸ<br>å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜ |
| Eclipse OpenJ9<br>(åŸ IBM J9) | IBM | 8,11,17,19,20 | ä½(3.1k) | é«˜æ€§èƒ½ï¼Œå¯æ‰©å±•<br>JITï¼ŒAOTç‰¹æ€§æ”¯æŒ | å¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„ |

## å­—èŠ‚ç æ–‡ä»¶
!!!tip
    [ä½¿ç”¨ jclasslibå·¥å…·æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶]( https://github.com/ingokegel/jclasslib)

![å­—èŠ‚ç ç»„æˆ](./images/731c5b64-cca1-4316-b3b8-7ed6740b054e.png)


### Magicé­”æ•°
- æ–‡ä»¶æ˜¯æ— æ³•é€šè¿‡æ–‡ä»¶æ‰©å±•åæ¥ç¡®å®šæ–‡ä»¶ç±»å‹çš„ï¼Œæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„ä¿®æ”¹ï¼Œä¸å½±å“æ–‡ä»¶çš„å†…å®¹ã€‚
- è½¯ä»¶ä½¿ç”¨æ–‡ä»¶çš„å¤´å‡ ä¸ªå­—èŠ‚ï¼ˆæ–‡ä»¶å¤´ï¼‰å»æ ¡éªŒæ–‡ä»¶çš„ç±»å‹ï¼Œå¦‚æœè½¯ä»¶ä¸æ”¯æŒè¯¥ç§ç±»å‹å°±ä¼šå‡ºé”™ã€‚
- Javaå­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå°†æ–‡ä»¶å¤´ç§°ä¸º**magicé­”æ•°**ã€‚

| æ–‡ä»¶ç±»å‹ | å­—èŠ‚æ•° | æ–‡ä»¶å¤´ |
|----------|--------|--------|
| JPEG (jpg) | 3 | FFD8FF |
| PNG (png) | 4 | 89504E47 (æ–‡ä»¶å°¾ä¹Ÿæœ‰è¦æ±‚) |
| bmp | 2 | 424D |
| XML (xml) | 5 | 3C3F786D6C |
| AVI (avi) | 4 | 41564920 |
| **Javaå­—èŠ‚ç æ–‡ä»¶ (class)** | **4** | **CAFEBABE** |

!!! note "é‡ç‚¹æç¤º"
    Javaå­—èŠ‚ç æ–‡ä»¶(.class)çš„Magicé­”æ•°æ˜¯ **CAFEBABE**ï¼Œå ç”¨4ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯æ‰€æœ‰Java classæ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚


### ä¸»å‰¯ç‰ˆæœ¬å·

- ä¸»å‰¯ç‰ˆæœ¬å·æŒ‡çš„æ˜¯ç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶çš„JDKç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å·ç”¨æ¥æ ‡è¯†å¤§ç‰ˆæœ¬å·ï¼ŒJDK1.0-1.1ä½¿ç”¨äº†45.0-45.3ï¼ŒJDK1.2æ˜¯46ä¹‹åæ¯å‡çº§ä¸€ä¸ªå¤§ç‰ˆæœ¬å°±åŠ 1ï¼›å‰¯ç‰ˆæœ¬å·æ˜¯å½“ä¸»ç‰ˆæœ¬å·ç›¸åŒæ—¶ä½œä¸ºåŒºåˆ†ä¸åŒç‰ˆæœ¬çš„æ ‡è¯†ï¼Œä¸€èˆ¬åªéœ€è¦å…³å¿ƒä¸»ç‰ˆæœ¬å·ã€‚

- **ç‰ˆæœ¬å·çš„ä½œç”¨ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰å­—èŠ‚ç çš„ç‰ˆæœ¬å’Œè¿è¡Œæ—¶çš„JDKæ˜¯å¦å…¼å®¹ã€‚**

!!! tip "ç‰ˆæœ¬å·è®¡ç®—æ–¹æ³•"
    1.2ä¹‹åå¤§ç‰ˆæœ¬å·è®¡ç®—æ–¹æ³•æ˜¯ï¼š**ä¸»ç‰ˆæœ¬å· - 44**
    
    æ¯”å¦‚ä¸»ç‰ˆæœ¬å·52å°±æ˜¯JDK8

!!!example "ä½¿ç”¨JDK8ç¼–è¯‘çš„å­—èŠ‚ç æ–‡ä»¶ç¤ºä¾‹"
    ä»jclasslibå·¥å…·ä¸­å¯ä»¥çœ‹åˆ°ï¼š

    - æ¬¡ç‰ˆæœ¬å·ï¼š0

    - **ä¸»ç‰ˆæœ¬å·ï¼š52 [1.8]**

    - è¿™è¡¨ç¤ºè¯¥å­—èŠ‚ç æ–‡ä»¶æ˜¯ä½¿ç”¨JDK8ç¼–è¯‘çš„


| JDKç‰ˆæœ¬ | ä¸»ç‰ˆæœ¬å· | è®¡ç®—æ–¹å¼ |
|---------|----------|----------|
| JDK 1.0-1.1 | 45.0-45.3 | - |
| JDK 1.2 | 46 | 46-44=2 |
| JDK 8 | 52 | 52-44=8 |
| JDK 11 | 55 | 55-44=11 |
| JDK 17 | 61 | 61-44=17 |


### ä¸»ç‰ˆæœ¬å·ä¸å…¼å®¹é—®é¢˜

!!! example "æ¡ˆä¾‹ï¼šä¸»ç‰ˆæœ¬å·ä¸å…¼å®¹å¯¼è‡´çš„é”™è¯¯"
    
    éœ€æ±‚ï¼š
    
    è§£å†³ä»¥ä¸‹ç”±äºä¸»ç‰ˆæœ¬å·ä¸å…¼å®¹å¯¼è‡´çš„é”™è¯¯
    
    ```
    ç±»æ–‡ä»¶å…·æœ‰é”™è¯¯çš„ç‰ˆæœ¬ 52.0ï¼Œåº”ä¸º 50.0
    è¯·åˆ é™¤è¯¥æ–‡ä»¶æˆ–ç¡®ä¿è¯¥æ–‡ä»¶ä½äºæ­£ç¡®çš„ç±»è·¯å¾„å­ç›®å½•ä¸­ã€‚
    ```
    
    é—®é¢˜åˆ†æ
    
    - **ç‰ˆæœ¬ 52.0**ï¼šå¯¹åº” JDK 8 (52-44=8)
    - **ç‰ˆæœ¬ 50.0**ï¼šå¯¹åº” JDK 6 (50-44=6)
    - é”™è¯¯åŸå› ï¼šä½¿ç”¨JDK 8ç¼–è¯‘çš„å­—èŠ‚ç æ–‡ä»¶æ— æ³•åœ¨JDK 6ç¯å¢ƒä¸‹è¿è¡Œ
    

    è§£å†³æ–¹æ¡ˆ
    
    **ä¸¤ç§æ–¹æ¡ˆï¼š**
    
    1. **å‡çº§JDKç‰ˆæœ¬** 
       
        !!! warning "æ³¨æ„äº‹é¡¹"
            å®¹æ˜“å¼•å‘å…¶ä»–çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡çš„æµ‹è¯•
    
    2. **å°†ç¬¬ä¸‰æ–¹ä¾èµ–çš„ç‰ˆæœ¬å·é™ä½æˆ–è€…æ›´æ¢ä¾èµ–ï¼Œä»¥æ»¡è¶³JDKç‰ˆæœ¬çš„è¦æ±‚** âœ… **å»ºè®®é‡‡ç”¨**
       
        !!! tip "æ¨èæ–¹æ¡ˆ"
            é™ä½ä¾èµ–ç‰ˆæœ¬æˆ–æ›´æ¢å…¼å®¹çš„ä¾èµ–åŒ…ï¼Œä¿æŒå½“å‰JDKç¯å¢ƒç¨³å®š


---

## ç±»çš„ç”Ÿå‘½å‘¨æœŸ

### åŠ è½½

1. **ç±»åŠ è½½å™¨**æ ¹æ®ç±»çš„å…¨é™å®šåé€šè¿‡ä¸åŒæ¸ é“ä»¥äºŒè¿›åˆ¶æµçš„æ–¹å¼è·å–å­—èŠ‚ç ä¿¡æ¯
    - æœ¬åœ°æ–‡ä»¶
    - åŠ¨æ€ä»£ç†ç”Ÿæˆ
    - é€šè¿‡ç½‘ç»œä¼ è¾“

2. ç±»åŠ è½½å™¨åŠ è½½å®Œæˆåï¼ŒJavaè™šæ‹Ÿæœºä¼šå°†å­—èŠ‚ç ä¸­çš„ä¿¡æ¯ä¿å­˜åˆ°æ–¹æ³•åŒºä¸­

3. ç”ŸæˆInstanceKlasså¯¹è±¡ï¼ˆC++è¯­è¨€å¯¹è±¡ï¼‰ï¼Œä¿å­˜ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿˜åŒ…å«å®ç°ç‰¹å®šåŠŸèƒ½æ¯”å¦‚å¤šæ€çš„ä¿¡æ¯

4. åœ¨å †åŒºç”Ÿæˆä¸€ä»½ä¸æ–¹æ³•åŒºä¸­æ•°æ®ç±»ä¼¼çš„ java.lang.Class å¯¹è±¡ï¼Œä½œç”¨æ˜¯åœ¨Javaä»£ç ä¸­å»è·å–ç±»çš„ä¿¡æ¯ä»¥åŠå­˜å‚¨é™æ€å­—æ®µæ•°æ®ï¼ˆJDK8ä¹‹åï¼‰
!!!note
    å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåªéœ€è¦è®¿é—®å †åŒºçš„Classå¯¹è±¡è€Œä¸éœ€è¦è®¿é—®æ–¹æ³•åŒºä¸­çš„æ•°æ®ï¼Œè¿™æ ·Javaè™šæ‹Ÿæœºå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å¼€å‘è€…è®¿é—®æ•°æ®çš„èŒƒå›´

![5f9358f0-ee7d-484d-8fa0-43e8334253db](./images/5f9358f0-ee7d-484d-8fa0-43e8334253db.png)

### è¿æ¥

1. éªŒè¯é˜¶æ®µï¼Œæ£€æµ‹Javaå­—èŠ‚ç æ–‡ä»¶æ˜¯å¦éµå®ˆJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆæ–‡ä»¶æ ¼å¼ã€å…ƒä¿¡æ¯ç­‰ï¼‰

2. å‡†å¤‡é˜¶æ®µï¼Œä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®**åˆå§‹å€¼**(æ³¨æ„æ˜¯èµ‹åˆå€¼ä¸æ˜¯èµ‹å€¼)
   
    !!!tip "finalä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹çš„é™æ€å˜é‡ï¼Œå‡†å¤‡é˜¶æ®µä¼šç›´æ¥èµ‹å€¼"


    å‡†å¤‡é˜¶æ®µåªä¼šç»™é™æ€å˜é‡èµ‹åˆå§‹å€¼ï¼Œè€Œæ¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹éƒ½æœ‰å…¶åˆå§‹å€¼ã€‚
    
    | æ•°æ®ç±»å‹ | åˆå§‹å€¼ | æ•°æ®ç±»å‹ | åˆå§‹å€¼ |
    |----------|--------|----------|--------|
    | int | 0 | byte | 0 |
    | long | 0L | boolean | false |
    | short | 0 | double | 0.0 |
    | char | '\u0000' | å¼•ç”¨æ•°æ®ç±»å‹ | null |
    
    !!! note "é‡è¦è¯´æ˜"
        - å‡†å¤‡é˜¶æ®µåªå¤„ç†**é™æ€å˜é‡**çš„åˆå§‹åŒ–
        - æ¯ç§åŸºæœ¬æ•°æ®ç±»å‹éƒ½æœ‰å¯¹åº”çš„é»˜è®¤åˆå§‹å€¼
        - æ‰€æœ‰å¼•ç”¨æ•°æ®ç±»å‹çš„åˆå§‹å€¼éƒ½æ˜¯ `null`
        - char ç±»å‹çš„åˆå§‹å€¼æ˜¯ `'\u0000'`ï¼ˆç©ºå­—ç¬¦ï¼‰
        - long ç±»å‹çš„åˆå§‹å€¼æ˜¯ `0L`

3. è§£æé˜¶æ®µï¼Œå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰

### åˆå§‹åŒ–

æ‰§è¡Œé™æ€ä»£ç å—ï¼Œå¹¶ä¸ºé™æ€å˜é‡èµ‹å€¼ï¼Œæ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ä¸­clinitéƒ¨åˆ†çš„å­—èŠ‚ç æŒ‡ä»¤

![36d307ca-cb3b-44cb-8040-929facf67b64](./images/36d307ca-cb3b-44cb-8040-929facf67b64.png)

ç±»çš„åˆå§‹åŒ–æ—¶æœºï¼š

- è®¿é—®ä¸€ä¸ªç±»çš„é™æ€å˜é‡æˆ–è€…é™æ€æ–¹æ³•ï¼Œæ³¨æ„finalä¿®é¥°çš„å˜é‡å¹¶ä¸”ç­‰å·å³è¾¹æ˜¯å¸¸é‡ä¸ä¼šè§¦å‘åˆå§‹åŒ–

- è°ƒç”¨Class.forName(String className)æ–¹æ³•

- newä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡æ—¶

- æ‰§è¡Œmainæ–¹æ³•çš„å½“å‰ç±»
  
  

clinitæŒ‡ä»¤åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¸ä¼šå‡ºç°ï¼š

- æ— é™æ€ä»£ç å—ä¸”æ— é™æ€å˜é‡èµ‹å€¼è¯­å¥

- æœ‰é™æ€å˜é‡çš„å£°æ˜ï¼Œä½†æ˜¯æ²¡æœ‰èµ‹å€¼è¯­å¥

- é™æ€å˜é‡çš„å®šä¹‰ä½¿ç”¨finalå…³é”®å­—å¹¶ä¸”èµ‹å¸¸é‡å€¼ï¼Œå‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼

!!!warning "æ³¨æ„"
    æ•°ç»„çš„åˆ›å»ºä¸ä¼šå¯¼è‡´æ•°ç»„ä¸­å…ƒç´ çš„ç±»è¿›è¡Œåˆå§‹åŒ–
    finalä¿®é¥°çš„å˜é‡å¦‚æœèµ‹å€¼å†…å®¹éœ€è¦æ‰§è¡ŒæŒ‡ä»¤æ‰èƒ½å¾—å‡ºç»“æœï¼Œä¼šæ‰§è¡Œclinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–


!!!tip "å­˜åœ¨ç»§æ‰¿å…³ç³»"

    ç›´æ¥è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–

    å­ç±»çš„åˆå§‹åŒ–clinitè°ƒç”¨ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„clinitåˆå§‹åŒ–æ–¹æ³•

![03ddc93c-7f8c-423c-a430-b0539788ffc4](./images/03ddc93c-7f8c-423c-a430-b0539788ffc4.png)

![727c2ac8-9d08-4628-bb8c-4d8e1b257967](./images/727c2ac8-9d08-4628-bb8c-4d8e1b257967.png)

### ä½¿ç”¨

### å¸è½½

---

## ç±»åŠ è½½å™¨åˆ†ç±»

![29a4a59c-cc42-41bb-a552-f123aa136873](./images/29a4a59c-cc42-41bb-a552-f123aa136873.png)



### å¯åŠ¨ç±»åŠ è½½å™¨

![17478a8d-ac0a-422e-ac4b-8d08788462e9](./images/17478a8d-ac0a-422e-ac4b-8d08788462e9.png)

### æ‰©å±•ç±»åŠ è½½å™¨

![2cc2747d-55d9-482a-98b8-76ee5f584c97](./images/2cc2747d-55d9-482a-98b8-76ee5f584c97.png)

![75db8ab0-72f2-4c09-bda9-766ed6f275e3](./images/75db8ab0-72f2-4c09-bda9-766ed6f275e3.png)

### åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨

- **ç±»å**ï¼š`sun.misc.Launcher$AppClassLoader` (JDK8åŠä¹‹å‰) æˆ– `jdk.internal.loader.ClassLoaders$AppClassLoader` (JDK9+)
- **çˆ¶ç±»åŠ è½½å™¨**ï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰
- **åŠ è½½èŒƒå›´**ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å’Œç¬¬ä¸‰æ–¹jaråŒ…ä¸­çš„ç±»

åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ä¸»è¦ä»ä»¥ä¸‹è·¯å¾„åŠ è½½ç±»ï¼š

1. **-classpath** æˆ– **-cp** å‚æ•°æŒ‡å®šçš„è·¯å¾„
2. **CLASSPATH** ç¯å¢ƒå˜é‡æŒ‡å®šçš„è·¯å¾„  
3. **java.class.path** ç³»ç»Ÿå±æ€§æŒ‡å®šçš„è·¯å¾„
4. å½“å‰å·¥ä½œç›®å½•ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šclasspathï¼‰


!!!tip "è·å–åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨"
    ```java
    // æ–¹æ³•1ï¼šé€šè¿‡ç³»ç»Ÿæ–¹æ³•è·å–
    ClassLoader appClassLoader = ClassLoader.getSystemClassLoader();

    // æ–¹æ³•2ï¼šé€šè¿‡å½“å‰ç±»è·å–
    ClassLoader currentClassLoader = MyClass.class.getClassLoader();

    // æ–¹æ³•3ï¼šé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡è·å–
    ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
    ```

## JDK8ä¹‹åçš„ç±»åŠ è½½å™¨

ç”±äºJDK9å¼•å…¥äº†moduleçš„æ¦‚å¿µï¼Œç±»åŠ è½½å™¨åœ¨è®¾è®¡ä¸Šå‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ã€‚


1. **å¯åŠ¨ç±»åŠ è½½å™¨ä½¿ç”¨Javaç¼–å†™**ï¼Œä½äº`jdk.internal.loader.ClassLoaders`ç±»ä¸­ã€‚

2. **Javaä¸­çš„BootClassLoaderç»§æ‰¿è‡ªBuiltinClassLoader**ï¼Œå®ç°ä»æ¨¡å—ä¸­æ‰¾åˆ°è¦åŠ è½½çš„å­—èŠ‚ç èµ„æºæ–‡ä»¶ã€‚

!!! important "é‡è¦å˜åŒ–"
    **å¯åŠ¨ç±»åŠ è½½å™¨ä¾ç„¶æ— æ³•é€šè¿‡javaä»£ç è·å–åˆ°ï¼Œè¿”å›çš„ä»ç„¶æ˜¯nullï¼Œä¿æŒäº†ç»Ÿä¸€ã€‚**

Bootstrap(C++)  â”€â”€â–º  BootClassLoader(Java)

JDK8åŠä¹‹å‰ ------------ JDK9åŠä¹‹å

---

## åŒäº²å§”æ´¾æœºåˆ¶

![fcb51ebf-f093-4649-aa66-5cb977cbc257](./images/fcb51ebf-f093-4649-aa66-5cb977cbc257.png)


### åŒäº²å§”æ´¾æœºåˆ¶ä½œç”¨

åŒäº²å§”æ´¾æœºåˆ¶ä¸»è¦æœ‰ä¸¤ä¸ªé‡è¦ä½œç”¨ï¼š

1. ä¿è¯ç±»åŠ è½½çš„å®‰å…¨æ€§

    **é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶ï¼Œè®©é¡¶å±‚çš„ç±»åŠ è½½å™¨å»åŠ è½½æ ¸å¿ƒç±»ï¼Œé¿å…æ¶æ„ä»£ç æ›¿æ¢JDKä¸­çš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚java.lang.Stringï¼Œç¡®ä¿æ ¸å¿ƒç±»åº“çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚**

    !!! danger "å®‰å…¨é£é™©ç¤ºä¾‹"
        å¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾æœºåˆ¶ï¼Œæ¶æ„ä»£ç å¯èƒ½ä¼šï¼š
        
        - åˆ›å»ºè‡ªå®šä¹‰çš„`java.lang.String`ç±»æ¥æ›¿æ¢ç³»ç»Ÿç±»
        - ä¿®æ”¹æ ¸å¿ƒAPIçš„è¡Œä¸ºï¼Œå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š
        - ç»•è¿‡Javaçš„å®‰å…¨æ£€æŸ¥æœºåˆ¶

2. é¿å…é‡å¤åŠ è½½

    **åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…åŒä¸€ä¸ªç±»è¢«å¤šæ¬¡åŠ è½½ï¼Œä¸Šå±‚çš„ç±»åŠ è½½å™¨å¦‚æœåŠ è½½è¿‡ç±»ï¼Œå°±ä¼šç›´æ¥è¿”å›è¯¥ç±»ï¼Œé¿å…é‡å¤åŠ è½½ã€‚**

!!! tip "åŠ è½½æœºåˆ¶è¯´æ˜"
    ```
    åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨è¯·æ±‚åŠ è½½ java.lang.String
            â†“ å§”æ´¾ç»™çˆ¶ç±»
    æ‰©å±•ç±»åŠ è½½å™¨æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
            â†“ å§”æ´¾ç»™çˆ¶ç±»  
    å¯åŠ¨ç±»åŠ è½½å™¨æ£€æŸ¥å¹¶åŠ è½½ âœ“
            â†“ è¿”å›å·²åŠ è½½çš„ç±»
    ç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤åŠ è½½
    ```

åŒäº²å§”æ´¾çš„å·¥ä½œæµç¨‹

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| 1 | **æ£€æŸ¥ç¼“å­˜** | æ£€æŸ¥ç±»æ˜¯å¦å·²ç»è¢«å½“å‰ç±»åŠ è½½å™¨åŠ è½½è¿‡ |
| 2 | **å‘ä¸Šå§”æ´¾** | å¦‚æœæœªåŠ è½½ï¼Œå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ |
| 3 | **é€’å½’å§”æ´¾** | çˆ¶ç±»åŠ è½½å™¨é‡å¤æ­¥éª¤1-2ï¼Œç›´åˆ°é¡¶å±‚ |
| 4 | **å°è¯•åŠ è½½** | é¡¶å±‚åŠ è½½å™¨å°è¯•åŠ è½½ç±» |
| 5 | **å‘ä¸‹è¿”å›** | å¦‚æœåŠ è½½å¤±è´¥ï¼Œè¿”å›ç»™å­ç±»åŠ è½½å™¨å°è¯• |
| 6 | **è¿”å›ç»“æœ** | æˆåŠŸåŠ è½½åˆ™è¿”å›Classå¯¹è±¡ï¼Œå¤±è´¥åˆ™æŠ›å¼‚å¸¸ |


!!! success "åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜åŠ¿"
    - **ğŸ”’ å®‰å…¨æ€§**ï¼šé˜²æ­¢æ ¸å¿ƒç±»åº“è¢«ç¯¡æ”¹
    - **â™»ï¸ é¿å…é‡å¤**ï¼šåŒä¸€ä¸ªç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡
    - **ğŸ¯ èŒè´£æ¸…æ™°**ï¼šä¸åŒå±‚çº§åŠ è½½å™¨è´Ÿè´£ä¸åŒèŒƒå›´çš„ç±»
    - **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„ç±»åŠ è½½å¼€é”€
    - **ğŸ›¡ï¸ ç¨³å®šæ€§**ï¼šä¿è¯JVMè¿è¡Œæ—¶ç¯å¢ƒçš„ä¸€è‡´æ€§

---

### æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶

åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œéœ€è¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶æ¥å®ç°ç‰¹å®šçš„ç±»åŠ è½½éœ€æ±‚ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š

1. **è‡ªå®šä¹‰ç±»åŠ è½½å™¨**

    è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¹¶ä¸”é‡å†™loadClassæ–¹æ³•ï¼Œå°±å¯ä»¥å°†åŒäº²å§”æ´¾æœºåˆ¶çš„ä»£ç å»é™¤ã€‚

    !!! example "å®ç°æ–¹å¼"
        - ç»§æ‰¿`ClassLoader`ç±»
        - é‡å†™`loadClass()`æ–¹æ³•
        - ç§»é™¤å‘çˆ¶ç±»å§”æ´¾çš„é€»è¾‘
        - ç›´æ¥åœ¨å½“å‰ç±»åŠ è½½å™¨ä¸­æŸ¥æ‰¾å¹¶åŠ è½½ç±»

    !!! info "åº”ç”¨åœºæ™¯"
        **Tomcaté€šè¿‡è¿™ç§æ–¹å¼å®ç°åº”ç”¨ä¹‹é—´ç±»éš”ç¦»**

2. **çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨**

    åˆ©ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½åŠ è½½ç±»ï¼Œæ¯”å¦‚JDBCå’ŒJNDIç­‰ã€‚

    !!! note "ä½¿ç”¨åŸç†"
        - çˆ¶ç±»åŠ è½½å™¨è¯·æ±‚å­ç±»åŠ è½½å™¨å»å®Œæˆç±»åŠ è½½
        - é€šè¿‡`Thread.currentThread().getContextClassLoader()`è·å–
        - æ‰“ç ´äº†"çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»æ— æ³•è®¿é—®å­åŠ è½½å™¨åŠ è½½çš„ç±»"çš„é™åˆ¶

    !!! example "å…¸å‹åº”ç”¨"
        - **JDBCé©±åŠ¨åŠ è½½**ï¼šDriverManagerç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œä½†æ•°æ®åº“é©±åŠ¨ç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½
        - **JNDIæœåŠ¡**ï¼šç±»ä¼¼çš„åå‘ç±»åŠ è½½éœ€æ±‚
        - **SPIæœºåˆ¶**ï¼šService Provider Interface

3. **OSGiæ¡†æ¶çš„ç±»åŠ è½½å™¨**

    å†å²ä¸ŠOSGiæ¡†æ¶å®ç°äº†ä¸€å¥—æ–°çš„ç±»åŠ è½½å™¨æœºåˆ¶ï¼Œå…è®¸åŒçº§ä¹‹é—´å§”æ‰˜è¿›è¡Œç±»çš„åŠ è½½ã€‚

    !!! tip "OSGiç‰¹æ€§"
        - **æ¨¡å—åŒ–ç³»ç»Ÿ**ï¼šæ¯ä¸ªBundleæœ‰ç‹¬ç«‹çš„ç±»åŠ è½½å™¨
        - **åŠ¨æ€åŠ è½½**ï¼šæ”¯æŒè¿è¡Œæ—¶å®‰è£…ã€å¯åŠ¨ã€åœæ­¢ã€å¸è½½æ¨¡å—
        - **ç‰ˆæœ¬ç®¡ç†**ï¼šåŒä¸€ä¸ªç±»çš„ä¸åŒç‰ˆæœ¬å¯ä»¥å…±å­˜
        - **å¹³çº§å§”æ´¾**ï¼šBundleä¹‹é—´å¯ä»¥ç›¸äº’å§”æ´¾ç±»åŠ è½½


| æ–¹å¼ | å¤æ‚åº¦ | ä½¿ç”¨åœºæ™¯ | å…¸å‹åº”ç”¨ |
|------|--------|----------|----------|
| **è‡ªå®šä¹‰ç±»åŠ è½½å™¨** | ä¸­ç­‰ | åº”ç”¨éš”ç¦»ã€çƒ­éƒ¨ç½² | Tomcatã€Spring Boot DevTools |
| **çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨** | ç®€å• | SPIæœåŠ¡åŠ è½½ | JDBCã€JNDIã€Spring |
| **OSGiæ¡†æ¶** | å¤æ‚ | æ¨¡å—åŒ–ç³»ç»Ÿ | Eclipse IDEã€Apache Felix |

!!! warning "æ³¨æ„äº‹é¡¹"
    - æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶å¯èƒ½ä¼šå¸¦æ¥ç±»åŠ è½½çš„å¤æ‚æ€§
    - éœ€è¦ä»”ç»†è€ƒè™‘ç±»çš„å¯è§æ€§å’Œç‰ˆæœ¬å†²çªé—®é¢˜
    - åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéµå¾ªåŒäº²å§”æ´¾æœºåˆ¶æ˜¯æœ€ä½³å®è·µ

---

## Javaå†…å­˜åŒºåŸŸ
- Javaè™šæ‹Ÿæœºåœ¨è¿è¡ŒJavaç¨‹åºè¿‡ç¨‹ä¸­ç®¡ç†çš„å†…å­˜åŒºåŸŸï¼Œç§°ä¹‹ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºã€‚
- ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­è§„å®šäº†æ¯ä¸€éƒ¨åˆ†çš„ä½œç”¨ã€‚

|çº¿ç¨‹ä¸å…±äº«|çº¿ç¨‹å…±äº«|
|----|---|
|ç¨‹åºè®¡æ•°å™¨|å †|
|Javaè™šæ‹Ÿæœºæ ˆ|æ–¹æ³•åŒº|
|æœ¬åœ°æ–¹æ³•æ ˆ|ç›´æ¥å†…å­˜(å¹¶ä¸å±äºJavaè™šæ‹Ÿæœºè§„èŒƒ)|


!!!tip "å†…å­˜è°ƒä¼˜å­¦ä¹ è·¯çº¿"
    äº†è§£è¿è¡Œæ—¶å†…å­˜ç»“æ„ --> æŒæ¡å†…å­˜é—®é¢˜çš„äº§ç”ŸåŸå›  --> æŒæ¡å†…å­˜è°ƒä¼˜çš„åŸºæœ¬æ–¹æ³•

---

### ç¨‹åºè®¡æ•°å™¨

- ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ä¹Ÿå«PCå¯„å­˜å™¨ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šé€šè¿‡ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰è¦æ‰§è¡Œçš„çš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚

- åœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤è¯»å–åˆ°å†…å­˜ä¹‹åï¼Œä¼šå°†åŸæ–‡ä»¶ä¸­çš„åç§»é‡è½¬æ¢æˆå†…å­˜åœ°å€ã€‚æ¯ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªå†…å­˜åœ°å€ã€‚

- åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ä¼šè®°å½•ä¸‹ä¸€è¡Œå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚æ‰§è¡Œå®Œå½“å‰æŒ‡ä»¤ä¹‹åï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ ¹æ®ç¨‹åºè®¡æ•°å™¨æ‰§è¡Œä¸‹ä¸€è¡ŒæŒ‡ä»¤ã€‚

!!!question "ç¨‹åºè®¡æ•°å™¨ä¼šä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºï¼Ÿ"
    ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ä¸”é•¿åº¦å›ºå®šï¼Œä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚

---

### æ ˆ

#### Javaè™šæ‹Ÿæœºæ ˆ

Javaè™šæ‹Ÿæœºæ ˆç”¨æ¥å­˜æ”¾æ–¹æ³•è°ƒç”¨æ—¶çš„æ ˆå¸§ä¿¡æ¯ã€‚å­˜å‚¨çš„å†…å®¹åŒ…æ‹¬ï¼š

- å±€éƒ¨å˜é‡è¡¨

- æ“ä½œæ•°æ ˆ

- å¸§æ•°æ®

!!!note
    - å±€éƒ¨å˜é‡è¡¨ä¿å­˜çš„å†…å®¹æœ‰ï¼šå®ä¾‹æ–¹æ³•çš„thiså¯¹è±¡ï¼Œæ–¹æ³•çš„å‚æ•°ï¼Œæ–¹æ³•ä½“ä¸­å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚

    - æ“ä½œæ•°æ ˆæ˜¯æ ˆå¸§ä¸­è™šæ‹Ÿæœºåœ¨æ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ç”¨æ¥å­˜æ”¾ä¸­é—´æ•°æ®çš„ä¸€å—åŒºåŸŸ,åœ¨**ç¼–è¯‘æœŸ**å°±å¯ä»¥ç¡®å®šæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ã€‚

    - å¸§æ•°æ®åŒ…å«åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€å¼‚å¸¸è¡¨ç­‰ä¿¡æ¯ã€‚
  

![2020e9a4-89d9-4d47-a95c-b04aebb14dde](./images/2020e9a4-89d9-4d47-a95c-b04aebb14dde.png)
!!!tip
    ä¸Šå›¾ä¸­èµ·å§‹PCå’Œé•¿åº¦å¯ä»¥ç¡®å®šå˜é‡çš„ä½œç”¨åŸŸ


![c0ef3996-eeb8-4b74-9a2f-63b86bb1f900](./images/c0ef3996-eeb8-4b74-9a2f-63b86bb1f900.png)
!!!note
    - å½“å‰ç±»çš„å­—èŠ‚ç æŒ‡ä»¤å¼•ç”¨äº†å…¶ä»–ç±»çš„å±æ€§æˆ–è€…æ–¹æ³•æ—¶ï¼Œéœ€è¦å°†ç¬¦å·å¼•ç”¨ï¼ˆç¼–å·ï¼‰è½¬æ¢æˆå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å†…å­˜åœ°å€ã€‚**åŠ¨æ€é“¾æ¥**å°±ä¿å­˜äº†ç¼–å·åˆ°è¿è¡Œæ—¶å¸¸é‡æ± çš„å†…å­˜åœ°å€çš„æ˜ å°„å…³ç³»ã€‚
  
    - **æ–¹æ³•å‡ºå£**æŒ‡çš„æ˜¯æ–¹æ³•åœ¨æ­£ç¡®æˆ–è€…å¼‚å¸¸ç»“æŸæ—¶ï¼Œå½“å‰æ ˆå¸§ä¼šè¢«å¼¹å‡ºï¼ŒåŒæ—¶ç¨‹åºè®¡æ•°å™¨åº”è¯¥æŒ‡å‘ä¸Šä¸€ä¸ªæ ˆå¸§ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚æ‰€ä»¥åœ¨å½“å‰æ ˆå¸§ä¸­ï¼Œéœ€è¦å­˜å‚¨æ­¤æ–¹æ³•å‡ºå£çš„åœ°å€ã€‚

    - **å¼‚å¸¸è¡¨**å­˜æ”¾çš„æ˜¯ä»£ç ä¸­å¼‚å¸¸çš„å¤„ç†ä¿¡æ¯ï¼ŒåŒ…å«äº†å¼‚å¸¸æ•è·çš„ç”Ÿæ•ˆèŒƒå›´ä»¥åŠå¼‚å¸¸å‘ç”Ÿåè·³è½¬åˆ°çš„å­—èŠ‚ç æŒ‡ä»¤ä½ç½®ã€‚

---
!!!danger "æ ˆå†…å­˜æº¢å‡º"
    - Javaè™šæ‹Ÿæœºæ ˆå†…å­˜æº¢å‡ºä¼šæŠ›å‡º`StackOverflowError`é”™è¯¯
    - ä¸»è¦åŸå› æ˜¯é€’å½’è°ƒç”¨è¿‡æ·±ï¼Œå¯¼è‡´æ ˆå¸§æ•°é‡è¿‡å¤šï¼Œä¹Ÿå¯èƒ½æ˜¯å±€éƒ¨å˜é‡è¡¨è¿‡å¤§ï¼Œå¯¼è‡´å•ä¸ªæ ˆå¸§è¿‡å¤§

---

#### æœ¬åœ°æ–¹æ³•æ ˆ
æœ¬åœ°æ–¹æ³•æ ˆå­˜å‚¨çš„æ˜¯nativeæ–¹æ³•è°ƒç”¨æ—¶çš„æ ˆå¸§ä¿¡æ¯ï¼Œnativeæ–¹æ³•æ˜¯ç”¨C/C++ç­‰è¯­è¨€ç¼–å†™çš„æ–¹æ³•ã€‚

!!!tip
    åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaè™šæ‹Ÿæœºæ ˆæ˜¯åˆäºŒä¸ºä¸€çš„ï¼Œå³Javaè™šæ‹Ÿæœºæ ˆåŒæ—¶å­˜å‚¨Javaæ–¹æ³•å’Œnativeæ–¹æ³•çš„æ ˆå¸§ä¿¡æ¯ã€‚


!!!example "è™šæ‹Ÿæœºè®¾ç½®æ ˆå¤§å°"
    - è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°ï¼š`-Xss`ï¼Œæ¯”å¦‚`-Xss512k`è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°æ˜¯512KB
    - è®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼š`-Xoss`ï¼Œæ¯”å¦‚`-Xoss512k`è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°æ–¹æ³•æ ˆå¤§å°æ˜¯512KB
    - å•ä½ï¼š
        - kï¼šKB
        - mï¼šMB
        - gï¼šGB

---

### å †

ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJavaå †æ˜¯Javaè™šæ‹Ÿæœºä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚å¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ã€‚

å †æœ‰ä¸‰ä¸ªæ³¨æ„çš„æŒ‡æ ‡ï¼šused ã€total ã€ max

- usedï¼šè¡¨ç¤ºå½“å‰å·²ç»ä½¿ç”¨çš„å †å†…å­˜å¤§å°

- totalï¼šè¡¨ç¤ºå½“å‰å·²åˆ†é…å †çš„æ€»å¤§å°

- maxï¼šè¡¨ç¤ºå †å¯åˆ†é…å†…å­˜çš„æœ€å¤§å€¼

!!!example "è®¾ç½®å †å†…å­˜å¤§å°"
    - è®¾ç½®åˆå§‹å †å¤§å°ï¼š`-Xms`ï¼Œæ¯”å¦‚`-Xms512m`è¡¨ç¤ºåˆå§‹å †å¤§å°æ˜¯512MB
    - è®¾ç½®æœ€å¤§å †å¤§å°ï¼š`-Xmx`ï¼Œæ¯”å¦‚`-Xmx1024m`è¡¨ç¤ºæœ€å¤§å †å¤§å°æ˜¯1024MB
    - å•ä½ï¼š
        - kï¼šKB
        - mï¼šMB
        - gï¼šGB
    
    JavaæœåŠ¡ç«¯ç¨‹åºå»ºè®®åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°è®¾ç½®æˆä¸€æ ·ï¼Œé¿å…å †åŠ¨æ€æ‰©å±•å¸¦æ¥çš„æ€§èƒ½æŸè€—

---

### æ–¹æ³•åŒº

æ–¹æ³•åŒºæ˜¯Javaè™šæ‹Ÿæœºä¸­ä¸€å—ç‰¹æ®Šçš„å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜æ”¾

- ç±»çš„å…ƒä¿¡æ¯

- è¿è¡Œæ—¶å¸¸é‡æ± 

- é™æ€å˜é‡

- å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç 

![æ–¹æ³•åŒº-ç±»çš„å…ƒä¿¡æ¯](./images/Snipaste_2025-09-04_14-24-31.png)

!!!tip "é™æ€å¸¸é‡æ± ä¸è¿è¡Œæ—¶å¸¸é‡æ± "
    - é™æ€å¸¸é‡æ± ï¼šå­˜æ”¾åœ¨ç±»çš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œç¼–è¯‘æœŸå°±ç¡®å®šäº†ï¼ˆé€šè¿‡ç¬¦å·å¼•ç”¨ï¼‰
    - è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ï¼Œç±»åŠ è½½åå­˜æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå¯ä»¥åŠ¨æ€ç”Ÿæˆï¼ˆé€šè¿‡å†…å­˜å¼•ç”¨ï¼‰

!!!note "æ–¹æ³•åŒºçš„ä¸åŒå®ç°"
    - JDK8ä¹‹å‰ï¼šæ–¹æ³•åŒºå®ç°æ˜¯æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œå±äºå †çš„ä¸€éƒ¨åˆ†
    - JDK8åŠä¹‹åï¼šæ–¹æ³•åŒºå®ç°æ˜¯å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼Œä¸å†å±äºå †ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜

---
å­—ç¬¦ä¸²å¸¸é‡æ± 

- å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥å­˜æ”¾å­—ç¬¦ä¸²å­—é¢é‡å’Œå­—ç¬¦ä¸²å¯¹è±¡

- å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä¸»è¦ä½œç”¨æ˜¯æé«˜å­—ç¬¦ä¸²çš„é‡ç”¨ç‡ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´

!!!question "å“ªäº›å­—ç¬¦ä¸²ä¼šå­˜æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Ÿ"
    - å­—ç¬¦ä¸²å­—é¢é‡ï¼Œæ¯”å¦‚`String s = "hello";`
    - ä½¿ç”¨`String.intern()`æ–¹æ³•åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡

    newå…³é”®å­—åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ä¸ä¼šå­˜æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ¯”å¦‚`String s = new String("hello");`ï¼Œè¿™ç§æ–¹å¼ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚


!!!question "æ–¹æ³•åŒºå’Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"
    - æ—©æœŸJDKç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å±äºè¿è¡Œæ—¶å¸¸é‡æ± çš„ä¸€éƒ¨åˆ†ï¼Œå­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­
    - JDK7ä¹‹åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«ç§»åˆ°äº†å †ä¸­ï¼Œä¸å†å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­

---

### ç›´æ¥å†…å­˜
!!!warning "æ³¨æ„"
    ç›´æ¥å†…å­˜å¹¶ä¸å±äºJavaè¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸ

ç›´æ¥å†…å­˜åœ¨JDK1.4ä¸­å¼•å…¥ï¼Œä¸»è¦ç”¨äºæé«˜I/Oæ“ä½œçš„æ•ˆç‡ã€‚ç›´æ¥å†…å­˜æ˜¯é€šè¿‡Javaçš„NIOï¼ˆNew Input/Outputï¼‰åº“æ¥åˆ†é…å’Œç®¡ç†çš„ã€‚

ä¼ ç»Ÿçš„Java I/Oæ“ä½œæ˜¯åŸºäºæµçš„ï¼Œæ•°æ®éœ€è¦åœ¨Javaå †å†…å­˜å’Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´è¿›è¡Œå¤šæ¬¡å¤åˆ¶ï¼Œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚ç›´æ¥å†…å­˜å…è®¸Javaç¨‹åºç›´æ¥è®¿é—®æ“ä½œç³»ç»Ÿçš„å†…å­˜ï¼Œä»è€Œå‡å°‘äº†æ•°æ®å¤åˆ¶çš„å¼€é”€ï¼Œæé«˜äº†I/Oæ“ä½œçš„æ•ˆç‡ã€‚

![ç›´æ¥å†…å­˜ä¼˜åŒ–I/O](./images/Snipaste_2025-09-04_17-10-41.png)

!!!example "é…ç½®ç›´æ¥å†…å­˜å¤§å°"
    - è®¾ç½®ç›´æ¥å†…å­˜å¤§å°ï¼š`-XX:MaxDirectMemorySize`ï¼Œæ¯”å¦‚`-XX:MaxDirectMemorySize=512m`è¡¨ç¤ºæœ€å¤§ç›´æ¥å†…å­˜å¤§å°æ˜¯512MB
    - å¦‚æœä¸è®¾ç½®è¯¥å‚æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›´æ¥å†…å­˜çš„å¤§å°ç­‰äºæœ€å¤§å †å†…å­˜å¤§å°ï¼ˆ-Xmxçš„å€¼ï¼‰

---

## åƒåœ¾å›æ”¶
!!! note "æ²¡æœ‰åƒåœ¾å›æ”¶"
    - C/C++ç­‰è¯­è¨€æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œç¨‹åºå‘˜éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜
    - å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼ã€æ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ

Javaè¯­è¨€ç®€åŒ–äº†å†…å­˜ç®¡ç†ï¼Œé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå‡å°‘äº†å†…å­˜æ³„æ¼å’Œæ‚¬æŒ‚æŒ‡é’ˆçš„é£é™©ã€‚


### æ–¹æ³•åŒºå›æ”¶

å¯¹äºçº¿ç¨‹ä¸å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œéƒ½æ˜¯ä¼´éšçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯è€Œåˆ†é…å’Œå›æ”¶çš„ã€‚æ— éœ€åƒåœ¾å›æ”¶å¹²é¢„ã€‚

æ–¹æ³•åŒºä¸­èƒ½å›æ”¶çš„å†…å®¹ä¸»è¦æ˜¯ä¸å†ä½¿ç”¨çš„ç±»ï¼Œè¯¥ç±»éœ€è¦æ»¡è¶³ï¼š

- ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼ˆåŒ…æ‹¬å­ç±»å¯¹è±¡ï¼‰

- åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶

- è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨


!!!tip "æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶"
    - å¯ä»¥é€šè¿‡`System.gc()`æ–¹æ³•å»ºè®®Javaè™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾å›æ”¶
    - è¯¥æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œ**Javaè™šæ‹Ÿæœºå¯ä»¥é€‰æ‹©å¿½ç•¥å®ƒ**
    - ä¸€èˆ¬ä¸å»ºè®®é¢‘ç¹è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½

---

### å †å›æ”¶
!!!question "å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ"
    æ ¹æ®å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨æ¥åˆ¤æ–­ï¼Œæœ‰ä¸€ç§ä¾‹å¤–æ˜¯å¾ªç¯å¼•ç”¨

åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨çš„ä¸¤ç§ä¸»è¦ç®—æ³•ï¼š

- å¼•ç”¨è®¡æ•°æ³•

- å¯è¾¾æ€§åˆ†ææ³•

---

#### å¼•ç”¨è®¡æ•°æ³•

å¼•ç”¨è®¡æ•°æ³•å°±æ˜¯ç»™æ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æœ‰å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼›

å½“å¼•ç”¨å¤±æ•ˆæˆ–è€…æŒ‡å‘å…¶ä»–å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨å‡1ï¼›

å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¯´æ˜è¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚

!!!danger "å¼•ç”¨è®¡æ•°æ³•çš„ç¼ºç‚¹"
    ä½†æ˜¯å¼•ç”¨è®¡æ•°æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ï¼ˆç»´æŠ¤å¼•ç”¨è®¡æ•°å™¨ä¹Ÿä¼šå¢åŠ å¼€é”€ï¼‰

---

#### å¯è¾¾æ€§åˆ†æ

JVMä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ã€‚

å¯è¾¾æ€§åˆ†æç®—æ³•å°†å¯¹è±¡åˆ†ä¸ºâ€œGC Rootå¯¹è±¡â€å’Œâ€œæ™®é€šå¯¹è±¡â€

å¦‚æœä¸€ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—å¼•ç”¨é“¾ä»æ ¹å¯¹è±¡è®¿é—®åˆ°ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±æ˜¯å¯è¾¾çš„ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚

!!!question "å“ªäº›æ˜¯GC Rootå¯¹è±¡ï¼Ÿ"
    - çº¿ç¨‹Threadå¯¹è±¡åŠå…¶å¼•ç”¨çš„å¯¹è±¡
    - ç±»çš„é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡
    - å¸¸é‡å¼•ç”¨çš„å¯¹è±¡
    - æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡
    - JVMå†…éƒ¨å¼•ç”¨çš„å¯¹è±¡
    - ...


### å¼•ç”¨ç±»å‹

åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œå¼•ç”¨æŒ‡â€œå¼ºå¼•ç”¨â€

Javaä¸­æœ‰äº”ç§å¼•ç”¨ç±»å‹ï¼š

- å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰

- è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰

- å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰

- è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰

- ç»ˆç»“å™¨å¼•ç”¨ï¼ˆFinal Referenceï¼‰


#### è½¯å¼•ç”¨

![ab087fbc-bf89-4930-a72f-fa0031ea4be0](./images/ab087fbc-bf89-4930-a72f-fa0031ea4be0.png)

> [!Warning]
>
> æ³¨æ„ï¼šè½¯å¼•ç”¨å¯¹è±¡ä¹Ÿéœ€è¦è¢«å¼ºå¼•ç”¨ï¼Œå¦åˆ™ä¹Ÿä¼šè¢«å›æ”¶



![f36fa4c2-82b9-4656-88a6-c9def9c7eabc](./images/f36fa4c2-82b9-4656-88a6-c9def9c7eabc.png)

> æ³¨ï¼šå·¥å…·-->Caffeineç¼“å­˜åº“



![d0fd342e-aa80-4425-9eea-4b99839254ba](./images/d0fd342e-aa80-4425-9eea-4b99839254ba.png)

```java
public class Demo{
    public static void main(String[] args){
        ArrayList<SoftReference> softReferences = new ArrayList<>();
        ReferenceQueue<byte[]> queues = new ReferenceQueue<byte[]>();
        for(int i=0;i<10;i++){
            byte[] bytes = new byte[1024*1024*100];
            SoftReference stuRef = new SoftReference<byte[]>(bytes,queues);//æ„é€ å‡½æ•°ä¼ é€’æ•°æ®åŠå¼•ç”¨é˜Ÿåˆ—
            softReferences.add(stuRef);
        }

        softReference<byte[]> ref = null;
        int count = 0;
        while((ref = (SoftReference<byte[]>) queues.poll()) != null){
            count++;
        }
        System.out.println(count);
    }
}
```

> è®¾ç½®å¯åŠ¨å‚æ•° -Xmx200m
> 
> è¾“å‡ºÂ ï¼š
> 
> 9



##### å¼±å¼•ç”¨

![c9dc7ed9-5f25-4430-9c77-faa270e8cdf3](./images/c9dc7ed9-5f25-4430-9c77-faa270e8cdf3.png)

```java
import java.lang.ref.WeakReference;

public class WeakReferenceDemo {
    public static void main(String[] args) {
        byte[] bytes = new byte[1024 * 1024 * 100];
        WeakReference<byte[]> weakReference = new WeakReference<>(bytes);
        bytes = null;
        System.out.println(weakReference.get());
        System.gc();
        System.out.println(weakReference.get());
    }
}

```

> è¾“å‡ºï¼š
> 
> [B@776ec8df
> null



##### è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨

![3edd66aa-08ac-4184-b4e1-dc4cb80b3488](./images/3edd66aa-08ac-4184-b4e1-dc4cb80b3488.png)



#### åƒåœ¾å›æ”¶ç®—æ³•

![2375c61e-164b-4f36-8228-82b7496567d2](./images/2375c61e-164b-4f36-8228-82b7496567d2.png)

![8b6e96a2-42f6-4f87-904c-b033db08760a](./images/8b6e96a2-42f6-4f87-904c-b033db08760a.png)

![e92ea9e5-453f-4844-abd8-55319796e6b4](./images/e92ea9e5-453f-4844-abd8-55319796e6b4.png)

![426fab77-8775-4325-8757-97006184dd41](./images/426fab77-8775-4325-8757-97006184dd41.png)

![9f5d3bd0-8b06-49e5-a75a-89e33e71122c](./images/9f5d3bd0-8b06-49e5-a75a-89e33e71122c.png)



##### æ ‡è®°æ¸…é™¤æ³•

![70692ba1-33ae-4880-846b-996e3f732d81](./images/70692ba1-33ae-4880-846b-996e3f732d81.png)

> ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€é˜¶æ®µç»™æ¯ä¸ªå¯¹è±¡ç»´æŠ¤æ ‡å¿—ä½ï¼Œç¬¬äºŒé˜¶æ®µåˆ é™¤å¯¹è±¡å³å¯
> 
> ç¼ºç‚¹ï¼š
> 
> - ç¢ç‰‡åŒ–é—®é¢˜ï¼Œå¯¹è±¡åˆ é™¤åå†…å­˜ä¸­ä¼šå‡ºç°å¾ˆå¤šç»†å°çš„å¯ç”¨å†…å­˜å•å…ƒï¼Œå¦‚æœéœ€è¦è¾ƒå¤§çš„ç©ºé—´ï¼Œåˆ™è¿™äº›ç¢ç‰‡æ— æ³•è¢«åˆ†é…
> 
> - åˆ†é…é€Ÿåº¦æ…¢ï¼Œç”±äºå†…å­˜ç¢ç‰‡å­˜åœ¨ï¼Œéœ€è¦è¿›è¡Œéå†å¯»æ‰¾å¯ç”¨ç©ºé—´



##### å¤åˆ¶ç®—æ³•

![5aae0d82-92f5-4737-bb54-d0daee4e677e](./images/5aae0d82-92f5-4737-bb54-d0daee4e677e.png)

> ä¼˜ç‚¹ï¼š
> 
> - ååé‡é«˜
> 
> - ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–
> 
> ç¼ºç‚¹ï¼šå†…å­˜ä½¿ç”¨æ•ˆç‡ä½



##### æ ‡è®°æ•´ç†ç®—æ³•ï¼ˆæ ‡è®°å‹ç¼©ç®—æ³•ï¼‰

![673846d3-1d70-45ef-8429-aa27122f9f39](./images/673846d3-1d70-45ef-8429-aa27122f9f39.png)

> ä¼˜ç‚¹ï¼š
> 
> - å†…å­˜ä½¿ç”¨ç‡é«˜
> 
> - ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–
> 
> ç¼ºç‚¹ï¼šæ•´ç†é˜¶æ®µæ•ˆç‡ä¸é«˜



##### åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•

![8f51380a-2653-4b77-ad13-263d968111ed](./images/8f51380a-2653-4b77-ad13-263d968111ed.png)

![46cca94b-06e7-4818-8b74-8f32d597aee4](./images/46cca94b-06e7-4818-8b74-8f32d597aee4.png)

![a63baab8-5d57-4b2c-bc0f-a850240bb543](./images/a63baab8-5d57-4b2c-bc0f-a850240bb543.png)

![3e66eb26-77b3-489e-9a50-202e58906ffb](./images/3e66eb26-77b3-489e-9a50-202e58906ffb.png)

![856e1c23-0d86-4d48-a724-3e0da80e7dc4](./images/856e1c23-0d86-4d48-a724-3e0da80e7dc4.png)

> [!Caution]
>
> â€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ 50% æ—¶ï¼ˆé»˜è®¤å€¼æ˜¯ 50%ï¼Œå¯ä»¥é€šè¿‡ `-XX:TargetSurvivorRatio=percent` æ¥è®¾ç½®ï¼Œå‚è§ [issue1199](https://github.com/Snailclimb/JavaGuide/issues/1199) ï¼‰ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚
>
> ------
>
> è‘—ä½œæƒå½’JavaGuide(javaguide.cn)æ‰€æœ‰ åŸºäºMITåè®® åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/jvm/jvm-garbage-collection.html



![52e4c13c-cb84-42f7-94ac-a98ef8a0d28b](./images/52e4c13c-cb84-42f7-94ac-a98ef8a0d28b.png)

![b4c90638-e405-4bc6-98b7-0fc03ca2df39](./images/b4c90638-e405-4bc6-98b7-0fc03ca2df39.png)

#### åƒåœ¾å›æ”¶å™¨

![d57acf5f-754e-44aa-a5de-6e5c8e38c048](./images/d57acf5f-754e-44aa-a5de-6e5c8e38c048.png)



1. ç»„åˆä¸€

![01895fe5-43a4-409b-9446-16bbe5248f9e](./images/01895fe5-43a4-409b-9446-16bbe5248f9e.png)

![8163c13f-f40c-44e5-8e64-272c503e111b](./images/8163c13f-f40c-44e5-8e64-272c503e111b.png)



2. ç»„åˆäºŒ

![05a57a17-c4b0-4bdc-819a-6fea52f6152d](./images/05a57a17-c4b0-4bdc-819a-6fea52f6152d.png)

![390698e7-18cb-40f5-8333-85c899828dea](./images/390698e7-18cb-40f5-8333-85c899828dea.png)

![120613c9-05c6-4667-8807-8dc8fe700abb](./images/120613c9-05c6-4667-8807-8dc8fe700abb.png)

![05811edb-5c10-420d-ba0f-5dbdfe186d93](./images/05811edb-5c10-420d-ba0f-5dbdfe186d93.png)



3. ç»„åˆä¸‰

![c30d14e0-2291-47ab-94b9-da34333805e8](./images/c30d14e0-2291-47ab-94b9-da34333805e8.png)

![4f095d3c-d7c6-41c5-a28e-4d955a5c96c4](./images/4f095d3c-d7c6-41c5-a28e-4d955a5c96c4.png)

![c9d32e5a-f0e8-4166-b560-704d1d318db8](./images/c9d32e5a-f0e8-4166-b560-704d1d318db8.png)



4.G1åƒåœ¾å›æ”¶å™¨

![fc247461-199e-4dbf-9f45-d850427ec295](./images/fc247461-199e-4dbf-9f45-d850427ec295.png)

![9f41f0a1-9b82-415b-b50f-2a8050858814](./images/9f41f0a1-9b82-415b-b50f-2a8050858814.png)

![b4604f0c-1d14-4549-b45a-9557a0aaad93](./images/b4604f0c-1d14-4549-b45a-9557a0aaad93.png)

![81d56fed-1a64-4f56-90c9-ea2db2922035](./images/81d56fed-1a64-4f56-90c9-ea2db2922035.png)

1. æ–°åˆ›å»ºçš„å¯¹è±¡ä¼šå­˜æ”¾åœ¨EdenåŒºã€‚å½“G1åˆ¤æ–­å¹´è½»ä»£åŒºä¸è¶³ï¼ˆmaxé»˜è®¤60%ï¼‰ï¼Œæ— æ³•åˆ†é…å¯¹è±¡æ—¶éœ€è¦å›æ”¶æ—¶ä¼šæ‰§è¡ŒYoung GCã€‚

2. æ ‡è®°å‡ºEdenå’ŒSurvivoråŒºåŸŸä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œ

3. æ ¹æ®é…ç½®çš„æœ€å¤§æš‚åœæ—¶é—´é€‰æ‹©æŸäº›åŒºåŸŸå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„SurvivoråŒºä¸­ï¼ˆå¹´é¾„+1ï¼‰ï¼Œæ¸…ç©ºè¿™äº›åŒºåŸŸã€‚

4. åç»­Young GCæ—¶ä¸ä¹‹å‰ç›¸åŒï¼Œåªä¸è¿‡SurvivoråŒºä¸­å­˜æ´»å¯¹è±¡ä¼šè¢«æ¬è¿åˆ°å¦ä¸€ä¸ªSurvivoråŒºã€‚

5. å½“æŸä¸ªå­˜æ´»å¯¹è±¡çš„å¹´é¾„åˆ°è¾¾é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰ï¼Œå°†è¢«æ”¾å…¥è€å¹´ä»£ã€‚

6. éƒ¨åˆ†å¯¹è±¡å¦‚æœå¤§å°è¶…è¿‡Regionçš„ä¸€åŠï¼Œä¼šç›´æ¥æ”¾å…¥è€å¹´ä»£ï¼Œè¿™ç±»è€å¹´ä»£è¢«ç§°ä¸ºHumongousåŒºã€‚æ¯”å¦‚å †å†…å­˜æ˜¯4Gï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Må°±è¢«æ”¾å…¥HumongousåŒºï¼Œå¦‚æœå¯¹è±¡è¿‡å¤§ä¼šæ¨ªè·¨å¤šä¸ªRegionã€‚

7. ã€å¤šæ¬¡å›æ”¶ä¹‹åï¼Œä¼šå‡ºç°å¾ˆå¤šOldè€å¹´ä»£åŒºï¼Œæ­¤æ—¶æ€»å †å æœ‰ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼ˆ-XX:InitiatingHeapOccupancyPercenté»˜è®¤45%ï¼‰ä¼šè§¦å‘æ··åˆå›æ”¶MixedGCã€‚å›æ”¶æ‰€æœ‰å¹´è½»ä»£å’Œéƒ¨åˆ†è€å¹´ä»£çš„å¯¹è±¡ä»¥åŠå¤§å¯¹è±¡åŒºã€‚é‡‡ç”¨å¤åˆ¶ç®—æ³•æ¥å®Œæˆã€‚
   
   

> G1åœ¨è¿›è¡ŒYoung GCçš„è¿‡ç¨‹ä¸­ä¼šå»è®°å½•æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶æ¯ä¸ªEdenåŒºå’ŒSurvivoråŒºçš„å¹³å‡è€—æ—¶ï¼Œä»¥ä½œä¸ºä¸‹æ¬¡å›æ”¶æ—¶çš„å‚è€ƒä¾æ®ã€‚è¿™æ ·å°±å¯ä»¥æ ¹æ®é…ç½®çš„æœ€å¤§æš‚åœæ—¶é—´è®¡ç®—å‡ºæœ¬æ¬¡å›æ”¶æ—¶æœ€å¤šèƒ½å›æ”¶å¤šå°‘ä¸ªRegionåŒºåŸŸäº†ã€‚æ¯”å¦‚ -XX:MaxGCPauseMillis=nï¼ˆé»˜è®¤200ï¼‰ï¼Œæ¯ä¸ªRegionå›æ”¶è€—æ—¶40msï¼Œé‚£ä¹ˆè¿™æ¬¡å›æ”¶æœ€å¤šåªèƒ½å›æ”¶4ä¸ªRegionã€‚



![bac91028-93cc-4f35-9866-b75dee96b94e](./images/bac91028-93cc-4f35-9866-b75dee96b94e.png)

G1å¯¹è€å¹´ä»£çš„æ¸…ç†ä¼šé€‰æ‹©å­˜æ´»åº¦æœ€ä½çš„åŒºåŸŸæ¥è¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å›æ”¶æ•ˆç‡æœ€é«˜ï¼Œè¿™ä¹Ÿæ˜¯G1ï¼ˆGarbage firstï¼‰åç§°çš„ç”±æ¥ã€‚æœ€åæ¸…ç†é˜¶æ®µä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚

> æ³¨æ„ï¼šå¦‚æœæ¸…ç†è¿‡ç¨‹ä¸­å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºRegionå­˜æ”¾è½¬ç§»çš„å¯¹è±¡ï¼Œä¼šå‡ºç°Full GCã€‚å•çº¿ç¨‹æ‰§è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„æš‚åœã€‚æ‰€ä»¥å°½é‡ä¿è¯åº”è¯¥ç”¨çš„å †å†…å­˜æœ‰ä¸€å®šå¤šä½™çš„ç©ºé—´ã€‚



![441391f1-96ba-4c6d-bb7e-c2f58befe751](./images/441391f1-96ba-4c6d-bb7e-c2f58befe751.png)



#### åƒåœ¾å›æ”¶å™¨é€‰æ‹©

![a0762648-fd06-4997-abbc-cec1677cd6cd](./images/a0762648-fd06-4997-abbc-cec1677cd6cd.png)

---





