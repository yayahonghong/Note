**MySQL体系结构**

![img](./images/20210303232240506.png)


## 存储引擎

> MySQL默认存储引擎为InnoDB

存储引擎是MySQL的核心组件，负责数据的**存储、检索和管理**。MySQL采用插件式架构，允许用户根据需要选择不同的存储引擎。

```sql
-- 指定存储引擎
CREATE TABLE 表名(
    ...
)ENGINE=INNODB ...
```



|     特性     | InnoDB  | MyISAM |  Memory  | Archive |
| :----------: | :-----: | :----: | :------: | :-----: |
| **事务支持** |    ✅    |   ❌    |    ❌     |    ❌    |
|  **锁粒度**  |  行锁   |  表锁  |   表锁   |  行锁   |
| **外键支持** |    ✅    |   ❌    |    ❌     |    ❌    |
|   **MVCC**   |    ✅    |   ❌    |    ❌     |    ❌    |
| **崩溃恢复** |   强    |   弱   | 数据丢失 |  中等   |
| **全文索引** | ✅(5.6+) |   ✅    |    ❌     |    ❌    |
| **压缩存储** |    ✅    |   ✅    |    ❌     |    ✅    |


<br>

### InnoDB

1. **事务处理**：

    - 完整的ACID支持
    - 四种隔离级别实现

    ```sql
    -- 查看事务隔离级别
    SHOW VARIABLES LIKE 'transaction_isolation';
    ```

2. **聚簇索引**：

    - 主键索引的叶节点直接存储行数据
    - 若无主键则自动创建6字节的ROWID

3. **二级索引**：

    - 非主键索引的叶节点存储主键值
    - 需要回表查询

4. **缓冲池管理**：

    - 采用LRU算法管理内存页
    - 包含多个子池（5.7+支持多实例）

<br>

### MyISAM

**存储结构**

- `.frm`：表结构文件
- `.MYD`：数据文件
- `.MYI`：索引文件

**适用场景**

- **只读或读多写少**的数据
- **不需要事务**的表
- **空间数据**（GIS函数支持较好）

<br>

### Memory

- **特点**：数据存储在内存中，重启丢失
- 使用场景：
    - 临时表
    - 高速缓存

<br>

### 适用场景

|     需求     | 推荐引擎 |          理由          |
| :----------: | :------: | :--------------------: |
|   需要事务   |  InnoDB  | 唯一完整支持ACID的引擎 |
|  高并发写入  |  InnoDB  |   行锁比表锁并发度高   |
|   全文搜索   |  InnoDB  |     5.6+后功能完善     |
|   数据仓库   |  MyISAM  |      计数操作更快      |
| 临时数据处理 |  Memory  |      内存表速度快      |
| 历史数据归档 | Archive  |       超高压缩比       |

<br>

---

