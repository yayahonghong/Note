{"config":{"lang":["zh","en"],"separator":"[\\s\\-,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"YSH \u7684\u6280\u672f\u77e5\u8bc6\u4f53\u7cfb\u5e93","text":"<p>\u975e\u788e\u7247\u5316\u7b14\u8bb0\uff0c\u800c\u662f\u5bf9\u540e\u7aef\u6838\u5fc3\u6280\u672f\u7684\u7cfb\u7edf\u5316\u68b3\u7406\u4e0e\u6df1\u5ea6\u603b\u7ed3\u3002\u6301\u7eed\u66f4\u65b0\uff0c\u6df1\u5165\u539f\u7406\u3002</p>"},{"location":"#-\u6838\u5fc3\u4e13\u9898--core-topics","title":"\ud83d\udcda \u6838\u5fc3\u4e13\u9898 | Core Topics","text":"<p>\u6211\u5c06\u5b66\u4e60\u7b14\u8bb0\u7ec4\u7ec7\u6210\u4e86\u4ee5\u4e0b\u6838\u5fc3\u4e13\u9898\uff0c\u6bcf\u4e2a\u4e13\u9898\u90fd\u8bd5\u56fe\u4ece\u4f7f\u7528\u3001\u539f\u7406\u5230\u5b9e\u8df5\u8fdb\u884c\u5b8c\u6574\u9610\u8ff0\uff1a</p>"},{"location":"#1--java--jvm-\u751f\u6001","title":"1. \ud83d\ude80  Java &amp; JVM \u751f\u6001","text":"<ul> <li>\u300aJVM\u300b - JVM\u5185\u5b58\u7ed3\u6784\u3001\u5783\u573e\u56de\u6536\u7b97\u6cd5\u3001\u7c7b\u52a0\u8f7d\u673a\u5236\u3001\u6027\u80fd\u76d1\u63a7\u4e0e\u8c03\u4f18\u5de5\u5177\uff08jstack, jmap, VisualVM\uff09\u3002</li> <li>\u300a\u5e76\u53d1\u7f16\u7a0b\u300b - Java\u5185\u5b58\u6a21\u578b\uff08JMM\uff09\u3001synchronized\u3001Lock\u3001\u5e76\u53d1\u5de5\u5177\u5305\uff08JUC\uff09\u3001\u539f\u5b50\u7c7b\u3001\u7ebf\u7a0b\u6c60\u539f\u7406\u3002</li> <li>\u300aSpring\u300b - IOC\u5bb9\u5668\u6838\u5fc3\u539f\u7406\u3001AOP\u5b9e\u73b0\u673a\u5236\u3001\u4e8b\u52a1\u7ba1\u7406\u3002</li> <li>\u300aSpringBoot\u300b - \u81ea\u52a8\u914d\u7f6e\u539f\u7406\u3001\u542f\u52a8\u6d41\u7a0b\u3001\u5185\u7f6eWeb\u5bb9\u5668\u3002</li> <li>\u300aSpringCloud\u300b - \u5fae\u670d\u52a1\u6838\u5fc3\u7ec4\u4ef6\uff08Nacos, Loadbalance, Feign, Sentinal\uff09\u539f\u7406\u4e0e\u6574\u5408\u3002</li> </ul>"},{"location":"#2--\u6570\u636e\u5e93\u4e0e\u4e2d\u95f4\u4ef6","title":"2. \ud83d\uddc3\ufe0f  \u6570\u636e\u5e93\u4e0e\u4e2d\u95f4\u4ef6","text":"<ul> <li>\u300aMySQL\u300b - InnoDB\u5b58\u50a8\u5f15\u64ce\u3001\u7d22\u5f15\u539f\u7406\uff08B+Tree\uff09\u3001\u4e8b\u52a1\u4e0e\u9501\u673a\u5236\uff08MVCC\uff09\u3001SQL\u4f18\u5316\u4e0eExplain\u5b9e\u6218\u3002</li> <li>\u300aRedis\u300b - \u6838\u5fc3\u6570\u636e\u7ed3\u6784\u4e0e\u5e95\u5c42\u7f16\u7801\u3001\u6301\u4e45\u5316\uff08RDB/AOF\uff09\u3001\u9ad8\u53ef\u7528\u67b6\u6784\uff08\u4e3b\u4ece/\u54e8\u5175/\u96c6\u7fa4\uff09\u3001\u7f13\u5b58\u95ee\u9898\uff08\u7a7f\u900f/\u96ea\u5d29/\u51fb\u7a7f\uff09\u89e3\u51b3\u65b9\u6848\u3002</li> <li>\u300aRabbitMQ\u300b - \u6d88\u606f\u6a21\u578b\u3001\u6d88\u606f\u53ef\u9760\u6027\u6295\u9012\u3001\u5ef6\u8fdf\u961f\u5217\u3001\u96c6\u7fa4\u5316\u3002</li> <li>\u300aZookeeper\u300b - ZAB\u534f\u8bae\u3001\u5178\u578b\u5e94\u7528\u573a\u666f\uff08\u5206\u5e03\u5f0f\u9501\u3001\u9009\u4e3b\uff09\u3002</li> <li>\u300aNetty\u300b - NIO\u6838\u5fc3\u539f\u7406\u3001Netty\u7ebf\u7a0b\u6a21\u578b\u3001\u7f16\u89e3\u7801\u5668\u3001\u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3\u3002</li> </ul>"},{"location":"#3--\u8fd0\u7ef4\u4e0e\u5de5\u5177","title":"3. \u2699\ufe0f  \u8fd0\u7ef4\u4e0e\u5de5\u5177","text":"<ul> <li>\u300aDocker\u300b - \u6838\u5fc3\u6982\u5ff5\u3001\u955c\u50cf\u4e0e\u5bb9\u5668\u3001Dockerfile\u7f16\u5199\u3001\u7f51\u7edc\u4e0e\u6570\u636e\u5377\u3002</li> <li>\u300aLinux\u300b - \u5e38\u7528\u547d\u4ee4\u3001Shell\u811a\u672c\u3001\u7cfb\u7edf\u6027\u80fd\u76d1\u63a7\u3002</li> <li>\u300aGit\u300b - \u5de5\u4f5c\u6d41\u3001\u5e38\u7528\u547d\u4ee4\u3001\u539f\u7406\u6d45\u6790\u3002</li> </ul>"},{"location":"#-\u5199\u4f5c\u539f\u5219","title":"\ud83c\udfaf \u5199\u4f5c\u539f\u5219","text":"<ul> <li>\u7cfb\u7edf\u5316 (Systematic)\uff1a \u6784\u5efa\u5b8c\u6574\u7684\u77e5\u8bc6\u56fe\u8c31\uff0c\u800c\u975e\u96f6\u6563\u77e5\u8bc6\u70b9\u3002</li> <li>\u6df1\u5ea6\u4f18\u5148 (Depth-First)\uff1a \u4f18\u5148\u63a2\u7a76\u6280\u672f\u80cc\u540e\u7684\u8bbe\u8ba1\u601d\u60f3\u4e0e\u6e90\u7801\u539f\u7406\u3002</li> <li>\u5bfc\u5411\u5b9e\u8df5 (Practice-Oriented)\uff1a \u7ed3\u5408\u7406\u8bba\uff0c\u7ed9\u51fa\u843d\u5730\u5b9e\u8df5\u7684\u6700\u4f73\u65b9\u6848\u548c\u601d\u8003\u3002</li> </ul>"},{"location":"#-\u5982\u4f55\u9605\u8bfb","title":"\ud83e\udd14 \u5982\u4f55\u9605\u8bfb","text":"<p>\u6bcf\u4e2a\u4e13\u9898\u90fd\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u5185\u542bMarkdown\u6587\u4ef6\uff0c\u5efa\u8bae\u6309\u987a\u5e8f\u9605\u8bfb\u3002</p> <p>\u6b64\u4ed3\u5e93\u662f\u6211\u6280\u672f\u6210\u957f\u4e4b\u8def\u7684\u6c89\u6dc0\uff0c\u5e0c\u671b\u5bf9\u60a8\u4e5f\u6709\u5e2e\u52a9\u3002\u5982\u6709\u8c2c\u8bef\uff0c\u6073\u8bf7\u6307\u6b63\uff01</p>"},{"location":"Docker/","title":"Docker","text":""},{"location":"Docker/#docker\u6982\u8ff0","title":"Docker\u6982\u8ff0","text":"<p>Docker \u662f\u4e00\u4e2a\u7528\u4e8e\u5f00\u53d1\u3001\u53d1\u5e03\u548c\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u653e\u5e73\u53f0\u3002Docker \u4f7f\u60a8\u80fd\u591f\u5c06\u5e94\u7528\u7a0b\u5e8f\u4e0e\u57fa\u7840\u8bbe\u65bd\u5206\u79bb\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u5feb\u901f\u4ea4\u4ed8\u8f6f\u4ef6\u3002\u501f\u52a9 Docker\uff0c\u60a8\u53ef\u4ee5\u50cf\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\u3002\u901a\u8fc7\u5229\u7528 Docker \u7684\u65b9\u6cd5\u6765\u4f20\u9001\u3001\u6d4b\u8bd5\u548c\u90e8\u7f72\u4ee3\u7801\uff0c\u60a8\u53ef\u4ee5\u663e\u8457\u51cf\u5c11\u7f16\u5199\u4ee3\u7801\u548c\u5728\u751f\u4ea7\u4e2d\u8fd0\u884c\u4ee3\u7801\u4e4b\u95f4\u7684\u5ef6\u8fdf\u3002</p>"},{"location":"Docker/#docker-\u7684\u6838\u5fc3\u6982\u5ff5","title":"Docker \u7684\u6838\u5fc3\u6982\u5ff5\uff1a","text":"<ul> <li>\u955c\u50cf\uff08Image\uff09\uff1aDocker \u955c\u50cf\u662f\u4e00\u4e2a\u53ea\u8bfb\u6a21\u677f\uff0c\u5305\u542b\u4e86\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u6240\u6709\u6587\u4ef6\u3001\u4f9d\u8d56\u548c\u914d\u7f6e\u3002\u955c\u50cf\u662f\u5bb9\u5668\u7684\u57fa\u7840\u3002</li> <li>\u5bb9\u5668\uff08Container\uff09\uff1a\u5bb9\u5668\u662f\u955c\u50cf\u7684\u8fd0\u884c\u5b9e\u4f8b\u3002\u5bb9\u5668\u662f\u8f7b\u91cf\u7ea7\u7684\u3001\u53ef\u79fb\u690d\u7684\uff0c\u5e76\u4e14\u4e0e\u4e3b\u673a\u73af\u5883\u9694\u79bb\u3002</li> <li>Docker Hub\uff1aDocker Hub \u662f\u4e00\u4e2a\u516c\u5171\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u7528\u6237\u53ef\u4ee5\u4ece\u4e2d\u62c9\u53d6\u548c\u63a8\u9001\u955c\u50cf\u3002</li> </ul>"},{"location":"Docker/#docker-\u7684\u4f18\u52bf","title":"Docker \u7684\u4f18\u52bf\uff1a","text":"<ul> <li>\u8f7b\u91cf\u7ea7\uff1a\u5bb9\u5668\u5171\u4eab\u4e3b\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff0c\u56e0\u6b64\u6bd4\u865a\u62df\u673a\u66f4\u8f7b\u91cf\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a\u5bb9\u5668\u53ef\u4ee5\u5728\u4efb\u4f55\u652f\u6301 Docker \u7684\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u786e\u4fdd\u5f00\u53d1\u3001\u6d4b\u8bd5\u548c\u751f\u4ea7\u73af\u5883\u7684\u4e00\u81f4\u6027\u3002</li> <li>\u9694\u79bb\u6027\uff1a\u6bcf\u4e2a\u5bb9\u5668\u90fd\u8fd0\u884c\u5728\u72ec\u7acb\u7684\u73af\u5883\u4e2d\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</li> </ul>"},{"location":"Docker/#\u5b89\u88c5docker","title":"\u5b89\u88c5Docker","text":""},{"location":"Docker/#centos-7-\u5b89\u88c5-docker","title":"CentOS 7 \u5b89\u88c5 Docker","text":"<ol> <li> <p>\u5378\u8f7d\u65e7\u7248\u672c Docker\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a    <pre><code>yum remove docker \\\n    docker-client \\\n    docker-client-latest \\\n    docker-common \\\n    docker-latest \\\n    docker-latest-logrotate \\\n    docker-logrotate \\\n    docker-engine \\\n    docker-selinux\n</code></pre></p> </li> <li> <p>\u5b89\u88c5\u5fc5\u8981\u7684\u5de5\u5177\uff1a    <pre><code>sudo yum install -y yum-utils device-mapper-persistent-data lvm2\n</code></pre></p> </li> <li> <p>\u914d\u7f6e Docker \u7684 yum \u6e90\uff08\u4f7f\u7528\u963f\u91cc\u4e91\u6e90\uff09\uff1a    <pre><code>sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo\n</code></pre></p> </li> <li> <p>\u66f4\u65b0 yum \u7f13\u5b58\uff1a    <pre><code>sudo yum makecache fast\n</code></pre></p> </li> <li> <p>\u5b89\u88c5 Docker\uff1a    <pre><code>yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n</code></pre></p> </li> <li> <p>\u542f\u52a8 Docker \u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\uff1a    <pre><code>systemctl start docker\nsystemctl enable docker\n</code></pre></p> </li> <li> <p>\u9a8c\u8bc1 Docker \u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a    <pre><code>docker --version\ndocker ps  # \u5982\u679c\u4e0d\u62a5\u9519\uff0c\u8bf4\u660e Docker \u5b89\u88c5\u5e76\u542f\u52a8\u6210\u529f\n</code></pre></p> </li> <li> <p>\u914d\u7f6e\u955c\u50cf\u52a0\u901f\uff1a    <pre><code>mkdir -p /etc/docker\ntee /etc/docker/daemon.json &lt;&lt;-'EOF'\n{\n    \"registry-mirrors\": [\n        \"http://hub-mirror.c.163.com\",\n        \"https://mirrors.tuna.tsinghua.edu.cn\",\n        \"http://mirrors.sohu.com\",\n        \"https://ustc-edu-cn.mirror.aliyuncs.com\",\n        \"https://ccr.ccs.tencentyun.com\",\n        \"https://docker.m.daocloud.io\",\n        \"https://docker.awsl9527.cn\"\n    ]\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\n</code></pre></p> </li> </ol>"},{"location":"Docker/#\u90e8\u7f72\u5e94\u7528","title":"\u90e8\u7f72\u5e94\u7528","text":""},{"location":"Docker/#\u4ee5-mysql-\u4e3a\u4f8b","title":"\u4ee5 MySQL \u4e3a\u4f8b","text":"<ol> <li>\u8fd0\u884c MySQL \u5bb9\u5668\uff1a</li> </ol> <pre><code>docker run -d \\\n    --name mysql \\\n    -p 3306:3306 \\\n    -v $PWD/conf:/etc/mysql/conf.d \\\n    -v $PWD/logs:/logs \\\n    -v $PWD/data:/var/lib/mysql \\\n    -e TZ=Asia/Shanghai \\\n    -e MYSQL_ROOT_PASSWORD=123456 \\\n    mysql\n</code></pre> <ul> <li><code>-d</code>\uff1a\u4f7f\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\u3002</li> <li><code>--name</code>\uff1a\u4e3a\u5bb9\u5668\u8bbe\u7f6e\u540d\u79f0\u3002</li> <li><code>-p</code>\uff1a\u7aef\u53e3\u6620\u5c04\uff0c\u683c\u5f0f\u4e3a <code>\u5bbf\u4e3b\u673a\u7aef\u53e3:\u5bb9\u5668\u7aef\u53e3</code>\u3002</li> <li><code>-e</code>\uff1a\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002</li> <li> <p><code>mysql</code>\uff1a\u6307\u5b9a\u8fd0\u884c\u7684\u955c\u50cf\u540d\u79f0\u3002</p> </li> <li> <p>\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7\uff1a    <pre><code>docker logs mysql\n</code></pre></p> </li> <li> <p>\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\uff1a    <pre><code>docker exec -it mysql bash\n</code></pre></p> </li> </ul>"},{"location":"Docker/#\u955c\u50cf\u5bb9\u5668","title":"\u955c\u50cf&amp;\u5bb9\u5668","text":""},{"location":"Docker/#\u5e38\u7528\u547d\u4ee4","title":"\u5e38\u7528\u547d\u4ee4","text":"<ol> <li> <p>\u62c9\u53d6\u955c\u50cf\uff1a    <pre><code>docker pull [image_name]:[version]\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u672c\u5730\u955c\u50cf\uff1a    <pre><code>docker images\n</code></pre></p> </li> <li> <p>\u5220\u9664\u955c\u50cf\uff1a    <pre><code>docker rmi [image_name]:[version]\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u5bb9\u5668\uff1a    <pre><code>docker ps -a  # \u67e5\u770b\u6240\u6709\u5bb9\u5668\n</code></pre></p> </li> <li> <p>\u5220\u9664\u5bb9\u5668\uff1a    <pre><code>docker rm [container_name]\n</code></pre></p> </li> <li> <p>\u505c\u6b62\u5bb9\u5668\uff1a    <pre><code>docker stop [container_name]\n</code></pre></p> </li> <li> <p>\u542f\u52a8\u5bb9\u5668\uff1a    <pre><code>docker start [container_name]\n</code></pre></p> </li> <li> <p>\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\uff1a    <pre><code>docker exec -it [container_name] bash\n</code></pre></p> </li> </ol>"},{"location":"Docker/#\u6570\u636e\u5377","title":"\u6570\u636e\u5377","text":""},{"location":"Docker/#\u6570\u636e\u5377\u64cd\u4f5c","title":"\u6570\u636e\u5377\u64cd\u4f5c","text":"<ol> <li> <p>\u521b\u5efa\u6570\u636e\u5377\uff1a    <pre><code>docker volume create [volume_name]\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u6240\u6709\u6570\u636e\u5377\uff1a    <pre><code>docker volume ls\n</code></pre></p> </li> <li> <p>\u5220\u9664\u6570\u636e\u5377\uff1a    <pre><code>docker volume rm [volume_name]\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u6570\u636e\u5377\u8be6\u60c5\uff1a    <pre><code>docker volume inspect [volume_name]\n</code></pre></p> </li> <li> <p>\u6302\u8f7d\u6570\u636e\u5377\uff1a    <pre><code>docker run -d \\\n    --name nginx \\\n    -p 80:80 \\\n    -v html:/usr/share/nginx/html \\\n    nginx\n</code></pre></p> </li> <li> <p>\u6302\u8f7d\u672c\u5730\u76ee\u5f55\uff1a    <pre><code>docker run -d \\\n    --name nginx \\\n    -p 80:80 \\\n    -v /path/to/local/dir:/usr/share/nginx/html \\\n    nginx\n</code></pre></p> </li> </ol>"},{"location":"Docker/#\u81ea\u5b9a\u4e49\u955c\u50cf","title":"\u81ea\u5b9a\u4e49\u955c\u50cf","text":""},{"location":"Docker/#dockerfile-\u793a\u4f8b","title":"Dockerfile \u793a\u4f8b","text":"<pre><code>FROM centos:7  # \u6307\u5b9a\u57fa\u7840\u955c\u50cf\nENV MY_ENV=\"value\"  # \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nCOPY ./app /app  # \u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u5230\u955c\u50cf\nRUN yum install -y nginx  # \u6267\u884c\u547d\u4ee4\nEXPOSE 80  # \u66b4\u9732\u7aef\u53e3\nENTRYPOINT [\"nginx\", \"-g\", \"daemon off;\"]  # \u5bb9\u5668\u542f\u52a8\u547d\u4ee4\n</code></pre>"},{"location":"Docker/#\u6784\u5efa\u955c\u50cf","title":"\u6784\u5efa\u955c\u50cf","text":"<pre><code>docker build -t myapp:1.0 .\n</code></pre>"},{"location":"Docker/#\u7f51\u7edc","title":"\u7f51\u7edc","text":""},{"location":"Docker/#\u5e38\u7528\u547d\u4ee4_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<ol> <li> <p>\u67e5\u770b\u7f51\u7edc\u5217\u8868\uff1a    <pre><code>docker network ls\n</code></pre></p> </li> <li> <p>\u521b\u5efa\u81ea\u5b9a\u4e49\u7f51\u7edc\uff1a    <pre><code>docker network create my_network\n</code></pre></p> </li> <li> <p>\u5c06\u5bb9\u5668\u8fde\u63a5\u5230\u7f51\u7edc\uff1a    <pre><code>docker network connect my_network [container_name]\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u7f51\u7edc\u8be6\u60c5\uff1a    <pre><code>docker network inspect my_network\n</code></pre></p> </li> </ol>"},{"location":"Docker/#docker-compose-\u5feb\u901f\u90e8\u7f72","title":"Docker Compose \u5feb\u901f\u90e8\u7f72","text":""},{"location":"Docker/#\u793a\u4f8b-docker-composeyml","title":"\u793a\u4f8b <code>docker-compose.yml</code>","text":"<pre><code>version: '3'\nservices:\n  web:\n    image: nginx\n    ports:\n      - \"80:80\"\n  db:\n    image: mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n</code></pre>"},{"location":"Docker/#\u5e38\u7528\u547d\u4ee4_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<ol> <li> <p>\u542f\u52a8\u670d\u52a1\uff1a    <pre><code>docker-compose up -d\n</code></pre></p> </li> <li> <p>\u505c\u6b62\u670d\u52a1\uff1a    <pre><code>docker-compose down\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u670d\u52a1\u72b6\u6001\uff1a    <pre><code>docker-compose ps\n</code></pre></p> </li> </ol>"},{"location":"Docker/#\u5e38\u89c1\u95ee\u9898","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li> <p>\u5bb9\u5668\u65e0\u6cd5\u542f\u52a8\uff1a    <pre><code>docker logs [container_name]\n</code></pre></p> </li> <li> <p>\u7aef\u53e3\u51b2\u7a81\uff1a    <pre><code>netstat -tuln | grep [port]\n</code></pre></p> </li> </ol>"},{"location":"Docker/#\u5e38\u7528\u90e8\u7f72\u811a\u672c","title":"\u5e38\u7528\u90e8\u7f72\u811a\u672c","text":""},{"location":"Docker/#mysql","title":"MySQl","text":"<pre><code>docker run -d \\\n    --name mysql \\\n    -p 3306:3306 \\\n    -v /docker/mysql/conf:/etc/mysql/conf.d \\\n    -v /docker/mysql/logs:/logs \\\n    -v /docker/mysql/data:/var/lib/mysql \\\n    -e TZ=Asia/Shanghai \\\n    -e MYSQL_ROOT_PASSWORD=Qwer1234! \\\n    mysql \\\n    --character-set-server=utf8mb4 \\\n    --collation-server=utf8mb4_unicode_ci\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6</p> <pre><code>[mysqld]\nlog_error = /logs/mysql-error.log\ngeneral_log = 0          # \u9ed8\u8ba4\u5173\u95ed\uff0c\u9700\u8981\u65f6\u518d\u5f00\u542f\uff08\u4f1a\u4ea7\u751f\u5927\u91cf\u65e5\u5fd7\uff09\n\nslow_query_log = 1       # \u5efa\u8bae\u5f00\u542f\u6162\u67e5\u8be2\nslow_query_log_file = /logs/mysql-slow.log\nlong_query_time = 2      # \u8d85\u8fc7 2 \u79d2\u7684\u67e5\u8be2\u89c6\u4e3a\u6162\u67e5\u8be2\n</code></pre>"},{"location":"Docker/#redis","title":"Redis","text":"<pre><code>docker run -d \\\n    --name redis \\\n    -p 6379:6379 \\\n    --log-opt max-size=100m \\\n    --log-opt max-file=2 \\\n    -v /docker/redis/conf/redis.conf:/etc/redis/redis.conf \\\n    -v /docker/redis/data:/data \\\n    -v /docker/redis/logs:/logs \\\n    redis \\\n    redis-server /etc/redis/redis.conf --requirepass Qwer1234!\n</code></pre> <p>[!Tip]</p> <p>\u5bc6\u7801\u8bbe\u7f6e\uff1a</p> <ul> <li>\u5efa\u8bae\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5bc6\u7801\uff0c\u800c\u4e0d\u662f\u547d\u4ee4\u884c\u53c2\u6570</li> <li>\u5728<code>redis.conf</code>\u4e2d\u6dfb\u52a0\uff1a<code>requirepass \u5f3a\u5bc6\u7801</code></li> </ul> <p>\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b(<code>/docker/redis/conf/redis.conf</code>)</p> <pre><code>bind 0.0.0.0\nport 6379\nprotected-mode no\ndaemonize no\nrequirepass \u4f60\u7684\u5f3a\u5bc6\u7801\nappendonly yes\ndir /data\nlogfile \"/logs/redis.log\"\n</code></pre>"},{"location":"Docker/#rabbitmq","title":"RabbitMQ","text":"<pre><code>docker run -d \\\n  --name rabbitmq \\\n  --hostname my-rabbit \\\n  -p 5672:5672 \\\n  -p 15672:15672 \\\n  -p 25672:25672 \\\n  -v /docker/rabbitmq/data:/var/lib/rabbitmq \\\n  -v /docker/rabbitmq/conf:/etc/rabbitmq \\\n  -v /docker/rabbitmq/logs:/var/log/rabbitmq \\\n  -v /docker/rabbitmq/plugins:/plugins \\\n  -e RABBITMQ_DEFAULT_USER=admin \\\n  -e RABBITMQ_DEFAULT_PASS=123456 \\\n  --restart unless-stopped \\\n  rabbitmq\n</code></pre> <p>[!Tip]</p> <p>5672                  # AMQP \u534f\u8bae\u7aef\u53e3</p> <p>15672                # \u7ba1\u7406\u754c\u9762\u7aef\u53e3</p> <p>25672                # \u96c6\u7fa4\u901a\u4fe1\u7aef\u53e3</p> <p><code>-e RABBITMQ_ERLANG_COOKIE='secret_cookie' \\</code>  # \u96c6\u7fa4\u9700\u8981</p> <p>\u914d\u7f6e\u6587\u4ef6</p> <pre><code>## \u57fa\u7840\u914d\u7f6e\nloopback_users.guest = false\nlisteners.tcp.default = 5672\n\n## \u5185\u5b58\u548c\u78c1\u76d8\u8bbe\u7f6e\nvm_memory_high_watermark.relative = 0.6\ndisk_free_limit.absolute = 2GB\n\n## \u96c6\u7fa4\u914d\u7f6e\n## cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config\n## cluster_formation.classic_config.nodes.1 = rabbit@rabbit1\n## cluster_formation.classic_config.nodes.2 = rabbit@rabbit2\n\n## \u65e5\u5fd7\u8bbe\u7f6e\nlog.file.level = info\nlog.file.rotation.date = $D0\nlog.file.rotation.size = 50MB\n</code></pre>"},{"location":"Docker/#nginx","title":"Nginx","text":"<pre><code>docker run -d \\\n  --name nginx \\\n  -p 80:80 \\\n  -p 443:443 \\\n  -v /docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro \\\n  -v /docker/nginx/conf.d:/etc/nginx/conf.d:ro \\\n  -v /docker/nginx/html:/usr/share/nginx/html \\\n  -v /docker/nginx/logs:/var/log/nginx \\\n  -v /docker/nginx/certs:/etc/nginx/certs:ro \\\n  --restart unless-stopped \\\n  nginx:latest\n</code></pre> <p>\u4e3b\u914d\u7f6e\u6587\u4ef6 <code>/docker/nginx/conf/nginx.conf</code></p> <pre><code>user  nginx;\nworker_processes  auto;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    keepalive_timeout  65;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n</code></pre> <p>\u7ad9\u70b9\u914d\u7f6e <code>/docker/nginx/conf.d/default.conf</code></p> <pre><code>server {\n    listen       80;\n    server_name  localhost;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n</code></pre>"},{"location":"Docker/#nacos","title":"Nacos","text":"<pre><code>mkdir -p /docker/nacos/standalone/{logs,conf,data}\n\ndocker run -d \\\n  --name nacos-standalone \\\n  -p 8848:8848 \\\n  -e MODE=standalone \\\n  -e SPRING_DATASOURCE_PLATFORM=mysql \\\n  -e MYSQL_SERVICE_HOST=localhost \\\n  -e MYSQL_SERVICE_PORT=3306 \\\n  -e MYSQL_SERVICE_USER=root \\\n  -e MYSQL_SERVICE_PASSWORD=123 \\\n  -e MYSQL_SERVICE_DB_NAME=nacos_config \\\n  -v /docker/nacos/standalone/logs:/home/nacos/logs \\\n  -v /docker/nacos/standalone/conf:/home/nacos/conf \\\n  --restart unless-stopped \\\n  nacos/nacos-server:latest\n</code></pre> <p>[!Tip]</p> <p>MySQL\u6570\u636e\u5e93\u811a\u672c</p> <p>nacos/distribution/conf/mysql-schema.sql at master \u00b7 alibaba/nacos</p>"},{"location":"Docker/#elasticsearch","title":"ElasticSearch","text":"<pre><code>mkdir -p /docker/elasticsearch/{data,config,logs}\nchmod -R 1000:1000 /docker/elasticsearch  # Elasticsearch\u4f7f\u7528uid 1000\n\ndocker run -d \\\n  --name elasticsearch \\\n  -p 9200:9200 \\\n  -p 9300:9300 \\\n  -e \"discovery.type=single-node\" \\\n  -e \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" \\\n  -v /docker/elasticsearch/data:/usr/share/elasticsearch/data \\\n  -v /docker/elasticsearch/config:/usr/share/elasticsearch/config \\\n  -v /docker/elasticsearch/logs:/usr/share/elasticsearch/logs \\\n  --ulimit nofile=65536:65536 \\\n  --ulimit memlock=-1:-1 \\\n  --restart unless-stopped \\\n  elasticsearch\n</code></pre> <p>[!Tip]</p> <p><code>-e \"xpack.security.enabled=false\" \\</code>  # \u5f00\u53d1\u73af\u5883\u53ef\u5173\u95ed\u5b89\u5168\u8ba4\u8bc1</p>"},{"location":"Docker/#postgresql","title":"PostgreSQL","text":"<pre><code>docker run -d \\\n  --name postgres \\\n  -p 5432:5432 \\\n  -e POSTGRES_PASSWORD=mysecretpassword \\\n  -e POSTGRES_USER=myuser \\\n  -e POSTGRES_DB=mydb \\\n  -v /docker/postgres/data:/var/lib/postgresql/data \\\n  -v /docker/postgres/config:/etc/postgresql \\\n  --restart unless-stopped \\\n  postgres\n</code></pre>"},{"location":"Docker/#mongodb","title":"MongoDB","text":"<pre><code>docker run -d \\\n  --name mongodb \\\n  -p 27017:27017 \\\n  -e MONGO_INITDB_ROOT_USERNAME=root \\\n  -e MONGO_INITDB_ROOT_PASSWORD=123456 \\\n  -v /docker/mongodb/data:/data/db \\\n  -v /docker/mongodb/config:/data/configdb \\\n  mongo\n</code></pre>"},{"location":"Docker/#zookeeper","title":"Zookeeper","text":"<pre><code>docker run -d \\\n--name zookeeper \\\n--privileged=true \\\n-p 2181:2181 \\\n-v /docker/zookeeper/data:/data \\\n-v /docker/zookeeper/conf:/conf \\\n-v /docker/zookeeper/logs:/datalog \\\nzookeeper\n</code></pre>"},{"location":"Kafka/","title":"Kafka","text":"<p>\u6d88\u606f\u961f\u5217\u662f\u73b0\u4ee3\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u81f3\u5173\u91cd\u8981\u7684\u7ec4\u4ef6\uff0c\u5b83\u7684\u5b58\u5728\u4e3b\u8981\u89e3\u51b3\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u95ee\u9898</p> <ol> <li> <p>\u89e3\u8026\u7cfb\u7edf\u7ec4\u4ef6</p> </li> <li> <p>\u5f02\u6b65\u5904\u7406</p> </li> <li> <p>\u6d41\u91cf\u524a\u5cf0</p> </li> </ol>"},{"location":"Kafka/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u4f7f\u7528docker compose\u90e8\u7f72</p> <pre><code>services:\n  kafka:\n    image: bitnami/kafka:3.6\n    container_name: kafka\n    restart: unless-stopped\n    environment:\n      - KAFKA_CFG_NODE_ID=0\n      - KAFKA_CFG_PROCESS_ROLES=controller,broker\n      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093\n      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\n      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092\n    volumes:\n      - kafka_data:/bitnami/kafka\n    ports:\n      - \"9092:9092\"\n      - \"9093:9093\"\n    networks:\n      - app-network\n\nvolumes:\n  kafka_data:\n    driver: local\n\nnetworks:\n  app-network:\n    driver: bridge\n</code></pre>"},{"location":"Kafka/#java\u5ba2\u6237\u7aef","title":"Java\u5ba2\u6237\u7aef","text":"<p>\u5f15\u5165\u4f9d\u8d56</p> <pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n            &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;\n            &lt;version&gt;3.9.1&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre> <p>\u751f\u4ea7\u8005\u7b80\u5355\u4f7f\u7528</p> <pre><code>        // \u521b\u5efaKafka\u751f\u4ea7\u8005\u914d\u7f6e\n        Map&lt;String, Object&gt; config = Map.of(\n                ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\",\n                ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName(),\n                ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()\n        );\n\n        // \u521b\u5efaKafka\u751f\u4ea7\u8005\n        try (KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(config)) {\n            for (int i = 0; i &lt; 10; i++) {\n                ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\n                        \"test-topic\",\n                        \"key-\" + i,\n                        String.valueOf(i)\n                );\n                producer.send(record);\n            }\n            producer.flush(); // \u786e\u4fdd\u6d88\u606f\u88ab\u53d1\u9001\n        }\n</code></pre> <p>\u6d88\u8d39\u8005\u7b80\u5355\u4f7f\u7528</p> <pre><code>        // \u521b\u5efaKafka\u6d88\u8d39\u8005\u914d\u7f6e\n        Map&lt;String, Object&gt; consumerConfig = Map.of(\n                ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\",\n                ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName(),\n                ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName(),\n                ConsumerConfig.GROUP_ID_CONFIG, \"test-group\",\n                ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\" // \u4ece\u6700\u65e9\u7684\u6d88\u606f\u5f00\u59cb\u6d88\u8d39\n        );\n\n        // \u521b\u5efaKafka\u6d88\u8d39\u8005\n        try (KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerConfig)) {\n            consumer.subscribe(List.of(\"test-topic\"));\n\n            // \u591a\u6b21\u8f6e\u8be2\u4ee5\u786e\u4fdd\u83b7\u53d6\u5230\u6d88\u606f\n            for (int i = 0; i &lt; 5; i++) {\n                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000));\n                for (ConsumerRecord&lt;String, String&gt; record : records) {\n                    System.out.println(\"Received record: \" + record);\n                }\n                if (!records.isEmpty()) {\n                    break; // \u5982\u679c\u83b7\u53d6\u5230\u6d88\u606f\u5c31\u9000\u51fa\u5faa\u73af\n                }\n            }\n        }\n</code></pre>"},{"location":"Linux/","title":"Linux\u64cd\u4f5c","text":""},{"location":"Linux/#\u8fdc\u7a0b\u767b\u5f55telnetsshputtyftp\u8fdc\u7a0b\u684c\u9762vnc","title":"\u8fdc\u7a0b\u767b\u5f55\uff08telnet\u3001SSH(Putty)\u3001ftp\u3001\u8fdc\u7a0b\u684c\u9762(VNC)\uff09","text":"<p>\u542f\u52a8\u670d\u52a1\uff0c\u914d\u7f6e\u9632\u706b\u5899</p> <pre><code>telnet &lt;IP&gt;  # \u4f7f\u7528Telnet\u767b\u5f55\u8fdc\u7a0b\u4e3b\u673a\uff08\u4e0d\u63a8\u8350\uff0c\u4e0d\u5b89\u5168\uff09\n\nssh &lt;\u7528\u6237\u540d&gt;@&lt;IP&gt; [-p port]  # \u4f7f\u7528SSH\u767b\u5f55\u8fdc\u7a0b\u4e3b\u673a\uff0c-p\u6307\u5b9a\u7aef\u53e3\n\nftp &lt;IP&gt;  # \u4f7f\u7528FTP\u767b\u5f55\u8fdc\u7a0b\u4e3b\u673a\uff0c\u9700\u8981\u542f\u52a8vsftpd\u670d\u52a1\n</code></pre>"},{"location":"Linux/#ssh-\u5e38\u7528\u9009\u9879","title":"SSH \u5e38\u7528\u9009\u9879","text":"<pre><code>ssh -i &lt;\u79c1\u94a5\u6587\u4ef6&gt; &lt;\u7528\u6237\u540d&gt;@&lt;IP&gt;  # \u4f7f\u7528\u79c1\u94a5\u6587\u4ef6\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\nssh -L &lt;\u672c\u5730\u7aef\u53e3&gt;:&lt;\u8fdc\u7a0b\u4e3b\u673a&gt;:&lt;\u8fdc\u7a0b\u7aef\u53e3&gt; &lt;\u7528\u6237\u540d&gt;@&lt;IP&gt;  # \u672c\u5730\u7aef\u53e3\u8f6c\u53d1\nssh -R &lt;\u8fdc\u7a0b\u7aef\u53e3&gt;:&lt;\u672c\u5730\u4e3b\u673a&gt;:&lt;\u672c\u5730\u7aef\u53e3&gt; &lt;\u7528\u6237\u540d&gt;@&lt;IP&gt;  # \u8fdc\u7a0b\u7aef\u53e3\u8f6c\u53d1\n</code></pre>"},{"location":"Linux/#ftp-\u5e38\u7528\u547d\u4ee4","title":"FTP \u5e38\u7528\u547d\u4ee4","text":"<pre><code>ftp &lt;IP&gt;\n&gt; get &lt;\u6587\u4ef6\u540d&gt;  # \u4e0b\u8f7d\u6587\u4ef6\n&gt; put &lt;\u6587\u4ef6\u540d&gt;  # \u4e0a\u4f20\u6587\u4ef6\n&gt; mget &lt;\u6587\u4ef6\u540d&gt;  # \u4e0b\u8f7d\u591a\u4e2a\u6587\u4ef6\n&gt; mput &lt;\u6587\u4ef6\u540d&gt;  # \u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\n&gt; bye  # \u9000\u51faFTP\n</code></pre>"},{"location":"Linux/#\u6307\u4ee4vim\u6b63\u5219\u8868\u8fbe\u5f0f","title":"\u6307\u4ee4\uff08vim\u3001\u6b63\u5219\u8868\u8fbe\u5f0f\uff09","text":"<p>ctrl+C    \u7ec8\u6b62\u7a0b\u5e8f ctrl+D    \u7ed3\u675f\u8f93\u5165</p> <pre><code>cat -A &lt;file&gt;  # -A\u663e\u793a\u7279\u6b8a\u5b57\u7b26\n\nls -a  # \u5217\u51fa\u6240\u6709\u6587\u4ef6\uff0c\u5305\u62ec\u9690\u85cf\u6587\u4ef6\n\nls -l  # \u663e\u793a\u6587\u4ef6\u8be6\u7ec6\u4fe1\u606f\n\nls -al  # \u4ee5\u4e0a\u7ec4\u5408\n\ncp [-i] [-f] [-r]  # \u590d\u5236\u6587\u4ef6\u6216\u76ee\u5f55\uff0c-i\u4ea4\u4e92\u5f0f\u63d0\u793a\uff0c-f\u5f3a\u5236\u8986\u76d6\uff0c-r\u9012\u5f52\u590d\u5236\n\nmv [\u6e90] [\u76ee\u7684]  # \u79fb\u52a8\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4e5f\u53ef\u7528\u4e8e\u91cd\u547d\u540d\n\nrm [-i] [-f] [-r]  # \u5220\u9664\u6587\u4ef6\u6216\u76ee\u5f55\uff0c-i\u4ea4\u4e92\u5f0f\u63d0\u793a\uff0c-f\u5f3a\u5236\u5220\u9664\uff0c-r\u9012\u5f52\u5220\u9664\n\n|  # \u7ba1\u9053\uff0c\u524d\u4e00\u6761\u6307\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\u4f5c\u4e3a\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u6807\u51c6\u8f93\u5165\n\ngrep  # \u5339\u914d\u5b57\u7b26\u4e32\uff0c-n\u663e\u793a\u884c\u53f7\uff0c-c\u8ba1\u6570\uff0c-v\u53cd\u9009\n      # \u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f [\u83dc\u9e1f](https://www.runoob.com/regexp/regexp-syntax.html)\n</code></pre>"},{"location":"Linux/#\u5e38\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u793a\u4f8b","title":"\u5e38\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u793a\u4f8b","text":"<pre><code>grep '^start' file  # \u5339\u914d\u4ee5\"start\"\u5f00\u5934\u7684\u884c\ngrep 'end$' file  # \u5339\u914d\u4ee5\"end\"\u7ed3\u5c3e\u7684\u884c\ngrep 'a.b' file  # \u5339\u914d\"a\"\u548c\"b\"\u4e4b\u95f4\u6709\u4e00\u4e2a\u4efb\u610f\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\ngrep 'a.*b' file  # \u5339\u914d\"a\"\u548c\"b\"\u4e4b\u95f4\u6709\u4efb\u610f\u6570\u91cf\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\n</code></pre>"},{"location":"Linux/#vim-\u7f16\u8f91\u5668","title":"Vim \u7f16\u8f91\u5668","text":""},{"location":"Linux/#\u666e\u901a\u6a21\u5f0f\u8f93\u5165\u6a21\u5f0f\u6309\u4e0besc","title":"\u666e\u901a\u6a21\u5f0f\uff08\u8f93\u5165\u6a21\u5f0f\u6309\u4e0bESC\uff09","text":"<pre><code>dd  # \u5220\u9664\u5f53\u524d\u884c\ndn  # \u5220\u9664\u5f53\u524d\u884c\u4ee5\u4e0bn\u884c\nu  # \u64a4\u9500\np  # \u7c98\u8d34\n</code></pre>"},{"location":"Linux/#\u547d\u4ee4\u6a21\u5f0f\u8f93\u5165\u6a21\u5f0f\u6309\u4e0besc\u5e76\u8f93\u5165\u82f1\u6587\u5b57\u7b26","title":"\u547d\u4ee4\u6a21\u5f0f\uff08\u8f93\u5165\u6a21\u5f0f\u6309\u4e0bESC\u5e76\u8f93\u5165\u82f1\u6587\u5b57\u7b26\":\"\uff09","text":"<pre><code>i  # \u5207\u6362\u5230\u8f93\u5165\u6a21\u5f0f\uff0c\u5728\u5149\u6807\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\u8f93\u5165\u6587\u672c\nx  # \u5220\u9664\u5f53\u524d\u5149\u6807\u6240\u5728\u5904\u7684\u5b57\u7b26\n:  # \u5207\u6362\u5230\u5e95\u7ebf\u547d\u4ee4\u6a21\u5f0f\uff0c\u4ee5\u5728\u6700\u5e95\u4e00\u884c\u8f93\u5165\u547d\u4ee4\na  # \u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\uff0c\u5728\u5149\u6807\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u8f93\u5165\u6587\u672c\no  # \u5728\u5f53\u524d\u884c\u7684\u4e0b\u65b9\u63d2\u5165\u4e00\u4e2a\u65b0\u884c\uff0c\u5e76\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\nO  # \u5728\u5f53\u524d\u884c\u7684\u4e0a\u65b9\u63d2\u5165\u4e00\u4e2a\u65b0\u884c\uff0c\u5e76\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\ndd  # \u526a\u5207\u5f53\u524d\u884c\nyy  # \u590d\u5236\u5f53\u524d\u884c\np  # \u7c98\u8d34\u526a\u8d34\u677f\u5185\u5bb9\u5230\u5149\u6807\u4e0b\u65b9\nP  # \u7c98\u8d34\u526a\u8d34\u677f\u5185\u5bb9\u5230\u5149\u6807\u4e0a\u65b9\nu  # \u64a4\u9500\u4e0a\u4e00\u6b21\u64cd\u4f5c\nCtrl + r  # \u91cd\u505a\u4e0a\u4e00\u6b21\u64a4\u9500\u7684\u64cd\u4f5c\n:w  # \u4fdd\u5b58\u6587\u4ef6\n:q  # \u9000\u51fa Vim \u7f16\u8f91\u5668\n:q!  # \u5f3a\u5236\u9000\u51faVim \u7f16\u8f91\u5668\uff0c\u4e0d\u4fdd\u5b58\u4fee\u6539\n</code></pre>"},{"location":"Linux/#vim-\u9ad8\u7ea7\u64cd\u4f5c","title":"Vim \u9ad8\u7ea7\u64cd\u4f5c","text":"<pre><code>:set number  # \u663e\u793a\u884c\u53f7\n:set nonumber  # \u9690\u85cf\u884c\u53f7\n:split &lt;\u6587\u4ef6\u540d&gt;  # \u6c34\u5e73\u5206\u5272\u7a97\u53e3\u5e76\u6253\u5f00\u65b0\u6587\u4ef6\n:vsplit &lt;\u6587\u4ef6\u540d&gt;  # \u5782\u76f4\u5206\u5272\u7a97\u53e3\u5e76\u6253\u5f00\u65b0\u6587\u4ef6\n:e &lt;\u6587\u4ef6\u540d&gt;  # \u6253\u5f00\u65b0\u6587\u4ef6\n:wq  # \u4fdd\u5b58\u5e76\u9000\u51fa\n</code></pre>"},{"location":"Linux/#shell-\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411","title":"Shell \u8f93\u5165/\u8f93\u51fa\u91cd\u5b9a\u5411","text":"\u547d\u4ee4 \u8bf4\u660e command &gt; file \u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 file command &lt; file \u5c06\u8f93\u5165\u91cd\u5b9a\u5411\u5230 file command &gt;&gt; file \u5c06\u8f93\u51fa\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u91cd\u5b9a\u5411\u5230 file n &gt; file \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a n \u7684\u6587\u4ef6\u91cd\u5b9a\u5411\u5230 file n &gt;&gt; file \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a n \u7684\u6587\u4ef6\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u91cd\u5b9a\u5411\u5230 file n &gt;&amp; m \u5c06\u8f93\u51fa\u6587\u4ef6 m \u548c n \u5408\u5e76 n &lt;&amp; m \u5c06\u8f93\u5165\u6587\u4ef6 m \u548c n \u5408\u5e76 &lt;&lt; tag \u5c06\u5f00\u59cb\u6807\u8bb0 tag \u548c\u7ed3\u675f\u6807\u8bb0 tag \u4e4b\u95f4\u7684\u5185\u5bb9\u4f5c\u4e3a\u8f93\u5165"},{"location":"Linux/#\u9ad8\u7ea7\u91cd\u5b9a\u5411\u64cd\u4f5c","title":"\u9ad8\u7ea7\u91cd\u5b9a\u5411\u64cd\u4f5c","text":"<pre><code>command 2&gt; file  # \u5c06\u6807\u51c6\u9519\u8bef\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\ncommand &amp;&gt; file  # \u5c06\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u90fd\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\ncommand &gt; file 2&gt;&amp;1  # \u5c06\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u90fd\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\ncommand &lt; file1 &gt; file2  # \u4ecefile1\u8bfb\u53d6\u8f93\u5165\uff0c\u5c06\u8f93\u51fa\u5199\u5165file2\n</code></pre>"},{"location":"Linux/#\u6253\u5305\u89e3\u5305\u538b\u7f29\u89e3\u538b","title":"\u6253\u5305\u89e3\u5305/\u538b\u7f29\u89e3\u538b","text":"<pre><code>bzip2  # \u538b\u7f29\u89e3\u538b\uff0c\u540e\u7f00.bz2\ngzip  # \u538b\u7f29\u89e3\u538b\uff0c\u540e\u7f00.gz\ntar  # \u6253\u5305\u89e3\u5305\uff0c\u540e\u7f00.tar\n</code></pre>"},{"location":"Linux/#\u5e38\u7528\u547d\u4ee4","title":"\u5e38\u7528\u547d\u4ee4","text":"<pre><code>tar -xvf file.tar  # \u89e3\u5305tar\u6587\u4ef6\ntar -xvzf file.tar.gz  # \u89e3\u5305\u5e76\u89e3\u538bgzip\u538b\u7f29\u7684tar\u6587\u4ef6\ntar -xvjf file.tar.bz2  # \u89e3\u5305\u5e76\u89e3\u538bbzip2\u538b\u7f29\u7684tar\u6587\u4ef6\nzip -r archive.zip folder  # \u538b\u7f29\u6587\u4ef6\u5939\u4e3azip\u6587\u4ef6\nunzip archive.zip  # \u89e3\u538bzip\u6587\u4ef6\n</code></pre>"},{"location":"Linux/#\u591a\u7528\u6237\u95f4\u901a\u4fe1","title":"\u591a\u7528\u6237\u95f4\u901a\u4fe1","text":""},{"location":"Linux/#write-\u547d\u4ee4","title":"write \u547d\u4ee4","text":"<pre><code>write &lt;\u7528\u6237\u540d&gt;  # \u5f00\u59cb\u5411\u6307\u5b9a\u7528\u6237\u53d1\u9001\u6d88\u606f\nCtrl+D  # \u7ed3\u675f\u6d88\u606f\u53d1\u9001\n</code></pre>"},{"location":"Linux/#mail-\u547d\u4ee4","title":"mail \u547d\u4ee4","text":"<pre><code>mail &lt;\u7528\u6237\u540d&gt;  # \u53d1\u9001\u90ae\u4ef6\u7ed9\u6307\u5b9a\u7528\u6237\nSubject: &lt;\u4e3b\u9898&gt;  # \u8f93\u5165\u90ae\u4ef6\u4e3b\u9898\n&lt;\u90ae\u4ef6\u5185\u5bb9&gt;  # \u8f93\u5165\u90ae\u4ef6\u5185\u5bb9\nCtrl+D  # \u7ed3\u675f\u90ae\u4ef6\u8f93\u5165\n</code></pre>"},{"location":"Linux/#\u6587\u4ef6\u94fe\u63a5","title":"\u6587\u4ef6\u94fe\u63a5","text":"<pre><code>ln [\u53c2\u6570][\u6e90\u6587\u4ef6\u6216\u76ee\u5f55][\u76ee\u6807\u6587\u4ef6\u6216\u76ee\u5f55]\n</code></pre>"},{"location":"Linux/#\u8f6f\u94fe\u63a5","title":"\u8f6f\u94fe\u63a5","text":"<ul> <li>\u4ee5\u8def\u5f84\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u7c7b\u4f3c\u4e8eWindows\u4e2d\u7684\u5feb\u6377\u65b9\u5f0f\u3002</li> <li>\u53ef\u4ee5\u8de8\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li>\u53ef\u4ee5\u5bf9\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u540d\u6216\u76ee\u5f55\u8fdb\u884c\u94fe\u63a5\u3002</li> </ul>"},{"location":"Linux/#\u786c\u94fe\u63a5","title":"\u786c\u94fe\u63a5","text":"<ul> <li>\u4ee5\u6587\u4ef6\u526f\u672c\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u4f46\u4e0d\u5360\u7528\u5b9e\u9645\u7a7a\u95f4\u3002</li> <li>\u4e0d\u5141\u8bb8\u7ed9\u76ee\u5f55\u521b\u5efa\u786c\u94fe\u63a5\u3002</li> <li>\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u521b\u5efa\u3002</li> </ul>"},{"location":"Linux/#\u5e38\u7528\u53c2\u6570","title":"\u5e38\u7528\u53c2\u6570","text":"<pre><code>-s  # \u521b\u5efa\u8f6f\u94fe\u63a5\n-v  # \u663e\u793a\u8be6\u7ec6\u7684\u5904\u7406\u8fc7\u7a0b\n</code></pre> <p>\u5efa\u8bae\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u521b\u5efa\u6587\u4ef6\u94fe\u63a5\uff0c\u907f\u514d\u79fb\u52a8\u6587\u4ef6\u540e\u94fe\u63a5\u5931\u6548\u3002</p>"},{"location":"Linux/#\u540e\u53f0\u4efb\u52a1","title":"\u540e\u53f0\u4efb\u52a1","text":"<pre><code>[command] &amp;  # \u5c06\u547d\u4ee4\u653e\u5230\u540e\u53f0\u6267\u884c\n\njobs  # \u67e5\u770b\u540e\u53f0\u4efb\u52a1\n\nkill %[jobs_id]  # \u7ed3\u675f\u540e\u53f0\u4efb\u52a1\n</code></pre>"},{"location":"Linux/#c\u7a0b\u5e8f\u7f16\u8bd1makefile\u7f16\u5199","title":"C\u7a0b\u5e8f\u7f16\u8bd1\u3001makefile\u7f16\u5199","text":""},{"location":"Linux/#\u7f16\u8bd1c\u7a0b\u5e8f","title":"\u7f16\u8bd1C\u7a0b\u5e8f","text":"<pre><code>gcc -o output_file source_file.c  # \u7f16\u8bd1C\u7a0b\u5e8f\n</code></pre>"},{"location":"Linux/#makefile-\u793a\u4f8b","title":"Makefile \u793a\u4f8b","text":"<pre><code>CC = gcc\nCFLAGS = -Wall -g\n\nall: program\n\nprogram: main.o utils.o\n    $(CC) $(CFLAGS) -o program main.o utils.o\n\nmain.o: main.c\n    $(CC) $(CFLAGS) -c main.c\n\nutils.o: utils.c\n    $(CC) $(CFLAGS) -c utils.c\n\nclean:\n    rm -f *.o program\n</code></pre>"},{"location":"Zookeeper/","title":"Zookeeper","text":"<p>[!Tip]</p> <p>\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u534f\u8c03\u670d\u52a1\u6838\u5fc3</p> <p>ZooKeeper\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u3001\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u534f\u8c03\u670d\u52a1\uff0c\u5b83\u65e8\u5728\u4e3a\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u4e00\u81f4\u6027\u670d\u52a1\uff0c\u5305\u62ec\u914d\u7f6e\u7ef4\u62a4\u3001\u57df\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u540c\u6b65\u3001\u7ec4\u670d\u52a1\u7b49\u6838\u5fc3\u529f\u80fd</p>"},{"location":"Zookeeper/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>docker\u5b89\u88c5</p> <pre><code>docker run -d \\\n--name zookeeper \\\n--privileged=true \\\n-p 2181:2181 \\\n-v /docker/zookeeper/data:/data \\\n-v /docker/zookeeper/conf:/conf \\\n-v /docker/zookeeper/logs:/datalog \\\nzookeeper\n</code></pre>"},{"location":"Zookeeper/#\u6570\u636e\u6a21\u578b","title":"\u6570\u636e\u6a21\u578b","text":"<p>ZooKeeper\u91c7\u7528\u5c42\u6b21\u5316\u7684\u547d\u540d\u7a7a\u95f4\u4f5c\u4e3a\u5176\u6570\u636e\u6a21\u578b\uff0c\u7c7b\u4f3c\u4e8e\u6807\u51c6\u7684\u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784</p> <ol> <li>ZNode\u7ed3\u6784\uff1a\u6bcf\u4e2a\u5b50\u76ee\u5f55\u9879\u79f0\u4e3aznode\uff0c\u88ab\u5b83\u6240\u5728\u7684\u8def\u5f84\u552f\u4e00\u6807\u8bc6\u3002\u6bcf\u4e2aznode\u75313\u90e8\u5206\u7ec4\u6210\uff1astat(\u72b6\u6001\u4fe1\u606f)\u3001data(\u5173\u8054\u6570\u636e)\u548cchildren(\u5b50\u8282\u70b9\u5217\u8868)\u3002</li> <li>ZNode\u7c7b\u578b\uff1a</li> <li>\u6301\u4e45\u8282\u70b9(Persistent)\uff1a\u4e00\u65e6\u88ab\u521b\u5efa\uff0c\u4fbf\u4e0d\u4f1a\u610f\u5916\u4e22\u5931\uff0c\u5373\u4f7f\u670d\u52a1\u5668\u5168\u90e8\u91cd\u542f\u4e5f\u4f9d\u7136\u5b58\u5728</li> <li>\u4e34\u65f6\u8282\u70b9(Ephemeral)\uff1a\u5728\u521b\u5efa\u5b83\u7684\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u95f4\u7684Session\u7ed3\u675f\u65f6\u81ea\u52a8\u88ab\u5220\u9664</li> <li>\u987a\u5e8f\u8282\u70b9(Sequence)\uff1a\u521b\u5efa\u51fa\u7684\u8282\u70b9\u540d\u5728\u6307\u5b9a\u540d\u79f0\u540e\u5e26\u670910\u4f4d\u5341\u8fdb\u5236\u6570\u7684\u5e8f\u53f7</li> </ol>"},{"location":"Zookeeper/#\u5e38\u89c1\u547d\u4ee4","title":"\u5e38\u89c1\u547d\u4ee4","text":"<p>\u5e38\u7528\u547d\u4ee4\u5305\u62ec</p> <ul> <li><code>create /path data</code>\uff1a\u521b\u5efa\u8282\u70b9</li> <li>\u9ed8\u8ba4\u521b\u5efa\u6301\u4e45\u8282\u70b9</li> <li><code>-e</code> \u4e34\u65f6\u8282\u70b9</li> <li><code>-s</code> \u987a\u5e8f\u8282\u70b9</li> <li><code>get /path</code>\uff1a\u83b7\u53d6\u8282\u70b9\u6570\u636e\u548c\u72b6\u6001</li> <li><code>set /path data</code>\uff1a\u4fee\u6539\u8282\u70b9\u6570\u636e</li> <li><code>ls /path</code>\uff1a\u5217\u51fa\u5b50\u8282\u70b9</li> <li><code>-s</code> \u8282\u70b9\u8be6\u7ec6\u4fe1\u606f</li> <li><code>delete /path</code>\uff1a\u5220\u9664\u8282\u70b9</li> </ul>"},{"location":"Zookeeper/#java-apicurator","title":"Java API(Curator)","text":""},{"location":"Zookeeper/#\u5f15\u5165\u4f9d\u8d56","title":"\u5f15\u5165\u4f9d\u8d56","text":"<pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;\n            &lt;version&gt;4.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;\n            &lt;version&gt;4.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre>"},{"location":"Zookeeper/#\u521b\u5efa\u5ba2\u6237\u7aef\u4e24\u79cd\u65b9\u5f0f","title":"\u521b\u5efa\u5ba2\u6237\u7aef\uff08\u4e24\u79cd\u65b9\u5f0f\uff09","text":"<pre><code>    /**\n     * \u6d4b\u8bd5\u65b9\u6cd5\uff1a\u6f14\u793a\u4e24\u79cd\u65b9\u5f0f\u521b\u5efa CuratorFramework \u5ba2\u6237\u7aef\u5e76\u8fde\u63a5 Zookeeper\n     */\n    @Test\n    public void testConnect() {\n        // Zookeeper \u670d\u52a1\u5730\u5740\n        String host = \"localhost:2181\";\n        // \u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n        int sessionTimeoutMs = 5000;\n        // \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n        int connectionTimeoutMs = 5000;\n        // \u91cd\u8bd5\u7b56\u7565\uff1a\u521d\u59cb\u7b49\u5f853\u79d2\uff0c\u6700\u591a\u91cd\u8bd510\u6b21\n        RetryPolicy retryPolicy = new ExponentialBackoffRetry(3000, 10);\n\n        // \u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528 newClient \u521b\u5efa\u5ba2\u6237\u7aef\n        CuratorFramework client1 = CuratorFrameworkFactory.newClient(\n                host,\n                sessionTimeoutMs,\n                connectionTimeoutMs,\n                retryPolicy\n        );\n        client1.start(); // \u542f\u52a8\u5ba2\u6237\u7aef\n        logger.info(client1.toString()); // \u6253\u5370\u5ba2\u6237\u7aef\u4fe1\u606f\n\n        // \u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528 builder \u521b\u5efa\u5ba2\u6237\u7aef\uff0c\u5e76\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\n        CuratorFramework client2 = CuratorFrameworkFactory.builder()\n                .connectString(host)\n                .sessionTimeoutMs(sessionTimeoutMs)\n                .connectionTimeoutMs(connectionTimeoutMs)\n                .retryPolicy(retryPolicy)\n                .namespace(\"ysh\") // \u8bbe\u7f6e\u547d\u540d\u7a7a\u95f4\n                .build();\n        client2.start(); // \u542f\u52a8\u5ba2\u6237\u7aef\n        logger.info(client2.toString()); // \u6253\u5370\u5ba2\u6237\u7aef\u4fe1\u606f\n    }\n</code></pre>"},{"location":"Zookeeper/#\u521b\u5efa\u8282\u70b9","title":"\u521b\u5efa\u8282\u70b9","text":"<pre><code>    @Test\n    public void testCreate() {\n        try {\n            String path = client\n                    .create()\n                    .withMode(CreateMode.EPHEMERAL) // \u8bbe\u7f6e\u8282\u70b9\u7c7b\u578b\u4e3a\u4e34\u65f6\u8282\u70b9\n                    .forPath(\"/app\", \"hello\".getBytes()); // \u521b\u5efa\u8282\u70b9 /app \u5e76\u8bbe\u7f6e\u6570\u636e\u4e3a \"hello\"\n            logger.info(path);\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n</code></pre> <p>[!Tip]</p> <p>\u9012\u5f52\u521b\u5efa\u7236\u8282\u70b9</p> <pre><code>client.create().creatingParentsIfNeeded().forPath(\"/app/parent/child\");\n</code></pre>"},{"location":"Zookeeper/#\u67e5\u8be2\u8282\u70b9","title":"\u67e5\u8be2\u8282\u70b9","text":"<pre><code>            // \u83b7\u53d6\u8282\u70b9 /app \u7684\u6570\u636e\n            byte[] data = client.getData().forPath(\"/app\");\n            String s = new String(data, StandardCharsets.UTF_8);\n            logger.info(s);\n\n            // \u83b7\u53d6\u8282\u70b9 /app \u7684\u5b50\u8282\u70b9\u5217\u8868\n            List&lt;String&gt; children = client.getChildren().forPath(\"/app\");\n            logger.info(children.toString());\n\n            // \u83b7\u53d6\u8282\u70b9 /app \u7684\u72b6\u6001\u4fe1\u606f\n            Stat stat = new Stat();\n            client.getData().storingStatIn(stat).forPath(\"/app\");\n            logger.info(stat.toString());\n</code></pre>"},{"location":"Zookeeper/#\u4fee\u6539\u8282\u70b9","title":"\u4fee\u6539\u8282\u70b9","text":"<pre><code>    @Test\n    public void testSet() throws Exception {\n        // \u4fee\u6539\u8282\u70b9 /app \u7684\u6570\u636e\u4e3a \"world\"\n        // !!!\u4f7f\u7528CAS\u65b9\u6cd5\uff0c\u6bd4\u8f83\u7248\u672c\u53f7\uff0c\u786e\u4fdd\u6570\u636e\u4e00\u81f4\u6027\n        Stat stat = new Stat();\n        client.getData().storingStatIn(stat).forPath(\"/app\");\n        int version = stat.getVersion();\n        client.setData().withVersion(version).forPath(\"/app\", \"world\".getBytes(StandardCharsets.UTF_8));\n    }\n</code></pre>"},{"location":"Zookeeper/#\u5220\u9664\u8282\u70b9","title":"\u5220\u9664\u8282\u70b9","text":"<pre><code>    @Test\n    public void testDelete() throws Exception {\n        // \u5220\u9664\u5355\u4e2a\u8282\u70b9\n        client.delete().forPath(\"/app/parent/child\");\n\n        // \u5220\u9664\u8282\u70b9\u53ca\u5176\u6240\u6709\u5b50\u8282\u70b9\n        client.delete().deletingChildrenIfNeeded().forPath(\"/app\");\n\n        // \u4fdd\u8bc1\u5220\u9664\u673a\u5236\uff0c\u5b83\u786e\u4fdd\u8282\u70b9\u4e00\u5b9a\u4f1a\u88ab\u5220\u9664\n        client.delete().guaranteed().forPath(\"/app\");\n\n        // \u5220\u9664\u8282\u70b9\u540e\u56de\u8c03\n        client.delete().inBackground(new BackgroundCallback() {\n            @Override\n            public void processResult(CuratorFramework curatorFramework, CuratorEvent curatorEvent) {\n                logger.info(curatorEvent.toString());\n            }\n        }).forPath(\"/app\");\n    }\n</code></pre>"},{"location":"Zookeeper/#watch\u4e8b\u4ef6\u76d1\u542c","title":"Watch\u4e8b\u4ef6\u76d1\u542c","text":"<p>[!Tip]</p> <p>ZooKeeper\u7684\u4e8b\u4ef6\u76d1\u542c\u673a\u5236(Watches)\u662f\u5176\u6838\u5fc3\u7279\u6027\u4e4b\u4e00\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u76d1\u63a7ZNode\u7684\u53d8\u5316\u5e76\u53ca\u65f6\u83b7\u5f97\u901a\u77e5\u3002\u8fd9\u79cd\u673a\u5236\u4e3a\u5206\u5e03\u5f0f\u7cfb\u7edf\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u6570\u636e\u53d8\u66f4\u901a\u77e5\u65b9\u5f0f\u3002</p> <ol> <li>\u4e00\u6b21\u6027\u89e6\u53d1\uff1aWatch\u662f\u4e00\u6b21\u6027\u7684\uff0c\u89e6\u53d1\u540e\u5373\u5931\u6548\uff0c\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e</li> <li>\u5f02\u6b65\u901a\u77e5\uff1a\u4e8b\u4ef6\u901a\u77e5\u901a\u8fc7\u56de\u8c03\u65b9\u5f0f\u5f02\u6b65\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef</li> <li>\u4e8b\u4ef6\u6709\u5e8f\u6027\uff1a\u5ba2\u6237\u7aef\u770b\u5230\u7684\u4e8b\u4ef6\u987a\u5e8f\u4e0eZooKeeper\u670d\u52a1\u7aef\u53d1\u751f\u7684\u987a\u5e8f\u4e00\u81f4</li> <li>\u5148\u6ce8\u518c\u540e\u89e6\u53d1\uff1a\u5fc5\u987b\u5148\u8bbe\u7f6eWatch\uff0c\u624d\u80fd\u6536\u5230\u540e\u7eed\u53d8\u66f4\u901a\u77e5</li> <li>\u4ec5\u72b6\u6001\u53d8\u5316\uff1a\u4ec5\u5f53ZNode\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\u624d\u4f1a\u89e6\u53d1\uff0c\u6570\u636e\u5185\u5bb9\u4e0d\u53d8\u4f46\u7248\u672c\u53f7\u53d8\u5316\u4e5f\u4f1a\u89e6\u53d1</li> </ol> <p>ZooKeeper\u5b9a\u4e49\u4e86\u4ee5\u4e0b\u51e0\u79cd\u4e8b\u4ef6\u7c7b\u578b\uff1a</p> \u4e8b\u4ef6\u7c7b\u578b \u89e6\u53d1\u6761\u4ef6 \u5bf9\u5e94\u65b9\u6cd5 NodeCreated \u8282\u70b9\u88ab\u521b\u5efa exists() NodeDeleted \u8282\u70b9\u88ab\u5220\u9664 exists() / getData() / getChildren() NodeDataChanged \u8282\u70b9\u6570\u636e\u53d8\u66f4 exists() / getData() NodeChildrenChanged \u5b50\u8282\u70b9\u5217\u8868\u53d8\u66f4 getChildren()"},{"location":"Zookeeper/#nodecache---\u76d1\u63a7\u5355\u4e2a\u8282\u70b9","title":"NodeCache - \u76d1\u63a7\u5355\u4e2a\u8282\u70b9","text":"<p>NodeCache\u7528\u4e8e\u76d1\u63a7\u5355\u4e2a\u8282\u70b9\u7684\u6570\u636e\u53d8\u5316\uff08\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\uff09\uff1a</p> <pre><code>    @Test\n    public void testNodeCache() throws Exception {\n        // \u521b\u5efaNodeCache\u5bf9\u8c61\n        NodeCache nodeCache = new NodeCache(client, \"/app\");\n        // \u6ce8\u518c\u76d1\u542c\n        nodeCache.getListenable().addListener(new NodeCacheListener() {\n            @Override\n            public void nodeChanged() throws Exception {\n                logger.info(\"\u8282\u70b9\u72b6\u6001\u6539\u53d8\");\n                byte[] data = nodeCache.getCurrentData().getData();\n                logger.info(new String(data, StandardCharsets.UTF_8));\n            }\n        });\n        // \u5f00\u59cb\u76d1\u542c\n        nodeCache.start();\n    }\n</code></pre>"},{"location":"Zookeeper/#pathchildrencache---\u76d1\u63a7\u5b50\u8282\u70b9","title":"PathChildrenCache - \u76d1\u63a7\u5b50\u8282\u70b9","text":"<p>PathChildrenCache\u7528\u4e8e\u76d1\u63a7\u6307\u5b9a\u8282\u70b9\u4e0b\u5b50\u8282\u70b9\u7684\u53d8\u5316\uff08\u4e0d\u5305\u62ec\u8be5\u8282\u70b9\u672c\u8eab\uff09\uff1a</p> <pre><code>    @Test\n    public void testPathChildrenCache() throws Exception {\n        // \u521b\u5efa PathChildrenCache \u5bf9\u8c61\uff0c\u76d1\u542c /app \u8def\u5f84\u4e0b\u7684\u5b50\u8282\u70b9\u53d8\u5316\n        PathChildrenCache pathChildrenCache = new PathChildrenCache(client, \"/app\", true);\n        // \u6ce8\u518c\u76d1\u542c\u5668\uff0c\u5904\u7406\u5b50\u8282\u70b9\u4e8b\u4ef6\n        pathChildrenCache.getListenable().addListener(new PathChildrenCacheListener() {\n            @Override\n            public void childEvent(CuratorFramework curatorFramework, PathChildrenCacheEvent pathChildrenCacheEvent) throws Exception {\n                logger.info(\"\u5b50\u8282\u70b9\u4e8b\u4ef6: {}\", pathChildrenCacheEvent.toString());\n                switch (pathChildrenCacheEvent.getType()) {\n                    case CHILD_ADDED:\n                        logger.info(\"\u5b50\u8282\u70b9\u6dfb\u52a0: {}\", pathChildrenCacheEvent.getData().getPath());\n                        break;\n                    case CHILD_UPDATED:\n                        logger.info(\"\u5b50\u8282\u70b9\u66f4\u65b0: {}\", pathChildrenCacheEvent.getData().getPath());\n                        byte[] data = pathChildrenCacheEvent.getData().getData();\n                        logger.info(\"\u65b0\u6570\u636e: {}\", new String(data, StandardCharsets.UTF_8));\n                        break;\n                    case CHILD_REMOVED:\n                        logger.info(\"\u5b50\u8282\u70b9\u5220\u9664: {}\", pathChildrenCacheEvent.getData().getPath());\n                        break;\n                    default:\n                        break;\n                }\n            }\n        });\n        // \u542f\u52a8 PathChildrenCache\uff0c\u5f00\u59cb\u76d1\u542c\u5b50\u8282\u70b9\u53d8\u5316\n        pathChildrenCache.start();\n    }\n</code></pre>"},{"location":"Zookeeper/#treecache---\u7efc\u5408\u76d1\u63a7","title":"TreeCache - \u7efc\u5408\u76d1\u63a7","text":"<p>TreeCache\u662fNodeCache\u548cPathChildrenCache\u7684\u7ec4\u5408\uff0c\u53ef\u4ee5\u76d1\u63a7\u6574\u4e2a\u5b50\u6811\u7684\u53d8\u5316\uff1a</p> <pre><code>    @Test\n    public void testTreeCache() throws Exception {\n        // \u521b\u5efa TreeCache \u5bf9\u8c61\uff0c\u76d1\u542c\u6574\u4e2a\u6811\u5f62\u7ed3\u6784\u7684\u53d8\u5316\n        TreeCache treeCache = new TreeCache(client, \"/app\");\n        // \u6ce8\u518c\u76d1\u542c\u5668\uff0c\u5904\u7406\u6811\u5f62\u7ed3\u6784\u4e8b\u4ef6\n        treeCache.getListenable().addListener(new TreeCacheListener() {\n            @Override\n            public void childEvent(CuratorFramework curatorFramework, TreeCacheEvent treeCacheEvent) throws Exception {\n                logger.info(\"\u6811\u5f62\u7ed3\u6784\u4e8b\u4ef6: {}\", treeCacheEvent.toString());\n            }\n        });\n        // \u542f\u52a8 TreeCache\uff0c\u5f00\u59cb\u76d1\u542c\u6811\u5f62\u7ed3\u6784\u53d8\u5316\n        treeCache.start();\n    }\n</code></pre>"},{"location":"Zookeeper/#\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0","title":"\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0","text":"<p>[!Tip]</p> <p>\u5206\u5e03\u5f0f\u9501\u662f\u4e00\u79cd\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u73af\u5883\u4e0b\uff0c\u901a\u8fc7\u591a\u4e2a\u8282\u70b9\u5bf9\u5171\u4eab\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u7684\u540c\u6b65\u673a\u5236\u3002\u5b83\u7684\u4e3b\u8981\u76ee\u7684\u662f\u9632\u6b62\u591a\u4e2a\u8282\u70b9\u540c\u65f6\u64cd\u4f5c\u540c\u4e00\u4efd\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u6027\u3002\u4e0e\u5355\u673a\u73af\u5883\u4e0b\u7684\u9501\u4e0d\u540c\uff0c\u5206\u5e03\u5f0f\u9501\u9700\u8981\u8de8\u8d8a\u591a\u4e2a\u8282\u70b9\uff0c\u786e\u4fdd\u5728\u6574\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u8303\u56f4\u5185\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u4e92\u65a5\u8bbf\u95ee\u3002</p> <p>\u5728\u5355\u673a\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8bed\u8a00\u63d0\u4f9b\u7684\u540c\u6b65\u673a\u5236\uff08\u5982Java\u7684synchronized\u5173\u952e\u5b57\u6216ReentrantLock\u7c7b\uff09\u6765\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u7684\u540c\u6b65\u3002\u4f46\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u591a\u4e2a\u7269\u7406\u6216\u865a\u62df\u8282\u70b9\u4e0a\uff0c\u4f20\u7edf\u7684\u672c\u5730\u9501\u673a\u5236\u5df2\u65e0\u6cd5\u6ee1\u8db3\u8de8\u8282\u70b9\u7684\u540c\u6b65\u9700\u6c42</p> <pre><code>graph\n\u83b7\u53d6\u9501 --&gt; \u521b\u5efa\u8282\u70b9\n\u91ca\u653e\u9501 --&gt; \u5220\u9664\u8282\u70b9\n</code></pre> <ol> <li>\u83b7\u53d6\u9501\u65f6\uff0c\u5728lock\u8282\u70b9\u4e0b\u521b\u5efa\u4e34\u65f6\u987a\u5e8f\u8282\u70b9</li> </ol> <p>\u4e34\u65f6\u8282\u70b9\uff1a\u9632\u6b62\u6b7b\u9501\uff0c\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u540e\u81ea\u52a8\u5220\u9664</p> <p>\u987a\u5e8f\u8282\u70b9\uff1a\u6839\u636e\u987a\u5e8f\u6765\u786e\u5b9a\u5f53\u524d\u9501\u7684\u6301\u6709\u8005\uff08\u5982\u5e8f\u53f7\u6700\u5c0f\u7684\u8282\u70b9\u9501\u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u6301\u6709\u9501\uff09</p> <ol> <li>\u83b7\u53d6lock\u4e0b\u7684\u6240\u6709\u5b50\u8282\u70b9\uff0c\u5e8f\u53f7\u6700\u5c0f\u8005\u6210\u529f\u83b7\u5f97\u9501</li> <li>\u7ade\u4e89\u5931\u8d25\u7684\u5ba2\u6237\u7aef\u5411\u6301\u6709\u9501\u7684\u8282\u70b9\u6ce8\u518c\u76d1\u542c\u5668\u76d1\u542c\u5220\u9664\u4e8b\u4ef6\uff0c\u51c6\u5907\u518d\u6b21\u7ade\u4e89</li> <li>\u91ca\u653e\u9501\u65f6\uff0c\u5220\u9664\u5ba2\u6237\u7aef\u5bf9\u5e94\u8282\u70b9\uff0c\u76d1\u542c\u5668\u901a\u77e5\u5176\u4f59\u8282\u70b9\u7ade\u4e89\u9501\uff08\u56de\u5230\u6b65\u9aa42.\uff09</li> </ol> <p><code>Curator</code>\u5206\u5e03\u5f0f\u9501API</p> <pre><code>// \u521b\u5efa\u9501\nInterProcessMutex lock = new InterProcessMutex(client, \"/locks/my_lock\");\n\ntry {\n    // \u83b7\u53d6\u9501\uff08\u5e26\u8d85\u65f6\uff09\n    if (lock.acquire(10, TimeUnit.SECONDS)) {\n        try {\n            // \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n            System.out.println(\"\u83b7\u53d6\u9501\u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1\u903b\u8f91\");\n        } finally {\n            // \u91ca\u653e\u9501\n            lock.release();\n        }\n    }\n} catch (Exception e) {\n    e.printStackTrace();\n}\n</code></pre> <p>InterProcessMutex (\u53ef\u91cd\u5165\u4e92\u65a5\u9501) vs InterProcessSemaphoreMutex (\u4e0d\u53ef\u91cd\u5165\u4e92\u65a5\u9501)</p> \u7279\u6027 InterProcessMutex InterProcessSemaphoreMutex \u53ef\u91cd\u5165\u6027 \u2705 \u652f\u6301 \u274c \u4e0d\u652f\u6301 \u9501\u83b7\u53d6\u987a\u5e8f \u516c\u5e73(FIFO) \u516c\u5e73(FIFO) \u5b9e\u73b0\u673a\u5236 \u4e34\u65f6\u987a\u5e8f\u8282\u70b9 \u4e34\u65f6\u8282\u70b9 \u9002\u7528\u573a\u666f \u9700\u8981\u91cd\u5165\u7684\u573a\u666f \u7b80\u5355\u4e92\u65a5\u573a\u666f \u6027\u80fd \u7a0d\u4f4e \u7a0d\u9ad8 \u6b7b\u9501\u98ce\u9669 \u4f4e \u4f4e <p>InterProcessReadWriteLock (\u8bfb\u5199\u9501)</p> \u7279\u6027 \u8bfb\u9501 \u5199\u9501 \u5e76\u53d1\u6027 \u591a\u4e2a\u8bfb\u9501\u53ef\u540c\u65f6\u83b7\u53d6 \u72ec\u5360\uff0c\u4e0e\u5176\u4ed6\u9501\u4e92\u65a5 \u5347\u7ea7/\u964d\u7ea7 \u274c \u4e0d\u652f\u6301 \u274c \u4e0d\u652f\u6301 \u516c\u5e73\u6027 \u516c\u5e73(FIFO) \u516c\u5e73(FIFO) \u9002\u7528\u573a\u666f \u8bfb\u591a\u5199\u5c11 \u5199\u64cd\u4f5c <p>InterProcessMultiLock (\u591a\u91cd\u9501)</p> \u7279\u6027 \u8bf4\u660e \u539f\u5b50\u6027 \u8981\u4e48\u5168\u90e8\u83b7\u53d6\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25 \u7528\u9014 \u9700\u8981\u540c\u65f6\u83b7\u53d6\u591a\u4e2a\u8d44\u6e90\u7684\u573a\u666f \u98ce\u9669 \u5bb9\u6613\u9020\u6210\u6b7b\u9501\uff0c\u9700\u8981\u8c28\u614e\u8bbe\u8ba1\u83b7\u53d6\u987a\u5e8f \u6027\u80fd\u5f71\u54cd \u83b7\u53d6\u591a\u4e2a\u9501\u4f1a\u589e\u52a0\u5ef6\u8fdf <p>InterProcessSemaphore (\u4fe1\u53f7\u91cf)</p> \u7279\u6027 \u8bf4\u660e \u9650\u5236\u5e76\u53d1\u6570 \u53ef\u4ee5\u63a7\u5236\u540c\u65f6\u8bbf\u95ee\u8d44\u6e90\u7684\u7ebf\u7a0b\u6570\u91cf \u975e\u516c\u5e73\u6027 \u9ed8\u8ba4\u975e\u516c\u5e73\uff0c\u53ef\u901a\u8fc7\u914d\u7f6e\u5b9e\u73b0\u516c\u5e73 \u9002\u7528\u573a\u666f \u9650\u6d41\u3001\u8d44\u6e90\u6c60\u7ba1\u7406\u7b49"},{"location":"Zookeeper/#\u96c6\u7fa4","title":"\u96c6\u7fa4","text":"<p>[!Tip]</p> <p>\u7531\u591a\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u7ec4\u6210\uff0c\u901a\u5e38\u5efa\u8bae\u90e8\u7f72\u5947\u6570\u4e2a\u8282\u70b9\uff083\u30015\u30017\u7b49\uff09\uff0c\u4ee5\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u548c\u5bb9\u9519\u80fd\u529b\u3002</p>"},{"location":"Zookeeper/#\u96c6\u7fa4\u89d2\u8272","title":"\u96c6\u7fa4\u89d2\u8272","text":"<ul> <li>Leader\uff1a\u8d1f\u8d23\u5904\u7406\u6240\u6709\u5199\u8bf7\u6c42\u548c\u4e8b\u52a1\u6027\u64cd\u4f5c\uff0c\u96c6\u7fa4\u4e2d\u53ea\u6709\u4e00\u4e2aLeader</li> <li>Follower\uff1a\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u53c2\u4e0eLeader\u9009\u4e3e\u548c\u4e8b\u52a1\u63d0\u6848\u6295\u7968</li> <li>Observer\uff08\u53ef\u9009\uff09\uff1a\u6269\u5c55\u8bfb\u80fd\u529b\uff0c\u4e0d\u53c2\u4e0e\u6295\u7968\uff0c\u53ea\u540c\u6b65\u6570\u636e</li> </ul>"},{"location":"Zookeeper/#\u96c6\u7fa4\u642d\u5efa\u8be6\u7ec6\u6b65\u9aa4","title":"\u96c6\u7fa4\u642d\u5efa\u8be6\u7ec6\u6b65\u9aa4","text":""},{"location":"Zookeeper/#1-\u73af\u5883\u51c6\u5907","title":"1. \u73af\u5883\u51c6\u5907","text":"<p>\u8981\u6c42\uff1a</p> <ul> <li>JDK 8\u621611\uff08\u63a8\u8350OpenJDK\uff09</li> <li>ZooKeeper 3.5+\uff08\u63a8\u83503.6.x\u7a33\u5b9a\u7248\uff09</li> </ul>"},{"location":"Zookeeper/#2-\u5b89\u88c5zookeeper\u6240\u6709\u8282\u70b9","title":"2. \u5b89\u88c5ZooKeeper\uff08\u6240\u6709\u8282\u70b9\uff09","text":"<pre><code># 1. \u4e0b\u8f7d\u5e76\u89e3\u538b\uff08\u4ee53.6.3\u4e3a\u4f8b\uff09\nwget https://downloads.apache.org/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3-bin.tar.gz\ntar -zxvf apache-zookeeper-3.6.3-bin.tar.gz\nmv apache-zookeeper-3.6.3-bin /opt/zookeeper\n\n# 2. \u521b\u5efa\u6570\u636e\u76ee\u5f55\nmkdir -p /var/lib/zookeeper/data\nmkdir -p /var/lib/zookeeper/logs\n\n# 3. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\necho 'export ZOOKEEPER_HOME=/opt/zookeeper' &gt;&gt; /etc/profile\necho 'export PATH=$PATH:$ZOOKEEPER_HOME/bin' &gt;&gt; /etc/profile\nsource /etc/profile\n</code></pre>"},{"location":"Zookeeper/#3-\u914d\u7f6e\u96c6\u7fa4\u6240\u6709\u8282\u70b9","title":"3. \u914d\u7f6e\u96c6\u7fa4\uff08\u6240\u6709\u8282\u70b9\uff09","text":"<p>\u521b\u5efa\u914d\u7f6e\u6587\u4ef6</p> <pre><code>cd /opt/zookeeper/conf\ncp zoo_sample.cfg zoo.cfg\n</code></pre> <p>\u7f16\u8f91zoo.cfg\uff08\u793a\u4f8b\u914d\u7f6e\uff09</p> <pre><code>tickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/var/lib/zookeeper/data\ndataLogDir=/var/lib/zookeeper/logs\nclientPort=2181\nmaxClientCnxns=60\nautopurge.snapRetainCount=3\nautopurge.purgeInterval=24\n\n# \u96c6\u7fa4\u914d\u7f6e\uff08\u6240\u6709\u8282\u70b9\u76f8\u540c\uff09\nserver.1=zk1.example.com:2888:3888\nserver.2=zk2.example.com:2888:3888\nserver.3=zk3.example.com:2888:3888\n</code></pre> <p>\u521b\u5efamyid\u6587\u4ef6\uff08\u6bcf\u4e2a\u8282\u70b9\u4e0d\u540c\uff09</p> <pre><code># \u5728\u8282\u70b91\u6267\u884c\necho \"1\" &gt; /var/lib/zookeeper/data/myid\n\n# \u5728\u8282\u70b92\u6267\u884c\necho \"2\" &gt; /var/lib/zookeeper/data/myid\n\n# \u5728\u8282\u70b93\u6267\u884c\necho \"3\" &gt; /var/lib/zookeeper/data/myid\n</code></pre>"},{"location":"Zookeeper/#4-\u542f\u52a8\u96c6\u7fa4","title":"4. \u542f\u52a8\u96c6\u7fa4","text":"<p>\u6309\u987a\u5e8f\u542f\u52a8\u8282\u70b9\uff08\u5148\u542f\u52a81\uff0c\u518d2\uff0c\u6700\u540e3\uff09</p> <pre><code># \u5728\u6bcf\u4e2a\u8282\u70b9\u6267\u884c\n/opt/zookeeper/bin/zkServer.sh start\n</code></pre> <p>\u9a8c\u8bc1\u542f\u52a8\u72b6\u6001</p> <pre><code># \u68c0\u67e5\u72b6\u6001\uff08\u4f1a\u663e\u793aMode: leader\u6216follower\uff09\n/opt/zookeeper/bin/zkServer.sh status\n\n# \u56db\u5b57\u547d\u4ee4\u68c0\u67e5\necho stat | nc localhost 2181\n</code></pre>"},{"location":"Zookeeper/#5-\u96c6\u7fa4\u9a8c\u8bc1\u6d4b\u8bd5","title":"5. \u96c6\u7fa4\u9a8c\u8bc1\u6d4b\u8bd5","text":"<p>\u57fa\u672c\u529f\u80fd\u6d4b\u8bd5</p> <pre><code># \u8fde\u63a5\u5230\u4efb\u610f\u8282\u70b9\n/opt/zookeeper/bin/zkCli.sh -server localhost:2181\n\n# \u5728ZooKeeper\u5ba2\u6237\u7aef\u4e2d\u6267\u884c\n[zk: localhost:2181(CONNECTED) 0] create /test \"hello\"\n[zk: localhost:2181(CONNECTED) 1] get /test\n[zk: localhost:2181(CONNECTED) 2] delete /test\n</code></pre> <p>\u5bb9\u707e\u6d4b\u8bd5</p> <ol> <li>\u505c\u6b62Leader\u8282\u70b9</li> <li>\u89c2\u5bdf\u81ea\u52a8\u9009\u4e3e\u65b0Leader\uff08\u7ea610-30\u79d2\uff09</li> <li>\u9a8c\u8bc1\u6570\u636e\u4e00\u81f4\u6027</li> </ol>"},{"location":"Zookeeper/#6-\u751f\u4ea7\u73af\u5883\u4f18\u5316\u5efa\u8bae","title":"6. \u751f\u4ea7\u73af\u5883\u4f18\u5316\u5efa\u8bae","text":"<p>\u914d\u7f6e\u4f18\u5316</p> <pre><code># \u589e\u52a0\u4ee5\u4e0b\u53c2\u6570\u5230zoo.cfg\n# \u5feb\u7167\u4fdd\u7559\u6570\u91cf\nautopurge.snapRetainCount=10\n# \u6e05\u7406\u95f4\u9694(\u5c0f\u65f6)\nautopurge.purgeInterval=48\n# \u5355\u4e2a\u6570\u636e\u5305\u6700\u5927\u5c3a\u5bf8(\u5b57\u8282)\njute.maxbuffer=10485760\n# \u9884\u5206\u914d\u5927\u5c0f(KB)\npreAllocSize=65536\n# \u5ba2\u6237\u7aef\u5fc3\u8df3\u8d85\u65f6(ms)\nmaxSessionTimeout=60000\n</code></pre> <p>JVM\u4f18\u5316</p> <pre><code># \u4fee\u6539bin/zkServer.sh\u4e2d\u7684JVM\u53c2\u6570\nexport SERVER_JVMFLAGS=\"-Xms4G -Xmx4G -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+DisableExplicitGC\"\n</code></pre>"},{"location":"Zookeeper/#7-\u5e38\u89c1\u95ee\u9898\u89e3\u51b3","title":"7. \u5e38\u89c1\u95ee\u9898\u89e3\u51b3","text":"<p>\u542f\u52a8\u5931\u8d25\u6392\u67e5</p> <ol> <li>\u68c0\u67e5<code>/var/lib/zookeeper/data/zookeeper_server.pid</code>\u662f\u5426\u5b58\u5728</li> <li>\u67e5\u770b\u65e5\u5fd7<code>/opt/zookeeper/logs/zookeeper.out</code></li> <li>\u9a8c\u8bc1\u7aef\u53e3\u662f\u5426\u51b2\u7a81<code>netstat -tulnp | grep 2181</code></li> </ol> <p>\u8282\u70b9\u65e0\u6cd5\u52a0\u5165\u96c6\u7fa4</p> <ol> <li>\u68c0\u67e5\u9632\u706b\u5899\u8bbe\u7f6e\uff08\u5f00\u653e2181,2888,3888\u7aef\u53e3\uff09</li> <li>\u9a8c\u8bc1myid\u6587\u4ef6\u662f\u5426\u6b63\u786e</li> <li>\u68c0\u67e5\u4e3b\u673a\u540d\u89e3\u6790\uff08/etc/hosts\u6216DNS\uff09</li> </ol> <p>\u6570\u636e\u4e0d\u4e00\u81f4\u5904\u7406</p> <ol> <li>\u505c\u6b62\u6240\u6709\u8282\u70b9</li> <li>\u5728\u6700\u65b0\u6570\u636e\u7684\u8282\u70b9\u4e0a\u4fdd\u7559\u6570\u636e</li> <li>\u5176\u4ed6\u8282\u70b9\u6e05\u7a7adataDir\u76ee\u5f55</li> <li>\u91cd\u65b0\u542f\u52a8\u96c6\u7fa4</li> </ol>"},{"location":"Zookeeper/#8-\u7ef4\u62a4\u547d\u4ee4","title":"8. \u7ef4\u62a4\u547d\u4ee4","text":"<p>\u65e5\u5e38\u7ef4\u62a4</p> <pre><code># \u4f18\u96c5\u91cd\u542f\n/opt/zookeeper/bin/zkServer.sh restart\n\n# \u5f3a\u5236\u6e05\u7406\uff08\u8c28\u614e\u4f7f\u7528\uff09\n/opt/zookeeper/bin/zkCleanup.sh -n 10\n\n# \u67e5\u770b\u8fde\u63a5\u6570\necho cons | nc localhost 2181\n</code></pre> <p>\u76d1\u63a7\u547d\u4ee4</p> <pre><code># \u76d1\u63a7\u96c6\u7fa4\u72b6\u6001\nwatch -n 1 \"echo stat | nc localhost 2181 | grep Mode\"\n\n# \u76d1\u63a7znode\u6570\u91cf\necho mntr | nc localhost 2181 | grep znode_count\n</code></pre> <p>S</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/","title":"Windows","text":""},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u8f6f\u4ef6\u63a8\u8350","title":"\u8f6f\u4ef6\u63a8\u8350","text":"\u8f6f\u4ef6\u540d \u63cf\u8ff0 Geek \u5378\u8f7d Dism++ \u7cfb\u7edf\u5de5\u5177 WiseRegisterCleaner \u6ce8\u518c\u8868\u6e05\u7406 Bandzip \u89e3\u538b\u5de5\u5177 \u62fe\u5149 \u4f18\u8d28\u58c1\u7eb8 Wiztree \u5b58\u50a8\u5206\u6790 Clash \u4ee3\u7406 Win11\u8f7b\u677e\u8bbe\u7f6e \u4f18\u5316 Start11 \u5f00\u59cb\u83dc\u5355 FirePE|WePE PE\u5de5\u5177 HEU_KMS \u6fc0\u6d3b\u5de5\u5177"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#vmware\u5171\u4eab\u6587\u4ef6\u5939","title":"Vmware\u5171\u4eab\u6587\u4ef6\u5939","text":"<p>\u9700\u8981\u5148\u5b89\u88c5vmtools</p> <p>\u6253\u5f00\u865a\u62df\u673a\u8bbe\u7f6e\uff0c\u542f\u7528\u5171\u4eab\u6587\u4ef6\u5939</p> <p>\u865a\u62df\u673a\u8bbf\u95ee/mnt/hgfs/\u5373\u53ef</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#ubuntu","title":"Ubuntu","text":""},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#ubuntu\u6e05\u7406","title":"Ubuntu\u6e05\u7406","text":"<p>\u901a\u8fc7\u4e00\u4e0b\u547d\u4ee4\u67e5\u770b\u78c1\u76d8\u4f7f\u7528\u7387\uff1a</p> <pre><code>df -h\n</code></pre> <p>\u79fb\u9664\u4e0d\u518d\u9700\u8981\u7684\u8f6f\u4ef6\u5305\uff1a</p> <pre><code>sudo apt-get autoremove --purge\n</code></pre> <p>\u79fb\u9664\u8f6f\u4ef6\u5305\u7f13\u5b58\uff1a</p> <pre><code>sudo apt-get clean\n</code></pre> <p>\u6e05\u7406\u65e5\u5fd7\uff1a</p> <pre><code>sudo journalctl --vacuum-time=2weeks\n</code></pre> <p>\u6e05\u7406\u4e34\u65f6\u6587\u4ef6\uff1a</p> <pre><code>sudo rm -rf /tmp/*\n</code></pre> <p>\u6e05\u7406\u65e7\u5185\u6838(\u8bf7\u786e\u5b9a\u6e05\u7406\u7684\u5df2\u7ecf\u4e0d\u518d\u4f7f\u7528\u7684\u5185\u6838)\uff1a</p> <pre><code>sudo apt-get remove --purge linux-image-x.x.x-xx-generic\n</code></pre>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#ubuntu\u6362\u6e90","title":"Ubuntu\u6362\u6e90","text":""},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u65b9\u6cd5\u4e00","title":"\u65b9\u6cd5\u4e00","text":"<ol> <li>\u8fdb\u5165 \u7cfb\u7edf\u8bbe\u7f6e</li> <li>\u6253\u5f00 \u8f6f\u4ef6\u548c\u66f4\u65b0</li> <li>\u8bbe\u7f6e \u4e0b\u8f7d\u81ea\u2026 \u5176\u4ed6\u7ad9\u70b9</li> <li>\u901a\u8fc7 \u9009\u62e9\u6700\u4f73\u670d\u52a1\u5668 \u9009\u62e9\u901f\u5ea6\u6700\u5feb\u7684\u955c\u50cf\u6e90</li> </ol>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u65b9\u6cd5\u4e8c","title":"\u65b9\u6cd5\u4e8c","text":"<ol> <li>\u5907\u4efd\u955c\u50cf\u8bbe\u7f6e\u6587\u4ef6\uff08\u53ef\u9009\uff09\uff1a</li> </ol> <pre><code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n</code></pre> <ol> <li>\u7f16\u8f91\u955c\u50cf\u6e90\u6587\u4ef6\uff1a</li> </ol> <pre><code>sudo vi /etc/apt/sources.list\n</code></pre> <ol> <li> <p>\u641c\u7d22\u955c\u50cf\u6e90\uff0c\u5e76\u5199\u5165\u6587\u4ef6</p> </li> <li> <p>\u6267\u884c\u547d\u4ee4\uff1a</p> </li> </ol> <pre><code>sudo apt-get update\nsudo apt-get upgrade\n</code></pre>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#cc\u73af\u5883\u914d\u7f6e","title":"C/C++\u73af\u5883\u914d\u7f6e","text":"<p>\u8f93\u5165\u547d\u4ee4\uff1a</p> <pre><code>sudo apt-get install gcc\nsudo apt-get install build-essential\n</code></pre>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u5e38\u89c1\u62a5\u9519","title":"\u5e38\u89c1\u62a5\u9519","text":""},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u53ef\u6267\u884c\u7a0b\u5e8f\u5b58\u5728\u5374\u62a5\u9519bash-no-such-file-or-directory","title":"\u53ef\u6267\u884c\u7a0b\u5e8f\u5b58\u5728\u5374\u62a5\u9519:bash no such file or directory","text":"<p>\u4f7f\u7528\uff1a</p> <pre><code>file [\u6587\u4ef6\u540d]\n</code></pre> <p>\u67e5\u770b\u6587\u4ef6\u4fe1\u606f\uff0c\u5982\u679c\u673a\u5668\u4e3a64\u4f4d\u7cfb\u7edf\u800c\u7a0b\u5e8f\u4e3a32\u4f4d\u7a0b\u5e8f\uff0c\u7f3a\u5c11\u8fd0\u884c\u5e93\uff1a</p> <pre><code>sudo apt-get install lib32stdc++6\n</code></pre>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#wsl","title":"WSL","text":""},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#linux\u5b50\u7cfb\u7edf--wsl\u5b89\u88c5","title":"Linux\u5b50\u7cfb\u7edf--WSL\u5b89\u88c5","text":"<ol> <li>\u5f00\u542fLinux\u5b50\u7cfb\u7edf\u548cHype-v </li> </ol> <p>\u63a7\u5236\u9762\u677f--&gt;\u7a0b\u5e8f--&gt;\u542f\u7528\u6216\u5173\u95edWIndows\u529f\u80fd--&gt;\u9002\u7528\u4e8eWindows\u7684Linux\u5b50\u7cfb\u7edf&amp;&amp;Hype-v</p> <ol> <li>\u8bbe\u7f6eWSL\u7248\u672c\u4e3aWSL2</li> </ol> <ul> <li> <p>\u6253\u5f00\u7ec8\u7aef</p> </li> <li> <p>\u6267\u884c\u547d\u4ee4</p> </li> </ul> <pre><code>wsl --set-default-version 2\n</code></pre> <ol> <li>\u5728Microsoft store\u4e2d\u5b89\u88c5\u4ee5Linux\u53d1\u884c\u7248</li> </ol> <p>\u542f\u52a8\u5373\u53ef</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#wsl1\u4e0ewsl2\u8f6c\u6362","title":"WSL1\u4e0eWSL2\u8f6c\u6362","text":"<p>\u5c06 WSL 1 \u4e0a\u7684 Ubuntu \u8f6c\u6362\u5230 WSL 2 \u5982\u679c\u4f7f\u7528 WSL 1\uff0c\u5219\u53ef\u4ee5\u5c06\u73b0\u6709\u7684 WSL 1 \u5b89\u88c5\u5347\u7ea7\u5230 WSL 2\u3002\u8981\u5c06\u73b0\u6709\u7684 WSL 1 \u53d1\u884c\u7248\u8f6c\u6362\u5230 WSL 2\uff0c\u8bf7\u5728 PowerShell \u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>wsl.exe--set-versionUbuntu2\n</code></pre> <p>\u4f7f\u7528\u65f6\uff0c\u5e94\u5c06\u547d\u4ee4\u4e2d\u7684 \u201cUbuntu\u201d \u66ff\u6362\u4e3a\u60a8\u5728 WSL 1 \u4e0a\u5b89\u88c5\u8fd0\u884c\u7684\u5bf9\u5e94\u53d1\u884c\u7248\u7684\u540d\u79f0</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u5e38\u89c1\u95ee\u9898","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li> <p>\u5b89\u88c5\u5931\u8d25\u5e76\u51fa\u73b0\u9519\u8bef0x80070003    \u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\u53ea\u80fd\u5728\u7cfb\u7edf\u9a71\u52a8\u5668\uff08\u901a\u5e38\u662f C: \u9a71\u52a8\u5668\uff09\u4e2d\u8fd0\u884c\u3002 \u8bf7\u786e\u4fdd\u5206\u53d1\u7248\u5b58\u50a8\u5728\u7cfb\u7edf\u9a71\u52a8\u5668\u4e0a\uff1a\u6253\u5f00\u201c\u8bbe\u7f6e\u201d-&gt;\u201c\u7cfb\u7edf\u201d--&gt;\u201c\u5b58\u50a8\u201d-&gt; \u201c\u66f4\u591a\u5b58\u50a8\u8bbe\u7f6e\u201d\uff1a \u66f4\u6539\u65b0\u5185\u5bb9\u7684\u4fdd\u5b58\u4f4d\u7f6e\u201d</p> </li> <li> <p>WslRegisterDistribution \u5931\u8d25\u5e76\u51fa\u73b0\u9519\u8bef 0x8007019e    \u672a\u542f\u7528\u201c\u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\u201d\u53ef\u9009\u7ec4\u4ef6\uff1a    \u6253\u5f00\u201c\u63a7\u5236\u9762\u677f\u201d -&gt; \u201c\u7a0b\u5e8f\u548c\u529f\u80fd\u201d -&gt; \u201c\u6253\u5f00\u6216\u5173\u95ed Windows \u529f\u80fd\u201d-&gt; \u9009\u4e2d\u201c\u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\u201d\uff0c\u6216\u4f7f\u7528\u672c\u6587\u5f00\u5934\u6240\u8ff0\u7684 PowerShell cmdlet\u3002</p> </li> <li> <p>\u5b89\u88c5\u5931\u8d25\uff0c\u51fa\u73b0\u9519\u8bef 0x80070003 \u6216\u9519\u8bef 0x80370102    \u8bf7\u786e\u4fdd\u5728\u8ba1\u7b97\u673a\u7684 BIOS \u5185\u5df2\u542f\u7528\u865a\u62df\u5316\u3002 \u6709\u5173\u5982\u4f55\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u8bf4\u660e\u56e0\u8ba1\u7b97\u673a\u800c\u5f02\uff0c\u5e76\u4e14\u5f88\u53ef\u80fd\u5728 CPU \u76f8\u5173\u9009\u9879\u4e0b\u3002WSL2 \u8981\u6c42 CPU \u652f\u6301\u4e8c\u7ea7\u5730\u5740\u8f6c\u6362 (SLAT) \u529f\u80fd\uff0c\u540e\u8005\u5df2\u5728 Intel Nehalem \u5904\u7406\u5668\uff08Intel Core \u7b2c\u4e00\u4ee3\uff09\u548c AMD Opteron \u4e2d\u5f15\u5165\u3002 \u5373\u4f7f\u6210\u529f\u5b89\u88c5\u4e86\u865a\u62df\u673a\u5e73\u53f0\uff0c\u65e7\u7248 CPU\uff08\u4f8b\u5982 Intel Core 2 Duo\uff09\u4e5f\u65e0\u6cd5\u8fd0\u884c WSL2\u3002</p> </li> <li> <p>\u5c1d\u8bd5\u5347\u7ea7\u65f6\u51fa\u9519\uff1a</p> </li> </ol> <pre><code>Invalid command line option: wsl --set-version Ubuntu 2\n</code></pre> <p>\u8bf7\u786e\u4fdd\u5df2\u542f\u7528\u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\uff0c\u5e76\u4e14\u4f60\u4f7f\u7528\u7684\u662f Windows \u5185\u90e8\u7248\u672c 18362 \u6216\u66f4\u9ad8\u7248\u672c\u3002 \u82e5\u8981\u542f\u7528 WSL\uff0c\u8bf7\u5728 PowerShell \u63d0\u793a\u7b26\u4e0b\u4ee5\u5177\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684\u8eab\u4efd\u8fd0\u884c\u6b64\u547d\u4ee4\uff1a</p> <pre><code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux\n</code></pre> <ol> <li> <p>\u7531\u4e8e\u865a\u62df\u78c1\u76d8\u7cfb\u7edf\u7684\u67d0\u4e2a\u9650\u5236\uff0c\u65e0\u6cd5\u5b8c\u6210\u6240\u8bf7\u6c42\u7684\u64cd\u4f5c\u3002\u865a\u62df\u786c\u76d8\u6587\u4ef6\u5fc5\u987b\u662f\u89e3\u538b\u7f29\u7684\u4e14\u672a\u52a0\u5bc6\u7684\uff0c\u5e76\u4e14\u4e0d\u80fd\u662f\u7a00\u758f\u7684</p> </li> <li> <p>\u53d6\u6d88\u9009\u4e2d\u201c\u538b\u7f29\u5185\u5bb9\u201d\uff08\u5982\u679c\u5df2\u9009\u4e2d\u201c\u52a0\u5bc6\u5185\u5bb9\u201d\uff0c\u8bf7\u4e00\u5e76\u53d6\u6d88\u9009\u4e2d\uff09\uff0c\u65b9\u6cd5\u662f\u6253\u5f00 Linux \u53d1\u884c\u7248\u7684\u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\u5939\u3002 \u5b83\u5e94\u4f4d\u4e8e Windows \u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u4e00\u4e2a\u6587\u4ef6\u5939\u4e2d\uff0c\u7c7b\u4f3c\u4e8e\uff1aUSERPROFILE%\\AppData\\Local\\Packages\\CanonicalGroupLimited...</p> </li> <li> <p>\u5728\u6b64 Linux \u53d1\u884c\u7248\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5e94\u5b58\u5728\u4e00\u4e2a LocalState \u6587\u4ef6\u5939\u3002 \u53f3\u952e\u5355\u51fb\u6b64\u6587\u4ef6\u5939\u53ef\u663e\u793a\u9009\u9879\u7684\u83dc\u5355\u3002 \u9009\u62e9\u201c\u5c5e\u6027\u201d&gt;\u201c\u9ad8\u7ea7\u201d\uff0c\u7136\u540e\u786e\u4fdd\u672a\u9009\u62e9\uff08\u672a\u52fe\u9009\uff09\u201c\u538b\u7f29\u5185\u5bb9\u4ee5\u8282\u7701\u78c1\u76d8\u7a7a\u95f4\u201d\u548c\u201c\u52a0\u5bc6\u5185\u5bb9\u4ee5\u4fdd\u62a4\u6570\u636e\u201d\u590d\u9009\u6846\u3002 \u5982\u679c\u7cfb\u7edf\u8be2\u95ee\u662f\u8981\u5c06\u6b64\u5e94\u7528\u5230\u5f53\u524d\u6587\u4ef6\u5939\u8fd8\u662f\u5e94\u7528\u5230\u6240\u6709\u5b50\u6587\u4ef6\u5939\u548c\u6587\u4ef6\uff0c\u8bf7\u9009\u62e9\u201c\u4ec5\u6b64\u6587\u4ef6\u5939\u201d\uff0c\u56e0\u4e3a\u4f60\u53ea\u662f\u8981\u6e05\u9664\u538b\u7f29\u6807\u5fd7\u3002 \u5b8c\u6210\u6b64\u64cd\u4f5c\u540e\uff0cwsl --set-version \u547d\u4ee4\u5e94\u6b63\u5e38\u5de5\u4f5c\u3002</p> </li> <li> <p>\u65e0\u6cd5\u5c06\u8bcd\u8bed\u201cwsl\u201d\u8bc6\u522b\u4e3a cmdlet\u3001\u51fd\u6570\u3001\u811a\u672c\u6587\u4ef6\u6216\u53ef\u8fd0\u884c\u7a0b\u5e8f\u7684\u540d\u79f0    \u8bf7\u786e\u4fdd\u5df2\u5b89\u88c5\u201c\u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\u201d\u53ef\u9009\u7ec4\u4ef6\u3002 \u6b64\u5916\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f ARM64 \u8bbe\u5907\uff0c\u5e76\u4ece PowerShell \u8fd0\u884c\u6b64\u547d\u4ee4\uff0c\u5219\u4f1a\u6536\u5230\u6b64\u9519\u8bef\u3002 \u8bf7\u6539\u4e3a\u4ece PowerShell Core \u6216\u4ece\u547d\u4ee4\u63d0\u793a\u7b26\u8fd0\u884c wsl.exe\u3002</p> </li> <li> <p>\u9519\u8bef\uff1a\u6b64\u66f4\u65b0\u4ec5\u9002\u7528\u4e8e\u88c5\u6709\u9002\u7528\u4e8e Linux \u7684 Windows \u5b50\u7cfb\u7edf\u7684\u8ba1\u7b97\u673a</p> </li> <li> <p>\u82e5\u8981\u5b89\u88c5 Linux \u5185\u6838\u66f4\u65b0 MSI \u5305\uff0c\u9700\u8981 WSL\uff0c\u5e94\u5148\u542f\u7528\u5b83\u3002 \u5982\u679c\u5931\u8d25\uff0c\u5c06\u770b\u5230\u4ee5\u4e0b\u6d88\u606f\uff1aThis update only applies to machines with the Windows Subsystem for Linux\u3002</p> </li> <li> <p>\u51fa\u73b0\u6b64\u6d88\u606f\u6709\u4e09\u4e2a\u53ef\u80fd\u7684\u539f\u56e0\uff1a</p> </li> <li> <p>\u4f60\u4ecd\u4f7f\u7528\u65e7\u7248 Windows\uff0c\u4e0d\u652f\u6301 WSL 2\u3002 \u6709\u5173\u7248\u672c\u8981\u6c42\u548c\u8981\u66f4\u65b0\u7684\u94fe\u63a5\uff0c\u8bf7\u53c2\u9605\u6b65\u9aa4 #2\u3002</p> </li> <li> <p>\u672a\u542f\u7528 WSL\u3002 \u9700\u8981\u8fd4\u56de\u5230\u6b65\u9aa4 #1\uff0c\u5e76\u786e\u4fdd\u5728\u8ba1\u7b97\u673a\u4e0a\u542f\u7528\u4e86\u53ef\u9009\u7684 WSL \u529f\u80fd\u3002</p> </li> <li> <p>\u9519\u8bef\uff1aWSL 2 \u8981\u6c42\u5bf9\u5176\u5185\u6838\u7ec4\u4ef6\u8fdb\u884c\u66f4\u65b0     \u5982\u679c %SystemRoot%\\system32\\lxss\\tools \u6587\u4ef6\u5939\u4e2d\u7f3a\u5c11 Linux \u5185\u6838\u5305\uff0c\u4f1a\u9047\u5230\u6b64\u9519\u8bef\u3002 \u82e5\u8981\u89e3\u51b3\u6b64\u95ee\u9898\uff0c\u8bf7\u5728\u5b89\u88c5\u8bf4\u660e\u7684\u6b65\u9aa4 #4 \u4e2d\u5b89\u88c5 Linux \u5185\u6838\u66f4\u65b0 MSI \u5305\u3002 \u53ef\u80fd\u4f1a\u9700\u8981\u4ece\u6dfb\u52a0\u6216\u5220\u9664\u7a0b\u5e8f\u5378\u8f7d MSI\uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\u3002</p> </li> </ol>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#wsl\u8fc1\u79fb\u5230d\u76d8","title":"WSL\u8fc1\u79fb\u5230D\u76d8","text":"<ol> <li>\u67e5\u770b\u81ea\u5df1\u7684wsl\u548cubuntu\u7248\u672c\uff1b</li> </ol> <pre><code>wsl -l -v\n</code></pre> <ol> <li>\u5173\u95edwsl\u670d\u52a1\uff1b</li> </ol> <pre><code>wsl --shutdown\n</code></pre> <ol> <li>\u5c06\u539f\u4f4d\u7f6e\u7684ubuntu\u5bfc\u51fa\u5230\u6307\u5b9a\u4f4d\u7f6e(\u6211\u7684\u662fE\u76d8)\uff1b</li> </ol> <pre><code>wsl --export Ubuntu D:\\Ubuntu.tar\n</code></pre> <ol> <li>\u539fwsl\u6ce8\u9500ubuntu\uff1b</li> </ol> <pre><code>wsl --unregister Ubuntu\n</code></pre> <ol> <li>\u5728\u6307\u5b9a\u4f4d\u7f6e(\u6211\u7684\u662fE\u76d8)\u5bfc\u5165ubuntu\uff1b</li> </ol> <pre><code>wsl --import Ubuntu D:\\WSL D:\\Ubuntu.tar\n</code></pre> <ol> <li>\u4fee\u6539\u7528\u6237\u540d\u4e3a\u539f\u6765\u7684\u540d\u5b57\u3002</li> </ol> <pre><code>Ubuntu config --default-user ysh\n</code></pre>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#\u51cf\u5c11wsl2\u5728\u78c1\u76d8\u4e0a\u5360\u7528\u7684\u7a7a\u95f4","title":"\u51cf\u5c11WSL2\u5728\u78c1\u76d8\u4e0a\u5360\u7528\u7684\u7a7a\u95f4","text":"<p>WSL2 \u4f7f\u7528\u4e86\u865a\u62df\u78c1\u76d8\uff0c\u610f\u5473\u7740\u5b83\u53ef\u80fd\u53ea\u6709 15GB \u7684\u6570\u636e\uff0c\u4f46\u662f\u865a\u62df\u78c1\u76d8\u5360\u7528\u4e86 100GB \u7684\u7a7a\u95f4\u3002\u5982\u679c\u4f60\u5f80 WSL2 \u4e2d\u653e\u4e86\u5927\u91cf\u7684\u6570\u636e\uff0c\u7136\u540e\u5c31\u5220\u6389\uff0c\u4f1a\u53d1\u73b0WSL2\u7684\u78c1\u76d8\u5360\u7528\u6ca1\u6709\u964d\u4e0b\u6765\uff0c\u8fd9\u5c31\u662f\u865a\u62df\u78c1\u76d8\u9020\u6210\u7684\u3002</p> <ol> <li>\u51c6\u5907\u5de5\u4f5c    \u5728\u538b\u7f29\u865a\u62df\u78c1\u76d8\u524d\uff0c\u9700\u8981\u5c06 WSL2 \u5148\u5173\u95ed\u3002\u53ef\u4ee5\u5148\u4f7f\u7528\u547d\u4ee4\u884c\u6765\u68c0\u67e5\u5b83\u7684\u72b6\u6001\uff1a</li> </ol> <pre><code>wsl.exe --list --verbose\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u5173\u95ed\uff08\u72b6\u6001\u662f Running \uff09\uff0c\u518d\u7528\u547d\u4ee4\u884c\u53bb\u5173\u95ed\u5b83\uff1a</p> <pre><code>wsl.exe --terminate\n</code></pre> <p>\u5efa\u8bae\u5148\u5907\u4efd\u4e00\u4e0bWSL2\u7684\u6570\u636e\u3002</p> <ol> <li>\u4f7f\u7528diskpart\u538b\u7f29\u865a\u62df\u78c1\u76d8    \u5728\u547d\u4ee4\u884c\u542f\u52a8 diskpart \u5de5\u5177\uff0c\u5b83\u4f1a\u81ea\u5df1\u6253\u5f00\u4e00\u4e2a\u65b0\u7684\u7a97\u53e3\uff1a</li> </ol> <pre><code>diskpart\n</code></pre> <p>\u63a5\u4e0b\u6765\u9700\u8981\u786e\u5b9a\u865a\u62df\u78c1\u76d8\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002</p> <p>WSL2\u7684\u865a\u62df\u78c1\u76d8\u6587\u4ef6\u5728C:\\Users{user}\\AppData\\Local\\Packages\\\u4e0b\u9762\uff0c\u4e0d\u540c\u7684WSL2\u53d1\u884c\u7248\u5bf9\u5e94\u7684\u540d\u79f0\u4e0d\u540c\uff0c\u4f8b\u5982 Pengwin \u662f &gt; WhitewaterFoundryLtd.Co\uff0cUbuntu \u662f CanonicalGroupLimited\uff0cDebian \u662fTheDebianProject \u3002\u627e\u5230\u4e86WSL2 \u7684\u6587\u4ef6\u5939\uff0c\u5c31\u80fd\u5728\u5b83\u4e0b\u9762\u627e\u5230 &gt; LocalState\\ ext4.vhdx\u8fd9\u4e2a\u78c1\u76d8\u6587\u4ef6\u3002</p> <p>\u7528 diskpart \u9009\u62e9\u8fd9\u4e2a\u6587\u4ef6\uff1a</p> <pre><code>select vdisk file = \"{\u865a\u62df\u78c1\u76d8\u8def\u5f84}\"\n</code></pre> <p>\u518d\u6267\u884c\u538b\u7f29\u547d\u4ee4\uff1a</p> <pre><code>compact vdisk\n</code></pre> <ol> <li>\u6267\u884c\u6210\u529f</li> </ol>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#wsl\u914d\u7f6e\u4ee3\u7406","title":"WSL\u914d\u7f6e\u4ee3\u7406","text":"<ol> <li>\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4\uff1a</li> </ol> <pre><code>vim ~/.bashrc\n</code></pre> <ol> <li>\u5728\u6587\u672b\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a</li> </ol> <pre><code>        host_ip=$(cat /etc/resolv.conf |grep \"nameserver\" |cut -f 2 -d \" \")\n        export http_proxy=\"http://$host_ip:7890\"    # \u7aef\u53e3\u6839\u636e\u4ee3\u7406\u8f6f\u4ef6\u6765\u786e\u5b9a\n        export https_proxy=\"http://$host_ip:7890\"\n</code></pre> <ol> <li>\u9000\u51fa\u4fdd\u5b58</li> </ol> <p>\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\uff1a\u4f7f\u7528\u4ee3\u7406\u8f6f\u4ef6\u7684Tun\u6a21\u5f0f\uff08\u8be5\u6a21\u5f0f\u4f1a\u865a\u62df\u4e00\u5f20\u7f51\u5361\uff0c\u6240\u6709\u7cfb\u7edf\u6d41\u91cf\u90fd\u4f1a\u7531\u4ee3\u7406\u8f6f\u4ef6\u63a5\u7ba1\uff09</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#wsl\u914d\u7f6e\u670d\u52a1\u81ea\u542f\u52a8","title":"WSL\u914d\u7f6e\u670d\u52a1\u81ea\u542f\u52a8","text":"<p>\u4ee5ssh\u670d\u52a1\u4e3a\u4f8b\uff1a</p> <p>\u521b\u5efa\u6587\u4ef6\uff1a</p> <pre><code>sudo vim /etc/init.wsl\n</code></pre> <p>\u5199\u5165\u542f\u52a8\u670d\u52a1\u4fe1\u606f\uff1a</p> <pre><code>/etc/init.d/ssh $1\n</code></pre> <p>\u6388\u4e88\u6587\u4ef6\u53ef\u6267\u884c\u6743\u9650</p> <pre><code>sudo chmod +x /etc/init.wsl\n</code></pre> <p>\u6d4b\u8bd5\u6267\u884c\u6743\u9650\uff1a</p> <pre><code>sudo /etc/init.wsl start\n</code></pre> <p>\u521b\u5efa\u542f\u52a8\u811a\u672c\uff1a \u5728\u4f60\u7684 WSL \u4e2d\u521b\u5efa\u4e00\u4e2a\u811a\u672c\uff0c\u6bd4\u5982 <code>start.sh</code>\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>sh -c \"echo '666' | sudo -S /etc/init.wsl start\"\n</code></pre> <p>echo '[root\u7684\u7528\u6237\u5bc6\u7801]'</p> <p>\u6388\u4e88\u811a\u672c\u53ef\u6267\u884c\u6743\u9650\uff1a</p> <pre><code>sudo chmod +x start.sh\n</code></pre> <p>\u5728 WSL \u542f\u52a8\u65f6\u8fd0\u884c\u811a\u672c\uff1a \u4f60\u53ef\u4ee5\u5c06\u8be5\u811a\u672c\u653e\u5728 <code>.bashrc</code> \u6216 <code>.bash_profile</code> \u4e2d\uff1a</p> <pre><code>echo 'bash ~/start.sh' &gt;&gt; ~/.bashrc\n</code></pre> <p>\u6d4b\u8bd5</p>"},{"location":"%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3/#ssh\u8fdc\u7a0b\u8fde\u63a5wsl","title":"SSH\u8fdc\u7a0b\u8fde\u63a5WSL","text":"<p>\u5b89\u88c5ssh\u670d\u52a1\uff1a</p> <pre><code>sudo apt-get install openssh-serer\n</code></pre> <p>\u4fee\u6539\u914d\u7f6e\u4fe1\u606f<code>/etc/ssh/sshd_config</code>\uff1a</p> <pre><code>Port 22 #\u7aef\u53e3\nPermitRootLogin yes #\u5141\u8bb8\u8fdc\u7a0broot\u7528\u6237\u767b\u5f55\nPasswordAuthentication yes #\u5141\u8bb8\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\n</code></pre> <p>\u91cd\u542fssh\u670d\u52a1\uff1a</p> <pre><code>sudo service ssh restart\n</code></pre> <p>\u672c\u673aWindows\u8fde\u63a5\u6d4b\u8bd5\uff08\u9700\u8981\u5b89\u88c5ssh\u529f\u80fd\uff1a\u8bbe\u7f6e--&gt;\u7cfb\u7edf--&gt;\u53ef\u9009\u529f\u80fd--&gt;\u6dfb\u52a0\u53ef\u9009\u529f\u80fd--OpenSSH\u5ba2\u6237\u7aef\uff09\uff1a</p> <pre><code>ssh root@localhost [-p 22]\n</code></pre> <p>\u6b64\u65f6\u5e76\u4e0d\u80fd\u8fdc\u7a0b\u8fde\u63a5WSL\uff0c\u9700\u8981\u914d\u7f6e\u7aef\u53e3\u8f6c\u53d1\u548c\u9632\u706b\u5899</p> <p>\u67e5\u770bWSL\u7684ip\u5730\u5740(\u6b64\u6b65\u53ef\u7701\u7565)\uff1a</p> <pre><code>ifconfig\n</code></pre> <p>eth0\u4e0b\u7684inen4</p> <p>\u8bbe\u7f6e\u7aef\u53e3\u8f6c\u53d1\uff08\u4f7f\u7528IPV6\u8f6c\u53d1\uff09\uff1a</p> <pre><code>netsh interface portproxy add v6tov4 listenaddress=:: listenport=22 connectaddress=localhost connectport=22\n</code></pre> <p>\u8f6c\u53d1IPV4</p> <pre><code>netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22 connectaddress=localhost connectport=22\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <p>connectaddress\u5e94\u586b\u5199WSL\u4e2d\u7684IP\u5730\u5740\uff0c\u7ecf\u6d4b\u8bd5\u53ef\u7528localhost\u4ee3\u66ff</p> <p>\u7aef\u53e3\u53ef\u81ea\u884c\u66f4\u6539</p> <p>\u67e5\u770b\u7aef\u53e3\u662f\u5426\u5df2\u7ecf\u88ab\u76d1\u542c\uff1a</p> <pre><code>netstat -ano | findstr :22\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u8fd4\u56de\u5185\u5bb9\uff0c\u8bf7\u68c0\u67e5\uff1a</p> <p>\u7cfb\u7edf\u7684Ip Helper\u670d\u52a1\u662f\u5426\u5f00\u542f\uff08\u8fdb\u5165\u670d\u52a1\u7ba1\u7406\u67e5\u770b\uff09</p> <p>\u786e\u8ba4vEthernet\u662f\u5426\u5f00\u542fIPV6</p> <p>\u9632\u706b\u5899\u6dfb\u52a0\u7aef\u53e322\uff08\u5b9e\u9645\u8bbe\u7f6e\u7684\u7aef\u53e3\uff09\u7684\u5165\u7ad9\u89c4\u5219\uff1b</p> <p>\u4f7f\u7528IPV6\u8fde\u63a5\u6d4b\u8bd5</p> <p>\u5176\u4ed6\u547d\u4ee4\uff1a</p> <p>\u663e\u793a\u914d\u7f6e\u7684\u6240\u6709\u7aef\u53e3\u8f6c\u53d1:</p> <pre><code>netsh interface portproxy show all\n</code></pre> <p>\u91cd\u7f6e\u7aef\u53e3\u8f6c\u53d1\uff1a</p> <pre><code>netsh interface portproxy reset\n</code></pre>"},{"location":"Git/Git/","title":"Git","text":""},{"location":"Git/Git/#git\u5b89\u88c5\u914d\u7f6e","title":"git\u5b89\u88c5\u914d\u7f6e","text":"<p>\u5404\u5e73\u53f0git\u4e0b\u8f7d\u5730\u5740\uff1a http://git-scm.com/downloads</p> <p>git\u63d0\u4f9b\u4e00\u4e2a\u53ebgit config\u7684\u5de5\u5177\u4e13\u95e8\u7528\u6765\u914d\u7f6e\u5de5\u4f5c\u73af\u5883\u53d8\u91cf</p> <p>\u73af\u5883\u53d8\u91cf\u4fdd\u5b58\u4f4d\u7f6e(Linux)\uff1a</p> <pre><code>/etc/gitconfig\n~/.gitconfig\n</code></pre> <p>Windows\u4e0b\u4f1a\u4fdd\u5b58\u5728\u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\u7684 .gitconfig \u6587\u4ef6\u4e2d\uff0c\u5373\u73af\u5883\u53d8\u91cf $HOME \u6307\u5b9a\u76ee\u5f55</p> <p>\u914d\u7f6e\u4e2a\u4eba\u7684\u7528\u6237\u540d\u548c\u90ae\u4ef6\u5730\u5740\uff1a</p> <pre><code>git config --global user.name \"{name}\"\ngit config --global user.email {e-mail}\n</code></pre> <p></p>"},{"location":"Git/Git/#\u4f7f\u7528ssh\u52a0\u5bc6\u4f20\u8f93","title":"\u4f7f\u7528SSH\u52a0\u5bc6\u4f20\u8f93","text":"<ol> <li>\u751f\u6210SSH Key\uff1a</li> </ol> <pre><code>ssh-keygen -t rsa -C \"&lt;e-mail&gt;\"\n</code></pre> <ol> <li>\u5c06SSH\u516c\u94a5\u8bbe\u7f6e\u5230\u4ee3\u7801\u6258\u7ba1\u5e73\u53f0</li> <li> <p>Linux\u4f1a\u751f\u6210\u6587\u4ef6\u5939 ~/.ssh \uff0c\u5c06\u8be5\u6587\u4ef6\u5939\u4e2d\u7684id_rsa.pub\u4e2d\u7684key\u590d\u5236\u4e0b\u6765\u5e76\u914d\u7f6e\u5230\u4ee3\u7801\u6258\u7ba1\u5e73\u53f0</p> </li> <li> <p>Windows\u4f1a\u5728\u7528\u6237\u4e3b\u76ee\u5f55\uff08$HOME\u6307\u5411\u7684\u76ee\u5f55\uff09\u751f\u6210\u4ee5\u4e0a\u6587\u4ef6 </p> </li> </ol> <p></p>"},{"location":"Git/Git/#\u521b\u5efa\u4ed3\u5e93\u521d\u59cb\u5316","title":"\u521b\u5efa\u4ed3\u5e93\uff08\u521d\u59cb\u5316\uff09","text":"<ol> <li>\u672c\u5730\u521b\u5efa</li> </ol> <p>\u4f7f\u7528\u5f53\u524d\u76ee\u5f55\u4f5c\u4e3a\u4ed3\u5e93\uff0c\u53ea\u9700\u8981\u5728\u8be5\u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>git init\n</code></pre> <p>\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u751f\u6210\u4e00\u4e2a.git\u76ee\u5f55</p> <p>\u4f7f\u7528\u6307\u5b9a\u76ee\u5f55\u4f5c\u4e3a\u4ed3\u5e93\uff1a</p> <pre><code>git init &lt;directory&gt;\n</code></pre> <ol> <li>\u4ece\u73b0\u6709git\u4ed3\u5e93\u83b7\u53d6</li> </ol> <p>\u4f7f\u7528git clone\u547d\u4ee4\u4ece\u73b0\u6709git\u4ed3\u5e93\u62f7\u8d1d\u9879\u76ee</p> <pre><code>git clone &lt;repo-url&gt; {&lt;directory&gt;}\n</code></pre>"},{"location":"Git/Git/#\u76f8\u5173\u6307\u4ee4","title":"\u76f8\u5173\u6307\u4ee4","text":""},{"location":"Git/Git/#\u57fa\u672c\u547d\u4ee4","title":"\u57fa\u672c\u547d\u4ee4","text":"\u547d\u4ee4 \u8bf4\u660e git add \u6dfb\u52a0\u6587\u4ef6\u5230\u6682\u5b58\u533a git status \u67e5\u770b\u5f53\u524d\u4ed3\u5e93\u7684\u72b6\u6001\uff0c\u663e\u793a\u6709\u53d8\u66f4\u7684\u6587\u4ef6 git diff \u6bd4\u8f83\u6587\u4ef6\u7684\u4e0d\u540c\uff0c\u5373\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u7684\u5dee\u5f02 git commit \u63d0\u4ea4\u6682\u5b58\u533a\u5230\u672c\u5730\u4ed3\u5e93 git reset \u56de\u9000\u7248\u672c git rm \u4ece\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u5220\u9664\u6587\u4ef6 git mv \u79fb\u52a8\u6216\u91cd\u547d\u540d\u5de5\u4f5c\u533a\u6587\u4ef6 git checkout \u5207\u6362\u5206\u652f git switch \u66f4\u6e05\u6670\u5730\u5207\u6362\u5206\u652f git restore \u6062\u590d\u6216\u64a4\u9500\u6587\u4ef6\u7684\u66f4\u6539"},{"location":"Git/Git/#\u63d0\u4ea4\u65e5\u5fd7","title":"\u63d0\u4ea4\u65e5\u5fd7","text":"\u547d\u4ee4 \u8bf4\u660e git log \u67e5\u770b\u63d0\u4ea4\u8bb0\u5f55 git blame  \u4ee5\u5217\u8868\u5f62\u5f0f\u67e5\u770b\u6307\u5b9a\u6587\u4ef6\u7684\u5386\u53f2\u4fee\u6539\u8bb0\u5f55"},{"location":"Git/Git/#\u8fdc\u7a0b\u64cd\u4f5c","title":"\u8fdc\u7a0b\u64cd\u4f5c","text":"\u547d\u4ee4 \u8bf4\u660e git remote \u8fdc\u7a0b\u4ed3\u5e93\u64cd\u4f5c git fetch \u4ece\u8fdc\u7a0b\u83b7\u53d6\u4ee3\u7801\u5e93 git pull \u4e0b\u8f7d\u8fdc\u7a0b\u4ee3\u7801\u5e76\u5408\u5e76\u5230\u672c\u5730 git push \u4e0a\u4f20\u8fdc\u7a0b\u4ee3\u7801\u5e76\u5408\u5e76 <p>\u6dfb\u52a0\u8fdc\u7a0b\u4ed3\u5e93\uff1a</p> <pre><code>git remote add &lt;remote_name&gt; &lt;url&gt;\n</code></pre> <p>\u67e5\u770b\u8fdc\u7a0b\u4ed3\u5e93\u4fe1\u606f\uff1a</p> <pre><code>git remote {-v}\n</code></pre> <p>\u5220\u9664\u8fdc\u7a0b\u4ed3\u5e93\uff1a</p> <pre><code>git remote remove &lt;remote_name&gt;\n</code></pre> <p>\u8bbe\u7f6e\u9ed8\u8ba4\u751f\u6210\u4ed3\u5e93\uff1a</p> <pre><code>git push -u &lt;remote_name&gt; &lt;local_branch&gt;\n</code></pre>"},{"location":"Git/Git/#git\u6807\u7b7e","title":"git\u6807\u7b7e","text":"<p>\u5f00\u53d1\u7684\u67d0\u4e00\u91cd\u8981\u9636\u6bb5\uff0c\u7ed9\u5feb\u7167\u6253\u4e0a\u6807\u7b7e\uff1a</p> <pre><code>git tag -a v1.0\n</code></pre> <p>-a \u53c2\u6570\u4f1a\u8bb0\u5f55\u6807\u7b7e\u7684\u65f6\u95f4\u4ee5\u53ca\u6807\u7b7e\u7684\u521b\u5efa\u8005</p> <p>\u53ef\u4ee5\u4e3a\u5df2\u7ecf\u63d0\u4ea4\u7684\u5feb\u7167\u8ffd\u52a0\u6807\u7b7e\uff1a</p> <pre><code>git tag -a v0.9 &lt;\u8be5\u5feb\u7167\u7684hash\u503c&gt;\n</code></pre> <p>\u67e5\u770b\u6240\u6709\u6807\u7b7e\uff1a</p> <pre><code>git tag\n</code></pre> <p>\u6307\u5b9a\u6807\u7b7e\u4fe1\u606f\uff1a</p> <pre><code>git tag -a &lt;tag_name&gt; -m \"&lt;\u6807\u7b7e\u4fe1\u606f&gt;\"\n</code></pre>"},{"location":"Git/Git/#\u5206\u652f\u7ba1\u7406","title":"\u5206\u652f\u7ba1\u7406","text":"<p>\u521b\u5efa\u5206\u652f\uff1a</p> <pre><code>git branch &lt;branch_name&gt;\n</code></pre> <p>\u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\uff1a</p> <pre><code>git checkout|switch &lt;branch_name&gt;\n</code></pre> <p>\u663e\u793a\u6240\u6709\u5206\u652f\uff1a</p> <pre><code>git branch\n</code></pre> <p>\u5220\u9664\u5206\u652f\uff1a</p> <pre><code>git branch -d &lt;branch_name&gt;\n</code></pre> <p>\u5408\u5e76\u5206\u652f\uff1a</p> <pre><code>git merge\n</code></pre>"},{"location":"JVM/JVM-advance/","title":"JVM\u8fdb\u9636","text":""},{"location":"JVM/JVM-advance/#graalvm","title":"GraalVM","text":""},{"location":"JVM/JVM-advance/#\u7b80\u4ecb","title":"\u7b80\u4ecb","text":"<p>GraalVM\u662fOracle\u5b98\u65b9\u63a8\u51fa\u7684\u4e00\u6b3e\u9ad8\u6027\u80fdJDK\uff0c\u4f7f\u7528\u5b83\u4eab\u53d7\u6bd4OpenJDK\u6216\u8005OracleJDK\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>GraalVM\u7684\u5b98\u65b9\u7f51\u5740\uff1a https://www.graalvm.org/</p> <ul> <li> <p>\u66f4\u4f4e\u7684CPU\u3001\u5185\u5b58\u4f7f\u7528\u7387\u3002</p> </li> <li> <p>\u66f4\u5feb\u7684\u542f\u52a8\u901f\u5ea6\uff0c\u65e0\u9700\u9884\u70ed\u5373\u53ef\u83b7\u5f97\u6700\u597d\u7684\u6027\u80fd\u3002</p> </li> <li> <p>\u66f4\u597d\u7684\u5b89\u5168\u6027\u3001\u66f4\u5c0f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> </li> <li> <p>\u652f\u6301\u591a\u79cd\u6846\u67b6Spring Boot\u3001Micronaut\u3001Helidon \u548c Quarkus\u3002</p> </li> <li> <p>\u591a\u5bb6\u4e91\u5e73\u53f0\u652f\u6301\u3002</p> </li> <li> <p>\u901a\u8fc7Truffle\u6846\u67b6\u8fd0\u884cJS\u3001Python\u3001Ruby\u7b49\u5176\u4ed6\u8bed\u8a00\u3002</p> </li> </ul>"},{"location":"JVM/JVM-advance/#linux\u793e\u533a\u7248graalvm\u73af\u5883\u642d\u5efa","title":"Linux\u793e\u533a\u7248GraalVM\u73af\u5883\u642d\u5efa","text":"<ol> <li> <p>\u4f7f\u7528<code>arch</code>\u547d\u4ee4\u67e5\u770bLinux\u67b6\u6784</p> </li> <li> <p>\u6839\u636e\u67b6\u6784\u4e0b\u8f7d\u793e\u533a\u7248\u7684GraalVM</p> </li> <li> <p>\u5b89\u88c5GraalVM\uff0c\u5b89\u88c5\u65b9\u5f0f\u4e0e\u5b89\u88c5JDK\u76f8\u540c\u3002</p> </li> <li> <p>\u4f7f\u7528java -version\u548cHelloWorld\u6d4b\u8bd5GraalVM\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#graalvm\u7684\u4e24\u79cd\u8fd0\u884c\u6a21\u5f0f","title":"GraalVM\u7684\u4e24\u79cd\u8fd0\u884c\u6a21\u5f0f","text":"<ol> <li> <p>JIT\uff08 Just-In-Time \uff09\u6a21\u5f0f \uff0c\u5373\u65f6\u7f16\u8bd1\u6a21\u5f0f</p> <p>JIT\u6a21\u5f0f\u7684\u5904\u7406\u65b9\u5f0f\u4e0eOracle JDK\u7c7b\u4f3c\uff0c\u6ee1\u8db3\u4e24\u4e2a\u7279\u70b9\uff1a</p> <ul> <li> <p>\u4e00\u6b21\u7f16\u5199\uff0c\u968f\u5904\u8fd0\u884c\u3002</p> </li> <li> <p>\u9884\u70ed\u4e4b\u540e\uff0c\u901a\u8fc7\u5185\u7f6e\u7684Graal\u5373\u65f6\u7f16\u8bd1\u5668\u4f18\u5316\u70ed\u70b9\u4ee3\u7801\uff0c\u751f\u6210\u6bd4Hotspot JIT\u66f4\u9ad8\u6027\u80fd\u7684\u673a\u5668\u7801\u3002</p> </li> </ul> </li> <li> <p>AOT\uff08Ahead-Of-Time\uff09\u6a21\u5f0f \uff0c\u63d0\u524d\u7f16\u8bd1\u6a21\u5f0f</p> <p>AOT \u7f16\u8bd1\u5668\u901a\u8fc7\u6e90\u4ee3\u7801\uff0c\u4e3a\u7279\u5b9a\u5e73\u53f0\u521b\u5efa\u53ef\u6267\u884c\u6587\u4ef6\u3002\u6bd4\u5982\uff0c\u5728Windows\u4e0b\u7f16\u8bd1\u5b8c\u6210\u4e4b\u540e\uff0c\u4f1a\u751f\u6210exe\u6587\u4ef6\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u8fbe\u5230\u542f\u52a8\u4e4b\u540e\u83b7\u5f97\u6700\u9ad8\u6027\u80fd\u7684\u76ee\u7684\u3002\u4f46\u662f\u4e0d\u5177\u5907\u8de8\u5e73\u53f0\u7279\u6027\uff0c\u4e0d\u540c\u5e73\u53f0\u4f7f\u7528\u9700\u8981\u5355\u72ec\u7f16\u8bd1\u3002\u8fd9\u79cd\u6a21\u5f0f\u751f\u6210\u7684\u6587\u4ef6\u79f0\u4e4b\u4e3aNative Image\u672c\u5730\u955c\u50cf\u3002</p> </li> </ol> <p></p>"},{"location":"JVM/JVM-advance/#\u4f7f\u7528graalvm-aot\u6a21\u5f0f\u5236\u4f5c\u672c\u5730\u955c\u50cf\u5e76\u8fd0\u884c","title":"\u4f7f\u7528GraalVM AOT\u6a21\u5f0f\u5236\u4f5c\u672c\u5730\u955c\u50cf\u5e76\u8fd0\u884c","text":"<ol> <li> <p>\u5b89\u88c5Linux\u73af\u5883\u672c\u5730\u955c\u50cf\u5236\u4f5c\u9700\u8981\u7684\u4f9d\u8d56\u5e93 </p> </li> <li> <p>\u4f7f\u7528<code>native-image \u7c7b\u540d</code> \u5236\u4f5c\u672c\u5730\u955c\u50cf\u3002\uff08\u9700\u8981\u5148\u5c06\u7c7b\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210class\u6587\u4ef6\uff09</p> </li> <li> <p>\u8fd0\u884c\u672c\u5730\u955c\u50cf\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#graalvm\u5b58\u5728\u7684\u95ee\u9898","title":"GraalVM\u5b58\u5728\u7684\u95ee\u9898","text":"<p>GraalVM\u7684AOT\u6a21\u5f0f\u867d\u7136\u5728\u542f\u52a8\u901f\u5ea6\u3001\u5185\u5b58\u548cCPU\u5f00\u9500\u4e0a\u975e\u5e38\u6709\u4f18\u52bf\uff0c\u4f46\u662f\u4f7f\u7528\u8fd9\u79cd\u6280\u672f\u4f1a\u5e26\u6765\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ol> <li> <p>\u8de8\u5e73\u53f0\u95ee\u9898\uff0c\u5728\u4e0d\u540c\u5e73\u53f0\u4e0b\u8fd0\u884c\u9700\u8981\u7f16\u8bd1\u591a\u6b21\u3002\u7f16\u8bd1\u5e73\u53f0\u7684\u4f9d\u8d56\u5e93\u7b49\u73af\u5883\u8981\u4e0e\u8fd0\u884c\u5e73\u53f0\u4fdd\u6301\u4e00\u81f4\u3002</p> </li> <li> <p>\u4f7f\u7528\u6846\u67b6\u4e4b\u540e\uff0c\u7f16\u8bd1\u672c\u5730\u955c\u50cf\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u6d88\u8017\u5927\u91cf\u7684CPU\u548c\u5185\u5b58\u3002</p> </li> <li> <p>AOT \u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u65f6\uff0c\u9700\u8981\u77e5\u9053\u8fd0\u884c\u65f6\u6240\u6709\u53ef\u8bbf\u95ee\u7684\u6240\u6709\u7c7b\u3002\u4f46\u662fJava\u4e2d\u6709\u4e00\u4e9b\u6280\u672f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u521b\u5efa\u7c7b\uff0c\u4f8b\u5982\u53cd\u5c04\u3001\u52a8\u6001\u4ee3\u7406\u7b49\u3002\u8fd9\u4e9b\u6280\u672f\u5728\u5f88\u591a\u6846\u67b6\u6bd4\u5982Spring\u4e2d\u5927\u91cf\u4f7f\u7528\uff0c\u6240\u4ee5\u6846\u67b6\u9700\u8981\u5bf9AOT\u7f16\u8bd1\u5668\u8fdb\u884c\u9002\u914d\u89e3\u51b3\u7c7b\u4f3c\u7684\u95ee\u9898\u3002</p> </li> </ol> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li> <p>\u4f7f\u7528\u516c\u6709\u4e91\u7684Docker\u7b49\u5bb9\u5668\u5316\u5e73\u53f0\u8fdb\u884c\u5728\u7ebf\u7f16\u8bd1\uff0c\u786e\u4fdd\u7f16\u8bd1\u73af\u5883\u548c\u8fd0\u884c\u73af\u5883\u662f\u4e00\u81f4\u7684\uff0c\u540c\u65f6\u89e3\u51b3\u4e86\u7f16\u8bd1\u8d44\u6e90\u95ee\u9898\u3002</p> </li> <li> <p>\u4f7f\u7528SpringBoot3\u7b49\u6574\u5408\u4e86GraalVM AOT\u6a21\u5f0f\u7684\u6846\u67b6\u7248\u672c\u3002</p> </li> </ol> <p>\u6848\u4f8b\uff1a\u4f7f\u7528SpringBoot3\u642d\u5efaGraalVM\u73af\u5883</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u4f7f\u7528 https://start.spring.io/ \u5728\u7ebf\u751f\u6210\u5668\u6784\u5efa\u9879\u76ee\uff0c\u6dfb\u52a0\u4f9d\u8d56 <code>GraalVM Native Support</code></p> </li> <li> <p>\u7f16\u5199\u4e1a\u52a1\u4ee3\u7801\u3002</p> </li> <li> <p>\u6267\u884c<code>mvn -Pnative clean native:compile</code> \u547d\u4ee4\u751f\u6210\u672c\u5730\u955c\u50cf\u3002</p> </li> <li> <p>\u8fd0\u884c\u672c\u5730\u955c\u50cf</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u4ec0\u4e48\u573a\u666f\u4e0b\u9700\u8981\u4f7f\u7528graalvm","title":"\u4ec0\u4e48\u573a\u666f\u4e0b\u9700\u8981\u4f7f\u7528GraalVM","text":"<ol> <li> <p>\u5bf9\u6027\u80fd\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528\u6536\u8d39\u7684\u4f01\u4e1a\u7248\u63d0\u5347\u6027\u80fd\u3002</p> </li> <li> <p>\u516c\u6709\u4e91\u7684\u90e8\u5206\u670d\u52a1\u662f\u6309\u7167CPU\u548c\u5185\u5b58\u4f7f\u7528\u91cf\u8fdb\u884c\u8ba1\u8d39\u7684\uff0c\u4f7f\u7528GraalVM\u53ef\u4ee5\u6709\u6548\u5730\u964d\u4f4e\u8d39\u7528\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#graalvm\u4f01\u4e1a\u7ea7\u5e94\u7528-serverless\u67b6\u6784","title":"GraalVM\u4f01\u4e1a\u7ea7\u5e94\u7528-Serverless\u67b6\u6784","text":"<p>\u4f20\u7edf\u7684\u7cfb\u7edf\u67b6\u6784\u4e2d\uff0c\u670d\u52a1\u5668\u7b49\u57fa\u7840\u8bbe\u65bd\u7684\u8fd0\u7ef4\u3001\u5b89\u5168\u3001\u9ad8\u53ef\u7528\u7b49\u5de5\u4f5c\u90fd\u9700\u8981\u4f01\u4e1a\u81ea\u884c\u5b8c\u6210\uff0c\u5b58\u5728\u4e24\u4e2a\u4e3b\u8981\u95ee\u9898\uff1a</p> <ol> <li> <p>\u5f00\u9500\u5927\uff0c\u5305\u62ec\u4e86\u4eba\u529b\u7684\u5f00\u9500\u3001\u673a\u623f\u5efa\u8bbe\u7684\u5f00\u9500\u3002</p> </li> <li> <p>\u8d44\u6e90\u6d6a\u8d39\uff0c\u9762\u5bf9\u4e00\u4e9b\u7a81\u53d1\u7684\u6d41\u91cf\u51b2\u51fb\uff0c\u6bd4\u5982\u79d2\u6740\u7b49\u6d3b\u52a8\uff0c\u5fc5\u987b\u63d0\u524d\u89c4\u5212\u597d\u5bb9\u91cf\u51c6\u5907\u597d\u5927\u91cf\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u4e9b\u670d\u52a1\u5668\u5728\u5176\u4ed6\u65f6\u5019\u4f1a\u5904\u4e8e\u95f2\u7f6e\u7684\u72b6\u6001\uff0c\u9020\u6210\u5927\u91cf\u7684\u6d6a\u8d39\u3002</p> </li> </ol> <p></p> <p>\u968f\u7740\u865a\u62df\u5316\u6280\u672f\u3001\u4e91\u539f\u751f\u6280\u672f\u7684\u6108\u53d1\u6210\u719f\uff0c\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u4e86\u4e00\u5957\u79f0\u4e3aServerless\u65e0\u670d\u52a1\u5668\u5316\u7684\u67b6\u6784\u3002\u4f01\u4e1a\u65e0\u9700\u8fdb\u884c\u670d\u52a1\u5668\u7684\u4efb\u4f55\u914d\u7f6e\u548c\u90e8\u7f72\uff0c\u5b8c\u5168\u7531\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u3002\u6bd4\u8f83\u5178\u578b\u7684\u6709\u4e9a\u9a6c\u900aAWS\u3001\u963f\u91cc\u4e91\u7b49\u3002</p> <p>Serverless\u67b6\u6784\u4e2d\u7b2c\u4e00\u79cd\u5e38\u89c1\u7684\u670d\u52a1\u662f\u51fd\u6570\u8ba1\u7b97\uff08Function as a Service\uff09\uff0c\u5c06\u4e00\u4e2a\u5e94\u7528\u62c6\u5206\u6210\u591a\u4e2a\u51fd\u6570\uff0c\u6bcf\u4e2a\u51fd\u6570\u4f1a\u4ee5\u4e8b\u4ef6\u9a71\u52a8\u7684\u65b9\u5f0f\u89e6\u53d1\u3002\u5178\u578b\u4ee3\u8868\u6709AWS\u7684Lambda\u3001\u963f\u91cc\u4e91\u7684FC\u3002</p> <p>\u51fd\u6570\u8ba1\u7b97\u7684\u670d\u52a1\u8d44\u6e90\u6bd4\u8f83\u53d7\u9650\uff0c\u6bd4\u5982AWS\u7684Lambda\u670d\u52a1\u4e00\u822c\u65e0\u6cd5\u652f\u6301\u8d85\u8fc715\u5206\u949f\u7684\u51fd\u6570\u6267\u884c\uff0c\u6240\u4ee5\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u4e86\u53e6\u5916\u4e00\u5957\u65b9\u6848\uff1a\u57fa\u4e8e\u5bb9\u5668\u7684Serverless\u5e94\u7528\uff0c\u65e0\u9700\u624b\u52a8\u914d\u7f6eK8s\u4e2d\u7684Pod\u3001Service\u7b49\u5185\u5bb9\uff0c\u53ea\u9700\u9009\u62e9\u955c\u50cf\u5c31\u53ef\u81ea\u52a8\u751f\u6210\u5e94\u7528\u670d\u52a1\u3002</p> <p>\u540c\u6837\uff0cServerless\u5e94\u7528\u7684\u8ba1\u8d39\u6807\u51c6\u4e2d\u5305\u542bCPU\u548c\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u6240\u4ee5\u4f7f\u7528GraalVM AOT\u6a21\u5f0f\u7f16\u8bd1\u51fa\u6765\u7684\u672c\u5730\u955c\u50cf\u53ef\u4ee5\u8282\u7701\u66f4\u591a\u7684\u6210\u672c\u3002</p> <p></p>"},{"location":"JVM/JVM-advance/#graalvm\u7684\u5185\u5b58\u53c2\u6570","title":"GraalVM\u7684\u5185\u5b58\u53c2\u6570","text":"<p>\u7531\u4e8eGraalVM\u662f\u4e00\u6b3e\u72ec\u7acb\u7684JDK\uff0c\u6240\u4ee5\u5927\u90e8\u5206HotSpot\u4e2d\u7684\u865a\u62df\u673a\u53c2\u6570\u90fd\u4e0d\u9002\u7528\u3002</p> <p>\u5e38\u7528\u7684\u53c2\u6570\u53c2\u8003\uff1a\u5b98\u65b9\u624b\u518c\u3002</p> <ul> <li> <p>\u793e\u533a\u7248\u53ea\u80fd\u4f7f\u7528\u4e32\u884c\u5783\u573e\u56de\u6536\u5668\uff08Serial GC\uff09\uff0c\u4f7f\u7528\u4e32\u884c\u5783\u573e\u56de\u6536\u5668\u7684\u9ed8\u8ba4\u6700\u5927 Java \u5806\u5927\u5c0f\u4f1a\u8bbe\u7f6e\u4e3a\u7269\u7406\u5185\u5b58\u5927\u5c0f\u7684 80%\uff0c\u8c03\u6574\u65b9\u5f0f\u4e3a\u4f7f\u7528<code>-Xmx \u6700\u5927\u5806\u5927\u5c0f</code>\u3002\u5982\u679c\u5e0c\u671b\u5728\u7f16\u8bd1\u671f\u5c31\u6307\u5b9a\u8be5\u5927\u5c0f\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u6dfb\u52a0\u53c2\u6570<code>-R:MaxHeapSize=\u6700\u5927\u5806\u5927\u5c0f</code>\u3002</p> </li> <li> <p>G1\u5783\u573e\u56de\u6536\u5668\u53ea\u80fd\u5728\u4f01\u4e1a\u7248\u4e2d\u4f7f\u7528\uff0c\u5f00\u542f\u65b9\u5f0f\u4e3a\u6dfb\u52a0<code>--gc=G1</code>\u53c2\u6570\uff0c\u6709\u6548\u964d\u4f4e\u5783\u573e\u56de\u6536\u7684\u5ef6\u8fdf\u3002</p> </li> <li> <p>\u53e6\u5916\u63d0\u4f9b\u4e00\u4e2aEpsilon GC\uff0c\u5f00\u542f\u65b9\u5f0f\uff1a<code>--gc=epsilon</code> \uff0c\u5b83\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u7684\u5783\u573e\u56de\u6536\u884c\u4e3a\u6240\u4ee5\u6ca1\u6709\u989d\u5916\u7684\u5185\u5b58\u3001CPU\u5f00\u9500\u3002\u5982\u679c\u5728\u516c\u6709\u4e91\u4e0a\u8fd0\u884c\u7684\u7a0b\u5e8f\u751f\u547d\u5468\u671f\u77ed\u6682\u4e0d\u4ea7\u751f\u5927\u91cf\u7684\u5bf9\u8c61\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u5783\u573e\u56de\u6536\u5668\uff0c\u4ee5\u8282\u7701\u6700\u5927\u7684\u8d44\u6e90\u3002</p> </li> <li> <p><code>-XX:+PrintGC -XX:+VerboseGC</code> \u53c2\u6570\u6253\u5370\u5783\u573e\u56de\u6536\u8be6\u7ec6\u4fe1\u606f\u3002</p> </li> </ul>"},{"location":"JVM/JVM-advance/#graalvm\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u7684\u83b7\u53d6aot\u6a21\u5f0f","title":"GraalVM\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u7684\u83b7\u53d6(AOT\u6a21\u5f0f)","text":"<p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u7f16\u8bd1\u7a0b\u5e8f\u65f6\uff0c\u6dfb\u52a0<code>--enable-monitoring=heapdump</code>\u53c2\u6570\u5230pom\u6587\u4ef6\u7684\u5bf9\u5e94\u63d2\u4ef6(<code>native-maven-plugin</code>)\u4e2d\u3002</p> </li> <li> <p>\u8fd0\u884c\u4e2d\u4f7f\u7528<code>kill -SIGUSR1 \u8fdb\u7a0bID</code> \u547d\u4ee4\uff0c\u521b\u5efa\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002</p> </li> <li> <p>\u4f7f\u7528MAT\u5206\u6790\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u8fd0\u884c\u65f6\u6570\u636e\u7684\u83b7\u53d6","title":"\u8fd0\u884c\u65f6\u6570\u636e\u7684\u83b7\u53d6","text":"<p>JDK Flight Recorder (JFR)\u662f\u4e00\u4e2a\u5185\u7f6e\u4e8e JVM \u4e2d\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u6536\u96c6\u6b63\u5728\u8fd0\u884c\u4e2d\u7684 Java \u5e94\u7528\u7a0b\u5e8f\u7684\u8bca\u65ad\u548c\u5206\u6790\u6570\u636e\uff0c\u6bd4\u5982\u7ebf\u7a0b\u3001\u5f02\u5e38\u7b49\u5185\u5bb9\u3002GraalVM\u672c\u5730\u955c\u50cf\u4e5f\u652f\u6301\u4f7f\u7528JFR\u751f\u6210\u8fd0\u884c\u65f6\u6570\u636e\uff0c\u5bfc\u51fa\u7684\u6570\u636e\u53ef\u4ee5\u4f7f\u7528VisualVM\u5206\u6790\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u7f16\u8bd1\u7a0b\u5e8f\u65f6\uff0c\u6dfb\u52a0<code>--enable-monitoring=jfr</code>\u53c2\u6570\u6dfb\u52a0\u5230pom\u6587\u4ef6\u7684\u5bf9\u5e94\u63d2\u4ef6\u4e2d\u3002</p> </li> <li> <p>\u8fd0\u884c\u7a0b\u5e8f\uff0c\u6dfb\u52a0<code>-XX:StartFlightRecording=filename=recording.jfr,duration=10s</code>\u53c2\u6570\u3002</p> </li> <li> <p>\u4f7f\u7528VisualVM\u5206\u6790JFR\u8bb0\u5f55\u6587\u4ef6\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u65b0\u4e00\u4ee3gc","title":"\u65b0\u4e00\u4ee3GC","text":""},{"location":"JVM/JVM-advance/#\u5783\u573e\u56de\u6536\u5668\u7684\u6280\u672f\u6f14\u8fdb","title":"\u5783\u573e\u56de\u6536\u5668\u7684\u6280\u672f\u6f14\u8fdb","text":""},{"location":"JVM/JVM-advance/#shenandoah-gc","title":"Shenandoah GC","text":"<p>Shenandoah \u662f\u7531Red Hat\u5f00\u53d1\u7684\u4e00\u6b3e\u4f4e\u5ef6\u8fdf\u7684\u5783\u573e\u6536\u96c6\u5668\uff0cShenandoah \u5e76\u53d1\u6267\u884c\u5927\u90e8\u5206 GC \u5de5\u4f5c\uff0c\u5305\u62ec\u5e76\u53d1\u7684\u6574\u7406\uff0c\u5806\u5927\u5c0f\u5bf9STW\u7684\u65f6\u95f4\u57fa\u672c\u6ca1\u6709\u5f71\u54cd\u3002</p> <p>Shenandoah\u7684\u4f7f\u7528\u65b9\u6cd5</p> <ol> <li> <p>\u4e0b\u8f7d Shenandoah</p> <p>\u9009\u62e9\u65b9\u5f0f\u5982\u4e0b</p> <p><code>{aarch64, arm32-hflt, mipsel, mips64el, ppc64le, s390x, x86_32, x86_64}</code>\uff1a\u67b6\u6784\uff0c\u4f7f\u7528arch\u547d\u4ee4\u9009\u62e9\u5bf9\u5e94\u7684\u7684\u67b6\u6784\u3002</p> <p><code>{server,zero}</code>\uff1a\u865a\u62df\u673a\u7c7b\u578b\uff0c\u9009\u62e9server\uff0c\u5305\u542b\u6240\u6709GC\u7684\u529f\u80fd\u3002</p> <p><code>{release, fastdebug, Slowdebug, optimization}</code>\uff1a\u4e0d\u540c\u7684\u4f18\u5316\u7ea7\u522b\uff0c\u9009\u62e9release\uff0c\u6027\u80fd\u6700\u9ad8\u3002</p> <p><code>{gcc*-glibc*, msvc*}</code>\uff1a\u7f16\u8bd1\u5668\u7684\u7248\u672c\uff0c\u9009\u62e9\u8f83\u9ad8\u7684\u7248\u672c\u6027\u80fd\u597d\u4e00\u4e9b\uff0c\u5982\u679c\u517c\u5bb9\u6027\u6709\u95ee\u9898\uff08\u65e0\u6cd5\u542f\u52a8\uff09\uff0c\u9009\u62e9\u8f83\u4f4e\u7684\u7248\u672c\u3002</p> </li> <li> <p>\u914d\u7f6e \u5c06OpenJDK\u914d\u7f6e\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u4f7f\u7528<code>java \u2013version</code>\u8fdb\u884c\u6d4b\u8bd5\u3002</p> </li> <li> <p>\u6dfb\u52a0\u53c2\u6570\uff0c\u8fd0\u884cJava\u7a0b\u5e8f\u3002    <code>-XX:+UseShenandoahGC</code>\u5f00\u542fShenandoah GC    <code>-Xlog:gc</code> \u6253\u5370GC\u65e5\u5fd7</p> </li> </ol>"},{"location":"JVM/JVM-advance/#zgc","title":"ZGC","text":"<p>ZGC \u662f\u4e00\u79cd\u53ef\u6269\u5c55\u7684\u4f4e\u5ef6\u8fdf\u5783\u573e\u56de\u6536\u5668\u3002ZGC \u5728\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\uff0cSTW\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7\u4e00\u6beb\u79d2\uff0c\u9002\u5408\u9700\u8981\u4f4e\u5ef6\u8fdf\u7684\u5e94\u7528\u3002\u652f\u6301\u51e0\u767e\u5146\u523016TB \u7684\u5806\u5927\u5c0f\uff0c\u5806\u5927\u5c0f\u5bf9STW\u7684\u65f6\u95f4\u57fa\u672c\u6ca1\u6709\u5f71\u54cd\u3002 </p> <p>ZGC\u964d\u4f4e\u4e86\u505c\u987f\u65f6\u95f4\uff0c\u80fd\u964d\u4f4e\u63a5\u53e3\u7684\u6700\u5927\u8017\u65f6\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002\u4f46\u662f\u541e\u5410\u91cf\u4e0d\u4f73\uff0c\u6240\u4ee5\u5982\u679cJava\u670d\u52a1\u6bd4\u8f83\u5173\u6ce8QPS\uff08\u6bcf\u79d2\u7684\u67e5\u8be2\u6b21\u6570\uff09\u90a3\u4e48G1\u662f\u6bd4\u8f83\u4e0d\u9519\u7684\u9009\u62e9\u3002</p> <p></p> <p>ZGC\u7684\u4f7f\u7528\u65b9\u6cd5:</p> <p>OracleJDK\u548cOpenJDK\u4e2d\u90fd\u652f\u6301ZGC\uff0c\u963f\u91cc\u7684DragonWell\u9f99\u4e95JDK\u4e5f\u652f\u6301ZGC\u4f46\u5c5e\u4e8e\u5176\u81ea\u884c\u5bf9OpenJDK 11\u7684ZGC\u8fdb\u884c\u4f18\u5316\u7684\u7248\u672c\u3002</p> <p>\u5efa\u8bae\u4f7f\u7528JDK17\u4e4b\u540e\u7684\u7248\u672c\uff0c\u5ef6\u8fdf\u8f83\u4f4e\u540c\u65f6\u65e0\u9700\u624b\u52a8\u914d\u7f6e\u5e76\u884c\u7ebf\u7a0b\u6570\u3002</p> <ul> <li> <p>\u5206\u4ee3 ZGC \u6dfb\u52a0\u5982\u4e0b\u53c2\u6570\u542f\u7528 <code>-XX:+UseZGC -XX:+ZGenerational</code> </p> </li> <li> <p>\u975e\u5206\u4ee3 ZGC \u901a\u8fc7\u547d\u4ee4\u884c\u9009\u9879\u542f\u7528 <code>-XX:+UseZGC</code></p> </li> </ul> <p>ZGC\u7684\u53c2\u6570\u8bbe\u7f6e:</p> <p>ZGC\u5728\u8bbe\u8ba1\u4e0a\u505a\u5230\u4e86\u81ea\u9002\u5e94\uff0c\u6839\u636e\u8fd0\u884c\u60c5\u51b5\u81ea\u52a8\u8c03\u6574\u53c2\u6570\uff0c\u8ba9\u7528\u6237\u624b\u52a8\u914d\u7f6e\u7684\u53c2\u6570\u6700\u5c11\u5316\u3002</p> <ul> <li> <p>\u81ea\u52a8\u8bbe\u7f6e\u5e74\u8f7b\u4ee3\u5927\u5c0f\uff0c\u65e0\u9700\u8bbe\u7f6e-Xmn\u53c2\u6570\u3002</p> </li> <li> <p>\u81ea\u52a8\u664b\u5347\u9608\u503c\uff08\u590d\u5236\u4e2d\u5b58\u6d3b\u591a\u5c11\u6b21\u624d\u642c\u8fd0\u5230\u8001\u5e74\u4ee3\uff09\uff0c\u65e0\u9700\u8bbe\u7f6e<code>-XX:TenuringThreshold</code>\u3002</p> </li> <li> <p>JDK17\u4e4b\u540e\u652f\u6301\u81ea\u52a8\u7684\u5e76\u884c\u7ebf\u7a0b\u6570\uff0c\u65e0\u9700\u8bbe\u7f6e<code>-XX:ConcGCThreads</code>\u3002</p> </li> </ul> <p>\u9700\u8981\u8bbe\u7f6e\u7684\u53c2\u6570\uff1a</p> <p><code>-Xmx \u503c</code> \u6700\u5927\u5806\u5185\u5b58\u5927\u5c0f</p> <pre><code>\u8fd9\u662fZGC\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u5fc5\u987b\u8bbe\u7f6e\u3002ZGC\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u4f7f\u7528\u4e00\u90e8\u5206\u5185\u5b58\u7528\u6765\u5904\u7406\u5783\u573e\u56de\u6536\uff0c\u6240\u4ee5\u5c3d\u91cf\u4fdd\u8bc1\u5806\u4e2d\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u3002\u8bbe\u7f6e\u591a\u5c11\u503c\u53d6\u51b3\u4e8e\u5bf9\u8c61\u5206\u914d\u7684\u901f\u5ea6\uff0c\u6839\u636e\u6d4b\u8bd5\u60c5\u51b5\u6765\u51b3\u5b9a\u3002\n</code></pre> <p>\u53ef\u4ee5\u8bbe\u7f6e\u7684\u53c2\u6570\uff1a</p> <p><code>-XX:SoftMaxHeapSize=\u503c</code></p> <pre><code>ZGC\u4f1a\u5c3d\u91cf\u4fdd\u8bc1\u5806\u5185\u5b58\u5c0f\u4e8e\u8be5\u503c\uff0c\u8fd9\u6837\u5728\u5185\u5b58\u9760\u8fd1\u8fd9\u4e2a\u503c\u65f6\u4f1a\u5c3d\u65e9\u5730\u8fdb\u884c\u5783\u573e\u56de\u6536\uff0c\u4f46\u662f\u4f9d\u7136\u6709\u53ef\u80fd\u4f1a\u8d85\u8fc7\u8be5\u503c\u3002\u4f8b\u5982\uff0c-Xmx5g -XX:SoftMaxHeapSize=4g \u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\uff0cZGC\u4f1a\u5c3d\u91cf\u4fdd\u8bc1\u5806\u5185\u5b58\u5c0f\u4e8e4GB\uff0c\u6700\u591a\u4e0d\u4f1a\u8d85\u8fc75GB\u3002\n</code></pre> <p>ZGC\u7684\u8c03\u4f18</p> <p>ZGC \u4e2d\u53ef\u4ee5\u4f7f\u7528Linux\u7684Huge Page\u5927\u9875\u6280\u672f\u4f18\u5316\u6027\u80fd\uff0c\u63d0\u5347\u541e\u5410\u91cf\u3001\u964d\u4f4e\u5ef6\u8fdf\u3002</p> <p>\u6ce8\u610f</p> <p>\u5b89\u88c5\u8fc7\u7a0b\u9700\u8981 root \u6743\u9650\uff0c\u6240\u4ee5ZGC\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u6b64\u529f\u80fd\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u8ba1\u7b97\u6240\u9700\u9875\u6570\uff0cLinux x86\u67b6\u6784\u4e2d\u5927\u9875\u5927\u5c0f\u4e3a2MB\uff0c\u6839\u636e\u6240\u9700\u5806\u5185\u5b58\u7684\u5927\u5c0f\u4f30\u7b97\u5927\u9875\u6570\u91cf\u3002\u6bd4\u5982\u5806\u7a7a\u95f4\u9700\u898116G\uff0c\u9884\u75592G\uff08JVM\u9700\u8981\u989d\u5916\u7684\u4e00\u4e9b\u975e\u5806\u7a7a\u95f4\uff09\uff0c\u90a3\u4e48\u9875\u6570\u5c31\u662f18G / 2MB = 9216\u3002</p> </li> <li> <p>\u914d\u7f6e\u7cfb\u7edf\u7684\u5927\u9875\u6c60\u4ee5\u5177\u6709\u6240\u9700\u7684\u9875\u6570\uff08\u9700\u8981root\u6743\u9650\uff09\uff1a<code>$ echo 9216 &gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages</code></p> </li> <li> <p>\u6dfb\u52a0\u53c2\u6570<code>-XX:+UseLargePages</code> \u542f\u52a8\u7a0b\u5e8f\u8fdb\u884c\u6d4b\u8bd5</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>ZGC\u548cShenandoah\u8bbe\u8ba1\u7684\u76ee\u6807\u90fd\u662f\u8ffd\u6c42\u8f83\u77ed\u7684\u505c\u987f\u65f6\u95f4\uff0c\u4ed6\u4eec\u5177\u4f53\u7684\u4f7f\u7528\u573a\u666f\u5982\u4e0b\uff1a</p> <p>\u4e24\u79cd\u5783\u573e\u56de\u6536\u5668\u5728\u5e76\u884c\u56de\u6536\u65f6\u90fd\u4f1a\u4f7f\u7528\u5783\u573e\u56de\u6536\u7ebf\u7a0b\u5360\u7528CPU\u8d44\u6e90</p> <p>\u2460 \u5728\u5185\u5b58\u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff0cZGC\u5783\u573e\u56de\u6536\u8868\u73b0\u7684\u6548\u679c\u4f1a\u66f4\u597d\uff0c\u505c\u987f\u65f6\u95f4\u66f4\u77ed\u3002</p> <p>\u2461 \u5728\u5185\u5b58\u4e0d\u662f\u7279\u522b\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\uff0cShenandoah GC\u8868\u73b0\u66f4\u597d\uff0c\u5e76\u884c\u5783\u573e\u56de\u6536\u7684\u65f6\u95f4\u8f83\u77ed\uff0c\u7528\u6237\u8bf7\u6c42\u7684\u6267\u884c\u6548\u7387\u6bd4\u8f83\u9ad8\u3002</p>"},{"location":"JVM/JVM-advance/#\u63ed\u79d8java\u5de5\u5177","title":"\u63ed\u79d8Java\u5de5\u5177","text":"<p>Java\u5de5\u5177\u7684\u4ecb\u7ecd\u5728Java\u7684\u4e16\u754c\u4e2d\uff0c\u9664\u4e86Java\u7f16\u5199\u7684\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u7c7b\u7a0b\u5e8f\u4e5f\u9700\u8981Java\u7a0b\u5e8f\u5458\u53c2\u4e0e\u7f16\u5199\uff0c\u8fd9\u7c7b\u7a0b\u5e8f\u5c31\u662fJava\u5de5\u5177\u3002</p> <p>\u5e38\u89c1\u7684Java\u5de5\u5177\u6709\u4ee5\u4e0b\u51e0\u7c7b\uff1a</p> <ol> <li> <p>\u8bca\u65ad\u7c7b\u5de5\u5177\uff0c\u5982Arthas\u3001VisualVM\u7b49\u3002</p> </li> <li> <p>\u5f00\u53d1\u7c7b\u5de5\u5177\uff0c\u5982Idea\u3001Eclipse\u3002</p> </li> <li> <p>APM\u5e94\u7528\u6027\u80fd\u76d1\u6d4b\u5de5\u5177\uff0c\u5982Skywalking\u3001Zipkin\u7b49\u3002</p> </li> <li> <p>\u70ed\u90e8\u7f72\u5de5\u5177\uff0c\u5982Jrebel\u7b49\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#java-agent\u6280\u672f","title":"Java Agent\u6280\u672f","text":"<p>Java Agent\u6280\u672f\u662fJDK\u63d0\u4f9b\u7684\u7528\u6765\u7f16\u5199Java\u5de5\u5177\u7684\u6280\u672f\uff0c\u4f7f\u7528\u8fd9\u79cd\u6280\u672f\u751f\u6210\u4e00\u79cd\u7279\u6b8a\u7684jar\u5305\uff0c\u8fd9\u79cdjar\u5305\u53ef\u4ee5\u8ba9Java\u7a0b\u5e8f\u8fd0\u884c\u5176\u4e2d\u7684\u4ee3\u7801\u3002</p>"},{"location":"JVM/JVM-advance/#\u4e24\u79cd\u6a21\u5f0f","title":"\u4e24\u79cd\u6a21\u5f0f","text":"<p>Java Agent\u6280\u672f\u5b9e\u73b0\u4e86\u8ba9Java\u7a0b\u5e8f\u6267\u884c\u72ec\u7acb\u7684Java Agent\u7a0b\u5e8f\u4e2d\u7684\u4ee3\u7801\uff0c\u6267\u884c\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a</p> <ul> <li> <p>\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f</p> </li> <li> <p>\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f</p> </li> </ul>"},{"location":"JVM/JVM-advance/#\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f","title":"\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f","text":"<p>\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f\u53ef\u4ee5\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u4e00\u5f00\u59cb\u5c31\u6267\u884c\u6211\u4eec\u9700\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u9002\u5408\u7528APM\u7b49\u6027\u80fd\u76d1\u6d4b\u7cfb\u7edf\u4ece\u4e00\u5f00\u59cb\u5c31\u76d1\u63a7\u7a0b\u5e8f\u7684\u6267\u884c\u6027\u80fd\u3002\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f\u9700\u8981\u5728Java Agent\u7684\u9879\u76ee\u4e2d\u7f16\u5199\u4e00\u4e2apremain\u7684\u65b9\u6cd5\uff0c\u5e76\u6253\u5305\u6210jar\u5305\u3002</p> <pre><code>public static viod premain(String agentArgs, Instrumentation inst)\n</code></pre> <p>\u63a5\u4e0b\u6765\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8Java\u7a0b\u5e8f\uff0c\u6b64\u65f6Java\u865a\u62df\u673a\u5c06\u4f1a\u52a0\u8f7dagent\u4e2d\u7684\u4ee3\u7801\u5e76\u6267\u884c\u3002</p> <pre><code>java -javaagent:./agent.jar -jar test.jar\n</code></pre> <p>permain\u65b9\u6cd5\u4f1a\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c</p>"},{"location":"JVM/JVM-advance/#\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f","title":"\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f","text":"<p>\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f\u53ef\u4ee5\u968f\u65f6\u8ba9java agent\u4ee3\u7801\u6267\u884c\uff0c\u9002\u7528\u4e8eArthas\u7b49\u8bca\u65ad\u7cfb\u7edf\u3002\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f\u9700\u8981\u5728Java Agent\u7684\u9879\u76ee\u4e2d\u7f16\u5199\u4e00\u4e2aagentmain\u7684\u65b9\u6cd5\uff0c\u5e76\u6253\u5305\u6210jar\u5305\u3002</p> <pre><code>public static void agentmain(String agentArgs, Instrumentation inst)\n</code></pre> <p>\u63a5\u4e0b\u6765\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801\u5c31\u53ef\u4ee5\u8ba9java agent\u4ee3\u7801\u5728\u6307\u5b9a\u7684java\u8fdb\u7a0b\u4e2d\u6267\u884c\u4e86:</p> <pre><code>VirtualMachine vm = VirtualMachine.attach(\"24200\");//\u52a8\u6001\u8fde\u63a5\u523024200\u8fdb\u7a0bID\u7684java\u7a0b\u5e8f\nvm.loadAgent(\"test.jar\");//\u52a0\u8f7djava agent\n</code></pre> <p>agentmain\u65b9\u6cd5\u4f1a\u5728\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e2d\u6267\u884c</p>"},{"location":"JVM/JVM-advance/#\u73af\u5883\u642d\u5efa","title":"\u73af\u5883\u642d\u5efa","text":"<ul> <li>\u9759\u6001\u52a0\u8f7d</li> </ul> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u521b\u5efamaven\u9879\u76ee\uff0c\u6dfb\u52a0<code>maven-assembly-plugin</code>\u63d2\u4ef6\uff0c\u6b64\u63d2\u4ef6\u53ef\u4ee5\u6253\u5305\u51fajava agent\u7684jar\u5305\u3002</p> </li> <li> <p>\u7f16\u5199\u7c7b\u548cpremain\u65b9\u6cd5\uff0cpremain\u65b9\u6cd5\u4e2d\u6253\u5370\u4e00\u884c\u4fe1\u606f\u3002</p> </li> <li> <p>\u7f16\u5199<code>MANIFEST.MF</code>\u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u4e3b\u8981\u7528\u4e8e\u63cf\u8ff0java agent\u7684\u914d\u7f6e\u5c5e\u6027\uff0c\u6bd4\u5982\u4f7f\u7528\u54ea\u4e00\u4e2a\u7c7b\u7684premain\u65b9\u6cd5\u3002</p> </li> <li> <p>\u4f7f\u7528maven-assembly-plugin\u8fdb\u884c\u6253\u5305\u3002</p> </li> <li> <p>\u521b\u5efaspring boot\u5e94\u7528\uff0c\u5e76\u9759\u6001\u52a0\u8f7d\u4e0a\u4e00\u6b65\u6253\u5305\u5b8c\u7684java agent\u3002</p> </li> </ol> <p></p> <ul> <li>\u52a8\u6001\u52a0\u8f7d</li> </ul> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u521b\u5efamaven\u9879\u76ee\uff0c\u6dfb\u52a0maven-assembly-plugin\u63d2\u4ef6\uff0c\u6b64\u63d2\u4ef6\u53ef\u4ee5\u6253\u5305\u51fajava agent\u7684jar\u5305\u3002</p> </li> <li> <p>\u7f16\u5199\u7c7b\u548cagentmain\u65b9\u6cd5\uff0c agentmain\u65b9\u6cd5\u4e2d\u6253\u5370\u4e00\u884c\u4fe1\u606f\u3002</p> </li> <li> <p>\u7f16\u5199MANIFEST.MF\u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u4e3b\u8981\u7528\u4e8e\u63cf\u8ff0java agent\u7684\u914d\u7f6e\u5c5e\u6027\uff0c\u6bd4\u5982\u4f7f\u7528\u54ea\u4e00\u4e2a\u7c7b\u7684agentmain\u65b9\u6cd5\u3002</p> </li> <li> <p>\u4f7f\u7528maven-assembly-plugin\u8fdb\u884c\u6253\u5305\u3002</p> </li> <li> <p>\u7f16\u5199main\u65b9\u6cd5\uff0c\u52a8\u6001\u8fde\u63a5\u5230\u8fd0\u884c\u4e2d\u7684java\u7a0b\u5e8f\u3002</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u6848\u4f8b1\u7b80\u5316\u7248arthas","title":"\u6848\u4f8b1\uff1a\u7b80\u5316\u7248Arthas","text":"<p>\u7f16\u5199\u4e00\u4e2a\u7b80\u5316\u7248\u7684Arthas\u7a0b\u5e8f\uff0c\u5177\u5907\u4ee5\u4e0b\u51e0\u4e2a\u529f\u80fd\uff1a</p> <ol> <li> <p>\u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5</p> </li> <li> <p>\u751f\u6210\u5806\u5185\u5b58\u5feb\u7167</p> </li> <li> <p>\u6253\u5370\u6808\u4fe1\u606f</p> </li> <li> <p>\u6253\u5370\u7c7b\u52a0\u8f7d\u5668</p> </li> <li> <p>\u6253\u5370\u7c7b\u7684\u6e90\u7801</p> </li> <li> <p>\u6253\u5370\u65b9\u6cd5\u6267\u884c\u7684\u53c2\u6570\u548c\u8017\u65f6</p> </li> </ol>"},{"location":"JVM/JVM-advance/#\u83b7\u53d6\u8fd0\u884c\u65f6\u4fe1\u606f--jmx\u6280\u672f","title":"\u83b7\u53d6\u8fd0\u884c\u65f6\u4fe1\u606f- JMX\u6280\u672f","text":"<p>JDK\u4ece1.5\u5f00\u59cb\u63d0\u4f9b\u4e86Java Management Extensions (JMX) \u6280\u672f\uff0c\u901a\u8fc7Mbean\u5bf9\u8c61\u7684\u5199\u5165\u548c\u83b7\u53d6\uff0c\u5b9e\u73b0\uff1a</p> <ul> <li> <p>\u8fd0\u884c\u65f6\u914d\u7f6e\u7684\u83b7\u53d6\u548c\u66f4\u6539</p> </li> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u4fe1\u606f\u7684\u83b7\u53d6\uff08\u7ebf\u7a0b\u6808\u3001\u5185\u5b58\u3001\u7c7b\u4fe1\u606f\u7b49\uff09</p> </li> </ul> <p>\u83b7\u53d6JVM\u9ed8\u8ba4\u63d0\u4f9b\u7684Mbean\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982\u83b7\u53d6\u5185\u5b58\u4fe1\u606f\uff1a</p> <pre><code>List&lt;MemoryPoolMXBean&gt; mxBeanList = ManagementFactory.getMemoryPoolMXBeans();\n\nmxBeanList.stream().filter(bean -&gt; bean.getType().equals(MemoryType.HEAP))\n                .forEach(\n                        x -&gt; {\n                            StringBuilder sb = new StringBuilder();\n                            sb.append(\"\\tname:\")\n                                    .append(x.getName())\n                                    .append(\"\\n\")\n                                    .append(\"\\tused:\\t\\t\")\n                                    .append(x.getUsage().getUsed() / 1024 / 1024)\n                                    .append(\"m\\n\")\n                                    .append(\"\\tcommitted:\\t\")\n                                    .append(x.getUsage().getCommitted() / 1024 / 1024)\n                                    .append(\"m\\n\")\n                                    .append(\"\\tmax:\\t\\t\")\n                                    .append(x.getUsage().getMax() / 1024 / 1024)\n                                    .append(\"m\\n\")\n                                    .append(\"================================================\");\n                            System.out.println(sb);\n                        }\n                );\n</code></pre> <p>\u751f\u6210\u5185\u5b58\u5feb\u7167</p> <pre><code>// \u751f\u6210\u5185\u5b58\u5feb\u7167\n    public static void heapDump(){\n        SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd-HH-mm\");\n        HotSpotDiagnosticMXBean bean = ManagementFactory.getPlatformMXBean(HotSpotDiagnosticMXBean.class);\n\n        try {\n            System.out.println(\"\u5f00\u59cb\u751f\u6210\u5185\u5b58\u5feb\u7167...\");\n            bean.dumpHeap(dateFormat.format(new Date())+ \".hprof\", true);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n</code></pre> <p>\u83b7\u53d6\u7ebf\u7a0b\u4fe1\u606f</p> <pre><code>// \u83b7\u53d6\u7ebf\u7a0b\u8fd0\u884c\u4fe1\u606f\n    public static void printThreadInfo() {\n        ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();\n\n        ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(\n                threadMXBean.isObjectMonitorUsageSupported(), threadMXBean.isSynchronizerUsageSupported());\n\n        for (ThreadInfo threadInfo : threadInfos) {\n            StringBuilder sb = new StringBuilder();\n            sb.append(\"name:\")\n                    .append(threadInfo.getThreadName())\n                    .append(\"\\nthreadID:\")\n                    .append(threadInfo.getThreadId())\n                    .append(\"\\nthreadState:\")\n                    .append(threadInfo.getThreadState());\n            System.out.println(sb);\n\n            StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();\n            for (StackTraceElement stackTraceElement : stackTraceElements) {\n                System.out.println(\"\\t\" + stackTraceElement.toString());\n            }\n            System.out.println();\n        }\n    }\n</code></pre> <p>\u83b7\u53d6\u7c7b\u548c\u7c7b\u52a0\u8f7d\u5668\u7684\u4fe1\u606f\u2013Instumentation\u5bf9\u8c61</p> <p>Java Agent\u4e2d\u53ef\u4ee5\u83b7\u5f97Java\u865a\u62df\u673a\u63d0\u4f9b\u7684Instumentation\u5bf9\u8c61\uff1a</p> <pre><code>    public static void premain(String agentArgs, Instrumentation inst) {}\n    public static void agentmain(String agentArgs, Instrumentation inst) {}\n</code></pre> <p>\u8be5\u5bf9\u8c61\u6709\u4ee5\u4e0b\u51e0\u4e2a\u4f5c\u7528\uff1a</p> <ul> <li> <p>redefine\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7c7b\u7684\u5b57\u8282\u7801\u4fe1\u606f\u3002</p> </li> <li> <p>retransform\uff0c\u6839\u636e\u73b0\u6709\u7c7b\u7684\u5b57\u8282\u7801\u4fe1\u606f\u8fdb\u884c\u589e\u5f3a\u30023\u3001\u83b7\u53d6\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\u3002</p> </li> </ul> <p>Oracle\u5b98\u65b9\u624b\u518c\uff1a https://docs.oracle.com/javase/17/docs/api/java/lang/instrument/Instrumentation.html</p> <pre><code>public static void printAllClassLoader(Instrumentation inst) {\n        // \u521b\u5efa\u4e00\u4e2a\u96c6\u5408\uff0c\u7528\u4e8e\u5b58\u50a8\u6240\u6709\u52a0\u8f7d\u7684\u7c7b\u52a0\u8f7d\u5668\n        Set&lt;ClassLoader&gt; classLoaders = new HashSet&lt;&gt;();\n\n        // \u83b7\u53d6\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u7c7b\n        Class[] classes = inst.getAllLoadedClasses();\n        // \u904d\u5386\u6bcf\u4e2a\u7c7b\n        for (Class clazz : classes) {\n            // \u83b7\u53d6\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\n            ClassLoader classLoader = clazz.getClassLoader();\n            // \u5982\u679c\u7c7b\u52a0\u8f7d\u5668\u4e0d\u4e3a\u7a7a\uff0c\u5219\u52a0\u5165\u96c6\u5408\n            if (classLoader != null) {\n                classLoaders.add(classLoader);\n            }\n        }\n\n        // \u5c06\u7c7b\u52a0\u8f7d\u5668\u7684\u540d\u79f0\u8fdb\u884c\u5904\u7406\n        String str = classLoaders.stream().map(x -&gt; {\n                    // \u5982\u679c\u7c7b\u52a0\u8f7d\u5668\u4e3a\u7a7a\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 \"BootstrapClassLoader\"\n                    if (x == null) {\n                        return \"BootstrapClassLoader\";\n                    } else {\n                        // \u5426\u5219\u8fd4\u56de\u7c7b\u52a0\u8f7d\u5668\u7684\u540d\u79f0\n                        return x.getName();\n                    }\n                }).filter(Objects::nonNull)\n                // \u53bb\u91cd\u5e76\u6392\u5e8f\n                .distinct().sorted(String::compareTo)\n                // \u6536\u96c6\u7ed3\u679c\u5e76\u4ee5\u6362\u884c\u7b26\u8fde\u63a5\n                .collect(Collectors.joining(\"\\n\"));\n\n        // \u8f93\u51fa\u6240\u6709\u7c7b\u52a0\u8f7d\u5668\u7684\u540d\u79f0\n        System.out.println(str);\n    }\n</code></pre> <p>\u6253\u5370\u7c7b\u7684\u6e90\u7801\u6253\u5370\u7c7b\u7684\u6e90\u7801\u9700\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4</p> <ol> <li> <p>\u83b7\u5f97\u5185\u5b58\u4e2d\u7684\u7c7b\u7684\u5b57\u8282\u7801\u4fe1\u606f\u3002\u5229\u7528Instrumentation\u63d0\u4f9b\u7684\u8f6c\u6362\u5668\u6765\u83b7\u53d6\u5b57\u8282\u7801\u4fe1\u606f\u3002</p> </li> <li> <p>\u901a\u8fc7\u53cd\u7f16\u8bd1\u5de5\u5177(jd-core)\u5c06\u5b57\u8282\u7801\u4fe1\u606f\u8fd8\u539f\u6210\u6e90\u4ee3\u7801\u4fe1\u606f\u3002</p> </li> </ol> <p></p> <p>\u6253\u5370\u65b9\u6cd5\u6267\u884c\u7684\u53c2\u6570\u548c\u8017\u65f6- ASM</p> <p>ASM\u662f\u4e00\u4e2a\u901a\u7528\u7684 Java \u5b57\u8282\u7801\u64cd\u4f5c\u548c\u5206\u6790\u6846\u67b6\u3002\u5b83\u53ef\u7528\u4e8e\u76f4\u63a5\u4ee5\u4e8c\u8fdb\u5236\u5f62\u5f0f\u4fee\u6539\u73b0\u6709\u7c7b\u6216\u52a8\u6001\u751f\u6210\u7c7b\u3002ASM\u91cd\u70b9\u5173\u6ce8\u6027\u80fd\u3002\u8ba9\u64cd\u4f5c\u5c3d\u53ef\u80fd\u5c0f\u4e14\u5c3d\u53ef\u80fd\u5feb\uff0c\u6240\u4ee5\u5b83\u975e\u5e38\u9002\u5408\u5728\u52a8\u6001\u7cfb\u7edf\u4e2d\u4f7f\u7528\u3002ASM\u7684\u7f3a\u70b9\u662f\u4ee3\u7801\u590d\u6742\u3002</p> <p>ASM\u7684\u5b98\u65b9\u7f51\u5740</p> <p></p> <p>\u6253\u5370\u65b9\u6cd5\u6267\u884c\u7684\u53c2\u6570\u548c\u8017\u65f6\u2013 Byte Buddy</p> <p>\u5e95\u5c42\u57fa\u4e8eASM\uff0c\u4f7f\u7528\u66f4\u7b80\u5355</p> <p>Byte Buddy\u5b98\u7f51</p>"},{"location":"JVM/JVM-advance/#\u6848\u4f8b2application-performance-monitorapm\u7cfb\u7edf","title":"\u6848\u4f8b2\uff1aApplication performance monitor\uff08APM\uff09\u7cfb\u7edf","text":"<p>APM\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u76d1\u63a7\u7cfb\u7edf\u662f\u91c7\u96c6\u8fd0\u884c\u7a0b\u5e8f\u7684\u5b9e\u65f6\u6570\u636e\u5e76\u4f7f\u7528\u53ef\u89c6\u5316\u7684\u65b9\u5f0f\u5c55\u793a\uff0c\u4f7f\u7528APM\u53ef\u4ee5\u786e\u4fdd\u7cfb\u7edf\u53ef\u7528\u6027\uff0c\u4f18\u5316\u670d\u52a1\u6027\u80fd\u548c\u54cd\u5e94\u65f6\u95f4\uff0c\u6301\u7eed\u6539\u5584\u7528\u6237\u4f53\u9a8c\u3002\u5e38\u7528\u7684APM\u7cfb\u7edf\u6709Apache Skywalking\u3001Zipkin\u7b49\u3002</p> <p>Skywalking\u5b98\u65b9\u7f51\u7ad9</p> <p>Arthas\u8fd9\u6b3e\u5de5\u5177\u7528\u5230\u4e86\u4ec0\u4e48Java\u6280\u672f\uff0c\u6709\u6ca1\u6709\u4e86\u89e3\u8fc7\uff1f</p> <p>Arthas\u4e3b\u8981\u4f7f\u7528\u4e86Java Agent\u6280\u672f\uff0c\u8fd9\u79cd\u6280\u672f\u53ef\u4ee5\u8ba9\u8fd0\u884c\u4e2d\u7684Java\u7a0b\u5e8f\u6267\u884cAgent\u4e2d\u7f16\u5199\u4ee3\u7801\u3002</p> <p>Arthas\u4f7f\u7528\u4e86Agent\u4e2d\u7684\u52a8\u6001\u52a0\u8f7d\u6a21\u5f0f\uff0c\u53ef\u4ee5\u9009\u62e9\u8ba9\u67d0\u4e2a\u7279\u5b9a\u7684Java\u8fdb\u7a0b\u52a0\u8f7dAgent\u5e76\u6267\u884c\u5176\u4e2d\u7684\u76d1\u63a7\u4ee3\u7801\u3002</p> <p>\u76d1\u63a7\u65b9\u9762\u4e3b\u8981\u4f7f\u7528\u7684\u5c31\u662fJMX\u63d0\u4f9b\u7684\u4e00\u4e9b\u76d1\u63a7\u6307\u6807\uff0c\u540c\u65f6\u4f7f\u7528\u5b57\u8282\u7801\u589e\u5f3a\u6280\u672f\uff0c\u5bf9\u67d0\u4e9b\u7c7b\u548c\u67d0\u4e9b\u65b9\u6cd5\u8fdb\u884c\u589e\u5f3a\uff0c\u4ece\u800c\u76d1\u63a7\u65b9\u6cd5\u7684\u6267\u884c\u8017\u65f6\u3001\u53c2\u6570\u7b49\u5185\u5bb9\u3002</p> <p>APM\u7cfb\u7edf\u662f\u5982\u4f55\u83b7\u53d6\u5230Java\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u7684\u6027\u80fd\u6570\u636e\u7684\uff1f</p> <p>APM\u7cfb\u7edf\u6bd4\u5982Skywalking\u4e3b\u8981\u4f7f\u7528\u4e86Java Agent\u6280\u672f\uff0c\u8fd9\u79cd\u6280\u672f\u53ef\u4ee5\u8ba9\u8fd0\u884c\u4e2d\u7684Java\u7a0b\u5e8f\u6267\u884cAgent\u4e2d\u7f16\u5199\u4ee3\u7801\u3002</p> <p>Skywalking\u7f16\u5199\u4e86Java Agent\uff0c\u4f7f\u7528\u4e86Agent\u4e2d\u7684\u9759\u6001\u52a0\u8f7d\u6a21\u5f0f\uff0c\u4f7f\u7528\u5b57\u8282\u7801\u589e\u5f3a\u6280\u672f\uff0c\u5bf9\u67d0\u4e9b\u7c7b\u548c\u67d0\u4e9b\u65b9\u6cd5\u8fdb\u884c\u589e\u5f3a\uff0c\u4ece\u800c\u76d1\u63a7\u65b9\u6cd5\u7684\u6267\u884c\u8017\u65f6\u3001\u53c2\u6570\u7b49\u5185\u5bb9\u3002</p> <p>\u6bd4\u5982\u5bf9Controller\u5c42\u65b9\u6cd5\u589e\u5f3a\uff0c\u83b7\u53d6\u63a5\u53e3\u8c03\u7528\u7684\u65f6\u957f\u4fe1\u606f\uff0c\u5bf9\u6570\u636e\u5e93\u8fde\u63a5\u589e\u5f3a\uff0c\u83b7\u53d6\u6570\u636e\u5e93\u67e5\u8be2\u7684\u65f6\u957f\u3001SQL\u8bed\u53e5\u7b49\u4fe1\u606f\u3002</p> <p>\u4e0a\u4e00\u8282\uff1a JVM\u5b9e\u8df5</p> <p>\u4e0b\u4e00\u8282\uff1a JVM\u539f\u7406</p>"},{"location":"JVM/JVM-base/","title":"JVM \u57fa\u7840","text":""},{"location":"JVM/JVM-base/#\u4ec0\u4e48\u662fjvm","title":"\u4ec0\u4e48\u662fJVM","text":"<p>JVM \u5168\u79f0\u662f Java Virtual Machine\uff0c\u4e2d\u6587\u8bd1\u540d Java\u865a\u62df\u673a\u3002\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u7a0b\u5e8f\uff0c\u4ed6\u7684\u804c\u8d23\u662f\u8fd0\u884cJava\u5b57\u8282\u7801\u6587\u4ef6\u3002</p> <p></p>"},{"location":"JVM/JVM-base/#jvm\u7684\u529f\u80fd","title":"JVM\u7684\u529f\u80fd","text":"<ol> <li> <p>\u89e3\u91ca\u548c\u8fd0\u884c</p> <ul> <li>\u5bf9\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u7684\u6307\u4ee4\uff0c\u5b9e\u65f6\u7684\u89e3\u91ca\u6210\u673a\u5668\u7801\uff0c\u8ba9\u8ba1\u7b97\u673a\u6267\u884c</li> </ul> </li> <li> <p>\u5185\u5b58\u7ba1\u7406</p> <ul> <li>\u81ea\u52a8\u4e3a\u5bf9\u8c61\u3001\u65b9\u6cd5\u7b49\u5206\u914d\u5185\u5b58\uff0c\u81ea\u52a8\u7684\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u56de\u6536\u4e0d\u518d\u4f7f\u7528\u7684\u5bf9\u8c61</li> </ul> </li> <li> <p>\u5373\u65f6\u7f16\u8bd1</p> <ul> <li>\u5bf9\u70ed\u70b9\u4ee3\u7801\u8fdb\u884c\u4f18\u5316\uff0c\u63d0\u5347\u6267\u884c\u6548\u7387</li> </ul> </li> </ol>"},{"location":"JVM/JVM-base/#\u5e38\u89c1\u7684jvm","title":"\u5e38\u89c1\u7684JVM","text":"\u540d\u79f0 \u4f5c\u8005 \u652f\u6301\u7248\u672c \u793e\u533a\u6d3b\u8dc3\u5ea6 (github star) \u7279\u6027 \u9002\u7528\u573a\u666f HotSpot (Oracle JDK\u7248) Oracle \u6240\u6709\u7248\u672c \u9ad8(\u95ed\u6e90) \u4f7f\u7528\u6700\u5e7f\u6cdb\uff0c\u7a33\u5b9a\u53ef\u9760\uff0c\u793e\u533a\u6d3b\u8dc3JIT\u652f\u6301Oracle JDK\u9ed8\u8ba4\u865a\u62df\u673a \u9ed8\u8ba4 HotSpot (OpenJDK\u7248) Oracle \u6240\u6709\u7248\u672c \u4e2d(16.1k) \u540c\u4e0a\u5f00\u6e90\uff0cOpenJDK\u9ed8\u8ba4\u865a\u62df\u673a \u9ed8\u8ba4\u5bf9JDK\u6709\u4e8c\u6b21\u5f00\u53d1\u9700\u6c42 GraalVM Oracle 11, 17, 19\u4f01\u4e1a\u7248\u652f\u63018 \u9ad8(18.7k) \u591a\u8bed\u8a00\u652f\u6301\u9ad8\u6027\u80fd\uff0cJIT\uff0cAOT\u652f\u6301 \u5fae\u670d\u52a1\u3001\u4e91\u539f\u751f\u67b6\u6784\u9700\u8981\u591a\u8bed\u8a00\u6df7\u5408\u7f16\u7a0b Dragonwell JDK\u9f99\u4e95 Alibaba \u6807\u51c6\u7248 8,11,17\u6269\u5c55\u724811,17 \u4f4e(3.9k) \u57fa\u4e8eOpenJDK\u7684\u589e\u5f3a\u9ad8\u6027\u80fd\uff0cbug\u4fee\u590d\uff0c\u5b89\u5168\u6027\u63d0\u5347JWarmup\uff0cElasticHeap\uff0cWisp\u7279\u6027\u652f\u6301 \u7535\u5546\u3001\u7269\u6d41\u3001\u91d1\u878d\u9886\u57df\u5bf9\u6027\u80fd\u8981\u6c42\u6bd4\u8f83\u9ad8 Eclipse OpenJ9(\u539f IBM J9) IBM 8,11,17,19,20 \u4f4e(3.1k) \u9ad8\u6027\u80fd\uff0c\u53ef\u6269\u5c55JIT\uff0cAOT\u7279\u6027\u652f\u6301 \u5fae\u670d\u52a1\u3001\u4e91\u539f\u751f\u67b6\u6784"},{"location":"JVM/JVM-base/#\u5b57\u8282\u7801\u6587\u4ef6","title":"\u5b57\u8282\u7801\u6587\u4ef6","text":"<p>Tip</p> <p>\u4f7f\u7528 jclasslib\u5de5\u5177\u67e5\u770b\u5b57\u8282\u7801\u6587\u4ef6</p> <p></p>"},{"location":"JVM/JVM-base/#magic\u9b54\u6570","title":"Magic\u9b54\u6570","text":"<ul> <li>\u6587\u4ef6\u662f\u65e0\u6cd5\u901a\u8fc7\u6587\u4ef6\u6269\u5c55\u540d\u6765\u786e\u5b9a\u6587\u4ef6\u7c7b\u578b\u7684\uff0c\u6587\u4ef6\u6269\u5c55\u540d\u53ef\u4ee5\u968f\u610f\u4fee\u6539\uff0c\u4e0d\u5f71\u54cd\u6587\u4ef6\u7684\u5185\u5bb9\u3002</li> <li>\u8f6f\u4ef6\u4f7f\u7528\u6587\u4ef6\u7684\u5934\u51e0\u4e2a\u5b57\u8282\uff08\u6587\u4ef6\u5934\uff09\u53bb\u6821\u9a8c\u6587\u4ef6\u7684\u7c7b\u578b\uff0c\u5982\u679c\u8f6f\u4ef6\u4e0d\u652f\u6301\u8be5\u79cd\u7c7b\u578b\u5c31\u4f1a\u51fa\u9519\u3002</li> <li>Java\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\uff0c\u5c06\u6587\u4ef6\u5934\u79f0\u4e3amagic\u9b54\u6570\u3002</li> </ul> \u6587\u4ef6\u7c7b\u578b \u5b57\u8282\u6570 \u6587\u4ef6\u5934 JPEG (jpg) 3 FFD8FF PNG (png) 4 89504E47 (\u6587\u4ef6\u5c3e\u4e5f\u6709\u8981\u6c42) bmp 2 424D XML (xml) 5 3C3F786D6C AVI (avi) 4 41564920 Java\u5b57\u8282\u7801\u6587\u4ef6 (class) 4 CAFEBABE <p>\u91cd\u70b9\u63d0\u793a</p> <p>Java\u5b57\u8282\u7801\u6587\u4ef6(.class)\u7684Magic\u9b54\u6570\u662f CAFEBABE\uff0c\u5360\u75284\u4e2a\u5b57\u8282\uff0c\u8fd9\u662f\u6240\u6709Java class\u6587\u4ef6\u7684\u6807\u8bc6\u7b26\u3002</p>"},{"location":"JVM/JVM-base/#\u4e3b\u526f\u7248\u672c\u53f7","title":"\u4e3b\u526f\u7248\u672c\u53f7","text":"<ul> <li> <p>\u4e3b\u526f\u7248\u672c\u53f7\u6307\u7684\u662f\u7f16\u8bd1\u5b57\u8282\u7801\u6587\u4ef6\u7684JDK\u7248\u672c\u53f7\uff0c\u4e3b\u7248\u672c\u53f7\u7528\u6765\u6807\u8bc6\u5927\u7248\u672c\u53f7\uff0cJDK1.0-1.1\u4f7f\u7528\u4e8645.0-45.3\uff0cJDK1.2\u662f46\u4e4b\u540e\u6bcf\u5347\u7ea7\u4e00\u4e2a\u5927\u7248\u672c\u5c31\u52a01\uff1b\u526f\u7248\u672c\u53f7\u662f\u5f53\u4e3b\u7248\u672c\u53f7\u76f8\u540c\u65f6\u4f5c\u4e3a\u533a\u5206\u4e0d\u540c\u7248\u672c\u7684\u6807\u8bc6\uff0c\u4e00\u822c\u53ea\u9700\u8981\u5173\u5fc3\u4e3b\u7248\u672c\u53f7\u3002</p> </li> <li> <p>\u7248\u672c\u53f7\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u5224\u65ad\u5f53\u524d\u5b57\u8282\u7801\u7684\u7248\u672c\u548c\u8fd0\u884c\u65f6\u7684JDK\u662f\u5426\u517c\u5bb9\u3002</p> </li> </ul> <p>\u7248\u672c\u53f7\u8ba1\u7b97\u65b9\u6cd5</p> <p>1.2\u4e4b\u540e\u5927\u7248\u672c\u53f7\u8ba1\u7b97\u65b9\u6cd5\u662f\uff1a\u4e3b\u7248\u672c\u53f7 - 44</p> <p>\u6bd4\u5982\u4e3b\u7248\u672c\u53f752\u5c31\u662fJDK8</p> <p>\u4f7f\u7528JDK8\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u6587\u4ef6\u793a\u4f8b</p> <p>\u4ecejclasslib\u5de5\u5177\u4e2d\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li> <p>\u6b21\u7248\u672c\u53f7\uff1a0</p> </li> <li> <p>\u4e3b\u7248\u672c\u53f7\uff1a52 [1.8]</p> </li> <li> <p>\u8fd9\u8868\u793a\u8be5\u5b57\u8282\u7801\u6587\u4ef6\u662f\u4f7f\u7528JDK8\u7f16\u8bd1\u7684</p> </li> </ul> JDK\u7248\u672c \u4e3b\u7248\u672c\u53f7 \u8ba1\u7b97\u65b9\u5f0f JDK 1.0-1.1 45.0-45.3 - JDK 1.2 46 46-44=2 JDK 8 52 52-44=8 JDK 11 55 55-44=11 JDK 17 61 61-44=17"},{"location":"JVM/JVM-base/#\u4e3b\u7248\u672c\u53f7\u4e0d\u517c\u5bb9\u95ee\u9898","title":"\u4e3b\u7248\u672c\u53f7\u4e0d\u517c\u5bb9\u95ee\u9898","text":"<p>\u6848\u4f8b\uff1a\u4e3b\u7248\u672c\u53f7\u4e0d\u517c\u5bb9\u5bfc\u81f4\u7684\u9519\u8bef</p> <p>\u9700\u6c42\uff1a</p> <p>\u89e3\u51b3\u4ee5\u4e0b\u7531\u4e8e\u4e3b\u7248\u672c\u53f7\u4e0d\u517c\u5bb9\u5bfc\u81f4\u7684\u9519\u8bef</p> <pre><code>\u7c7b\u6587\u4ef6\u5177\u6709\u9519\u8bef\u7684\u7248\u672c 52.0\uff0c\u5e94\u4e3a 50.0\n\u8bf7\u5220\u9664\u8be5\u6587\u4ef6\u6216\u786e\u4fdd\u8be5\u6587\u4ef6\u4f4d\u4e8e\u6b63\u786e\u7684\u7c7b\u8def\u5f84\u5b50\u76ee\u5f55\u4e2d\u3002\n</code></pre> <p>\u95ee\u9898\u5206\u6790</p> <ul> <li>\u7248\u672c 52.0\uff1a\u5bf9\u5e94 JDK 8 (52-44=8)</li> <li>\u7248\u672c 50.0\uff1a\u5bf9\u5e94 JDK 6 (50-44=6)</li> <li>\u9519\u8bef\u539f\u56e0\uff1a\u4f7f\u7528JDK 8\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u6587\u4ef6\u65e0\u6cd5\u5728JDK 6\u73af\u5883\u4e0b\u8fd0\u884c</li> </ul> <p>\u89e3\u51b3\u65b9\u6848</p> <p>\u4e24\u79cd\u65b9\u6848\uff1a</p> <ol> <li> <p>\u5347\u7ea7JDK\u7248\u672c </p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>\u5bb9\u6613\u5f15\u53d1\u5176\u4ed6\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u5e76\u4e14\u9700\u8981\u5927\u91cf\u7684\u6d4b\u8bd5</p> </li> <li> <p>\u5c06\u7b2c\u4e09\u65b9\u4f9d\u8d56\u7684\u7248\u672c\u53f7\u964d\u4f4e\u6216\u8005\u66f4\u6362\u4f9d\u8d56\uff0c\u4ee5\u6ee1\u8db3JDK\u7248\u672c\u7684\u8981\u6c42 \u2705 \u5efa\u8bae\u91c7\u7528</p> <p>\u63a8\u8350\u65b9\u6848</p> <p>\u964d\u4f4e\u4f9d\u8d56\u7248\u672c\u6216\u66f4\u6362\u517c\u5bb9\u7684\u4f9d\u8d56\u5305\uff0c\u4fdd\u6301\u5f53\u524dJDK\u73af\u5883\u7a33\u5b9a</p> </li> </ol>"},{"location":"JVM/JVM-base/#\u7c7b\u7684\u751f\u547d\u5468\u671f","title":"\u7c7b\u7684\u751f\u547d\u5468\u671f","text":""},{"location":"JVM/JVM-base/#\u52a0\u8f7d","title":"\u52a0\u8f7d","text":"<ol> <li> <p>\u7c7b\u52a0\u8f7d\u5668\u6839\u636e\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u901a\u8fc7\u4e0d\u540c\u6e20\u9053\u4ee5\u4e8c\u8fdb\u5236\u6d41\u7684\u65b9\u5f0f\u83b7\u53d6\u5b57\u8282\u7801\u4fe1\u606f</p> <ul> <li>\u672c\u5730\u6587\u4ef6</li> <li>\u52a8\u6001\u4ee3\u7406\u751f\u6210</li> <li>\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93</li> </ul> </li> <li> <p>\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u5b8c\u6210\u540e\uff0cJava\u865a\u62df\u673a\u4f1a\u5c06\u5b57\u8282\u7801\u4e2d\u7684\u4fe1\u606f\u4fdd\u5b58\u5230\u65b9\u6cd5\u533a\u4e2d</p> </li> <li> <p>\u751f\u6210InstanceKlass\u5bf9\u8c61\uff08C++\u8bed\u8a00\u5bf9\u8c61\uff09\uff0c\u4fdd\u5b58\u7c7b\u7684\u6240\u6709\u4fe1\u606f\uff0c\u8fd8\u5305\u542b\u5b9e\u73b0\u7279\u5b9a\u529f\u80fd\u6bd4\u5982\u591a\u6001\u7684\u4fe1\u606f</p> </li> <li> <p>\u5728\u5806\u533a\u751f\u6210\u4e00\u4efd\u4e0e\u65b9\u6cd5\u533a\u4e2d\u6570\u636e\u7c7b\u4f3c\u7684 java.lang.Class \u5bf9\u8c61\uff0c\u4f5c\u7528\u662f\u5728Java\u4ee3\u7801\u4e2d\u53bb\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f\u4ee5\u53ca\u5b58\u50a8\u9759\u6001\u5b57\u6bb5\u6570\u636e\uff08JDK8\u4e4b\u540e\uff09</p> </li> </ol> <p>Note</p> <p>\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u53ea\u9700\u8981\u8bbf\u95ee\u5806\u533a\u7684Class\u5bf9\u8c61\u800c\u4e0d\u9700\u8981\u8bbf\u95ee\u65b9\u6cd5\u533a\u4e2d\u7684\u6570\u636e\uff0c\u8fd9\u6837Java\u865a\u62df\u673a\u53ef\u4ee5\u5f88\u597d\u7684\u63a7\u5236\u5f00\u53d1\u8005\u8bbf\u95ee\u6570\u636e\u7684\u8303\u56f4</p> <p></p>"},{"location":"JVM/JVM-base/#\u8fde\u63a5","title":"\u8fde\u63a5","text":"<ol> <li> <p>\u9a8c\u8bc1\u9636\u6bb5\uff0c\u68c0\u6d4bJava\u5b57\u8282\u7801\u6587\u4ef6\u662f\u5426\u9075\u5b88Java\u865a\u62df\u673a\u89c4\u8303\uff08\u6587\u4ef6\u683c\u5f0f\u3001\u5143\u4fe1\u606f\u7b49\uff09</p> </li> <li> <p>\u51c6\u5907\u9636\u6bb5\uff0c\u4e3a\u9759\u6001\u53d8\u91cf\u5206\u914d\u5185\u5b58\u5e76\u8bbe\u7f6e\u521d\u59cb\u503c(\u6ce8\u610f\u662f\u8d4b\u521d\u503c\u4e0d\u662f\u8d4b\u503c)</p> <p>final\u4fee\u9970\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u9759\u6001\u53d8\u91cf\uff0c\u51c6\u5907\u9636\u6bb5\u4f1a\u76f4\u63a5\u8d4b\u503c</p> <p>\u51c6\u5907\u9636\u6bb5\u53ea\u4f1a\u7ed9\u9759\u6001\u53d8\u91cf\u8d4b\u521d\u59cb\u503c\uff0c\u800c\u6bcf\u4e00\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5f15\u7528\u6570\u636e\u7c7b\u578b\u90fd\u6709\u5176\u521d\u59cb\u503c\u3002</p> \u6570\u636e\u7c7b\u578b \u521d\u59cb\u503c \u6570\u636e\u7c7b\u578b \u521d\u59cb\u503c int 0 byte 0 long 0L boolean false short 0 double 0.0 char '\\u0000' \u5f15\u7528\u6570\u636e\u7c7b\u578b null <p>\u91cd\u8981\u8bf4\u660e</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\u53ea\u5904\u7406\u9759\u6001\u53d8\u91cf\u7684\u521d\u59cb\u5316</li> <li>\u6bcf\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\u90fd\u6709\u5bf9\u5e94\u7684\u9ed8\u8ba4\u521d\u59cb\u503c</li> <li>\u6240\u6709\u5f15\u7528\u6570\u636e\u7c7b\u578b\u7684\u521d\u59cb\u503c\u90fd\u662f <code>null</code></li> <li>char \u7c7b\u578b\u7684\u521d\u59cb\u503c\u662f <code>'\\u0000'</code>\uff08\u7a7a\u5b57\u7b26\uff09</li> <li>long \u7c7b\u578b\u7684\u521d\u59cb\u503c\u662f <code>0L</code></li> </ul> </li> <li> <p>\u89e3\u6790\u9636\u6bb5\uff0c\u5c06\u5e38\u91cf\u6c60\u4e2d\u7684\u7b26\u53f7\u5f15\u7528\u66ff\u6362\u4e3a\u76f4\u63a5\u5f15\u7528\uff08\u5185\u5b58\u5730\u5740\uff09</p> </li> </ol>"},{"location":"JVM/JVM-base/#\u521d\u59cb\u5316","title":"\u521d\u59cb\u5316","text":"<p>\u6267\u884c\u9759\u6001\u4ee3\u7801\u5757\uff0c\u5e76\u4e3a\u9759\u6001\u53d8\u91cf\u8d4b\u503c\uff0c\u6267\u884c\u5b57\u8282\u7801\u6587\u4ef6\u4e2dclinit\u90e8\u5206\u7684\u5b57\u8282\u7801\u6307\u4ee4</p> <p></p> <p>\u7c7b\u7684\u521d\u59cb\u5316\u65f6\u673a\uff1a</p> <ul> <li> <p>\u8bbf\u95ee\u4e00\u4e2a\u7c7b\u7684\u9759\u6001\u53d8\u91cf\u6216\u8005\u9759\u6001\u65b9\u6cd5\uff0c\u6ce8\u610ffinal\u4fee\u9970\u7684\u53d8\u91cf\u5e76\u4e14\u7b49\u53f7\u53f3\u8fb9\u662f\u5e38\u91cf\u4e0d\u4f1a\u89e6\u53d1\u521d\u59cb\u5316</p> </li> <li> <p>\u8c03\u7528Class.forName(String className)\u65b9\u6cd5</p> </li> <li> <p>new\u4e00\u4e2a\u8be5\u7c7b\u7684\u5bf9\u8c61\u65f6</p> </li> <li> <p>\u6267\u884cmain\u65b9\u6cd5\u7684\u5f53\u524d\u7c7b</p> </li> </ul> <p>clinit\u6307\u4ee4\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u51fa\u73b0\uff1a</p> <ul> <li> <p>\u65e0\u9759\u6001\u4ee3\u7801\u5757\u4e14\u65e0\u9759\u6001\u53d8\u91cf\u8d4b\u503c\u8bed\u53e5</p> </li> <li> <p>\u6709\u9759\u6001\u53d8\u91cf\u7684\u58f0\u660e\uff0c\u4f46\u662f\u6ca1\u6709\u8d4b\u503c\u8bed\u53e5</p> </li> <li> <p>\u9759\u6001\u53d8\u91cf\u7684\u5b9a\u4e49\u4f7f\u7528final\u5173\u952e\u5b57\u5e76\u4e14\u8d4b\u5e38\u91cf\u503c\uff0c\u51c6\u5907\u9636\u6bb5\u76f4\u63a5\u8d4b\u503c</p> </li> </ul> <p>\u6ce8\u610f</p> <p>\u6570\u7ec4\u7684\u521b\u5efa\u4e0d\u4f1a\u5bfc\u81f4\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u7c7b\u8fdb\u884c\u521d\u59cb\u5316 final\u4fee\u9970\u7684\u53d8\u91cf\u5982\u679c\u8d4b\u503c\u5185\u5bb9\u9700\u8981\u6267\u884c\u6307\u4ee4\u624d\u80fd\u5f97\u51fa\u7ed3\u679c\uff0c\u4f1a\u6267\u884cclinit\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316</p> <p>\u5b58\u5728\u7ee7\u627f\u5173\u7cfb</p> <p>\u76f4\u63a5\u8bbf\u95ee\u7236\u7c7b\u7684\u9759\u6001\u53d8\u91cf\uff0c\u4e0d\u4f1a\u89e6\u53d1\u5b50\u7c7b\u7684\u521d\u59cb\u5316</p> <p>\u5b50\u7c7b\u7684\u521d\u59cb\u5316clinit\u8c03\u7528\u4e4b\u524d\uff0c\u4f1a\u5148\u8c03\u7528\u7236\u7c7b\u7684clinit\u521d\u59cb\u5316\u65b9\u6cd5</p> <p></p> <p></p>"},{"location":"JVM/JVM-base/#\u4f7f\u7528","title":"\u4f7f\u7528","text":""},{"location":"JVM/JVM-base/#\u5378\u8f7d","title":"\u5378\u8f7d","text":""},{"location":"JVM/JVM-base/#\u7c7b\u52a0\u8f7d\u5668\u5206\u7c7b","title":"\u7c7b\u52a0\u8f7d\u5668\u5206\u7c7b","text":"<p>JDK8\u4e4b\u524d\u7684\u7c7b\u52a0\u8f7d\u5668\uff1a</p> <ol> <li> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff08Bootstrap\uff09</p> <ul> <li> <p>\u7528C++\u8bed\u8a00\u5b9e\u73b0\uff0c\u65e0\u6cd5\u901a\u8fc7Java\u4ee3\u7801\u83b7\u53d6</p> </li> <li> <p>\u52a0\u8f7dJDK\u6838\u5fc3\u7c7b\u5e93\uff0c\u6bd4\u5982rt.jar\u4e2d\u7684\u7c7b</p> </li> </ul> </li> <li> <p>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff08Extension\uff09</p> <ul> <li> <p>\u7528Java\u8bed\u8a00\u5b9e\u73b0\uff0c\u7ee7\u627f\u81eaClassLoader\u7c7b</p> </li> <li> <p>\u52a0\u8f7dJDK\u6269\u5c55\u7c7b\u5e93\uff0c\u6bd4\u5982jre/lib/ext\u76ee\u5f55\u4e0b\u7684jar\u5305</p> </li> </ul> </li> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff08Application\uff09</p> <ul> <li> <p>\u7528Java\u8bed\u8a00\u5b9e\u73b0\uff0c\u7ee7\u627f\u81eaClassLoader\u7c7b</p> </li> <li> <p>\u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7c7b\u548c\u7b2c\u4e09\u65b9jar\u5305\u4e2d\u7684\u7c7b</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-base/#jdk8\u4e4b\u540e\u7684\u7c7b\u52a0\u8f7d\u5668","title":"JDK8\u4e4b\u540e\u7684\u7c7b\u52a0\u8f7d\u5668","text":"<p>\u7531\u4e8eJDK9\u5f15\u5165\u4e86module\u7684\u6982\u5ff5\uff0c\u7c7b\u52a0\u8f7d\u5668\u5728\u8bbe\u8ba1\u4e0a\u53d1\u751f\u4e86\u5f88\u591a\u53d8\u5316\u3002</p> <ol> <li> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u4f7f\u7528Java\u7f16\u5199\uff0c\u4f4d\u4e8e<code>jdk.internal.loader.ClassLoaders</code>\u7c7b\u4e2d\u3002</p> </li> <li> <p>Java\u4e2d\u7684BootClassLoader\u7ee7\u627f\u81eaBuiltinClassLoader\uff0c\u5b9e\u73b0\u4ece\u6a21\u5757\u4e2d\u627e\u5230\u8981\u52a0\u8f7d\u7684\u5b57\u8282\u7801\u8d44\u6e90\u6587\u4ef6\u3002</p> </li> </ol> <p>\u91cd\u8981\u53d8\u5316</p> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u4f9d\u7136\u65e0\u6cd5\u901a\u8fc7java\u4ee3\u7801\u83b7\u53d6\u5230\uff0c\u8fd4\u56de\u7684\u4ecd\u7136\u662fnull\uff0c\u4fdd\u6301\u4e86\u7edf\u4e00\u3002</p> <p>Bootstrap(C++)  \u2500\u2500\u25ba  BootClassLoader(Java)</p> <p>JDK8\u53ca\u4e4b\u524d ------------ JDK9\u53ca\u4e4b\u540e</p>"},{"location":"JVM/JVM-base/#\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","title":"\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","text":""},{"location":"JVM/JVM-base/#\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u4f5c\u7528","title":"\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u4f5c\u7528","text":"<p>\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u4e3b\u8981\u6709\u4e24\u4e2a\u91cd\u8981\u4f5c\u7528\uff1a</p> <ol> <li> <p>\u4fdd\u8bc1\u7c7b\u52a0\u8f7d\u7684\u5b89\u5168\u6027</p> <p>\u901a\u8fc7\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\uff0c\u8ba9\u9876\u5c42\u7684\u7c7b\u52a0\u8f7d\u5668\u53bb\u52a0\u8f7d\u6838\u5fc3\u7c7b\uff0c\u907f\u514d\u6076\u610f\u4ee3\u7801\u66ff\u6362JDK\u4e2d\u7684\u6838\u5fc3\u7c7b\u5e93\uff0c\u6bd4\u5982java.lang.String\uff0c\u786e\u4fdd\u6838\u5fc3\u7c7b\u5e93\u7684\u5b8c\u6574\u6027\u548c\u5b89\u5168\u6027\u3002</p> <p>\u5b89\u5168\u98ce\u9669\u793a\u4f8b</p> <p>\u5982\u679c\u6ca1\u6709\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\uff0c\u6076\u610f\u4ee3\u7801\u53ef\u80fd\u4f1a\uff1a</p> <ul> <li>\u521b\u5efa\u81ea\u5b9a\u4e49\u7684<code>java.lang.String</code>\u7c7b\u6765\u66ff\u6362\u7cfb\u7edf\u7c7b</li> <li>\u4fee\u6539\u6838\u5fc3API\u7684\u884c\u4e3a\uff0c\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u7a33\u5b9a</li> <li>\u7ed5\u8fc7Java\u7684\u5b89\u5168\u68c0\u67e5\u673a\u5236</li> </ul> </li> <li> <p>\u907f\u514d\u91cd\u590d\u52a0\u8f7d</p> <p>\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u53ef\u4ee5\u907f\u514d\u540c\u4e00\u4e2a\u7c7b\u88ab\u591a\u6b21\u52a0\u8f7d\uff0c\u4e0a\u5c42\u7684\u7c7b\u52a0\u8f7d\u5668\u5982\u679c\u52a0\u8f7d\u8fc7\u7c7b\uff0c\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de\u8be5\u7c7b\uff0c\u907f\u514d\u91cd\u590d\u52a0\u8f7d\u3002</p> </li> </ol> <p>\u52a0\u8f7d\u673a\u5236\u8bf4\u660e</p> <pre><code>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\u8bf7\u6c42\u52a0\u8f7d java.lang.String\n        \u2193 \u59d4\u6d3e\u7ed9\u7236\u7c7b\n\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u68c0\u67e5\u662f\u5426\u5df2\u52a0\u8f7d\n        \u2193 \u59d4\u6d3e\u7ed9\u7236\u7c7b  \n\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u68c0\u67e5\u5e76\u52a0\u8f7d \u2713\n        \u2193 \u8fd4\u56de\u5df2\u52a0\u8f7d\u7684\u7c7b\n\u76f4\u63a5\u8fd4\u56de\uff0c\u907f\u514d\u91cd\u590d\u52a0\u8f7d\n</code></pre> <p>\u53cc\u4eb2\u59d4\u6d3e\u7684\u5de5\u4f5c\u6d41\u7a0b</p> \u6b65\u9aa4 \u64cd\u4f5c \u8bf4\u660e 1 \u68c0\u67e5\u7f13\u5b58 \u68c0\u67e5\u7c7b\u662f\u5426\u5df2\u7ecf\u88ab\u5f53\u524d\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u8fc7 2 \u5411\u4e0a\u59d4\u6d3e \u5982\u679c\u672a\u52a0\u8f7d\uff0c\u59d4\u6d3e\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668 3 \u9012\u5f52\u59d4\u6d3e \u7236\u7c7b\u52a0\u8f7d\u5668\u91cd\u590d\u6b65\u9aa41-2\uff0c\u76f4\u5230\u9876\u5c42 4 \u5c1d\u8bd5\u52a0\u8f7d \u9876\u5c42\u52a0\u8f7d\u5668\u5c1d\u8bd5\u52a0\u8f7d\u7c7b 5 \u5411\u4e0b\u8fd4\u56de \u5982\u679c\u52a0\u8f7d\u5931\u8d25\uff0c\u8fd4\u56de\u7ed9\u5b50\u7c7b\u52a0\u8f7d\u5668\u5c1d\u8bd5 6 \u8fd4\u56de\u7ed3\u679c \u6210\u529f\u52a0\u8f7d\u5219\u8fd4\u56deClass\u5bf9\u8c61\uff0c\u5931\u8d25\u5219\u629b\u5f02\u5e38 <p>\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u7684\u4f18\u52bf</p> <ul> <li>\ud83d\udd12 \u5b89\u5168\u6027\uff1a\u9632\u6b62\u6838\u5fc3\u7c7b\u5e93\u88ab\u7be1\u6539</li> <li>\u267b\ufe0f \u907f\u514d\u91cd\u590d\uff1a\u540c\u4e00\u4e2a\u7c7b\u53ea\u4f1a\u88ab\u52a0\u8f7d\u4e00\u6b21</li> <li>\ud83c\udfaf \u804c\u8d23\u6e05\u6670\uff1a\u4e0d\u540c\u5c42\u7ea7\u52a0\u8f7d\u5668\u8d1f\u8d23\u4e0d\u540c\u8303\u56f4\u7684\u7c7b</li> <li>\u26a1 \u6027\u80fd\u4f18\u5316\uff1a\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u7c7b\u52a0\u8f7d\u5f00\u9500</li> <li>\ud83d\udee1\ufe0f \u7a33\u5b9a\u6027\uff1a\u4fdd\u8bc1JVM\u8fd0\u884c\u65f6\u73af\u5883\u7684\u4e00\u81f4\u6027</li> </ul>"},{"location":"JVM/JVM-base/#\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","title":"\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","text":"<p>\u5728\u67d0\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\uff0c\u9700\u8981\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u6765\u5b9e\u73b0\u7279\u5b9a\u7684\u7c7b\u52a0\u8f7d\u9700\u6c42\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li> <p>\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668</p> <p>\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u5e76\u4e14\u91cd\u5199loadClass\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5c06\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u7684\u4ee3\u7801\u53bb\u9664\u3002</p> <p>\u5b9e\u73b0\u65b9\u5f0f</p> <ul> <li>\u7ee7\u627f<code>ClassLoader</code>\u7c7b</li> <li>\u91cd\u5199<code>loadClass()</code>\u65b9\u6cd5</li> <li>\u79fb\u9664\u5411\u7236\u7c7b\u59d4\u6d3e\u7684\u903b\u8f91</li> <li>\u76f4\u63a5\u5728\u5f53\u524d\u7c7b\u52a0\u8f7d\u5668\u4e2d\u67e5\u627e\u5e76\u52a0\u8f7d\u7c7b</li> </ul> <p>\u5e94\u7528\u573a\u666f</p> <p>Tomcat\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\u5e94\u7528\u4e4b\u95f4\u7c7b\u9694\u79bb</p> </li> <li> <p>\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u7c7b\u52a0\u8f7d\u5668</p> <p>\u5229\u7528\u4e0a\u4e0b\u6587\u7c7b\u52a0\u8f7d\u52a0\u8f7d\u7c7b\uff0c\u6bd4\u5982JDBC\u548cJNDI\u7b49\u3002</p> <p>\u4f7f\u7528\u539f\u7406</p> <ul> <li>\u7236\u7c7b\u52a0\u8f7d\u5668\u8bf7\u6c42\u5b50\u7c7b\u52a0\u8f7d\u5668\u53bb\u5b8c\u6210\u7c7b\u52a0\u8f7d</li> <li>\u901a\u8fc7<code>Thread.currentThread().getContextClassLoader()</code>\u83b7\u53d6</li> <li>\u6253\u7834\u4e86\"\u7236\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u7c7b\u65e0\u6cd5\u8bbf\u95ee\u5b50\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u7c7b\"\u7684\u9650\u5236</li> </ul> <p>\u5178\u578b\u5e94\u7528</p> <ul> <li>JDBC\u9a71\u52a8\u52a0\u8f7d\uff1aDriverManager\u7531\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u4f46\u6570\u636e\u5e93\u9a71\u52a8\u7531\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d</li> <li>JNDI\u670d\u52a1\uff1a\u7c7b\u4f3c\u7684\u53cd\u5411\u7c7b\u52a0\u8f7d\u9700\u6c42</li> <li>SPI\u673a\u5236\uff1aService Provider Interface</li> </ul> </li> <li> <p>OSGi\u6846\u67b6\u7684\u7c7b\u52a0\u8f7d\u5668</p> <p>\u5386\u53f2\u4e0aOSGi\u6846\u67b6\u5b9e\u73b0\u4e86\u4e00\u5957\u65b0\u7684\u7c7b\u52a0\u8f7d\u5668\u673a\u5236\uff0c\u5141\u8bb8\u540c\u7ea7\u4e4b\u95f4\u59d4\u6258\u8fdb\u884c\u7c7b\u7684\u52a0\u8f7d\u3002</p> <p>OSGi\u7279\u6027</p> <ul> <li>\u6a21\u5757\u5316\u7cfb\u7edf\uff1a\u6bcf\u4e2aBundle\u6709\u72ec\u7acb\u7684\u7c7b\u52a0\u8f7d\u5668</li> <li>\u52a8\u6001\u52a0\u8f7d\uff1a\u652f\u6301\u8fd0\u884c\u65f6\u5b89\u88c5\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u5378\u8f7d\u6a21\u5757</li> <li>\u7248\u672c\u7ba1\u7406\uff1a\u540c\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u7248\u672c\u53ef\u4ee5\u5171\u5b58</li> <li>\u5e73\u7ea7\u59d4\u6d3e\uff1aBundle\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u59d4\u6d3e\u7c7b\u52a0\u8f7d</li> </ul> </li> </ol> \u65b9\u5f0f \u590d\u6742\u5ea6 \u4f7f\u7528\u573a\u666f \u5178\u578b\u5e94\u7528 \u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668 \u4e2d\u7b49 \u5e94\u7528\u9694\u79bb\u3001\u70ed\u90e8\u7f72 Tomcat\u3001Spring Boot DevTools \u7ebf\u7a0b\u4e0a\u4e0b\u6587\u7c7b\u52a0\u8f7d\u5668 \u7b80\u5355 SPI\u670d\u52a1\u52a0\u8f7d JDBC\u3001JNDI\u3001Spring OSGi\u6846\u67b6 \u590d\u6742 \u6a21\u5757\u5316\u7cfb\u7edf Eclipse IDE\u3001Apache Felix <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u53ef\u80fd\u4f1a\u5e26\u6765\u7c7b\u52a0\u8f7d\u7684\u590d\u6742\u6027</li> <li>\u9700\u8981\u4ed4\u7ec6\u8003\u8651\u7c7b\u7684\u53ef\u89c1\u6027\u548c\u7248\u672c\u51b2\u7a81\u95ee\u9898</li> <li>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9075\u5faa\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u662f\u6700\u4f73\u5b9e\u8df5</li> </ul>"},{"location":"JVM/JVM-base/#java\u5185\u5b58\u533a\u57df","title":"Java\u5185\u5b58\u533a\u57df","text":"<ul> <li>Java\u865a\u62df\u673a\u5728\u8fd0\u884cJava\u7a0b\u5e8f\u8fc7\u7a0b\u4e2d\u7ba1\u7406\u7684\u5185\u5b58\u533a\u57df\uff0c\u79f0\u4e4b\u4e3a\u8fd0\u884c\u65f6\u6570\u636e\u533a\u3002</li> <li>\u300aJava\u865a\u62df\u673a\u89c4\u8303\u300b\u4e2d\u89c4\u5b9a\u4e86\u6bcf\u4e00\u90e8\u5206\u7684\u4f5c\u7528\u3002</li> </ul> \u7ebf\u7a0b\u4e0d\u5171\u4eab \u7ebf\u7a0b\u5171\u4eab \u7a0b\u5e8f\u8ba1\u6570\u5668 \u5806 Java\u865a\u62df\u673a\u6808 \u65b9\u6cd5\u533a \u672c\u5730\u65b9\u6cd5\u6808 \u76f4\u63a5\u5185\u5b58(\u5e76\u4e0d\u5c5e\u4e8eJava\u865a\u62df\u673a\u89c4\u8303) <p>\u5185\u5b58\u8c03\u4f18\u5b66\u4e60\u8def\u7ebf</p> <p>\u4e86\u89e3\u8fd0\u884c\u65f6\u5185\u5b58\u7ed3\u6784 --&gt; \u638c\u63e1\u5185\u5b58\u95ee\u9898\u7684\u4ea7\u751f\u539f\u56e0 --&gt; \u638c\u63e1\u5185\u5b58\u8c03\u4f18\u7684\u57fa\u672c\u65b9\u6cd5</p>"},{"location":"JVM/JVM-base/#\u7a0b\u5e8f\u8ba1\u6570\u5668","title":"\u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<ul> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08Program Counter Register\uff09\u4e5f\u53ebPC\u5bc4\u5b58\u5668\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u5f53\u524d\u8981\u6267\u884c\u7684\u7684\u5b57\u8282\u7801\u6307\u4ee4\u7684\u5730\u5740\u3002</p> </li> <li> <p>\u5728\u52a0\u8f7d\u9636\u6bb5\uff0c\u865a\u62df\u673a\u5c06\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u7684\u6307\u4ee4\u8bfb\u53d6\u5230\u5185\u5b58\u4e4b\u540e\uff0c\u4f1a\u5c06\u539f\u6587\u4ef6\u4e2d\u7684\u504f\u79fb\u91cf\u8f6c\u6362\u6210\u5185\u5b58\u5730\u5740\u3002\u6bcf\u4e00\u6761\u5b57\u8282\u7801\u6307\u4ee4\u90fd\u4f1a\u62e5\u6709\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u3002</p> </li> <li> <p>\u5728\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u4f1a\u8bb0\u5f55\u4e0b\u4e00\u884c\u5b57\u8282\u7801\u6307\u4ee4\u7684\u5730\u5740\u3002\u6267\u884c\u5b8c\u5f53\u524d\u6307\u4ee4\u4e4b\u540e\uff0c\u865a\u62df\u673a\u7684\u6267\u884c\u5f15\u64ce\u6839\u636e\u7a0b\u5e8f\u8ba1\u6570\u5668\u6267\u884c\u4e0b\u4e00\u884c\u6307\u4ee4\u3002</p> </li> </ul> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\uff1f</p> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\u4e14\u957f\u5ea6\u56fa\u5b9a\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u3002</p>"},{"location":"JVM/JVM-base/#\u6808","title":"\u6808","text":""},{"location":"JVM/JVM-base/#java\u865a\u62df\u673a\u6808","title":"Java\u865a\u62df\u673a\u6808","text":"<p>Java\u865a\u62df\u673a\u6808\u7528\u6765\u5b58\u653e\u65b9\u6cd5\u8c03\u7528\u65f6\u7684\u6808\u5e27\u4fe1\u606f\u3002\u5b58\u50a8\u7684\u5185\u5bb9\u5305\u62ec\uff1a</p> <ul> <li> <p>\u5c40\u90e8\u53d8\u91cf\u8868</p> </li> <li> <p>\u64cd\u4f5c\u6570\u6808</p> </li> <li> <p>\u5e27\u6570\u636e</p> </li> </ul> <p>Note</p> <ul> <li> <p>\u5c40\u90e8\u53d8\u91cf\u8868\u4fdd\u5b58\u7684\u5185\u5bb9\u6709\uff1a\u5b9e\u4f8b\u65b9\u6cd5\u7684this\u5bf9\u8c61\uff0c\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u65b9\u6cd5\u4f53\u4e2d\u58f0\u660e\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p> </li> <li> <p>\u64cd\u4f5c\u6570\u6808\u662f\u6808\u5e27\u4e2d\u865a\u62df\u673a\u5728\u6267\u884c\u6307\u4ee4\u8fc7\u7a0b\u4e2d\u7528\u6765\u5b58\u653e\u4e2d\u95f4\u6570\u636e\u7684\u4e00\u5757\u533a\u57df,\u5728\u7f16\u8bd1\u671f\u5c31\u53ef\u4ee5\u786e\u5b9a\u64cd\u4f5c\u6570\u6808\u7684\u6700\u5927\u6df1\u5ea6\u3002</p> </li> <li> <p>\u5e27\u6570\u636e\u5305\u542b\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\u3001\u5f02\u5e38\u8868\u7b49\u4fe1\u606f\u3002</p> </li> </ul> <p></p> <p>Tip</p> <p>\u4e0a\u56fe\u4e2d\u8d77\u59cbPC\u548c\u957f\u5ea6\u53ef\u4ee5\u786e\u5b9a\u53d8\u91cf\u7684\u4f5c\u7528\u57df</p> <p></p> <p>Note</p> <ul> <li> <p>\u5f53\u524d\u7c7b\u7684\u5b57\u8282\u7801\u6307\u4ee4\u5f15\u7528\u4e86\u5176\u4ed6\u7c7b\u7684\u5c5e\u6027\u6216\u8005\u65b9\u6cd5\u65f6\uff0c\u9700\u8981\u5c06\u7b26\u53f7\u5f15\u7528\uff08\u7f16\u53f7\uff09\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u7684\u5185\u5b58\u5730\u5740\u3002\u52a8\u6001\u94fe\u63a5\u5c31\u4fdd\u5b58\u4e86\u7f16\u53f7\u5230\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u7684\u5185\u5b58\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> </li> <li> <p>\u65b9\u6cd5\u51fa\u53e3\u6307\u7684\u662f\u65b9\u6cd5\u5728\u6b63\u786e\u6216\u8005\u5f02\u5e38\u7ed3\u675f\u65f6\uff0c\u5f53\u524d\u6808\u5e27\u4f1a\u88ab\u5f39\u51fa\uff0c\u540c\u65f6\u7a0b\u5e8f\u8ba1\u6570\u5668\u5e94\u8be5\u6307\u5411\u4e0a\u4e00\u4e2a\u6808\u5e27\u4e2d\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002\u6240\u4ee5\u5728\u5f53\u524d\u6808\u5e27\u4e2d\uff0c\u9700\u8981\u5b58\u50a8\u6b64\u65b9\u6cd5\u51fa\u53e3\u7684\u5730\u5740\u3002</p> </li> <li> <p>\u5f02\u5e38\u8868\u5b58\u653e\u7684\u662f\u4ee3\u7801\u4e2d\u5f02\u5e38\u7684\u5904\u7406\u4fe1\u606f\uff0c\u5305\u542b\u4e86\u5f02\u5e38\u6355\u83b7\u7684\u751f\u6548\u8303\u56f4\u4ee5\u53ca\u5f02\u5e38\u53d1\u751f\u540e\u8df3\u8f6c\u5230\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4f4d\u7f6e\u3002</p> </li> </ul> <p>\u6808\u5185\u5b58\u6ea2\u51fa</p> <ul> <li>Java\u865a\u62df\u673a\u6808\u5185\u5b58\u6ea2\u51fa\u4f1a\u629b\u51fa<code>StackOverflowError</code>\u9519\u8bef</li> <li>\u4e3b\u8981\u539f\u56e0\u662f\u9012\u5f52\u8c03\u7528\u8fc7\u6df1\uff0c\u5bfc\u81f4\u6808\u5e27\u6570\u91cf\u8fc7\u591a\uff0c\u4e5f\u53ef\u80fd\u662f\u5c40\u90e8\u53d8\u91cf\u8868\u8fc7\u5927\uff0c\u5bfc\u81f4\u5355\u4e2a\u6808\u5e27\u8fc7\u5927</li> </ul>"},{"location":"JVM/JVM-base/#\u672c\u5730\u65b9\u6cd5\u6808","title":"\u672c\u5730\u65b9\u6cd5\u6808","text":"<p>\u672c\u5730\u65b9\u6cd5\u6808\u5b58\u50a8\u7684\u662fnative\u65b9\u6cd5\u8c03\u7528\u65f6\u7684\u6808\u5e27\u4fe1\u606f\uff0cnative\u65b9\u6cd5\u662f\u7528C/C++\u7b49\u8bed\u8a00\u7f16\u5199\u7684\u65b9\u6cd5\u3002</p> <p>Tip</p> <p>\u5728HotSpot\u865a\u62df\u673a\u4e2d\uff0c\u672c\u5730\u65b9\u6cd5\u6808\u548cJava\u865a\u62df\u673a\u6808\u662f\u5408\u4e8c\u4e3a\u4e00\u7684\uff0c\u5373Java\u865a\u62df\u673a\u6808\u540c\u65f6\u5b58\u50a8Java\u65b9\u6cd5\u548cnative\u65b9\u6cd5\u7684\u6808\u5e27\u4fe1\u606f\u3002</p> <p>\u865a\u62df\u673a\u8bbe\u7f6e\u6808\u5927\u5c0f</p> <ul> <li>\u8bbe\u7f6eJava\u865a\u62df\u673a\u6808\u5927\u5c0f\uff1a<code>-Xss</code>\uff0c\u6bd4\u5982<code>-Xss512k</code>\u8868\u793a\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u6808\u5927\u5c0f\u662f512KB</li> <li>\u8bbe\u7f6e\u672c\u5730\u65b9\u6cd5\u6808\u5927\u5c0f\uff1a<code>-Xoss</code>\uff0c\u6bd4\u5982<code>-Xoss512k</code>\u8868\u793a\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u672c\u5730\u65b9\u6cd5\u6808\u5927\u5c0f\u662f512KB</li> <li>\u5355\u4f4d\uff1a<ul> <li>k\uff1aKB</li> <li>m\uff1aMB</li> <li>g\uff1aGB</li> </ul> </li> </ul>"},{"location":"JVM/JVM-base/#\u5806","title":"\u5806","text":"<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cJava\u5806\u662fJava\u865a\u62df\u673a\u4e2d\u6700\u5927\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u7528\u6765\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\u548c\u6570\u7ec4\u3002\u53ef\u4ee5\u901a\u8fc7\u5f15\u7528\u8bbf\u95ee\u5806\u4e2d\u7684\u5bf9\u8c61\u3002</p> <p>\u5806\u6709\u4e09\u4e2a\u6ce8\u610f\u7684\u6307\u6807\uff1aused \u3001total \u3001 max</p> <ul> <li> <p>used\uff1a\u8868\u793a\u5f53\u524d\u5df2\u7ecf\u4f7f\u7528\u7684\u5806\u5185\u5b58\u5927\u5c0f</p> </li> <li> <p>total\uff1a\u8868\u793a\u5f53\u524d\u5df2\u5206\u914d\u5806\u7684\u603b\u5927\u5c0f</p> </li> <li> <p>max\uff1a\u8868\u793a\u5806\u53ef\u5206\u914d\u5185\u5b58\u7684\u6700\u5927\u503c</p> </li> </ul> <p>\u8bbe\u7f6e\u5806\u5185\u5b58\u5927\u5c0f</p> <ul> <li>\u8bbe\u7f6e\u521d\u59cb\u5806\u5927\u5c0f\uff1a<code>-Xms</code>\uff0c\u6bd4\u5982<code>-Xms512m</code>\u8868\u793a\u521d\u59cb\u5806\u5927\u5c0f\u662f512MB</li> <li>\u8bbe\u7f6e\u6700\u5927\u5806\u5927\u5c0f\uff1a<code>-Xmx</code>\uff0c\u6bd4\u5982<code>-Xmx1024m</code>\u8868\u793a\u6700\u5927\u5806\u5927\u5c0f\u662f1024MB</li> <li>\u5355\u4f4d\uff1a<ul> <li>k\uff1aKB</li> <li>m\uff1aMB</li> <li>g\uff1aGB</li> </ul> </li> </ul> <p>Java\u670d\u52a1\u7aef\u7a0b\u5e8f\u5efa\u8bae\u521d\u59cb\u5806\u5927\u5c0f\u548c\u6700\u5927\u5806\u5927\u5c0f\u8bbe\u7f6e\u6210\u4e00\u6837\uff0c\u907f\u514d\u5806\u52a8\u6001\u6269\u5c55\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017</p>"},{"location":"JVM/JVM-base/#\u65b9\u6cd5\u533a","title":"\u65b9\u6cd5\u533a","text":"<p>\u65b9\u6cd5\u533a\u662fJava\u865a\u62df\u673a\u4e2d\u4e00\u5757\u7279\u6b8a\u7684\u5185\u5b58\u533a\u57df\uff0c\u7528\u6765\u5b58\u653e</p> <ul> <li> <p>\u7c7b\u7684\u5143\u4fe1\u606f</p> </li> <li> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60</p> </li> <li> <p>\u9759\u6001\u53d8\u91cf</p> </li> <li> <p>\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801</p> </li> </ul> <p></p> <p>\u9759\u6001\u5e38\u91cf\u6c60\u4e0e\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60</p> <ul> <li>\u9759\u6001\u5e38\u91cf\u6c60\uff1a\u5b58\u653e\u5728\u7c7b\u7684\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\uff0c\u7f16\u8bd1\u671f\u5c31\u786e\u5b9a\u4e86\uff08\u901a\u8fc7\u7b26\u53f7\u5f15\u7528\uff09</li> <li>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff1a\u5b58\u653e\u5728\u65b9\u6cd5\u533a\u4e2d\uff0c\u7c7b\u52a0\u8f7d\u540e\u5b58\u653e\u5728\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\uff0c\u53ef\u4ee5\u52a8\u6001\u751f\u6210\uff08\u901a\u8fc7\u5185\u5b58\u5f15\u7528\uff09</li> </ul> <p>\u65b9\u6cd5\u533a\u7684\u4e0d\u540c\u5b9e\u73b0</p> <ul> <li>JDK8\u4e4b\u524d\uff1a\u65b9\u6cd5\u533a\u5b9e\u73b0\u662f\u6c38\u4e45\u4ee3\uff08PermGen\uff09\uff0c\u5c5e\u4e8e\u5806\u7684\u4e00\u90e8\u5206</li> <li>JDK8\u53ca\u4e4b\u540e\uff1a\u65b9\u6cd5\u533a\u5b9e\u73b0\u662f\u5143\u7a7a\u95f4\uff08Metaspace\uff09\uff0c\u4e0d\u518d\u5c5e\u4e8e\u5806\uff0c\u4f7f\u7528\u672c\u5730\u5185\u5b58</li> </ul> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60</p> <ul> <li> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u662f\u65b9\u6cd5\u533a\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u7528\u6765\u5b58\u653e\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u548c\u5b57\u7b26\u4e32\u5bf9\u8c61</p> </li> <li> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u63d0\u9ad8\u5b57\u7b26\u4e32\u7684\u91cd\u7528\u7387\uff0c\u8282\u7701\u5185\u5b58\u7a7a\u95f4</p> </li> </ul> <p>\u54ea\u4e9b\u5b57\u7b26\u4e32\u4f1a\u5b58\u653e\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff1f</p> <ul> <li>\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff0c\u6bd4\u5982<code>String s = \"hello\";</code></li> <li>\u4f7f\u7528<code>String.intern()</code>\u65b9\u6cd5\u521b\u5efa\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61</li> </ul> <p>new\u5173\u952e\u5b57\u521b\u5efa\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u4e0d\u4f1a\u5b58\u653e\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u6bd4\u5982<code>String s = new String(\"hello\");</code>\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5728\u5806\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002</p> <p>\u65b9\u6cd5\u533a\u548c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <ul> <li>\u65e9\u671fJDK\u7248\u672c\u4e2d\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5c5e\u4e8e\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u7684\u4e00\u90e8\u5206\uff0c\u5b58\u653e\u5728\u65b9\u6cd5\u533a\u4e2d</li> <li>JDK7\u4e4b\u540e\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u88ab\u79fb\u5230\u4e86\u5806\u4e2d\uff0c\u4e0d\u518d\u5b58\u653e\u5728\u65b9\u6cd5\u533a\u4e2d</li> </ul>"},{"location":"JVM/JVM-base/#\u76f4\u63a5\u5185\u5b58","title":"\u76f4\u63a5\u5185\u5b58","text":"<p>\u6ce8\u610f</p> <p>\u76f4\u63a5\u5185\u5b58\u5e76\u4e0d\u5c5e\u4e8eJava\u8fd0\u884c\u65f6\u7684\u5185\u5b58\u533a\u57df</p> <p>\u76f4\u63a5\u5185\u5b58\u5728JDK1.4\u4e2d\u5f15\u5165\uff0c\u4e3b\u8981\u7528\u4e8e\u63d0\u9ad8I/O\u64cd\u4f5c\u7684\u6548\u7387\u3002\u76f4\u63a5\u5185\u5b58\u662f\u901a\u8fc7Java\u7684NIO\uff08New Input/Output\uff09\u5e93\u6765\u5206\u914d\u548c\u7ba1\u7406\u7684\u3002</p> <p>\u4f20\u7edf\u7684Java I/O\u64cd\u4f5c\u662f\u57fa\u4e8e\u6d41\u7684\uff0c\u6570\u636e\u9700\u8981\u5728Java\u5806\u5185\u5b58\u548c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e4b\u95f4\u8fdb\u884c\u591a\u6b21\u590d\u5236\uff0c\u5bfc\u81f4\u6027\u80fd\u74f6\u9888\u3002\u76f4\u63a5\u5185\u5b58\u5141\u8bb8Java\u7a0b\u5e8f\u76f4\u63a5\u8bbf\u95ee\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u6570\u636e\u590d\u5236\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u4e86I/O\u64cd\u4f5c\u7684\u6548\u7387\u3002</p> <p></p> <p>\u914d\u7f6e\u76f4\u63a5\u5185\u5b58\u5927\u5c0f</p> <ul> <li>\u8bbe\u7f6e\u76f4\u63a5\u5185\u5b58\u5927\u5c0f\uff1a<code>-XX:MaxDirectMemorySize</code>\uff0c\u6bd4\u5982<code>-XX:MaxDirectMemorySize=512m</code>\u8868\u793a\u6700\u5927\u76f4\u63a5\u5185\u5b58\u5927\u5c0f\u662f512MB</li> <li>\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u76f4\u63a5\u5185\u5b58\u7684\u5927\u5c0f\u7b49\u4e8e\u6700\u5927\u5806\u5185\u5b58\u5927\u5c0f\uff08-Xmx\u7684\u503c\uff09</li> </ul>"},{"location":"JVM/JVM-base/#\u5783\u573e\u56de\u6536","title":"\u5783\u573e\u56de\u6536","text":"<p>\u6ca1\u6709\u5783\u573e\u56de\u6536</p> <ul> <li>C/C++\u7b49\u8bed\u8a00\u6ca1\u6709\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u7a0b\u5e8f\u5458\u9700\u8981\u624b\u52a8\u7ba1\u7406\u5185\u5b58</li> <li>\u5bb9\u6613\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u3001\u60ac\u6302\u6307\u9488\u7b49\u95ee\u9898\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u5d29\u6e83</li> </ul> <p>Java\u8bed\u8a00\u7b80\u5316\u4e86\u5185\u5b58\u7ba1\u7406\uff0c\u901a\u8fc7\u5783\u573e\u56de\u6536\u673a\u5236\u81ea\u52a8\u56de\u6536\u4e0d\u518d\u4f7f\u7528\u7684\u5bf9\u8c61\uff0c\u51cf\u5c11\u4e86\u5185\u5b58\u6cc4\u6f0f\u548c\u60ac\u6302\u6307\u9488\u7684\u98ce\u9669\u3002</p>"},{"location":"JVM/JVM-base/#\u65b9\u6cd5\u533a\u56de\u6536","title":"\u65b9\u6cd5\u533a\u56de\u6536","text":"<p>\u5bf9\u4e8e\u7ebf\u7a0b\u4e0d\u5171\u4eab\u7684\u5185\u5b58\u533a\u57df\uff0c\u90fd\u662f\u4f34\u968f\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u9500\u6bc1\u800c\u5206\u914d\u548c\u56de\u6536\u7684\u3002\u65e0\u9700\u5783\u573e\u56de\u6536\u5e72\u9884\u3002</p> <p>\u65b9\u6cd5\u533a\u4e2d\u80fd\u56de\u6536\u7684\u5185\u5bb9\u4e3b\u8981\u662f\u4e0d\u518d\u4f7f\u7528\u7684\u7c7b\uff0c\u8be5\u7c7b\u9700\u8981\u6ee1\u8db3\uff1a</p> <ul> <li> <p>\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u5df2\u7ecf\u88ab\u56de\u6536\uff08\u5305\u62ec\u5b50\u7c7b\u5bf9\u8c61\uff09</p> </li> <li> <p>\u52a0\u8f7d\u8be5\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\u5df2\u7ecf\u88ab\u56de\u6536</p> </li> <li> <p>\u8be5\u7c7b\u7684java.lang.Class\u5bf9\u8c61\u6ca1\u6709\u88ab\u4efb\u4f55\u5730\u65b9\u5f15\u7528</p> </li> </ul> <p>\u624b\u52a8\u89e6\u53d1\u5783\u573e\u56de\u6536</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7<code>System.gc()</code>\u65b9\u6cd5\u5efa\u8baeJava\u865a\u62df\u673a\u8fdb\u884c\u5783\u573e\u56de\u6536</li> <li>\u8be5\u65b9\u6cd5\u53ea\u662f\u4e00\u4e2a\u5efa\u8bae\uff0cJava\u865a\u62df\u673a\u53ef\u4ee5\u9009\u62e9\u5ffd\u7565\u5b83</li> <li>\u4e00\u822c\u4e0d\u5efa\u8bae\u9891\u7e41\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u6027\u80fd</li> </ul>"},{"location":"JVM/JVM-base/#\u5806\u56de\u6536","title":"\u5806\u56de\u6536","text":"<p>\u5982\u4f55\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u88ab\u56de\u6536\uff1f</p> <p>\u6839\u636e\u5bf9\u8c61\u662f\u5426\u88ab\u5f15\u7528\u6765\u5224\u65ad\uff0c\u6709\u4e00\u79cd\u4f8b\u5916\u662f\u5faa\u73af\u5f15\u7528</p> <p>\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u88ab\u5f15\u7528\u7684\u4e24\u79cd\u4e3b\u8981\u7b97\u6cd5\uff1a</p> <ul> <li> <p>\u5f15\u7528\u8ba1\u6570\u6cd5</p> </li> <li> <p>\u53ef\u8fbe\u6027\u5206\u6790\u6cd5</p> </li> </ul>"},{"location":"JVM/JVM-base/#\u5f15\u7528\u8ba1\u6570\u6cd5","title":"\u5f15\u7528\u8ba1\u6570\u6cd5","text":"<p>\u5f15\u7528\u8ba1\u6570\u6cd5\u5c31\u662f\u7ed9\u6bcf\u4e2a\u5bf9\u8c61\u6dfb\u52a0\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u5f53\u6709\u5f15\u7528\u6307\u5411\u8be5\u5bf9\u8c61\u65f6\uff0c\u8ba1\u6570\u5668\u52a01\uff1b</p> <p>\u5f53\u5f15\u7528\u5931\u6548\u6216\u8005\u6307\u5411\u5176\u4ed6\u5bf9\u8c61\u65f6\uff0c\u8ba1\u6570\u5668\u51cf1\uff1b</p> <p>\u5f53\u8ba1\u6570\u5668\u4e3a0\u65f6\uff0c\u8bf4\u660e\u8be5\u5bf9\u8c61\u4e0d\u518d\u88ab\u5f15\u7528\uff0c\u53ef\u4ee5\u88ab\u56de\u6536\u3002</p> <p>\u5f15\u7528\u8ba1\u6570\u6cd5\u7684\u7f3a\u70b9</p> <p>\u4f46\u662f\u5f15\u7528\u8ba1\u6570\u6cd5\u6709\u4e00\u4e2a\u7f3a\u70b9\uff0c\u5c31\u662f\u65e0\u6cd5\u89e3\u51b3\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\u3002\uff08\u7ef4\u62a4\u5f15\u7528\u8ba1\u6570\u5668\u4e5f\u4f1a\u589e\u52a0\u5f00\u9500\uff09</p>"},{"location":"JVM/JVM-base/#\u53ef\u8fbe\u6027\u5206\u6790","title":"\u53ef\u8fbe\u6027\u5206\u6790","text":"<p>JVM\u4f7f\u7528\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u6765\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u88ab\u56de\u6536\u3002</p> <p>\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u5c06\u5bf9\u8c61\u5206\u4e3a\u201cGC Root\u5bf9\u8c61\u201d\u548c\u201c\u666e\u901a\u5bf9\u8c61\u201d</p> <p>\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u901a\u8fc7\u4e00\u7cfb\u5217\u5f15\u7528\u94fe\u4ece\u6839\u5bf9\u8c61\u8bbf\u95ee\u5230\uff0c\u90a3\u4e48\u8be5\u5bf9\u8c61\u5c31\u662f\u53ef\u8fbe\u7684\uff0c\u4e0d\u4f1a\u88ab\u56de\u6536\u3002</p> <p>\u54ea\u4e9b\u662fGC Root\u5bf9\u8c61\uff1f</p> <ul> <li>\u7ebf\u7a0bThread\u5bf9\u8c61\u53ca\u5176\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u7c7b\u7684\u9759\u6001\u53d8\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u672c\u5730\u65b9\u6cd5\u6808\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>JVM\u5185\u90e8\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>...</li> </ul>"},{"location":"JVM/JVM-base/#\u5f15\u7528\u7c7b\u578b","title":"\u5f15\u7528\u7c7b\u578b","text":"<p>\u5728\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u4e2d\uff0c\u5f15\u7528\u6307\u201c\u5f3a\u5f15\u7528\u201d</p> <p>Java\u4e2d\u6709\u4e94\u79cd\u5f15\u7528\u7c7b\u578b\uff1a</p> <ul> <li> <p>\u5f3a\u5f15\u7528\uff08Strong Reference\uff09</p> </li> <li> <p>\u8f6f\u5f15\u7528\uff08Soft Reference\uff09</p> </li> <li> <p>\u5f31\u5f15\u7528\uff08Weak Reference\uff09</p> </li> <li> <p>\u865a\u5f15\u7528\uff08Phantom Reference\uff09</p> </li> <li> <p>\u7ec8\u7ed3\u5668\u5f15\u7528\uff08Final Reference\uff09</p> </li> </ul>"},{"location":"JVM/JVM-base/#\u8f6f\u5f15\u7528","title":"\u8f6f\u5f15\u7528","text":"<p>\u8f6f\u5f15\u7528\u662f\u4e00\u79cd\u76f8\u5bf9\u8f83\u5f31\u7684\u5f15\u7528\u7c7b\u578b\uff0c\u7528\u6765\u63cf\u8ff0\u4e00\u4e9b\u6709\u7528\u4f46\u5e76\u975e\u5fc5\u9700\u7684\u5bf9\u8c61\u3002</p> <p>\u88ab\u8f6f\u5f15\u7528\u5173\u8054\u7684\u5bf9\u8c61\u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u53ef\u80fd\u4f1a\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536</p> <p>\u4f7f\u7528SoftReference\u7c7b\u6765\u521b\u5efa\u8f6f\u5f15\u7528\u5bf9\u8c61 <pre><code>byte[] bytes = new byte[1024 * 1024 *100];\nSoftReference&lt;byte[]&gt; softReference = new SoftReference&lt;byte[]&gt;(bytes);\n</code></pre></p> <p>Warning</p> <p>\u8f6f\u5f15\u7528\u5bf9\u8c61\u4e5f\u9700\u8981\u88ab\u5f3a\u5f15\u7528\uff0c\u5426\u5219\u4e5f\u4f1a\u88ab\u56de\u6536</p> <p>SoftReference\u672c\u8eab\u88ab\u56de\u6536</p> <p>SoftReference\u5173\u8054\u7684\u5bf9\u8c61\u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u88ab\u56de\u6536\u540e\uff0cSoftReference\u672c\u8eab\u4e5f\u5e94\u8be5\u88ab\u56de\u6536</p> <p>\u8f6f\u5f15\u7528\u4e0e\u5f15\u7528\u961f\u5217\uff1a</p> <ol> <li> <p>\u521b\u5efa\u8f6f\u5f15\u7528\u65f6\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u5f15\u7528\u961f\u5217</p> </li> <li> <p>\u5f53\u8f6f\u5f15\u7528\u5173\u8054\u7684\u5bf9\u8c61\u88ab\u56de\u6536\u540e\uff0c\u8f6f\u5f15\u7528\u4f1a\u88ab\u52a0\u5165\u5230\u5f15\u7528\u961f\u5217\u4e2d</p> </li> <li> <p>\u53ef\u4ee5\u901a\u8fc7\u8f6e\u8be2\u5f15\u7528\u961f\u5217\u6765\u83b7\u53d6\u9700\u8981\u88ab\u56de\u6536\u7684\u8f6f\u5f15\u7528\u5bf9\u8c61</p> </li> </ol> <pre><code>ArrayList&lt;SoftReference&gt; softReferences = new ArrayList&lt;&gt;();\nReferenceQueue&lt;byte[]&gt; queues = new ReferenceQueue&lt;byte[]&gt;();\nfor (int i = 0; i &lt; 10; i++) {\n    byte[] bytes = new byte[1024 * 1024 * 100];\n    SoftReference&lt;byte[]&gt; stuRef = new SoftReference&lt;byte[]&gt;(bytes, queues); // \u6784\u9020\u51fd\u6570\u4f20\u9012\u6570\u636e\u53ca\u5f15\u7528\u961f\u5217\n    softReferences.add(stuRef);\n}\nSoftReference&lt;byte[]&gt; ref = null;\nint count = 0;\nwhile ((ref = (SoftReference&lt;byte[]&gt;) queues.poll()) != null) {\n    count++;\n}\nSystem.out.println(count);\n// \u8f93\u51fa\u88ab\u56de\u6536\u7684\u8f6f\u5f15\u7528\u6570\u91cf\n// \u8bbe\u7f6e\u542f\u52a8\u53c2\u6570 -Xmx200m\n// \u8f93\u51fa\uff1a9\n</code></pre>"},{"location":"JVM/JVM-base/#\u5f31\u5f15\u7528","title":"\u5f31\u5f15\u7528","text":"<p>\u5f31\u5f15\u7528\u4e0e\u8f6f\u5f15\u7528\u7c7b\u4f3c\uff0c\u4f46\u662f\u5f31\u5f15\u7528\u6240\u5173\u8054\u7684\u5bf9\u8c61\u5728\u5783\u573e\u56de\u6536\u5668\u626b\u63cf\u65f6\uff0c\u65e0\u8bba\u5185\u5b58\u662f\u5426\u5145\u8db3\uff0c\u90fd\u4f1a\u88ab\u56de\u6536\u3002</p> <p>\u4f7f\u7528WeakReference\u7c7b\u6765\u521b\u5efa\u5f31\u5f15\u7528\u5bf9\u8c61\uff0c\u5f31\u5f15\u7528\u4e3b\u8981\u5728ThreadLocal\u4e2d\u4f7f\u7528\u3002</p> <pre><code>byte[] bytes = new byte[1024 * 1024 * 100];\nWeakReference&lt;byte[]&gt; weakReference = new WeakReference&lt;&gt;(bytes);\nbytes = null;\nSystem.out.println(weakReference.get());\nSystem.gc();\nSystem.out.println(weakReference.get());\n\n// \u8f93\u51fa\uff1a\n// [B@776ec8df\n// null\n</code></pre>"},{"location":"JVM/JVM-base/#\u865a\u5f15\u7528\u548c\u7ec8\u7ed3\u5668\u5f15\u7528","title":"\u865a\u5f15\u7528\u548c\u7ec8\u7ed3\u5668\u5f15\u7528","text":"<p>\u4e0d\u80fd\u901a\u8fc7\u865a\u5f15\u7528\u6765\u83b7\u53d6\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u865a\u5f15\u7528\u4e3b\u8981\u7528\u4e8e\u5728\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u65f6\u6536\u5230\u4e00\u4e2a\u7cfb\u7edf\u901a\u77e5\u3002</p> <p>\u7ec8\u7ed3\u5668\u5f15\u7528\u662fJava\u865a\u62df\u673a\u5185\u90e8\u4f7f\u7528\u7684\u4e00\u79cd\u5f15\u7528\u7c7b\u578b\uff0c\u7528\u4e8e\u5b9e\u73b0\u5bf9\u8c61\u7684\u7ec8\u7ed3\u5668\u673a\u5236\u3002</p>"},{"location":"JVM/JVM-base/#\u5783\u573e\u56de\u6536\u7b97\u6cd5","title":"\u5783\u573e\u56de\u6536\u7b97\u6cd5","text":"<ol> <li> <p>1960\u5e74\uff1a\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5</p> </li> <li> <p>1963\u5e74\uff1a\u590d\u5236\u7b97\u6cd5</p> </li> </ol> <p>\u540e\u7eed\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\u4e3b\u8981\u662f\u5728\u8fd9\u4e24\u79cd\u7b97\u6cd5\u7684\u57fa\u7840\u4e0a\u53d1\u5c55\u800c\u6765\u7684\u3002\u5982\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u548c\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5\u3002</p> <p>\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7684\u8bc4\u4ef7\u6807\u51c6\uff1a</p> <ul> <li> <p>\u541e\u5410\u91cf\uff08Throughput\uff09\uff1a\u8868\u793a\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4\u4e0e\u5783\u573e\u56de\u6536\u65f6\u95f4\u7684\u6bd4\u4f8b</p> </li> <li> <p>\u6700\u5927\u6682\u505c\u65f6\u95f4\uff08Stop-the-world\uff09\uff1a\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\u5e94\u7528\u7a0b\u5e8f\u6682\u505c\u7684\u65f6\u95f4</p> </li> <li> <p>\u5806\u7a7a\u95f4\u4f7f\u7528\u7387\uff08Heap Footprint\uff09\uff1a\u5783\u573e\u56de\u6536\u5bf9\u5806\u5185\u5b58\u7684\u4f7f\u7528\u6548\u7387</p> </li> </ul>"},{"location":"JVM/JVM-base/#\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5","title":"\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5","text":"<p>\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ol> <li> <p>\u6807\u8bb0\u9636\u6bb5\uff1a\u4eceGC Root\u5bf9\u8c61\u5f00\u59cb\uff0c\u904d\u5386\u6240\u6709\u53ef\u8fbe\u7684\u5bf9\u8c61\uff0c\u5e76\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u6807\u8bb0\u4e3a\u201c\u5b58\u6d3b\u201d</p> </li> <li> <p>\u6e05\u9664\u9636\u6bb5\uff1a\u904d\u5386\u5806\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\uff0c\u6e05\u9664\u672a\u88ab\u6807\u8bb0\u4e3a\u201c\u5b58\u6d3b\u201d\u7684\u5bf9\u8c61\uff0c\u91ca\u653e\u5176\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4</p> </li> </ol> <p>\u8bc4\u4ef7</p> <p>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u9636\u6bb5\u7ed9\u6bcf\u4e2a\u5bf9\u8c61\u7ef4\u62a4\u6807\u5fd7\u4f4d\uff0c\u7b2c\u4e8c\u9636\u6bb5\u5220\u9664\u5bf9\u8c61\u5373\u53ef</p> <p>\u7f3a\u70b9\uff1a</p> <ul> <li> <p>\u788e\u7247\u5316\u95ee\u9898\uff0c\u5bf9\u8c61\u5220\u9664\u540e\u5185\u5b58\u4e2d\u4f1a\u51fa\u73b0\u5f88\u591a\u7ec6\u5c0f\u7684\u53ef\u7528\u5185\u5b58\u5355\u5143\uff0c\u5982\u679c\u9700\u8981\u8f83\u5927\u7684\u7a7a\u95f4\uff0c\u8fd9\u4e9b\u788e\u7247\u65e0\u6cd5\u88ab\u5206\u914d</p> </li> <li> <p>\u5206\u914d\u901f\u5ea6\u6162\uff0c\u7531\u4e8e\u5185\u5b58\u788e\u7247\u5b58\u5728\uff0c\u9700\u8981\u8fdb\u884c\u904d\u5386\u5bfb\u627e\u53ef\u7528\u7a7a\u95f4</p> </li> </ul>"},{"location":"JVM/JVM-base/#\u590d\u5236\u7b97\u6cd5","title":"\u590d\u5236\u7b97\u6cd5","text":"<ol> <li> <p>\u590d\u5236\u7b97\u6cd5\u5c06\u5806\u5185\u5b58\u5212\u5206\u4e3a\u4e24\u5757\u5927\u5c0f\u76f8\u7b49\u7684\u533a\u57df\uff0c\u79f0\u4e3aFrom\u533a\u548cTo\u533a\uff0c\u521d\u59cb\u65f6From\u533a\u7528\u4e8e\u5206\u914d\u5bf9\u8c61\uff0cTo\u533a\u4e3a\u7a7a\u95f2\u72b6\u6001</p> </li> <li> <p>\u5f53\u9700\u8981\u8fdb\u884c\u5783\u573e\u56de\u6536\u65f6\uff0c\u53ea\u626b\u63cfFrom\u533a\uff0c\u5c06\u5b58\u6d3b\u7684\u5bf9\u8c61\u590d\u5236\u5230To\u533a\uff0c\u7136\u540e\u6e05\u7a7aFrom\u533a</p> </li> <li> <p>\u7136\u540e\u4ea4\u6362From\u533a\u548cTo\u533a\u7684\u89d2\u8272</p> </li> </ol> <p>\u8bc4\u4ef7</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u541e\u5410\u91cf\u9ad8</li> <li>\u4e0d\u4f1a\u53d1\u751f\u788e\u7247\u5316</li> </ul> <p>\u7f3a\u70b9\uff1a\u5185\u5b58\u4f7f\u7528\u6548\u7387\u4f4e</p>"},{"location":"JVM/JVM-base/#\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5","title":"\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5","text":"<p>\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u7684\u788e\u7247\u5316\u95ee\u9898\u3002</p> <ol> <li> <p>\u6807\u8bb0\u9636\u6bb5\uff1a\u4e0e\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u76f8\u540c\uff0c\u4eceGC Root\u5bf9\u8c61\u5f00\u59cb\uff0c\u904d\u5386\u6240\u6709\u53ef\u8fbe\u7684\u5bf9\u8c61\uff0c\u5e76\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u6807\u8bb0\u4e3a\u201c\u5b58\u6d3b\u201d</p> </li> <li> <p>\u6574\u7406\u9636\u6bb5\uff1a\u5c06\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u5411\u4e00\u7aef\u79fb\u52a8\uff0c\u4fdd\u6301\u5bf9\u8c61\u7684\u76f8\u5bf9\u987a\u5e8f\u4e0d\u53d8\uff0c\u7136\u540e\u6e05\u9664\u8fb9\u754c\u5916\u7684\u5185\u5b58\u7a7a\u95f4</p> </li> </ol> <p>\u8bc4\u4ef7</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u5185\u5b58\u4f7f\u7528\u7387\u9ad8</li> <li>\u4e0d\u4f1a\u53d1\u751f\u788e\u7247\u5316</li> </ul> <p>\u7f3a\u70b9\uff1a\u6574\u7406\u9636\u6bb5\u6548\u7387\u4e0d\u9ad8\uff0c\u9700\u8981\u79fb\u52a8\u5bf9\u8c61\u548c\u66f4\u65b0\u5f15\u7528</p>"},{"location":"JVM/JVM-base/#\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5","title":"\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5","text":"<p>\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5\u662f\u76ee\u524d\u4e3b\u6d41\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u57fa\u4e8e\u4ee5\u4e0b\u4e24\u4e2a\u73b0\u8c61\uff1a</p> <ol> <li> <p>\u5927\u90e8\u5206\u5bf9\u8c61\u90fd\u662f\u201c\u671d\u751f\u66ae\u6b7b\u201d\u7684\uff0c\u5373\u5728\u77ed\u65f6\u95f4\u5185\u88ab\u521b\u5efa\u53c8\u88ab\u9500\u6bc1\u3002</p> </li> <li> <p>\u5b58\u6d3b\u65f6\u95f4\u8f83\u957f\u7684\u5bf9\u8c61\uff0c\u901a\u5e38\u4f1a\u5728\u8001\u5e74\u4ee3\u4e2d\u5360\u636e\u8f83\u5927\u7684\u7a7a\u95f4\u3002</p> </li> </ol> <p>\u57fa\u4e8e\u4ee5\u4e0a\u73b0\u8c61\uff0c\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5\u5c06\u5806\u5185\u5b58\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u533a\u57df\uff0c\u901a\u5e38\u5206\u4e3a\uff1a</p> <ul> <li> <p>\u65b0\u751f\u4ee3\uff08Young Generation\uff09</p> </li> <li> <p>\u8001\u5e74\u4ee3\uff08Old Generation\uff09</p> </li> </ul> <p></p> <p>\u5806\u533a\u865a\u62df\u673a\u53c2\u6570</p> <ul> <li>Xms\uff1a\u8bbe\u7f6e\u521d\u59cb\u5806\u5927\u5c0f</li> <li>Xmx\uff1a\u8bbe\u7f6e\u6700\u5927\u5806\u5927\u5c0f</li> <li>Xmn\uff1a\u8bbe\u7f6e\u65b0\u751f\u4ee3\u5927\u5c0f</li> <li>XX:SurvivorRatio\uff1a\u8bbe\u7f6eEden\u533a\u4e0eSurvivor\u533a\u7684\u6bd4\u4f8b\u9ed8\u8ba4\u4e3a8</li> <li>XX:NewRatio\uff1a\u8bbe\u7f6e\u65b0\u751f\u4ee3\u4e0e\u8001\u5e74\u4ee3\u7684\u6bd4\u4f8b\u9ed8\u8ba4\u4e3a2</li> <li>XX:+PrintGCDetails\uff1a\u6253\u5370GC\u65e5\u5fd7</li> </ul> <p>\u56de\u6536\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u9996\u5148\u5206\u914d\u5728\u65b0\u751f\u4ee3\u7684Eden\u533a</p> </li> <li> <p>\u5f53Eden\u533a\u6ee1\u65f6\uff0c\u89e6\u53d1Minor GC\uff08\u6216Young GC\uff09\uff0c\u56de\u6536\u65b0\u751f\u4ee3\u4e2d\u7684\u5783\u573e\u5bf9\u8c61</p> </li> <li> <p>\u5728Minor GC\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u6d3b\u7684\u5bf9\u8c61\u4f1a\u88ab\u79fb\u52a8\u5230Survivor\u7684To\u533a\uff0cSurvivor\u533a\u4f7f\u7528\u590d\u5236\u7b97\u6cd5\u8fdb\u884c\u5783\u573e\u56de\u6536</p> </li> <li> <p>\u6bcf\u6b21Minor GC\u540e\uff0c\u5176\u4e2d\u5b58\u6d3b\u7684\u5bf9\u8c61\u5e74\u9f84\u4f1a\u52a01\uff0c\u5f53\u5bf9\u8c61\u5e74\u9f84\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\uff08\u9ed8\u8ba415\uff09\uff0c\u4f1a\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3</p> </li> <li> <p>\u5f53\u8001\u5e74\u4ee3\u6ee1\u65f6\uff0c\u89e6\u53d1Major GC\uff08\u6216Full GC\uff09\uff0c\u56de\u6536\u6574\u4e2a\u5806\u4e2d\u7684\u5783\u573e\u5bf9\u8c61</p> </li> </ol> <p>\u5173\u4e8e\u5bf9\u8c61\u664b\u5347\u9608\u503c</p> <p>\u201cHotspot \u904d\u5386\u6240\u6709\u5bf9\u8c61\u65f6\uff0c\u6309\u7167\u5e74\u9f84\u4ece\u5c0f\u5230\u5927\u5bf9\u5176\u6240\u5360\u7528\u7684\u5927\u5c0f\u8fdb\u884c\u7d2f\u79ef\uff0c\u5f53\u7d2f\u79ef\u7684\u67d0\u4e2a\u5e74\u9f84\u5927\u5c0f\u8d85\u8fc7\u4e86 survivor \u533a\u7684 50% \u65f6\uff08\u9ed8\u8ba4\u503c\u662f 50%\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>-XX:TargetSurvivorRatio=percent</code> \u6765\u8bbe\u7f6e\uff0c\u53c2\u89c1 issue1199 \uff09\uff0c\u53d6\u8fd9\u4e2a\u5e74\u9f84\u548c MaxTenuringThreshold \u4e2d\u66f4\u5c0f\u7684\u4e00\u4e2a\u503c\uff0c\u4f5c\u4e3a\u65b0\u7684\u664b\u5347\u5e74\u9f84\u9608\u503c\u201d\u3002</p> <p>\u8457\u4f5c\u6743\u5f52JavaGuide(javaguide.cn)\u6240\u6709 \u57fa\u4e8eMIT\u534f\u8bae \u539f\u6587\u94fe\u63a5\uff1ahttps://javaguide.cn/java/jvm/jvm-garbage-collection.html</p> <p>\u4e3a\u4ec0\u4e48\u8981\u628a\u5806\u533a\u5206\u4ee3\uff1f</p> <ul> <li>\u53ef\u8c03\u8282\u6027\u5f3a\uff1a\u53ef\u4ee5\u6839\u636e\u5e94\u7528\u7684\u7279\u70b9\u8c03\u6574\u5404\u4e2a\u533a\u57df\u7684\u5927\u5c0f\u548c\u6bd4\u4f8b</li> <li>\u63d0\u9ad8\u56de\u6536\u6548\u7387\uff1a\u9488\u5bf9\u4e0d\u540c\u533a\u57df\u91c7\u7528\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u63d0\u9ad8\u6574\u4f53\u56de\u6536\u6548\u7387</li> <li>\u51cf\u5c11\u505c\u987f\u65f6\u95f4\uff1a\u901a\u8fc7\u5206\u4ee3\u56de\u6536\uff0c\u51cf\u5c11\u6bcf\u6b21\u5783\u573e\u56de\u6536\u7684\u505c\u987f\u65f6\u95f4</li> </ul>"},{"location":"JVM/JVM-base/#\u5783\u573e\u56de\u6536\u5668","title":"\u5783\u573e\u56de\u6536\u5668","text":"<p>\u5783\u573e\u56de\u6536\u5668\u662f\u5b9e\u73b0\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7684\u5177\u4f53\u5de5\u5177\uff0c\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u5668\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u3002</p> <p>\u6709\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u7684\u5783\u573e\u56de\u6536\u5668\uff1a</p> <ul> <li> <p>Serial\u5783\u573e\u56de\u6536\u5668</p> </li> <li> <p>ParNew\u5783\u573e\u56de\u6536\u5668</p> </li> <li> <p>Parallel\u5783\u573e\u56de\u6536\u5668</p> </li> <li> <p>CMS\u5783\u573e\u56de\u6536\u5668</p> </li> <li> <p>G1\u5783\u573e\u56de\u6536\u5668</p> </li> </ul>"},{"location":"JVM/JVM-base/#serial","title":"Serial","text":"<p>\u5e74\u8f7b\u4ee3\u4f7f\u7528Serial\u5783\u573e\u56de\u6536\u5668\uff0c\u8001\u5e74\u4ee3\u4f7f\u7528Serial Old\u5783\u573e\u56de\u6536\u5668\u3002</p> <ul> <li>Serial\u5783\u573e\u56de\u6536\u5668\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u9002\u7528\u4e8e\u5355\u6838\u5904\u7406\u5668\u6216\u8005\u5bf9\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u4e0d\u9ad8\u7684\u5e94\u7528</li> </ul> <p>Example</p> <p><code>-XX:+UseSerialGC</code>\u5f00\u542fSerial\u5783\u573e\u56de\u6536\u5668</p>"},{"location":"JVM/JVM-base/#parnew--cms","title":"ParNew + CMS","text":"<p>\u5e74\u8f7b\u4ee3\u4f7f\u7528ParNew\u5783\u573e\u56de\u6536\u5668\uff0c\u8001\u5e74\u4ee3\u4f7f\u7528CMS\u5783\u573e\u56de\u6536\u5668\u3002</p> <ul> <li>ParNew\u5783\u573e\u56de\u6536\u5668\u662f\u591a\u7ebf\u7a0b\u7684\uff08Serial \u5728\u591aCPU\u4e0b\u7684\u4f18\u5316\uff09\uff0c\u9002\u7528\u4e8e\u591a\u6838\u5904\u7406\u5668\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5e74\u8f7b\u4ee3\u5783\u573e\u56de\u6536\u7684\u6548\u7387</li> </ul> <p>Example</p> <p><code>-XX:+UseParNewGC</code>\u5f00\u542fParNew\u5783\u573e\u56de\u6536\u5668</p> <ul> <li>CMS\u5783\u573e\u56de\u6536\u5668\u662f\u5e76\u53d1\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff0c\u9002\u7528\u4e8e\u5bf9\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u8f83\u9ad8\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u51cf\u5c11\u505c\u987f\u65f6\u95f4</li> </ul> <p>CMS\u56de\u6536\u8fc7\u7a0b</p> <ul> <li>\u521d\u59cb\u6807\u8bb0\uff08Initial Mark\uff09\uff1a\u6807\u8bb0\u4e0eGC Root\u76f4\u63a5\u5173\u8054\u7684\u5bf9\u8c61\uff0c\u505c\u987f\u65f6\u95f4\u77ed</li> <li>\u5e76\u53d1\u6807\u8bb0\uff08Concurrent Mark\uff09\uff1a\u4e0e\u5e94\u7528\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\uff0c\u6807\u8bb0\u6240\u6709\u53ef\u8fbe\u7684\u5bf9\u8c61</li> <li>\u91cd\u65b0\u6807\u8bb0\uff08Remark\uff09\uff1a\u4fee\u6b63\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\u9057\u6f0f\u7684\u5bf9\u8c61\uff0c\u505c\u987f\u65f6\u95f4\u8f83\u77ed</li> <li>\u5e76\u53d1\u6e05\u9664\uff08Concurrent Sweep\uff09\uff1a\u4e0e\u5e94\u7528\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\uff0c\u6e05\u9664\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61</li> <li>\u5e76\u53d1\u91cd\u7f6e\uff08Concurrent Reset\uff09\uff1a\u91cd\u7f6eCMS\u76f8\u5173\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e3a\u4e0b\u4e00\u6b21\u5783\u573e\u56de\u6536\u505a\u51c6\u5907</li> </ul> <p>Example</p> <p><code>-XX:+UseConcMarkSweepGC</code>\u5f00\u542fCMS\u5783\u573e\u56de\u6536\u5668</p> <p>\u6ce8\u610f</p> <p>CMS\u5783\u573e\u56de\u6536\u5668\u4f1a\u4ea7\u751f\u5185\u5b58\u788e\u7247\uff0cFull GC\u65f6\u4f1a\u8fdb\u884c\u788e\u7247\u6574\u7406\uff0c\u6682\u505c\u65f6\u95f4\u8f83\u957f</p>"},{"location":"JVM/JVM-base/#parallel","title":"Parallel","text":"<p>\u5e74\u8f7b\u4ee3\u4f7f\u7528Parallel\u5783\u573e\u56de\u6536\u5668\uff0c\u8001\u5e74\u4ee3\u4f7f\u7528Parallel Old\u5783\u573e\u56de\u6536\u5668\u3002</p> <ul> <li>Parallel\u5783\u573e\u56de\u6536\u5668\u662f\u591a\u7ebf\u7a0b\u7684\uff0c\u9002\u7528\u4e8e\u591a\u6838\u5904\u7406\u5668\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5783\u573e\u56de\u6536\u7684\u6548\u7387</li> </ul> <p>Example</p> <p><code>-XX:+UseParallelGC</code>\u5f00\u542fParallel\u5783\u573e\u56de\u6536\u5668</p> <p>Quote</p> <p>Parallel\u5141\u8bb8\u8bbe\u7f6e\u6700\u5927\u6682\u505c\u65f6\u95f4\uff08<code>-XX:MaxGCPauseMillis</code>\uff09\u548c\u6700\u5c0f\u541e\u5410\u91cf\uff08<code>-XX:GCTimeRatio</code>\uff09\uff0cJVM\u4f1a\u6839\u636e\u8fd9\u4e9b\u53c2\u6570\u52a8\u6001\u8c03\u6574\u5783\u573e\u56de\u6536\u7684\u9891\u7387\u548c\u65f6\u95f4\uff0c\u4ee5\u8fbe\u5230\u6700\u4f73\u7684\u6027\u80fd\u5e73\u8861\u3002</p> <p>Oracle\u5b98\u65b9\u5efa\u8bae\u4f7f\u7528\u8be5\u5783\u573e\u56de\u6536\u5668\u7ec4\u5408\u65f6\u4e0d\u8981\u8bbe\u7f6e<code>-Xmx</code>\u548c<code>-Xms</code>\u53c2\u6570\uff0c\u5141\u8bb8JVM\u52a8\u6001\u8c03\u6574\u5806\u5185\u5b58\u5927\u5c0f\u3002</p>"},{"location":"JVM/JVM-base/#g1","title":"G1","text":"<p>G1\u662fJDK9\u4e4b\u540e\u7684\u9ed8\u8ba4\u5783\u573e\u56de\u6536\u5668\uff0c\u9002\u7528\u4e8e\u5927\u5185\u5b58\u548c\u591a\u6838\u5904\u7406\u5668\u7684\u5e94\u7528\u3002</p> <p>Example</p> <p><code>-XX:+UseG1GC</code>\u5f00\u542fG1\u5783\u573e\u56de\u6536\u5668</p> <p>\u5176\u5177\u6709\u5982\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li> <p>\u9ad8\u541e\u5410\u91cf\uff1a\u901a\u8fc7\u5e76\u884c\u548c\u5e76\u53d1\u7684\u5783\u573e\u56de\u6536\uff0c\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u7684\u541e\u5410\u91cf</p> </li> <li> <p>\u53ef\u9884\u6d4b\u7684\u505c\u987f\u65f6\u95f4\uff1a\u901a\u8fc7\u5206\u533a\u56de\u6536\u548c\u6682\u505c\u65f6\u95f4\u76ee\u6807\uff0c\u51cf\u5c11\u5783\u573e\u56de\u6536\u5bf9\u5e94\u7528\u7a0b\u5e8f\u7684\u5f71\u54cd</p> </li> <li> <p>\u4f4e\u5185\u5b58\u788e\u7247\uff1a\u901a\u8fc7\u5206\u533a\u56de\u6536\u548c\u6574\u7406\uff0c\u51cf\u5c11\u5185\u5b58\u788e\u7247\uff0c\u63d0\u9ad8\u5185\u5b58\u5229\u7528\u7387</p> </li> <li> <p>\u652f\u6301\u5927\u5185\u5b58\uff1a\u53ef\u4ee5\u5904\u7406\u6570\u767eGB\u751a\u81f3TB\u7ea7\u522b\u7684\u5806\u5185\u5b58</p> </li> </ul> <p>Attention</p> <p>JDK9\u4e4b\u540e\u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684G1\u5783\u573e\u56de\u6536\u5668\uff0c\u9664\u975e\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u5426\u5219\u4e0d\u5efa\u8bae\u66f4\u6539</p> <p></p> <p>G1\u5c06\u5806\u5185\u5b58\u5212\u5206\u4e3a\u591a\u4e2a\u5927\u5c0f\u76f8\u7b49\u7684\u533a\u57df\uff08Region\uff09\uff0c\u6bcf\u4e2a\u533a\u57df\u53ef\u4ee5\u662fEden\u533a\u3001Survivor\u533a\u6216\u8005Old\u533a\u3002Region\u7684\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7<code>-XX:G1HeapRegionSize</code>\u53c2\u6570\u8bbe\u7f6e\uff0c\u8303\u56f4\u4ece1MB\u523032MB\uff0c\u9ed8\u8ba4\u503c\u6839\u636e\u5806\u5927\u5c0f\u81ea\u52a8\u8c03\u6574\u3002</p> <p></p> <p>G1\u7684\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ol> <li> <p>Young GC\uff1a\u56de\u6536\u5e74\u8f7b\u4ee3\u533a\u57df\uff08Eden\u533a\u548cSurvivor\u533a\uff09\u7684\u5783\u573e\u5bf9\u8c61\uff0c\u4f1a\u5bfc\u81f4STW\uff0c\u53ef\u901a\u8fc7<code>-XX:MaxGCPauseMillis</code>\u53c2\u6570\u8bbe\u7f6e\u6700\u5927\u6682\u505c\u65f6\u95f4\uff08\u9ed8\u8ba4200ms\uff09</p> </li> <li> <p>Mixed GC\uff1a\u56de\u6536\u5e74\u8f7b\u4ee3\u548c\u90e8\u5206\u8001\u5e74\u4ee3\u533a\u57df\u7684\u5783\u573e\u5bf9\u8c61</p> </li> </ol> <p>Young GC</p> <ol> <li> <p>\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u4f1a\u5b58\u653e\u5728Eden\u533a\u3002\u5f53G1\u5224\u65ad\u5e74\u8f7b\u4ee3\u533a\u4e0d\u8db3\uff08max\u9ed8\u8ba460%\uff09\u65f6\u4f1a\u6267\u884cYoung GC\u3002</p> </li> <li> <p>\u6807\u8bb0\u51faEden\u548cSurvivor\u533a\u57df\u4e2d\u7684\u5b58\u6d3b\u5bf9\u8c61\uff0c</p> </li> <li> <p>\u6839\u636e\u914d\u7f6e\u7684\u6700\u5927\u6682\u505c\u65f6\u95f4\u9009\u62e9\u67d0\u4e9b\u533a\u57df\u5c06\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230\u4e00\u4e2a\u65b0\u7684Survivor\u533a\u4e2d\uff08\u5e74\u9f84+1\uff09\uff0c\u6e05\u7a7a\u8fd9\u4e9b\u533a\u57df\u3002</p> </li> <li> <p>\u540e\u7eedYoung GC\u65f6\u4e0e\u4e4b\u524d\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7Survivor\u533a\u4e2d\u5b58\u6d3b\u5bf9\u8c61\u4f1a\u88ab\u642c\u8fd0\u5230\u53e6\u4e00\u4e2aSurvivor\u533a\u3002</p> </li> <li> <p>\u5f53\u67d0\u4e2a\u5b58\u6d3b\u5bf9\u8c61\u7684\u5e74\u9f84\u5230\u8fbe\u9608\u503c\uff08\u9ed8\u8ba415\uff09\uff0c\u5c06\u88ab\u653e\u5165\u8001\u5e74\u4ee3\u3002</p> </li> <li> <p>\u90e8\u5206\u5bf9\u8c61\u5982\u679c\u5927\u5c0f\u8d85\u8fc7Region\u7684\u4e00\u534a\uff0c\u4f1a\u76f4\u63a5\u653e\u5165\u8001\u5e74\u4ee3\uff0c\u8fd9\u7c7b\u8001\u5e74\u4ee3\u88ab\u79f0\u4e3aHumongous\u533a\u3002\u6bd4\u5982\u5806\u5185\u5b58\u662f4G\uff0c\u6bcf\u4e2aRegion\u662f2M\uff0c\u53ea\u8981\u4e00\u4e2a\u5927\u5bf9\u8c61\u8d85\u8fc7\u4e861M\u5c31\u88ab\u653e\u5165Humongous\u533a\uff0c\u5982\u679c\u5bf9\u8c61\u8fc7\u5927\u4f1a\u6a2a\u8de8\u591a\u4e2aRegion\u3002</p> </li> <li> <p>\u591a\u6b21\u56de\u6536\u4e4b\u540e\uff0c\u4f1a\u51fa\u73b0\u5f88\u591aOld\u8001\u5e74\u4ee3\u533a\uff0c\u6b64\u65f6\u603b\u5806\u5360\u6709\u7387\u8fbe\u5230\u9608\u503c\u65f6\uff08<code>-XX:InitiatingHeapOccupancyPercent</code>\u9ed8\u8ba445%\uff09\u4f1a\u89e6\u53d1\u6df7\u5408\u56de\u6536Mixed GC\u3002</p> </li> </ol> <p>G1\u4fdd\u8bc1\u6700\u5927\u6682\u505c\u65f6\u95f4</p> <p>G1\u5728\u8fdb\u884cYoung GC\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u53bb\u8bb0\u5f55\u6bcf\u6b21\u5783\u573e\u56de\u6536\u65f6\u6bcf\u4e2aEden\u533a\u548cSurvivor\u533a\u7684\u5e73\u5747\u8017\u65f6\u3002</p> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\u7684\u6700\u5927\u6682\u505c\u65f6\u95f4\u8ba1\u7b97\u51fa\u672c\u6b21\u56de\u6536\u65f6\u6700\u591a\u80fd\u56de\u6536\u591a\u5c11\u4e2aRegion\u533a\u57df\u4e86\u3002</p> <p>\u6bd4\u5982 -XX:MaxGCPauseMillis=n\uff08\u9ed8\u8ba4200\uff09\uff0c\u6bcf\u4e2aRegion\u56de\u6536\u8017\u65f640ms\uff0c\u90a3\u4e48\u8fd9\u6b21\u56de\u6536\u6700\u591a\u53ea\u80fd\u56de\u65364\u4e2aRegion\u3002</p> <p>Mixed GC</p> <ol> <li> <p>Mixed GC\u4f1a\u56de\u6536\u5e74\u8f7b\u4ee3\u548c\u90e8\u5206\u8001\u5e74\u4ee3\u533a\u57df\u7684\u5783\u573e\u5bf9\u8c61\u3002</p> </li> <li> <p>\u6e05\u7406\u65f6\u4f1a\u9009\u62e9\u5b58\u6d3b\u5ea6\u6700\u4f4e\u7684Region\u8fdb\u884c\u56de\u6536\uff0c\u4fdd\u8bc1\u56de\u6536\u6548\u7387\u6700\u9ad8\u3002\uff08\u8fd9\u662fG1\u540d\u5b57\u7684\u7531\u6765 Garbage First\uff09</p> </li> </ol> <p>\u56de\u6536\u8fc7\u7a0b\uff1a</p> <ul> <li> <p>\u521d\u59cb\u6807\u8bb0\uff08Initial Mark\uff09\uff1a\u6807\u8bb0\u4e0eGC Root\u76f4\u63a5\u5173\u8054\u7684\u5bf9\u8c61\uff0c\u505c\u987f\u65f6\u95f4\u77ed</p> </li> <li> <p>\u5e76\u53d1\u6807\u8bb0\uff08Concurrent Mark\uff09\uff1a\u4e0e\u5e94\u7528\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\uff0c\u6807\u8bb0\u6240\u6709\u53ef\u8fbe\u7684\u5bf9\u8c61</p> </li> <li> <p>\u91cd\u65b0\u6807\u8bb0\uff08Remark\uff09\uff1a\u4fee\u6b63\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\u9057\u6f0f\u7684\u5bf9\u8c61\uff0c\u505c\u987f\u65f6\u95f4\u8f83\u77ed</p> </li> <li> <p>\u5e76\u53d1\u6e05\u7406\uff08Cleanup\uff09\uff1a\u6e05\u7406\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61\uff08\u590d\u5236\u7b97\u6cd5\uff09\uff0c\u9009\u62e9\u5b58\u6d3b\u5ea6\u6700\u4f4e\u7684Region\u8fdb\u884c\u56de\u6536</p> </li> </ul> <p>Note</p> <p>\u5982\u679c\u6e05\u7406\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u6ca1\u6709\u8db3\u591f\u7684\u7a7aRegion\u5b58\u653e\u8f6c\u79fb\u7684\u5bf9\u8c61\uff0c\u4f1a\u89e6\u53d1 Full GC \u5355\u7ebf\u7a0b\u6267\u884c\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\uff0c\u6b64\u65f6\u4f1a\u5bfc\u81f4\u7528\u6237\u7ebf\u7a0b\u7684\u6682\u505c\u3002\u6240\u4ee5\u5c3d\u91cf\u4fdd\u8bc1\u5e94\u8be5\u7528\u7684\u5806\u5185\u5b58\u6709\u4e00\u5b9a\u591a\u4f59\u7684\u7a7a\u95f4\u3002</p>"},{"location":"JVM/JVM-base/#\u5783\u573e\u56de\u6536\u5668\u9009\u62e9","title":"\u5783\u573e\u56de\u6536\u5668\u9009\u62e9","text":"<p>JDK8\u53ca\u4e4b\u524d\uff1a</p> <ul> <li> <p>\u5173\u6ce8\u6682\u505c\u65f6\u95f4\uff1aParNew + CMS</p> </li> <li> <p>\u5173\u6ce8\u541e\u5410\u91cf\uff1aParallel + Parallel Old</p> </li> <li> <p>\u5355\u6838\u5904\u7406\u5668\u6216\u5bf9\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u4e0d\u9ad8\uff1aSerial + Serial Old</p> </li> <li> <p>\u5806\u5185\u5b58\u8f83\u5927\uff1aG1</p> </li> </ul> <p>JDK9\u53ca\u4e4b\u540e\uff1a</p> <ul> <li>\u9ed8\u8ba4G1\u5783\u573e\u56de\u6536\u5668\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u573a\u666f</li> </ul> <p>\u4e0b\u4e00\u8282\uff1a JVM\u5b9e\u8df5</p>"},{"location":"JVM/JVM-practice/","title":"\u5185\u5b58\u8c03\u4f18","text":""},{"location":"JVM/JVM-practice/#\u5185\u5b58\u6cc4\u9732\u5185\u5b58\u6ea2\u51fa","title":"\u5185\u5b58\u6cc4\u9732&amp;&amp;\u5185\u5b58\u6ea2\u51fa","text":"<p>\u5728Java\u4e2d\u5982\u679c\u4e0d\u518d\u4f7f\u7528\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46\u662f\u8be5\u5bf9\u8c61\u4f9d\u7136\u5728GC root\u5f15\u7528\u94fe\u4e0a\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u4e0d\u4f1a\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\uff0c\u8fd9\u79cd\u60c5\u51b5\u79f0\u4e3a\u5185\u5b58\u6cc4\u6f0f</p> <p>\u5185\u5b58\u6cc4\u6f0f\u6700\u7ec8\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa</p>"},{"location":"JVM/JVM-practice/#\u89e3\u51b3\u5185\u5b58\u6ea2\u51fa","title":"\u89e3\u51b3\u5185\u5b58\u6ea2\u51fa","text":""},{"location":"JVM/JVM-practice/#\u53d1\u73b0\u95ee\u9898","title":"\u53d1\u73b0\u95ee\u9898","text":"<ol> <li> <p>Linux\u4e0b\u4f7f\u7528<code>top</code>\u547d\u4ee4\u67e5\u770bCPU\u548c\u5185\u5b58\u4f7f\u7528\u7387</p> <ul> <li>\u4f7f\u7528\u7b80\u5355\uff0c\u4f46\u662f\u529f\u80fd\u5355\u4e00</li> </ul> </li> <li> <p>VisualVm\u5de5\u5177\u67e5\u770b\u5806\u5185\u5b58\u548c\u975e\u5806\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5</p> <ul> <li>\u529f\u80fd\u5f3a\u5927\uff0c\u53ef\u4ee5\u67e5\u770b\u5185\u5b58\u3001\u7ebf\u7a0b\u3001\u7c7b\u7b49\u4fe1\u606f</li> </ul> </li> <li> <p>arthas\u5de5\u5177\u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5</p> <ul> <li>\u529f\u80fd\u5f3a\u5927\uff0c\u652f\u6301\u5728\u7ebf\u8bca\u65ad</li> </ul> </li> <li> <p>\u4f7f\u7528Prometheus+Grafana\u76d1\u63a7Java\u5e94\u7528</p> <ul> <li>\u4f01\u4e1a\u4e2d\u5e38\u7528\u7684\u76d1\u63a7\u65b9\u6848</li> </ul> </li> <li> <p>\u67e5\u770b\u5806\u5185\u5b58\u76d1\u63a7\u56fe </p> </li> </ol> <p>\u6848\u4f8b</p> <p>\u4f7f\u7528\u963f\u91ccarthas tunnel\u7ba1\u7406\u6240\u6709\u7684\u9700\u8981\u76d1\u63a7\u7684\u7a0b\u5e8f</p> <p>\u80cc\u666f\uff1a\u56e2\u961f\u5df2\u7ecf\u666e\u53ca\u4e86arthas\u7684\u4f7f\u7528\uff0c\u4f46\u662f\u7531\u4e8e\u4f7f\u7528\u4e86\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u751f\u4ea7\u73af\u5883\u4e0a\u7684\u5e94\u7528\u6570\u91cf\u975e\u5e38\u591a\uff0c\u4f7f\u7528arthas\u8fd8\u5f97\u767b\u5f55\u5230\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u518d\u53bb\u64cd\u4f5c\u975e\u5e38\u4e0d\u65b9\u4fbf\u3002\u56e2\u961f\u8c03\u7814\u53d1\u73b0\u5b98\u65b9\u6587\u6863\u8bf4\u660e\u53ef\u4ee5\u4f7f\u7528tunnel\u6765\u7ba1\u7406\u6240\u6709\u9700\u8981\u76d1\u63a7\u7684\u7a0b\u5e8f\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5728Spring Boot\u7a0b\u5e8f\u4e2d\u6dfb\u52a0arthas\u7684\u4f9d\u8d56\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0tunnel\u670d\u52a1\u7aef\u7684\u5730\u5740\uff0c\u4fbf\u4e8etunnel\u53bb\u76d1\u63a7\u6240\u6709\u7684\u7a0b\u5e8f\u3002</p> </li> <li> <p>\u5c06tunnel\u670d\u52a1\u7aef\u7a0b\u5e8f\u90e8\u7f72\u5728\u67d0\u53f0\u670d\u52a1\u5668\u4e0a\u5e76\u542f\u52a8\u3002</p> </li> <li> <p>\u542f\u52a8\u9700\u8981\u76d1\u63a7\u7684\u7a0b\u5e8f\uff0c\u67e5\u770b\u65e5\u5fd7\u786e\u8ba4\u5df2\u7ecf\u8fde\u63a5\u4e0atunnel\u670d\u52a1\u7aef\u3002</p> </li> <li> <p>\u6253\u5f00tunnel\u7684\u670d\u52a1\u7aef\u9875\u9762\uff0c\u67e5\u770b\u6240\u6709\u7684\u8fdb\u7a0b\u5217\u8868\uff0c\u5e76\u9009\u62e9\u8fdb\u7a0b\u8fdb\u884carthas\u7684\u64cd\u4f5c\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u5728\u7ebf\u5b9a\u4f4d\u95ee\u9898","title":"\u5728\u7ebf\u5b9a\u4f4d\u95ee\u9898","text":"<ol> <li> <p>\u4f7f\u7528<code>jmap-histo:live \u8fdb\u7a0bID &gt; \u6587\u4ef6\u540d</code> \u547d\u4ee4\u5c06\u5185\u5b58\u4e2d\u5b58\u6d3b\u5bf9\u8c61\u4ee5\u76f4\u65b9\u56fe\u7684\u5f62\u5f0f\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u5f71\u54cd\u7528\u6237\u7684\u65f6\u95f4\uff0c\u4f46\u662f\u65f6\u95f4\u6bd4\u8f83\u77ed\u6682\u3002</p> </li> <li> <p>\u5206\u6790\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u5bf9\u8c61\uff0c\u4e00\u822c\u8fd9\u4e9b\u5bf9\u8c61\u5c31\u662f\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\u7684\u539f\u56e0\u3002</p> </li> <li> <p>\u4f7f\u7528arthas\u7684<code>stack</code>\u547d\u4ee4,<code>stack \u5168\u9650\u5b9a\u7c7b\u540d [\u65b9\u6cd5\u540d]</code>\uff0c\u8ffd\u8e2a\u5bf9\u8c61\u521b\u5efa\u7684\u65b9\u6cd5\u88ab\u8c03\u7528\u7684\u8c03\u7528\u8def\u5f84\uff0c\u627e\u5230\u5bf9\u8c61\u521b\u5efa\u7684\u6839\u6e90\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528btrace\u5de5\u5177\u7f16\u5199\u811a\u672c\u8ffd\u8e2a\u65b9\u6cd5\u6267\u884c\u7684\u8fc7\u7a0b\u3002</p> </li> </ol> <p>Note</p> <p>BTrace \u662f\u4e00\u4e2a\u5728Java \u5e73\u53f0\u4e0a\u6267\u884c\u7684\u8ffd\u8e2a\u5de5\u5177\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u7528\u4e8e\u7ebf\u4e0a\u8fd0\u884c\u7cfb\u7edf\u7684\u65b9\u6cd5\u8ffd\u8e2a\uff0c\u5177\u6709\u4fb5\u5165\u6027\u5c0f\u3001\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u5fae\u4e4e\u5176\u5fae\u7b49\u7279\u70b9\u3002\u9879\u76ee\u4e2d\u53ef\u4ee5\u4f7f\u7528btrace\u5de5\u5177\uff0c\u6253\u5370\u51fa\u65b9\u6cd5\u88ab\u8c03\u7528\u7684\u6808\u4fe1\u606f\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a</p> <ol> <li> <p>\u4e0b\u8f7dbtrace\u5de5\u5177\uff0c \u5b98\u65b9\u5730\u5740\uff1agithub</p> </li> <li> <p>\u7f16\u5199btrace\u811a\u672c\uff0c\u901a\u5e38\u662f\u4e00\u4e2ajava\u6587\u4ef6\u3002</p> </li> <li> <p>\u5c06btrace\u5de5\u5177\u548c\u811a\u672c\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff0c\u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c btrace \u8fdb\u7a0bID \u811a\u672c\u6587\u4ef6\u540d \u3002</p> </li> <li> <p>\u89c2\u5bdf\u6267\u884c\u7ed3\u679c\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u4e24\u79cd\u65b9\u6848\u7684\u6bd4\u8f83","title":"\u4e24\u79cd\u65b9\u6848\u7684\u6bd4\u8f83","text":""},{"location":"JVM/JVM-practice/#\u5185\u5b58\u6ea2\u51fa\u539f\u56e0\u5206\u6790","title":"\u5185\u5b58\u6ea2\u51fa\u539f\u56e0\u5206\u6790","text":""},{"location":"JVM/JVM-practice/#\u4ee3\u7801\u89c4\u8303\u95ee\u9898","title":"\u4ee3\u7801\u89c4\u8303\u95ee\u9898","text":"<ol> <li> <p><code>equals</code>\u548c<code>hashCode</code>\u65b9\u6cd5\u91cd\u5199\u4e0d\u6b63\u786e</p> <p>equals\u548chashCode\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p>Java\u7684\u96c6\u5408\u7c7b\u4e2d\uff0c<code>HashMap</code>\u3001<code>HashSet</code>\u3001<code>Hashtable</code>\u7b49\u90fd\u4f7f\u7528\u4e86\u54c8\u5e0c\u8868\u6765\u5b58\u50a8\u6570\u636e\uff0c\u8fd9\u4e9b\u96c6\u5408\u7c7b\u5728\u5b58\u50a8\u6570\u636e\u65f6\u4f1a\u8c03\u7528\u5bf9\u8c61\u7684<code>hashCode</code>\u65b9\u6cd5\u6765\u8ba1\u7b97\u5bf9\u8c61\u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u6839\u636e\u54c8\u5e0c\u503c\u5c06\u5bf9\u8c61\u5b58\u50a8\u5230\u54c8\u5e0c\u8868\u4e2d\u3002</p> <p>\u5982\u679c\u5bf9\u8c61\u7684<code>hashCode</code>\u5b9e\u73b0\u6709\u95ee\u9898\uff0c\u5bfc\u81f4\u76f8\u540c\u7684\u5bf9\u8c61\u6bcf\u6b21\u8c03\u7528<code>hashCode</code>\u65b9\u6cd5\u65f6\u8fd4\u56de\u4e0d\u540c\u7684\u503c\uff0c\u90a3\u4e48\u5728\u5c06\u5bf9\u8c61\u5b58\u50a8\u5230\u54c8\u5e0c\u8868\u4e2d\u65f6\uff0c\u4f1a\u5bfc\u81f4\u5bf9\u8c61\u88ab\u5b58\u50a8\u5230\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u8fdb\u800c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u786e\u4fdd\u540c\u65f6\u91cd\u5199<code>equals</code>\u548c<code>hashCode</code>\u65b9\u6cd5\u3002</p> </li> <li> <p>\u786e\u4fdd<code>hashCode</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u503c\u5728\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u5185\u4fdd\u6301\u4e0d\u53d8\u3002</p> </li> </ul> </li> <li> <p>\u975e\u9759\u6001\u5185\u90e8\u7c7b\u548c\u533f\u540d\u7c7b\u9519\u8bef\u5730\u5f15\u7528\u5916\u90e8\u7c7b</p> <p>\u975e\u9759\u6001\u5185\u90e8\u7c7b\u548c\u533f\u540d\u7c7b\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p>\u975e\u9759\u6001\u5185\u90e8\u7c7b\u548c\u533f\u540d\u7c7b\u4f1a\u9690\u5f0f\u5730\u6301\u6709\u5bf9\u5916\u90e8\u7c7b\u5b9e\u4f8b\u7684\u5f15\u7528\uff0c\u5982\u679c\u5916\u90e8\u7c7b\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u671f\u6bd4\u5185\u90e8\u7c7b\u5b9e\u4f8b\u957f\uff0c\u90a3\u4e48\u5185\u90e8\u7c7b\u5b9e\u4f8b\u5c31\u4f1a\u4e00\u76f4\u6301\u6709\u5bf9\u5916\u90e8\u7c7b\u5b9e\u4f8b\u7684\u5f15\u7528\uff0c\u5bfc\u81f4\u5916\u90e8\u7c7b\u5b9e\u4f8b\u65e0\u6cd5\u88ab\u5783\u573e\u56de\u6536\uff0c\u4ece\u800c\u5f15\u53d1\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u907f\u514d\u9690\u5f0f\u5f15\u7528\u5916\u90e8\u7c7b\u5b9e\u4f8b\u3002</p> </li> <li> <p>\u5982\u679c\u5fc5\u987b\u4f7f\u7528\u975e\u9759\u6001\u5185\u90e8\u7c7b\u6216\u533f\u540d\u7c7b\uff0c\u786e\u4fdd\u5728\u4e0d\u518d\u9700\u8981\u65f6\u663e\u5f0f\u5730\u5c06\u5176\u5f15\u7528\u8bbe\u7f6e\u4e3a<code>null</code>\u3002</p> </li> </ul> </li> <li> <p>\u4f7f\u7528<code>ThreadLocal</code>\u65f6\u6ca1\u6709\u53ca\u65f6\u6e05\u7406</p> <p>ThreadLocal\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p><code>ThreadLocal</code>\u7528\u4e8e\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u63d0\u4f9b\u72ec\u7acb\u7684\u53d8\u91cf\u526f\u672c\uff0c\u907f\u514d\u4e86\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u5171\u4eab\u53d8\u91cf\u95ee\u9898\u3002\u4e00\u822c\u624b\u52a8\u521b\u5efa\u7684\u7ebf\u7a0b\u4f1a\u5728\u7ebf\u7a0b\u7ed3\u675f\u65f6\u81ea\u52a8\u6e05\u7406<code>ThreadLocal</code>\u53d8\u91cf\uff0c\u4f46\u662f\u5982\u679c\u4f7f\u7528\u7ebf\u7a0b\u6c60\uff0c\u7ebf\u7a0b\u4e0d\u4f1a\u7ed3\u675f\uff0c<code>ThreadLocal</code>\u53d8\u91cf\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u5728\u4e0d\u518d\u9700\u8981<code>ThreadLocal</code>\u53d8\u91cf\u65f6\uff0c\u8c03\u7528<code>remove()</code>\u65b9\u6cd5\u6e05\u7406\u53d8\u91cf\u3002</p> </li> <li> <p>\u907f\u514d\u5728\u957f\u751f\u547d\u5468\u671f\u7684\u7ebf\u7a0b\u4e2d\u4f7f\u7528<code>ThreadLocal</code>\uff0c\u4f8b\u5982\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u3002</p> </li> </ul> </li> <li> <p>\u4f7f\u7528<code>String</code>\u7684<code>intern</code>\u65b9\u6cd5\u5bfc\u81f4\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5185\u5b58\u6ea2\u51fa</p> <p>String.intern\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p><code>String.intern()</code>\u65b9\u6cd5\u4f1a\u5c06\u5b57\u7b26\u4e32\u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u5982\u679c\u9891\u7e41\u8c03\u7528<code>intern()</code>\u65b9\u6cd5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5185\u5b58\u6ea2\u51fa\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u907f\u514d\u9891\u7e41\u8c03\u7528<code>String.intern()</code>\u65b9\u6cd5\u3002</p> </li> <li> <p>\u4f7f\u7528<code>StringBuilder</code>\u6216<code>StringBuffer</code>\u6765\u6784\u5efa\u5b57\u7b26\u4e32\uff0c\u907f\u514d\u521b\u5efa\u8fc7\u591a\u7684\u4e34\u65f6\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002</p> </li> </ul> </li> <li> <p>\u901a\u8fc7\u9759\u6001\u5b57\u6bb5\u5f15\u7528\u5bf9\u8c61</p> <p>\u9759\u6001\u5b57\u6bb5\u5f15\u7528\u5bf9\u8c61\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p>\u9759\u6001\u5b57\u6bb5\u7684\u751f\u547d\u5468\u671f\u4e0e\u7c7b\u7684\u751f\u547d\u5468\u671f\u76f8\u540c\uff0c\u5982\u679c\u9759\u6001\u5b57\u6bb5\u5f15\u7528\u4e86\u5927\u91cf\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u5c06\u65e0\u6cd5\u88ab\u5783\u573e\u56de\u6536\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u907f\u514d\u4f7f\u7528\u9759\u6001\u5b57\u6bb5\u5f15\u7528\u5927\u91cf\u5bf9\u8c61\uff0c\u5728\u4e0d\u518d\u9700\u8981\u65f6\uff0c\u5c06\u9759\u6001\u5b57\u6bb5\u5f15\u7528\u8bbe\u7f6e\u4e3a<code>null</code>\u3002</p> </li> <li> <p>\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528\u61d2\u6c49\u5f0f\u52a0\u8f7d\uff0c\u907f\u514d\u5728\u7c7b\u52a0\u8f7d\u65f6\u521b\u5efa\u5927\u91cf\u5bf9\u8c61\u3002</p> </li> <li> <p>Spring\u7b49\u6846\u67b6\u4e2d\uff0c\u4f7f\u7528<code>@Scope(\"prototype\")</code>\u6ce8\u89e3\u6765\u5b9a\u4e49\u539f\u578b\u4f5c\u7528\u57df\u7684Bean\uff0c\u907f\u514d\u5355\u4f8bBean\u6301\u6709\u5927\u91cf\u5bf9\u8c61\u3002</p> </li> </ul> </li> <li> <p>\u8d44\u6e90\u6ca1\u6709\u53ca\u65f6\u5173\u95ed</p> <p>\u8d44\u6e90\u6ca1\u6709\u53ca\u65f6\u5173\u95ed\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</p> <p>\u5728Java\u4e2d\uff0c\u6587\u4ef6\u3001\u6570\u636e\u5e93\u8fde\u63a5\u3001\u7f51\u7edc\u8fde\u63a5\u7b49\u8d44\u6e90\u9700\u8981\u624b\u52a8\u5173\u95ed\uff0c\u5982\u679c\u6ca1\u6709\u53ca\u65f6\u5173\u95ed\u8fd9\u4e9b\u8d44\u6e90\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u4f7f\u7528<code>try-with-resources</code>\u8bed\u53e5\u6765\u81ea\u52a8\u5173\u95ed\u8d44\u6e90\u3002</p> </li> <li> <p>\u5728<code>finally</code>\u5757\u4e2d\u663e\u5f0f\u5730\u5173\u95ed\u8d44\u6e90\uff0c\u786e\u4fdd\u65e0\u8bba\u662f\u5426\u53d1\u751f\u5f02\u5e38\uff0c\u8d44\u6e90\u90fd\u80fd\u88ab\u5173\u95ed\u3002</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-practice/#\u5e76\u53d1\u8bf7\u6c42\u95ee\u9898","title":"\u5e76\u53d1\u8bf7\u6c42\u95ee\u9898","text":"<p>\u5e76\u53d1\u8bf7\u6c42\u95ee\u9898\u6307\u7684\u662f\u7528\u6237\u901a\u8fc7\u53d1\u9001\u8bf7\u6c42\u5411Java\u5e94\u7528\u83b7\u53d6\u6570\u636e\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0bJava\u5e94\u7528\u5c06\u6570\u636e\u8fd4\u56de\u4e4b\u540e\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u5c31\u53ef\u4ee5\u5728\u5185\u5b58\u4e2d\u88ab\u91ca\u653e\u6389\u3002</p> <p>\u4f46\u662f\u7531\u4e8e\u7528\u6237\u7684\u5e76\u53d1\u8bf7\u6c42\u91cf\u6709\u53ef\u80fd\u5f88\u5927\uff0c\u540c\u65f6\u5904\u7406\u6570\u636e\u7684\u65f6\u95f4\u5f88\u957f\uff0c\u5bfc\u81f4\u5927\u91cf\u7684\u6570\u636e\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\uff0c\u6700\u7ec8\u8d85\u8fc7\u4e86\u5185\u5b58\u7684\u4e0a\u9650\uff0c\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002\u8fd9\u7c7b\u95ee\u9898\u7684\u5904\u7406\u601d\u8def\u548c\u5185\u5b58\u6cc4\u6f0f\u7c7b\u4f3c\uff0c\u9996\u5148\u8981\u5b9a\u4f4d\u5230\u5bf9\u8c61\u4ea7\u751f\u7684\u6839\u6e90\u3002</p>"},{"location":"JVM/JVM-practice/#\u6a21\u62df\u5e76\u53d1\u8bf7\u6c42","title":"\u6a21\u62df\u5e76\u53d1\u8bf7\u6c42","text":"<p>\u4f7f\u7528Apache JMeter - Apache JMeter\u2122\u8f6f\u4ef6\u53ef\u4ee5\u8fdb\u884c\u5e76\u53d1\u8bf7\u6c42\u6d4b\u8bd5\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b89\u88c5Jmeter\u8f6f\u4ef6\uff0c\u6dfb\u52a0\u7ebf\u7a0b\u7ec4\u3002</p> </li> <li> <p>\u5728\u7ebf\u7a0b\u7ec4\u4e2d\u589e\u52a0Http\u8bf7\u6c42\uff0c\u6dfb\u52a0\u968f\u673a\u53c2\u6570\u3002</p> </li> <li> <p>\u5728\u7ebf\u7a0b\u7ec4\u4e2d\u6dfb\u52a0\u76d1\u542c\u5668\u2013\u805a\u5408\u62a5\u544a\uff0c\u7528\u6765\u5c55\u793a\u6700\u7ec8\u7ed3\u679c\u3002</p> </li> <li> <p>\u542f\u52a8\u7a0b\u5e8f\uff0c\u8fd0\u884c\u7ebf\u7a0b\u7ec4\u5e76\u89c2\u5bdf\u7a0b\u5e8f\u662f\u5426\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u8bca\u65ad\u95ee\u9898","title":"\u8bca\u65ad\u95ee\u9898","text":""},{"location":"JVM/JVM-practice/#\u5185\u5b58\u5feb\u7167","title":"\u5185\u5b58\u5feb\u7167","text":"<ul> <li> <p>\u5f53\u5806\u5185\u5b58\u6ea2\u51fa\u65f6\uff0c\u9700\u8981\u5728\u5806\u5185\u5b58\u6ea2\u51fa\u65f6\u5c06\u6574\u4e2a\u5806\u5185\u5b58\u4fdd\u5b58\u4e0b\u6765\uff0c\u751f\u6210\u5185\u5b58\u5feb\u7167(Heap Profile)\u6587\u4ef6\u3002</p> </li> <li> <p>\u751f\u6210\u5185\u5b58\u5feb\u7167\u7684Java\u865a\u62df\u673a\u53c2\u6570\uff1a</p> </li> </ul> <pre><code>#\u53d1\u751fOutOfMemoryError\u9519\u8bef\u65f6\uff0c\u81ea\u52a8\u751f\u6210hprof\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002\n-XX:+HeapDumpOnOutOfMemoryError\n\n#\u6307\u5b9ahprof\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\u3002\n-XX:HeapDumpPath=&lt;path&gt;\n</code></pre> <ul> <li>\u4f7f\u7528MAT\u6253\u5f00hprof\u6587\u4ef6\uff0c\u5e76\u9009\u62e9\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u529f\u80fd\uff0cMAT\u4f1a\u81ea\u884c\u6839\u636e\u5185\u5b58\u5feb\u7167\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u5206\u6790\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\u3002</li> </ul> <p>\u6848\u4f8b</p> <p>\u67d0\u56e2\u961f\u901a\u8fc7\u76d1\u63a7\u7cfb\u7edf\u53d1\u73b0\u6709\u4e00\u4e2a\u670d\u52a1\u5185\u5b58\u5728\u6301\u7eed\u589e\u957f\uff0c\u5e0c\u671b\u5c3d\u5feb\u901a\u8fc7\u5185\u5b58\u5feb\u7167\u5206\u6790\u589e\u957f\u7684\u539f\u56e0\uff0c\u7531\u4e8e\u5e76\u672a\u4ea7\u751f\u5185\u5b58\u6ea2\u51fa\u6240\u4ee5\u4e0d\u80fd\u901a\u8fc7HeapDumpOnOutOfMemoryError\u53c2\u6570\u751f\u6210\u5185\u5b58\u5feb\u7167\u3002</p> <p>\u601d\u8def\uff1a</p> <p>\u5bfc\u51fa\u8fd0\u884c\u4e2d\u7cfb\u7edf\u7684\u5185\u5b58\u5feb\u7167\uff0c\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c\u6ce8\u610f\u53ea\u9700\u8981\u5bfc\u51fa\u6807\u8bb0\u4e3a\u5b58\u6d3b\u7684\u5bf9\u8c61\uff1a</p> <ol> <li>\u901a\u8fc7JDK\u81ea\u5e26\u7684jmap\u547d\u4ee4\u5bfc\u51fa\uff0c\u683c\u5f0f\u4e3a\uff1a</li> </ol> <pre><code>jmap -dump:live,format=b,file=\u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d \u8fdb\u7a0bID\n</code></pre> <ol> <li>\u901a\u8fc7arthas\u7684heapdump\u547d\u4ee4\u5bfc\u51fa\uff0c\u683c\u5f0f\u4e3a\uff1a</li> </ol> <pre><code>heapdump --live \u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d\n</code></pre> <p>\u5206\u6790\u8d85\u5927\u5806\u7684\u5185\u5b58\u5feb\u7167</p> <ul> <li> <p>\u5728\u7a0b\u5e8f\u5458\u5f00\u53d1\u7528\u7684\u673a\u5668\u5185\u5b58\u8303\u56f4\u4e4b\u5185\u7684\u5feb\u7167\u6587\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528MAT\u6253\u5f00\u5206\u6790\u5373\u53ef\u3002\u4f46\u662f\u7ecf\u5e38\u4f1a\u9047\u5230\u670d\u52a1\u5668\u4e0a\u7684\u7a0b\u5e8f\u5360\u7528\u7684\u5185\u5b58\u8fbe\u523010G\u4ee5\u4e0a\uff0c\u5f00\u53d1\u673a\u65e0\u6cd5\u6b63\u5e38\u6253\u5f00\u6b64\u7c7b\u5185\u5b58\u5feb\u7167\uff0c\u6b64\u65f6\u9700\u8981\u4e0b\u8f7d\u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5e94\u7684MAT\u3002\u4e0b\u8f7d\u5730\u5740\uff1a https://eclipse.dev/mat/downloads.php</p> </li> <li> <p>\u901a\u8fc7MAT\u4e2d\u7684\u811a\u672c\u751f\u6210\u5206\u6790\u62a5\u544a\uff1a</p> </li> </ul> <pre><code>./ParseHeapDump.sh \u5feb\u7167\u6587\u4ef6\u8def\u5f84 org.eclipse.mat.api:suspects\n org.eclipse.mat.api:overview org.eclipse.mat.api:top_components\n</code></pre> <p>\u6ce8\u610f</p> <p>\u9ed8\u8ba4MAT\u5206\u6790\u65f6\u53ea\u4f7f\u7528\u4e861G\u7684\u5806\u5185\u5b58\uff0c\u5982\u679c\u5feb\u7167\u6587\u4ef6\u8d85\u8fc71G\uff0c\u9700\u8981\u4fee\u6539MAT\u76ee\u5f55\u4e0b\u7684MemoryAnalyzer.ini\u914d\u7f6e\u6587\u4ef6\u8c03\u6574\u6700\u5927\u5806\u5185\u5b58\u3002</p>"},{"location":"JVM/JVM-practice/#\u4fee\u590d\u95ee\u9898","title":"\u4fee\u590d\u95ee\u9898","text":"<p>\u5177\u4f53\u95ee\u9898\u5177\u4f53\u5206\u6790\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff0c\u91c7\u53d6\u76f8\u5e94\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <ol> <li> <p>\u4ee3\u7801\u89c4\u8303\u95ee\u9898\uff08\u5df2\u5728\u4e0a\u4e00\u5c0f\u8282\u63d0\u4f9b\u6848\u4f8b\u53ca\u65b9\u6848\uff09</p> </li> <li> <p>\u5e76\u53d1\u8bf7\u6c42\u95ee\u9898\u2014\u2014\u53c2\u6570\u8bbe\u7f6e\u4e0d\u5f53</p> <ul> <li>\u5982\u5806\u5185\u5b58\u8bbe\u7f6e\u8fc7\u5c0f\uff0c\u5e94\u9002\u5f53\u589e\u52a0\u5806\u5185\u5b58\u5927\u5c0f\u3002</li> </ul> </li> <li> <p>\u5e76\u53d1\u8bf7\u6c42\u95ee\u9898\u2014\u2014\u8bbe\u8ba1\u4e0d\u5f53</p> <ul> <li> <p>\u4e00\u6b21\u6027\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u5927\u91cf\u6570\u636e</p> </li> <li> <p>\u6ca1\u6709\u6839\u636e\u670d\u52a1\u5668\u6027\u80fd\u8fdb\u884c\u9650\u6d41</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b\u4e00\u5206\u9875\u67e5\u8be2\u6587\u7ae0\u63a5\u53e3\u7684\u5185\u5b58\u6ea2\u51fa","title":"\u6848\u4f8b\u4e00\uff1a\u5206\u9875\u67e5\u8be2\u6587\u7ae0\u63a5\u53e3\u7684\u5185\u5b58\u6ea2\u51fa","text":"<p>\u80cc\u666f\uff1a\u67d0\u4e2a\u65b0\u95fb\u8d44\u8baf\u7c7b\u9879\u76ee\u91c7\u7528\u4e86\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u6587\u7ae0\u5fae\u670d\u52a1\uff0c\u8fd9\u4e2a\u5fae\u670d\u52a1\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u51fa\u73b0\u4e86\u5185\u5b58\u6ea2\u51fa\u7684\u73b0\u8c61\u3002</p> <p></p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <ol> <li> <p>\u670d\u52a1\u51fa\u73b0OOM\u5185\u5b58\u6ea2\u51fa\u65f6\uff0c\u751f\u6210\u5185\u5b58\u5feb\u7167\u3002</p> </li> <li> <p>\u4f7f\u7528MAT\u5206\u6790\u5185\u5b58\u5feb\u7167\uff0c\u627e\u5230\u5185\u5b58\u6ea2\u51fa\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5c1d\u8bd5\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u91cd\u73b0\u95ee\u9898\uff0c\u5206\u6790\u4ee3\u7801\u4e2d\u95ee\u9898\u4ea7\u751f\u7684\u539f\u56e0\u3002</p> </li> <li> <p>\u4fee\u6539\u4ee3\u7801\u3002</p> </li> <li> <p>\u6d4b\u8bd5\u5e76\u9a8c\u8bc1\u7ed3\u679c\u3002</p> </li> </ol> <p>\u95ee\u9898\u6839\u6e90\uff1a</p> <p>\u6587\u7ae0\u5fae\u670d\u52a1\u4e2d\u7684\u5206\u9875\u63a5\u53e3\u6ca1\u6709\u9650\u5236\u6700\u5927\u5355\u6b21\u8bbf\u95ee\u6761\u6570\uff0c\u5e76\u4e14\u5355\u4e2a\u6587\u7ae0\u5bf9\u8c61\u5360\u7528\u7684\u5185\u5b58\u91cf\u8f83\u5927\uff0c\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u5e76\u53d1\u91cf\u8f83\u5927\u65f6\u8fd9\u90e8\u5206\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u5230\u5185\u5b58\u4e4b\u540e\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u53ef\u884c\u65b9\u6848\uff1a</p> <ul> <li> <p>\u4e0e\u4ea7\u54c1\u8bbe\u8ba1\u4eba\u5458\u6c9f\u901a\uff0c\u9650\u5236\u6700\u5927\u7684\u5355\u6b21\u8bbf\u95ee\u6761\u6570\u3002</p> </li> <li> <p>\u5206\u9875\u63a5\u53e3\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u5c55\u793a\u6587\u7ae0\u5217\u8868\uff0c\u4e0d\u9700\u8981\u83b7\u53d6\u6587\u7ae0\u5185\u5bb9\uff0c\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u5bf9\u8c61\u7684\u5927\u5c0f\u3002</p> </li> <li> <p>\u5728\u9ad8\u5cf0\u671f\u5bf9\u5fae\u670d\u52a1\u8fdb\u884c\u9650\u6d41\u4fdd\u62a4\u3002</p> </li> </ul>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b\u4e8cmybatis\u5bfc\u81f4\u7684\u5185\u5b58\u6ea2\u51fa","title":"\u6848\u4f8b\u4e8c\uff1aMybatis\u5bfc\u81f4\u7684\u5185\u5b58\u6ea2\u51fa","text":"<p>\u80cc\u666f\uff1a\u6587\u7ae0\u5fae\u670d\u52a1\u8fdb\u884c\u4e86\u5347\u7ea7\uff0c\u65b0\u589e\u52a0\u4e86\u4e00\u4e2a\u5224\u65adid\u662f\u5426\u5b58\u5728\u7684\u63a5\u53e3\uff0c\u7b2c\u4e8c\u5929\u4e1a\u52a1\u9ad8\u5cf0\u671f\u518d\u6b21\u51fa\u73b0\u4e86\u5185\u5b58\u6ea2\u51fa\uff0c\u5224\u65ad\u5e94\u8be5\u548c\u65b0\u589e\u52a0\u7684\u63a5\u53e3\u6709\u5173\u7cfb\u3002</p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <ol> <li> <p>\u670d\u52a1\u51fa\u73b0OOM\u5185\u5b58\u6ea2\u51fa\u65f6\uff0c\u751f\u6210\u5185\u5b58\u5feb\u7167\u3002</p> </li> <li> <p>\u4f7f\u7528MAT\u5206\u6790\u5185\u5b58\u5feb\u7167\uff0c\u627e\u5230\u5185\u5b58\u6ea2\u51fa\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5c1d\u8bd5\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u91cd\u73b0\u95ee\u9898\uff0c\u5206\u6790\u4ee3\u7801\u4e2d\u95ee\u9898\u4ea7\u751f\u7684\u539f\u56e0\u3002</p> </li> <li> <p>\u4fee\u6539\u4ee3\u7801\u3002</p> </li> <li> <p>\u6d4b\u8bd5\u5e76\u9a8c\u8bc1\u7ed3\u679c\u3002</p> </li> </ol> <p>\u95ee\u9898\u6839\u6e90\uff1a</p> <p>Mybatis\u5728\u4f7f\u7528foreach\u8fdb\u884csql\u62fc\u63a5\u65f6\uff0c\u4f1a\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u5bf9\u8c61\uff0c\u5982\u679cforeach\u5904\u7406\u7684\u6570\u7ec4\u6216\u8005\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u8fc7\u591a\uff0c\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u53ef\u884c\u65b9\u6848\uff1a</p> <ul> <li> <p>\u9650\u5236\u53c2\u6570\u4e2d\u6700\u5927\u7684id\u4e2a\u6570\u3002</p> </li> <li> <p>\u5c06id\u7f13\u5b58\u5230redis\u6216\u8005\u5185\u5b58\u7f13\u5b58\u4e2d\uff0c\u901a\u8fc7\u7f13\u5b58\u8fdb\u884c\u6821\u9a8c\u3002</p> </li> </ul>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b\u4e09\u5bfc\u51fa\u5927\u6587\u4ef6\u5185\u5b58\u6ea2\u51fa","title":"\u6848\u4f8b\u4e09\uff1a\u5bfc\u51fa\u5927\u6587\u4ef6\u5185\u5b58\u6ea2\u51fa","text":"<p>\u80cc\u666f\uff1a\u67d0\u4e2a\u7ba1\u7406\u7cfb\u7edf\u652f\u6301\u51e0\u5341\u4e07\u6761\u6570\u636e\u7684excel\u6587\u4ef6\u5bfc\u51fa\u3002\u4f46\u6d4b\u8bd5\u53d1\u73b0\u7cfb\u7edf\u5728\u8fd0\u884c\u65f6\u5982\u679c\u6709\u51e0\u5341\u4e2a\u4eba\u540c\u65f6\u8fdb\u884c\u5927\u6570\u636e\u91cf\u7684\u5bfc\u51fa\uff0c\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u3002</p> <p>\u8be5\u56e2\u961f\u4f7f\u7528\u7684\u662fk8s\u5c06\u7ba1\u7406\u7cfb\u7edf\u90e8\u7f72\u5230\u4e86\u5bb9\u5668\u4e2d\uff0c\u6240\u4ee5\u4f7f\u7528\u963f\u91cc\u4e91\u7684k8s\u73af\u5883\u8fd8\u539f\u573a\u666f\uff0c\u5e76\u89e3\u51b3\u95ee\u9898\u3002\u963f\u91cc\u4e91\u7684k8s\u6574\u4f53\u89c4\u5212\u5982\u4e0b\uff1a</p> <p></p> <p>\u95ee\u9898\u6839\u6e90\uff1a</p> <p>Excel\u6587\u4ef6\u5bfc\u51fa\u5982\u679c\u4f7f\u7528POI\u7684XSSFWorkbook\uff0c\u5728\u5927\u6570\u636e\u91cf\uff08\u51e0\u5341\u4e07\uff09\u7684\u60c5\u51b5\u4e0b\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u3002</p> <p>\u53ef\u884c\u65b9\u6848:</p> <ul> <li> <p>\u4f7f\u7528poi\u7684SXSSFWorkbook\u3002</p> </li> <li> <p><code>hutool</code>\u63d0\u4f9b\u7684BigExcelWriter\u51cf\u5c11\u5185\u5b58\u5f00\u9500\u3002\uff08\u670d\u52a1\u5668\u5927\u5185\u5b58\u63a8\u8350\uff09</p> </li> <li> <p>\u4f7f\u7528<code>easy excel</code>\uff0c\u5bf9\u5185\u5b58\u8fdb\u884c\u4e86\u5927\u91cf\u7684\u4f18\u5316\u3002\uff08\u670d\u52a1\u5668\u5c0f\u5185\u5b58\u63a8\u8350\uff0c\u5360\u7528\u5185\u5b58\u5c0f\uff0c\u8017\u65f6\u957f\uff09</p> </li> </ul>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b\u56dbthreadlocal\u4f7f\u7528\u65f6\u5360\u7528\u5927\u91cf\u5185\u5b58","title":"\u6848\u4f8b\u56db\uff1aThreadLocal\u4f7f\u7528\u65f6\u5360\u7528\u5927\u91cf\u5185\u5b58","text":"<p>\u80cc\u666f\uff1a\u67d0\u4e2a\u5fae\u670d\u52a1\u7cfb\u7edf\u5728\u6ca1\u6709\u4efb\u4f55\u7528\u6237\u4f7f\u7528\u65f6\uff0c\u4e5f\u5360\u7528\u4e86\u5927\u91cf\u7684\u5185\u5b58\u3002\u5bfc\u81f4\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u5927\u5927\u51cf\u5c11\u3002</p> <p>\u95ee\u9898\u6839\u6e90\uff1a</p> <p>\u5f88\u591a\u5fae\u670d\u52a1\u4f1a\u9009\u62e9\u5728\u62e6\u622a\u5668<code>preHandle</code>\u65b9\u6cd5\u4e2d\u53bb\u89e3\u6790\u8bf7\u6c42\u5934\u4e2d\u7684\u6570\u636e\uff0c\u5e76\u653e\u5165\u4e00\u4e9b\u6570\u636e\u5230<code>ThreadLocal</code>\u4e2d\u65b9\u4fbf\u540e\u7eed\u4f7f\u7528\u3002</p> <p>\u53ef\u884c\u65b9\u6848\uff1a</p> <p>\u5728\u62e6\u622a\u5668\u7684<code>afterCompletion</code>\u65b9\u6cd5\u4e2d\uff0c\u5fc5\u987b\u8981\u5c06<code>ThreadLocal</code>\u4e2d\u7684\u6570\u636e\u6e05\u7406\u6389\u3002</p>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b\u4e94\u6587\u7ae0\u5185\u5bb9\u5ba1\u6838\u63a5\u53e3\u7684\u5185\u5b58\u95ee\u9898","title":"\u6848\u4f8b\u4e94\uff1a\u6587\u7ae0\u5185\u5bb9\u5ba1\u6838\u63a5\u53e3\u7684\u5185\u5b58\u95ee\u9898","text":"<p>\u80cc\u666f\uff1a\u6587\u7ae0\u5fae\u670d\u52a1\u4e2d\u63d0\u4f9b\u4e86\u6587\u7ae0\u5ba1\u6838\u63a5\u53e3\uff0c\u4f1a\u8c03\u7528\u963f\u91cc\u4e91\u7684\u5185\u5bb9\u5b89\u5168\u63a5\u53e3\u8fdb\u884c\u6587\u7ae0\u4e2d\u6587\u5b57\u548c\u56fe\u7247\u7684\u5ba1\u6838\uff0c\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u5185\u5b58\u5360\u7528\u8f83\u5927\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u53ef\u884c\u65b9\u6848\uff1a</p> <p>\u65b9\u6848\u4e00\uff1a\u4f7f\u7528SpringBoot\u4e2d\u7684@Async\u6ce8\u89e3\u8fdb\u884c\u5f02\u6b65\u7684\u5ba1\u6838\u3002</p> <p></p> <p>\u5b58\u5728\u95ee\u9898\uff1a</p> <ol> <li> <p>\u7ebf\u7a0b\u6c60\u53c2\u6570\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u4f1a\u5bfc\u81f4\u5927\u91cf\u7ebf\u7a0b\u7684\u521b\u5efa\u6216\u8005\u961f\u5217\u4e2d\u4fdd\u5b58\u5927\u91cf\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u4efb\u52a1\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u4e00\u65e6\u8d70\u7ebf\u7a0b\u6c60\u7684\u62d2\u7edd\u7b56\u7565\u6216\u8005\u670d\u52a1\u5b95\u673a\u3001\u670d\u52a1\u5668\u6389\u7535\u7b49\u60c5\u51b5\u5f88\u6709\u53ef\u80fd\u4f1a\u4e22\u5931\u4efb\u52a1\u3002</p> </li> </ol> <p></p> <p>\u65b9\u6848\u4e8c\uff1a\u4f7f\u7528\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u6a21\u5f0f\u8fdb\u884c\u5904\u7406\uff0c\u961f\u5217\u6570\u636e\u53ef\u4ee5\u5b9e\u73b0\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\u3002</p> <p></p> <p>\u5b58\u5728\u95ee\u9898\uff1a</p> <ol> <li> <p>\u961f\u5217\u53c2\u6570\u8bbe\u7f6e\u4e0d\u6b63\u786e\uff0c\u4f1a\u4fdd\u5b58\u5927\u91cf\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u6301\u4e45\u5316\u7684\u673a\u5236\uff0c\u5426\u5219\u6570\u636e\u4f1a\u4e22\u5931\u3002</p> </li> </ol> <p></p> <p>\u65b9\u6848\u4e09\uff1a\u4f7f\u7528<code>mq</code>\u6d88\u606f\u961f\u5217\u8fdb\u884c\u5904\u7406\uff0c\u7531<code>mq</code>\u6765\u4fdd\u5b58\u6587\u7ae0\u7684\u6570\u636e\u3002\u53d1\u9001\u6d88\u606f\u7684\u670d\u52a1\u548c\u62c9\u53d6\u6d88\u606f\u7684\u670d\u52a1\u53ef\u4ee5\u662f\u540c\u4e00\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u662f\u540c\u4e00\u4e2a\u3002\uff08\u63a8\u8350\uff09</p> <p></p> <p>\u95ee\u9898\u6839\u6e90\uff1a</p> <p>\u5728\u9879\u76ee\u4e2d\u5982\u679c\u8981\u4f7f\u7528\u5f02\u6b65\u8fdb\u884c\u4e1a\u52a1\u5904\u7406\uff0c\u6216\u8005\u5b9e\u73b0\u751f\u4ea7\u8005\u2013\u6d88\u8d39\u8005\u7684\u6a21\u578b\uff0c\u5982\u679c\u5728Java\u4ee3\u7801\u4e2d\u5b9e\u73b0\uff0c\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u53bb\u4fdd\u5b58\u4e2d\u95f4\u6570\u636e\u3002</p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <p>\u5c3d\u91cf\u4f7f\u7528Mq\u6d88\u606f\u961f\u5217\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u5c06\u4e2d\u95f4\u6570\u636e\u5355\u72ec\u8fdb\u884c\u4fdd\u5b58\uff0c\u4e0d\u4f1a\u5360\u7528Java\u7684\u5185\u5b58\u3002\u540c\u65f6\u4e5f\u53ef\u4ee5\u5c06\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u62c6\u5206\u6210\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u3002</p>"},{"location":"JVM/JVM-practice/#gc\u8c03\u4f18","title":"GC\u8c03\u4f18","text":"<p>GC\u8c03\u4f18\u6307\u7684\u662f\u5bf9\u5783\u573e\u56de\u6536\uff08Garbage Collection\uff09\u8fdb\u884c\u8c03\u4f18\u3002GC\u8c03\u4f18\u7684\u4e3b\u8981\u76ee\u6807\u662f\u907f\u514d\u7531\u5783\u573e\u56de\u6536\u5f15\u8d77\u7a0b\u5e8f\u6027\u80fd\u4e0b\u964d\u3002</p> <p>GC\u8c03\u4f18\u7684\u6838\u5fc3\u5206\u6210\u4e09\u90e8\u5206\uff1a</p> <p>\u2713 1\u3001\u901a\u7528JVM\u53c2\u6570\u7684\u8bbe\u7f6e\u3002</p> <p>\u2713 2\u3001\u7279\u5b9a\u5783\u573e\u56de\u6536\u5668\u7684JVM\u53c2\u6570\u7684\u8bbe\u7f6e\u3002</p> <p>\u2713 3\u3001\u89e3\u51b3\u7531\u9891\u7e41\u7684full GC\u5f15\u8d77\u7684\u7a0b\u5e8f\u6027\u80fd\u95ee\u9898\u3002</p> <p></p>"},{"location":"JVM/JVM-practice/#gc\u8c03\u4f18\u6307\u6807","title":"GC\u8c03\u4f18\u6307\u6807","text":"<p>\u5224\u65adGC\u662f\u5426\u9700\u8981\u8c03\u4f18\uff0c\u9700\u8981\u4ece\u4e09\u65b9\u9762\u6765\u8003\u8651\uff0c\u4e0eGC\u7b97\u6cd5\u7684\u8bc4\u5224\u6807\u51c6\u7c7b\u4f3c\uff1a</p> <ol> <li> <p>\u541e\u5410\u91cf(Throughput) \u541e\u5410\u91cf\u5206\u4e3a\u4e1a\u52a1\u541e\u5410\u91cf\u548c\u5783\u573e\u56de\u6536\u541e\u5410\u91cf\u4e1a\u52a1\u541e\u5410\u91cf\u6307\u7684\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u7a0b\u5e8f\u9700\u8981\u5b8c\u6210\u7684\u4e1a\u52a1\u6570\u91cf\u3002</p> <p>\u6bd4\u5982\u4f01\u4e1a\u4e2d\u5bf9\u4e8e\u541e\u5410\u91cf\u7684\u8981\u6c42\u53ef\u80fd\u4f1a\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li> <p>\u652f\u6301\u7528\u6237\u6bcf\u5929\u751f\u621010000\u7b14\u8ba2\u5355</p> </li> <li> <p>\u5728\u665a\u4e0a8\u70b9\u523010\u70b9\uff0c\u652f\u6301\u7528\u6237\u67e5\u8be250000\u6761\u5546\u54c1\u4fe1\u606f</p> </li> </ul> <p>\u4fdd\u8bc1\u9ad8\u541e\u5410\u91cf\u7684\u5e38\u89c4\u624b\u6bb5\u6709\u4e24\u6761\uff1a</p> <ul> <li> <p>\u4f18\u5316\u4e1a\u52a1\u6267\u884c\u6027\u80fd\uff0c\u51cf\u5c11\u5355\u6b21\u4e1a\u52a1\u7684\u6267\u884c\u65f6\u95f4</p> </li> <li> <p>\u4f18\u5316\u5783\u573e\u56de\u6536\u541e\u5410\u91cf</p> </li> </ul> </li> <li> <p>\u5ef6\u8fdf\u6307\u7684\u662f\u4ece\u7528\u6237\u53d1\u8d77\u4e00\u4e2a\u8bf7\u6c42\u5230\u6536\u5230\u54cd\u5e94\u8fd9\u5176\u4e2d\u7ecf\u5386\u7684\u65f6\u95f4\u3002</p> <p>\u6bd4\u5982\u4f01\u4e1a\u4e2d\u5bf9\u4e8e\u5ef6\u8fdf\u7684\u8981\u6c42\u53ef\u80fd\u4f1a\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u6240\u6709\u7684\u8bf7\u6c42\u5fc5\u987b\u57285\u79d2\u5185\u8fd4\u56de\u7ed9\u7528\u6237     \u7ed3\u679c\u5ef6\u8fdf = GC\u5ef6\u8fdf+ \u4e1a\u52a1\u6267\u884c\u65f6\u95f4\uff0c\u6240\u4ee5\u5982\u679cGC\u65f6\u95f4\u8fc7\u957f\uff0c\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u7684\u4f7f\u7528\u3002</li> </ul> </li> <li> <p>\u5185\u5b58\u4f7f\u7528\u91cf\u6307\u7684\u662fJava\u5e94\u7528\u5360\u7528\u7cfb\u7edf\u5185\u5b58\u7684\u6700\u5927\u503c\uff0c\u4e00\u822c\u901a\u8fc7JVM\u53c2\u6570\u8c03\u6574\uff0c\u5728\u6ee1\u8db3\u4e0a\u8ff0\u4e24\u4e2a\u6307\u6807\u7684\u524d\u63d0\u4e0b\uff0c\u8fd9\u4e2a\u503c\u8d8a\u5c0f\u8d8a\u597d\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u53d1\u73b0\u95ee\u9898_1","title":"\u53d1\u73b0\u95ee\u9898","text":""},{"location":"JVM/JVM-practice/#jstat\u5de5\u5177","title":"jstat\u5de5\u5177","text":"<ul> <li> <p>Jstat\u5de5\u5177\u662fJDK\u81ea\u5e26\u7684\u4e00\u6b3e\u76d1\u63a7\u5de5\u5177\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5404\u79cd\u5783\u573e\u56de\u6536\u3001\u7c7b\u52a0\u8f7d\u3001\u7f16\u8bd1\u4fe1\u606f\u7b49\u4e0d\u540c\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u4f7f\u7528\u65b9\u6cd5\u4e3a\uff1a<code>jstat -gc \u8fdb\u7a0bID</code> \u6bcf\u6b21\u7edf\u8ba1\u7684\u95f4\u9694\uff08\u6beb\u79d2\uff09\u7edf\u8ba1\u6b21\u6570</p> </li> </ul> <p>jstat -gc \u8f93\u51fa\u53c2\u6570\u8bf4\u660e</p> <ul> <li> <p>C\u4ee3\u8868Capacity\u5bb9\u91cf\uff0cU\u4ee3\u8868Used\u4f7f\u7528\u91cf</p> </li> <li> <p>S \u2013\u5e78\u5b58\u8005\u533a\uff0cE \u2013\u4f0a\u7538\u56ed\u533a\uff0cO \u2013\u8001\u5e74\u4ee3\uff0cM \u2013\u5143\u7a7a\u95f4</p> </li> <li> <p>YGC\u3001YGT\uff1a\u5e74\u8f7b\u4ee3GC\u6b21\u6570\u548cGC\u8017\u65f6\uff08\u5355\u4f4d\uff1a\u79d2\uff09</p> </li> <li> <p>FGC\u3001FGCT\uff1aFull GC\u6b21\u6570\u548cFull GC\u8017\u65f6</p> </li> <li> <p>GCT\uff1aGC\u603b\u8017\u65f6</p> </li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li> <p>\u64cd\u4f5c\u7b80\u5355</p> </li> <li> <p>\u65e0\u989d\u5916\u7684\u8f6f\u4ef6\u5b89\u88c5</p> </li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u65e0\u6cd5\u7cbe\u786e\u5230GC\u4ea7\u751f\u7684\u65f6\u95f4\uff0c\u53ea\u80fd\u7528\u4e8e\u5224\u65adGC\u662f\u5426\u5b58\u5728\u95ee\u9898</li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#visualvm\u63d2\u4ef6","title":"visualvm\u63d2\u4ef6","text":"<p>VisualVm\u4e2d\u63d0\u4f9b\u4e86\u4e00\u6b3eVisual GC\u63d2\u4ef6\uff0c\u5b9e\u65f6\u76d1\u63a7Java\u8fdb\u7a0b\u7684\u5806\u5185\u5b58\u7ed3\u6784\u3001\u5806\u5185\u5b58\u53d8\u5316\u8d8b\u52bf\u4ee5\u53ca\u5783\u573e\u56de\u6536\u65f6\u95f4\u7684\u53d8\u5316\u8d8b\u52bf\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u76d1\u63a7\u5bf9\u8c61\u664b\u5347\u7684\u76f4\u65b9\u56fe\u3002</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u9002\u5408\u5f00\u53d1\u4f7f\u7528\uff0c\u80fd\u76f4\u89c2\u7684\u770b\u5230\u5806\u5185\u5b58\u548cGC\u7684\u53d8\u5316\u8d8b\u52bf</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li> <p>\u5bf9\u7a0b\u5e8f\u8fd0\u884c\u6027\u80fd\u6709\u4e00\u5b9a\u5f71\u54cd</p> </li> <li> <p>\u751f\u4ea7\u73af\u5883\u7a0b\u5e8f\u5458\u4e00\u822c\u6ca1\u6709\u6743\u9650\u8fdb\u884c\u64cd\u4f5c</p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#prometheus--grafana","title":"Prometheus + Grafana","text":"<ul> <li> <p>Prometheus+Grafana\u662f\u4f01\u4e1a\u4e2d\u8fd0\u7ef4\u5e38\u7528\u7684\u76d1\u63a7\u65b9\u6848\uff0c\u5176\u4e2dPrometheus\u7528\u6765\u91c7\u96c6\u7cfb\u7edf\u6216\u8005\u5e94\u7528\u7684\u76f8\u5173\u6570\u636e\uff0c\u540c\u65f6\u5177\u5907\u544a\u8b66\u529f\u80fd\u3002Grafana\u53ef\u4ee5\u5c06Prometheus\u91c7\u96c6\u5230\u7684\u6570\u636e\u4ee5\u53ef\u89c6\u5316\u7684\u65b9\u5f0f\u8fdb\u884c\u5c55\u793a\u3002</p> </li> <li> <p>\u5f00\u53d1\u4eba\u5458\u8981\u5b66\u4f1a\u5982\u4f55\u8bfb\u61c2Grafana\u5c55\u793a\u7684Java\u865a\u62df\u673a\u76f8\u5173\u7684\u53c2\u6570\u3002</p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#gc\u65e5\u5fd7","title":"GC\u65e5\u5fd7","text":"<ul> <li> <p>\u901a\u8fc7GC\u65e5\u5fd7\uff0c\u53ef\u4ee5\u66f4\u597d\u7684\u770b\u5230\u5783\u573e\u56de\u6536\u7ec6\u8282\u4e0a\u7684\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u6839\u636e\u6bcf\u6b3e\u5783\u573e\u56de\u6536\u5668\u7684\u4e0d\u540c\u7279\u70b9\u66f4\u597d\u5730\u53d1\u73b0\u5b58\u5728\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u4f7f\u7528\u65b9\u6cd5\uff08JDK 8\u53ca\u4ee5\u4e0b\uff09\uff1a<code>-XX:+PrintGCDetails -Xloggc:\u6587\u4ef6\u540d</code></p> </li> <li> <p>\u4f7f\u7528\u65b9\u6cd5\uff08JDK 9+\uff09\uff1a<code>-Xlog:gc*:file=\u6587\u4ef6\u540d</code></p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#gc-viewer","title":"GC Viewer","text":"<ul> <li> <p>GCViewer\u662f\u4e00\u4e2a\u5c06GC\u65e5\u5fd7\u8f6c\u6362\u6210\u53ef\u89c6\u5316\u56fe\u8868\u7684\u5c0f\u5de5\u5177\uff0c\u5730\u5740\uff1a github</p> </li> <li> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a<code>java -jar gcviewer_1.3.4.jar \u65e5\u5fd7\u6587\u4ef6.log</code></p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#gceasy","title":"GCeasy","text":"<ul> <li> <p>GCeasy\u662f\u4e1a\u754c\u9996\u6b3e\u4f7f\u7528AI\u673a\u5668\u5b66\u4e60\u6280\u672f\u5728\u7ebf\u8fdb\u884cGC\u5206\u6790\u548c\u8bca\u65ad\u7684\u5de5\u5177\u3002\u5b9a\u4f4d\u5185\u5b58\u6cc4\u6f0f\u3001GC\u5ef6\u8fdf\u9ad8\u7684\u95ee\u9898\uff0c\u63d0\u4f9bJVM\u53c2\u6570\u4f18\u5316\u5efa\u8bae\uff0c\u652f\u6301\u5728\u7ebf\u7684\u53ef\u89c6\u5316\u5de5\u5177\u56fe\u8868\u5c55\u793a\u3002</p> </li> <li> <p>\u5b98\u65b9\u7f51\u7ad9\uff1aGCeasy</p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#\u5e38\u89c1\u7684gc\u6a21\u5f0f","title":"\u5e38\u89c1\u7684GC\u6a21\u5f0f","text":"<ul> <li> <p>\u6b63\u5e38\u60c5\u51b5\u2014\u2014\u7279\u70b9\uff1a\u5448\u73b0\u952f\u9f7f\u72b6\uff0c\u5bf9\u8c61\u521b\u5efa\u4e4b\u540e\u5185\u5b58\u4e0a\u5347\uff0c\u4e00\u65e6\u53d1\u751f\u5783\u573e\u56de\u6536\u4e4b\u540e\u4e0b\u964d\u5230\u5e95\u90e8\uff0c\u5e76\u4e14\u6bcf\u6b21\u4e0b\u964d\u4e4b\u540e\u7684\u5185\u5b58\u5927\u5c0f\u63a5\u8fd1\uff0c\u5b58\u7559\u7684\u5bf9\u8c61\u8f83\u5c11\u3002</p> </li> <li> <p>\u7f13\u5b58\u5bf9\u8c61\u8fc7\u591a\u2014\u2014\u7279\u70b9\uff1a\u5448\u73b0\u952f\u9f7f\u72b6\uff0c\u5bf9\u8c61\u521b\u5efa\u4e4b\u540e\u5185\u5b58\u4e0a\u5347\uff0c\u4e00\u65e6\u53d1\u751f\u5783\u573e\u56de\u6536\u4e4b\u540e\u4e0b\u964d\u5230\u5e95\u90e8\uff0c\u5e76\u4e14\u6bcf\u6b21\u4e0b\u964d\u4e4b\u540e\u7684\u5185\u5b58\u5927\u5c0f\u63a5\u8fd1\uff0c\u5904\u4e8e\u6bd4\u8f83\u9ad8\u7684\u4f4d\u7f6e\u3002</p> <p>\u95ee\u9898\u4ea7\u751f\u539f\u56e0</p> <p>\u7a0b\u5e8f\u4e2d\u4fdd\u5b58\u4e86\u5927\u91cf\u7684\u7f13\u5b58\u5bf9\u8c61\uff0c\u5bfc\u81f4GC\u4e4b\u540e\u65e0\u6cd5\u91ca\u653e\uff0c\u53ef\u4ee5\u4f7f\u7528MAT\u6216\u8005HeapHero\u5206\u6790\u5185\u5b58\u5360\u7528\u7684\u539f\u56e0\u3002</p> </li> <li> <p>\u5185\u5b58\u6cc4\u6f0f\u2014\u2014\u7279\u70b9\uff1a\u5448\u73b0\u952f\u9f7f\u72b6\uff0c\u6bcf\u6b21\u5783\u573e\u56de\u6536\u4e4b\u540e\u4e0b\u964d\u5230\u7684\u5185\u5b58\u4f4d\u7f6e\u8d8a\u6765\u8d8a\u9ad8\uff0c\u6700\u540e\u7531\u4e8e\u5783\u573e\u56de\u6536\u65e0\u6cd5\u91ca\u653e\u7a7a\u95f4\u5bfc\u81f4\u5bf9\u8c61\u65e0\u6cd5\u5206\u914d\u4ea7\u751fOutOfMemory\u7684\u9519\u8bef\u3002</p> <p>\u95ee\u9898\u4ea7\u751f\u539f\u56e0</p> <p>\u7a0b\u5e8f\u4e2d\u4fdd\u5b58\u4e86\u5927\u91cf\u7684\u5185\u5b58\u6cc4\u6f0f\u5bf9\u8c61\uff0c\u5bfc\u81f4GC\u4e4b\u540e\u65e0\u6cd5\u91ca\u653e\uff0c\u53ef\u4ee5\u4f7f\u7528MAT\u6216\u8005HeapHero\u8fdb\u884c\u5206\u6790\u662f\u54ea\u4e9b\u5bf9\u8c61\u4ea7\u751f\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002</p> </li> <li> <p>\u6301\u7eed\u7684FullGC\u2014\u2014\u7279\u70b9\uff1a\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4ea7\u751f\u591a\u6b21Full GC\uff0cCPU\u4f7f\u7528\u7387\u540c\u65f6\u98d9\u9ad8\uff0c\u7528\u6237\u8bf7\u6c42\u57fa\u672c\u65e0\u6cd5\u5904\u7406\u3002\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u6062\u590d\u6b63\u5e38\u3002</p> <p>\u95ee\u9898\u4ea7\u751f\u539f\u56e0</p> <p>\u5728\u8be5\u65f6\u95f4\u8303\u56f4\u8bf7\u6c42\u91cf\u6fc0\u589e\uff0c\u7a0b\u5e8f\u5f00\u59cb\u751f\u6210\u66f4\u591a\u5bf9\u8c61\uff0c\u540c\u65f6\u5783\u573e\u6536\u96c6\u65e0\u6cd5\u8ddf\u4e0a\u5bf9\u8c61\u521b\u5efa\u901f\u7387\uff0c\u5bfc\u81f4\u6301\u7eed\u5730\u5728\u8fdb\u884cFULL GC\u3002</p> </li> <li> <p>\u5143\u7a7a\u95f4\u4e0d\u8db3\u5bfc\u81f4\u7684FULLGC\u2014\u2014\u7279\u70b9\uff1a\u5806\u5185\u5b58\u7684\u5927\u5c0f\u5e76\u4e0d\u662f\u7279\u522b\u5927\uff0c\u4f46\u662f\u6301\u7eed\u53d1\u751fFULLGC\u3002</p> <p>\u95ee\u9898\u4ea7\u751f\u539f\u56e0</p> <p>\u5143\u7a7a\u95f4\u5927\u5c0f\u4e0d\u8db3\uff0c\u5bfc\u81f4\u6301\u7eedfull GC\u56de\u6536\u5143\u7a7a\u95f4\u7684\u6570\u636e\u3002</p> </li> </ul>"},{"location":"JVM/JVM-practice/#\u89e3\u51b3gc\u95ee\u9898\u7684\u624b\u6bb5","title":"\u89e3\u51b3GC\u95ee\u9898\u7684\u624b\u6bb5","text":"<ol> <li> <p>\u4f18\u5316\u57fa\u7840JVM\u53c2\u6570</p> <p>\u57fa\u7840JVM\u53c2\u6570\u7684\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u4f1a\u5bfc\u81f4\u9891\u7e41FULLGC\u7684\u4ea7\u751f</p> </li> <li> <p>\u51cf\u5c11\u5bf9\u8c61\u4ea7\u751f</p> <p>\u5927\u591a\u6570\u573a\u666f\u4e0b\u7684FULLGC\u662f\u7531\u4e8e\u5bf9\u8c61\u4ea7\u751f\u901f\u5ea6\u8fc7\u5feb\u5bfc\u81f4\u7684\uff0c\u51cf\u5c11\u5bf9\u8c61\u4ea7\u751f\u53ef\u4ee5\u6709\u6548\u7684\u7f13\u89e3FULLGC\u7684\u53d1\u751f</p> </li> <li> <p>\u66f4\u6362\u5783\u573e\u56de\u6536\u5668</p> <p>\u9009\u62e9\u9002\u5408\u5f53\u524d\u4e1a\u52a1\u573a\u666f\u7684\u5783\u573e\u56de\u6536\u5668\uff0c\u51cf\u5c11\u5ef6\u8fdf\u3001\u63d0\u9ad8\u541e\u5410\u91cf</p> </li> <li> <p>\u4f18\u5316\u5783\u573e\u56de\u6536\u5668\u53c2\u6570</p> <p>\u4f18\u5316\u5783\u573e\u56de\u6536\u5668\u7684\u53c2\u6570\uff0c\u80fd\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u63d0\u5347GC\u6548\u7387</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u4f18\u5316\u57fa\u7840jvm\u53c2\u6570","title":"\u4f18\u5316\u57fa\u7840JVM\u53c2\u6570","text":"<p>\u25fc \u53c2\u65701 \uff1a<code>-Xmx</code> \u548c <code>\u2013Xms</code></p> <p><code>-Xmx</code>\u53c2\u6570\u8bbe\u7f6e\u7684\u662f\u6700\u5927\u5806\u5185\u5b58\uff0c\u4f46\u662f\u7531\u4e8e\u7a0b\u5e8f\u662f\u8fd0\u884c\u5728\u670d\u52a1\u5668\u6216\u8005\u5bb9\u5668\u4e0a\uff0c\u8ba1\u7b97\u53ef\u7528\u5185\u5b58\u65f6\uff0c\u8981\u5c06\u5143\u7a7a\u95f4\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u5176\u5b83\u8f6f\u4ef6\u5360\u7528\u7684\u5185\u5b58\u6392\u9664\u6389\u3002</p> <p>\u6848\u4f8b\uff1a \u670d\u52a1\u5668\u5185\u5b584G\uff0c\u64cd\u4f5c\u7cfb\u7edf+\u5143\u7a7a\u95f4\u6700\u5927\u503c+\u5176\u5b83\u8f6f\u4ef6 \u5360\u75281.5G\uff0c-Xmx\u53ef\u4ee5\u8bbe\u7f6e\u4e3a2g\u3002</p> <p>\u6700\u5408\u7406\u7684\u8bbe\u7f6e\u65b9\u5f0f\u5e94\u8be5\u662f\u6839\u636e\u6700\u5927\u5e76\u53d1\u91cf\u4f30\u7b97\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff0c\u7136\u540e\u518d\u6839\u636e\u670d\u52a1\u5668\u914d\u7f6e\u8ba1\u7b97\u6700\u5927\u5806\u5185\u5b58\u7684\u503c\u3002</p> <p><code>-Xms</code>\u7528\u6765\u8bbe\u7f6e\u521d\u59cb\u5806\u5927\u5c0f\uff0c\u5efa\u8bae\u5c06<code>-Xms</code>\u8bbe\u7f6e\u7684\u548c<code>-Xmx</code>\u4e00\u6837\u5927\uff0c\u6709\u4ee5\u4e0b\u51e0\u70b9\u597d\u5904\uff1a</p> <p>\u2713 \u8fd0\u884c\u65f6\u6027\u80fd\u66f4\u597d\uff0c\u5806\u7684\u6269\u5bb9\u662f\u9700\u8981\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5185\u5b58\u7684\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u6027\u80fd\u77ed\u671f\u4e0b\u964d\u3002</p> <p>\u2713 \u53ef\u7528\u6027\u95ee\u9898\uff0c\u5982\u679c\u5728\u6269\u5bb9\u65f6\u5176\u4ed6\u7a0b\u5e8f\u6b63\u5728\u4f7f\u7528\u5927\u91cf\u5185\u5b58\uff0c\u5f88\u5bb9\u6613\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\u5206\u914d\u5931\u8d25\u3002</p> <p>\u2713 \u542f\u52a8\u901f\u5ea6\u66f4\u5feb\uff0cOracle\u5b98\u65b9\u6587\u6863\u7684\u539f\u8bdd\uff1a\u5982\u679c\u521d\u59cb\u5806\u592a\u5c0f\uff0cJava \u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u4f1a\u53d8\u5f97\u5f88\u6162\uff0c\u56e0\u4e3a JVM \u88ab\u8feb\u9891\u7e41\u6267\u884c\u5783\u573e\u6536\u96c6\uff0c\u76f4\u5230\u5806\u589e\u957f\u5230\u66f4\u5408\u7406\u7684\u5927\u5c0f\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u542f\u52a8\u6027\u80fd\uff0c\u8bf7\u5c06\u521d\u59cb\u5806\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u4e0e\u6700\u5927\u5806\u5927\u5c0f\u76f8\u540c\u3002</p> <p>\u25fc \u53c2\u65702 \uff1a<code>-XX:MaxMetaspaceSize</code> \u548c <code>\u2013XX:MetaspaceSize</code></p> <p><code>-XX:MaxMetaspaceSize=\u503c</code> \u53c2\u6570\u6307\u7684\u662f\u6700\u5927\u5143\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u6bd4\u8f83\u5927\uff0c\u5982\u679c\u51fa\u73b0\u5143\u7a7a\u95f4\u5185\u5b58\u6cc4\u6f0f\u4f1a\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u4e0d\u53ef\u63a7\uff0c\u5efa\u8bae\u6839\u636e\u6d4b\u8bd5\u60c5\u51b5\u8bbe\u7f6e\u6700\u5927\u503c\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3a256m\u3002</p> <p><code>-XX:MetaspaceSize=\u503c</code> \u53c2\u6570\u6307\u7684\u662f\u5230\u8fbe\u8fd9\u4e2a\u503c\u4e4b\u540e\u4f1a\u89e6\u53d1FULLGC[\u9608\u503c]\uff08\u7f51\u4e0a\u5f88\u591a\u6587\u7ae0\u7684\u521d\u59cb\u5143\u7a7a\u95f4\u5927\u5c0f\u662f\u9519\u8bef\u7684\uff09\uff0c\u540e\u7eed\u4ec0\u4e48\u65f6\u5019\u518d\u89e6\u53d1JVM\u4f1a\u81ea\u884c\u8ba1\u7b97\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a\u548cMaxMetaspaceSize\u4e00\u6837\u5927\uff0c\u5c31\u4e0d\u4f1aFULLGC\uff0c\u4f46\u662f\u5bf9\u8c61\u4e5f\u65e0\u6cd5\u56de\u6536\u3002</p> <p>\u25fc \u53c2\u65703 \uff1a <code>-Xss</code>\u865a\u62df\u673a\u6808\u5927\u5c0f</p> <p>\u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a\u6808\u7684\u5927\u5c0f\uff0cJVM \u5c06\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9ed8\u8ba4\u5927\u5c0f\u7684\u6808\u3002\u5927\u5c0f\u53d6\u51b3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u548c\u8ba1\u7b97\u673a\u7684\u4f53\u7cfb\u7ed3\u6784\u3002</p> <p>\u6bd4\u5982Linux x86 64\u4f4d \uff1a 1MB\uff0c\u5982\u679c\u4e0d\u9700\u8981\u7528\u5230\u8fd9\u4e48\u5927\u7684\u6808\u5185\u5b58\uff0c\u5b8c\u5168\u53ef\u4ee5\u5c06\u6b64\u503c\u8c03\u5c0f\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u5408\u7406\u503c\u4e3a256k \u2013 1m\u4e4b\u95f4\u3002</p> <p>\u4f7f\u7528\uff1a-Xss256k</p> <p>\u25fc \u53c2\u65704 \uff1a \u4e0d\u5efa\u8bae\u624b\u52a8\u8bbe\u7f6e\u7684\u53c2\u6570</p> <p>\u7531\u4e8eJVM\u5e95\u5c42\u8bbe\u8ba1\u6781\u4e3a\u590d\u6742\uff0c\u4e00\u4e2a\u53c2\u6570\u7684\u8c03\u6574\u4e5f\u8bb8\u8ba9\u67d0\u4e2a\u63a5\u53e3\u5f97\u76ca\uff0c\u4f46\u540c\u6837\u6709\u53ef\u80fd\u5f71\u54cd\u5176\u4ed6\u66f4\u591a\u63a5\u53e3\u3002</p> <ul> <li> <p><code>-Xmn</code> \u5e74\u8f7b\u4ee3\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u4e3a\u6574\u4e2a\u5806\u76841/3\uff0c\u53ef\u4ee5\u6839\u636e\u5cf0\u503c\u6d41\u91cf\u8ba1\u7b97\u6700\u5927\u7684\u5e74\u8f7b\u4ee3\u5927\u5c0f\uff0c\u5c3d\u91cf\u8ba9\u5bf9\u8c61\u53ea\u5b58\u653e\u5728\u5e74\u8f7b\u4ee3\uff0c\u4e0d\u8fdb\u5165\u8001\u5e74\u4ee3\u3002   \u4f46\u662f\u5b9e\u9645\u7684\u573a\u666f\u4e2d\uff0c\u63a5\u53e3\u7684\u54cd\u5e94\u65f6\u95f4\u3001\u521b\u5efa\u5bf9\u8c61\u7684\u5927\u5c0f\u3001\u7a0b\u5e8f\u5185\u90e8\u8fd8\u4f1a\u6709\u4e00\u4e9b\u5b9a\u65f6\u4efb\u52a1\u7b49\u4e0d\u786e\u5b9a\u56e0\u7d20\u90fd\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u503c\u7684\u5927\u5c0f\u5e76\u4e0d\u80fd\u4ec5\u51ed\u8ba1\u7b97\u5f97\u51fa\uff0c\u5982\u679c\u8bbe\u7f6e\u8be5\u503c\u8981\u8fdb\u884c\u5927\u91cf\u7684\u6d4b\u8bd5\u3002   G1\u5783\u573e\u56de\u6536\u5668\u5c3d\u91cf\u4e0d\u8981\u8bbe\u7f6e\u8be5\u503c\uff0cG1\u4f1a\u52a8\u6001\u8c03\u6574\u5e74\u8f7b\u4ee3\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>\u2010XX:SurvivorRatio</code> \u4f0a\u7538\u56ed\u533a\u548c\u5e78\u5b58\u8005\u533a\u7684\u5927\u5c0f\u6bd4\u4f8b\uff0c\u9ed8\u8ba4\u503c\u4e3a8\u3002</p> </li> <li> <p><code>\u2010XX:MaxTenuringThreshold</code> \u6700\u5927\u664b\u5347\u9608\u503c\uff0c\u5e74\u9f84\u5927\u4e8e\u6b64\u503c\u4e4b\u540e\uff0c\u4f1a\u8fdb\u5165\u8001\u5e74\u4ee3\u3002\u53e6\u5916JVM\u6709\u52a8\u6001\u5e74\u9f84\u5224\u65ad\u673a\u5236\uff1a\u5c06\u5e74\u9f84\u4ece\u5c0f\u5230\u5927\u7684\u5bf9\u8c61\u5360\u636e\u7684\u7a7a\u95f4\u52a0\u8d77\u6765\uff0c\u5982\u679c\u5927\u4e8esurvivor\u533a\u57df\u768450%\uff0c\u7136\u540e\u628a\u7b49\u4e8e\u6216\u5927\u4e8e\u8be5\u5e74\u9f84\u7684\u5bf9\u8c61\uff0c\u653e\u5165\u5230\u8001\u5e74\u4ee3\u3002</p> </li> </ul> <p>\u25fc \u5176\u4ed6\u53c2\u6570 \uff1a</p> <ul> <li> <p><code>-XX:+DisableExplicitGC</code>\u7981\u6b62\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528System.gc()\uff0c System.gc()\u53ef\u80fd\u4f1a\u5f15\u8d77FULLGC\uff0c\u5728\u4ee3\u7801\u4e2d\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u3002\u4f7f\u7528DisableExplicitGC\u53c2\u6570\u53ef\u4ee5\u7981\u6b62\u4f7f\u7528System.gc()\u65b9\u6cd5\u8c03\u7528\u3002</p> </li> <li> <p><code>-XX:+HeapDumpOnOutOfMemoryError</code>\uff1a\u53d1\u751fOutOfMemoryError\u9519\u8bef\u65f6\uff0c\u81ea\u52a8\u751f\u6210hprof\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002</p> </li> <li> <p><code>-XX:HeapDumpPath=&lt;path&gt;</code>:\uff1a\u6307\u5b9ahprof\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\u3002</p> </li> <li> <p>\u6253\u5370GC\u65e5\u5fd7   JDK8\u53ca\u4e4b\u524d \uff1a <code>-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:\u6587\u4ef6\u8def\u5f84</code>   JDK9\u53ca\u4e4b\u540e \uff1a <code>-Xlog:gc*:file=\u6587\u4ef6\u8def\u5f84</code></p> </li> </ul>"},{"location":"JVM/JVM-practice/#jvm\u53c2\u6570\u6a21\u677f","title":"JVM\u53c2\u6570\u6a21\u677f","text":"<pre><code>-Xms1g\n-Xmx1g\n-Xss256k\n-XX:MaxMetaspaceSize=512m \n-XX:+DisableExplicitGC\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:HeapDumpPath=/opt/logs/my-service.hprof\n-XX:+PrintGCDetails\n-XX:+PrintGCDateStamps\n-Xloggc:\u6587\u4ef6\u8def\u5f84\n</code></pre> <p>\u6ce8\u610f</p> <p>JDK9\u53ca\u4e4b\u540egc\u65e5\u5fd7\u8f93\u51fa\u4fee\u6539\u4e3a -Xlog:gc*:file=\u6587\u4ef6\u540d</p> <p>\u5806\u5185\u5b58\u5927\u5c0f\u548c\u6808\u5185\u5b58\u5927\u5c0f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7075\u6d3b\u8c03\u6574\u3002</p>"},{"location":"JVM/JVM-practice/#\u6027\u80fd\u8c03\u4f18","title":"\u6027\u80fd\u8c03\u4f18","text":"<p>\u672c\u5c0f\u8282\u7740\u91cd\u5b66\u4e60\u53d1\u73b0\u95ee\u9898\u548c\u8bca\u65ad\u95ee\u9898\u7684\u65b9\u6cd5\uff0c\u76ee\u6807\u662f\u51c6\u786e\u5b9a\u4f4d\u5230\u6027\u80fd\u95ee\u9898\u7684\u6839\u6e90\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u4f1a\u51fa\u73b0\u6027\u80fd\u95ee\u9898\uff0c\u6bd4\u8f83\u5e38\u89c1\u7684\u6027\u80fd\u95ee\u9898\u73b0\u8c61\u662f\uff1a</p> <ol> <li> <p>\u901a\u8fc7top\u547d\u4ee4\u67e5\u770bCPU\u5360\u7528\u7387\u9ad8\uff0c\u63a5\u8fd1100\u751a\u81f3\u591a\u6838CPU\u4e0b\u8d85\u8fc7100\u90fd\u662f\u6709\u53ef\u80fd\u7684\u3002</p> </li> <li> <p>\u8bf7\u6c42\u5355\u4e2a\u670d\u52a1\u5904\u7406\u65f6\u95f4\u7279\u522b\u957f\uff0c\u591a\u670d\u52a1\u4f7f\u7528skywalking\u7b49\u76d1\u63a7\u7cfb\u7edf\u6765\u5224\u65ad\u662f\u54ea\u4e00\u4e2a\u73af\u8282\u6027\u80fd\u4f4e\u4e0b\u3002</p> </li> <li> <p>\u7a0b\u5e8f\u542f\u52a8\u4e4b\u540e\u8fd0\u884c\u6b63\u5e38\uff0c\u4f46\u662f\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u65e0\u6cd5\u5904\u7406\u4efb\u4f55\u7684\u8bf7\u6c42\uff08\u5185\u5b58\u548cGC\u6b63\u5e38\uff09\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u7ebf\u7a0b\u8f6c\u50a8\u7684\u67e5\u770b\u65b9\u5f0f","title":"\u7ebf\u7a0b\u8f6c\u50a8\u7684\u67e5\u770b\u65b9\u5f0f","text":"<p>\u7ebf\u7a0b\u8f6c\u50a8\uff08Thread Dump\uff09\u63d0\u4f9b\u4e86\u5bf9\u6240\u6709\u8fd0\u884c\u4e2d\u7684\u7ebf\u7a0b\u5f53\u524d\u72b6\u6001\u7684\u5feb\u7167\u3002</p> <p>\u7ebf\u7a0b\u8f6c\u50a8\u53ef\u4ee5\u901a\u8fc7jstack\u3001visualvm\u7b49\u5de5\u5177\u83b7\u53d6\u3002\u5176\u4e2d\u5305\u542b\u4e86\u7ebf\u7a0b\u540d\u3001\u4f18\u5148\u7ea7\u3001\u7ebf\u7a0bID\u3001\u7ebf\u7a0b\u72b6\u6001\u3001\u7ebf\u7a0b\u6808\u4fe1\u606f\u7b49\u7b49\u5185\u5bb9\uff0c\u53ef\u4ee5\u7528\u6765\u89e3\u51b3CPU\u5360\u7528\u7387\u9ad8\u3001\u6b7b\u9501\u7b49\u95ee\u9898\u3002</p> <p>\u7ebf\u7a0b\u8f6c\u50a8\u4e2d\u7684\u51e0\u4e2a\u6838\u5fc3\u5185\u5bb9\uff1a</p> <ul> <li> <p>\u540d\u79f0\uff1a \u7ebf\u7a0b\u540d\u79f0\uff0c\u901a\u8fc7\u7ed9\u7ebf\u7a0b\u8bbe\u7f6e\u5408\u9002\u7684\u540d\u79f0\u66f4\u5bb9\u6613\u201c\u987e\u540d\u601d\u4e49\u201d </p> </li> <li> <p>\u4f18\u5148\u7ea7\uff08prio\uff09\uff1a\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7</p> </li> <li> <p>Java ID\uff08tid\uff09\uff1aJVM\u4e2d\u7ebf\u7a0b\u7684\u552f\u4e00ID </p> </li> <li> <p>\u672c\u5730 ID (nid)\uff1a\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9\u7ebf\u7a0b\u7684\u552f\u4e00ID </p> </li> <li> <p>\u72b6\u6001\uff1a\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5206\u4e3a\uff1a</p> <ul> <li> <p>NEW \u2013 \u65b0\u521b\u5efa\u7684\u7ebf\u7a0b\uff0c\u5c1a\u672a\u5f00\u59cb\u6267\u884c</p> </li> <li> <p>RUNNABLE \u2013\u6b63\u5728\u8fd0\u884c\u6216\u51c6\u5907\u6267\u884c</p> </li> <li> <p>BLOCKED \u2013 \u7b49\u5f85\u83b7\u53d6\u76d1\u89c6\u5668\u9501\u4ee5\u8fdb\u5165\u6216\u91cd\u65b0\u8fdb\u5165\u540c\u6b65\u5757/\u65b9\u6cd5</p> </li> <li> <p>WAITING \u2013 \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\uff0c\u6ca1\u6709\u65f6\u95f4\u9650\u5236</p> </li> <li> <p>TIMED_WAITING \u2013 \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6267\u884c\u7279\u5b9a\u64cd\u4f5c</p> </li> <li> <p>TERMINATED \u2013 \u5df2\u5b8c\u6210\u6267\u884c</p> </li> </ul> </li> <li> <p>\u6808\u8ffd\u8e2a\uff1a \u663e\u793a\u6574\u4e2a\u65b9\u6cd5\u7684\u6808\u5e27\u4fe1\u606f</p> </li> </ul> <p>Tip</p> <p>\u6709\u5173\u7ebf\u7a0b\u72b6\u6001\u7684\u8be6\u7ec6\u90e8\u5206\uff0c\u53ef\u67e5\u770b \u5e76\u53d1\u7f16\u7a0b\u90e8\u5206\u7684\u7b14\u8bb0</p> <p>\u7ebf\u7a0b\u8f6c\u50a8\u7684\u53ef\u89c6\u5316\u5728\u7ebf\u5206\u6790\u5e73\u53f0\uff1a</p> <ol> <li> <p>https://jstack.review</p> </li> <li> <p>https://fastthread.io</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b1cpu\u5360\u7528\u7387\u9ad8\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848","title":"\u6848\u4f8b1\uff1aCPU\u5360\u7528\u7387\u9ad8\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848","text":"<p>\u95ee\u9898\u80cc\u666f\uff1a\u76d1\u63a7\u4eba\u5458\u901a\u8fc7prometheus\u7684\u544a\u8b66\u53d1\u73b0CPU\u5360\u7528\u7387\u4e00\u76f4\u5904\u4e8e\u5f88\u9ad8\u7684\u60c5\u51b5\uff0c\u901a\u8fc7top\u547d\u4ee4\u770b\u5230\u662f\u7531\u4e8eJava\u7a0b\u5e8f\u5f15\u8d77\u7684\uff0c\u5e0c\u671b\u80fd\u5feb\u901f\u5b9a\u4f4d\u5230\u662f\u54ea\u4e00\u90e8\u5206\u4ee3\u7801\u5bfc\u81f4\u4e86\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <ol> <li> <p>\u901a\u8fc7<code>top \u2013c</code> \u547d\u4ee4\u627e\u5230CPU\u5360\u7528\u7387\u9ad8\u7684\u8fdb\u7a0b\uff0c\u83b7\u53d6\u5b83\u7684\u8fdb\u7a0bID\u3002(Linux)</p> </li> <li> <p>\u4f7f\u7528<code>top -p \u8fdb\u7a0bID</code> \u5355\u72ec\u76d1\u63a7\u67d0\u4e2a\u8fdb\u7a0b\uff0c\u6309H(\u5927\u5199)\u53ef\u4ee5\u67e5\u770b\u5230\u6240\u6709\u7684\u7ebf\u7a0b\u4ee5\u53ca\u7ebf\u7a0b\u5bf9\u5e94\u7684CPU\u4f7f\u7528\u7387\uff0c\u627e\u5230CPU\u4f7f\u7528\u7387\u7279\u522b\u9ad8\u7684\u7ebf\u7a0b\uff08\u8bb0\u4f4f\u7ebf\u7a0bID\uff09\u3002</p> </li> <li> <p>\u4f7f\u7528<code>jstack \u8fdb\u7a0bID</code> \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5230\u6240\u6709\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u7684\u6808\u4fe1\u606f\u3002\u4f7f\u7528 <code>jstack\u8fdb\u7a0bID &gt; \u6587\u4ef6\u540d</code> \u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u65b9\u4fbf\u67e5\u770b\u3002</p> </li> <li> <p>\u627e\u5230nid\u4e0e\u7ebf\u7a0bID\u76f8\u540c\u7684\u6808\u4fe1\u606f\uff0c\u9700\u8981\u5c06\u4e4b\u524d\u8bb0\u5f55\u4e0b\u7684\u5341\u8fdb\u5236\u7ebf\u7a0b\u53f7\u8f6c\u6362\u621016\u8fdb\u5236\u3002\u901a\u8fc7 <code>printf \u2018%x\\n\u2019 \u7ebf\u7a0bID</code> \u547d\u4ee4\u76f4\u63a5\u83b7\u5f9716\u8fdb\u5236\u4e0b\u7684\u7ebf\u7a0bID\u3002</p> </li> <li> <p>\u627e\u5230\u6808\u4fe1\u606f\u5bf9\u5e94\u7684\u6e90\u4ee3\u7801\uff0c\u5e76\u5206\u6790\u95ee\u9898\u4ea7\u751f\u539f\u56e0\u3002</p> </li> </ol> <p></p>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b2\u63a5\u53e3\u54cd\u5e94\u65f6\u95f4\u5f88\u957f\u7684\u95ee\u9898","title":"\u6848\u4f8b2\uff1a\u63a5\u53e3\u54cd\u5e94\u65f6\u95f4\u5f88\u957f\u7684\u95ee\u9898","text":"<p>\u95ee\u9898\u80cc\u666f\uff1a\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0\u6709\u51e0\u4e2a\u63a5\u53e3\u7684\u54cd\u5e94\u65f6\u95f4\u7279\u522b\u957f\uff0c\u9700\u8981\u5feb\u901f\u5b9a\u4f4d\u5230\u662f\u54ea\u4e00\u4e2a\u65b9\u6cd5\u7684\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u5df2\u7ecf\u786e\u5b9a\u662f\u67d0\u4e2a\u63a5\u53e3\u6027\u80fd\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4f46\u662f\u7531\u4e8e\u65b9\u6cd5\u5d4c\u5957\u6bd4\u8f83\u6df1\uff0c\u9700\u8981\u501f\u52a9\u4e8e<code>arthas</code>\u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u65b9\u6cd5\u3002</p> <p>\u4f7f\u7528arthas\u7684<code>trace</code>\u547d\u4ee4\uff0c\u53ef\u4ee5\u5c55\u793a\u51fa\u6574\u4e2a\u65b9\u6cd5\u7684\u8c03\u7528\u8def\u5f84\u4ee5\u53ca\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u7684\u6267\u884c\u8017\u65f6\u3002</p> <p>\u547d\u4ee4\uff1a <code>trace \u7c7b\u540d \u65b9\u6cd5\u540d</code></p> <ul> <li> <p>\u6dfb\u52a0 <code>--skipJDKMethod false</code> \u53c2\u6570\u53ef\u4ee5\u8f93\u51faJDK\u6838\u5fc3\u5305\u4e2d\u7684\u65b9\u6cd5\u53ca\u8017\u65f6\u3002</p> </li> <li> <p>\u6dfb\u52a0 <code>'#cost &gt; \u6beb\u79d2\u503c'</code> \u53c2\u6570\uff0c\u53ea\u4f1a\u663e\u793a\u8017\u65f6\u8d85\u8fc7\u8be5\u6beb\u79d2\u503c\u7684\u8c03\u7528\u3002</p> </li> <li> <p>\u6dfb\u52a0 <code>\u2013n \u6570\u503c</code> \u53c2\u6570\uff0c\u6700\u591a\u663e\u793a\u8be5\u6570\u503c\u6761\u6570\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u6240\u6709\u76d1\u63a7\u90fd\u7ed3\u675f\u4e4b\u540e\uff0c\u8f93\u5165<code>stop</code>\u7ed3\u675f\u76d1\u63a7\uff0c\u91cd\u7f6earthas\u589e\u5f3a\u7684\u5bf9\u8c61\u3002</p> </li> </ul> <p></p> <p>\u5728\u4f7f\u7528trace\u5b9a\u4f4d\u5230\u6027\u80fd\u8f83\u4f4e\u7684\u65b9\u6cd5\u4e4b\u540e\uff0c\u4f7f\u7528<code>watch</code>\u547d\u4ee4\u76d1\u63a7\u8be5\u65b9\u6cd5\uff0c\u53ef\u4ee5\u83b7\u5f97\u66f4\u4e3a\u8be6\u7ec6\u7684\u65b9\u6cd5\u4fe1\u606f\u3002</p> <p>\u547d\u4ee4\uff1a<code>watch \u7c7b\u540d \u65b9\u6cd5\u540d \u2018{params, returnObj}\u2019 \u2018#cost&gt;\u6beb\u79d2\u503c' -x 2</code></p> <ul> <li> <p><code>\u2018{params, returnObj}\u2018</code>\u4ee3\u8868\u6253\u5370\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002</p> </li> <li> <p><code>-x</code> \u4ee3\u8868\u6253\u5370\u7684\u7ed3\u679c\u4e2d\u5982\u679c\u6709\u5d4c\u5957\uff08\u6bd4\u5982\u5bf9\u8c61\u91cc\u6709\u5c5e\u6027\uff09\uff0c\u6700\u591a\u53ea\u5c55\u5f002\u5c42\u3002\u5141\u8bb8\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e3a4\u3002</p> </li> </ul> <p></p>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b3\u5b9a\u4f4d\u504f\u5e95\u5c42\u7684\u6027\u80fd\u95ee\u9898","title":"\u6848\u4f8b3\uff1a\u5b9a\u4f4d\u504f\u5e95\u5c42\u7684\u6027\u80fd\u95ee\u9898","text":"<p>\u95ee\u9898\u80cc\u666f\uff1a\u6709\u4e00\u4e2a\u63a5\u53e3\u4e2d\u4f7f\u7528\u4e86for\u5faa\u73af\u5411ArrayList\u4e2d\u6dfb\u52a0\u6570\u636e\uff0c\u4f46\u662f\u6700\u7ec8\u53d1\u73b0\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u9700\u8981\u5b9a\u4f4d\u662f\u7531\u4e8e\u4ec0\u4e48\u539f\u56e0\u5bfc\u81f4\u7684\u6027\u80fd\u4f4e\u4e0b\u3002</p> <p>\u601d\u8def\uff1a</p> <p>Arthas\u63d0\u4f9b\u4e86\u6027\u80fd\u706b\u7130\u56fe\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u975e\u5e38\u76f4\u89c2\u5730\u663e\u793a\u6240\u6709\u65b9\u6cd5\u4e2d\u54ea\u4e9b\u65b9\u6cd5\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u957f\u3002</p> <p>Arthas\u7684profile\u547d\u4ee4(Windows\u4e0d\u652f\u6301)</p> <p>\u4f7f\u7528arthas\u7684profile\u547d\u4ee4\uff0c\u751f\u6210\u6027\u80fd\u76d1\u63a7\u7684\u706b\u7130\u56fe\u3002</p> <p>\u547d\u4ee41\uff1a <code>profiler star</code>t \u5f00\u59cb\u76d1\u63a7\u65b9\u6cd5\u6267\u884c\u6027\u80fd</p> <p>\u547d\u4ee42\uff1a <code>profiler stop --format html</code> \u4ee5HTML\u7684\u65b9\u5f0f\u751f\u6210\u706b\u7130\u56fe\u706b\u7130\u56fe\u4e2d\u4e00\u822c\u627e\u7eff\u8272\u90e8\u5206Java\u4e2d\u6808\u9876\u4e0a\u6bd4\u8f83\u5e73\u7684\u90e8\u5206\uff0c\u5f88\u53ef\u80fd\u5c31\u662f\u6027\u80fd\u7684\u74f6\u9888\u3002</p> <p></p> <p>\u504f\u5e95\u5c42\u7684\u6027\u80fd\u95ee\u9898\uff0c\u7279\u522b\u662f\u7531\u4e8eJDK\u4e2d\u67d0\u4e9b\u65b9\u6cd5\u88ab\u5927\u91cf\u8c03\u7528\u5bfc\u81f4\u7684\u6027\u80fd\u4f4e\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u706b\u7130\u56fe\u975e\u5e38\u76f4\u89c2\u7684\u627e\u5230\u539f\u56e0\u3002</p> <p>\u8fd9\u4e2a\u6848\u4f8b\u4e2d\u662f\u7531\u4e8e\u521b\u5efaArrayList\u65f6\u6ca1\u6709\u624b\u52a8\u6307\u5b9a\u5bb9\u91cf\uff0c\u5bfc\u81f4\u4f7f\u7528\u9ed8\u8ba4\u7684\u5bb9\u91cf\u800c\u5728\u6dfb\u52a0\u5bf9\u8c61\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u591a\u6b21\u7684\u6269\u5bb9\uff0c\u6269\u5bb9\u9700\u8981\u5c06\u539f\u6765\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u590d\u5236\u5230\u65b0\u7684\u6570\u7ec4\u4e2d\uff0c\u6d88\u8017\u4e86\u5927\u91cf\u7684\u65f6\u95f4\u3002\u901a\u8fc7\u706b\u7130\u56fe\u53ef\u4ee5\u770b\u5230\u5927\u91cf\u7684\u8c03\u7528\uff0c\u4fee\u590d\u5b8c\u4e4b\u540e\u8282\u7701\u4e8620% ~ 50%\u7684\u65f6\u95f4\u3002</p> <p></p>"},{"location":"JVM/JVM-practice/#\u6848\u4f8b4\u7ebf\u7a0b\u88ab\u8017\u5c3d\u95ee\u9898","title":"\u6848\u4f8b4\uff1a\u7ebf\u7a0b\u88ab\u8017\u5c3d\u95ee\u9898","text":"<p>\u95ee\u9898\u80cc\u666f\uff1a\u7a0b\u5e8f\u5728\u542f\u52a8\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\uff0c\u5c31\u65e0\u6cd5\u5904\u7406\u4efb\u4f55\u8bf7\u6c42\u4e86\u3002\u5c06\u7a0b\u5e8f\u91cd\u542f\u4e4b\u540e\u7ee7\u7eed\u8fd0\u884c\uff0c\u4f9d\u7136\u4f1a\u51fa\u73b0\u76f8\u540c\u7684\u60c5\u51b5\u3002</p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <p>\u7ebf\u7a0b\u8017\u5c3d\u95ee\u9898\uff0c\u4e00\u822c\u662f\u7531\u4e8e\u6267\u884c\u65f6\u95f4\u8fc7\u957f\uff0c\u5206\u6790\u65b9\u6cd5\u5206\u6210\u4e24\u6b65\uff1a</p> <ul> <li> <p>\u68c0\u6d4b\u662f\u5426\u6709\u6b7b\u9501\u4ea7\u751f\uff0c\u65e0\u6cd5\u81ea\u52a8\u89e3\u9664\u7684\u6b7b\u9501\u4f1a\u5c06\u7ebf\u7a0b\u6c38\u8fdc\u963b\u585e\u3002</p> </li> <li> <p>\u5982\u679c\u6ca1\u6709\u6b7b\u9501\uff0c\u518d\u4f7f\u7528\u6848\u4f8b1\u7684\u6253\u5370\u7ebf\u7a0b\u6808\u7684\u65b9\u6cd5\u68c0\u6d4b\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u54ea\u4e2a\u65b9\u6cd5\uff0c\u4e00\u822c\u8fd9\u4e9b\u5927\u91cf\u51fa\u73b0\u7684\u65b9\u6cd5\u5c31\u662f\u6162\u65b9\u6cd5\u3002</p> </li> </ul> <p></p> <p>\u7ebf\u7a0b\u6b7b\u9501\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u65b9\u6cd5\u5b9a\u4f4d\u95ee\u9898\uff1a</p> <ol> <li> <p><code>jstack-l \u8fdb\u7a0bID &gt; \u6587\u4ef6\u540d</code> \u5c06\u7ebf\u7a0b\u6808\u4fdd\u5b58\u5230\u672c\u5730\u3002\u5728\u6587\u4ef6\u4e2d\u641c\u7d22<code>deadlock</code>\u5373\u53ef\u627e\u5230\u6b7b\u9501\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528visual vm\u6216\u8005Jconsole\u5de5\u5177\uff0c\u90fd\u53ef\u4ee5\u68c0\u6d4b\u51fa\u6b7b\u9501\u3002\u4f7f\u7528\u7ebf\u7a0b\u5feb\u7167\u751f\u6210\u5de5\u5177\u5c31\u53ef\u4ee5\u770b\u5230\u6b7b\u9501\u7684\u6839\u6e90\u3002\u751f\u4ea7\u73af\u5883\u7684\u670d\u52a1\u4e00\u822c\u4e0d\u4f1a\u5141\u8bb8\u4f7f\u7528\u8fd9\u4e24\u79cd\u5de5\u5177\u8fde\u63a5\u3002</p> </li> <li> <p>\u4f7f\u7528fastthread\u81ea\u52a8\u68c0\u6d4b\u7ebf\u7a0b\u95ee\u9898\u3002 </p> <p>Tip</p> <p>Fastthread\u548cGceasy\u7c7b\u4f3c\uff0c\u662f\u4e00\u6b3e\u5728\u7ebf\u7684AI\u81ea\u52a8\u7ebf\u7a0b\u95ee\u9898\u68c0\u6d4b\u5de5\u5177\uff0c\u53ef\u4ee5\u63d0\u4f9b\u7ebf\u7a0b\u5206\u6790\u62a5\u544a\u3002\u901a\u8fc7\u62a5\u544a\u67e5\u770b\u662f\u5426\u5b58\u5728\u6b7b\u9501\u95ee\u9898\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#jmh","title":"JMH","text":"<p>\u95ee\uff1a\u4f60\u662f\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u65b9\u6cd5\u9700\u8981\u8017\u65f6\u591a\u5c11\u65f6\u95f4\u7684\uff1f</p> <p>\u7b54\uff1a\u6211\u4f1a\u5728\u65b9\u6cd5\u4e0a\u6253\u5370\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\uff0c\u4ed6\u4eec\u7684\u5dee\u503c\u5c31\u662f\u65b9\u6cd5\u7684\u6267\u884c\u8017\u65f6\u3002\u624b\u52a8\u901a\u8fc7postman\u6216\u8005jmeter\u53d1\u8d77\u8bf7\u6c42\uff0c\u5728\u63a7\u5236\u53f0\u4e0a\u770b\u8f93\u51fa\u7684\u65f6\u95f4\u3002</p> <p>\u6ce8\u610f</p> <p>\u8fd9\u6837\u505a\u662f\u4e0d\u51c6\u786e\u7684</p> <p>\u7b2c\u4e00\u6d4b\u8bd5\u65f6\u6709\u4e9b\u5bf9\u8c61\u521b\u5efa\u662f\u61d2\u52a0\u8f7d\u7684\uff0c\u6240\u4ee5\u4f1a\u5f71\u54cd\u7b2c\u4e00\u6b21\u7684\u8bf7\u6c42\u65f6\u95f4</p> <p>\u7b2c\u4e8c\u865a\u62df\u673a\u4e2dJIT\u5373\u65f6\u7f16\u8bd1\u5668\u4f1a\u4f18\u5316\u4f60\u7684\u4ee3\u7801</p> <p>\u6240\u4ee5\u8fd9\u4e2a\u6d4b\u8bd5\u5f97\u51fa\u7684\u65f6\u95f4\u5e76\u4e0d\u4e00\u5b9a\u662f\u6700\u7ec8\u7528\u6237\u5904\u7406\u7684\u65f6\u95f4\u3002</p> <p>Java\u7a0b\u5e8f\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0cJIT\u5373\u65f6\u7f16\u8bd1\u5668\u4f1a\u5b9e\u65f6\u5bf9\u4ee3\u7801\u8fdb\u884c\u6027\u80fd\u4f18\u5316\uff0c\u6240\u4ee5\u4ec5\u51ed\u5c11\u91cf\u7684\u6d4b\u8bd5\u662f\u65e0\u6cd5\u771f\u5b9e\u53cd\u5e94\u8fd0\u884c\u7cfb\u7edf\u6700\u7ec8\u7ed9\u7528\u6237\u63d0\u4f9b\u7684\u6027\u80fd\u3002</p> <p>OpenJDK\u4e2d\u63d0\u4f9b\u4e86\u4e00\u6b3e\u53eb<code>JMH</code>\uff08Java Microbenchmark Harness\uff09\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u51c6\u786e\u5730\u5bf9Java\u4ee3\u7801\u8fdb\u884c\u57fa\u51c6\u6d4b\u8bd5\uff0c\u91cf\u5316\u65b9\u6cd5\u7684\u6267\u884c\u6027\u80fd\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1a JMH</p> <p>JMH\u4f1a\u9996\u5148\u6267\u884c\u9884\u70ed\u8fc7\u7a0b\uff0c\u786e\u4fddJIT\u5bf9\u4ee3\u7801\u8fdb\u884c\u4f18\u5316\u4e4b\u540e\u518d\u8fdb\u884c\u771f\u6b63\u7684\u8fed\u4ee3\u6d4b\u8bd5\uff0c\u6700\u540e\u8f93\u51fa\u6d4b\u8bd5\u7684\u7ed3\u679c\u3002</p> <p>JMH\u73af\u5883\u642d\u5efa\uff1a</p> <ol> <li>\u521b\u5efa\u57fa\u51c6\u6d4b\u8bd5\u9879\u76ee\uff0c\u5728CMD\u7a97\u53e3\u4e2d\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efaJMH\u73af\u5883\u9879\u76ee\uff1a</li> </ol> <pre><code> mvn archetype:generate \\\n -DinteractiveMode=false \\\n -DarchetypeGroupId=org.openjdk.jmh \\\n -DarchetypeArtifactId=jmh-java-benchmark-archetype \\\n -DgroupId=org.sample \\\n -DartifactId=test \\\n -Dversion=1.0\n</code></pre> <ol> <li> <p>\u4fee\u6539POM\u6587\u4ef6\u4e2d\u7684JDK\u7248\u672c\u53f7\u548cJMH\u7248\u672c\u53f7\uff0cJMH\u6700\u65b0\u7248\u672c\u53f7\u53c2\u8003Github\u3002</p> </li> <li> <p>\u7f16\u5199\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u51e0\u4e2a\u9700\u8981\u6ce8\u610f\u7684\u70b9\uff1a</p> <ul> <li> <p>\u6b7b\u4ee3\u7801\u95ee\u9898\uff08\u65e0\u7528\u4ee3\u7801\uff0cJIT\u4f1a\u8df3\u8fc7\u4e0d\u6267\u884c\uff09</p> </li> <li> <p>\u9ed1\u6d1e\u7684\u7528\u6cd5\uff08\u9ed1\u6d1e\u6d88\u8d39\uff0c\u907f\u514d\u6b7b\u4ee3\u7801\u4ea7\u751f\uff09</p> </li> </ul> </li> <li> <p>\u901a\u8fc7maven\u7684verify\u547d\u4ee4\uff0c\u68c0\u6d4b\u4ee3\u7801\u95ee\u9898\u5e76\u6253\u5305\u6210jar\u5305\u3002</p> </li> <li> <p>\u901a\u8fc7<code>java -jar target/benchmarks.jar</code> \u547d\u4ee4\u6267\u884c\u57fa\u51c6\u6d4b\u8bd5\u3002</p> </li> <li> <p>\u6d4b\u8bd5\u7ed3\u679c\u901a\u8fc7 https://jmh.morethan.io/ \u751f\u6210\u53ef\u89c6\u5316\u7684\u7ed3\u679c\u3002</p> </li> </ol> <p></p> <p>\u6848\u4f8b \uff1a\u65e5\u671f\u683c\u5f0f\u5316\u65b9\u6cd5\u6027\u80fd\u6d4b\u8bd5</p> <ol> <li> <p>Date\u5bf9\u8c61\u4f7f\u7528\u7684SimpleDateFormatter\u662f\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u9700\u8981\u91cd\u65b0\u521b\u5efa\u5bf9\u8c61\u6216\u8005\u5c06\u5bf9\u8c61\u653e\u5165ThreadLocal\u4e2d\u8fdb\u884c\u4fdd\u5b58\u3002\u5176\u4e2d\u6bcf\u6b21\u91cd\u65b0\u521b\u5efa\u5bf9\u8c61\u6027\u80fd\u6bd4\u8f83\u5dee\uff0c\u5c06\u5bf9\u8c61\u653e\u5165ThreadLocal\u4e4b\u540e\u6027\u80fd\u76f8\u5bf9\u8fd8\u662f\u6bd4\u8f83\u597d\u7684\u3002</p> </li> <li> <p>LocalDateTime\u5bf9\u8c61\u4f7f\u7528\u7684DateTimeFormatter\u7ebf\u7a0b\u5b89\u5168\uff0c\u5e76\u4e14\u6027\u80fd\u8f83\u597d\uff0c\u5982\u679c\u80fd\u5c06DateTimeFormatter\u5bf9\u8c61\u4fdd\u5b58\u4e0b\u6765\uff0c\u6027\u80fd\u53ef\u4ee5\u5f97\u5230\u8fdb\u4e00\u6b65\u7684\u63d0\u5347\u3002</p> </li> </ol>"},{"location":"JVM/JVM-practice/#\u7efc\u5408\u6848\u4f8b","title":"\u7efc\u5408\u6848\u4f8b","text":"<p>\u5c0f\u674e\u7684\u9879\u76ee\u4e2d\u6709\u4e00\u4e2a\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u63a5\u53e3\u6027\u80fd\u6bd4\u8f83\u5dee\uff0c\u4ed6\u5e0c\u671b\u80fd\u5bf9\u8fd9\u4e2a\u63a5\u53e3\u5728\u4ee3\u7801\u4e2d\u8fdb\u884c\u5f7b\u5e95\u7684\u4f18\u5316\uff0c\u63d0\u5347\u6027\u80fd\u3002</p> <p>\u63a5\u53e3\u4ee3\u7801\u4f18\u5316\u8fc7\u7a0b\u5982\u4e0b\uff08\u9996\u5148\u9700\u8981\u4f7f\u7528arthas\u627e\u5230\u63a5\u53e3\u8017\u65f6\u957f\u7684\u539f\u56e0\uff09\uff1a</p> <pre><code>//\u521d\u59cb\u4ee3\u7801\npublic List&lt;UserVO&gt; user1(){\n    //1.\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u524d\u7aef\u9700\u8981\u7684\u8be6\u60c5\u6570\u636e\n    List&lt;UserDetails&gt; userDetails = userService.getUserDetails();\n\n    //2.\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684\u7528\u6237\u6570\u636e\n    List&lt;User&gt; users = userService.getUsers();\n\n    SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n    //3.\u904d\u5386\u8be6\u60c5\u96c6\u5408\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7528\u6237\u540d\uff0c\u751f\u6210VO\u8fdb\u884c\u586b\u5145\n    ArrayList&lt;UserVO&gt; userVOS = new ArrayList&lt;&gt;();\n    for (UserDetails userDetail : userDetails) {\n        UserVO userVO = new UserVO();\n        //\u53ef\u4ee5\u4f7f\u7528BeanUtils\u5bf9\u8c61\u62f7\u8d1d\n        userVO.setId(userDetail.getId());\n        userVO.setRegister(simpleDateFormat.format(userDetail.getRegister2()));\n        //\u586b\u5145name\n        for (User user : users) {\n            if(user.getId().equals(userDetail.getId())){\n                userVO.setName(user.getName());\n            }\n        }\n        //\u52a0\u5165\u96c6\u5408\n        userVOS.add(userVO);\n    }\n\n    return userVOS;\n\n}\n\n\n//\u4f7f\u7528HasmMap\u5b58\u653e\u7528\u6237\u540d\u5b57\npublic List&lt;UserVO&gt; user2(){\n    //1.\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u524d\u7aef\u9700\u8981\u7684\u8be6\u60c5\u6570\u636e\n    List&lt;UserDetails&gt; userDetails = userService.getUserDetails();\n\n    //2.\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684\u7528\u6237\u6570\u636e\n    List&lt;User&gt; users = userService.getUsers();\n    //\u5c06list\u8f6c\u6362\u6210hashmap\n    HashMap&lt;Long, User&gt; map = new HashMap&lt;&gt;();\n    for (User user : users) {\n        map.put(user.getId(),user);\n    }\n\n    SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n    //3.\u904d\u5386\u8be6\u60c5\u96c6\u5408\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7528\u6237\u540d\uff0c\u751f\u6210VO\u8fdb\u884c\u586b\u5145\n    ArrayList&lt;UserVO&gt; userVOS = new ArrayList&lt;&gt;();\n    for (UserDetails userDetail : userDetails) {\n        UserVO userVO = new UserVO();\n        //\u53ef\u4ee5\u4f7f\u7528BeanUtils\u5bf9\u8c61\u62f7\u8d1d\n        userVO.setId(userDetail.getId());\n        userVO.setRegister(simpleDateFormat.format(userDetail.getRegister2()));\n        //\u586b\u5145name\n        userVO.setName(map.get(userDetail.getId()).getName());\n        //\u52a0\u5165\u96c6\u5408\n        userVOS.add(userVO);\n    }\n\n    return userVOS;\n\n}\n\n\n//\u4f18\u5316\u65e5\u671f\u683c\u5f0f\u5316\npublic List&lt;UserVO&gt; user3(){\n    //1.\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u524d\u7aef\u9700\u8981\u7684\u8be6\u60c5\u6570\u636e\n    List&lt;UserDetails&gt; userDetails = userService.getUserDetails();\n\n    //2.\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684\u7528\u6237\u6570\u636e\n    List&lt;User&gt; users = userService.getUsers();\n    //\u5c06list\u8f6c\u6362\u6210hashmap\n    HashMap&lt;Long, User&gt; map = new HashMap&lt;&gt;();\n    for (User user : users) {\n        map.put(user.getId(),user);\n    }\n\n    //3.\u904d\u5386\u8be6\u60c5\u96c6\u5408\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7528\u6237\u540d\uff0c\u751f\u6210VO\u8fdb\u884c\u586b\u5145\n    ArrayList&lt;UserVO&gt; userVOS = new ArrayList&lt;&gt;();\n    for (UserDetails userDetail : userDetails) {\n        UserVO userVO = new UserVO();\n        //\u53ef\u4ee5\u4f7f\u7528BeanUtils\u5bf9\u8c61\u62f7\u8d1d\n        userVO.setId(userDetail.getId());\n        userVO.setRegister(userDetail.getRegister().format(formatter));\n        //\u586b\u5145name\n        userVO.setName(map.get(userDetail.getId()).getName());\n        //\u52a0\u5165\u96c6\u5408\n        userVOS.add(userVO);\n    }\n\n    return userVOS;\n\n}\n\n\n//\u4f7f\u7528stream\u6d41\u6539\u5199for\u5faa\u73af\npublic List&lt;UserVO&gt; user4(){\n    //1.\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u524d\u7aef\u9700\u8981\u7684\u8be6\u60c5\u6570\u636e\n    List&lt;UserDetails&gt; userDetails = userService.getUserDetails();\n\n    //2.\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684\u7528\u6237\u6570\u636e\n    List&lt;User&gt; users = userService.getUsers();\n    //\u5c06list\u8f6c\u6362\u6210hashmap\n    Map&lt;Long, User&gt; map = users.stream().collect(Collectors.toMap(User::getId, o -&gt; o));\n\n    //3.\u904d\u5386\u8be6\u60c5\u96c6\u5408\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7528\u6237\u540d\uff0c\u751f\u6210VO\u8fdb\u884c\u586b\u5145\n    return userDetails.stream().map(userDetail -&gt; {\n        UserVO userVO = new UserVO();\n        //\u53ef\u4ee5\u4f7f\u7528BeanUtils\u5bf9\u8c61\u62f7\u8d1d\n        userVO.setId(userDetail.getId());\n        userVO.setRegister(userDetail.getRegister().format(formatter));\n        //\u586b\u5145name\n        userVO.setName(map.get(userDetail.getId()).getName());\n        return userVO;\n    }).collect(Collectors.toList());\n\n}\n\n//\u4f7f\u7528\u5e76\u884c\u6d41\u4f18\u5316\u6027\u80fd\npublic List&lt;UserVO&gt; user5(){\n    //1.\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u524d\u7aef\u9700\u8981\u7684\u8be6\u60c5\u6570\u636e\n    List&lt;UserDetails&gt; userDetails = userService.getUserDetails();\n\n    //2.\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684\u7528\u6237\u6570\u636e\n    List&lt;User&gt; users = userService.getUsers();\n    //\u5c06list\u8f6c\u6362\u6210hashmap\n    Map&lt;Long, User&gt; map = users.parallelStream().collect(Collectors.toMap(User::getId, o -&gt; o));\n\n    //3.\u904d\u5386\u8be6\u60c5\u96c6\u5408\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7528\u6237\u540d\uff0c\u751f\u6210VO\u8fdb\u884c\u586b\u5145\n    return userDetails.parallelStream().map(userDetail -&gt; {\n        UserVO userVO = new UserVO();\n        //\u53ef\u4ee5\u4f7f\u7528BeanUtils\u5bf9\u8c61\u62f7\u8d1d\n        userVO.setId(userDetail.getId());\n        userVO.setRegister(userDetail.getRegister().format(formatter));\n        //\u586b\u5145name\n        userVO.setName(map.get(userDetail.getId()).getName());\n        return userVO;\n    }).collect(Collectors.toList());\n\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u7b80\u5355\u7684\u904d\u5386\u64cd\u4f5c\uff0c\u4f20\u7edf\u7684 for \u5faa\u73af\u6027\u80fd\u901a\u5e38\u66f4\u597d\uff08\u5c24\u5176\u662f\u5728\u6570\u636e\u91cf\u5c0f\u7684\u60c5\u51b5\u4e0b\uff09\u3002</p> <p>\u4f46 Stream \u7684\u771f\u6b63\u4f18\u52bf\u4e0d\u5728\u4e8e\u6781\u81f4\u7684\u5fae\u79d2\u7ea7\u6027\u80fd\uff0c\u800c\u5728\u4e8e\u66f4\u9ad8\u7684\u62bd\u8c61\u5c42\u6b21\u3001\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\uff0c\u4ee5\u53ca\u5728\u5904\u7406\u590d\u6742\u6570\u636e\u64cd\u4f5c\u548c\u5e76\u884c\u5316\u65b9\u9762\u7684\u5de8\u5927\u6f5c\u529b\u3002</p> <p>\u4e0a\u4e00\u8282\uff1a JVM\u57fa\u7840</p>"},{"location":"JVM/JVM-principle/","title":"JVM\u539f\u7406","text":""},{"location":"JVM/JVM-principle/#\u6808\u4e0a\u7684\u6570\u636e\u5b58\u50a8","title":"\u6808\u4e0a\u7684\u6570\u636e\u5b58\u50a8","text":""},{"location":"JVM/JVM-principle/#java\u865a\u62df\u673a\u4e2d\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b","title":"Java\u865a\u62df\u673a\u4e2d\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b","text":""},{"location":"JVM/JVM-principle/#java\u4e2d\u76848\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b","title":"Java\u4e2d\u76848\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b","text":"\u6570\u636e\u7c7b\u578b \u5185\u5b58\u5360\u7528(\u5b57\u8282\u6570) \u6570\u636e\u8303\u56f4 \u6574\u578b byte 1 -128~127 short 2 -32768~32767 int(\u9ed8\u8ba4) 4 -2147483648~2147483647 (10\u4f4d\u6570\uff0c\u5927\u698221\u4ebf\u591a) long 8 -9223372036854775808 ~ 9223372036854775807 (19\u4f4d\u6570) \u6d6e\u70b9\u578b(\u5c0f\u6570) float 4 1.401298 E -45 \u5230 3.402835 E +38 double(\u9ed8\u8ba4) 8 4.9000000 E -324 \u52301.797693 E +308 \u5b57\u7b26\u578b char 2 0-65535 \u5e03\u5c14\u578b boolean 1 true, false <p>\u91cd\u8981\u8bf4\u660e</p> <ul> <li>int \u662f\u6574\u578b\u7684\u9ed8\u8ba4\u7c7b\u578b</li> <li>double \u662f\u6d6e\u70b9\u578b\u7684\u9ed8\u8ba4\u7c7b\u578b</li> <li>\u8fd9\u91cc\u7684\u5185\u5b58\u5360\u7528\uff0c\u6307\u7684\u662f\u5806\u4e0a\u6216\u8005\u6570\u7ec4\u4e2d\u5185\u5b58\u5206\u914d\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u6808\u4e0a\u7684\u5b9e\u73b0\u66f4\u52a0\u590d\u6742</li> </ul> <p>\u6570\u636e\u7c7b\u578b\u9009\u62e9\u5efa\u8bae</p> <ul> <li>\u6574\u6570\u8fd0\u7b97\uff1a\u4f18\u5148\u4f7f\u7528 <code>int</code>\uff0c\u8d85\u51fa\u8303\u56f4\u65f6\u4f7f\u7528 <code>long</code></li> <li>\u5c0f\u6570\u8fd0\u7b97\uff1a\u4f18\u5148\u4f7f\u7528 <code>double</code>\uff0c\u5185\u5b58\u654f\u611f\u65f6\u8003\u8651 <code>float</code></li> <li>\u5b57\u7b26\u5b58\u50a8\uff1a\u4f7f\u7528 <code>char</code> \u5b58\u50a8\u5355\u4e2a\u5b57\u7b26\uff08\u652f\u6301Unicode\uff09</li> <li>\u903b\u8f91\u5224\u65ad\uff1a\u4f7f\u7528 <code>boolean</code> \u5b58\u50a8\u771f\u5047\u503c</li> </ul> <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li><code>byte</code> \u548c <code>short</code> \u5728\u8fd0\u7b97\u65f6\u4f1a\u81ea\u52a8\u63d0\u5347\u4e3a <code>int</code> \u7c7b\u578b</li> <li><code>float</code> \u7c7b\u578b\u7684\u5b57\u9762\u91cf\u9700\u8981\u52a0 <code>f</code> \u540e\u7f00\uff0c\u5982 <code>3.14f</code></li> <li><code>long</code> \u7c7b\u578b\u7684\u5b57\u9762\u91cf\u5efa\u8bae\u52a0 <code>L</code> \u540e\u7f00\uff0c\u5982 <code>123456789L</code></li> <li><code>char</code> \u7c7b\u578b\u53ef\u4ee5\u53c2\u4e0e\u6570\u5b66\u8fd0\u7b97\uff0c\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684ASCII\u503c</li> </ul>"},{"location":"JVM/JVM-principle/#java\u4e2d\u76848\u5927\u6570\u636e\u7c7b\u578b\u5728\u865a\u62df\u673a\u4e2d\u7684\u5b9e\u73b0","title":"Java\u4e2d\u76848\u5927\u6570\u636e\u7c7b\u578b\u5728\u865a\u62df\u673a\u4e2d\u7684\u5b9e\u73b0","text":"\u6570\u636e\u7c7b\u578b \u5806\u5185\u5b58\u5360\u7528(\u5b57\u8282\u6570) \u6808\u4e2dslot\u6570 \u865a\u62df\u673a\u5185\u90e8\u7b26\u53f7 byte 1 1 B short 2 1 S int 4 1 I long 8 2 J float 4 1 F double 8 2 D char 2 1 C boolean 1 1 Z <p>\u865a\u62df\u673a\u5b9e\u73b0\u7ec6\u8282</p> <ul> <li>\u5806\u5185\u5b58\u5360\u7528\uff1a\u5bf9\u8c61\u5728\u5806\u4e2d\u5b58\u50a8\u65f6\u5360\u7528\u7684\u5b57\u8282\u6570</li> <li>\u6808\u4e2dslot\u6570\uff1a\u5728\u6808\u5e27\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\u5360\u7528\u7684slot\u69fd\u4f4d\u6570\u91cf</li> <li>\u865a\u62df\u673a\u5185\u90e8\u7b26\u53f7\uff1aJVM\u5185\u90e8\u7528\u4e8e\u6807\u8bc6\u6570\u636e\u7c7b\u578b\u7684\u5355\u5b57\u7b26\u7b26\u53f7</li> </ul> <p>\u5173\u952e\u7279\u70b9</p> <ul> <li><code>long</code> \u548c <code>double</code> \u7c7b\u578b\u5360\u7528 2\u4e2aslot\uff0c\u5176\u4ed6\u7c7b\u578b\u90fd\u5360\u7528 1\u4e2aslot</li> <li>slot\u662fJVM\u6808\u5e27\u4e2d\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u57fa\u672c\u5b58\u50a8\u5355\u4f4d</li> <li>\u865a\u62df\u673a\u5185\u90e8\u7b26\u53f7\u7528\u4e8e\u5b57\u8282\u7801\u6307\u4ee4\u548c\u7c7b\u578b\u63cf\u8ff0\u7b26\u4e2d</li> </ul> <p>\u5b9e\u9645\u5e94\u7528</p> <p>\u5728\u5b57\u8282\u7801\u6307\u4ee4\u4e2d\u7684\u4f53\u73b0\uff1a</p> <ul> <li><code>iload</code>: \u52a0\u8f7dint\u7c7b\u578b\u6570\u636e (I)</li> <li><code>lload</code>: \u52a0\u8f7dlong\u7c7b\u578b\u6570\u636e (J) </li> <li><code>fload</code>: \u52a0\u8f7dfloat\u7c7b\u578b\u6570\u636e (F)</li> <li><code>dload</code>: \u52a0\u8f7ddouble\u7c7b\u578b\u6570\u636e (D)</li> <li><code>aload</code>: \u52a0\u8f7d\u5f15\u7528\u7c7b\u578b\u6570\u636e (A)</li> </ul> <p>\u5728\u65b9\u6cd5\u63cf\u8ff0\u7b26\u4e2d\u7684\u4f7f\u7528\uff1a</p> <ul> <li><code>(IJ)D</code>: \u53c2\u6570\u4e3aint\u548clong\uff0c\u8fd4\u56dedouble</li> <li><code>([B)V</code>: \u53c2\u6570\u4e3abyte\u6570\u7ec4\uff0c\u65e0\u8fd4\u56de\u503c</li> <li><code>(ZC)Z</code>: \u53c2\u6570\u4e3aboolean\u548cchar\uff0c\u8fd4\u56deboolean</li> </ul> <p>\u6027\u80fd\u8003\u8651</p> <ul> <li><code>long</code> \u548c <code>double</code> \u572832\u4f4d\u7cfb\u7edf\u4e0a\u7684\u64cd\u4f5c\u4e0d\u662f\u539f\u5b50\u7684</li> <li>\u5360\u75282\u4e2aslot\u7684\u7c7b\u578b\u5728\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\u9700\u8981\u8fde\u7eed\u7684\u4e24\u4e2a\u4f4d\u7f6e</li> <li>\u5728\u5e76\u53d1\u73af\u5883\u4e0b\uff0c\u5bf964\u4f4d\u6570\u636e\u7c7b\u578b\u7684\u8bfb\u5199\u9700\u8981\u7279\u522b\u6ce8\u610f\u7ebf\u7a0b\u5b89\u5168</li> </ul> <p>boolean\u3001byte\u3001char\u3001short\u5728\u6808\u4e0a\u662f\u4e0d\u662f\u5b58\u5728\u7a7a\u95f4\u6d6a\u8d39\uff1f</p> <p>\u662f\u7684\uff0cJava\u865a\u62df\u673a\u91c7\u7528\u7684\u662f\u7a7a\u95f4\u6362\u65f6\u95f4\u65b9\u6848\uff0c\u5728\u6808\u4e0a\u4e0d\u5b58\u50a8\u5177\u4f53\u7684\u7c7b\u578b\uff0c\u53ea\u6839\u636eslot\u69fd\u8fdb\u884c\u6570\u636e\u7684\u5904\u7406\uff0c\u6d6a\u8d39\u4e86\u4e00\u4e9b\u5185\u5b58\u7a7a\u95f4\u4f46\u662f\u907f\u514d\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u4e0d\u540c\u5904\u7406\u65b9\u5f0f\u5e26\u6765\u7684\u65f6\u95f4\u5f00\u9500\u3002</p> <p>\u540c\u65f6\uff0c\u50cflong\u578b\u572864\u4f4d\u7cfb\u7edf\u4e2d\u5360\u75282\u4e2aslot\uff0c\u4f7f\u7528\u4e8616\u5b57\u8282\u7a7a\u95f4\uff0c\u4f46\u5b9e\u9645\u4e0a\u5728Hotspot\u865a\u62df\u673a\u4e2d\uff0c\u5b83\u7684\u9ad88\u4e2a\u5b57\u8282\u6ca1\u6709\u4f7f\u7528\uff0c\u8fd9\u6837\u5c31\u6ee1\u8db3\u4e86long\u578b\u4f7f\u75288\u4e2a\u5b57\u8282\u7684\u9700\u8981\u3002</p> <p>32\u4f4d\u673a\u5668\uff1a1\u4e2a\u69fd4\u5b57\u8282</p> <p>64\u4f4d\u673a\u5668\uff1a1\u4e2a\u69fd8\u5b57\u8282</p> <p></p>"},{"location":"JVM/JVM-principle/#boolean\u5728\u6808\u4e0a\u7684\u5b58\u50a8\u65b9\u5f0f","title":"boolean\u5728\u6808\u4e0a\u7684\u5b58\u50a8\u65b9\u5f0f","text":"<p>\u5728Java\u865a\u62df\u673a\u4e2d\u6808\u4e0aboolean\u7c7b\u578b\u4fdd\u5b58\u65b9\u5f0f\u4e0eint\u7c7b\u578b\u76f8\u540c\uff0c\u6240\u4ee5\u5b83\u7684\u503c\u5982\u679c\u662f1\u4ee3\u8868true\uff0c\u5982\u679c\u662f0\u4ee3\u8868false\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u8ba9\u5b83\u7684\u503c\u8d85\u8fc71\u3002</p> <p>\u6808\u4e2d\u7684\u6570\u636e\u8981\u4fdd\u5b58\u5230\u5806\u4e0a\u6216\u8005\u4ece\u5806\u4e2d\u52a0\u8f7d\u5230\u6808\u4e0a\u65f6\u600e\u4e48\u5904\u7406\uff1f</p> <ol> <li> <p>\u5806\u4e2d\u7684\u6570\u636e\u52a0\u8f7d\u5230\u6808\u4e0a\uff0c\u7531\u4e8e\u6808\u4e0a\u7684\u7a7a\u95f4\u5927\u4e8e\u6216\u8005\u7b49\u4e8e\u5806\u4e0a\u7684\u7a7a\u95f4\uff0c\u6240\u4ee5\u76f4\u63a5\u5904\u7406\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7b26\u53f7\u4f4d\u3002</p> <ul> <li> <p>boolean\u3001char\u4e3a\u65e0\u7b26\u53f7\uff0c\u4f4e\u4f4d\u590d\u5236\uff0c\u9ad8\u4f4d\u88650</p> </li> <li> <p>byte\u3001short\u4e3a\u6709\u7b26\u53f7\uff0c\u4f4e\u4f4d\u590d\u5236\uff0c\u9ad8\u4f4d\u975e\u8d1f\u5219\u88650\uff0c\u8d1f\u5219\u88651</p> </li> </ul> </li> <li> <p>\u6808\u4e2d\u7684\u6570\u636e\u8981\u4fdd\u5b58\u5230\u5806\u4e0a\uff0cbyte\u3001char\u3001short\u7531\u4e8e\u5806\u4e0a\u5b58\u50a8\u7a7a\u95f4\u8f83\u5c0f\uff0c\u9700\u8981\u5c06\u9ad8\u4f4d\u53bb\u6389\u3002boolean\u6bd4\u8f83\u7279\u6b8a\uff0c\u53ea\u53d6\u4f4e\u4f4d\u7684\u6700\u540e\u4e00\u4f4d\u4fdd\u5b58\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u5bf9\u8c61\u5728\u5806\u4e0a\u662f\u5982\u4f55\u5b58\u50a8\u7684","title":"\u5bf9\u8c61\u5728\u5806\u4e0a\u662f\u5982\u4f55\u5b58\u50a8\u7684","text":""},{"location":"JVM/JVM-principle/#\u5bf9\u8c61\u5728\u5806\u4e2d\u7684\u5185\u5b58\u5e03\u5c40","title":"\u5bf9\u8c61\u5728\u5806\u4e2d\u7684\u5185\u5b58\u5e03\u5c40","text":""},{"location":"JVM/JVM-principle/#\u6807\u8bb0\u5b57\u6bb5","title":"\u6807\u8bb0\u5b57\u6bb5","text":"<p>JOL</p> <p>JOL\u662f\u7528\u4e8e\u5206\u6790 JVM \u4e2d\u5bf9\u8c61\u5e03\u5c40\u7684\u4e00\u6b3e\u4e13\u4e1a\u5de5\u5177\u3002\u5de5\u5177\u4e2d\u4f7f\u7528 Unsafe\u3001JVMTI \u548c Serviceability Agent (SA)\u7b49\u865a\u62df\u673a\u6280\u672f\u6765\u6253\u5370\u5b9e\u9645\u7684\u5bf9\u8c61\u5185\u5b58\u5e03\u5c40\u3002</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;\n    &lt;artifactId&gt;jol-core&lt;/artifactId&gt;\n    &lt;version&gt;0.9&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>System.out.println(ClassLayout.parseInstance(\u5bf9\u8c61).toPrintable());\n</code></pre>"},{"location":"JVM/JVM-principle/#\u6307\u9488\u538b\u7f29","title":"\u6307\u9488\u538b\u7f29","text":"<p>\u572864\u4f4d\u7684Java\u865a\u62df\u673a\u4e2d\uff0cKlass Pointer\u4ee5\u53ca\u5bf9\u8c61\u6570\u636e\u4e2d\u7684\u5bf9\u8c61\u5f15\u7528\u90fd\u9700\u8981\u5360\u75288\u4e2a\u5b57\u8282\uff0c\u4e3a\u4e86\u51cf\u5c11\u8fd9\u90e8\u5206\u7684\u5185\u5b58\u4f7f\u7528\u91cf\uff0c64 \u4f4d Java \u865a\u62df\u673a\u4f7f\u7528\u6307\u9488\u538b\u7f29\u6280\u672f\uff0c\u5c06\u5806\u4e2d\u539f\u672c 8\u4e2a\u5b57\u8282\u7684 \u6307\u9488\u538b\u7f29\u6210 4\u4e2a\u5b57\u8282\uff0c\u6b64\u529f\u80fd\u9ed8\u8ba4\u5f00\u542f\uff0c\u53ef\u4ee5\u4f7f\u7528<code>-XX:-UseCompressedOops</code>\u5173\u95ed\u3002</p> <p>\u6307\u9488\u538b\u7f29\u7684\u601d\u60f3\u662f\u5c06\u5bfb\u5740\u7684\u5355\u4f4d\u653e\u5927\uff0c\u6bd4\u5982\u539f\u6765\u63091\u5b57\u8282\u53bb\u5bfb\u5740\uff0c\u73b0\u5728\u53ef\u4ee5\u63098\u5b57\u8282\u5bfb\u5740\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u539f\u6765\u63091\u53bb\u5bfb\u5740\uff0c\u80fd\u62ff\u52301\u5b57\u8282\u5f00\u59cb\u7684\u6570\u636e\uff0c\u73b0\u5728\u63091\u53bb\u5bfb\u5740\uff0c\u5c31\u53ef\u4ee5\u62ff\u52308\u4e2a\u5b57\u8282\u5f00\u59cb\u7684\u6570\u636e\u3002</p> <p></p> <p>\u8fd9\u6837\u5c06\u7f16\u53f7\u5f53\u6210\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u7528\u66f4\u5c0f\u7684\u5185\u5b58\u8bbf\u95ee\u66f4\u591a\u7684\u6570\u636e\u3002\u4f46\u662f\u8fd9\u6837\u7684\u505a\u6cd5\u6709\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li> <p>\u9700\u8981\u8fdb\u884c\u5185\u5b58\u5bf9\u9f50\uff0c\u6307\u5c06\u5bf9\u8c61\u7684\u5185\u5b58\u5360\u7528\u586b\u5145\u81f38\u5b57\u8282\u7684\u500d\u6570\u3002\u5b58\u5728\u7a7a\u95f4\u6d6a\u8d39\uff08\u5bf9\u4e8eHotspot\u6765\u8bf4\u4e0d\u5b58\u5728\uff0c\u5373\u4fbf\u4e0d\u5f00\u542f\u6307\u9488\u538b\u7f29\uff0c\u4e5f\u9700\u8981\u8fdb\u884c\u5185\u5b58\u5bf9\u9f50\uff09</p> </li> <li> <p>\u5bfb\u5740\u5927\u5c0f\u4ec5\u4ec5\u80fd\u652f\u63012\u768435 \u6b21\u65b9\u4e2a\u5b57\u8282\uff0832GB\uff0c\u5982\u679c\u8d85\u8fc732GB\u6307\u9488\u538b\u7f29\u4f1a\u81ea\u52a8\u5173\u95ed\uff09\u3002\u4e0d\u7528\u538b\u7f29\u6307\u9488\uff0c\u5e94\u8be5\u662f2\u768464\u6b21\u65b9 = 16EB\uff0c\u7528\u4e86\u538b\u7f29\u6307\u9488\u5c31\u53d8\u6210\u4e868\uff08\u5b57\u8282\uff09 = 2\u76843\u6b21\u65b9 * 2\u768432\u6b21\u65b9 = 2\u768435\u6b21\u65b9</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u5185\u5b58\u5bf9\u9f50","title":"\u5185\u5b58\u5bf9\u9f50","text":"<p>\u5185\u5b58\u5bf9\u9f50\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u5e76\u53d1\u60c5\u51b5\u4e0bCPU\u7f13\u5b58\u5931\u6548\u7684\u95ee\u9898\uff1a\u7ebf\u7a0bA\u4fee\u6539A\u4f1a\u5f71\u54cd\u7ebf\u7a0bB\u5bf9B\u7684\u64cd\u4f5c</p> <p></p> <p>\u5185\u5b58\u5bf9\u9f50\u4e4b\u540e\uff0c\u540c\u4e00\u4e2a\u7f13\u5b58\u884c\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u4e0d\u540c\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u5728\u5e76\u53d1\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8ba9A\u5bf9\u8c61\u4e00\u4e2a\u7f13\u5b58\u884c\u5931\u6548\uff0c\u662f\u4e0d\u4f1a\u5f71\u54cd\u5230B\u5bf9\u8c61\u7684\u7f13\u5b58\u884c\u7684\u3002</p> <p>\u5b57\u6bb5\u91cd\u6392\u5217:</p> <p>\u5728Hotspot\u4e2d\uff0c\u8981\u6c42\u6bcf\u4e2a\u5c5e\u6027\u7684\u504f\u79fb\u91cfOffset\uff08\u5b57\u6bb5\u5730\u5740 \u2013 \u8d77\u59cb\u5730\u5740\uff09\u5fc5\u987b\u662f\u5b57\u6bb5\u957f\u5ea6\u7684N\u500d\u3002</p> <p>\u5982\u679c\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u4f1a\u5c1d\u8bd5\u4f7f\u7528\u5185\u5b58\u5bf9\u9f50\uff0c\u901a\u8fc7\u5728\u5c5e\u6027\u4e4b\u95f4\u63d2\u5165\u4e00\u5757\u5bf9\u9f50\u533a\u57df\u8fbe\u5230\u76ee\u7684\u3002</p> <p>\u5982\u4e0b\u56fe\u4e2d\uff0cname\u5b57\u6bb5\u662f\u5f15\u7528\u5360\u75288\u4e2a\u5b57\u8282\uff08\u5173\u95ed\u4e86\u6307\u9488\u538b\u7f29\uff09\uff0c\u6240\u4ee5Offset\u5fc5\u987b\u662f8\u7684\u500d\u6570\uff0c\u5728age\u548cname\u4e4b\u95f4\u63d2\u5165\u4e864\u4e2a\u5b57\u8282\u7684\u7a7a\u767d\u533a\u57df\u3002</p> <p></p> <p></p>"},{"location":"JVM/JVM-principle/#\u65b9\u6cd5\u8c03\u7528\u7684\u539f\u7406","title":"\u65b9\u6cd5\u8c03\u7528\u7684\u539f\u7406","text":"<p>\u65b9\u6cd5\u8c03\u7528\u7684\u672c\u8d28\u662f\u901a\u8fc7\u5b57\u8282\u7801\u6307\u4ee4\u7684\u6267\u884c\uff0c\u80fd\u5728\u6808\u4e0a\u521b\u5efa\u6808\u5e27\uff0c\u5e76\u6267\u884c\u8c03\u7528\u65b9\u6cd5\u4e2d\u7684\u5b57\u8282\u7801\u6307\u4ee4\u3002\u4ee5invoke\u5f00\u5934\u7684\u5b57\u8282\u7801\u6307\u4ee4\u7684\u4f5c\u7528\u662f\u6267\u884c\u65b9\u6cd5\u7684\u8c03\u7528\u3002</p> <p>\u5728JVM\u4e2d\uff0c\u4e00\u5171\u6709\u4e94\u4e2a\u5b57\u8282\u7801\u6307\u4ee4\u53ef\u4ee5\u6267\u884c\u65b9\u6cd5\u8c03\u7528\uff1a</p> <ol> <li> <p>invokestatic\uff1a\u8c03\u7528\u9759\u6001\u65b9\u6cd5\u3002\u9759\u6001\u7ed1\u5b9a</p> </li> <li> <p>invokespecial: \u8c03\u7528\u5bf9\u8c61\u7684private\u65b9\u6cd5\u3001\u6784\u9020\u65b9\u6cd5\uff0c\u4ee5\u53ca\u4f7f\u7528 super \u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u5b9e\u4f8b\u7684\u65b9\u6cd5\u3001\u6784\u9020\u65b9\u6cd5\uff0c\u4ee5\u53ca\u6240\u5b9e\u73b0\u63a5\u53e3\u7684\u9ed8\u8ba4\u65b9\u6cd5\u3002\u9759\u6001\u7ed1\u5b9a</p> </li> <li> <p>invokevirtual\uff1a\u8c03\u7528\u5bf9\u8c61\u7684\u975eprivate\u65b9\u6cd5\u3002\u975efinal\u65b9\u6cd5\u4f7f\u7528\u52a8\u6001\u7ed1\u5b9a\uff0c\u4f7f\u7528\u865a\u65b9\u6cd5\u8868\u627e\u5230\u65b9\u6cd5\u7684\u5730\u5740\uff0c\u5b50\u7c7b\u4f1a\u590d\u5236\u7236\u7c7b\u7684\u865a\u65b9\u6cd5\u8868\uff0c\u5982\u679c\u5b50\u7c7b\u91cd\u5199\u4e86\u65b9\u6cd5\uff0c\u4f1a\u66ff\u6362\u6210\u91cd\u5199\u540e\u65b9\u6cd5\u7684\u5730\u5740\u3002</p> </li> <li> <p>invokeinterface\uff1a\u8c03\u7528\u63a5\u53e3\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002\u52a8\u6001\u7ed1\u5b9a\uff0c\u4f7f\u7528\u63a5\u53e3\u8868\u627e\u5230\u65b9\u6cd5\u7684\u5730\u5740\uff0c\u8fdb\u884c\u8c03\u7528\u3002</p> </li> <li> <p>invokedynamic\uff1a\u7528\u4e8e\u8c03\u7528\u52a8\u6001\u65b9\u6cd5\uff0c\u4e3b\u8981\u5e94\u7528\u4e8elambda\u8868\u8fbe\u5f0f\u4e2d\uff0c\u673a\u5236\u6781\u4e3a\u590d\u6742\u4e86\u89e3\u5373\u53ef\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u9759\u6001\u7ed1\u5b9a","title":"\u9759\u6001\u7ed1\u5b9a","text":"<ol> <li> <p>\u7f16\u8bd1\u671f\u95f4\uff0cinvoke\u6307\u4ee4\u4f1a\u643a\u5e26\u4e00\u4e2a\u53c2\u6570\u7b26\u53f7\u5f15\u7528\uff0c\u5f15\u7528\u5230\u5e38\u91cf\u6c60\u4e2d\u7684\u65b9\u6cd5\u5b9a\u4e49\u3002\u65b9\u6cd5\u5b9a\u4e49\u4e2d\u5305\u542b\u4e86\u7c7b\u540d + \u65b9\u6cd5\u540d + \u8fd4\u56de\u503c + \u53c2\u6570\u3002</p> </li> <li> <p>\u5728\u65b9\u6cd5\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\uff0c\u8fd9\u4e9b\u7b26\u53f7\u5f15\u7528\u5c31\u4f1a\u88ab\u66ff\u6362\u6210\u5185\u5b58\u5730\u5740\u7684\u76f4\u63a5\u5f15\u7528\uff0c\u8fd9\u79cd\u65b9\u5f0f\u79f0\u4e4b\u4e3a\u9759\u6001\u7ed1\u5b9a\u3002</p> </li> </ol> <p>\u9759\u6001\u7ed1\u5b9a\u9002\u7528\u4e8e\u5904\u7406\u9759\u6001\u65b9\u6cd5\u3001\u79c1\u6709\u65b9\u6cd5\u3001\u6216\u8005\u4f7f\u7528final\u4fee\u9970\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u65b9\u6cd5\u4e0d\u80fd\u88ab\u7ee7\u627f\u4e4b\u540e\u91cd\u5199\u3002</p>"},{"location":"JVM/JVM-principle/#\u52a8\u6001\u7ed1\u5b9a","title":"\u52a8\u6001\u7ed1\u5b9a","text":"<p>\u5bf9\u4e8e\u975estatic\u3001\u975eprivate\u3001\u975efinal\u7684\u65b9\u6cd5\uff0c\u6709\u53ef\u80fd\u5b58\u5728\u5b50\u7c7b\u91cd\u5199\u65b9\u6cd5\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u901a\u8fc7\u52a8\u6001\u7ed1\u5b9a\u6765\u5b8c\u6210\u65b9\u6cd5\u5730\u5740\u7ed1\u5b9a\u7684\u5de5\u4f5c\u3002\u6bd4\u5982\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u8c03\u7528\u7684\u5176\u5b9e\u662fCat\u7c7b\u5bf9\u8c61\u7684eat\u65b9\u6cd5\uff0c\u4f46\u662f\u7f16\u8bd1\u5b8c\u4e4b\u540e\u865a\u62df\u673a\u6307\u4ee4\u4e2d\u8c03\u7528\u7684\u662fAnimal\u7c7b\u7684eat\u65b9\u6cd5\uff0c\u8fd9\u5c31\u9700\u8981\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u52a8\u6001\u7ed1\u5b9a\u627e\u5230Cat\u7c7b\u7684eat\u65b9\u6cd5\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u591a\u6001\u3002</p> <p></p> <p>\u52a8\u6001\u7ed1\u5b9a\u662f\u57fa\u4e8e\u65b9\u6cd5\u8868\u6765\u5b8c\u6210\u7684\uff0cinvokevirtual\u4f7f\u7528\u4e86\u865a\u65b9\u6cd5\u8868\uff08vtable\uff09\uff0cinvokeinterface\u4f7f\u7528\u4e86\u63a5\u53e3\u65b9\u6cd5\u8868(itable)\uff0c\u6574\u4f53\u601d\u8def\u7c7b\u4f3c\u3002\u6240\u4ee5\u63a5\u4e0b\u6765\u4f7f\u7528invokevirtual\u548c\u865a\u65b9\u6cd5\u8868\u6765\u89e3\u91ca\u6574\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u6bcf\u4e2a\u7c7b\u4e2d\u90fd\u6709\u4e00\u4e2a\u865a\u65b9\u6cd5\u8868\uff0c\u672c\u8d28\u4e0a\u5b83\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8bb0\u5f55\u4e86\u65b9\u6cd5\u7684\u5730\u5740\u3002\u5b50\u7c7b\u65b9\u6cd5\u8868\u4e2d\u5305\u542b\u7236\u7c7b\u65b9\u6cd5\u8868\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\uff1b\u5b50\u7c7b\u5982\u679c\u91cd\u5199\u4e86\u7236\u7c7b\u65b9\u6cd5\uff0c\u5219\u4f7f\u7528\u81ea\u5df1\u7c7b\u4e2d\u65b9\u6cd5\u7684\u5730\u5740\u8fdb\u884c\u66ff\u6362\u3002</p> <p></p> <p></p>"},{"location":"JVM/JVM-principle/#\u5f02\u5e38\u6355\u83b7\u7684\u539f\u7406","title":"\u5f02\u5e38\u6355\u83b7\u7684\u539f\u7406","text":"<p>\u5728Java\u4e2d\uff0c\u7a0b\u5e8f\u9047\u5230\u5f02\u5e38\u65f6\u4f1a\u5411\u5916\u629b\u51fa\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528try-catch\u6355\u83b7\u5f02\u5e38\u7684\u65b9\u5f0f\u5c06\u5f02\u5e38\u6355\u83b7\u5e76\u7ee7\u7eed\u8ba9\u7a0b\u5e8f\u6309\u7a0b\u5e8f\u5458\u8bbe\u8ba1\u597d\u7684\u65b9\u5f0f\u8fd0\u884c\u3002</p> <p>\u6bd4\u5982\u5982\u4e0b\u4ee3\u7801\uff1a\u5728try\u4ee3\u7801\u5757\u4e2d\u5982\u679c\u629b\u51fa\u4e86Exception\u5bf9\u8c61\u6216\u8005\u5b50\u7c7b\u5bf9\u8c61\uff0c\u5219\u4f1a\u8fdb\u5165catch\u5206\u652f\u3002\u5f02\u5e38\u6355\u83b7\u673a\u5236\u7684\u5b9e\u73b0\uff0c\u9700\u8981\u501f\u52a9\u4e8e\u7f16\u8bd1\u65f6\u751f\u6210\u7684\u5f02\u5e38\u8868\u3002</p> <p>\u5f02\u5e38\u8868\u5728\u7f16\u8bd1\u671f\u751f\u6210\uff0c\u5b58\u653e\u7684\u662f\u4ee3\u7801\u4e2d\u5f02\u5e38\u7684\u5904\u7406\u4fe1\u606f\uff0c\u5305\u542b\u4e86\u5f02\u5e38\u6355\u83b7\u7684\u751f\u6548\u8303\u56f4\u4ee5\u53ca\u5f02\u5e38\u53d1\u751f\u540e\u8df3\u8f6c\u5230\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4f4d\u7f6e\u3002</p> <p>\u8d77\u59cb/\u7ed3\u675fPC\uff1a\u6b64\u6761\u5f02\u5e38\u6355\u83b7\u751f\u6548\u7684\u5b57\u8282\u7801\u8d77\u59cb/\u7ed3\u675f\u4f4d\u7f6e\u3002</p> <p>\u8df3\u8f6cPC\uff1a\u5f02\u5e38\u6355\u83b7\u4e4b\u540e\uff0c\u8df3\u8f6c\u5230\u7684\u5b57\u8282\u7801\u4f4d\u7f6e\u3002</p> <p></p> <p>\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u89e6\u53d1\u5f02\u5e38\u65f6\uff0cJava \u865a\u62df\u673a\u4f1a\u4ece\u4e0a\u81f3\u4e0b\u904d\u5386\u5f02\u5e38\u8868\u4e2d\u7684\u6240\u6709\u6761\u76ee\u3002\u5f53\u89e6\u53d1\u5f02\u5e38\u7684\u5b57\u8282\u7801\u7684\u7d22\u5f15\u503c\u5728\u67d0\u4e2a\u5f02\u5e38\u8868\u6761\u76ee\u7684\u76d1\u63a7\u8303\u56f4\u5185\uff0cJava \u865a\u62df\u673a\u4f1a\u5224\u65ad\u6240\u629b\u51fa\u7684\u5f02\u5e38\u548c\u8be5\u6761\u76ee\u60f3\u8981\u6355\u83b7\u7684\u5f02\u5e38\u662f\u5426\u5339\u914d\u3002</p> <ol> <li> <p>\u5982\u679c\u5339\u914d\uff0c\u8df3\u8f6c\u5230\u201c\u8df3\u8f6cPC\u201d\u5bf9\u5e94\u7684\u5b57\u8282\u7801\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u5982\u679c\u904d\u5386\u5b8c\u90fd\u4e0d\u80fd\u5339\u914d\uff0c\u8bf4\u660e\u5f02\u5e38\u65e0\u6cd5\u5728\u5f53\u524d\u65b9\u6cd5\u6267\u884c\u65f6\u88ab\u6355\u83b7\uff0c\u6b64\u65b9\u6cd5\u6808\u5e27\u76f4\u63a5\u5f39\u51fa\uff0c\u5728\u4e0a\u4e00\u5c42\u7684\u6808\u5e27\u4e2d\u8fdb\u884c\u5f02\u5e38\u6355\u83b7\u7684\u67e5\u8be2\u3002</p> </li> </ol> <p>finally\u7684\u5904\u7406\u65b9\u5f0f\u5c31\u76f8\u5bf9\u6bd4\u8f83\u590d\u6742\u4e00\u70b9\u4e86\uff0c\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li> <p>finally\u4e2d\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4f1a\u63d2\u5165\u5230try \u548c catch\u4ee3\u7801\u5757\u4e2d,\u4fdd\u8bc1\u5728try\u548ccatch\u6267\u884c\u4e4b\u540e\u4e00\u5b9a\u4f1a\u6267\u884cfinally\u4e2d\u7684\u4ee3\u7801\u3002</p> </li> <li> <p>\u5982\u679c\u629b\u51fa\u7684\u5f02\u5e38\u8303\u56f4\u8d85\u8fc7\u4e86Exception\uff0c\u6bd4\u5982Error\u6216\u8005Throwable\uff0c\u6b64\u65f6\u4e5f\u8981\u6267\u884cfinally\uff0c\u6240\u4ee5\u5f02\u5e38\u8868\u4e2d\u589e\u52a0\u4e86\u4e24\u4e2a\u6761\u76ee\u3002\u8986\u76d6\u4e86try\u548ccatch\u4e24\u6bb5\u5b57\u8282\u7801\u6307\u4ee4\u7684\u8303\u56f4\uff0cany\u4ee3\u8868\u53ef\u4ee5\u6355\u83b7\u6240\u6709\u79cd\u7c7b\u7684\u5f02\u5e38\u3002</p> </li> </ol> <p></p> <p></p>"},{"location":"JVM/JVM-principle/#jit\u5373\u65f6\u7f16\u8bd1\u5668","title":"JIT\u5373\u65f6\u7f16\u8bd1\u5668","text":"<p>\u5728Java\u4e2d\uff0cJIT\u5373\u65f6\u7f16\u8bd1\u5668\u662f\u4e00\u9879\u7528\u6765\u63d0\u5347\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u6267\u884c\u6548\u7387\u7684\u6280\u672f\u3002\u5b57\u8282\u7801\u6307\u4ee4\u88ab Java \u865a\u62df\u673a\u89e3\u91ca\u6267\u884c\uff0c\u5982\u679c\u6709\u4e00\u4e9b\u6307\u4ee4\u6267\u884c\u9891\u7387\u9ad8\uff0c\u79f0\u4e4b\u4e3a\u70ed\u70b9\u4ee3\u7801\uff0c\u8fd9\u4e9b\u5b57\u8282\u7801\u6307\u4ee4\u5219\u88abJIT\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u6210\u673a\u5668\u7801\u540c\u65f6\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\uff0c\u6700\u540e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u5c06\u6765\u6267\u884c\u65f6\u76f4\u63a5\u8bfb\u53d6\u5c31\u53ef\u4ee5\u8fd0\u884c\u5728\u8ba1\u7b97\u673a\u786c\u4ef6\u4e0a\u4e86\u3002</p> <p>\u5728HotSpot\u4e2d\uff0c\u6709\u4e09\u6b3e\u5373\u65f6\u7f16\u8bd1\u5668\uff0cC1\u3001C2\u548cGraal\uff0c\u5176\u4e2dGraal\u5728GraalVM\u7ae0\u8282\u4e2d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u3002</p> <p>C1\u7f16\u8bd1\u6548\u7387\u6bd4C2\u5feb\uff0c\u4f46\u662f\u4f18\u5316\u6548\u679c\u4e0d\u5982C2\u3002\u6240\u4ee5C1\u9002\u5408\u4f18\u5316\u4e00\u4e9b\u6267\u884c\u65f6\u95f4\u8f83\u77ed\u7684\u4ee3\u7801\uff0cC2\u9002\u5408\u4f18\u5316\u670d\u52a1\u7aef\u7a0b\u5e8f\u4e2d\u957f\u671f\u6267\u884c\u7684\u4ee3\u7801\u3002</p> <p>JDK7\u4e4b\u540e\uff0c\u91c7\u7528\u4e86\u5206\u5c42\u7f16\u8bd1\u7684\u65b9\u5f0f\uff0c\u5728JVM\u4e2dC1\u548cC2\u4f1a\u4e00\u540c\u53d1\u6325\u4f5c\u7528\uff0c\u5206\u5c42\u7f16\u8bd1\u5c06\u6574\u4e2a\u4f18\u5316\u7ea7\u522b\u5206\u6210\u4e865\u4e2a\u7b49\u7ea7\u3002</p> <p></p> <p>C1\u5373\u65f6\u7f16\u8bd1\u5668\u548cC2\u5373\u65f6\u7f16\u8bd1\u5668\u90fd\u6709\u72ec\u7acb\u7684\u7ebf\u7a0b\u53bb\u8fdb\u884c\u5904\u7406\uff0c\u5185\u90e8\u4f1a\u4fdd\u5b58\u4e00\u4e2a\u961f\u5217\uff0c\u961f\u5217\u4e2d\u5b58\u653e\u9700\u8981\u7f16\u8bd1\u7684\u4efb\u52a1\u3002\u4e00\u822c\u5373\u65f6\u7f16\u8bd1\u5668\u662f\u9488\u5bf9\u65b9\u6cd5\u7ea7\u522b\u6765\u8fdb\u884c\u4f18\u5316\u7684\uff0c\u5f53\u7136\u4e5f\u6709\u5bf9\u5faa\u73af\u8fdb\u884c\u4f18\u5316\u7684\u8bbe\u8ba1\u3002</p>"},{"location":"JVM/JVM-principle/#c1\u4e0ec2\u534f\u4f5c","title":"C1\u4e0eC2\u534f\u4f5c","text":"<ol> <li> <p>\u5148\u7531C1\u6267\u884c\u8fc7\u7a0b\u4e2d\u6536\u96c6\u6240\u6709\u8fd0\u884c\u4e2d\u7684\u4fe1\u606f\uff0c\u65b9\u6cd5\u6267\u884c\u6b21\u6570\u3001\u5faa\u73af\u6267\u884c\u6b21\u6570\u3001\u5206\u652f\u6267\u884c\u6b21\u6570\u7b49\u7b49\uff0c\u7136\u540e\u7b49\u5f85\u6267\u884c\u6b21\u6570\u89e6\u53d1\u9608\u503c\uff08\u5206\u5c42\u5373\u65f6\u7f16\u8bd1\u7531JVM\u52a8\u6001\u8ba1\u7b97\uff09\u4e4b\u540e\uff0c\u8fdb\u5165C2\u5373\u65f6\u7f16\u8bd1\u5668\u8fdb\u884c\u6df1\u5c42\u6b21\u7684\u4f18\u5316\u3002</p> </li> <li> <p>\u65b9\u6cd5\u5b57\u8282\u7801\u6267\u884c\u6570\u76ee\u8fc7\u5c11\uff0c\u5148\u6536\u96c6\u4fe1\u606f\uff0cJVM\u5224\u65adC1\u548cC2\u4f18\u5316\u6027\u80fd\u5dee\u4e0d\u591a\uff0c\u90a3\u4e4b\u540e\u8f6c\u4e3a\u4e0d\u6536\u96c6\u4fe1\u606f\uff0c\u7531C1\u76f4\u63a5\u8fdb\u884c\u4f18\u5316\u3002</p> </li> <li> <p>C1\u7ebf\u7a0b\u90fd\u5728\u5fd9\u788c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u7531C2\u8fdb\u884c\u4f18\u5316\u3002</p> </li> <li> <p>C2\u7ebf\u7a0b\u5fd9\u788c\u65f6\uff0c\u5148\u75312\u5c42C1\u7f16\u8bd1\u6536\u96c6\u4e00\u4e9b\u57fa\u7840\u4fe1\u606f\uff0c\u591a\u8fd0\u884c\u4e00\u4f1a\u513f\uff0c\u7136\u540e\u518d\u4ea4\u75313\u5c42C1\u5904\u7406\uff0c\u7531\u4e8e3\u5c42C1\u5904\u7406\u6548\u7387\u4e0d\u9ad8\uff0c\u6240\u4ee5\u5c3d\u91cf\u51cf\u5c11\u8fd9\u4e00\u5c42\u505c\u7559\u65f6\u95f4\uff08C2\u5fd9\u788c\u7740\uff0c\u4e00\u76f4\u6536\u96c6\u4e5f\u6ca1\u6709\u610f\u4e49\uff09\uff0c\u6700\u540eC2\u7ebf\u7a0b\u4e0d\u5fd9\u788c\u4e86\u518d\u4ea4\u7531C2\u8fdb\u884c\u5904\u7406\u3002</p> </li> </ol> <p>\u5206\u522b\u91c7\u7528\u4e09\u79cd\u4e0d\u540c\u865a\u62df\u673a\u53c2\u6570\u6d4b\u8bd5JIT\u4f18\u5316\u6548\u679c\uff1a\u4e0d\u52a0\u53c2\u6570\uff08\u5f00\u542f\u5b8c\u5168JIT\u5373\u65f6\u7f16\u8bd1\uff09\uff0c-Xint\uff08\u5173\u95edJIT\u53ea\u4f7f\u7528\u89e3\u91ca\u5668\uff09\u3001-XX:TieredStopAtLevel=1\uff08\u5206\u5c42\u7f16\u8bd1\u4e0b\u53ea\u4f7f\u75281\u5c42C1\u8fdb\u884c\u7f16\u8bd1\uff09</p>"},{"location":"JVM/JVM-principle/#\u4f18\u5316\u624b\u6bb5-\u65b9\u6cd5\u5185\u8054","title":"\u4f18\u5316\u624b\u6bb5-\u65b9\u6cd5\u5185\u8054","text":"<p>\u65b9\u6cd5\u5185\u8054\uff08Method Inline\uff09\uff1a\u65b9\u6cd5\u4f53\u4e2d\u7684\u5b57\u8282\u7801\u6307\u4ee4\u76f4\u63a5\u590d\u5236\u5230\u8c03\u7528\u65b9\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4e2d\uff0c\u8282\u7701\u4e86\u521b\u5efa\u6808\u5e27\u7684\u5f00\u9500\u3002</p> <p></p> <p>\u4f7f\u7528JIT Watch\u5de5\u5177\u67e5\u770b\u65b9\u6cd5\u5185\u8054\u7684\u4f18\u5316\u7ed3\u679c</p> <p>\u5b89\u88c5JIT Watch\u5de5\u5177\uff0c\u4e0b\u8f7d\u6e90\u7801\uff1a https://github.com/AdoptOpenJDK/jitwatch/tree/1.4.2</p> <p>\u65b9\u6cd5\u5185\u8054\u7684\u9650\u5236</p> <p>\u5e76\u4e0d\u662f\u6240\u6709\u7684\u65b9\u6cd5\u90fd\u53ef\u4ee5\u5185\u8054\uff0c\u5185\u8054\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff1a</p> <ol> <li> <p>\u65b9\u6cd5\u7f16\u8bd1\u4e4b\u540e\u7684\u5b57\u8282\u7801\u6307\u4ee4\u603b\u5927\u5c0f &lt; 35\u5b57\u8282\uff0c\u53ef\u4ee5\u76f4\u63a5\u5185\u8054\u3002\uff08\u901a\u8fc7<code>-XX:MaxInlineSize=\u503c</code> \u63a7\u5236\uff09</p> </li> <li> <p>\u65b9\u6cd5\u7f16\u8bd1\u4e4b\u540e\u7684\u5b57\u8282\u7801\u6307\u4ee4\u603b\u5927\u5c0f &lt; 325\u5b57\u8282\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u70ed\u65b9\u6cd5\u3002\uff08\u901a\u8fc7<code>-XX:FreqInlineSize=\u503c</code> \u63a7\u5236\uff09</p> </li> <li> <p>\u65b9\u6cd5\u7f16\u8bd1\u751f\u6210\u7684\u673a\u5668\u7801\u4e0d\u80fd\u5927\u4e8e1000\u5b57\u8282\u3002\uff08\u901a\u8fc7<code>-XX:InlineSmallCode=\u503c</code> \u63a7\u5236\uff09</p> </li> <li> <p>\u4e00\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u5fc5\u987b\u5c0f\u4e8e3\u4e2a\uff0c\u5982\u679c\u5927\u4e8e\u4e09\u4e2a\u5c31\u4e0d\u4f1a\u53d1\u751f\u5185\u8054\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u4f18\u5316\u624b\u6bb5-\u9003\u9038\u5206\u6790","title":"\u4f18\u5316\u624b\u6bb5-\u9003\u9038\u5206\u6790","text":"<p>\u9003\u9038\u5206\u6790\u6307\u7684\u662f\u5982\u679cJIT\u53d1\u73b0\u5728\u65b9\u6cd5\u5185\u521b\u5efa\u7684\u5bf9\u8c61\u4e0d\u4f1a\u88ab\u5916\u90e8\u5f15\u7528\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u91c7\u7528\u9501\u6d88\u9664\u3001\u6807\u91cf\u66ff\u6362\u7b49\u65b9\u5f0f\u8fdb\u884c\u4f18\u5316\u3002</p>"},{"location":"JVM/JVM-principle/#\u9501\u6d88\u9664","title":"\u9501\u6d88\u9664","text":"<p>\u9501\u6d88\u9664\u6307\u7684\u662f\u5982\u679c\u5bf9\u8c61\u88ab\u5224\u65ad\u4e0d\u4f1a\u9003\u9038\u51fa\u53bb\uff0c\u90a3\u4e48\u5728\u5bf9\u8c61\u5c31\u4e0d\u5b58\u5728\u5e76\u53d1\u8bbf\u95ee\u95ee\u9898\uff0c\u5bf9\u8c61\u4e0a\u7684\u9501\u5904\u7406\u90fd\u4e0d\u4f1a\u6267\u884c\uff0c\u4ece\u800c\u63d0\u9ad8\u6027\u80fd\u3002\u5982\uff1a</p> <pre><code>synchronized (new Test()){}\n</code></pre>"},{"location":"JVM/JVM-principle/#\u6807\u91cf\u66ff\u6362","title":"\u6807\u91cf\u66ff\u6362","text":"<p>\u9003\u9038\u5206\u6790\u771f\u6b63\u5bf9\u6027\u80fd\u4f18\u5316\u6bd4\u8f83\u5927\u7684\u65b9\u5f0f\u662f\u6807\u91cf\u66ff\u6362\uff0c\u5728Java\u865a\u62df\u673a\u4e2d\uff0c\u5bf9\u8c61\u4e2d\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u79f0\u4e3a\u6807\u91cf\uff0c\u5f15\u7528\u7684\u5176\u4ed6\u5bf9\u8c61\u79f0\u4e3a\u805a\u5408\u91cf\u3002\u6807\u91cf\u66ff\u6362\u6307\u7684\u662f\u5982\u679c\u65b9\u6cd5\u4e2d\u7684\u5bf9\u8c61\u4e0d\u4f1a\u9003\u9038\uff0c\u90a3\u4e48\u5176\u4e2d\u7684\u6807\u91cf\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u6808\u4e0a\u5206\u914d\u3002</p> <p>\u6839\u636eJIT\u5373\u65f6\u7f16\u5668\u4f18\u5316\u4ee3\u7801\u7684\u7279\u6027\uff0c\u5728\u7f16\u5199\u4ee3\u7801\u65f6\u6ce8\u610f\u4ee5\u4e0b\u51e0\u4e2a\u4e8b\u9879\uff0c\u53ef\u4ee5\u8ba9\u4ee3\u7801\u6267\u884c\u65f6\u62e5\u6709\u66f4\u597d\u7684\u6027\u80fd\uff1a</p> <ol> <li> <p>\u5c3d\u91cf\u7f16\u5199\u6bd4\u8f83\u5c0f\u7684\u65b9\u6cd5\uff0c\u8ba9\u65b9\u6cd5\u5185\u8054\u53ef\u4ee5\u751f\u6548\u3002</p> </li> <li> <p>\u9ad8\u9891\u4f7f\u7528\u7684\u4ee3\u7801\uff0c\u7279\u522b\u662f\u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93\u751a\u81f3\u662fJDK\u4e2d\u7684\uff0c\u5982\u679c\u5185\u5bb9\u8fc7\u5ea6\u590d\u6742\u662f\u65e0\u6cd5\u5185\u8054\u7684\uff0c\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0\u4e00\u4e2a\u7279\u5b9a\u7684\u4f18\u5316\u7248\u672c\u3002</p> </li> <li> <p>\u6ce8\u610f\u63a5\u53e3\u7684\u5b9e\u73b0\u6570\u91cf\uff0c\u5c3d\u91cf\u4e0d\u8981\u8d85\u8fc72\u4e2a\uff0c\u5426\u5219\u4f1a\u5f71\u54cd\u5185\u8054\u7684\u5904\u7406\u3002</p> </li> <li> <p>\u9ad8\u9891\u8c03\u7528\u7684\u65b9\u6cd5\u4e2d\u521b\u5efa\u5bf9\u8c61\u4e34\u65f6\u4f7f\u7528\uff0c\u5c3d\u91cf\u4e0d\u8981\u8ba9\u5bf9\u8c61\u9003\u9038\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u5783\u573e\u56de\u6536\u5668\u539f\u7406","title":"\u5783\u573e\u56de\u6536\u5668\u539f\u7406","text":""},{"location":"JVM/JVM-principle/#g1\u5783\u573e\u56de\u6536\u5668\u539f\u7406","title":"G1\u5783\u573e\u56de\u6536\u5668\u539f\u7406","text":""},{"location":"JVM/JVM-principle/#\u5e74\u8f7b\u4ee3\u56de\u6536","title":"\u5e74\u8f7b\u4ee3\u56de\u6536","text":"<ol> <li> <p>\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u4f1a\u5b58\u653e\u5728Eden\u533a\u3002\u5f53G1\u5224\u65ad\u5e74\u8f7b\u4ee3\u533a\u4e0d\u8db3\uff08max\u9ed8\u8ba460%\uff09\uff0c\u65e0\u6cd5\u5206\u914d\u5bf9\u8c61\u65f6\u9700\u8981\u56de\u6536\u65f6\u4f1a\u6267\u884cYoung GC\u3002</p> </li> <li> <p>\u6807\u8bb0\u51faEden\u548cSurvivor\u533a\u57df\u4e2d\u7684\u5b58\u6d3b\u5bf9\u8c61</p> </li> <li> <p>\u6839\u636e\u914d\u7f6e\u7684\u6700\u5927\u6682\u505c\u65f6\u95f4\u9009\u62e9\u67d0\u4e9b\u533a\u57df\u5c06\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230\u4e00\u4e2a\u65b0\u7684Survivor\u533a\u4e2d\uff08\u5e74\u9f84+1\uff09\uff0c\u6e05\u7a7a\u8fd9\u4e9b\u533a\u57df\u3002</p> </li> <li> <p>\u540e\u7eedYoung GC\u65f6\u4e0e\u4e4b\u524d\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7Survivor\u533a\u4e2d\u5b58\u6d3b\u5bf9\u8c61\u4f1a\u88ab\u642c\u8fd0\u5230\u53e6\u4e00\u4e2aSurvivor\u533a\u3002</p> </li> <li> <p>\u5f53\u67d0\u4e2a\u5b58\u6d3b\u5bf9\u8c61\u7684\u5e74\u9f84\u5230\u8fbe\u9608\u503c\uff08\u9ed8\u8ba415\uff09\uff0c\u5c06\u88ab\u653e\u5165\u8001\u5e74\u4ee3\u3002</p> </li> <li> <p>\u90e8\u5206\u5bf9\u8c61\u5982\u679c\u5927\u5c0f\u8d85\u8fc7Region\u7684\u4e00\u534a\uff0c\u4f1a\u76f4\u63a5\u653e\u5165\u8001\u5e74\u4ee3\uff0c\u8fd9\u7c7b\u8001\u5e74\u4ee3\u88ab\u79f0\u4e3aHumongous\u533a\u3002\u6bd4\u5982\u5806\u5185\u5b58\u662f4G\uff0c\u6bcf\u4e2aRegion\u662f2M\uff0c\u53ea\u8981\u4e00\u4e2a\u5927\u5bf9\u8c61\u8d85\u8fc7\u4e861M\u5c31\u88ab\u653e\u5165Humongous\u533a\uff0c\u5982\u679c\u5bf9\u8c61\u8fc7\u5927\u4f1a\u6a2a\u8de8\u591a\u4e2aRegion\u3002</p> </li> <li> <p>\u591a\u6b21\u56de\u6536\u4e4b\u540e\uff0c\u4f1a\u51fa\u73b0\u5f88\u591aOld\u8001\u5e74\u4ee3\u533a\uff0c\u6b64\u65f6\u603b\u5806\u5360\u6709\u7387\u8fbe\u5230\u9608\u503c\u65f6\uff08<code>-XX:InitiatingHeapOccupancyPercent</code>\u9ed8\u8ba445%\uff09\u4f1a\u89e6\u53d1\u6df7\u5408\u56de\u6536MixedGC\u3002\u56de\u6536\u6240\u6709\u5e74\u8f7b\u4ee3\u548c\u90e8\u5206\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u4ee5\u53ca\u5927\u5bf9\u8c61\u533a\u3002\u91c7\u7528\u590d\u5236\u7b97\u6cd5\u6765\u5b8c\u6210\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u95ee\u9898","title":"\u95ee\u9898","text":"<p>\u5e74\u8f7b\u4ee3\u56de\u6536\u53ea\u626b\u63cf\u5e74\u8f7b\u4ee3\u5bf9\u8c61\uff08Eden + Survivor\uff09\uff0c\u6240\u4ee5\u4eceGC Root\u5230\u5e74\u8f7b\u4ee3\u7684\u5bf9\u8c61\u6216\u8005\u5e74\u8f7b\u4ee3\u5bf9\u8c61\u5f15\u7528\u4e86\u5176\u4ed6\u5e74\u8f7b\u4ee3\u7684\u5bf9\u8c61\u90fd\u5f88\u5bb9\u6613\u626b\u63cf\u51fa\u6765</p> <p>\u8fd9\u91cc\u5c31\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5e74\u8f7b\u4ee3\u56de\u6536\u53ea\u626b\u63cf\u5e74\u8f7b\u4ee3\u5bf9\u8c61\uff08Eden + Survivor\uff09\uff0c\u5982\u679c\u6709\u8001\u5e74\u4ee3\u4e2d\u7684\u5bf9\u8c61\u5f15\u7528\u4e86\u5e74\u8f7b\u4ee3\u4e2d\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53c8\u5982\u4f55\u77e5\u9053\u5462\uff1f</p> <p>\u65b9\u68481\uff1a\u4eceGC Root\u5f00\u59cb\uff0c\u626b\u63cf\u6240\u6709\u5bf9\u8c61\uff0c\u5982\u679c\u5e74\u8f7b\u4ee3\u5bf9\u8c61\u5728\u5f15\u7528\u94fe\u4e0a\uff0c\u5c31\u6807\u8bb0\u4e3a\u5b58\u6d3b\u3002</p> <p>\u4e0d\u53ef\u884c\uff0c\u9700\u8981\u904d\u5386\u5f15\u7528\u94fe\u4e0a\u6240\u6709\u5bf9\u8c61\uff0c\u6548\u7387\u592a\u4f4e\u3002</p> <p>\u65b9\u68482\uff1a\u7ef4\u62a4\u4e00\u4e2a\u8be6\u7ec6\u7684\u8868\uff0c\u8bb0\u5f55\u54ea\u4e2a\u5bf9\u8c61\u88ab\u54ea\u4e2a\u8001\u5e74\u4ee3\u5f15\u7528\u4e86\u3002\u5728\u5e74\u8f7b\u4ee3\u4e2d\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u4e0d\u8fdb\u884c\u56de\u6536\u3002</p> <p>\u95ee\u9898\uff1a\u5982\u679c\u5bf9\u8c61\u592a\u591a\u8fd9\u5f20\u8868\u4f1a\u5360\u7528\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u5b58\u5728\u9519\u6807\u7684\u60c5\u51b5</p> <p>\u65b9\u68482\u7684\u7b2c\u4e00\u6b21\u4f18\u5316\uff1a\u53ea\u8bb0\u5f55Region\u88ab\u54ea\u4e9b\u5bf9\u8c61\u5f15\u7528\u4e86\u3002\u8fd9\u79cd\u5f15\u7528\u8be6\u60c5\u8868\u79f0\u4e3a\u8bb0\u5fc6\u96c6 RememberedSet\uff08\u7b80\u79f0RS\u6216RSet\uff09\uff1a\u662f\u4e00\u79cd\u8bb0\u5f55\u4e86\u4ece\u975e\u6536\u96c6\u533a\u57df\u5bf9\u8c61\u5f15\u7528\u6536\u96c6\u533a\u57df\u5bf9\u8c61\u7684\u8fd9\u4e9b\u5173\u7cfb\u7684\u6570\u636e\u7ed3\u6784\u3002\u626b\u63cf\u65f6\u5c06\u8bb0\u5fc6\u96c6\u4e2d\u7684\u5bf9\u8c61\u4e5f\u52a0\u5165\u5230GC Root\u4e2d\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u5f15\u7528\u94fe\u5224\u65ad\u54ea\u4e9b\u5bf9\u8c61\u9700\u8981\u56de\u6536\u4e86\u3002</p> <p>\u95ee\u9898\uff1a\u5982\u679c\u533a\u57df\u4e2d\u5f15\u7528\u5bf9\u8c61\u5f88\u591a\uff0c\u8fd8\u662f\u5360\u7528\u5f88\u591a\u5185\u5b58\u3002</p> <p>\u65b9\u68482\u7684\u7b2c\u4e8c\u6b21\u4f18\u5316\uff1a\u5c06\u6240\u6709\u533a\u57df\u4e2d\u7684\u5185\u5b58\u6309\u4e00\u5b9a\u5927\u5c0f\u5212\u5206\u6210\u5f88\u591a\u4e2a\u5757\uff0c\u6bcf\u4e2a\u5757\u8fdb\u884c\u7f16\u53f7\u3002\u8bb0\u5fc6\u96c6\u4e2d\u53ea\u8bb0\u5f55\u5bf9\u5757\u7684\u5f15\u7528\u5173\u7cfb\u3002\u5982\u679c\u4e00\u4e2a\u5757\u4e2d\u6709\u591a\u4e2a\u5bf9\u8c61\uff0c\u53ea\u9700\u8981\u5f15\u7528\u4e00\u6b21\uff0c\u51cf\u5c11\u4e86\u5185\u5b58\u5f00\u9500\u3002</p> <p>\u6bcf\u4e00\u4e2aRegion\u90fd\u62e5\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u5361\u8868\uff0c\u5982\u679c\u4ea7\u751f\u4e86\u8de8\u4ee3\u5f15\u7528\uff08\u8001\u5e74\u4ee3\u5f15\u7528\u5e74\u8f7b\u4ee3\uff09\uff0c\u6b64\u65f6\u8fd9\u4e2aRegion\u5bf9\u5e94\u7684\u5361\u8868\u4e0a\u5c31\u4f1a\u5c06\u5b57\u8282\u5185\u5bb9\u8fdb\u884c\u4fee\u6539,JDK8\u6e90\u7801\u4e2d0\u4ee3\u8868\u88ab\u5f15\u7528\u4e86\u79f0\u4e3a\u810f\u5361\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u6807\u8bb0\u51fa\u5f53\u524dRegion\u88ab\u8001\u5e74\u4ee3\u4e2d\u7684\u54ea\u4e9b\u90e8\u5206\u5f15\u7528\u4e86\u3002\u90a3\u4e48\u8981\u751f\u6210\u8bb0\u5fc6\u96c6\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86\uff0c\u53ea\u9700\u8981\u904d\u5386\u6574\u4e2a\u5361\u8868\uff0c\u627e\u5230\u6240\u6709\u810f\u5361\u3002</p>"},{"location":"JVM/JVM-principle/#g1\u5e74\u8f7b\u4ee3\u56de\u6536\u6838\u5fc3\u6280\u672f","title":"G1\u5e74\u8f7b\u4ee3\u56de\u6536\u6838\u5fc3\u6280\u672f","text":"<ol> <li> <p>\u5361\u8868Card Table    \u6bcf\u4e00\u4e2aRegion\u90fd\u62e5\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u5361\u8868\uff0c\u5361\u8868\u662f\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4\uff0c\u5982\u679c\u4ea7\u751f\u4e86\u8de8\u4ee3\u5f15\u7528\uff08\u8001\u5e74\u4ee3\u5f15\u7528\u5e74\u8f7b\u4ee3\uff09\uff0cG1\u4f1a\u5c06\u5361\u8868\u4e0a\u5f15\u7528\u5bf9\u8c61\u6240\u5728\u7684\u4f4d\u7f6e\u5b57\u8282\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\u4e3a0, \u79f0\u4e3a\u810f\u5361\u3002\u5361\u8868\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u751f\u6210\u8bb0\u5fc6\u96c6\u3002\u5361\u8868\u4f1a\u5360\u7528\u4e00\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5806\u5927\u5c0f\u662f1G\u65f6\uff0c\u5361\u8868\u5927\u5c0f\u4e3a1G = 1024 MB / 512 = 2MB </p> </li> <li> <p>\u8bb0\u5fc6\u96c6 RememberedSet\uff08\u7b80\u79f0RS\u6216RSet\uff09    \u6bcf\u4e00\u4e2aRegion\u90fd\u62e5\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u8bb0\u5fc6\u96c6\uff0c\u5982\u679c\u4ea7\u751f\u4e86\u8de8\u4ee3\u5f15\u7528\uff0c\u8bb0\u5fc6\u96c6\u4e2d\u4f1a\u8bb0\u5f55\u5f15\u7528\u5bf9\u8c61\u6240\u5728\u7684\u5361\u8868\u4f4d\u7f6e\u3002\u6807\u8bb0\u9636\u6bb5\u5c06\u8bb0\u5fc6\u96c6\u4e2d\u7684\u5bf9\u8c61\u52a0\u5165GC ROOT\u96c6\u5408\u4e2d\u4e00\u8d77\u626b\u63cf\uff0c\u5c31\u53ef\u4ee5\u5c06\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\u6807\u8bb0\u4e3a\u5b58\u6d3b\u3002</p> </li> <li> <p>\u5199\u5c4f\u969c Write Barrier     G1\u4f7f\u7528\u5199\u5c4f\u969c\u6280\u672f\uff0c\u5728\u6267\u884c\u5f15\u7528\u5173\u7cfb\u5efa\u7acb\u7684\u4ee3\u7801\u6267\u884c\u540e\u63d2\u5165\u4e00\u6bb5\u6307\u4ee4\uff0c\u5b8c\u6210\u5361\u8868\u7684\u7ef4\u62a4\u5de5\u4f5c\u3002\u4f1a\u635f\u5931\u4e00\u90e8\u5206\u7684\u6027\u80fd\uff0c\u5927\u7ea6\u57285%~10%\u4e4b\u95f4\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#\u6df7\u5408\u56de\u6536","title":"\u6df7\u5408\u56de\u6536","text":"<p>\u591a\u6b21\u56de\u6536\u4e4b\u540e\uff0c\u4f1a\u51fa\u73b0\u5f88\u591aOld\u8001\u5e74\u4ee3\u533a\uff0c\u6b64\u65f6\u603b\u5806\u5360\u6709\u7387\u8fbe\u5230\u9608\u503c\uff08\u9ed8\u8ba445%\uff09\u65f6\u4f1a\u89e6\u53d1\u6df7\u5408\u56de\u6536MixedGC\u3002</p> <p>\u6df7\u5408\u56de\u6536\u4f1a\u7531\u5e74\u8f7b\u4ee3\u56de\u6536\u4e4b\u540e\u6216\u8005\u5927\u5bf9\u8c61\u5206\u914d\u4e4b\u540e\u89e6\u53d1\uff0c\u6df7\u5408\u56de\u6536\u4f1a\u56de\u6536 \u6574\u4e2a\u5e74\u8f7b\u4ee3 + \u90e8\u5206\u8001\u5e74\u4ee3\u3002</p> <p>\u8001\u5e74\u4ee3\u5f88\u591a\u65f6\u5019\u4f1a\u6709\u5927\u91cf\u5bf9\u8c61\uff0c\u8981\u6807\u8bb0\u51fa\u6240\u6709\u5b58\u6d3b\u5bf9\u8c61\u8017\u65f6\u8f83\u957f\uff0c\u6240\u4ee5\u6574\u4e2a\u6807\u8bb0\u8fc7\u7a0b\u8981\u5c3d\u91cf\u80fd\u505a\u5230\u548c\u7528\u6237\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u521d\u59cb\u6807\u8bb0\uff0cSTW\uff0c\u91c7\u7528\u4e09\u8272\u6807\u8bb0\u6cd5\u6807\u8bb0\u4eceGC Root\u53ef\u76f4\u8fbe\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5e76\u53d1\u6807\u8bb0\uff0c\u5e76\u53d1\u6267\u884c\uff0c\u5bf9\u5b58\u6d3b\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0\u3002</p> </li> <li> <p>\u6700\u7ec8\u6807\u8bb0\uff0cSTW\uff0c\u5904\u7406SATB\u76f8\u5173\u7684\u5bf9\u8c61\u6807\u8bb0\u3002</p> </li> <li> <p>\u6e05\u7406\uff0cSTW\uff0c\u5982\u679c\u533a\u57df\u4e2d\u6ca1\u6709\u4efb\u4f55\u5b58\u6d3b\u5bf9\u8c61\u5c31\u76f4\u63a5\u6e05\u7406\u3002</p> </li> <li> <p>\u8f6c\u79fb\uff0c\u5c06\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230\u522b\u7684\u533a\u57df\u3002</p> </li> </ol> <p>1. \u521d\u59cb\u6807\u8bb0</p> <p>\u521d\u59cb\u6807\u8bb0\u4f1a\u6682\u505c\u6240\u6709\u7528\u6237\u7ebf\u7a0b\uff0c\u53ea\u6807\u8bb0\u4eceGC Root\u53ef\u76f4\u8fbe\u7684\u5bf9\u8c61\uff0c\u6240\u4ee5\u505c\u987f\u65f6\u95f4\u4e0d\u4f1a\u592a\u957f\u3002\u91c7\u7528\u4e09\u8272\u6807\u8bb0\u6cd5\u8fdb\u884c\u6807\u8bb0\uff0c\u4e09\u8272\u6807\u8bb0\u6cd5\u5728\u539f\u6709\u53cc\u8272\u6807\u8bb0\uff08\u9ed1\u4e5f\u5c31\u662f1\u4ee3\u8868\u5b58\u6d3b\uff0c\u767d0\u4ee3\u8868\u53ef\u56de\u6536\uff09\u589e\u52a0\u4e86\u4e00\u79cd\u7070\u8272\uff0c\u91c7\u7528\u961f\u5217\u7684\u65b9\u5f0f\u4fdd\u5b58\u6807\u8bb0\u4e3a\u7070\u8272\u7684\u5bf9\u8c61\u3002</p> <p>\u9ed1\u8272\uff1a\u5b58\u6d3b\uff0c\u5f53\u524d\u5bf9\u8c61\u5728GC Root\u5f15\u7528\u94fe\u4e0a\uff0c\u540c\u65f6\u4ed6\u5f15\u7528\u7684\u5176\u4ed6\u5bf9\u8c61\u4e5f\u90fd\u5df2\u7ecf\u6807\u8bb0\u5b8c\u6210\u3002</p> <p>\u7070\u8272\uff1a\u5f85\u5904\u7406\uff0c\u5f53\u524d\u5bf9\u8c61\u5728GC Root\u5f15\u7528\u94fe\u4e0a\uff0c\u4ed6\u5f15\u7528\u7684\u5176\u4ed6\u5bf9\u8c61\u8fd8\u672a\u6807\u8bb0\u5b8c\u6210\u3002</p> <p>\u767d\u8272\uff1a\u53ef\u56de\u6536\uff0c\u4e0d\u5728GC Root\u5f15\u7528\u94fe\u4e0a\u3002</p> <p>\u4e09\u8272\u6807\u8bb0\u4e2d\u7684\u9ed1\u8272\u548c\u767d\u8272\u662f\u4f7f\u7528\u4f4d\u56fe(bitmap)\u6765\u5b9e\u73b0\u7684,\u6bd4\u59828\u4e2a\u5b57\u8282\u4f7f\u75281\u4e2abit\u6765\u6807\u8bc6\u6807\u8bb0\u7684\u5185\u5bb9\uff0c\u9ed1\u8272\u4e3a1\uff0c\u767d\u8272\u4e3a0\uff0c\u7070\u8272\u4e0d\u4f1a\u4f53\u73b0\u5728\u4f4d\u56fe\u4e2d\uff0c\u4f1a\u5355\u72ec\u653e\u5165\u4e00\u4e2a\u961f\u5217\u4e2d\u3002\u5982\u679c\u5bf9\u8c61\u8d85\u8fc78\u4e2a\u5b57\u8282\uff0c\u4ec5\u4ec5\u4f7f\u7528\u7b2c\u4e00\u4e2abit\u4f4d\u5904\u7406\u3002</p> <p></p> <p>2. \u5e76\u53d1\u6807\u8bb0</p> <p>\u63a5\u4e0b\u6765\u8fdb\u5165\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\uff0c\u7ee7\u7eed\u8fdb\u884c\u672a\u5b8c\u6210\u7684\u6807\u8bb0\u4efb\u52a1\u3002\u6b64\u9636\u6bb5\u548c\u7528\u6237\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\u3002</p> <p>\u4ece\u7070\u8272\u961f\u5217\u4e2d\u83b7\u53d6\u5c1a\u672a\u5b8c\u6210\u6807\u8bb0\u7684\u5bf9\u8c61B\u3002\u6807\u8bb0B\u5173\u8054\u7684A\u548cC\u5bf9\u8c61\uff0c\u7531\u4e8eA\u5bf9\u8c61\u5e76\u672a\u5f15\u7528\u5176\u4ed6\u5bf9\u8c61\uff0c\u53ef\u4ee5\u76f4\u63a5\u6807\u8bb0\u6210\u9ed1\u8272\uff0c\u800cB\u4e5f\u5b8c\u6210\u4e86\u6240\u6709\u5f15\u7528\u5bf9\u8c61\u7684\u6807\u8bb0\uff0c\u4e5f\u6807\u8bb0\u4e3a\u9ed1\u8272\u3002C\u5bf9\u8c61\u6709\u5f15\u7528\u5bf9\u8c61E\uff0c\u6240\u4ee5\u5148\u6807\u8bb0\u6210\u7070\u8272\u5e76\u653e\u5165\u7070\u8272\u961f\u5217\u3002\u6700\u540e\u4ece\u961f\u5217\u83b7\u53d6C\u5bf9\u8c61\uff0c\u6807\u8bb0\u4e3a\u9ed1\u8272\uff0cE\u4e5f\u6807\u8bb0\u4e3a\u9ed1\u8272\u3002\u6240\u4ee5\u5269\u4f59\u5bf9\u8c61F\u5c31\u662f\u767d\u8272\uff0c\u53ef\u56de\u6536\u3002</p> <p>\u95ee\u9898</p> <p>\u4e09\u8272\u6807\u8bb0\u5b58\u5728\u4e00\u4e2a\u6bd4\u8f83\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u7531\u4e8e\u7528\u6237\u7ebf\u7a0b\u53ef\u80fd\u540c\u65f6\u5728\u4fee\u6539\u5bf9\u8c61\u7684\u5f15\u7528\u5173\u7cfb\uff0c\u5c31\u4f1a\u51fa\u73b0\u9519\u6807\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\uff1a</p> <p>\u8fd9\u4e2a\u6848\u4f8b\u4e2d\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cB\u548cC\u90fd\u4f1a\u88ab\u6807\u8bb0\u6210\u9ed1\u8272\u3002\u4f46\u662f\u5728BC\u6807\u8bb0\u524d\uff0c\u7528\u6237\u7ebf\u7a0b\u6267\u884c\u4e86 B.c = null\uff1b\u5c06B\u5230C\u7684\u5f15\u7528\u53bb\u9664\u4e86\u3002\u540c\u65f6\u6267\u884c\u4e86A.c = c; \u6dfb\u52a0\u4e86A\u5230C\u7684\u5f15\u7528\u3002\u6b64\u65f6\u4f1a\u51fa\u73b0\u4e25\u91cd\u95ee\u9898\uff0cC\u662f\u767d\u8272\u53ef\u56de\u6536\u4e00\u65e6\u56de\u6536\u4ee3\u7801\u4e2d\u518d\u53bb\u4f7f\u7528\u5bf9\u8c61\u4f1a\u9020\u6210\u91cd\u5927\u95ee\u9898\u3002</p> <p></p> <p>G1\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f7f\u7528\u4e86SATB\u6280\u672f\uff08Snapshot At The Beginning\uff0c \u521d\u59cb\u5feb\u7167\uff09\u3002SATB\u6280\u672f\u662f\u8fd9\u6837\u5904\u7406\u7684\uff1a</p> <ol> <li> <p>\u6807\u8bb0\u5f00\u59cb\u65f6\u521b\u5efa\u4e00\u4e2a\u5feb\u7167\uff0c\u8bb0\u5f55\u5f53\u524d\u6240\u6709\u5bf9\u8c61\uff0c\u6807\u8bb0\u8fc7\u7a0b\u4e2d\u65b0\u751f\u6210\u7684\u5bf9\u8c61\u76f4\u63a5\u6807\u8bb0\u4e3a\u9ed1\u8272\u3002</p> </li> <li> <p>\u91c7\u7528\u524d\u7f6e\u5199\u5c4f\u969c\u6280\u672f\uff0c\u5728\u5f15\u7528\u8d4b\u503c\u524d\u6bd4\u5982B.c = null\u4e4b\u524d\uff0c\u5c06\u4e4b\u524d\u5f15\u7528\u7684\u5bf9\u8c61c\u653e\u5165SATB\u5f85\u5904\u7406\u961f\u5217\u4e2d\u3002SATB\u961f\u5217\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\uff0c\u6700\u7ec8\u4f1a\u6c47\u603b\u5230\u4e00\u4e2a\u5927\u7684SATB\u961f\u5217\u4e2d\u3002</p> </li> </ol> <p>3. \u6700\u7ec8\u6807\u8bb0</p> <p>\u6700\u7ec8\u6807\u8bb0\u4f1a\u6682\u505c\u6240\u6709\u7528\u6237\u7ebf\u7a0b\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5904\u7406SATB\u76f8\u5173\u7684\u5bf9\u8c61\u6807\u8bb0\u3002\u8fd9\u4e00\u6b65\u4e2d\uff0c\u5c06\u6240\u6709\u7ebf\u7a0b\u7684SATB\u961f\u5217\u4e2d\u5269\u4f59\u7684\u6570\u636e\u5408\u5e76\u5230\u603b\u7684SATB\u961f\u5217\u4e2d\uff0c\u7136\u540e\u9010\u4e00\u5904\u7406\u3002</p> <p>SATB\u961f\u5217\u4e2d\u7684\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u6309\u7167\u5b58\u6d3b\u5904\u7406\uff0c\u540c\u65f6\u8981\u5904\u7406\u4ed6\u4eec\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> <p>SATB\u7684\u7f3a\u70b9\u662f\u5728\u672c\u8f6e\u6e05\u7406\u65f6\u53ef\u80fd\u4f1a\u5c06\u4e0d\u5b58\u6d3b\u7684\u5bf9\u8c61\u6807\u8bb0\u6210\u5b58\u6d3b\u5bf9\u8c61\uff0c\u4ea7\u751f\u4e86\u4e00\u4e9b\u6240\u8c13\u7684\u6d6e\u52a8\u5783\u573e\uff0c\u7b49\u5230\u4e0b\u4e00\u8f6e\u6e05\u7406\u65f6\u624d\u80fd\u56de\u6536\u3002</p> <p>4. \u6e05\u7406</p> <p>5 . \u8f6c\u79fb</p> <ol> <li> <p>\u6839\u636e\u6700\u7ec8\u6807\u8bb0\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6bcf\u4e00\u4e2a\u533a\u57df\u7684\u5783\u573e\u5bf9\u8c61\u5360\u7528\u5185\u5b58\u5927\u5c0f\uff0c\u6839\u636e\u505c\u987f\u65f6\u95f4\uff0c\u9009\u62e9\u8f6c\u79fb\u6548\u7387\u6700\u9ad8\uff08\u5783\u573e\u5bf9\u8c61\u6700\u591a\uff09\u7684\u51e0\u4e2a\u533a\u57df\u3002</p> </li> <li> <p>\u8f6c\u79fb\u65f6\u5148\u8f6c\u79fbGC Root\u76f4\u63a5\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8f6c\u79fb\u5176\u4ed6\u5bf9\u8c61\u3002</p> </li> <li> <p>\u56de\u6536\u8001\u7684\u533a\u57df\uff0c\u5982\u679c\u5916\u90e8\u6709\u5176\u4ed6\u533a\u57df\u5bf9\u8c61\u5f15\u7528\u4e86\u8f6c\u79fb\u5bf9\u8c61\uff0c\u4e5f\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u5f15\u7528\u5173\u7cfb\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#zgc\u5783\u573e\u56de\u6536\u5668\u539f\u7406","title":"ZGC\u5783\u573e\u56de\u6536\u5668\u539f\u7406","text":"<p>ZGC \u662f\u4e00\u79cd\u53ef\u6269\u5c55\u7684\u4f4e\u5ef6\u8fdf\u5783\u573e\u56de\u6536\u5668\u3002ZGC \u5728\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\uff0cSTW\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7\u4e00\u6beb\u79d2\uff0c\u9002\u5408\u9700\u8981\u4f4e\u5ef6\u8fdf\u7684\u5e94\u7528\u3002\u652f\u6301\u51e0\u767e\u5146\u523016TB \u7684\u5806\u5927\u5c0f\uff0c\u5806\u5927\u5c0f\u5bf9STW\u7684\u65f6\u95f4\u57fa\u672c\u6ca1\u6709\u5f71\u54cd\u3002</p> <p>\u5728G1\u5783\u573e\u56de\u6536\u5668\u4e2d\uff0cSTW\u65f6\u95f4\u7684\u4e3b\u8981\u6765\u6e90\u662f\u5728\u8f6c\u79fb\u9636\u6bb5\uff1a</p> <ol> <li> <p>\u521d\u59cb\u6807\u8bb0\uff0cSTW\uff0c\u91c7\u7528\u4e09\u8272\u6807\u8bb0\u6cd5\u6807\u8bb0\u4eceGC Root\u53ef\u76f4\u8fbe\u7684\u5bf9\u8c61\u3002 STW\u65f6\u95f4\u6781\u77ed</p> </li> <li> <p>\u5e76\u53d1\u6807\u8bb0\uff0c\u5e76\u53d1\u6267\u884c\uff0c\u5bf9\u5b58\u6d3b\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0\u3002</p> </li> <li> <p>\u6700\u7ec8\u6807\u8bb0\uff0cSTW\uff0c\u5904\u7406SATB\u76f8\u5173\u7684\u5bf9\u8c61\u6807\u8bb0\u3002 STW\u65f6\u95f4\u6781\u77ed</p> </li> <li> <p>\u6e05\u7406\uff0cSTW\uff0c\u5982\u679c\u533a\u57df\u4e2d\u6ca1\u6709\u4efb\u4f55\u5b58\u6d3b\u5bf9\u8c61\u5c31\u76f4\u63a5\u6e05\u7406\u3002 STW\u65f6\u95f4\u6781\u77ed</p> </li> <li> <p>\u8f6c\u79fb\uff0c\u5c06\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230\u522b\u7684\u533a\u57df\u3002 STW\u65f6\u95f4\u8f83\u957f</p> </li> </ol> <p></p> <p>\u6ce8\u610f\u662f\u5e76\u53d1\u8f6c\u79fb</p> <p>\u95ee\u9898\uff1aG1\u8f6c\u79fb\u65f6\u9700\u8981\u505c\u987f\u7684\u4e3b\u8981\u539f\u56e0</p> <p>\u8f6c\u79fb\u5b8c\u4e4b\u540e\uff0c\u9700\u8981\u5c06A\u5bf9\u5bf9\u8c61\u7684\u5f15\u7528\u66f4\u6539\u4e3a\u65b0\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u4f46\u662f\u5728\u66f4\u6539\u524d\uff0c\u6267\u884cA.c.count= 2\uff0c\u6b64\u65f6\u66f4\u6539\u7684\u662f\u8f6c\u79fb\u524d\u5bf9\u8c61\u4e2d\u7684\u5c5e\u6027</p> <p>\u66f4\u6539\u5f15\u7528\u4e4b\u540e, A\u5f15\u7528\u4e86\u8f6c\u79fb\u4e4b\u540e\u7684\u5bf9\u8c61\uff0c\u6b64\u65f6\u83b7\u53d6A.c.count\u53d1\u73b0\u5c5e\u6027\u503c\u4f9d\u7136\u662f1\u3002\u8fd9\u6837\u5c31\u4ea7\u751f\u4e86\u95ee\u9898\uff0c\u6240\u4ee5G1\u4e3a\u4e86\u89e3\u51b3\u95ee\u9898\uff0c\u5728\u8f6c\u79fb\u8fc7\u7a0b\u4e2d\u9700\u8981\u8fdb\u884c\u7528\u6237\u7ebf\u7a0b\u7684\u505c\u6b62\u3002</p>"},{"location":"JVM/JVM-principle/#zgc\u7684\u89e3\u51b3\u5e76\u53d1\u8f6c\u79fb\u65b9\u6848","title":"ZGC\u7684\u89e3\u51b3\u5e76\u53d1\u8f6c\u79fb\u65b9\u6848","text":"<p>\u5728ZGC\u4e2d\uff0c\u4f7f\u7528\u4e86\u8bfb\u5c4f\u969cLoad Barrier\u6280\u672f\uff0c\u6765\u5b9e\u73b0\u8f6c\u79fb\u540e\u5bf9\u8c61\u7684\u83b7\u53d6\u3002\u5f53\u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61\u5f15\u7528\u65f6\uff0c\u4f1a\u89e6\u53d1\u8bfb\u540e\u7684\u5c4f\u969c\u6307\u4ee4\uff0c\u5982\u679c\u5bf9\u8c61\u6307\u5411\u7684\u4e0d\u662f\u8f6c\u79fb\u540e\u7684\u5bf9\u8c61\uff0c\u7528\u6237\u7ebf\u7a0b\u4f1a\u5c06\u5f15\u7528\u6307\u5411\u8f6c\u79fb\u540e\u7684\u5bf9\u8c61\u3002</p> <p>\u4f1a\u635f\u5931\u4e00\u90e8\u5206\u7684\u6027\u80fd\uff0c\u5927\u7ea6\u57285%~10%\u4e4b\u95f4\u3002</p>"},{"location":"JVM/JVM-principle/#\u7740\u8272\u6307\u9488colored-pointers","title":"\u7740\u8272\u6307\u9488\uff08Colored Pointers\uff09","text":"<p>\u4e0d\u652f\u630132\u4f4d\u7cfb\u7edf\u3001\u4e0d\u652f\u6301\u6307\u9488\u538b\u7f29</p> <p>\u8bbf\u95ee\u5bf9\u8c61\u5f15\u7528\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u5bf9\u8c61\u7684\u5730\u5740\u3002\u572864\u4f4d\u865a\u62df\u673a\u4e2d\uff0c8\u4e2a\u5b57\u8282\u53ef\u4ee5\u8868\u793a\u63a5\u8fd1\u65e0\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6240\u4ee5\u4e00\u822c\u5185\u5b58\u4e2d\u5bf9\u8c61\uff0c\u9ad8\u51e0\u4f4d\u90fd\u662f0\u6ca1\u6709\u4f7f\u7528\u3002\u7740\u8272\u6307\u9488\u5c31\u662f\u5229\u7528\u4e86\u8fd9\u591a\u4f59\u7684\u51e0\u4f4d\uff0c\u5b58\u50a8\u4e86\u72b6\u6001\u4fe1\u606f\u3002</p> <p>\u7740\u8272\u6307\u9488\u5c06\u539f\u6765\u76848\u5b57\u8282\u4fdd\u5b58\u5730\u5740\u7684\u6307\u9488\u62c6\u5206\u6210\u4e86\u4e09\u90e8\u5206\uff1a</p> <ol> <li> <p>\u6700\u4f4e\u768444\u4f4d\uff0c\u7528\u4e8e\u8868\u793a\u5bf9\u8c61\u7684\u5730\u5740\uff0c\u6240\u4ee5\u6700\u591a\u80fd\u8868\u793a16TB\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> </li> <li> <p>\u4e2d\u95f44\u4f4d\u662f\u989c\u8272\u4f4d\uff0c\u6bcf\u4e00\u4f4d\u53ea\u80fd\u5b58\u653e0\u6216\u80051\uff0c\u5e76\u4e14\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u5176\u4e2d\u4e00\u4f4d\u662f1\u3002    \u7ec8\u7ed3\u4f4d\uff1a\u53ea\u80fd\u901a\u8fc7\u7ec8\u7ed3\u5668\u8bbf\u95ee    \u91cd\u6620\u5c04\u4f4d(Remap)\uff1a\u8f6c\u79fb\u5b8c\u4e4b\u540e\uff0c\u5bf9\u8c61\u7684\u5f15\u7528\u5173\u7cfb\u5df2\u7ecf\u5b8c\u6210\u53d8\u66f4\u3002    Marked0\u548cMarked1\uff1a\u6807\u8bb0\u53ef\u8fbe\u5bf9\u8c61</p> </li> <li> <p>16\u4f4d\u672a\u4f7f\u7528</p> </li> </ol> <p>\u6b63\u5e38\u5e94\u7528\u7a0b\u5e8f\u4f7f\u75288\u4e2a\u5b57\u8282\u53bb\u8fdb\u884c\u5bf9\u8c61\u7684\u8bbf\u95ee\uff0c\u73b0\u5728\u53ea\u4f7f\u7528\u4e8644\u4f4d\uff0c\u4e0d\u4f1a\u4ea7\u751f\u95ee\u9898\u5417\uff1f \u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684\u5bf9\u8c61\u5730\u5740\uff0c\u53ea\u662f\u865a\u62df\u5185\u5b58\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u865a\u62df\u5185\u5b58\u8f6c\u6362\u6210\u7269\u7406\u5185\u5b58\u3002\u800cZGC\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u66f4\u6539\u4e86\u8fd9\u5c42\u903b\u8f91\u3002\u6240\u4ee5\u4e0d\u7ba1\u989c\u8272\u4f4d\u53d8\u6210\u591a\u5c11\uff0c\u6307\u9488\u6307\u5411\u7684\u90fd\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p>"},{"location":"JVM/JVM-principle/#shenandoahgc\u539f\u7406","title":"ShenandoahGC\u539f\u7406","text":"<p>ShenandoahGC\u548cZGC\u4e0d\u540c\uff0c ShenandoahGC\u5f88\u591a\u662f\u4f7f\u7528\u4e86G1\u6e90\u4ee3\u7801\u6539\u9020\u800c\u6210\uff0c\u6240\u4ee5\u5728\u5f88\u591a\u7b97\u6cd5\u3001\u6570\u636e\u7ed3\u6784\u7684\u5b9a\u4e49\u4e0a\uff0c\u4e0eG1\u5341\u5206\u76f8\u50cf\uff0c\u800cZGC\u662f\u5b8c\u5168\u91cd\u65b0\u5f00\u53d1\u7684\u4e00\u5957\u5185\u5bb9\u3002</p> <ol> <li> <p>ShenandoahGC\u7684\u533a\u57df\u5b9a\u4e49\u4e0eG1\u662f\u4e00\u6837\u7684\u3002</p> </li> <li> <p>\u6ca1\u6709\u7740\u8272\u6307\u9488\uff0c\u901a\u8fc7\u4fee\u6539\u5bf9\u8c61\u5934\u7684\u8bbe\u8ba1\u6765\u5b8c\u6210\u5e76\u53d1\u8f6c\u79fb\u8fc7\u7a0b\u7684\u5b9e\u73b0\u3002</p> </li> <li> <p>ShenandoahGC\u6709\u4e24\u4e2a\u7248\u672c\uff0c1.0\u7248\u672c\u5b58\u5728\u4e8eJDK8\u548cJDK11\u4e2d\uff0c\u540e\u7eed\u7684JDK\u7248\u672c\u4e2d\u5747\u4f7f\u75282.0\u7248\u672c\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#10\u7248\u672c","title":"1.0\u7248\u672c","text":"<p>\u5728\u5bf9\u8c61\u7684\u524d8\u4e2a\u5b57\u8282\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a\u524d\u5411\u6307\u9488\u3002\u524d\u5411\u6307\u9488\u6307\u5411\u8f6c\u79fb\u4e4b\u540e\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u6307\u5411\u81ea\u5df1\u3002</p> <ul> <li> <p>\u5982\u679c\u8f6c\u79fb\u9636\u6bb5\u672a\u5b8c\u6210\uff0c\u6b64\u65f6\u8f6c\u79fb\u524d\u7684\u5bf9\u8c61\u548c\u8f6c\u79fb\u540e\u7684\u5bf9\u8c61\u90fd\u4f1a\u5b58\u6d3b\u3002\u5982\u679c\u7528\u6237\u53bb\u8bbf\u95ee\u6570\u636e\uff0c\u9700\u8981\u4f7f\u7528\u8f6c\u79fb\u540e\u7684\u6570\u636e\u3002ShenandoahGC\u4f7f\u7528\u4e86\u8bfb\u524d\u5c4f\u969c\uff0c\u6839\u636e\u5bf9\u8c61\u7684\u524d\u5411\u6307\u9488\u6765\u83b7\u53d6\u5230\u8f6c\u79fb\u540e\u7684\u5bf9\u8c61\u5e76\u8bfb\u53d6\u3002</p> </li> <li> <p>\u5199\u5165\u6570\u636e\u65f6\u4f1a\u4f7f\u7528\u5199\u524d\u5c4f\u969c\uff0c\u5224\u65adMark Word\u4e2d\u7684GC\u72b6\u6001\uff0c\u5982\u679cGC\u72b6\u6001\u4e3a0\u8bc1\u660e\u6ca1\u6709\u5904\u4e8eGC\u8fc7\u7a0b\u4e2d\uff0c\u76f4\u63a5\u5199\u5165\uff0c\u5982\u679c\u4e0d\u4e3a0\u5219\u6839\u636eGC\u72b6\u6001\u503c\u786e\u8ba4\u5f53\u524d\u5904\u4e8e\u5783\u573e\u56de\u6536\u7684\u54ea\u4e2a\u9636\u6bb5\uff0c\u8ba9\u7528\u6237\u7ebf\u7a0b\u6267\u884c\u5783\u573e\u56de\u6536\u76f8\u5173\u7684\u4efb\u52a1\u3002</p> </li> </ul> <p>\u7f3a\u70b9</p> <ol> <li> <p>\u5bf9\u8c61\u5185\u5b58\u5927\u5927\u589e\u52a0\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u9700\u8981\u589e\u52a08\u4e2a\u5b57\u8282\u7684\u524d\u5411\u6307\u9488\uff0c\u57fa\u672c\u4e0a\u4f1a\u5360\u75285% -10%\u7684\u7a7a\u95f4\u3002</p> </li> <li> <p>\u8bfb\u5c4f\u969c\u4e2d\u52a0\u5165\u4e86\u590d\u6742\u7684\u6307\u4ee4\uff0c\u5f71\u54cd\u4f7f\u7528\u6548\u7387\u3002</p> </li> </ol>"},{"location":"JVM/JVM-principle/#20\u7248\u672c","title":"2.0\u7248\u672c","text":"<p>2.0\u7248\u672c\u4f18\u5316\u4e86\u524d\u5411\u6307\u9488\u7684\u4f4d\u7f6e\uff0c\u4ec5\u8f6c\u79fb\u9636\u6bb5\u5c06\u5176\u653e\u5165\u4e86Mark Word\u4e2d\u3002</p> <p></p> <p>\u7ea2\u8272\uff1aGC\u7ebf\u7a0b\u00a0\u00a0\u00a0\u00a0\u84dd\u8272\uff1a\u7528\u6237\u7ebf\u7a0b</p> <p>\u5e76\u53d1\u95ee\u9898</p> <p>\u5982\u679c\u7528\u6237\u7ebf\u7a0b\u5728\u5e2e\u5fd9\u8f6c\u79fb\u65f6\uff0cShenandoahGC\u7ebf\u7a0b\u4e5f\u53d1\u73b0\u8fd9\u4e2a\u5bf9\u8c61\u9700\u8981\u590d\u5236\uff0c\u90a3\u4e48\u5c31\u4f1a\u53bb\u5c1d\u8bd5\u5199\u5165\u524d\u5411\u6307\u9488\uff0c\u4f7f\u7528\u4e86\u7c7b\u4f3cCAS\uff08compare and swap\uff09\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u6210\u529f\u4fee\u6539\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4f1a\u653e\u5f03\u8f6c\u79fb\u7684\u64cd\u4f5c\u3002</p> <p>\u4e0a\u4e00\u8282\uff1aJVM \u5b9e\u8df5</p> <p>\u4e0b\u4e00\u8282\uff1aJVM \u603b\u7ed3</p>"},{"location":"JVM/JVM-summary/","title":"JVM\u603b\u7ed3","text":""},{"location":"JVM/JVM-summary/#\u4ec0\u4e48\u662fjvm","title":"\u4ec0\u4e48\u662fJVM","text":"<ul> <li> <p> JVM\u7684\u5b9a\u4e49</p> </li> <li> <p> \u4f5c\u7528</p> </li> <li> <p> \u529f\u80fd</p> </li> <li> <p> \u7ec4\u6210</p> </li> </ul> <p></p> <ol> <li> <p>\u5b9a\u4e49</p> <p>JVM\u6307\u7684\u662fJava\u865a\u62df\u673a\uff08Java Virtual Machine \uff09\u3002JVM \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u7a0b\u5e8f\uff0c\u4ed6\u7684\u804c\u8d23\u662f\u8fd0\u884cJava\u5b57\u8282\u7801\u6587\u4ef6\uff0cJava\u865a\u62df\u673a\u4e0a\u53ef\u4ee5\u8fd0\u884cJava\u3001Kotlin\u3001Scala\u3001Groovy\u7b49\u8bed\u8a00\u3002</p> </li> <li> <p>\u4f5c\u7528</p> <p>\u652f\u6301Java\u4e2dWrite Once\uff0cRun Anywhere\uff1b\u7f16\u5199\u4e00\u6b21\uff0c\u5230\u5904\u8fd0\u884c\u7684\u8de8\u5e73\u53f0\u7279\u6027\u3002</p> </li> <li> <p>\u529f\u80fd</p> <ul> <li> <p>\u89e3\u91ca\u548c\u8fd0\u884c</p> <ul> <li>\u5bf9\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u7684\u6307\u4ee4\uff0c\u5b9e\u65f6\u7684\u89e3\u91ca\u6210\u673a\u5668\u7801\uff0c\u8ba9\u8ba1\u7b97\u673a\u6267\u884c</li> </ul> </li> <li> <p>\u5185\u5b58\u7ba1\u7406</p> <ul> <li> <p>\u81ea\u52a8\u4e3a\u5bf9\u8c61\u3001\u65b9\u6cd5\u7b49\u5206</p> </li> <li> <p>\u81ea\u52a8\u7684\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u56de\u6536\u4e0d\u518d\u4f7f\u7528\u7684\u5bf9\u8c61</p> </li> </ul> </li> <li> <p>\u5373\u65f6\u7f16\u8bd1</p> <ul> <li>\u5bf9\u70ed\u70b9\u4ee3\u7801\u8fdb\u884c\u4f18\u5316(JIT\u5373\u65f6\u7f16\u8bd1)\uff0c\u63d0\u5347\u6267\u884c\u6548\u7387</li> </ul> </li> </ul> </li> <li> <p>\u7ec4\u6210</p> <p></p> </li> <li> <p>JVM\u9009\u62e9</p> <ul> <li> <p>\u6700\u5e38\u7528\u7684JVM:Oracle\u63d0\u4f9b\u7684Hotspot \u3001OpenJDK\u7684Hotspot</p> </li> <li> <p>\u6709JVM\u4e8c\u6b21\u5f00\u53d1\u9700\u8981:OpenJDK\u7684Hotspot</p> </li> <li> <p>\u4e91\u539f\u751f\u67b6\u6784\u9ad8\u6027\u80fd\u9700\u6c42:GraalVM OpenJ9</p> </li> <li> <p>\u7535\u5546\u7269\u6d41\u91d1\u878d\u9ad8\u6027\u80fd\u9700\u6c42:GraalVM\u963f\u91ccDragonWell\u9f99\u4e95</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-summary/#\u5b57\u8282\u7801\u6587\u4ef6\u7684\u7ec4\u6210","title":"\u5b57\u8282\u7801\u6587\u4ef6\u7684\u7ec4\u6210","text":"<ul> <li> <p> \u67e5\u770b\u5b57\u8282\u7801\u6587\u4ef6\u5e38\u7528\u5de5\u5177</p> </li> <li> <p> \u5b57\u8282\u7801\u6587\u4ef6\u7684\u7ec4\u6210</p> </li> <li> <p> \u5e94\u7528\u573a\u666f\uff1a\u5de5\u4f5c\u4e2d\u4e00\u822c\u4e0d\u76f4\u63a5\u67e5\u770b\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u53ea\u7528\u4e8e\u6df1\u5165\u4e86\u89e3JVM</p> </li> </ul> <p></p> <ol> <li> <p>\u67e5\u770b\u5b57\u8282\u7801\u6587\u4ef6\u7684\u5de5\u5177</p> <ul> <li> <p>\u5f00\u53d1\u73af\u5883\u4f7f\u7528<code>jclasslib</code>\u63d2\u4ef6</p> </li> <li> <p>\u670d\u52a1\u5668\u73af\u5883\u4f7f\u7528<code>javap -v</code>\u547d\u4ee4</p> </li> </ul> </li> <li> <p>\u7ec4\u6210</p> </li> </ol> <p></p>"},{"location":"JVM/JVM-summary/#\u4ec0\u4e48\u662f\u8fd0\u884c\u65f6\u6570\u636e\u533a","title":"\u4ec0\u4e48\u662f\u8fd0\u884c\u65f6\u6570\u636e\u533a","text":"<ul> <li> <p> \u7a0b\u5e8f\u8ba1\u6570\u5668</p> </li> <li> <p> \u6808</p> </li> <li> <p> \u5806</p> </li> <li> <p> \u65b9\u6cd5\u533a</p> </li> <li> <p> \u76f4\u63a5\u5185\u5b58\uff08\u53ef\u9009\u9879\uff0c\u4e0d\u5c5e\u4e8e\u8fd0\u884c\u65f6\u6570\u636e\u533a\uff09</p> </li> </ul> <p></p> <ol> <li> <p>\u5b9a\u4e49</p> <p>\u8fd0\u884c\u65f6\u6570\u636e\u533a\u6307\u7684\u662fJVM\u6240\u7ba1\u7406\u7684\u5185\u5b58\u533a\u57df\uff0c\u5176\u4e2d\u5206\u6210\u4e24\u5927\u7c7b\uff1a</p> <ul> <li> <p>\u7ebf\u7a0b\u5171\u4eab \u2013\u65b9\u6cd5\u533a\u3001\u5806</p> </li> <li> <p>\u7ebf\u7a0b\u4e0d\u5171\u4eab \u2013\u672c\u5730\u65b9\u6cd5\u6808\u3001\u865a\u62df\u673a\u6808\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668</p> </li> </ul> <p>\u76f4\u63a5\u5185\u5b58\u4e3b\u8981\u662fNIO\u4f7f\u7528\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u76f4\u63a5\u7ba1\u7406\uff0c\u4e0d\u5c5e\u4e8eJVM\u5185\u5b58\u3002</p> </li> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668</p> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08Program Counter Register\uff09\u4e5f\u53ebPC\u5bc4\u5b58\u5668\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u5f53\u524d\u8981\u6267\u884c\u7684\u7684\u5b57\u8282\u7801\u6307\u4ee4\u7684\u5730\u5740\u3002\u4e3b\u8981\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a</p> <ul> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u53ef\u4ee5\u63a7\u5236\u7a0b\u5e8f\u6307\u4ee4\u7684\u8fdb\u884c\uff0c\u5b9e\u73b0\u5206\u652f\u3001\u8df3\u8f6c\u3001\u5f02\u5e38\u7b49\u903b\u8f91\u3002</p> </li> <li> <p>\u5728\u591a\u7ebf\u7a0b\u6267\u884c\u60c5\u51b5\u4e0b\uff0cJava\u865a\u62df\u673a\u9700\u8981\u901a\u8fc7\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55CPU\u5207\u6362\u524d\u89e3\u91ca\u6267\u884c\u5230\u90a3\u4e00\u53e5\u6307\u4ee4\u5e76\u7ee7\u7eed\u89e3\u91ca\u8fd0\u884c\u3002</p> </li> </ul> </li> <li> <p>\u6808</p> <p>Java\u865a\u62df\u673a\u6808\u91c7\u7528\u6808\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ba1\u7406\u65b9\u6cd5\u8c03\u7528\u4e2d\u7684\u57fa\u672c\u6570\u636e\uff0c\u5148\u8fdb\u540e\u51fa ,\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u7684\u8c03\u7528\u4f7f\u7528\u4e00\u4e2a\u6808\u5e27\u6765\u4fdd\u5b58\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u81ea\u5df1\u7684\u865a\u62df\u673a\u6808\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u548c\u7ebf\u7a0b\u76f8\u540c\u3002 \u6808\u5e27\u4e3b\u8981\u5305\u542b\u4e09\u90e8\u5206\u5185\u5bb9\uff1a</p> <ul> <li> <p>\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u5728\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u5b58\u653e\u6240\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p> </li> <li> <p>\u64cd\u4f5c\u6570\u6808\uff0c\u865a\u62df\u673a\u5728\u6267\u884c\u6307\u4ee4\u8fc7\u7a0b\u4e2d\u7528\u6765\u5b58\u653e\u4e34\u65f6\u6570\u636e\u7684\u4e00\u5757\u533a\u57df\u3002</p> </li> <li> <p>\u5e27\u6570\u636e\uff0c\u4e3b\u8981\u5305\u542b\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\u3001\u5f02\u5e38\u8868\u7b49\u5185\u5bb9\u3002</p> </li> </ul> <p>\u52a8\u6001\u94fe\u63a5\uff1a\u65b9\u6cd5\u4e2d\u8981\u7528\u5230\u5176\u4ed6\u7c7b\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u5185\u5bb9\u5728\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u662f\u4ee5\u7f16\u53f7\u4fdd\u5b58\u7684\uff0c\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u66ff\u6362\u6210\u5185\u5b58\u4e2d\u7684\u5730\u5740\uff0c\u8fd9\u4e2a\u7f16\u53f7\u5230\u5185\u5b58\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u5c31\u4fdd\u5b58\u5728\u52a8\u6001\u94fe\u63a5\u4e2d\u3002</p> <p>\u65b9\u6cd5\u51fa\u53e3\uff1a\u65b9\u6cd5\u8c03\u7528\u5b8c\u9700\u8981\u5f39\u51fa\u6808\u5e27\uff0c\u56de\u5230\u4e0a\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u8981\u5207\u6362\u5230\u4e0a\u4e00\u4e2a\u65b9\u6cd5\u7684\u5730\u5740\u7ee7\u7eed\u6267\u884c\uff0c\u65b9\u6cd5\u51fa\u53e3\u4fdd\u5b58\u7684\u5c31\u662f\u8fd9\u4e2a\u5730\u5740\u3002</p> <p>\u5f02\u5e38\u8868\uff1a\u5b58\u653e\u7684\u662f\u4ee3\u7801\u4e2d\u5f02\u5e38\u7684\u5904\u7406\u4fe1\u606f\uff0c\u5305\u542b\u4e86\u5f02\u5e38\u6355\u83b7\u7684\u751f\u6548\u8303\u56f4\u4ee5\u53ca\u5f02\u5e38\u53d1\u751f\u540e\u8df3\u8f6c\u5230\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4f4d\u7f6e\u3002</p> </li> </ol> <p>\u672c\u5730\u65b9\u6cd5\u6808\uff0cJava\u865a\u62df\u673a\u6808\u5b58\u50a8\u4e86Java\u65b9\u6cd5\u8c03\u7528\u65f6\u7684\u6808\u5e27\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5b58\u50a8\u7684\u662fnative\u672c\u5730\u65b9\u6cd5\u7684\u6808\u5e27\u3002\u5728Hotspot\u865a\u62df\u673a\u4e2d\uff0cJava\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\u5b9e\u73b0\u4e0a\u4f7f\u7528\u4e86\u540c\u4e00\u4e2a\u6808\u7a7a\u95f4\u3002\u672c\u5730\u65b9\u6cd5\u6808\u4f1a\u5728\u6808\u5185\u5b58\u4e0a\u751f\u6210\u4e00\u4e2a\u6808\u5e27\uff0c\u4e34\u65f6\u4fdd\u5b58\u65b9\u6cd5\u7684\u53c2\u6570\u540c\u65f6\u65b9\u4fbf\u51fa\u73b0\u5f02\u5e38\u65f6\u4e5f\u628a\u672c\u5730\u65b9\u6cd5\u7684\u6808\u4fe1\u606f\u6253\u5370\u51fa\u6765\u3002</p> <ol> <li> <p>\u5806</p> <ul> <li> <p>\u4e00\u822cJava\u7a0b\u5e8f\u4e2d\u5806\u5185\u5b58\u662f\u7a7a\u95f4\u6700\u5927\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\u3002\u521b\u5efa\u51fa\u6765\u7684\u5bf9\u8c61\u90fd\u5b58\u5728\u4e8e\u5806\u4e0a\u3002</p> </li> <li> <p>\u6808\u4e0a\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\uff0c\u53ef\u4ee5\u5b58\u653e\u5806\u4e0a\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u9759\u6001\u53d8\u91cf\u4e5f\u53ef\u4ee5\u5b58\u653e\u5806\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u901a\u8fc7\u9759\u6001\u53d8\u91cf\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u8c61\u5728\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u3002</p> </li> <li> <p>\u5806\u662f\u5783\u573e\u56de\u6536\u6700\u4e3b\u8981\u7684\u90e8\u5206\uff0c\u5806\u7ed3\u6784\u66f4\u8be6\u7ec6\u7684\u5212\u5206\u4e0e\u5783\u573e\u56de\u6536\u5668\u6709\u5173\u3002</p> </li> </ul> </li> <li> <p>\u65b9\u6cd5\u533a</p> <p>\u65b9\u6cd5\u533a\u662fJava\u865a\u62df\u673a\u89c4\u8303\u4e2d\u63d0\u51fa\u6765\u7684\u4e00\u4e2a\u865a\u62df\u673a\u6982\u5ff5\uff0c\u5728HotSpot\u4e0d\u540c\u7248\u672c\u4e2d\u4f1a\u7528\u6c38\u4e45\u4ee3\u6216\u8005\u5143\u7a7a\u95f4\u6765\u5b9e\u73b0\u3002\u65b9\u6cd5\u533a\u4e3b\u8981\u5b58\u653e\u7684\u662f\u57fa\u7840\u4fe1\u606f\uff0c\u5305\u542b\uff1a</p> <ul> <li> <p>\u6bcf\u4e00\u4e2a\u52a0\u8f7d\u7684\u7c7b\u7684\u5143\u4fe1\u606f\uff08\u57fa\u7840\u4fe1\u606f\uff09\u3002</p> </li> <li> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff0c\u4fdd\u5b58\u4e86\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u7684\u5e38\u91cf\u6c60\u5185\u5bb9\uff0c\u907f\u514d\u5e38\u91cf\u5185\u5bb9\u91cd\u590d\u521b\u5efa\u51cf\u5c11\u5185\u5b58\u5f00\u9500\u3002</p> </li> <li> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u5b58\u50a8\u5b57\u7b26\u4e32\u7684\u5e38\u91cf\u3002</p> </li> </ul> </li> </ol> <p>\u76f4\u63a5\u5185\u5b58</p> <p>\u5176\u5e76\u4e0d\u5728\u300aJava\u865a\u62df\u673a\u89c4\u8303\u300b\u4e2d\u5b58\u5728\uff0c\u6240\u4ee5\u5e76\u4e0d\u5c5e\u4e8eJava\u8fd0\u884c\u65f6\u7684\u5185\u5b58\u533a\u57df\u3002</p> <p>\u5728 JDK 1.4 \u4e2d\u5f15\u5165\u4e86 NIO \u673a\u5236\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u76f4\u63a5\u7ba1\u7406\u8fd9\u90e8\u5206\u5185\u5bb9\uff0c\u4e3b\u8981\u4e3a\u4e86\u63d0\u5347\u8bfb\u5199\u6570\u636e\u7684\u6027\u80fd\u3002</p> <p>\u5728\u7f51\u7edc\u7f16\u7a0b\u6846\u67b6\u5982Netty\u4e2d\u88ab\u5927\u91cf\u4f7f\u7528\u3002\u8981\u521b\u5efa\u76f4\u63a5\u5185\u5b58\u4e0a\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528ByteBuffer\u3002\u8bed\u6cd5\uff1a <code>ByteBuffer directBuffer = ByteBuffer.allocateDirect(size);</code></p>"},{"location":"JVM/JVM-summary/#\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u7684\u533a\u57df","title":"\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u7684\u533a\u57df","text":"<p>\u5185\u5b58\u6ea2\u51fa\u6307\u7684\u662f\u5185\u5b58\u4e2d\u67d0\u4e00\u5757\u533a\u57df\u7684\u4f7f\u7528\u91cf\u8d85\u8fc7\u4e86\u5141\u8bb8\u4f7f\u7528\u7684\u6700\u5927\u503c\uff0c\u4ece\u800c\u4f7f\u7528\u5185\u5b58\u65f6\u56e0\u7a7a\u95f4\u4e0d\u8db3\u800c\u5931\u8d25\uff0c\u865a\u62df\u673a\u4e00\u822c\u4f1a\u629b\u51fa\u6307\u5b9a\u7684\u9519\u8bef\u3002</p> <p>\u5728Java\u865a\u62df\u673a\u4e2d\uff0c\u53ea\u6709\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e0d\u4f1a\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\u53ea\u4fdd\u5b58\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u5730\u5740\u3002</p> <ul> <li>\u5806\u5185\u5b58\u6ea2\u51fa\uff1a</li> </ul> <p>\u5806\u5185\u5b58\u6ea2\u51fa\u6307\u7684\u662f\u5728\u5806\u4e0a\u5206\u914d\u7684\u5bf9\u8c61\u7a7a\u95f4\u8d85\u8fc7\u4e86\u5806\u7684\u6700\u5927\u5927\u5c0f\uff0c\u4ece\u800c\u5bfc\u81f4\u7684\u5185\u5b58\u6ea2\u51fa\u3002\u5806\u7684\u6700\u5927\u5927\u5c0f\u4f7f\u7528-Xmx\u53c2\u6570\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5982-Xmx10m\u4ee3\u8868\u6700\u5927\u5806\u5185\u5b58\u5927\u5c0f\u4e3a10m\u3002\u6ea2\u51fa\u4e4b\u540e\u4f1a\u629b\u51faOutOfMemoryError\uff0c\u5e76\u63d0\u793a\u662fJava heap Space\u5bfc\u81f4\u7684</p> <ul> <li>\u6808\u5185\u5b58\u6ea2\u51fa\uff1a</li> </ul> <p>\u6808\u5185\u5b58\u6ea2\u51fa\u6307\u7684\u662f\u6240\u6709\u6808\u5e27\u7a7a\u95f4\u7684\u5360\u7528\u5185\u5b58\u8d85\u8fc7\u4e86\u6700\u5927\u503c\uff0c\u6700\u5927\u503c\u4f7f\u7528-Xss\u8fdb\u884c\u8bbe\u7f6e\uff0c\u6bd4\u5982-Xss256k\u4ee3\u8868\u6240\u6709\u6808\u5e27\u5360\u7528\u5185\u5b58\u5927\u5c0f\u52a0\u8d77\u6765\u4e0d\u80fd\u8d85\u8fc7256k\u3002\u6ea2\u51fa\u4e4b\u540e\u4f1a\u629b\u51faStackOverflowError</p> <ul> <li>\u65b9\u6cd5\u533a\u5185\u5b58\u6ea2\u51fa\uff1a</li> </ul> <p>\u65b9\u6cd5\u533a\u5185\u5b58\u6ea2\u51fa\u6307\u7684\u662f\u65b9\u6cd5\u533a\u4e2d\u5b58\u653e\u7684\u5185\u5bb9\u6bd4\u5982\u7c7b\u7684\u5143\u4fe1\u606f\u8d85\u8fc7\u4e86\u65b9\u6cd5\u533a\u5185\u5b58\u7684\u6700\u5927\u503c\uff0cJDK7\u53ca\u4e4b\u524d\u7248\u672c\u65b9\u6cd5\u533a\u4f7f\u7528\u6c38\u4e45\u4ee3\uff08-XX:MaxPermSize=\u503c\uff09\u6765\u5b9e\u73b0\uff0cJDK8\u53ca\u4e4b\u540e\u4f7f\u7528\u5143\u7a7a\u95f4\uff08-XX:MaxMetaspaceSize=\u503c\uff09\u6765\u5b9e\u73b0\u3002</p> <ul> <li>\u76f4\u63a5\u5185\u5b58\u6ea2\u51fa\uff1a</li> </ul> <p>\u76f4\u63a5\u5185\u5b58\u6ea2\u51fa\u6307\u7684\u662f\u7533\u8bf7\u7684\u76f4\u63a5\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u8d85\u8fc7\u4e86\u6700\u5927\u503c\uff0c\u4f7f\u7528 -XX:MaxDirectMemorySize=\u503c \u8bbe\u7f6e\u6700\u5927\u503c\u3002\u6ea2\u51fa\u4e4b\u540e\u4f1a\u629b\u51faOutOfMemoryError</p>"},{"location":"JVM/JVM-summary/#jvm\u5728jdk6-8\u4e4b\u95f4\u5728\u5185\u5b58\u533a\u57df\u4e0a\u6709\u4ec0\u4e48\u4e0d\u540c","title":"JVM\u5728JDK6-8\u4e4b\u95f4\u5728\u5185\u5b58\u533a\u57df\u4e0a\u6709\u4ec0\u4e48\u4e0d\u540c","text":"<ol> <li> <p>\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0</p> <ul> <li> <p>JDK7\u53ca\u4e4b\u524d\u7684\u7248\u672c\u5c06\u65b9\u6cd5\u533a\u5b58\u653e\u5728\u5806\u533a\u57df\u4e2d\u7684\u6c38\u4e45\u4ee3\u7a7a\u95f4\uff0c\u5806\u7684\u5927\u5c0f\u7531\u865a\u62df\u673a\u53c2\u6570\u6765\u63a7\u5236\u3002</p> </li> <li> <p>JDK8\u53ca\u4e4b\u540e\u7684\u7248\u672c\u5c06\u65b9\u6cd5\u533a\u5b58\u653e\u5728\u5143\u7a7a\u95f4\u4e2d\uff0c\u5143\u7a7a\u95f4\u4f4d\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7ef4\u62a4\u7684\u76f4\u63a5\u5185\u5b58\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u8981\u4e0d\u8d85\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u627f\u53d7\u7684\u4e0a\u9650\uff0c\u53ef\u4ee5\u4e00\u76f4\u5206\u914d\u3002\u4e5f\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e\u6700\u5927\u5927\u5c0f\u3002</p> </li> </ul> <p>\u4f7f\u7528\u5143\u7a7a\u95f4\u66ff\u6362\u6c38\u4e45\u4ee3\u7684\u539f\u56e0</p> <ul> <li> <p>\u63d0\u9ad8\u5185\u5b58\u4e0a\u9650\uff1a\u5143\u7a7a\u95f4\u4f7f\u7528\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\uff0c\u800c\u4e0d\u662fJVM\u5185\u5b58\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\u4e0a\u9650\uff0c\u53ea\u8981\u4e0d\u8d85\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u4e0a\u9650\uff0c\u5c31\u53ef\u4ee5\u6301\u7eed\u5206\u914d\u3002\u800c\u6c38\u4e45\u4ee3\u5728\u5806\u4e2d\uff0c\u53ef\u4f7f\u7528\u7684\u5185\u5b58\u4e0a\u9650\u662f\u6709\u9650\u7684\u3002\u6240\u4ee5\u4f7f\u7528\u5143\u7a7a\u95f4\u53ef\u4ee5\u6709\u6548\u51cf\u5c11OOM\u60c5\u51b5\u7684\u51fa\u73b0\u3002</p> </li> <li> <p>\u4f18\u5316\u5783\u573e\u56de\u6536\u7684\u7b56\u7565\uff1a\u6c38\u4e45\u4ee3\u5728\u5806\u4e0a\uff0c\u5783\u573e\u56de\u6536\u673a\u5236\u4e00\u822c\u4f7f\u7528\u8001\u5e74\u4ee3\u7684\u5783\u573e\u56de\u6536\u65b9\u5f0f\uff0c\u4e0d\u591f\u7075\u6d3b\u3002\u4f7f\u7528\u5143\u7a7a\u95f4\u4e4b\u540e\u5355\u72ec\u8bbe\u8ba1\u4e86\u4e00\u5957\u9002\u5408\u65b9\u6cd5\u533a\u7684\u5783\u573e\u56de\u6536\u673a\u5236\u3002</p> </li> </ul> </li> <li> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u7684\u4f4d\u7f6e</p> </li> </ol> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4ece\u65b9\u6cd5\u533a\u79fb\u52a8\u5230\u5806\u7684\u539f\u56e0\uff1a</p> <ol> <li> <p>\u5783\u573e\u56de\u6536\u4f18\u5316\uff1a\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u7684\u56de\u6536\u903b\u8f91\u548c\u5bf9\u8c61\u7684\u56de\u6536\u903b\u8f91\u7c7b\u4f3c\uff0c\u5185\u5b58\u4e0d\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u7684\u5e38\u91cf\u4e0d\u88ab\u4f7f\u7528\u5c31\u53ef\u4ee5\u88ab\u56de\u6536\uff1b\u65b9\u6cd5\u533a\u4e2d\u7684\u7c7b\u7684\u5143\u4fe1\u606f\u56de\u6536\u903b\u8f91\u66f4\u590d\u6742\u4e00\u4e9b\u3002\u79fb\u52a8\u5230\u5806\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u5bf9\u8c61\u7684\u5783\u573e\u56de\u6536\u5668\uff0c\u5bf9\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u8fdb\u884c\u56de\u6536\u3002</p> </li> <li> <p>\u8ba9\u65b9\u6cd5\u533a\u5927\u5c0f\u66f4\u53ef\u63a7\uff1a\u4e00\u822c\u5728\u9879\u76ee\u4e2d\uff0c\u7c7b\u7684\u5143\u4fe1\u606f\u4e0d\u4f1a\u5360\u7528\u7279\u522b\u5927\u7684\u7a7a\u95f4\uff0c\u6240\u4ee5\u4f1a\u7ed9\u65b9\u6cd5\u533a\u8bbe\u7f6e\u4e00\u4e2a\u6bd4\u8f83\u5c0f\u7684\u4e0a\u9650\u3002\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5728\u65b9\u6cd5\u533a\u4e2d\uff0c\u4f1a\u8ba9\u65b9\u6cd5\u533a\u7684\u7a7a\u95f4\u5927\u5c0f\u53d8\u5f97\u4e0d\u53ef\u63a7\u3002</p> </li> <li> <p>intern\u65b9\u6cd5\u7684\u4f18\u5316\uff1aJDK6\u7248\u672c\u4e2dintern () \u65b9\u6cd5\u4f1a\u628a\u7b2c\u4e00\u6b21\u9047\u5230\u7684\u5b57\u7b26\u4e32\u5b9e\u4f8b\u590d\u5236\u5230\u6c38\u4e45\u4ee3\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u3002JDK7\u53ca\u4e4b\u540e\u7248\u672c\u4e2d\u7531\u4e8e\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5728\u5806\u4e0a\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u4f18\u5316\uff1a\u5b57\u7b26\u4e32\u4fdd\u5b58\u5728\u5806\u4e0a\uff0c\u628a\u5b57\u7b26\u4e32\u7684\u5f15\u7528\u653e\u5165\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u51cf\u5c11\u4e86\u590d\u5236\u7684\u64cd\u4f5c\u3002</p> </li> </ol>"},{"location":"JVM/JVM-summary/#\u7c7b\u7684\u751f\u547d\u5468\u671f","title":"\u7c7b\u7684\u751f\u547d\u5468\u671f","text":"<ul> <li> <p> \u52a0\u8f7d</p> </li> <li> <p> \u8fde\u63a5\uff08\u9a8c\u8bc1\u3001\u51c6\u5907\u3001\u89e3\u6790\uff09</p> </li> <li> <p> \u521d\u59cb\u5316</p> </li> <li> <p> \u5378\u8f7d</p> </li> </ul> <p></p> <ol> <li> <p>\u52a0\u8f7d</p> <ul> <li> <p>\u52a0\u8f7d(Loading)\u9636\u6bb5\u7b2c\u4e00\u6b65\u662f\u7c7b\u52a0\u8f7d\u5668\u6839\u636e\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u901a\u8fc7\u4e0d\u540c\u7684\u6e20\u9053\u4ee5\u4e8c\u8fdb\u5236\u6d41\u7684\u65b9\u5f0f\u83b7\u53d6\u5b57\u8282\u7801\u4fe1\u606f\u3002\u7a0b\u5e8f\u5458\u53ef\u4ee5\u4f7f\u7528Java\u4ee3\u7801\u62d3\u5c55\u7684\u4e0d\u540c\u7684\u6e20\u9053\u3002</p> </li> <li> <p>\u7c7b\u52a0\u8f7d\u5668\u5728\u52a0\u8f7d\u5b8c\u7c7b\u4e4b\u540e\uff0cJava\u865a\u62df\u673a\u4f1a\u5c06\u5b57\u8282\u7801\u4e2d\u7684\u4fe1\u606f\u4fdd\u5b58\u5230\u5185\u5b58\u7684\u65b9\u6cd5\u533a\u4e2d\u3002\u5728\u65b9\u6cd5\u533a\u751f\u6210\u4e00\u4e2aInstanceKlass\u5bf9\u8c61\uff0c\u4fdd\u5b58\u7c7b\u7684\u6240\u6709\u4fe1\u606f\u3002</p> </li> <li> <p>\u5728\u5806\u4e2d\u751f\u6210\u4e00\u4efd\u4e0e\u65b9\u6cd5\u533a\u4e2d\u6570\u636e\u7c7b\u4f3c\u7684java.lang.Class\u5bf9\u8c61\uff0c \u4f5c\u7528\u662f\u5728Java\u4ee3\u7801\u4e2d\u53bb\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f\u3002</p> </li> </ul> </li> <li> <p>\u8fde\u63a5</p> <ul> <li> <p>\u9a8c\u8bc1</p> <ul> <li> <p>\u9a8c\u8bc1\u7684\u4e3b\u8981\u76ee\u7684\u662f\u68c0\u6d4bJava\u5b57\u8282\u7801\u6587\u4ef6\u662f\u5426\u9075\u5b88\u4e86\u300aJava\u865a\u62df\u673a\u89c4\u8303\u300b\u4e2d\u7684\u7ea6\u675f\u3002\u8fd9\u4e2a\u9636\u6bb5\u4e00\u822c\u4e0d\u9700\u8981\u7a0b\u5e8f\u5458\u53c2\u4e0e\u3002</p> </li> <li> <p>\u4e3b\u8981\u5305\u542b\u5982\u4e0b\u56db\u90e8\u5206\uff0c\u5177\u4f53\u8be6\u89c1\u300aJava\u865a\u62df\u673a\u89c4\u8303\u300b\uff1a</p> <ol> <li> <p>\u6587\u4ef6\u683c\u5f0f\u9a8c\u8bc1\uff0c\u6bd4\u5982\u6587\u4ef6\u662f\u5426\u4ee50xCAFEBABE\u5f00\u5934\uff0c\u4e3b\u6b21\u7248\u672c\u53f7\u662f\u5426\u6ee1\u8db3\u5f53\u524dJava\u865a\u62df\u673a\u7248\u672c\u8981\u6c42\u3002</p> </li> <li> <p>\u5143\u4fe1\u606f\u9a8c\u8bc1\uff0c\u4f8b\u5982\u7c7b\u5fc5\u987b\u6709\u7236\u7c7b\uff08super\u4e0d\u80fd\u4e3a\u7a7a\uff09\u3002</p> </li> <li> <p>\u9a8c\u8bc1\u7a0b\u5e8f\u6267\u884c\u6307\u4ee4\u7684\u8bed\u4e49\uff0c\u6bd4\u5982\u65b9\u6cd5\u5185\u7684\u6307\u4ee4\u6267\u884c\u5230\u4e00\u534a\u5f3a\u884c\u8df3\u8f6c\u5230\u5176\u4ed6\u65b9\u6cd5\u4e2d\u53bb\u3002</p> </li> <li> <p>\u7b26\u53f7\u5f15\u7528\u9a8c\u8bc1\uff0c\u4f8b\u5982\u662f\u5426\u8bbf\u95ee\u4e86\u5176\u4ed6\u7c7b\u4e2dprivate\u7684\u65b9\u6cd5\u7b49\u3002</p> </li> </ol> </li> </ul> </li> <li> <p>\u51c6\u5907</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\u4e3a\u9759\u6001\u53d8\u91cf\uff08static\uff09\u5206\u914d\u5185\u5b58\u5e76\u8bbe\u7f6e\u521d\u503c\u3002final\u4fee\u9970\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u9759\u6001\u53d8\u91cf\uff0c\u51c6\u5907\u9636\u6bb5\u76f4\u63a5\u4f1a\u5c06\u4ee3\u7801\u4e2d\u7684\u503c\u8fdb\u884c\u8d4b\u503c\u3002</li> </ul> </li> <li> <p>\u89e3\u6790</p> <ul> <li>\u89e3\u6790\u9636\u6bb5\u4e3b\u8981\u662f\u5c06\u5e38\u91cf\u6c60\u4e2d\u7684\u7b26\u53f7\u5f15\u7528\u66ff\u6362\u4e3a\u76f4\u63a5\u5f15\u7528\u3002\u7b26\u53f7\u5f15\u7528\u5c31\u662f\u5728\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u4f7f\u7528\u7f16\u53f7\u6765\u8bbf\u95ee\u5e38\u91cf\u6c60\u4e2d\u7684\u5185\u5bb9\u3002\u76f4\u63a5\u5f15\u7528\u4e0d\u5728\u4f7f\u7528\u7f16\u53f7\uff0c\u800c\u662f\u4f7f\u7528\u5185\u5b58\u4e2d\u5730\u5740\u8fdb\u884c\u8bbf\u95ee\u5177\u4f53\u7684\u6570\u636e\u3002</li> </ul> </li> </ul> </li> <li> <p>\u521d\u59cb\u5316</p> <ul> <li> <p>\u521d\u59cb\u5316\u9636\u6bb5\u4f1a\u6267\u884c\u9759\u6001\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\uff0c\u5e76\u4e3a\u9759\u6001\u53d8\u91cf\u8d4b\u503c\u3002</p> </li> <li> <p>\u521d\u59cb\u5316\u9636\u6bb5\u4f1a\u6267\u884c\u5b57\u8282\u7801\u6587\u4ef6\u4e2dclinit\u90e8\u5206\u7684\u5b57\u8282\u7801\u6307\u4ee4\u3002</p> </li> </ul> </li> <li> <p>\u5378\u8f7d</p> <p>\u5224\u5b9a\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u88ab\u5378\u8f7d\u3002\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e0b\u9762\u4e09\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li> <p>\u6b64\u7c7b\u6240\u6709\u5b9e\u4f8b\u5bf9\u8c61\u90fd\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u5728\u5806\u4e2d\u4e0d\u5b58\u5728\u4efb\u4f55\u8be5\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u4ee5\u53ca\u5b50\u7c7b\u5bf9\u8c61\u3002</p> </li> <li> <p>\u52a0\u8f7d\u8be5\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\u5df2\u7ecf\u88ab\u56de\u6536\u3002</p> </li> <li> <p>\u8be5\u7c7b\u5bf9\u5e94\u7684java.lang.Class \u5bf9\u8c61\u6ca1\u6709\u5728\u4efb\u4f55\u5730\u65b9\u88ab\u5f15\u7528</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-summary/#\u7c7b\u52a0\u8f7d\u5668","title":"\u7c7b\u52a0\u8f7d\u5668","text":"<ul> <li> <p> \u7c7b\u52a0\u8f7d\u5668\u7684\u4f5c\u7528</p> </li> <li> <p> \u542f\u52a8\u7c7b\u52a0\u8f7d\u5668</p> </li> <li> <p> \u6269\u5c55/\u5e73\u53f0\u7c7b\u52a0\u8f7d\u5668</p> </li> <li> <p> \u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668</p> </li> <li> <p> \u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\uff08\u53ef\u9009\uff09</p> </li> </ul> <p></p> <ol> <li> <p>\u4f5c\u7528</p> <p>\u7c7b\u52a0\u8f7d\u5668\u8d1f\u8d23\u5728\u7c7b\u7684\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u5c06\u5b57\u8282\u7801\u4fe1\u606f\u4ee5\u6d41\u7684\u65b9\u5f0f\u83b7\u53d6\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668</p> <ul> <li> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff08BootstrapClassLoader\uff09\u662f\u7531Hotspot\u865a\u62df\u673a\u63d0\u4f9b\u7684\u7c7b\u52a0\u8f7d\u5668\uff0cJDK9\u4e4b\u524d\u4f7f\u7528C++\u7f16\u5199\u7684\u3001JDK9\u4e4b\u540e\u4f7f\u7528Java\u7f16\u5199\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u52a0\u8f7dJava\u5b89\u88c5\u76ee\u5f55/jre/lib\u4e0b\u7684\u7c7b\u6587\u4ef6\uff0c\u6bd4\u5982rt.jar\uff0ctools.jar\uff0cresources.jar\u7b49\u3002</p> </li> </ul> </li> <li> <p>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668</p> <ul> <li> <p>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff08Extension Class Loader\uff09\u662fJDK\u4e2d\u63d0\u4f9b\u7684\u3001\u4f7f\u7528Java\u7f16\u5199\u7684\u7c7b\u52a0\u8f7d\u5668\u3002JDK9\u4e4b\u540e\u7531\u4e8e\u91c7\u7528\u4e86\u6a21\u5757\u5316\uff0c\u6539\u540d\u4e3aPlatform\u5e73\u53f0\u7c7b\u52a0\u8f7d\u5668\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u52a0\u8f7dJava\u5b89\u88c5\u76ee\u5f55/jre/lib/ext\u4e0b\u7684\u7c7b\u6587\u4ef6\u3002</p> </li> </ul> </li> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff08Application Class Loader\uff09\u662fJDK\u4e2d\u63d0\u4f9b\u7684\u3001\u4f7f\u7528Java\u7f16\u5199\u7684\u7c7b\u52a0\u8f7d\u5668\u3002\u9ed8\u8ba4\u52a0\u8f7d\u5e94\u7528\u7a0b\u5e8fclasspath\u4e0b\u7684\u7c7b\u3002</li> </ul> </li> <li> <p>\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u5141\u8bb8\u7528\u6237\u81ea\u884c\u5b9e\u73b0\u7c7b\u52a0\u8f7d\u7684\u903b\u8f91\uff0c\u53ef\u4ee5\u4ece\u7f51\u7edc\u3001\u6570\u636e\u5e93\u7b49\u6765\u6e90\u52a0\u8f7d\u7c7b\u4fe1\u606f\u3002\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u9700\u8981\u7ee7\u627f\u81eaClassLoader\u62bd\u8c61\u7c7b\uff0c\u91cd\u5199findClass\u65b9\u6cd5\u3002</p> </li> </ol>"},{"location":"JVM/JVM-summary/#\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","title":"\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","text":"<ul> <li> <p> \u7c7b\u52a0\u8f7d\u5668\u548c\u7236\u7c7b\u52a0\u8f7d\u5668</p> </li> <li> <p> \u4ec0\u4e48\u662f\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236</p> </li> <li> <p> \u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u7684\u4f5c\u7528</p> </li> </ul> <p></p> <ol> <li> <p>\u7c7b\u52a0\u8f7d\u5668\u548c\u7236\u7c7b\u52a0\u8f7d\u5668</p> <ul> <li>\u7c7b\u52a0\u8f7d\u6709\u5c42\u7ea7\u5173\u7cfb\uff0c\u4e0a\u4e00\u7ea7\u79f0\u4e4b\u4e3a\u4e0b\u4e00\u7ea7\u7684\u7236\u7c7b\u52a0\u8f7d\u5668\u3002</li> </ul> </li> <li> <p>\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u6307\u7684\u662f</p> <ul> <li> <p>\u5f53\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u63a5\u6536\u5230\u52a0\u8f7d\u7c7b\u7684\u4efb\u52a1\u65f6\uff0c\u4f1a\u5411\u4e0a\u67e5\u627e\u662f\u5426\u52a0\u8f7d\u8fc7\uff0c\u518d\u7531\u9876\u5411\u4e0b\u8fdb\u884c\u52a0\u8f7d\u3002</p> </li> <li> <p>\u6bcf\u4e2a\u7c7b\u52a0\u8f7d\u5668\u90fd\u6709\u4e00\u4e2a\u7236\u7c7b\u52a0\u8f7d\u5668\uff0c\u5728\u7c7b\u52a0\u8f7d\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2a\u7c7b\u52a0\u8f7d\u5668\u90fd\u4f1a\u5148\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u52a0\u8f7d\u4e86\u8be5\u7c7b\uff0c\u5982\u679c\u5df2\u7ecf\u52a0\u8f7d\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u4f1a\u5c06\u52a0\u8f7d\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u3002</p> </li> </ul> <p></p> </li> <li> <p>\u4f5c\u7528</p> <ul> <li> <p>\u4fdd\u8bc1\u7c7b\u52a0\u8f7d\u7684\u5b89\u5168\u6027\uff1a\u901a\u8fc7\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u907f\u514d\u6076\u610f\u4ee3\u7801\u66ff\u6362JDK\u4e2d\u7684\u6838\u5fc3\u7c7b\u5e93\uff0c\u786e\u4fdd\u6838\u5fc3\u7c7b\u5e93\u7684\u5b8c\u6574\u6027\u548c\u5b89\u5168\u6027\u3002</p> </li> <li> <p>\u907f\u514d\u91cd\u590d\u52a0\u8f7d\uff1a\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u53ef\u4ee5\u907f\u514d\u540c\u4e00\u4e2a\u7c7b\u88ab\u591a\u6b21\u52a0\u8f7d\u3002</p> </li> </ul> </li> </ol>"},{"location":"JVM/JVM-summary/#\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","title":"\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236","text":"<p>ClassLoader\u4e2d\u5305\u542b\u4e864\u4e2a\u6838\u5fc3\u65b9\u6cd5\uff0c\u5bf9Java\u7a0b\u5e8f\u5458\u6765\u8bf4\uff0c\u6253\u7834\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u7684\u552f\u4e00\u65b9\u6cd5\u5c31\u662f\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u91cd\u5199loadClass\u65b9\u6cd5\uff0c\u5c06\u5176\u4e2d\u7684\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u4ee3\u7801\u53bb\u6389\u3002</p> <p></p> <p></p>"},{"location":"JVM/JVM-summary/#tomcat\u7684\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668","title":"Tomcat\u7684\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668","text":"<p>Tomcat\u4e2d\uff0c\u5b9e\u73b0\u4e86\u4e00\u5957\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u3002\u8fd9\u4e00\u5c0f\u8282\u4f7f\u7528Tomcat9\uff089.0.84\uff09\u6e90\u7801\u8fdb\u884c\u5206\u6790\u3002</p> <p></p> <ul> <li> <p>common\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7dtomcat\u81ea\u8eab\u4f7f\u7528\u4ee5\u53ca\u5e94\u7528\u4f7f\u7528\u7684jar\u5305\uff0c\u9ed8\u8ba4\u914d\u7f6e\u5728catalina.properties\u6587\u4ef6\u4e2d\u3002common.loader=\"\\${catalina.base}/lib\", \"\\${catalina.base}/lib/*.jar\"</p> </li> <li> <p>catalina\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7dtomcat\u81ea\u8eab\u4f7f\u7528\u7684jar\u5305\uff0c\u4e0d\u8ba9\u5e94\u7528\u4f7f\u7528\uff0c\u9ed8\u8ba4\u914d\u7f6e\u5728catalina.properties\u6587\u4ef6\u4e2d\u3002server.loader= \u9ed8\u8ba4\u914d\u7f6e\u4e3a\u7a7a\uff0c\u4e3a\u7a7a\u65f6catalina\u52a0\u8f7d\u5668\u548ccommon\u52a0\u8f7d\u5668\u662f\u540c\u4e00\u4e2a\u3002</p> </li> <li> <p>shared\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7d\u5e94\u7528\u4f7f\u7528\u7684jar\u5305\uff0c\u4e0d\u8ba9tomcat\u4f7f\u7528\uff0c\u9ed8\u8ba4\u914d\u7f6e\u5728catalina.properties\u6587\u4ef6\u4e2d\u3002shared.loader= \u9ed8\u8ba4\u914d\u7f6e\u4e3a\u7a7a\uff0c\u4e3a\u7a7a\u65f6shared\u52a0\u8f7d\u5668\u548ccommon\u52a0\u8f7d\u5668\u662f\u540c\u4e00\u4e2a\u3002</p> </li> <li> <p>ParallelWebappClassLoader\u7c7b\u52a0\u8f7d\u5668\u53ef\u4ee5\u591a\u7ebf\u7a0b\u5e76\u884c\u52a0\u8f7d\u5e94\u7528\u4e2d\u4f7f\u7528\u5230\u7684\u7c7b\uff0c\u6bcf\u4e2a\u5e94\u7528\u90fd\u62e5\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u8be5\u7c7b\u52a0\u8f7d\u5668\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6bcf\u4e2a\u5e94\u7528\u4f1a\u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684ParallelWebappClassLoader\u7c7b\u52a0\u8f7d\u5668\u5462</p> <p>\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u53ea\u80fd\u52a0\u8f7d\u4e00\u4e2a\u540c\u540d\u7684\u7c7b\u3002\u5982\u679c\u4e24\u4e2a\u5e94\u7528\u4e2d\u6709\u76f8\u540c\u540d\u79f0\u7684\u7c7b\u90fd\u5fc5\u987b\u8981\u52a0\u8f7d\u3002</p> </li> <li> <p>JasperLoader\u7c7b\u52a0\u8f7d\u5668\u8d1f\u8d23\u52a0\u8f7dJSP\u6587\u4ef6\u7f16\u8bd1\u51fa\u6765\u7684class\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u4e3a\u4e86\u5b9e\u73b0\u70ed\u90e8\u7f72\uff08\u4e0d\u91cd\u542f\u8ba9\u4fee\u6539\u7684jsp\u751f\u6548\uff09\uff0c\u6bcf\u4e00\u4e2ajsp\u6587\u4ef6\u90fd\u7531\u4e00\u4e2a\u72ec\u7acb\u7684JasperLoader\u8d1f\u8d23\u52a0\u8f7d\u3002</p> </li> </ul> <p>ParallelWebappClassLoader\u7684\u6267\u884c\u6d41\u7a0b\uff1a</p> <p>Note</p> <p>\u8fd9\u91cc\u6253\u7834\u4e86\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\uff0c\u5e94\u7528\u4e2d\u7684\u7c7b\u5982\u679c\u6ca1\u6709\u52a0\u8f7d\u8fc7\u3002\u4f1a\u5148\u4ece\u5f53\u524d\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u7136\u540e\u518d\u4ea4\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u901a\u8fc7\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u52a0\u8f7d\u3002</p> <p></p>"},{"location":"JVM/JVM-summary/#\u5982\u4f55\u5224\u65ad\u5806\u4e0a\u7684\u5bf9\u8c61\u6ca1\u6709\u88ab\u5f15\u7528","title":"\u5982\u4f55\u5224\u65ad\u5806\u4e0a\u7684\u5bf9\u8c61\u6ca1\u6709\u88ab\u5f15\u7528\uff1f","text":"<ul> <li> <p> \u5f15\u7528\u8ba1\u6570\u6cd5</p> </li> <li> <p> \u53ef\u8fbe\u6027\u5206\u6790\u6cd5</p> </li> <li> <p> \u4f7f\u7528\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u539f\u56e0</p> </li> </ul> <p></p> <p>\u5e38\u89c1\u7684\u6709\u4e24\u79cd\u5224\u65ad\u65b9\u6cd5\uff1a\u5f15\u7528\u8ba1\u6570\u6cd5\u548c\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u3002</p> <p>\u5f15\u7528\u8ba1\u6570\u6cd5\u4f1a\u4e3a\u6bcf\u4e2a\u5bf9\u8c61\u7ef4\u62a4\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u5f53\u5bf9\u8c61\u88ab\u5f15\u7528\u65f6\u52a01\uff0c\u53d6\u6d88\u5f15\u7528\u65f6\u51cf1\u3002</p> <p>\u5f15\u7528\u8ba1\u6570\u6cd5\u7684\u4f18\u70b9\u662f\u5b9e\u73b0\u7b80\u5355\uff0c\u7f3a\u70b9\u6709\u4e24\u70b9\uff1a</p> <ol> <li> <p>\u6bcf\u6b21\u5f15\u7528\u548c\u53d6\u6d88\u5f15\u7528\u90fd\u9700\u8981\u7ef4\u62a4\u8ba1\u6570\u5668\uff0c\u5bf9\u7cfb\u7edf\u6027\u80fd\u4f1a\u6709\u4e00\u5b9a\u7684\u5f71\u54cd</p> </li> <li> <p>\u5b58\u5728\u5faa\u73af\u5f15\u7528\u95ee\u9898\uff0c\u6240\u8c13\u5faa\u73af\u5f15\u7528\u5c31\u662f\u5f53A\u5f15\u7528B\uff0cB\u540c\u65f6\u5f15\u7528A\u65f6\u4f1a\u51fa\u73b0\u5bf9\u8c61\u65e0\u6cd5\u56de\u6536\u7684\u95ee\u9898\u3002</p> </li> </ol> <p></p> <p>Java\u4e2d\u4f7f\u7528\u7684\u662f\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u6765\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u88ab\u56de\u6536\u3002</p> <p>\u53ef\u8fbe\u6027\u5206\u6790\u5c06\u5bf9\u8c61\u5206\u4e3a\u4e24\u7c7b\uff1a\u5783\u573e\u56de\u6536\u7684\u6839\u5bf9\u8c61GC Root\u548c\u666e\u901a\u5bf9\u8c61\uff0c\u5bf9\u8c61\u4e0e\u5bf9\u8c61\u4e4b\u95f4\u5b58\u5728\u5f15\u7528\u5173\u7cfb\u3002</p> <p>\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u6307\u7684\u662f\u5982\u679c\u4ece\u67d0\u4e2a\u5bf9\u8c61\u5230GC Root\u5bf9\u8c61\u662f\u53ef\u8fbe\u7684\uff0c\u5bf9\u8c61\u5c31\u4e0d\u53ef\u88ab\u56de\u6536\u3002</p> <p>\u54ea\u4e9b\u5bf9\u8c61\u88ab\u79f0\u4e4b\u4e3aGC Root\u5bf9\u8c61\u5462\uff1f</p> <ul> <li> <p>\u7ebf\u7a0bThread\u5bf9\u8c61\uff0c\u5f15\u7528\u7ebf\u7a0b\u6808\u5e27\u4e2d\u7684\u65b9\u6cd5\u53c2\u6570\u3001\u5c40\u90e8\u53d8\u91cf\u7b49\u3002</p> </li> <li> <p>\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684java.lang.Class\u5bf9\u8c61\uff0c\u5f15\u7528\u7c7b\u4e2d\u7684\u9759\u6001\u53d8\u91cf\u3002</p> </li> <li> <p>\u76d1\u89c6\u5668\u5bf9\u8c61\uff0c\u7528\u6765\u4fdd\u5b58\u540c\u6b65\u9501synchronized\u5173\u952e\u5b57\u6301\u6709\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u8c03\u7528\u65f6\u4f7f\u7528\u7684\u5168\u5c40\u5bf9\u8c61\u3002</p> </li> </ul>"},{"location":"JVM/JVM-summary/#jvm-\u4e2d\u90fd\u6709\u54ea\u4e9b\u5f15\u7528\u7c7b\u578b","title":"JVM \u4e2d\u90fd\u6709\u54ea\u4e9b\u5f15\u7528\u7c7b\u578b","text":"<ul> <li> <p> \u5f3a\u5f15\u7528</p> </li> <li> <p> \u8f6f\u5f15\u7528</p> </li> <li> <p> \u5f31\u5f15\u7528</p> </li> <li> <p> \u865a\u5f15\u7528</p> </li> <li> <p> \u7ec8\u7ed3\u5668\u5f15\u7528</p> </li> </ul> <p></p> <ul> <li> <p>\u5f3a\u5f15\u7528\uff0cJVM\u4e2d\u9ed8\u8ba4\u5f15\u7528\u5173\u7cfb\u5c31\u662f\u5f3a\u5f15\u7528\uff0c\u5373\u662f\u5bf9\u8c61\u88ab\u5c40\u90e8\u53d8\u91cf\u3001\u9759\u6001\u53d8\u91cf\u7b49GC Root\u5173\u8054\u7684\u5bf9\u8c61\u5f15\u7528\uff0c\u53ea\u8981\u8fd9\u5c42\u5173\u7cfb\u5b58\u5728\uff0c\u666e\u901a\u5bf9\u8c61\u5c31\u4e0d\u4f1a\u88ab\u56de\u6536\u3002</p> </li> <li> <p>\u8f6f\u5f15\u7528\uff0c\u8f6f\u5f15\u7528\u76f8\u5bf9\u4e8e\u5f3a\u5f15\u7528\u662f\u4e00\u79cd\u6bd4\u8f83\u5f31\u7684\u5f15\u7528\u5173\u7cfb\uff0c\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u6709\u8f6f\u5f15\u7528\u5173\u8054\u5230\u5b83\uff0c\u5f53\u7a0b\u5e8f\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u5c31\u4f1a\u5c06\u8f6f\u5f15\u7528\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u56de\u6536\u3002\u8f6f\u5f15\u7528\u4e3b\u8981\u5728\u7f13\u5b58\u6846\u67b6\u4e2d\u4f7f\u7528\u3002</p> </li> <li> <p>\u5f31\u5f15\u7528\uff0c\u5f31\u5f15\u7528\u7684\u6574\u4f53\u673a\u5236\u548c\u8f6f\u5f15\u7528\u57fa\u672c\u4e00\u81f4\uff0c\u533a\u522b\u5728\u4e8e\u5f31\u5f15\u7528\u5305\u542b\u7684\u5bf9\u8c61\u5728\u5783\u573e\u56de\u6536\u65f6\uff0c\u4e0d\u7ba1\u5185\u5b58\u591f\u4e0d\u591f\u90fd\u4f1a\u76f4\u63a5\u88ab\u56de\u6536\uff0c\u5f31\u5f15\u7528\u4e3b\u8981\u5728ThreadLocal\u4e2d\u4f7f\u7528\u3002</p> </li> <li> <p>\u865a\u5f15\u7528\uff08\u5e7d\u7075\u5f15\u7528/\u5e7b\u5f71\u5f15\u7528\uff09\uff0c\u4e0d\u80fd\u901a\u8fc7\u865a\u5f15\u7528\u5bf9\u8c61\u83b7\u53d6\u5230\u5305\u542b\u7684\u5bf9\u8c61\u3002\u865a\u5f15\u7528\u552f\u4e00\u7684\u7528\u9014\u662f\u5f53\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u65f6\u53ef\u4ee5\u63a5\u6536\u5230\u5bf9\u5e94\u7684\u901a\u77e5\u3002\u76f4\u63a5\u5185\u5b58\u4e2d\u4e3a\u4e86\u53ca\u65f6\u77e5\u9053\u76f4\u63a5\u5185\u5b58\u5bf9\u8c61\u4e0d\u518d\u4f7f\u7528\uff0c\u4ece\u800c\u56de\u6536\u5185\u5b58\uff0c\u4f7f\u7528\u4e86\u865a\u5f15\u7528\u6765\u5b9e\u73b0\u3002</p> </li> <li> <p>\u7ec8\u7ed3\u5668\u5f15\u7528\uff0c\u7ec8\u7ed3\u5668\u5f15\u7528\u6307\u7684\u662f\u5728\u5bf9\u8c61\u9700\u8981\u88ab\u56de\u6536\u65f6\uff0c\u7ec8\u7ed3\u5668\u5f15\u7528\u4f1a\u5173\u8054\u5bf9\u8c61\u5e76\u653e\u7f6e\u5728Finalizer\u7c7b\u4e2d\u7684\u5f15\u7528\u961f\u5217\u4e2d\uff0c\u5728\u7a0d\u540e\u7531\u4e00\u6761\u7531FinalizerThread\u7ebf\u7a0b\u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u5bf9\u8c61\uff0c\u7136\u540e\u6267\u884c\u5bf9\u8c61\u7684finalize\u65b9\u6cd5\uff0c\u5728\u5bf9\u8c61\u7b2c\u4e8c\u6b21\u88ab\u56de\u6536\u65f6\uff0c\u8be5\u5bf9\u8c61\u624d\u771f\u6b63\u7684\u88ab\u56de\u6536\u3002</p> </li> </ul>"},{"location":"JVM/JVM-summary/#threadlocal\u4e2d\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5f31\u5f15\u7528","title":"ThreadLocal\u4e2d\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5f31\u5f15\u7528","text":"<p>ThreadLocal\u53ef\u4ee5\u5728\u7ebf\u7a0b\u4e2d\u5b58\u653e\u7ebf\u7a0b\u7684\u672c\u5730\u53d8\u91cf\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u7ebf\u7a0b\u5b89\u5168\u3002</p> <p>ThreadLocal\u4e2d\u662f\u8fd9\u6837\u4fdd\u5b58\u5bf9\u8c61\u7684\uff1a</p> <ol> <li> <p>\u5728\u6bcf\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u5b58\u653e\u4e86\u4e00\u4e2aThreadLocalMap\u5bf9\u8c61\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\u5b9e\u73b0\u7684\u54c8\u5e0c\u8868\uff0c\u91cc\u9762\u5b58\u653e\u591a\u4e2aEntry\u5bf9\u8c61\u3002</p> </li> <li> <p>\u6bcf\u4e2aEntry\u5bf9\u8c61\u7ee7\u627f\u81ea\u5f31\u5f15\u7528\uff0c\u5185\u90e8\u5b58\u653eThreadLocal\u5bf9\u8c61\u3002\u540c\u65f6\u7528\u5f3a\u5f15\u7528\uff0c\u5f15\u7528\u4fdd\u5b58ThreadLocal\u5bf9\u5e94\u7684value\u503c\u3002</p> </li> </ol> <p></p> <p>\u4e0d\u518d\u4f7f\u7528Threadlocal\u5bf9\u8c61\u65f6\uff0c threadlocal = null\uff1b\u7531\u4e8e\u662f\u5f31\u5f15\u7528\uff0c\u90a3\u4e48\u5728\u5783\u573e\u56de\u6536\u4e4b\u540e\uff0cThreadLocal\u5bf9\u8c61\u5c31\u53ef\u4ee5\u88ab\u56de\u6536\u3002</p> <p>\u6b64\u65f6\u8fd8\u6709Entry\u5bf9\u8c61\u548cvalue\u5bf9\u8c61\u6ca1\u6709\u80fd\u88ab\u56de\u6536\uff0c\u6240\u4ee5\u5728ThreadLocal\u7c7b\u7684set\u3001get\u3001remove\u65b9\u6cd5\u4e2d\uff0c\u5728\u67d0\u4e9b\u7279\u5b9a\u6761\u4ef6\u6ee1\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4e3b\u52a8\u5220\u9664\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u3002</p> <p>\u5982\u679c\u4e00\u76f4\u4e0d\u8c03\u7528set\u3001get\u3001remove\u65b9\u6cd5\u6216\u8005\u8c03\u7528\u4e86\u6ca1\u6709\u6ee1\u8db3\u6761\u4ef6\uff0c\u8fd9\u90e8\u5206\u5bf9\u8c61\u5c31\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u3002\u5f3a\u70c8\u5efa\u8bae\u5728ThreadLocal\u4e0d\u518d\u4f7f\u7528\u65f6\uff0c\u8c03\u7528remove\u65b9\u6cd5\u56de\u6536\u5c06Entry\u5bf9\u8c61\u7684\u5f15\u7528\u5173\u7cfb\u53bb\u6389\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u56de\u6536\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e86\u3002</p>"},{"location":"JVM/JVM-summary/#\u5e38\u89c1\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5","title":"\u5e38\u89c1\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5","text":"<p>\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7684\u673a\u5236\u3001\u4f18\u7f3a\u70b9</p> <ul> <li> <p> \u6807\u8bb0\u6e05\u9664</p> </li> <li> <p> \u6807\u8bb0\u6574\u7406</p> </li> <li> <p> \u590d\u5236</p> </li> <li> <p> \u5206\u4ee3GC</p> </li> </ul> <p></p> <ol> <li> <p>\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5</p> <p>\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li> <p>\u6807\u8bb0\u9636\u6bb5\uff0c\u5c06\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0\u3002Java\u4e2d\u4f7f\u7528\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\uff0c\u4eceGC Root\u5f00\u59cb\u901a\u8fc7\u5f15\u7528\u94fe\u904d\u5386\u51fa\u6240\u6709\u5b58\u6d3b\u5bf9\u8c61\u3002</p> </li> <li> <p>\u6e05\u9664\u9636\u6bb5\uff0c\u4ece\u5185\u5b58\u4e2d\u5220\u9664\u6ca1\u6709\u88ab\u6807\u8bb0\u4e5f\u5c31\u662f\u975e\u5b58\u6d3b\u5bf9\u8c61\u3002</p> </li> </ul> <p>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u9636\u6bb5\u7ed9\u6bcf\u4e2a\u5bf9\u8c61\u7ef4\u62a4\u6807\u5fd7\u4f4d\uff0c\u7b2c\u4e8c\u9636\u6bb5\u5220\u9664\u5bf9\u8c61\u5373\u53ef\u3002 \u7f3a\u70b9\uff1a</p> <ul> <li> <p>\u788e\u7247\u5316\u95ee\u9898\u3002\u7531\u4e8e\u5185\u5b58\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u5728\u5bf9\u8c61\u88ab\u5220\u9664\u4e4b\u540e\uff0c\u5185\u5b58\u4e2d\u4f1a\u51fa\u73b0\u5f88\u591a\u7ec6\u5c0f\u7684\u53ef\u7528\u5185\u5b58\u5355\u5143\u3002\u5982\u679c\u6211\u4eec\u9700\u8981\u7684\u662f\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u7a7a\u95f4\uff0c\u5f88\u6709\u53ef\u80fd\u8fd9\u4e9b\u5185\u5b58\u5355\u5143\u7684\u5927\u5c0f\u8fc7\u5c0f\u65e0\u6cd5\u8fdb\u884c\u5206\u914d\u3002</p> </li> <li> <p>\u5206\u914d\u901f\u5ea6\u6162\u3002\u7531\u4e8e\u5185\u5b58\u788e\u7247\u7684\u5b58\u5728\uff0c\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u7a7a\u95f2\u94fe\u8868\uff0c\u6781\u6709\u53ef\u80fd\u53d1\u751f\u6bcf\u6b21\u9700\u8981\u904d\u5386\u5230\u94fe\u8868\u7684\u6700\u540e\u624d\u80fd\u83b7\u5f97\u5408\u9002\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> </li> </ul> </li> <li> <p>\u590d\u5236\u7b97\u6cd5</p> <p>\u590d\u5236\u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a</p> <ul> <li> <p>\u51c6\u5907\u4e24\u5757\u7a7a\u95f4From\u7a7a\u95f4\u548cTo\u7a7a\u95f4\uff0c\u6bcf\u6b21\u5728\u5bf9\u8c61\u5206\u914d\u9636\u6bb5\uff0c\u53ea\u80fd\u4f7f\u7528\u5176\u4e2d\u4e00\u5757\u7a7a\u95f4\uff08From\u7a7a\u95f4\uff09\u3002</p> </li> <li> <p>\u5728\u5783\u573e\u56de\u6536GC\u9636\u6bb5\uff0c\u5c06From\u4e2d\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230To\u7a7a\u95f4\u3002</p> </li> <li> <p>\u5c06\u4e24\u5757\u7a7a\u95f4\u7684From\u548cTo\u540d\u5b57\u4e92\u6362\u3002</p> </li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li> <p>\u541e\u5410\u91cf\u9ad8\u3002\u590d\u5236\u7b97\u6cd5\u53ea\u9700\u8981\u904d\u5386\u4e00\u6b21\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230To\u7a7a\u95f4\u5373\u53ef\uff0c\u6bd4\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u5c11\u4e86\u4e00\u6b21\u904d\u5386\u7684\u8fc7\u7a0b\uff0c\u56e0\u800c\u6027\u80fd\u8f83\u597d\uff0c\u4f46\u662f\u4e0d\u5982\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff0c\u56e0\u4e3a\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u4e0d\u9700\u8981\u8fdb\u884c\u5bf9\u8c61\u7684\u79fb\u52a8</p> </li> <li> <p>\u4e0d\u4f1a\u53d1\u751f\u788e\u7247\u5316\u3002\u590d\u5236\u7b97\u6cd5\u5728\u590d\u5236\u4e4b\u540e\u5c31\u4f1a\u5c06\u5bf9\u8c61\u6309\u987a\u5e8f\u653e\u5165To\u7a7a\u95f4\u4e2d\uff0c\u6240\u4ee5\u5bf9\u8c61\u4ee5\u5916\u7684\u533a\u57df\u90fd\u662f\u53ef\u7528\u7a7a\u95f4\uff0c\u4e0d\u5b58\u5728\u788e\u7247\u5316\u5185\u5b58\u7a7a\u95f4\u3002</p> </li> </ul> <p>\u7f3a\u70b9\uff1a\u5185\u5b58\u4f7f\u7528\u6548\u7387\u4f4e\u3002\u6bcf\u6b21\u53ea\u80fd\u8ba9\u4e00\u534a\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u4e3a\u521b\u5efa\u5bf9\u8c61\u4f7f\u7528</p> </li> <li> <p>\u6807\u8bb0\u6574\u7406\u7b97\u6cd5</p> <p>\u6807\u8bb0\u6574\u7406\u7b97\u6cd5\u4e5f\u53eb\u6807\u8bb0\u538b\u7f29\u7b97\u6cd5\uff0c\u662f\u5bf9\u6807\u8bb0\u6e05\u7406\u7b97\u6cd5\u4e2d\u5bb9\u6613\u4ea7\u751f\u5185\u5b58\u788e\u7247\u95ee\u9898\u7684\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u3002\u6838\u5fc3\u601d\u60f3\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li> <p>\u6807\u8bb0\u9636\u6bb5\uff0c\u5c06\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0\u3002Java\u4e2d\u4f7f\u7528\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\uff0c\u4eceGC Root\u5f00\u59cb\u901a\u8fc7\u5f15\u7528\u94fe\u904d\u5386\u51fa\u6240\u6709\u5b58\u6d3b\u5bf9\u8c61\u3002</p> </li> <li> <p>\u6574\u7406\u9636\u6bb5\uff0c\u5c06\u5b58\u6d3b\u5bf9\u8c61\u79fb\u52a8\u5230\u5806\u7684\u4e00\u7aef\u3002\u6e05\u7406\u6389\u5b58\u6d3b\u5bf9\u8c61\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> </li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li> <p>\u5185\u5b58\u4f7f\u7528\u6548\u7387\u9ad8\u3002\u6574\u4e2a\u5806\u5185\u5b58\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u4e0d\u4f1a\u50cf\u590d\u5236\u7b97\u6cd5\u53ea\u80fd\u4f7f\u7528\u534a\u4e2a\u5806\u5185\u5b58</p> </li> <li> <p>\u4e0d\u4f1a\u53d1\u751f\u788e\u7247\u5316\u3002\u5728\u6574\u7406\u9636\u6bb5\u53ef\u4ee5\u5c06\u5bf9\u8c61\u5f80\u5185\u5b58\u7684\u4e00\u4fa7\u8fdb\u884c\u79fb\u52a8\uff0c\u5269\u4e0b\u7684\u7a7a\u95f4\u90fd\u662f\u53ef\u4ee5\u5206\u914d\u5bf9\u8c61\u7684\u6709\u6548\u7a7a\u95f4</p> </li> </ul> <p>\u7f3a\u70b9\uff1a\u6574\u7406\u9636\u6bb5\u7684\u6548\u7387\u4e0d\u9ad8\u3002\u6574\u7406\u7b97\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982Lisp2\u6574\u7406\u7b97\u6cd5\u9700\u8981\u5bf9\u6574\u4e2a\u5806\u4e2d\u7684\u5bf9\u8c61\u641c\u7d223\u6b21\uff0c\u6574\u4f53\u6027\u80fd\u4e0d\u4f73\u3002\u53ef\u4ee5\u901a\u8fc7TwoFinger\u3001\u8868\u683c\u7b97\u6cd5\u3001ImmixGC\u7b49\u9ad8\u6548\u7684\u6574\u7406\u7b97\u6cd5\u4f18\u5316\u6b64\u9636\u6bb5\u7684\u6027\u80fd</p> </li> <li> <p>\u5206\u4ee3GC\u7b97\u6cd5     \u73b0\u4ee3\u4f18\u79c0\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u4f1a\u5c06\u4e0a\u8ff0\u63cf\u8ff0\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7ec4\u5408\u8fdb\u884c\u4f7f\u7528\uff0c\u5176\u4e2d\u5e94\u7528\u6700\u5e7f\u7684\u5c31\u662f\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5(Generational GC)\u3002\u5206\u4ee3\u5783\u573e\u56de\u6536\u5c06\u6574\u4e2a\u5185\u5b58\u533a\u57df\u5212\u5206\u4e3a\u5e74\u8f7b\u4ee3\u548c\u8001\u5e74\u4ee3\u3002</p> <ul> <li> <p>\u5206\u4ee3\u56de\u6536\u65f6\uff0c\u521b\u5efa\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u9996\u5148\u4f1a\u88ab\u653e\u5165Eden\u4f0a\u7538\u56ed\u533a\u3002</p> </li> <li> <p>\u968f\u7740\u5bf9\u8c61\u5728Eden\u533a\u8d8a\u6765\u8d8a\u591a\uff0c\u5982\u679cEden\u533a\u6ee1\uff0c\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u5df2\u7ecf\u65e0\u6cd5\u653e\u5165\uff0c\u5c31\u4f1a\u89e6\u53d1\u5e74\u8f7b\u4ee3\u7684GC\uff0c\u79f0\u4e3aMinor GC\u6216\u8005Young GC\u3002Minor GC\u4f1a\u628aeden\u4e2d\u548cFrom\u9700\u8981\u56de\u6536\u7684\u5bf9\u8c61\u56de\u6536\uff0c\u628a\u6ca1\u6709\u56de\u6536\u7684\u5bf9\u8c61\u653e\u5165To\u533a\u3002</p> </li> <li> <p>\u63a5\u4e0b\u6765\uff0cS0\u4f1a\u53d8\u6210To\u533a\uff0cS1\u53d8\u6210From\u533a\u3002\u5f53eden\u533a\u6ee1\u65f6\u518d\u5f80\u91cc\u653e\u5165\u5bf9\u8c61\uff0c\u4f9d\u7136\u4f1a\u53d1\u751fMinor GC\u3002\u6b64\u65f6\u4f1a\u56de\u6536eden\u533a\u548cS1(from)\u4e2d\u7684\u5bf9\u8c61\uff0c\u5e76\u628aeden\u548cfrom\u533a\u4e2d\u5269\u4f59\u7684\u5bf9\u8c61\u653e\u5165S0\u3002</p> <p>\u6ce8\u610f\uff1a\u6bcf\u6b21Minor GC\u4e2d\u90fd\u4f1a\u4e3a\u5bf9\u8c61\u8bb0\u5f55\u4ed6\u7684\u5e74\u9f84\uff0c\u521d\u59cb\u503c\u4e3a0\uff0c\u6bcf\u6b21GC\u5b8c\u52a01\u3002</p> </li> <li> <p>\u5982\u679cMinor GC\u540e\u5bf9\u8c61\u7684\u5e74\u9f84\u8fbe\u5230\u9608\u503c\uff08\u6700\u592715\uff0c\u9ed8\u8ba4\u503c\u548c\u5783\u573e\u56de\u6536\u5668\u6709\u5173\uff09\uff0c\u5bf9\u8c61\u5c31\u4f1a\u88ab\u664b\u5347\u81f3\u8001\u5e74\u4ee3\u3002</p> </li> <li> <p>\u5f53\u8001\u5e74\u4ee3\u4e2d\u7a7a\u95f4\u4e0d\u8db3\uff0c\u65e0\u6cd5\u653e\u5165\u65b0\u7684\u5bf9\u8c61\u65f6\uff0c\u5148\u5c1d\u8bd5minor gc\u5982\u679c\u8fd8\u662f\u4e0d\u8db3\uff0c\u5c31\u4f1a\u89e6\u53d1Full GC\uff0cFull GC\u4f1a\u5bf9\u6574\u4e2a\u5806\u8fdb\u884c\u5783\u573e\u56de\u6536\u3002</p> <p>\u5982\u679cFull GC\u4f9d\u7136\u65e0\u6cd5\u56de\u6536\u6389\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u5f53\u5bf9\u8c61\u7ee7\u7eed\u653e\u5165\u8001\u5e74\u4ee3\u65f6\uff0c\u5c31\u4f1a\u629b\u51faOut Of Memory\u5f02\u5e38\u3002</p> </li> </ul> <p>\u4f18\u70b9\uff1a</p> <ol> <li> <p>\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u5e74\u8f7b\u4ee3\u548c\u8001\u5e74\u4ee3\u7684\u6bd4\u4f8b\u6765\u9002\u5e94\u4e0d\u540c\u7c7b\u578b\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u63d0\u9ad8\u5185\u5b58\u7684\u5229\u7528\u7387\u548c\u6027\u80fd\u3002</p> </li> <li> <p>\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u4f7f\u7528\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u65b0\u751f\u4ee3\u4e00\u822c\u9009\u62e9\u590d\u5236\u7b97\u6cd5\u6548\u7387\u9ad8\u3001\u4e0d\u4f1a\u4ea7\u751f\u5185\u5b58\u788e\u7247\uff0c\u8001\u5e74\u4ee3\u53ef\u4ee5\u9009\u62e9\u6807\u8bb0-\u6e05\u9664\u548c\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\uff0c\u7531\u7a0b\u5e8f\u5458\u6765\u9009\u62e9\u7075\u6d3b\u5ea6\u8f83\u9ad8\u3002</p> </li> <li> <p>\u5206\u4ee3\u7684\u8bbe\u8ba1\u4e2d\u5141\u8bb8\u53ea\u56de\u6536\u65b0\u751f\u4ee3\uff08minor gc\uff09\uff0c\u5982\u679c\u80fd\u6ee1\u8db3\u5bf9\u8c61\u5206\u914d\u7684\u8981\u6c42\u5c31\u4e0d\u9700\u8981\u5bf9\u6574\u4e2a\u5806\u8fdb\u884c\u56de\u6536(full gc),STW\uff08Stop The World\uff09\u7531\u5783\u573e\u56de\u6536\u5f15\u8d77\u7684\u505c\u987f\u65f6\u95f4\u5c31\u4f1a\u51cf\u5c11\u3002</p> </li> </ol> </li> </ol>"},{"location":"JVM/JVM-summary/#\u5e38\u89c1\u7684\u5783\u573e\u56de\u6536\u5668","title":"\u5e38\u89c1\u7684\u5783\u573e\u56de\u6536\u5668","text":"<ul> <li> <p> Serial\u5783\u573e\u56de\u6536\u5668 + SerialOld\u5783\u573e\u56de\u6536\u5668</p> </li> <li> <p> ParNew+ CMS </p> </li> <li> <p> PS+PO</p> </li> <li> <p> G1</p> </li> <li> <p> Shenandoah \u548c ZGC</p> </li> </ul> <p></p> <ol> <li>Serial</li> </ol> <p></p> <ol> <li>Parallel</li> </ol> <p></p> <ol> <li>ParNew+CMS</li> </ol> <p>CMS\u5783\u573e\u56de\u6536\u5668\u5b58\u5728\u7684\u95ee\u9898</p> <ol> <li> <p>CMS\u4f7f\u7528\u4e86\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff0c\u5728\u5783\u573e\u6536\u96c6\u7ed3\u675f\u4e4b\u540e\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u5185\u5b58\u788e\u7247\uff0cCMS\u4f1a\u5728Full GC\u65f6\u8fdb\u884c\u788e\u7247\u7684\u6574\u7406\u3002\u8fd9\u6837\u4f1a\u5bfc\u81f4\u7528\u6237\u7ebf\u7a0b\u6682\u505c\uff0c\u53ef\u4ee5\u4f7f\u7528-XX:CMSFullGCsBeforeCompaction=N \u53c2\u6570\uff08\u9ed8\u8ba40\uff09\u8c03\u6574N\u6b21Full GC\u4e4b\u540e\u518d\u6574\u7406\u3002</p> </li> <li> <p>\u65e0\u6cd5\u5904\u7406\u5728\u5e76\u53d1\u6e05\u7406\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u201c\u6d6e\u52a8\u5783\u573e\u201d\uff0c\u4e0d\u80fd\u505a\u5230\u5b8c\u5168\u7684\u5783\u573e\u56de\u6536\u3002</p> </li> <li> <p>\u5982\u679c\u8001\u5e74\u4ee3\u5185\u5b58\u4e0d\u8db3\u65e0\u6cd5\u5206\u914d\u5bf9\u8c61\uff0cCMS\u5c31\u4f1a\u9000\u5316\u6210Serial Old\u5355\u7ebf\u7a0b\u56de\u6536\u8001\u5e74\u4ee3\u3002</p> </li> <li> <p>\u5e76\u53d1\u9636\u6bb5\u4f1a\u5f71\u54cd\u7528\u6237\u7ebf\u7a0b\u6267\u884c\u7684\u6027\u80fd</p> </li> </ol> <p> </p> <ol> <li>G1</li> </ol> <p></p> <ol> <li> <p>Shenandoah \u662f\u7531Red Hat\u5f00\u53d1\u7684\u4e00\u6b3e\u4f4e\u5ef6\u8fdf\u7684\u5783\u573e\u6536\u96c6\u5668\uff0cShenandoah \u5e76\u53d1\u6267\u884c\u5927\u90e8\u5206 GC \u5de5\u4f5c\uff0c\u5305\u62ec\u5e76\u53d1\u7684\u6574\u7406\uff0c\u5806\u5927\u5c0f\u5bf9STW\u7684\u65f6\u95f4\u57fa\u672c\u6ca1\u6709\u5f71\u54cd\u3002</p> </li> <li> <p>ZGC \u662f\u4e00\u79cd\u53ef\u6269\u5c55\u7684\u4f4e\u5ef6\u8fdf\u5783\u573e\u56de\u6536\u5668\u3002ZGC \u5728\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\uff0cSTW\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7\u4e00\u6beb\u79d2\uff0c\u9002\u5408\u9700\u8981\u4f4e\u5ef6\u8fdf\u7684\u5e94\u7528\u3002\u652f\u6301\u51e0\u767e\u5146\u523016TB \u7684\u5806\u5927\u5c0f\uff0c\u5806\u5927\u5c0f\u5bf9STW\u7684\u65f6\u95f4\u57fa\u672c\u6ca1\u6709\u5f71\u54cd\u3002</p> </li> </ol> <p>\u5982\u4f55\u9009\u62e9\u5783\u573e\u56de\u6536\u5668\uff0c\u8bf7\u8df3\u8f6c\u81f3\u201d\u57fa\u7840\u7bc7\u201c\u3010\u5783\u573e\u56de\u6536\u5668\u3011\u5c0f\u8282</p>"},{"location":"JVM/JVM-summary/#\u5982\u4f55\u89e3\u51b3\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898","title":"\u5982\u4f55\u89e3\u51b3\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898","text":"<ul> <li> <p> \u5185\u5b58\u6ea2\u51fa\u548c\u5185\u5b58\u6cc4\u6f0f</p> </li> <li> <p> \u89e3\u51b3\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u7684\u601d\u8def</p> </li> <li> <p> \u5e38\u7528\u7684\u5de5\u5177</p> </li> </ul> <p></p> <ul> <li> <p>\u5185\u5b58\u6cc4\u6f0f\uff08memory leak\uff09\uff1a\u5728Java\u4e2d\u5982\u679c\u4e0d\u518d\u4f7f\u7528\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46\u662f\u8be5\u5bf9\u8c61\u4f9d\u7136\u5728GC ROOT\u7684\u5f15\u7528\u94fe\u4e0a\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u4e0d\u4f1a\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u79f0\u4e4b\u4e3a\u5185\u5b58\u6cc4\u6f0f\u3002</p> </li> <li> <p>\u5c11\u91cf\u7684\u5185\u5b58\u6cc4\u6f0f\u53ef\u4ee5\u5bb9\u5fcd\uff0c\u4f46\u662f\u5982\u679c\u53d1\u751f\u6301\u7eed\u7684\u5185\u5b58\u6cc4\u6f0f\uff0c\u5c31\u50cf\u6eda\u96ea\u7403\u96ea\u7403\u8d8a\u6eda\u8d8a\u5927\uff0c\u4e0d\u7ba1\u6709\u591a\u5927\u7684\u5185\u5b58\u8fdf\u65e9\u4f1a\u88ab\u6d88\u8017\u5b8c\uff0c\u6700\u7ec8\u5bfc\u81f4\u7684\u7ed3\u679c\u5c31\u662f\u5185\u5b58\u6ea2\u51fa\u3002</p> </li> </ul> <p></p> <p>\u751f\u4ea7\u73af\u5883\u901a\u8fc7\u8fd0\u7ef4\u63d0\u4f9b\u7684Prometheus + Grafana \u7b49\u76d1\u63a7\u5e73\u53f0\u67e5\u770b</p> <p>\u5f00\u53d1\u3001\u6d4b\u8bd5\u73af\u5883\u901a\u8fc7visualvm\u67e5\u770b</p> <p>\u8bca\u65ad\u2013\u751f\u6210\u5185\u5b58\u5feb\u7167</p> <p>\u5f53\u5806\u5185\u5b58\u6ea2\u51fa\u65f6\uff0c\u9700\u8981\u5728\u5806\u5185\u5b58\u6ea2\u51fa\u65f6\u5c06\u6574\u4e2a\u5806\u5185\u5b58\u4fdd\u5b58\u4e0b\u6765\uff0c\u751f\u6210\u5185\u5b58\u5feb\u7167(Heap Profile)\u6587\u4ef6\u3002\u751f\u6210\u65b9\u5f0f\u6709\u4e24\u79cd</p> <ol> <li> <p>\u5185\u5b58\u6ea2\u51fa\u65f6\u81ea\u52a8\u751f\u6210\uff0c\u6dfb\u52a0\u751f\u6210\u5185\u5b58\u5feb\u7167\u7684Java\u865a\u62df\u673a\u53c2\u6570\uff1a<code>-XX:+HeapDumpOnOutOfMemoryError</code>\uff1a\u53d1\u751fOutOfMemoryError\u9519\u8bef\u65f6\uff0c\u81ea\u52a8\u751f\u6210hprof\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002<code>-XX:HeapDumpPath=&lt;path&gt;</code>\uff1a\u6307\u5b9ahprof\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\u3002</p> </li> <li> <p>\u5bfc\u51fa\u8fd0\u884c\u4e2d\u7cfb\u7edf\u7684\u5185\u5b58\u5feb\u7167\uff0c\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c\u6ce8\u610f\u53ea\u9700\u8981\u5bfc\u51fa\u6807\u8bb0\u4e3a\u5b58\u6d3b\u7684\u5bf9\u8c61\uff1a    \u901a\u8fc7JDK\u81ea\u5e26\u7684jmap\u547d\u4ee4\u5bfc\u51fa\uff0c\u683c\u5f0f\u4e3a\uff1a<code>jmap-dump:live,format=b,file=\u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d \u8fdb\u7a0bID</code>    \u901a\u8fc7arthas\u7684heapdump\u547d\u4ee4\u5bfc\u51fa\uff0c\u683c\u5f0f\u4e3a\uff1a<code>heapdump--live \u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d</code></p> </li> </ol> <p>\u8bca\u65ad\u2013MAT\u5b9a\u4f4d\u95ee\u9898</p> <p>\u4f7f\u7528MAT\u6253\u5f00hprof\u6587\u4ef6\uff0c\u5e76\u9009\u62e9\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u529f\u80fd\uff0cMAT\u4f1a\u81ea\u884c\u6839\u636e\u5185\u5b58\u5feb\u7167\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u5206\u6790\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\u3002</p> <p></p>"},{"location":"JVM/JVM-summary/#\u5e38\u89c1\u7684jvm\u53c2\u6570","title":"\u5e38\u89c1\u7684JVM\u53c2\u6570","text":"<ul> <li> <p> \u6700\u5927\u5806\u5185\u5b58\u53c2\u6570</p> </li> <li> <p> \u6700\u5927\u6808\u5185\u5b58\u53c2\u6570</p> </li> <li> <p> \u6700\u5927\u5143\u7a7a\u95f4\u5185\u5b58\u53c2\u6570</p> </li> <li> <p> \u65e5\u5fd7\u53c2\u6570</p> </li> <li> <p> \u5806\u5185\u5b58\u5feb\u7167\u53c2\u6570</p> </li> <li> <p> \u5783\u573e\u56de\u6536\u5668\u53c2\u6570</p> </li> <li> <p> \u5783\u573e\u56de\u6536\u5668\u8c03\u4f18\u53c2\u6570</p> </li> </ul> <p> </p> <ul> <li> <p>\u53c2\u65701 \uff1a <code>-Xmx</code> \u548c <code>\u2013Xms</code>\u00a0\u00a0\u00a0\u00a0\u6700\u5927\u3001\u6700\u5c0f\u5806\u5185\u5b58   \u6700\u5408\u7406\u7684\u8bbe\u7f6e\u65b9\u5f0f\u5e94\u8be5\u662f\u6839\u636e\u6700\u5927\u5e76\u53d1\u91cf\u4f30\u7b97\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff0c\u7136\u540e\u518d\u6839\u636e\u670d\u52a1\u5668\u914d\u7f6e\u8ba1\u7b97\u6700\u5927\u5806\u5185\u5b58\u7684\u503c\u3002   \u5efa\u8bae\u5c06-Xms\u8bbe\u7f6e\u7684\u548c-Xmx\u4e00\u6837\u5927,\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u518d\u4ea7\u751f\u6269\u5bb9\u7684\u5f00\u9500\u3002</p> </li> <li> <p>\u53c2\u65702 \uff1a <code>-XX:MaxMetaspaceSize</code> \u548c <code>-Xss</code>\u00a0\u00a0\u00a0\u00a0\u6700\u5927\u5143\u7a7a\u95f4\u5927\u5c0f\u3001\u6808\u5927\u5c0f   -XX:MaxMetaspaceSize=\u503c \u53c2\u6570\u6307\u7684\u662f\u6700\u5927\u5143\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u6bd4\u8f83\u5927\uff0c\u5982\u679c\u51fa\u73b0\u5143\u7a7a\u95f4\u5185\u5b58\u6cc4\u6f0f\u4f1a\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u4e0d\u53ef\u63a7\uff0c\u5efa\u8bae\u6839\u636e\u6d4b\u8bd5\u60c5\u51b5\u8bbe\u7f6e\u6700\u5927\u503c\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3a256m\u3002   -Xss256k \u6808\u5185\u5b58\u5927\u5c0f\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a\u6808\u7684\u5927\u5c0f\uff0cJVM \u5c06\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9ed8\u8ba4\u5927\u5c0f\u7684\u6808\u3002\u5927\u5c0f\u53d6\u51b3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u548c\u8ba1\u7b97\u673a\u7684\u4f53\u7cfb\u7ed3\u6784\u3002\u6bd4\u5982Linux x86 64\u4f4d \uff1a 1MB\uff0c\u5982\u679c\u4e0d\u9700\u8981\u7528\u5230\u8fd9\u4e48\u5927\u7684\u6808\u5185\u5b58\uff0c\u5b8c\u5168\u53ef\u4ee5\u5c06\u6b64\u503c\u8c03\u5c0f\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u5408\u7406\u503c\u4e3a256k \u2013 1m\u4e4b\u95f4\u3002</p> </li> <li> <p>\u53c2\u65703\uff1a\u00a0\u00a0\u00a0\u00a0<code>-Xmn</code>\u00a0\u00a0\u00a0\u00a0\u5e74\u8f7b\u4ee3\u7684\u5927\u5c0f   \u9ed8\u8ba4\u503c\u4e3a\u6574\u4e2a\u5806\u76841/3\uff0c\u53ef\u4ee5\u6839\u636e\u5cf0\u503c\u6d41\u91cf\u8ba1\u7b97\u6700\u5927\u7684\u5e74\u8f7b\u4ee3\u5927\u5c0f\uff0c\u5c3d\u91cf\u8ba9\u5bf9\u8c61\u53ea\u5b58\u653e\u5728\u5e74\u8f7b\u4ee3\uff0c\u4e0d\u8fdb\u5165\u8001\u5e74\u4ee3\u3002\u4f46\u662f\u5b9e\u9645\u7684\u573a\u666f\u4e2d\uff0c\u63a5\u53e3\u7684\u54cd\u5e94\u65f6\u95f4\u3001\u521b\u5efa\u5bf9\u8c61\u7684\u5927\u5c0f\u3001\u7a0b\u5e8f\u5185\u90e8\u8fd8\u4f1a\u6709\u4e00\u4e9b\u5b9a\u65f6\u4efb\u52a1\u7b49\u4e0d\u786e\u5b9a\u56e0\u7d20\u90fd\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u503c\u7684\u5927\u5c0f\u5e76\u4e0d\u80fd\u4ec5\u51ed\u8ba1\u7b97\u5f97\u51fa\uff0c\u5982\u679c\u8bbe\u7f6e\u8be5\u503c\u8981\u8fdb\u884c\u5927\u91cf\u7684\u6d4b\u8bd5\u3002   G1\u5783\u573e\u56de\u6536\u5668\u5c3d\u91cf\u4e0d\u8981\u8bbe\u7f6e\u8be5\u503c\uff0cG1\u4f1a\u52a8\u6001\u8c03\u6574\u5e74\u8f7b\u4ee3\u7684\u5927\u5c0f\u3002</p> </li> <li> <p>\u6253\u5370GC\u65e5\u5fd7   JDK8\u53ca\u4e4b\u524d \uff1a <code>-XX:+PrintGCDetails</code> <code>-XX:+PrintGCDateStamps-Xloggc:\u6587\u4ef6\u8def\u5f84</code>   JDK9\u53ca\u4e4b\u540e \uff1a <code>-Xlog:gc*:file=\u6587\u4ef6\u8def\u5f84</code></p> </li> <li> <p><code>-XX:+DisableExplicitGC</code>\u7981\u6b62\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528System.gc()\uff0c System.gc()\u53ef\u80fd\u4f1a\u5f15\u8d77FULLGC\uff0c\u5728\u4ee3\u7801\u4e2d\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u3002\u4f7f\u7528DisableExplicitGC\u53c2\u6570\u53ef\u4ee5\u7981\u6b62\u4f7f\u7528System.gc()\u65b9\u6cd5\u8c03\u7528\u3002</p> </li> <li> <p><code>-XX:+HeapDumpOnOutOfMemoryError</code>\uff1a\u53d1\u751fOutOfMemoryError\u9519\u8bef\u65f6\uff0c\u81ea\u52a8\u751f\u6210hprof\u5185\u5b58\u5feb\u7167\u6587\u4ef6\u3002<code>-XX:HeapDumpPath=&lt;path&gt;</code>\u6307\u5b9ahprof\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\u3002</p> </li> </ul> <p>JVM\u53c2\u6570\u6a21\u677f</p> <pre><code>-Xms1g\n-Xmx1g\n-Xss256k\n-XX:MaxMetaspaceSize=512m \n-XX:+DisableExplicitGC\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:HeapDumpPath=/opt/logs/my-service.hprof\n-XX:+PrintGCDetails\n-XX:+PrintGCDateStamps\n-Xloggc:\u6587\u4ef6\u8def\u5f84\n</code></pre> <p>\u6ce8\u610f\uff1aJDK9\u53ca\u4e4b\u540egc\u65e5\u5fd7\u8f93\u51fa\u4fee\u6539\u4e3a -Xlog:gc*:file=\u6587\u4ef6\u540d</p> <p>\u5806\u5185\u5b58\u5927\u5c0f\u548c\u6808\u5185\u5b58\u5927\u5c0f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7075\u6d3b\u8c03\u6574\u3002</p> <p>\u4e0a\u4e00\u8282\uff1aJVM \u539f\u7406</p> <p>\u5b8c</p>"},{"location":"Java/IO/","title":"IO","text":"<p>IO \u662f Input/Output \u7684\u7f29\u5199\uff0c\u6307\u7684\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u6570\u636e\u7684\u8f93\u5165\u548c\u8f93\u51fa\u64cd\u4f5c\u3002</p> <p>\u5728 Java \u4e2d\uff0cIO \u4e3b\u8981\u6d89\u53ca\u6587\u4ef6\u64cd\u4f5c\u3001\u7f51\u7edc\u901a\u4fe1\u3001\u6570\u636e\u6d41\u5904\u7406\u7b49\u65b9\u9762\u3002</p> <p>Java \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684 IO \u7c7b\u5e93\uff0c\u652f\u6301\u591a\u79cd\u6570\u636e\u6e90\u548c\u6570\u636e\u683c\u5f0f\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p>"},{"location":"Java/IO/#io\u6d41","title":"IO\u6d41","text":"<p>Java IO \u6d41\u6839\u636e\u6570\u636e\u5904\u7406\u7684\u65b9\u5f0f\u53ef\u4ee5\u5206\u4e3a\u5b57\u8282\u6d41\u548c\u5b57\u7b26\u6d41\uff1a</p> <ul> <li>\u5b57\u8282\u6d41\uff1a\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff0c\u8bfb\u5199\u6570\u636e\uff0c\u9002\u7528\u4e8e\u4efb\u4f55\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u6587\u672c\u3001\u56fe\u7247\u3001\u97f3\u9891\u7b49\u3002</li> <li>\u5b57\u7b26\u6d41\uff1a\u4ee5\u5b57\u7b26\u4e3a\u5355\u4f4d\uff0c\u8bfb\u5199\u6570\u636e\uff0c\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u6587\u672c\u6587\u4ef6\u3002</li> </ul> <p></p> <p>Java IO \u6d41\u7684\u6838\u5fc3\u7531\u56db\u4e2a\u62bd\u8c61\u7c7b\u7ec4\u6210\uff0c\u5b83\u4eec\u662f\uff1a</p> <ul> <li>InputStream / OutputStream\uff1a\u5b57\u8282\u8f93\u5165/\u8f93\u51fa\u6d41\u7684\u57fa\u7c7b\u3002</li> <li>Reader / Writer\uff1a\u5b57\u7b26\u8f93\u5165/\u8f93\u51fa\u6d41\u7684\u57fa\u7c7b\u3002</li> </ul> <p></p> <p>\u5e38\u7528\u7684 Java IO \u6d41\u7c7b</p> <ul> <li>FileInputStream / FileOutputStream\uff1a\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u6587\u4ef6\u7684\u5b57\u8282\u6d41\u3002</li> <li>FileReader / FileWriter\uff1a\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u6587\u4ef6\u7684\u5b57\u7b26\u6d41\u3002</li> <li>BufferedReader / BufferedWriter\uff1a\u5e26\u6709\u7f13\u51b2\u533a\u7684\u5b57\u7b26\u6d41\uff0c\u63d0\u9ad8\u8bfb\u5199\u6548\u7387\u3002</li> <li>DataInputStream / DataOutputStream\uff1a\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u6570\u636e\u6d41\u3002</li> <li>ObjectInputStream / ObjectOutputStream\uff1a\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u6d41\u3002</li> </ul> \u89d2\u8272 \u8bf4\u660e \u5178\u578b\u5b9e\u73b0\u7c7b \u8282\u70b9\u6d41 \u76f4\u63a5\u64cd\u4f5c\u6570\u636e\u6e90\u7684\u6d41 <code>FileInputStream</code>/<code>FileReader</code> \u5904\u7406\u6d41 \u5bf9\u73b0\u6709\u6d41\u8fdb\u884c\u5305\u88c5\u589e\u5f3a <code>BufferedInputStream</code>/<code>Scanner</code> \u8f6c\u6362\u6d41 \u5b57\u8282\u6d41\u4e0e\u5b57\u7b26\u6d41\u7684\u6865\u6881 <code>InputStreamReader</code>/<code>OutputStreamWriter</code> \u5bf9\u8c61\u5e8f\u5217\u5316\u6d41 \u5904\u7406Java\u5bf9\u8c61\u6301\u4e45\u5316 <code>ObjectInputStream</code>/<code>ObjectOutputStream</code>"},{"location":"Java/IO/#io\u6a21\u578b","title":"IO\u6a21\u578b","text":""},{"location":"Java/IO/#bio-\u963b\u585e\u5f0fio","title":"BIO-\u963b\u585e\u5f0fIO","text":"<ul> <li>\u540c\u6b65\u963b\u585e\u6a21\u578b\uff1a\u7ebf\u7a0b\u5728\u8bfb\u5199\u64cd\u4f5c\u65f6\u5b8c\u5168\u963b\u585e</li> <li>1:1\u7ebf\u7a0b\u8fde\u63a5\uff1a\u6bcf\u4e2a\u8fde\u63a5\u9700\u8981\u72ec\u7acb\u7ebf\u7a0b\u5904\u7406</li> <li>\u7b80\u5355\u76f4\u89c2\uff1a\u7f16\u7a0b\u6a21\u578b\u7b80\u5355\uff0c\u9002\u5408\u4f4e\u5e76\u53d1\u573a\u666f</li> </ul> <pre><code>// \u5178\u578bBIO\u670d\u52a1\u5668\u5b9e\u73b0\nServerSocket server = new ServerSocket(8080);\nwhile(true) {\n    Socket client = server.accept(); // \u963b\u585e\u7b49\u5f85\u8fde\u63a5\n    new Thread(() -&gt; {\n        InputStream in = client.getInputStream();\n        // \u963b\u585e\u8bfb\u53d6\u6570\u636e\n        byte[] buffer = new byte[1024];\n        int len = in.read(buffer); // \u963b\u585e\u70b9\n        // \u5904\u7406\u8bf7\u6c42...\n    }).start();\n}\n</code></pre> \u4f18\u70b9 \u7f3a\u70b9 \u7f16\u7a0b\u7b80\u5355 \u7ebf\u7a0b\u8d44\u6e90\u6d88\u8017\u5927 \u8c03\u8bd5\u65b9\u4fbf \u5e76\u53d1\u91cf\u53d7\u9650\u4e8e\u7ebf\u7a0b\u6570 \u9002\u5408\u77ed\u8fde\u63a5 \u7ebf\u7a0b\u5207\u6362\u5f00\u9500\u9ad8"},{"location":"Java/IO/#nio-\u975e\u963b\u585eio","title":"NIO-\u975e\u963b\u585eIO","text":"<ul> <li>\u540c\u6b65\u975e\u963b\u585e\u6a21\u578b\uff1a\u901a\u8fc7Selector\u5b9e\u73b0\u591a\u8def\u590d\u7528</li> <li>\u4e8b\u4ef6\u9a71\u52a8\u673a\u5236\uff1a\u901a\u8fc7Channel\u6ce8\u518c\u611f\u5174\u8da3\u7684\u4e8b\u4ef6</li> <li>\u5355\u7ebf\u7a0b\u5904\u7406\u591a\u8fde\u63a5\uff1a\u57fa\u4e8e\u5c31\u7eea\u9009\u62e9\u673a\u5236</li> </ul> <p>\u6838\u5fc3\u7ec4\u4ef6</p> \u7ec4\u4ef6 \u4f5c\u7528 Channel \u53cc\u5411\u6570\u636e\u4f20\u8f93\u901a\u9053 Buffer \u6570\u636e\u7f13\u5b58\u533a Selector \u591a\u8def\u4e8b\u4ef6\u76d1\u542c\u5668 <pre><code>// NIO\u670d\u52a1\u5668\u6838\u5fc3\u4ee3\u7801\nSelector selector = Selector.open();\nServerSocketChannel ssc = ServerSocketChannel.open();\nssc.bind(new InetSocketAddress(8080));\nssc.configureBlocking(false);\nssc.register(selector, SelectionKey.OP_ACCEPT); // \u6ce8\u518caccept\u4e8b\u4ef6\n\nwhile(true) {\n    selector.select(); // \u963b\u585e\u76f4\u5230\u6709\u5c31\u7eea\u4e8b\u4ef6\n    Set&lt;SelectionKey&gt; keys = selector.selectedKeys();\n    Iterator&lt;SelectionKey&gt; iter = keys.iterator();\n\n    while(iter.hasNext()) {\n        SelectionKey key = iter.next();\n        if(key.isAcceptable()) {\n            // \u5904\u7406\u65b0\u8fde\u63a5\n            SocketChannel sc = ((ServerSocketChannel)key.channel()).accept();\n            sc.configureBlocking(false);\n            sc.register(selector, SelectionKey.OP_READ);\n        } else if(key.isReadable()) {\n            // \u5904\u7406\u8bfb\u4e8b\u4ef6\n            SocketChannel sc = (SocketChannel)key.channel();\n            ByteBuffer buffer = ByteBuffer.allocate(1024);\n            sc.read(buffer); // \u975e\u963b\u585e\u8bfb\u53d6\n            // \u5904\u7406\u6570\u636e...\n        }\n        iter.remove();\n    }\n}\n</code></pre>"},{"location":"Java/IO/#aio-\u5f02\u6b65io","title":"AIO-\u5f02\u6b65IO","text":"<ul> <li>\u771f\u6b63\u7684\u5f02\u6b65\u975e\u963b\u585e\uff1a\u5185\u6838\u5b8c\u6210IO\u540e\u56de\u8c03\u901a\u77e5</li> <li>Proactor\u6a21\u5f0f\uff1a\u5e94\u7528\u7a0b\u5e8f\u4e0d\u53c2\u4e0eIO\u8fc7\u7a0b</li> <li>\u56de\u8c03\u9a71\u52a8\uff1a\u901a\u8fc7CompletionHandler\u5904\u7406\u7ed3\u679c</li> </ul> <pre><code>// AIO\u670d\u52a1\u5668\u793a\u4f8b\nAsynchronousServerSocketChannel server = \n    AsynchronousServerSocketChannel.open().bind(new InetSocketAddress(8080));\n\n// \u5f02\u6b65\u63a5\u6536\u8fde\u63a5\nserver.accept(null, new CompletionHandler&lt;AsynchronousSocketChannel, Void&gt;() {\n    @Override\n    public void completed(AsynchronousSocketChannel client, Void attachment) {\n        server.accept(null, this); // \u7ee7\u7eed\u63a5\u6536\u65b0\u8fde\u63a5\n\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        // \u5f02\u6b65\u8bfb\u64cd\u4f5c\n        client.read(buffer, buffer, new CompletionHandler&lt;Integer, ByteBuffer&gt;() {\n            @Override\n            public void completed(Integer result, ByteBuffer buf) {\n                // \u5904\u7406\u8bfb\u53d6\u5230\u7684\u6570\u636e\n                buf.flip();\n                // \u5f02\u6b65\u5199\u56de\n                client.write(buf);\n            }\n\n            @Override\n            public void failed(Throwable exc, ByteBuffer buf) {\n                exc.printStackTrace();\n            }\n        });\n    }\n\n    @Override\n    public void failed(Throwable exc, Void attachment) {\n        exc.printStackTrace();\n    }\n});\n</code></pre> \u6a21\u578b \u82f1\u6587\u5168\u79f0 JDK\u7248\u672c \u6838\u5fc3\u7279\u70b9 \u9002\u7528\u573a\u666f BIO Blocking I/O 1.0+ \u540c\u6b65\u963b\u585e \u8fde\u63a5\u6570\u5c11(&lt;1000)\u7684\u56fa\u5b9a\u67b6\u6784 NIO Non-blocking I/O 1.4+ \u540c\u6b65\u975e\u963b\u585e/\u591a\u8def\u590d\u7528 \u9ad8\u5e76\u53d1\u8fde\u63a5(\u5982\u804a\u5929\u670d\u52a1\u5668) AIO Asynchronous I/O 1.7+ \u5f02\u6b65\u975e\u963b\u585e \u957f\u8fde\u63a5\u5927\u6587\u4ef6\u64cd\u4f5c(\u5982\u4e91\u5b58\u50a8) <ol> <li>BIO\u9002\u7528\u573a\u666f\uff1a<ul> <li>\u5ba2\u6237\u7aef\u5e94\u7528\u5f00\u53d1</li> <li>\u5185\u90e8\u7cfb\u7edf\u901a\u4fe1</li> <li>\u8fde\u63a5\u6570\u53ef\u9884\u4f30\u7684\u670d\u52a1\u5668</li> </ul> </li> <li>NIO\u9002\u7528\u573a\u666f\uff1a<ul> <li>\u9ad8\u5e76\u53d1Web\u670d\u52a1\u5668(Tomcat 8+\u9ed8\u8ba4NIO)</li> <li>\u5b9e\u65f6\u901a\u4fe1\u7cfb\u7edf(\u5982WebSocket)</li> <li>P2P\u7f51\u7edc\u5e94\u7528</li> </ul> </li> <li>AIO\u9002\u7528\u573a\u666f\uff1a<ul> <li>\u5927\u578b\u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d</li> <li>\u6570\u636e\u5e93\u5907\u4efd\u7cfb\u7edf</li> <li>\u9700\u8981\u6781\u81f4\u6027\u80fd\u7684\u91d1\u878d\u4ea4\u6613\u7cfb\u7edf</li> </ul> </li> </ol> <p>\u5b8c</p>"},{"location":"Java/%E4%B8%8D%E5%8F%AF%E5%8F%98%E9%9B%86%E5%90%88/","title":"\u4e0d\u53ef\u53d8\u96c6\u5408","text":"<p>\u4e0d\u53ef\u53d8\u96c6\u5408\uff08Immutable Collections\uff09\u662f\u6307\u4e00\u65e6\u521b\u5efa\u540e\u5c31\u4e0d\u80fd\u88ab\u4fee\u6539\u7684\u96c6\u5408\u3002</p> <p>\u4e0d\u53ef\u53d8\u96c6\u5408\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u975e\u5e38\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u4eec\u5929\u751f\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u540c\u65f6\u4e5f\u907f\u514d\u4e86\u610f\u5916\u7684\u4fee\u6539\u3002</p> <p></p> <p>\u5728 Java 8 \u53ca\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>Collections</code> \u5de5\u5177\u7c7b\u7684 <code>unmodifiableXXX()</code> \u65b9\u6cd5\u5c06\u53ef\u53d8\u96c6\u5408\u8f6c\u6362\u4e3a\u4e0d\u53ef\u53d8\u96c6\u5408\u3002</p> <pre><code>// \u521b\u5efa\u4e00\u4e2a\u53ef\u53d8\u96c6\u5408\nList&lt;String&gt; mutableList = new ArrayList&lt;&gt;();\nmutableList.add(\"Apple\");\nmutableList.add(\"Banana\");\nmutableList.add(\"Cherry\");\n\n// \u8f6c\u6362\u4e3a\u4e0d\u53ef\u53d8\u96c6\u5408\nList&lt;String&gt; immutableList = Collections.unmodifiableList(mutableList);\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u521b\u5efa\u7684\u4e0d\u53ef\u53d8\u96c6\u5408\u662f\u5bf9\u539f\u59cb\u96c6\u5408\u7684\u89c6\u56fe\uff0c\u5982\u679c\u539f\u59cb\u96c6\u5408\u88ab\u4fee\u6539\uff0c\u4e0d\u53ef\u53d8\u96c6\u5408\u7684\u5185\u5bb9\u4e5f\u4f1a\u968f\u4e4b\u6539\u53d8\u3002</p> <p></p> <p>\u4ece Java 9 \u5f00\u59cb\uff0cJava \u63d0\u4f9b\u4e86\u66f4\u7b80\u6d01\u7684\u5de5\u5382\u65b9\u6cd5\u6765\u521b\u5efa\u4e0d\u53ef\u53d8\u96c6\u5408\u3002(\u63a8\u8350)</p> <pre><code>// \u521b\u5efa\u4e0d\u53ef\u53d8 List\nList&lt;String&gt; immutableList = List.of(\"Apple\", \"Banana\", \"Cherry\");\n\n// \u521b\u5efa\u4e0d\u53ef\u53d8 Set\nSet&lt;String&gt; immutableSet = Set.of(\"Apple\", \"Banana\", \"Cherry\");\n\n// \u521b\u5efa\u4e0d\u53ef\u53d8 Map\nMap&lt;String, Integer&gt; immutableMap = Map.of(\"Apple\", 1, \"Banana\", 2, \"Cherry\", 3);\n// Map.of()\u5177\u6709\u957f\u5ea6\u9650\u523610\uff0c\u53ef\u4f7f\u7528Map.ofEntries()\uff0c\u6216\u8005JDK10\u4ee5\u4e0aMap.copyOf()\n</code></pre> <p>\u6ce8\u610f</p> <ul> <li><code>List.of()</code>\u3001<code>Set.of()</code> \u548c <code>Map.of()</code> \u521b\u5efa\u7684\u96c6\u5408\u662f\u5b8c\u5168\u4e0d\u53ef\u53d8\u7684\uff0c\u4e14\u4e0e\u539f\u59cb\u96c6\u5408\u65e0\u5173\u3002</li> <li>\u8fd9\u4e9b\u65b9\u6cd5\u4e0d\u63a5\u53d7 <code>null</code> \u503c\uff0c\u5982\u679c\u4f20\u5165 <code>null</code>\uff0c\u4f1a\u629b\u51fa <code>NullPointerException</code>\u3002</li> </ul> <p>\u5b8c</p>"},{"location":"Java/%E4%BB%A3%E7%90%86/","title":"\u4ee3\u7406","text":"<p>\u4ee3\u7406\uff08Proxy\uff09\u662f Java \u4e2d\u4e00\u79cd\u91cd\u8981\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u5728\u4e0d\u4fee\u6539\u539f\u59cb\u7c7b\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u589e\u5f3a\u6216\u63a7\u5236\u5bf9\u8c61\u7684\u884c\u4e3a\u3002</p> <p>Java \u63d0\u4f9b\u4e86\u591a\u79cd\u4ee3\u7406\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e3b\u8981\u5206\u4e3a \u9759\u6001\u4ee3\u7406 \u548c \u52a8\u6001\u4ee3\u7406\uff08JDK \u52a8\u6001\u4ee3\u7406\u3001CGLIB \u52a8\u6001\u4ee3\u7406\uff09\u3002</p> <p></p>"},{"location":"Java/%E4%BB%A3%E7%90%86/#\u9759\u6001\u4ee3\u7406","title":"\u9759\u6001\u4ee3\u7406","text":"<p>\u7279\u70b9</p> <ul> <li>\u624b\u52a8\u7f16\u5199\u4ee3\u7406\u7c7b\uff0c\u5728\u7f16\u8bd1\u65f6\u786e\u5b9a\u4ee3\u7406\u5173\u7cfb</li> <li>\u4ee3\u7406\u7c7b\u548c\u76ee\u6807\u7c7b\u5b9e\u73b0\u76f8\u540c\u63a5\u53e3</li> <li>\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u6bcf\u4e2a\u76ee\u6807\u7c7b\u9700\u8981\u4e00\u4e2a\u4ee3\u7406\u7c7b</li> </ul> <p>\u793a\u4f8b</p> <pre><code>// 1. \u5b9a\u4e49\u63a5\u53e3\ninterface UserService {\n    void save();\n}\n\n// 2. \u76ee\u6807\u7c7b\nclass UserServiceImpl implements UserService {\n    public void save() {\n        System.out.println(\"\u4fdd\u5b58\u7528\u6237\");\n    }\n}\n\n// 3. \u9759\u6001\u4ee3\u7406\u7c7b\nclass UserServiceProxy implements UserService {\n    private UserService target;\n\n    public UserServiceProxy(UserService target) {\n        this.target = target;\n    }\n\n    public void save() {\n        System.out.println(\"\u524d\u7f6e\u589e\u5f3a\");\n        target.save(); // \u8c03\u7528\u76ee\u6807\u65b9\u6cd5\n        System.out.println(\"\u540e\u7f6e\u589e\u5f3a\");\n    }\n}\n\n// 4. \u4f7f\u7528\npublic class Main {\n    public static void main(String[] args) {\n        UserService target = new UserServiceImpl();\n        UserService proxy = new UserServiceProxy(target);\n        proxy.save();\n    }\n}\n</code></pre> \u4f18\u70b9 \u7f3a\u70b9 \u5b9e\u73b0\u7b80\u5355 \u6bcf\u4e2a\u76ee\u6807\u7c7b\u9700\u8981\u4e00\u4e2a\u4ee3\u7406\u7c7b \u65e0\u989d\u5916\u4f9d\u8d56 \u63a5\u53e3\u4fee\u6539\u65f6\u9700\u540c\u6b65\u4fee\u6539\u4ee3\u7406\u7c7b <p></p>"},{"location":"Java/%E4%BB%A3%E7%90%86/#\u52a8\u6001\u4ee3\u7406","title":"\u52a8\u6001\u4ee3\u7406","text":""},{"location":"Java/%E4%BB%A3%E7%90%86/#jdk\u52a8\u6001\u4ee3\u7406","title":"JDK\u52a8\u6001\u4ee3\u7406","text":"<p>\u7279\u70b9</p> <ul> <li>\u57fa\u4e8e\u63a5\u53e3\uff08\u8981\u6c42\u76ee\u6807\u7c7b\u5fc5\u987b\u5b9e\u73b0\u63a5\u53e3\uff09</li> <li>\u901a\u8fc7 <code>java.lang.reflect.Proxy</code> \u548c <code>InvocationHandler</code> \u5b9e\u73b0</li> <li>\u8fd0\u884c\u65f6\u751f\u6210\u4ee3\u7406\u7c7b</li> </ul> <p>\u793a\u4f8b</p> <pre><code>// 1. \u5b9a\u4e49\u63a5\u53e3\u548c\u76ee\u6807\u7c7b\uff08\u540c\u4e0a\uff09\n\n// 2. \u5b9e\u73b0 InvocationHandler\nclass LogHandler implements InvocationHandler {\n    private Object target;\n\n    public LogHandler(Object target) {\n        this.target = target;\n    }\n\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        System.out.println(\"\u65b9\u6cd5\u8c03\u7528\u524d: \" + method.getName());\n        Object result = method.invoke(target, args); // \u53cd\u5c04\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\n        System.out.println(\"\u65b9\u6cd5\u8c03\u7528\u540e\");\n        return result;\n    }\n}\n\n// 3. \u4f7f\u7528 Proxy \u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\npublic class Main {\n    public static void main(String[] args) {\n        UserService target = new UserServiceImpl();\n        UserService proxy = (UserService) Proxy.newProxyInstance(\n            target.getClass().getClassLoader(),\n            target.getClass().getInterfaces(),\n            new LogHandler(target)\n        );\n        proxy.save();\n    }\n}\n</code></pre> <p>\u5b9e\u73b0\u539f\u7406</p> <ol> <li>\u8fd0\u884c\u65f6\u751f\u6210\u4ee3\u7406\u7c7b\uff08\u7c7b\u540d\u683c\u5f0f\uff1a<code>$Proxy0</code>\uff09</li> <li>\u4ee3\u7406\u7c7b\u7ee7\u627f <code>Proxy</code> \u5e76\u5b9e\u73b0\u76ee\u6807\u63a5\u53e3</li> <li>\u65b9\u6cd5\u8c03\u7528\u8f6c\u53d1\u7ed9 <code>InvocationHandler.invoke()</code></li> </ol> <p></p>"},{"location":"Java/%E4%BB%A3%E7%90%86/#cglib\u52a8\u6001\u4ee3\u7406","title":"CGLIB\u52a8\u6001\u4ee3\u7406","text":"<p>\u7279\u70b9</p> <ul> <li>\u57fa\u4e8e\u7ee7\u627f\uff08\u53ef\u4ee3\u7406\u65e0\u63a5\u53e3\u7684\u7c7b\uff09</li> <li>\u901a\u8fc7 ASM \u5b57\u8282\u7801\u6846\u67b6\u751f\u6210\u5b50\u7c7b</li> <li>\u9700\u8981\u5f15\u5165 <code>cglib</code> \u4f9d\u8d56</li> </ul> <p>\u793a\u4f8b</p> <pre><code>// 1. \u76ee\u6807\u7c7b\uff08\u65e0\u9700\u63a5\u53e3\uff09\nclass UserService {\n    public void save() {\n        System.out.println(\"\u4fdd\u5b58\u7528\u6237\");\n    }\n}\n\n// 2. \u5b9e\u73b0 MethodInterceptor\nclass LogInterceptor implements MethodInterceptor {\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println(\"\u65b9\u6cd5\u8c03\u7528\u524d: \" + method.getName());\n        Object result = proxy.invokeSuper(obj, args); // \u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\n        System.out.println(\"\u65b9\u6cd5\u8c03\u7528\u540e\");\n        return result;\n    }\n}\n\n// 3. \u4f7f\u7528 Enhancer \u521b\u5efa\u4ee3\u7406\npublic class Main {\n    public static void main(String[] args) {\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(UserService.class); // \u8bbe\u7f6e\u7236\u7c7b\n        enhancer.setCallback(new LogInterceptor()); // \u8bbe\u7f6e\u56de\u8c03\n        UserService proxy = (UserService) enhancer.create(); // \u521b\u5efa\u4ee3\u7406\n        proxy.save();\n    }\n}\n</code></pre> <p>\u5b9e\u73b0\u539f\u7406</p> <ol> <li>\u751f\u6210\u76ee\u6807\u7c7b\u7684\u5b50\u7c7b\uff08\u5982 <code>UserService$$EnhancerByCGLIB$$xxxx</code>\uff09</li> <li>\u91cd\u5199\u7236\u7c7b\u65b9\u6cd5\uff0c\u52a0\u5165\u62e6\u622a\u903b\u8f91</li> </ol> <p></p>"},{"location":"Java/%E4%BB%A3%E7%90%86/#\u5bf9\u6bd4","title":"\u5bf9\u6bd4","text":"\u7279\u6027 \u9759\u6001\u4ee3\u7406 JDK \u52a8\u6001\u4ee3\u7406 CGLIB \u52a8\u6001\u4ee3\u7406 \u662f\u5426\u9700\u8981\u63a5\u53e3 \u9700\u8981 \u9700\u8981 \u4e0d\u9700\u8981 \u751f\u6210\u65b9\u5f0f \u624b\u52a8\u7f16\u5199 \u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210 \u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210 \u6027\u80fd \u9ad8 \u4e2d\u7b49\uff08\u53cd\u5c04\u8c03\u7528\uff09 \u9ad8\uff08ASM \u5b57\u8282\u7801\uff09 \u4f9d\u8d56 \u65e0 JDK \u81ea\u5e26 \u9700\u5f15\u5165 <code>cglib</code> \u9002\u7528\u573a\u666f \u7b80\u5355\u5c11\u91cf\u4ee3\u7406 \u57fa\u4e8e\u63a5\u53e3\u7684\u4ee3\u7406 \u65e0\u63a5\u53e3\u7684\u7c7b\u4ee3\u7406"},{"location":"Java/%E4%BB%A3%E7%90%86/#\u5e94\u7528\u573a\u666f","title":"\u5e94\u7528\u573a\u666f","text":"<ol> <li>AOP \u7f16\u7a0b\uff08\u5982 Spring AOP\uff09</li> <li>\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\uff08RPC \u6846\u67b6\uff09</li> <li>\u4e8b\u52a1\u7ba1\u7406</li> <li>\u65e5\u5fd7\u8bb0\u5f55</li> <li>\u6743\u9650\u63a7\u5236</li> </ol> <p>\u5b8c</p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/","title":"\u51fd\u6570\u5f0f\u7f16\u7a0b","text":"<p>Java 8 \u5f15\u5165\u4e86\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u652f\u6301\uff0c\u4e3b\u8981\u901a\u8fc7 Lambda \u8868\u8fbe\u5f0f\u3001\u51fd\u6570\u5f0f\u63a5\u53e3\u3001Stream API \u548c \u65b9\u6cd5\u5f15\u7528 \u7b49\u7279\u6027\u6765\u5b9e\u73b0\u3002\u4ee5\u4e0b\u662f Java \u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u6838\u5fc3\u77e5\u8bc6\u70b9\uff1a</p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#1lambda-\u8868\u8fbe\u5f0f","title":"1.Lambda \u8868\u8fbe\u5f0f","text":"<p>Lambda \u8868\u8fbe\u5f0f\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u6838\u5fc3\u7279\u6027\u4e4b\u4e00\uff0c\u5b83\u5141\u8bb8\u5c06\u51fd\u6570\u4f5c\u4e3a\u65b9\u6cd5\u53c2\u6570\u4f20\u9012\uff0c\u7b80\u5316\u4e86\u533f\u540d\u5185\u90e8\u7c7b\u7684\u5199\u6cd5\u3002</p> <p>\u8bed\u6cd5\uff1a</p> <pre><code>(parameters) -&gt; expression\n(parameters) -&gt; { statements; }\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>// \u4f20\u7edf\u533f\u540d\u5185\u90e8\u7c7b\nRunnable r1 = new Runnable() {\n    @Override\n    public void run() {\n        System.out.println(\"Hello World\");\n    }\n};\n\n// \u4f7f\u7528 Lambda \u8868\u8fbe\u5f0f\nRunnable r2 = () -&gt; System.out.println(\"Hello World\");\n</code></pre> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#2\u51fd\u6570\u5f0f\u63a5\u53e3functional-interface","title":"2.\u51fd\u6570\u5f0f\u63a5\u53e3\uff08Functional Interface\uff09","text":"<p>\u51fd\u6570\u5f0f\u63a5\u53e3\u662f\u53ea\u5305\u542b\u4e00\u4e2a\u62bd\u8c61\u65b9\u6cd5\u7684\u63a5\u53e3\u3002Java 8 \u63d0\u4f9b\u4e86 <code>@FunctionalInterface</code> \u6ce8\u89e3\u6765\u6807\u8bc6\u51fd\u6570\u5f0f\u63a5\u53e3\u3002</p> <p>\u5e38\u89c1\u7684\u51fd\u6570\u5f0f\u63a5\u53e3\uff1a</p> <ul> <li><code>Runnable</code>\uff1a<code>void run()</code></li> <li><code>Supplier&lt;T&gt;</code>\uff1a<code>T get()</code></li> <li><code>Consumer&lt;T&gt;</code>\uff1a<code>void accept(T t)</code></li> <li><code>Function&lt;T, R&gt;</code>\uff1a<code>R apply(T t)</code></li> <li><code>Predicate&lt;T&gt;</code>\uff1a<code>boolean test(T t)</code></li> </ul> <p>\u793a\u4f8b\uff1a <pre><code>@FunctionalInterface\ninterface MyFunctionalInterface {\n    void doSomething();\n}\n\nMyFunctionalInterface func = () -&gt; System.out.println(\"Doing something\");\nfunc.doSomething();\n</code></pre></p> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#3stream-api","title":"3.Stream API","text":"<p>Java Stream \u6d41\u662f Java 8 \u5f15\u5165\u7684\u4e00\u4e2a\u65b0\u7684\u62bd\u8c61\u5c42\uff0c\u7528\u4e8e\u5904\u7406\u5e8f\u5217\uff08\u5982\u96c6\u5408\uff09\u4e2d\u7684\u5143\u7d20\u3002Stream \u6d41\u5141\u8bb8\u4f60\u4ee5\u58f0\u660e\u6027\u7684\u65b9\u5f0f\u5904\u7406\u6570\u636e\uff0c\u652f\u6301\u8bf8\u5982\u8fc7\u6ee4\u3001\u6620\u5c04\u3001\u6392\u5e8f\u3001\u805a\u5408\u548c\u67e5\u627e\u7b49\u64cd\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fdb\u884c\u5e76\u884c\u5904\u7406</p> <p>\u6838\u5fc3\u64cd\u4f5c\uff1a</p> <ul> <li>\u4e2d\u95f4\u64cd\u4f5c\uff1a<code>filter</code>, <code>map</code>, <code>sorted</code>, <code>distinct</code> \u7b49\u3002</li> <li>\u7ec8\u7aef\u64cd\u4f5c\uff1a<code>forEach</code>, <code>collect</code>, <code>reduce</code>, <code>count</code> \u7b49\u3002</li> </ul> <p>\u6d41\u7684\u4f7f\u7528\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u521b\u5efa\u6d41\uff1a\u53ef\u4ee5\u901a\u8fc7\u96c6\u5408\uff08\u5982 List\u3001Set\uff09\u3001\u6570\u7ec4\u3001\u751f\u6210\u5668\u6216\u7279\u5b9a\u7684\u65b9\u6cd5\u6765\u521b\u5efa\u6d41\u3002</p> <ul> <li> <p>\u4f8b\u5982\uff1a<code>List&lt;String&gt; list = Arrays.asList(\"a\", \"b\", \"c\"); Stream&lt;String&gt; stream = list.stream();</code></p> </li> <li> <p>\u5355\u5217\u96c6\u5408\u5982<code>ArrayList</code>\u3001<code>LinkedList</code>\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>Collection</code>\u4e2d\u7684\u9ed8\u8ba4\u65b9\u6cd5<code>stream()</code>\u83b7\u5f97\u6d41</p> </li> <li> <p>\u53cc\u5217\u96c6\u5408\u5982<code>HashMap</code>\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u6d41\uff0c\u9700\u8981\u901a\u8fc7<code>keySet()</code>\u65b9\u6cd5\u6216<code>entrySet()</code>\u65b9\u6cd5\u5f97\u5230\u5355\u5217\u96c6\u5408</p> </li> <li> <p>\u6570\u7ec4\u53ef\u4ee5\u4f7f\u7528<code>Arrays</code>\u5de5\u5177\u7c7b\u4e2d\u7684\u9759\u6001\u65b9\u6cd5\u83b7\u5f97\u6d41</p> </li> </ul> </li> <li> <p>\u4e2d\u95f4\u64cd\u4f5c\uff1a\u8fd9\u4e9b\u64cd\u4f5c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u6d41\uff0c\u5141\u8bb8\u4f60\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002</p> <ul> <li>\u5e38\u89c1\u7684\u4e2d\u95f4\u64cd\u4f5c\u6709\uff1a<code>filter()</code>\uff08\u8fc7\u6ee4\uff09\u3001<code>map()</code>\uff08\u6620\u5c04\uff09\u3001<code>sorted()</code>\uff08\u6392\u5e8f\uff09\u3001<code>distinct()</code>\uff08\u53bb\u91cd\uff09\u7b49\u3002</li> </ul> </li> <li> <p>\u7ec8\u7aef\u64cd\u4f5c\uff1a\u8fd9\u4e9b\u64cd\u4f5c\u4f1a\u7ed3\u675f\u6d41\u7684\u6d41\u6c34\u7ebf\u5e76\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\uff08\u5982\u4e00\u4e2a\u503c\uff0c\u4e00\u4e2a\u96c6\u5408\uff0c\u6216\u8005\u4e0d\u8fd4\u56de\u4efb\u4f55\u503c\uff0c\u5982\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c\uff09\u3002</p> <ul> <li>\u5e38\u89c1\u7684\u7ec8\u7aef\u64cd\u4f5c\u6709\uff1a<code>forEach()</code>\uff08\u5bf9\u6bcf\u4e2a\u5143\u7d20\u6267\u884c\u64cd\u4f5c\uff09\u3001<code>collect()</code>\uff08\u6536\u96c6\u7ed3\u679c\uff09\u3001<code>reduce()</code>\uff08\u5f52\u7ea6\uff09\u3001<code>count()</code>\uff08\u8ba1\u6570\uff09\u3001<code>anyMatch()</code>\uff08\u5339\u914d\u4efb\u610f\u5143\u7d20\uff09\u3001<code>allMatch()</code>\uff08\u5339\u914d\u6240\u6709\u5143\u7d20\uff09\u3001<code>noneMatch()</code>\uff08\u4e0d\u5339\u914d\u4efb\u4f55\u5143\u7d20\uff09\u7b49\u3002</li> </ul> </li> </ol> <p>\u793a\u4f8b\uff1a</p> <pre><code>List&lt;String&gt; names = Arrays.asList(\"Alice\", \"Bob\", \"Charlie\", \"David\");\n\n// \u8fc7\u6ee4\u5e76\u6253\u5370\u957f\u5ea6\u5927\u4e8e 3 \u7684\u540d\u5b57\nnames.stream()\n     .filter(name -&gt; name.length() &gt; 3)\n     .forEach(System.out::println);\n\n// \u5c06\u540d\u5b57\u8f6c\u6362\u4e3a\u5927\u5199\u5e76\u6536\u96c6\u5230\u5217\u8868\nList&lt;String&gt; upperCaseNames = names.stream()\n                                   .map(String::toUpperCase)\n                                   .collect(Collectors.toList());\n</code></pre> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#4-\u5e76\u884c\u6d41parallel-stream","title":"4. \u5e76\u884c\u6d41\uff08Parallel Stream\uff09","text":"<p>Java 8 \u7684 Stream API \u652f\u6301\u5e76\u884c\u5904\u7406\u6570\u636e\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u7684\u4f18\u52bf\u3002</p> <p>\u793a\u4f8b\uff1a <pre><code>List&lt;String&gt; names = Arrays.asList(\"Alice\", \"Bob\", \"Charlie\", \"David\");\n\n// \u5e76\u884c\u5904\u7406\nlong count = names.parallelStream()\n                  .filter(name -&gt; name.length() &gt; 3)\n                  .count();\n</code></pre></p> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#5\u65b9\u6cd5\u5f15\u7528method-reference","title":"5.\u65b9\u6cd5\u5f15\u7528\uff08Method Reference\uff09","text":"<p>\u65b9\u6cd5\u5f15\u7528\u662f Lambda \u8868\u8fbe\u5f0f\u7684\u4e00\u79cd\u7b80\u5316\u5199\u6cd5\uff0c\u7528\u4e8e\u76f4\u63a5\u5f15\u7528\u5df2\u6709\u7684\u65b9\u6cd5\u3002</p> <p>\u56db\u79cd\u65b9\u6cd5\u5f15\u7528\u5f62\u5f0f\uff1a 1. \u9759\u6001\u65b9\u6cd5\u5f15\u7528\uff1a<code>ClassName::staticMethod</code> 2. \u5b9e\u4f8b\u65b9\u6cd5\u5f15\u7528\uff1a<code>instance::method</code> 3. \u7c7b\u7684\u4efb\u610f\u5bf9\u8c61\u7684\u5b9e\u4f8b\u65b9\u6cd5\u5f15\u7528\uff1a<code>ClassName::method</code> 4. \u6784\u9020\u65b9\u6cd5\u5f15\u7528\uff1a<code>ClassName::new</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>// Lambda \u8868\u8fbe\u5f0f\nList&lt;String&gt; names = Arrays.asList(\"Alice\", \"Bob\", \"Charlie\");\nnames.forEach(name -&gt; System.out.println(name));\n\n// \u65b9\u6cd5\u5f15\u7528\nnames.forEach(System.out::println);\n</code></pre> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#6optional-\u7c7b","title":"6.Optional \u7c7b","text":"<p><code>Optional</code> \u662f Java 8 \u5f15\u5165\u7684\u7528\u4e8e\u89e3\u51b3 <code>null</code> \u95ee\u9898\u7684\u5bb9\u5668\u7c7b\u3002\u5b83\u53ef\u4ee5\u907f\u514d\u7a7a\u6307\u9488\u5f02\u5e38\uff0c\u5e76\u63d0\u4f9b\u51fd\u6570\u5f0f\u7f16\u7a0b\u98ce\u683c\u7684\u64cd\u4f5c\u3002</p> <p>\u5e38\u7528\u65b9\u6cd5\uff1a - <code>of</code>, <code>ofNullable</code>, <code>empty</code> - <code>isPresent</code>, <code>ifPresent</code> - <code>orElse</code>, <code>orElseGet</code>, <code>orElseThrow</code> - <code>map</code>, <code>flatMap</code>, <code>filter</code></p> <p>\u793a\u4f8b\uff1a <pre><code>Optional&lt;String&gt; name = Optional.ofNullable(getName());\nname.ifPresent(System.out::println);\n\nString result = name.orElse(\"Default Name\");\n</code></pre></p> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#7\u9ad8\u9636\u51fd\u6570","title":"7.\u9ad8\u9636\u51fd\u6570","text":"<p>\u9ad8\u9636\u51fd\u6570\u662f\u6307\u63a5\u53d7\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u6216\u8fd4\u56de\u51fd\u6570\u7684\u51fd\u6570\u3002Java \u4e2d\u53ef\u4ee5\u901a\u8fc7\u51fd\u6570\u5f0f\u63a5\u53e3\u5b9e\u73b0\u9ad8\u9636\u51fd\u6570\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>public static &lt;T&gt; List&lt;T&gt; filterList(List&lt;T&gt; list, Predicate&lt;T&gt; predicate) {\n    return list.stream()\n               .filter(predicate)\n               .collect(Collectors.toList());\n}\n\nList&lt;String&gt; names = Arrays.asList(\"Alice\", \"Bob\", \"Charlie\");\nList&lt;String&gt; filteredNames = filterList(names, name -&gt; name.startsWith(\"A\"));\n</code></pre> <p></p>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#8\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u4f18\u52bf","title":"8.\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u4f18\u52bf","text":"<ul> <li>\u7b80\u6d01\u6027\uff1a\u4ee3\u7801\u66f4\u7b80\u6d01\u6613\u8bfb\u3002</li> <li>\u4e0d\u53ef\u53d8\u6027\uff1a\u5f3a\u8c03\u4e0d\u53ef\u53d8\u5bf9\u8c61\u548c\u7eaf\u51fd\u6570\uff0c\u51cf\u5c11\u526f\u4f5c\u7528\u3002</li> <li>\u5e76\u884c\u5904\u7406\uff1aStream API \u652f\u6301\u5e76\u884c\u5904\u7406\uff0c\u63d0\u5347\u6027\u80fd\u3002</li> <li>\u7ec4\u5408\u6027\uff1a\u51fd\u6570\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\uff0c\u63d0\u9ad8\u4ee3\u7801\u590d\u7528\u6027\u3002</li> </ul>"},{"location":"Java/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/#9\u6ce8\u610f\u4e8b\u9879","title":"9.\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u6027\u80fd\u5f00\u9500\uff1aLambda \u8868\u8fbe\u5f0f\u548c Stream API \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u53ef\u80fd\u5e26\u6765\u6027\u80fd\u5f00\u9500\u3002</li> <li>\u8c03\u8bd5\u56f0\u96be\uff1aLambda \u8868\u8fbe\u5f0f\u7684\u8c03\u8bd5\u4e0d\u5982\u4f20\u7edf\u4ee3\u7801\u76f4\u89c2\u3002</li> <li>\u6ee5\u7528\u95ee\u9898\uff1a\u8fc7\u5ea6\u4f7f\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u53ef\u80fd\u5bfc\u81f4\u4ee3\u7801\u53ef\u8bfb\u6027\u4e0b\u964d\u3002</li> </ul> <p>\u5b8c</p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/","title":"\u53cd\u5c04\u673a\u5236","text":"<p>Java \u53cd\u5c04\u673a\u5236\uff08Reflection\uff09\u662f Java \u63d0\u4f9b\u7684\u4e00\u79cd\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u83b7\u53d6\u7c7b\u4fe1\u606f\u5e76\u64cd\u4f5c\u7c7b\u6216\u5bf9\u8c61\u7684\u673a\u5236\u3002</p> <p>\u901a\u8fc7\u53cd\u5c04\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u83b7\u53d6\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u3001\u6210\u5458\u53d8\u91cf\u3001\u65b9\u6cd5\u7b49\u4fe1\u606f\uff0c\u5e76\u80fd\u591f\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u6216\u8bbf\u95ee/\u4fee\u6539\u6210\u5458\u53d8\u91cf\u3002</p> <p>\u53cd\u5c04\u673a\u5236\u4f7f\u5f97 Java \u7a0b\u5e8f\u5177\u6709\u66f4\u9ad8\u7684\u7075\u6d3b\u6027\u548c\u52a8\u6001\u6027\u3002</p> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#\u53cd\u5c04\u7684\u6838\u5fc3\u7c7b","title":"\u53cd\u5c04\u7684\u6838\u5fc3\u7c7b","text":"<p>Java \u53cd\u5c04\u673a\u5236\u4e3b\u8981\u901a\u8fc7\u4ee5\u4e0b\u51e0\u4e2a\u7c7b\u6765\u5b9e\u73b0\uff1a</p> <ol> <li>Class \u7c7b\uff1a\u8868\u793a\u4e00\u4e2a\u7c7b\u6216\u63a5\u53e3\uff0c\u662f\u53cd\u5c04\u7684\u6838\u5fc3\u7c7b\u3002\u901a\u8fc7 <code>Class</code> \u7c7b\u53ef\u4ee5\u83b7\u53d6\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u3001\u65b9\u6cd5\u3001\u5b57\u6bb5\u7b49\u4fe1\u606f\u3002</li> <li>Constructor \u7c7b\uff1a\u8868\u793a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u7528\u4e8e\u521b\u5efa\u7c7b\u7684\u5b9e\u4f8b\u3002</li> <li>Method \u7c7b\uff1a\u8868\u793a\u7c7b\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u8c03\u7528\u7c7b\u7684\u65b9\u6cd5\u3002</li> <li>Field \u7c7b\uff1a\u8868\u793a\u7c7b\u7684\u6210\u5458\u53d8\u91cf\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u83b7\u53d6\u6216\u4fee\u6539\u5bf9\u8c61\u7684\u5b57\u6bb5\u503c\u3002</li> </ol> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#\u53cd\u5c04\u7684\u57fa\u672c\u4f7f\u7528","title":"\u53cd\u5c04\u7684\u57fa\u672c\u4f7f\u7528","text":""},{"location":"Java/%E5%8F%8D%E5%B0%84/#1-\u83b7\u53d6-class-\u5bf9\u8c61","title":"1. \u83b7\u53d6 Class \u5bf9\u8c61","text":"<p>\u8981\u4f7f\u7528\u53cd\u5c04\uff0c\u9996\u5148\u9700\u8981\u83b7\u53d6\u7c7b\u7684 <code>Class</code> \u5bf9\u8c61\u3002</p> <p>\u83b7\u53d6 <code>Class</code> \u5bf9\u8c61\u7684\u65b9\u5f0f\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>\u901a\u8fc7 <code>Class.forName()</code> \u65b9\u6cd5\uff1a</li> </ul> <pre><code>Class&lt;?&gt; clazz = Class.forName(\"java.lang.String\");\n</code></pre> <ul> <li>\u901a\u8fc7\u7c7b\u7684 <code>.class</code> \u5c5e\u6027\uff1a</li> </ul> <pre><code>Class&lt;?&gt; clazz = String.class;\n</code></pre> <ul> <li>\u901a\u8fc7\u5bf9\u8c61\u7684 <code>getClass()</code> \u65b9\u6cd5\uff1a</li> </ul> <pre><code>String str = \"Hello\";\nClass&lt;?&gt; clazz = str.getClass();\n</code></pre> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#2-\u83b7\u53d6\u6784\u9020\u65b9\u6cd5\u5e76\u521b\u5efa\u5bf9\u8c61","title":"2. \u83b7\u53d6\u6784\u9020\u65b9\u6cd5\u5e76\u521b\u5efa\u5bf9\u8c61","text":"<p>\u901a\u8fc7 <code>Class</code> \u5bf9\u8c61\u53ef\u4ee5\u83b7\u53d6\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5e76\u521b\u5efa\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <pre><code>Class&lt;?&gt; clazz = Class.forName(\"java.lang.String\");\n// \u83b7\u53d6\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\nConstructor&lt;?&gt; constructor = clazz.getConstructor();\n// \u521b\u5efa\u5bf9\u8c61\nObject obj = constructor.newInstance();\n</code></pre> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#3-\u83b7\u53d6\u65b9\u6cd5\u5e76\u8c03\u7528","title":"3. \u83b7\u53d6\u65b9\u6cd5\u5e76\u8c03\u7528","text":"<p>\u901a\u8fc7 <code>Class</code> \u5bf9\u8c61\u53ef\u4ee5\u83b7\u53d6\u7c7b\u7684\u65b9\u6cd5\uff0c\u5e76\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u3002</p> <pre><code>Class&lt;?&gt; clazz = Class.forName(\"java.lang.String\");\n// \u83b7\u53d6\u65b9\u6cd5\nMethod method = clazz.getMethod(\"length\");\n// \u521b\u5efa\u5bf9\u8c61\nString str = \"Hello\";\n// \u8c03\u7528\u65b9\u6cd5\nint length = (int) method.invoke(str);\nSystem.out.println(\"Length: \" + length);  // \u8f93\u51fa: Length: 5\n</code></pre> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#4-\u83b7\u53d6\u5b57\u6bb5\u5e76\u8bbf\u95ee\u4fee\u6539","title":"4. \u83b7\u53d6\u5b57\u6bb5\u5e76\u8bbf\u95ee/\u4fee\u6539","text":"<p>\u901a\u8fc7 <code>Class</code> \u5bf9\u8c61\u53ef\u4ee5\u83b7\u53d6\u7c7b\u7684\u5b57\u6bb5\uff0c\u5e76\u8bbf\u95ee\u6216\u4fee\u6539\u8fd9\u4e9b\u5b57\u6bb5\u7684\u503c\u3002</p> <pre><code>class Person {\n    private String name;\n    public Person(String name) {\n        this.name = name;\n    }\n}\n\nClass&lt;?&gt; clazz = Person.class;\n// \u83b7\u53d6\u5b57\u6bb5\nField field = clazz.getDeclaredField(\"name\");\n// \u8bbe\u7f6e\u5b57\u6bb5\u53ef\u8bbf\u95ee\uff08\u5373\u4f7f\u662f\u79c1\u6709\u5b57\u6bb5\uff09\nfield.setAccessible(true);\n// \u521b\u5efa\u5bf9\u8c61\nPerson person = new Person(\"Alice\");\n// \u83b7\u53d6\u5b57\u6bb5\u503c\nString name = (String) field.get(person);\nSystem.out.println(\"Name: \" + name);  // \u8f93\u51fa: Name: Alice\n// \u4fee\u6539\u5b57\u6bb5\u503c\nfield.set(person, \"Bob\");\nSystem.out.println(\"Updated Name: \" + field.get(person));  // \u8f93\u51fa: Updated Name: Bob\n</code></pre> <p></p>"},{"location":"Java/%E5%8F%8D%E5%B0%84/#\u53cd\u5c04\u7684\u4f18\u7f3a\u70b9","title":"\u53cd\u5c04\u7684\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9\uff1a</p> <ol> <li>\u7075\u6d3b\u6027\uff1a\u53cd\u5c04\u5141\u8bb8\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u5730\u83b7\u53d6\u7c7b\u4fe1\u606f\u5e76\u64cd\u4f5c\u5bf9\u8c61\uff0c\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u7075\u6d3b\u6027\u3002</li> <li>\u901a\u7528\u6027\uff1a\u901a\u8fc7\u53cd\u5c04\u53ef\u4ee5\u7f16\u5199\u901a\u7528\u7684\u4ee3\u7801\uff0c\u9002\u7528\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u5bf9\u8c61\u3002</li> </ol> <p></p> <p>\u7f3a\u70b9\uff1a</p> <ol> <li>\u6027\u80fd\u5f00\u9500\uff1a\u53cd\u5c04\u64cd\u4f5c\u6bd4\u76f4\u63a5\u8c03\u7528\u65b9\u6cd5\u6216\u8bbf\u95ee\u5b57\u6bb5\u8981\u6162\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u7c7b\u578b\u68c0\u67e5\u548c\u8bbf\u95ee\u63a7\u5236\u3002</li> <li>\u5b89\u5168\u6027\u95ee\u9898\uff1a\u53cd\u5c04\u53ef\u4ee5\u8bbf\u95ee\u548c\u4fee\u6539\u79c1\u6709\u5b57\u6bb5\u548c\u65b9\u6cd5\uff0c\u7834\u574f\u4e86\u5c01\u88c5\u6027\uff0c\u53ef\u80fd\u5bfc\u81f4\u5b89\u5168\u95ee\u9898\u3002</li> <li>\u4ee3\u7801\u53ef\u8bfb\u6027\u5dee\uff1a\u53cd\u5c04\u4ee3\u7801\u901a\u5e38\u6bd4\u76f4\u63a5\u8c03\u7528\u4ee3\u7801\u66f4\u96be\u7406\u89e3\u548c\u7ef4\u62a4\u3002</li> </ol> <p>\u5b8c</p>"},{"location":"MySQL/MySQL%E7%AE%A1%E7%90%86/","title":"MySQL\u7ba1\u7406","text":""},{"location":"MySQL/MySQL%E7%AE%A1%E7%90%86/#\u7cfb\u7edf\u6570\u636e\u5e93","title":"\u7cfb\u7edf\u6570\u636e\u5e93","text":"<p>MySQL\u81ea\u5e26\u6570\u636e\u5e93\u8bf4\u660e\uff1a</p> \u6570\u636e\u5e93 \u4f5c\u7528 mysql \u5b58\u50a8MySQL\u670d\u52a1\u5668\u6b63\u5e38\u8fd0\u884c\u6240\u9700\u8981\u7684\u5404\u79cd\u4fe1\u606f \uff08\u65f6\u533a\u3001\u4e3b\u4ece\u3001\u7528 \u6237\u3001\u6743\u9650\u7b49\uff09 information_schema \u63d0\u4f9b\u4e86\u8bbf\u95ee\u6570\u636e\u5e93\u5143\u6570\u636e\u7684\u5404\u79cd\u8868\u548c\u89c6\u56fe\uff0c\u5305\u542b\u6570\u636e\u5e93\u3001\u8868\u3001\u5b57\u6bb5\u7c7b \u578b\u53ca\u8bbf\u95ee\u6743\u9650\u7b49 performance_schema \u4e3aMySQL\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u72b6\u6001\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e95\u5c42\u76d1\u63a7\u529f\u80fd\uff0c\u4e3b\u8981\u7528\u4e8e\u6536\u96c6 \u6570\u636e\u5e93\u670d\u52a1\u5668\u6027\u80fd\u53c2\u6570 sys \u5305\u542b\u4e86\u4e00\u7cfb\u5217\u65b9\u4fbf DBA \u548c\u5f00\u53d1\u4eba\u5458\u5229\u7528 performance_schema \u6027\u80fd\u6570\u636e\u5e93\u8fdb\u884c\u6027\u80fd\u8c03\u4f18\u548c\u8bca\u65ad\u7684\u89c6\u56fe"},{"location":"MySQL/MySQL%E7%AE%A1%E7%90%86/#mysql\u547d\u4ee4\u884c\u5ba2\u6237\u7aef","title":"MySQL\u547d\u4ee4\u884c\u5ba2\u6237\u7aef","text":"<ul> <li>mysql</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \n    mysql   [options]   [database]\n\u9009\u9879 \uff1a \n    -u, --user=name         #\u6307\u5b9a\u7528\u6237\u540d\n    -p, --password[=name]           #\u6307\u5b9a\u5bc6\u7801\n    -h, --host=name         #\u6307\u5b9a\u670d\u52a1\u5668IP\u6216\u57df\u540d\n    -P, --port=port             #\u6307\u5b9a\u8fde\u63a5\u7aef\u53e3\n    -e, --execute=name          #\u6267\u884cSQL\u8bed\u53e5\u5e76\u9000\u51fa\n</code></pre> <ul> <li>mysqladmin\uff0c\u7528\u4e8e\u6267\u884c\u5404\u79cd\u7ba1\u7406\u64cd\u4f5c</li> </ul> <pre><code>mysqladmin -u root -p status    # \u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001\nmysqladmin -u root -p variables # \u67e5\u770b\u670d\u52a1\u5668\u53d8\u91cf\nmysqladmin -u root -p shutdown  # \u5173\u95ed\u670d\u52a1\u5668\nmysqladmin -u root -p flush-logs      # \u5237\u65b0\u65e5\u5fd7\nmysqladmin -u root -p flush-privileges # \u5237\u65b0\u6743\u9650\nmysqladmin -u root -p flush-status    # \u91cd\u7f6e\u72b6\u6001\u8ba1\u6570\u5668\n</code></pre> <ul> <li>mysqlbinlog\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u4fdd\u5b58\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u8981\u68c0\u67e5\u8fd9\u4e9b\u6587\u672c\u7684\u6587\u672c\u683c\u5f0f\uff0c\u5c31\u4f1a\u4f7f\u7528\u5230mysqlbinlog \u65e5\u5fd7\u7ba1\u7406\u5de5\u5177</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \n    mysqlbinlog [options]  log-files1 log-files2 ...\n\n\u9009\u9879 \uff1a \n    -d, --database=name         \u6307\u5b9a\u6570\u636e\u5e93\u540d\u79f0\uff0c\u53ea\u5217\u51fa\u6307\u5b9a\u7684\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c\u3002\n    -o, --offset=#              \u5ffd\u7565\u6389\u65e5\u5fd7\u4e2d\u7684\u524dn\u884c\u547d\u4ee4\u3002\n    -r,--result-file=name       \u5c06\u8f93\u51fa\u7684\u6587\u672c\u683c\u5f0f\u65e5\u5fd7\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6\u3002\n    -s, --short-form            \u663e\u793a\u7b80\u5355\u683c\u5f0f\uff0c \u7701\u7565\u6389\u4e00\u4e9b\u4fe1\u606f\u3002\n    --start-datatime=date1  --stop-datetime=date2       \u6307\u5b9a\u65e5\u671f\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7\u3002\n    --start-position=pos1 --stop-position=pos2          \u6307\u5b9a\u4f4d\u7f6e\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7\u3002\n</code></pre> <ul> <li>mysqlshow\uff0c\u5bf9\u8c61\u67e5\u627e\u5de5\u5177\uff0c\u7528\u6765\u5f88\u5feb\u5730\u67e5\u627e\u5b58\u5728\u54ea\u4e9b\u6570\u636e\u5e93\u3001\u6570\u636e\u5e93\u4e2d\u7684\u8868\u3001\u8868\u4e2d\u7684\u5217\u6216\u8005\u7d22 \u5f15\u3002</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \n    mysqlshow [options] [db_name [table_name [col_name]]]\n\u9009\u9879 \uff1a \n    --count     \u663e\u793a\u6570\u636e\u5e93\u53ca\u8868\u7684\u7edf\u8ba1\u4fe1\u606f\uff08\u6570\u636e\u5e93\uff0c\u8868 \u5747\u53ef\u4ee5\u4e0d\u6307\u5b9a\uff09\n    -i      \u663e\u793a\u6307\u5b9a\u6570\u636e\u5e93\u6216\u8005\u6307\u5b9a\u8868\u7684\u72b6\u6001\u4fe1\u606f\n\u793a\u4f8b\uff1a\n    #\u67e5\u8be2test\u5e93\u4e2d\u6bcf\u4e2a\u8868\u4e2d\u7684\u5b57\u6bb5\u4e66\uff0c\u53ca\u884c\u6570\n    mysqlshow -uroot -p2143 test --count\n\n    #\u67e5\u8be2test\u5e93\u4e2dbook\u8868\u7684\u8be6\u7ec6\u60c5\u51b5\n    mysqlshow -uroot -p2143 test book --count\n</code></pre> <ul> <li>mysqldump\uff0c\u7528\u6765\u5907\u4efd\u6570\u636e\u5e93\u6216\u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5907\u4efd\u5185\u5bb9\u5305\u542b\u521b\u5efa\u8868\uff0c\u53ca \u63d2\u5165\u8868\u7684SQL\u8bed\u53e5\u3002</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \n    mysqldump [options] db_name [tables]\n    mysqldump [options] --database/-B db1 [db2 db3...]\n    mysqldump [options] --all-databases/-A\n\u8fde\u63a5\u9009\u9879 \uff1a  \n    -u, --user=name                 \u6307\u5b9a\u7528\u6237\u540d\n    -p, --password[=name]           \u6307\u5b9a\u5bc6\u7801\n    -h, --host=name                 \u6307\u5b9a\u670d\u52a1\u5668ip\u6216\u57df\u540d\n    -P, --port=#                    \u6307\u5b9a\u8fde\u63a5\u7aef\u53e3\n\u8f93\u51fa\u9009\u9879\uff1a\n    --add-drop-database         \u5728\u6bcf\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a drop database \u8bed\u53e5\n    --add-drop-table            \u5728\u6bcf\u4e2a\u8868\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a drop table \u8bed\u53e5 , \u9ed8\u8ba4\u5f00\u542f ; \u4e0d\u5f00\u542f (--skip-add-drop-table)\n    -n, --no-create-db          \u4e0d\u5305\u542b\u6570\u636e\u5e93\u7684\u521b\u5efa\u8bed\u53e5\n    -t, --no-create-info        \u4e0d\u5305\u542b\u6570\u636e\u8868\u7684\u521b\u5efa\u8bed\u53e5\n    -d --no-data                \u4e0d\u5305\u542b\u6570\u636e\n    -T, --tab=name              \u81ea\u52a8\u751f\u6210\u4e24\u4e2a\u6587\u4ef6\uff1a\u4e00\u4e2a.sql\u6587\u4ef6\uff0c\u521b\u5efa\u8868\u7ed3\u6784\u7684\u8bed\u53e5\uff1b\u4e00\u4e2a.txt\u6587\u4ef6\uff0c\u6570\u636e\u6587\u4ef6\n\n-- \u5907\u4efd\u6570\u636e\u5e93\nmysqldump -uroot -p1234 db01 &gt; db01.sql\n</code></pre> <ul> <li>mysqlimport \uff0c\u662f\u5ba2\u6237\u7aef\u6570\u636e\u5bfc\u5165\u5de5\u5177\uff0c\u7528\u6765\u5bfc\u5165mysqldump \u52a0 -T \u53c2\u6570\u540e\u5bfc\u51fa\u7684\u6587\u672c\u6587\u4ef6\u3002</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \n    mysqlimport [options]  db_name  textfile1  [textfile2...]\n\u793a\u4f8b \uff1a \n    mysqlimport -uroot -p2143 test /tmp/city.txt\n</code></pre> <ul> <li>source \uff0c\u5982\u679c\u9700\u8981\u5bfc\u5165sql\u6587\u4ef6,\u53ef\u4ee5\u4f7f\u7528mysql\u4e2d\u7684source \u6307\u4ee4</li> </ul> <pre><code>\u8bed\u6cd5 \uff1a    \nsource /root/xxxxx.sql\n</code></pre>"},{"location":"MySQL/SQL/","title":"SQL","text":""},{"location":"MySQL/SQL/#\u6570\u636e\u67e5\u8be2dql","title":"\u6570\u636e\u67e5\u8be2(DQL)","text":"<pre><code>SELECT\n    \u5b57\u6bb5\u5217\u8868\nFROM\n    \u8868\u540d\u5217\u8868\nWHERE\n    \u6761\u4ef6\u5217\u8868\nGROUP BY\n    \u5206\u7ec4\u5b57\u6bb5\nHAVING\n    \u5206\u7ec4\u540e\u6761\u4ef6\nORDER BY\n    \u6392\u5e8f\u5b57\u6bb5\nLIMIT\n    \u5206\u9875\u9650\u5b9a\n</code></pre>"},{"location":"MySQL/SQL/#\u57fa\u7840\u67e5\u8be2","title":"\u57fa\u7840\u67e5\u8be2","text":"<ol> <li> <p>\u67e5\u8be2\u591a\u4e2a\u5b57\u6bb5</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d;\nSELECT * FROM \u8868\u540d; -- \u67e5\u8be2\u6240\u6709\u6570\u636e\n</code></pre> </li> <li> <p>\u53bb\u9664\u91cd\u590d\u8bb0\u5f55</p> <pre><code>SELECT DISTINCT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d;\n</code></pre> </li> <li> <p>\u7ed9\u5b57\u6bb5\u6216\u8868\u8d77\u522b\u540d</p> <pre><code>AS -- \u4e5f\u53ef\u7701\u7565\n</code></pre> </li> </ol> <p></p>"},{"location":"MySQL/SQL/#\u6761\u4ef6\u67e5\u8be2","title":"\u6761\u4ef6\u67e5\u8be2","text":"<p>\u57fa\u672c\u8bed\u6cd5</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d WHERE \u6761\u4ef6\u5217\u8868;\n</code></pre> <p>\u5e38\u89c1\u903b\u8f91\u6761\u4ef6</p> \u7b26\u53f7 \u8bf4\u660e &gt; \u5927\u4e8e &lt; \u5c0f\u4e8e &gt;= \u5927\u4e8e\u7b49\u4e8e &lt;= \u5c0f\u4e8e\u7b49\u4e8e = \u7b49\u4e8e &lt;&gt;\u6216!= \u4e0d\u7b49\u4e8e BETWEEN...AND... \u5728\u67d0\u4e2a\u8303\u56f4\u5185\uff08\u5305\u542b\u7aef\u70b9\uff09 IN(...) \u591a\u9009\u4e00 LIKE \u5360\u4f4d\u7b26 \u6a21\u7cca\u67e5\u8be2\uff0c'_'\u5339\u914d\u5355\u4e2a\u5b57\u7b26\uff0c'%'\u5339\u914d\u591a\u4e2a\u5b57\u7b26 IS NULL \u662fNULL IS NOT NULL \u4e0d\u662fNULL AND \u6216 &amp;&amp; \u5e76\u4e14 OR \u6216 || \u6216\u8005 NOT \u6216 ! \u975e\uff0c\u4e0d\u662f <p>\u6a21\u7cca\u67e5\u8be2\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2\u59d3\u201c\u9a6c\u201d\u7684\u4eba\nselect * from tb where name like '\u9a6c%';\n\n-- \u67e5\u8be2\u540d\u5b57\u7b2c\u4e8c\u4e2a\u5b57\u662f\u201c\u9a6c\u201d\u7684\u4eba\nselect * from tb where name like '_\u9a6c%';\n\n-- \u67e5\u8be2\u540d\u5b57\u4e2d\u5305\u542b\u201c\u9a6c\u201d\u5b57\u7684\u4eba\nselect * from tb where name like '%\u9a6c%'\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u805a\u5408\u51fd\u6570","title":"\u805a\u5408\u51fd\u6570","text":"<p>\u6982\u5ff5\uff1a\u5c06\u4e00\u5217\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u8fdb\u884c\u7eb5\u5411\u8ba1\u7b97\u3002</p> <p>\u805a\u5408\u51fd\u6570\u5206\u7c7b\uff1a</p> \u51fd\u6570\u540d \u8bf4\u660e count(\u5217\u540d) \u7edf\u8ba1\u6570\u91cf\uff08\u4e00\u822c\u4e0d\u5305\u62ec\u4e3aNULL\u7684\u5217\uff09 max(\u5217\u540d) \u6700\u5927\u503c min(\u5217\u540d) \u6700\u5c0f\u503c sum(\u5217\u540d) \u6c42\u548c avg(\u5217\u540d) \u5e73\u5747\u503c <p>\u805a\u5408\u51fd\u6570\u8bed\u6cd5\uff1a</p> <pre><code>SELECT \u805a\u5408\u51fd\u6570\u540d(\u5217\u540d) FROM \u8868\u540d;\n</code></pre> <p>NULL\u503c\u4e0d\u53c2\u4e0e\u6240\u6709\u805a\u5408\u51fd\u6570\u8fd0\u7b97</p> <p></p>"},{"location":"MySQL/SQL/#\u6392\u5e8f\u67e5\u8be2","title":"\u6392\u5e8f\u67e5\u8be2","text":"<p>\u8bed\u6cd5\uff1a</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d ORDER BY \u6392\u5e8f\u5b57\u6bb5\u4e00[\u6392\u5e8f\u65b9\u5f0f],\u6392\u5e8f\u5b57\u6bb5\u4e8c[\u6392\u5e8f\u65b9\u5f0f],...;\n</code></pre> <p>\u6392\u5e8f\u65b9\u5f0f\uff1a</p> <ul> <li>ASC\uff1a\u5347\u5e8f\u6392\u5e8f\uff08\u9ed8\u8ba4\u503c\uff09</li> <li>DESC\uff1a\u964d\u5e8f\u6392\u5e8f</li> </ul> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u6709\u591a\u4e2a\u6392\u5e8f\u6761\u4ef6\uff0c\u5f53\u7b2c\u4e00\u4e2a\u6392\u5e8f\u5b57\u6bb5\u76f8\u540c\u65f6\uff0c\u624d\u4f1a\u6309\u7b2c\u4e8c\u4e2a\u6392\u5e8f\u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f</p> <p></p>"},{"location":"MySQL/SQL/#\u5206\u7ec4\u67e5\u8be2","title":"\u5206\u7ec4\u67e5\u8be2","text":"<p>\u8bed\u6cd5\uff1a</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d [WHERE \u5206\u7ec4\u524d\u6761\u4ef6] GROUP BY \u5206\u7ec4\u5b57\u6bb5\u540d [HAVING \u5206\u7ec4\u540e\u6761\u4ef6];\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5206\u7ec4\u540e\uff0c\u67e5\u8be2\u7684\u5b57\u6bb5\u53ea\u80fd\u4e3a\u805a\u5408\u51fd\u6570\u548c\u7528\u4e8e\u5206\u7ec4\u7684\u5b57\u6bb5\uff0c\u67e5\u8be2\u5176\u4ed6\u5b57\u6bb5\u65e0\u610f\u4e49\u3002</p> <p>where\u548chaving\u7684\u533a\u522b\uff1a</p> <ul> <li>\u6267\u884c\u65f6\u673a\u4e0d\u4e00\u6837\uff1awhere\u662f\u5206\u7ec4\u4e4b\u524d\u6267\u884c\uff0c\u4e0d\u6ee1\u8db3where\u6761\u4ef6\u5219\u4e0d\u53c2\u4e0e\u5206\u7ec4\uff0c\u800chaving\u662f\u5bf9\u5206\u7ec4\u540e\u7684\u7ed3\u679c\u8fdb\u884c\u8fc7\u6ee4\u3002</li> <li>\u53ef\u5224\u65ad\u7684\u6761\u4ef6\u4e0d\u4e00\u6837\uff1awhere\u4e0d\u80fd\u5bf9\u805a\u5408\u51fd\u6570\u8fdb\u884c\u5224\u65ad\uff0c\u800chaving\u53ef\u4ee5\u3002</li> </ul> <p>\u6267\u884c\u987a\u5e8f\uff1awhere&gt;\u805a\u5408\u51fd\u6570&gt;having</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2\u7537\u751f\u548c\u5973\u751f\u5404\u81ea\u7684\u6570\u5b66\u5e73\u5747\u5206\nselect sex, avg(math) from tb group by sex;\n\n-- \u67e5\u8be2\u7537\u751f\u548c\u5973\u751f\u5404\u81ea\u7684\u6570\u5b66\u5e73\u5747\u5206\uff0c\u4ee5\u53ca\u5404\u81ea\u4eba\u6570\uff08\u5206\u6570\u4f4e\u4e8e70\u7684\u4e0d\u53c2\u4e0e\u5206\u7ec4\uff09\nselect sex, avg(math), count(*) from tb where math &gt;= 70 group by sex;\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u5206\u9875\u67e5\u8be2","title":"\u5206\u9875\u67e5\u8be2","text":"<p>\u8bed\u6cd5</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d LIMIT \u8d77\u59cb\u7d22\u5f15, \u67e5\u8be2\u6761\u76ee;\n</code></pre> <p>Note</p> <p>\u8d77\u59cb\u7d22\u5f15\u4ece0\u5f00\u59cb \u8ba1\u7b97\u65b9\u5f0f\uff1a\u8d77\u59cb\u7d22\u5f15 = (\u5f53\u524d\u9875\u7801 - 1) * \u6bcf\u9875\u663e\u793a\u7684\u6761\u76ee\u6570</p> <p>Info</p> <ul> <li>\u5206\u9875\u67e5\u8be2<code>limit</code>\u662f MySQL \u6570\u636e\u5e93\u7684\u65b9\u8a00</li> <li>Oracle \u6570\u636e\u5e93\u5206\u9875\u67e5\u8be2\u4f7f\u7528<code>rownumber</code></li> <li>SQL Server \u5206\u9875\u67e5\u8be2\u4f7f\u7528<code>top</code></li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2\u7b2c\u4e00\u9875\u6570\u636e\uff0c\u6bcf\u9875\u663e\u793a3\u6761\u6570\u636e\nselect * from tb limit 0, 3;\n\n-- \u67e5\u8be2\u7b2c\u4e8c\u9875\u6570\u636e\uff0c\u6bcf\u9875\u663e\u793a3\u6761\u6570\u636e\nselect * from tb limit 3, 3;\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u591a\u8868\u67e5\u8be2","title":"\u591a\u8868\u67e5\u8be2","text":"<ul> <li>\u7b1b\u5361\u5c14\u79ef\uff1a\u53d6\u96c6\u5408A\uff0cB\u7684\u5143\u7d20\u7684\u6240\u6709\u7ec4\u5408</li> <li>\u591a\u8868\u67e5\u8be2\uff1a\u4ece\u591a\u5f20\u8868\u67e5\u8be2\u6570\u636e<ul> <li>\u8fde\u63a5\u67e5\u8be2<ul> <li>\u5185\u8fde\u63a5\uff1a\u67e5\u8be2A\uff0cB\u4ea4\u96c6\u6570\u636e</li> <li>\u5916\u8fde\u63a5\uff1a<ul> <li>\u5de6\u5916\u8fde\u63a5\uff1a\u67e5\u8be2A\u7684\u6240\u6709\u6570\u636e\u548cA\uff0cB\u4ea4\u96c6\u6570\u636e</li> <li>\u53f3\u5916\u8fde\u63a5\uff1a\u67e5\u8be2B\u7684\u6240\u6709\u6570\u636e\u548cA\uff0cB\u4ea4\u96c6\u6570\u636e</li> </ul> </li> <li>\u81ea\u8fde\u63a5\uff1a\u4e0e\u81ea\u8eab\u8fde\u63a5\u67e5\u8be2\uff0c\u5fc5\u987b\u4f7f\u7528\u522b\u540d</li> </ul> </li> <li>\u5b50\u67e5\u8be2</li> </ul> </li> </ul>"},{"location":"MySQL/SQL/#\u5185\u8fde\u63a5","title":"\u5185\u8fde\u63a5","text":"<p>\u8bed\u6cd5\uff1a</p> <pre><code>-- \u9690\u5f0f\u5185\u8fde\u63a5\nSELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681,\u88682,\u88683,... WHERE \u6761\u4ef6;\n\n-- \u663e\u793a\u5185\u8fde\u63a5\nSELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 [INNER] JOIN \u88682 ON \u6761\u4ef6;\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2emp\u8868\u7684name,gender,dept\u8868\u7684dname\nselect \n    emp.name,emp.gender,dept.dname \nfrom \n    emp,dept \nwhere \n    emp.dep_id = dept.did;\n\n-- \u663e\u793a\u5185\u8fde\u63a5\nselect\n    *\nfrom\n    emp\ninner join\n    dept\non\n    emp.dep_id = dept.did\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u5916\u8fde\u63a5","title":"\u5916\u8fde\u63a5","text":"<p>\u8bed\u6cd5\uff1a</p> <pre><code>-- \u5de6\u5916\u8fde\u63a5\nSELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 LEFT [OUTER] JOIN \u88682 ON \u6761\u4ef6;\n\n-- \u53f3\u5916\u8fde\u63a5\nSELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 RIGHT [OUTER] JOIN \u88682 ON \u6761\u4ef6;\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2emp\u8868\u7684\u6240\u6709\u6570\u636e\u548c\u5bf9\u5e94\u90e8\u95e8\u4fe1\u606f\nselect * from emp left outer join dept on emp.dep_id = dept.did;\n\n-- \u67e5\u8be2dept\u8868\u7684\u6240\u6709\u6570\u636e\u548c\u5bf9\u5e94\u5458\u5de5\u4fe1\u606f\nselect * from emp right outer join dept on emp.dep_id = dept.did;\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u81ea\u8fde\u63a5","title":"\u81ea\u8fde\u63a5","text":"<p>Tip</p> <p>\u628a\u540c\u4e00\u5f20\u8868\u770b\u6210\u4e24\u5f20\u8868\uff0c\u4e0e\u5176\u4ed6\u591a\u8868\u67e5\u8be2\u8bed\u6cd5\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u5fc5\u987b\u4f7f\u7528\u522b\u540d</p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868A \u522b\u540d1 JOIN \u8868A \u522b\u540d2 ON \u6761\u4ef6\uff08\u4f7f\u7528\u522b\u540d\uff09\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u96c6\u5408\u64cd\u4f5c","title":"\u96c6\u5408\u64cd\u4f5c","text":"\u64cd\u4f5c\u7c7b\u578b \u8bed\u6cd5 \u63cf\u8ff0 \u6761\u4ef6\u9650\u5236 \u793a\u4f8b UNION <code>SELECT ... UNION [ALL] SELECT ...</code> \u5408\u5e76\u4e24\u4e2a\u67e5\u8be2\u7ed3\u679c\uff08\u53bb\u91cd\uff09\uff0c<code>UNION ALL</code>\u4fdd\u7559\u91cd\u590d\u884c 1. \u5217\u6570\u5fc5\u987b\u76f8\u540c 2. \u5bf9\u5e94\u5217\u6570\u636e\u7c7b\u578b\u517c\u5bb9 <code>sql&lt;br&gt;SELECT 'A' UNION SELECT 'B';&lt;br&gt;\u2192 A&lt;br&gt;B&lt;br&gt;</code> INTERSECT <code>SELECT ... INTERSECT SELECT ...</code> \u8fd4\u56de\u4e24\u4e2a\u67e5\u8be2\u7684\u4ea4\u96c6\uff08MySQL 8.0+\u652f\u6301\uff09 \u540c<code>UNION</code> <code>sql&lt;br&gt;SELECT id FROM table1&lt;br&gt;INTERSECT&lt;br&gt;SELECT id FROM table2;&lt;br&gt;</code> EXCEPT (MINUS) <code>SELECT ... EXCEPT SELECT ...</code> \u8fd4\u56de\u7b2c\u4e00\u4e2a\u67e5\u8be2\u6709\u4f46\u7b2c\u4e8c\u4e2a\u67e5\u8be2\u6ca1\u6709\u7684\u7ed3\u679c\uff08MySQL 8.0+\u652f\u6301\uff09 \u540c<code>UNION</code> <code>sql&lt;br&gt;SELECT id FROM table1&lt;br&gt;EXCEPT&lt;br&gt;SELECT id FROM table2;&lt;br&gt;</code> IN <code>WHERE col IN (SELECT ...)</code> \u5224\u65ad\u503c\u662f\u5426\u5728\u5b50\u67e5\u8be2\u7ed3\u679c\u96c6\u4e2d \u5b50\u67e5\u8be2\u5fc5\u987b\u8fd4\u56de\u5355\u5217 <code>sql&lt;br&gt;SELECT * FROM users&lt;br&gt;WHERE id IN (1, 3, 5);&lt;br&gt;</code> NOT IN <code>WHERE col NOT IN (SELECT ...)</code> \u5224\u65ad\u503c\u662f\u5426\u4e0d\u5728\u5b50\u67e5\u8be2\u7ed3\u679c\u96c6\u4e2d"},{"location":"MySQL/SQL/#\u5b50\u67e5\u8be2","title":"\u5b50\u67e5\u8be2","text":"<p>\u6982\u5ff5\uff1a\u67e5\u8be2\u4e2d\u5d4c\u5957\u67e5\u8be2</p> <p>\u5b50\u67e5\u8be2\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u4e0d\u540c\uff0c\u4f5c\u7528\u4e0d\u540c\uff1a</p> <ul> <li>\u5355\u884c\u5355\u5217\uff1a\u4f5c\u4e3a\u6761\u4ef6\u503c\uff0c\u4f7f\u7528=\u3001!=\u3001&gt;\u3001 &lt;\u8fdb\u884c\u5224\u65ad</li> </ul> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d WHERE \u5b57\u6bb5\u540d = (\u5b50\u67e5\u8be2);\n</code></pre> <ul> <li>\u591a\u884c\u5355\u5217\uff1a\u4f5c\u4e3a\u6761\u4ef6\u503c\uff0c\u4f7f\u7528 in \u7b49\u5173\u952e\u5b57\u8fdb\u884c\u6761\u4ef6\u5224\u65ad</li> </ul> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d WHERE \u5b57\u6bb5\u540d in (\u5b50\u67e5\u8be2);\n</code></pre> <ul> <li>\u591a\u884c\u591a\u5217\uff1a\u4f5c\u4e3a\u865a\u62df\u8868</li> </ul> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM (\u5b50\u67e5\u8be2) WHERE \u6761\u4ef6;\n</code></pre> \u64cd\u4f5c\u7b26 \u8bed\u6cd5\u793a\u4f8b \u63cf\u8ff0 \u7b49\u4ef7\u5f62\u5f0f\uff08\u4f7f\u7528\u805a\u5408\u51fd\u6570\uff09 \u793a\u4f8b <code>ALL</code> <code>WHERE col &gt; ALL (subquery)</code> \u5fc5\u987b\u6ee1\u8db3 \u6240\u6709 \u5b50\u67e5\u8be2\u7ed3\u679c\u7684\u6761\u4ef6\uff08\u6bd4\u5b50\u67e5\u8be2\u6240\u6709\u503c\u90fd\u5927/\u5c0f\u7b49\uff09 <code>WHERE col &gt; (SELECT MAX(...) FROM ...)</code> <code>sql&lt;br&gt;SELECT * FROM products&lt;br&gt;WHERE price &gt; ALL (SELECT price FROM discounts);&lt;br&gt;</code> <code>ANY</code> / <code>SOME</code> <code>WHERE col &gt; ANY (subquery)</code> \u6ee1\u8db3 \u4efb\u4e00 \u5b50\u67e5\u8be2\u7ed3\u679c\u7684\u6761\u4ef6\uff08\u6bd4\u5b50\u67e5\u8be2\u81f3\u5c11\u4e00\u4e2a\u503c\u5927/\u5c0f\u7b49\uff09 <code>WHERE col &gt; (SELECT MIN(...) FROM ...)</code> <code>sql&lt;br&gt;SELECT * FROM employees&lt;br&gt;WHERE salary &gt; ANY (5000, 8000, 10000);&lt;br&gt;</code> <pre><code>-- salary\u548cdept_id\u90fd\u4e0eid=1\u7684\u76f8\u540c\u6570\u636e\nselect * \nfrom emp \nwhere (salary, dept_id) = (select salary, dept_id from emp where id = 1)\n\n-- \u201c=\u201d \u66ff\u6362\u4e3a \u201cin\u201d \u8868\u793a\u591a\u4e2a\nselect * \nfrom emp \nwhere (salary, dept_id) in (select salary, dept_id from emp where id = 1 or id = 2)\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>-- \u67e5\u8be2\u732a\u516b\u6212\u7684\u5de5\u8d44\nselect salary from emp where name = '\u732a\u516b\u6212';\n\n-- \u67e5\u8be2\u5de5\u8d44\u9ad8\u4e8e\u732a\u516b\u6212\u7684\u5458\u5de5\u4fe1\u606f\nselect * from emp where salary &gt; (select salary from emp where name = '\u732a\u516b\u6212');\n\n\n-- \u67e5\u8be2\u8d22\u52a1\u90e8\u548c\u5e02\u573a\u90e8\u7684\u6240\u6709\u5458\u5de5\u4fe1\u606f\nselect * from emp where dep_id in (select did from dept where dname = '\u8d22\u52a1\u90e8' or dname = '\u5e02\u573a\u90e8');\n\n-- \u67e5\u8be2\u5165\u804c\u65e5\u671f\u662f2011-11-11\u4e4b\u540e\u7684\u5458\u5de5\u4fe1\u606f\u548c\u90e8\u95e8\u4fe1\u606f\nselect * from (select * from emp where join_date &gt; '2011-11-11') as t1 ,dept\nwhere dept.did = t1.dept_id;\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u6570\u636e\u64cd\u4f5cdml","title":"\u6570\u636e\u64cd\u4f5c(DML)","text":"<p>\u63d2\u5165\u6570\u636e</p> <pre><code>INSERT INTO \u8868\u540d(\u5b57\u6bb51,\u5b57\u6bb52,...)\nVALUE(\u503c1,\u503c2,...),(\u503c3,\u503c4,...),...\n</code></pre> <p>\u4fee\u6539\u6570\u636e</p> <pre><code>UPDATE \u8868\u540d SET \u5b57\u6bb51=\u503c1,\u5b57\u6bb52=\u503c2,... [WHERE \u6761\u4ef6];\n</code></pre> <p>Danger</p> <p>\u4e0d\u52a0\u6761\u4ef6\u5219\u4fee\u6539\u6240\u6709\u6570\u636e</p> <p>\u5220\u9664\u6570\u636e</p> <pre><code>DELETE FROM \u8868\u540d [WHERE \u6761\u4ef6];\n</code></pre> <p>Danger</p> <p>\u4e0d\u6dfb\u52a0\u6761\u4ef6\u5219\u5220\u9664\u6240\u6709\u6570\u636e</p> <p></p>"},{"location":"MySQL/SQL/#\u6570\u636e\u7c7b\u578b","title":"\u6570\u636e\u7c7b\u578b","text":"<p>unsigned\u53ef\u4ee5\u6307\u5b9a\u6570\u503c\u7c7b\u578b\u65e0\u7b26\u53f7</p> <p>\u7c7b\u578b\u9009\u62e9\u793a\u4f8b\uff1a</p> <pre><code>create table emp(\n    id int comment '\u7f16\u53f7',\n    no varchar(10) comment '\u5de5\u53f7',\n    name vahchar(10) comment '\u59d3\u540d',\n    gender char(1) comment '\u6027\u522b',\n    age tinyint unsigned comment '\u5e74\u9f84',\n    idcard char(18) comment '\u8eab\u4efd\u8bc1\u53f7',\n    entrydate date comment '\u5165\u804c\u65f6\u95f4'\n) comment '\u5458\u5de5\u8868';\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u6570\u636e\u5b9a\u4e49ddl","title":"\u6570\u636e\u5b9a\u4e49(DDL)","text":""},{"location":"MySQL/SQL/#\u8868\u7684\u76f8\u5173\u64cd\u4f5c","title":"\u8868\u7684\u76f8\u5173\u64cd\u4f5c","text":"<p>\u521b\u5efa\u8868</p> <pre><code>CREATE TABLE tb_user(\n    id INT,\n    username VARCHAR(20),\n    password VARCHAR(20)\n);\n</code></pre> <p>\u5220\u9664\u8868</p> <pre><code>drop table tb_user;\n</code></pre> <p>\u67e5\u8be2\u6240\u6709\u8868</p> <pre><code>show tables;\n</code></pre> <p>\u4fee\u6539\u8868</p> <ol> <li> <p>\u4fee\u6539\u8868\u540d</p> <pre><code>ALTER TABLE \u8868\u540d RENAME TO \u65b0\u8868\u540d;\n</code></pre> </li> <li> <p>\u6dfb\u52a0\u4e00\u5217</p> <pre><code>ALTER TABLE \u8868\u540d ADD \u5217\u540d \u6570\u636e\u7c7b\u578b;\n</code></pre> </li> <li> <p>\u4fee\u6539\u6570\u636e\u7c7b\u578b</p> <pre><code>ALTER TABLE \u8868\u540d MODIFY \u5217\u540d \u65b0\u6570\u636e\u7c7b\u578b;\n</code></pre> </li> <li> <p>\u4fee\u6539\u5217\u540d\u548c\u6570\u636e\u7c7b\u578b</p> <pre><code>ALTER TABLE \u8868\u540d CHANGE \u5217\u540d \u65b0\u5217\u540d \u65b0\u6570\u636e\u7c7b\u578b;\n</code></pre> </li> <li> <p>\u5220\u9664\u5217</p> <pre><code>ALTER TABLE \u8868\u540d DROP \u5217\u540d;\n</code></pre> </li> </ol> <p></p>"},{"location":"MySQL/SQL/#\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c","title":"\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c","text":"<p>\u521b\u5efa\u6570\u636e\u5e93</p> <pre><code>CREATE DATABASE \u6570\u636e\u5e93\u540d;\n</code></pre> <p>\u5220\u9664\u6570\u636e\u5e93</p> <pre><code>DROP DATABASE \u6570\u636e\u5e93\u540d;\n</code></pre> <p>\u67e5\u8be2\u6570\u636e\u5e93</p> <pre><code>show databases;\n</code></pre> <p>\u4f7f\u7528\u6570\u636e\u5e93</p> <pre><code>use \u6570\u636e\u5e93\u540d;\n</code></pre> <p></p>"},{"location":"MySQL/SQL/#\u6570\u636e\u63a7\u5236\u8bed\u8a00dcl","title":"\u6570\u636e\u63a7\u5236\u8bed\u8a00(DCL)","text":"<p>\u6ce8\u610f</p> <p>\u4ec5\u9488\u5bf9MySQL\u8bed\u6cd5</p>"},{"location":"MySQL/SQL/#\u7528\u6237\u7ba1\u7406","title":"\u7528\u6237\u7ba1\u7406","text":"<pre><code>## \u67e5\u8be2\u7528\u6237\nUSE mysql;\nSELECT * FROM user;\n\n## \u65b0\u589e\u7528\u6237\nCREATE USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' IDENTIFIED BY '\u5bc6\u7801'\n\n## \u4fee\u6539\u7528\u6237\u5bc6\u7801\nALTER USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' IDENTIFIED WITH mysql_native_password BY '\u65b0\u5bc6\u7801'\n\n## \u5220\u9664\u7528\u6237\nDROP USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d'\n</code></pre> <p>Tip</p> <p>\u4e3b\u673a\u540d\u6307\u5b9a\u4e3a<code>'%'</code>\u8868\u793a\u4efb\u610f\u4e3b\u673a</p> <p></p>"},{"location":"MySQL/SQL/#\u6743\u9650\u63a7\u5236","title":"\u6743\u9650\u63a7\u5236","text":"\u6743\u9650 \u8bf4\u660e ALL,ALL PRIVILEGES \u6240\u6709\u6743\u9650 SELECT \u67e5\u8be2\u6570\u636e INSERT \u63d2\u5165\u6570\u636e UPDATE \u4fee\u6539\u6570\u636e DELETE \u5220\u9664\u6570\u636e ALTER \u4fee\u6539\u8868 DROP \u5220\u9664\u6570\u636e\u5e93/\u8868/\u89c6\u56fe CREATE \u521b\u5efa\u6570\u636e\u5e93/\u8868 <pre><code>## \u67e5\u8be2\u6743\u9650\nSHOW GRANTS FOR '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d'\n\n## \u6388\u4e88\u6743\u9650\nGRANT \u6743\u9650\u5217\u8868 ON \u6570\u636e\u5e93\u540d.\u8868\u540d TO '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d'\n\n## \u64a4\u9500\u6743\u9650\nREVOKE \u6743\u9650\u5217\u8868 ON \u6570\u636e\u5e93\u540d.\u8868\u540d FROM '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d'\n</code></pre> <p>Tip</p> <ul> <li>\u591a\u4e2a\u6743\u9650\u4e4b\u95f4\u7528\u82f1\u6587\u9017\u53f7\u5206\u5272</li> <li>\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u53ef\u7528 * \u901a\u914d</li> </ul> <p></p>"},{"location":"MySQL/SQL/#\u51fd\u6570","title":"\u51fd\u6570","text":""},{"location":"MySQL/SQL/#\u5b57\u7b26\u4e32\u51fd\u6570","title":"\u5b57\u7b26\u4e32\u51fd\u6570","text":"\u51fd\u6570\u540d \u8bed\u6cd5\u793a\u4f8b \u63cf\u8ff0 \u793a\u4f8b\u7ed3\u679c <code>CONCAT()</code> <code>CONCAT(str1, str2)</code> \u5408\u5e76\u591a\u4e2a\u5b57\u7b26\u4e32 <code>CONCAT('My', 'SQL') \u2192 'MySQL'</code> <code>CONCAT_WS()</code> <code>CONCAT_WS(sep, str1, str2)</code> \u7528\u6307\u5b9a\u5206\u9694\u7b26\u5408\u5e76\u5b57\u7b26\u4e32 <code>CONCAT_WS('-', '2023', '01') \u2192 '2023-01'</code> <code>SUBSTRING()</code> / <code>SUBSTR()</code> <code>SUBSTRING(str, start, length)</code> \u622a\u53d6\u5b57\u7b26\u4e32\uff08\u4ece1\u5f00\u59cb\u8ba1\u6570\uff09 <code>SUBSTRING('MySQL', 3, 2) \u2192 'SQ'</code> <code>LEFT()</code> <code>LEFT(str, length)</code> \u4ece\u5de6\u4fa7\u622a\u53d6\u6307\u5b9a\u957f\u5ea6\u5b57\u7b26\u4e32 <code>LEFT('MySQL', 2) \u2192 'My'</code> <code>RIGHT()</code> <code>RIGHT(str, length)</code> \u4ece\u53f3\u4fa7\u622a\u53d6\u6307\u5b9a\u957f\u5ea6\u5b57\u7b26\u4e32 <code>RIGHT('MySQL', 3) \u2192 'SQL'</code> <code>LENGTH()</code> / <code>CHAR_LENGTH()</code> <code>LENGTH(str)</code> \u8fd4\u56de\u5b57\u8282\u957f\u5ea6\uff08<code>LENGTH</code>\uff09\u6216\u5b57\u7b26\u957f\u5ea6\uff08<code>CHAR_LENGTH</code>\uff09 <code>LENGTH('\u4e2d\u56fd') \u2192 6</code> (utf8) <code>TRIM()</code> <code>TRIM([\u65b9\u5411] [remstr] FROM str)</code> \u53bb\u9664\u4e24\u7aef\u7a7a\u683c/\u6307\u5b9a\u5b57\u7b26\uff08<code>LTRIM</code>/<code>RTRIM</code>\u4ec5\u5904\u7406\u5de6/\u53f3\uff09 <code>TRIM(' MySQL ') \u2192 'MySQL'</code> <code>REPLACE()</code> <code>REPLACE(str, from_str, to_str)</code> \u66ff\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u5185\u5bb9 <code>REPLACE('MxxSQL', 'xx', 'y') \u2192 'MySQL'</code> <code>UPPER()</code> / <code>LOWER()</code> <code>UPPER(str)</code> \u8f6c\u6362\u4e3a\u5927\u5199/\u5c0f\u5199 <code>UPPER('mysql') \u2192 'MYSQL'</code> <code>LOCATE()</code> <code>LOCATE(substr, str)</code> \u8fd4\u56de\u5b50\u4e32\u9996\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u4ece1\u5f00\u59cb\uff09 <code>LOCATE('SQL', 'MySQL') \u2192 3</code> <code>INSTR()</code> <code>INSTR(str, substr)</code> \u7c7b\u4f3c<code>LOCATE</code>\u4f46\u53c2\u6570\u987a\u5e8f\u76f8\u53cd <code>INSTR('MySQL', 'SQL') \u2192 3</code> <code>LPAD()</code> / <code>RPAD()</code> <code>LPAD(str, len, padstr)</code> \u7528\u6307\u5b9a\u5b57\u7b26\u5de6/\u53f3\u586b\u5145\u5230\u6307\u5b9a\u957f\u5ea6 <code>LPAD('5', 3, '0') \u2192 '005'</code> <code>REPEAT()</code> <code>REPEAT(str, count)</code> \u91cd\u590d\u5b57\u7b26\u4e32\u6307\u5b9a\u6b21\u6570 <code>REPEAT('X', 3) \u2192 'XXX'</code> <code>REVERSE()</code> <code>REVERSE(str)</code> \u53cd\u8f6c\u5b57\u7b26\u4e32 <code>REVERSE('ABC') \u2192 'CBA'</code> <code>FORMAT()</code> <code>FORMAT(num, decimal_places)</code> \u6570\u5b57\u683c\u5f0f\u5316\uff08\u5343\u4f4d\u5206\u9694\u7b26+\u5c0f\u6570\u4f4d\uff09 <code>FORMAT(1234.567, 2) \u2192 '1,234.57'</code> <code>GROUP_CONCAT()</code> <code>GROUP_CONCAT(col SEPARATOR sep)</code> \u5206\u7ec4\u540e\u5408\u5e76\u591a\u884c\u5b57\u7b26\u4e32\uff08\u9700\u914d\u5408<code>GROUP BY</code>\uff09 \u5408\u5e76\u591a\u884c\u503c\u7528\u9017\u53f7\u5206\u9694"},{"location":"MySQL/SQL/#\u6570\u503c\u51fd\u6570","title":"\u6570\u503c\u51fd\u6570","text":"\u51fd\u6570\u540d \u8bed\u6cd5\u793a\u4f8b \u63cf\u8ff0 \u793a\u4f8b\u7ed3\u679c \u57fa\u7840\u8ba1\u7b97 <code>ABS()</code> <code>ABS(num)</code> \u8fd4\u56de\u7edd\u5bf9\u503c <code>ABS(-5) \u2192 5</code> <code>MOD()</code> <code>MOD(dividend, divisor)</code> \u53d6\u6a21\u8fd0\u7b97\uff08\u7b49\u4ef7\u4e8e<code>%</code>\u8fd0\u7b97\u7b26\uff09 <code>MOD(10, 3) \u2192 1</code> <code>POWER()</code> / <code>POW()</code> <code>POWER(base, exponent)</code> \u5e42\u8fd0\u7b97 <code>POWER(2, 3) \u2192 8</code> <code>SQRT()</code> <code>SQRT(num)</code> \u5e73\u65b9\u6839 <code>SQRT(9) \u2192 3</code> \u820d\u5165\u5904\u7406 <code>ROUND()</code> <code>ROUND(num [, decimals])</code> \u56db\u820d\u4e94\u5165\uff08\u53ef\u6307\u5b9a\u5c0f\u6570\u4f4d\uff09 <code>ROUND(3.1415, 2) \u2192 3.14</code> <code>CEIL()</code> / <code>CEILING()</code> <code>CEIL(num)</code> \u5411\u4e0a\u53d6\u6574 <code>CEIL(3.2) \u2192 4</code> <code>FLOOR()</code> <code>FLOOR(num)</code> \u5411\u4e0b\u53d6\u6574 <code>FLOOR(3.9) \u2192 3</code> <code>TRUNCATE()</code> <code>TRUNCATE(num, decimals)</code> \u76f4\u63a5\u622a\u65ad\u5c0f\u6570\u4f4d\uff08\u975e\u56db\u820d\u4e94\u5165\uff09 <code>TRUNCATE(3.1415, 2) \u2192 3.14</code> \u7b26\u53f7\u4e0e\u968f\u673a <code>SIGN()</code> <code>SIGN(num)</code> \u8fd4\u56de\u7b26\u53f7\uff08-1/0/1\uff09 <code>SIGN(-10) \u2192 -1</code> <code>RAND()</code> <code>RAND([seed])</code> \u751f\u62100~1\u4e4b\u95f4\u7684\u968f\u673a\u6570\uff08\u53ef\u6307\u5b9a\u79cd\u5b50\uff09 <code>RAND() \u2192 0.1234...</code> \u5bf9\u6570\u4e0e\u4e09\u89d2\u51fd\u6570 <code>LOG()</code> / <code>LOG10()</code> <code>LOG(base, num)</code> \u5bf9\u6570\u8fd0\u7b97\uff08<code>LOG10</code>\u4e3a\u4ee510\u4e3a\u5e95\uff09 <code>LOG(2, 8) \u2192 3</code> <code>SIN()</code> / <code>COS()</code> <code>SIN(radians)</code> \u4e09\u89d2\u51fd\u6570\uff08\u53c2\u6570\u4e3a\u5f27\u5ea6\u503c\uff09 <code>SIN(PI()/2) \u2192 1</code> \u5e38\u91cf\u4e0e\u8f6c\u6362 <code>PI()</code> <code>PI()</code> \u8fd4\u56de\u5706\u5468\u7387\u03c0\u7684\u503c <code>PI() \u2192 3.141593</code> <code>RADIANS()</code> <code>RADIANS(degrees)</code> \u89d2\u5ea6\u8f6c\u5f27\u5ea6 <code>RADIANS(180) \u2192 3.141593</code> <code>DEGREES()</code> <code>DEGREES(radians)</code> \u5f27\u5ea6\u8f6c\u89d2\u5ea6 <code>DEGREES(PI()) \u2192 180</code> <code>BIN()</code> / <code>HEX()</code> <code>BIN(num)</code> \u5341\u8fdb\u5236\u8f6c\u4e8c\u8fdb\u5236/\u5341\u516d\u8fdb\u5236\uff08\u8fd4\u56de\u5b57\u7b26\u4e32\uff09 <code>BIN(10) \u2192 '1010'</code>"},{"location":"MySQL/SQL/#\u65e5\u671f\u51fd\u6570","title":"\u65e5\u671f\u51fd\u6570","text":"\u51fd\u6570\u540d \u8bed\u6cd5\u793a\u4f8b \u63cf\u8ff0 \u793a\u4f8b\u7ed3\u679c \u5f53\u524d\u65f6\u95f4 <code>NOW()</code> <code>NOW()</code> \u8fd4\u56de\u5f53\u524d\u65e5\u671f\u548c\u65f6\u95f4\uff08\u683c\u5f0f\uff1a<code>YYYY-MM-DD HH:MM:SS</code>\uff09 <code>2024-07-25 14:30:00</code> <code>CURDATE()</code> <code>CURDATE()</code> \u8fd4\u56de\u5f53\u524d\u65e5\u671f\uff08\u683c\u5f0f\uff1a<code>YYYY-MM-DD</code>\uff09 <code>2024-07-25</code> <code>CURTIME()</code> <code>CURTIME()</code> \u8fd4\u56de\u5f53\u524d\u65f6\u95f4\uff08\u683c\u5f0f\uff1a<code>HH:MM:SS</code>\uff09 <code>14:30:00</code> \u65e5\u671f\u63d0\u53d6 <code>YEAR()</code> <code>YEAR(date)</code> \u63d0\u53d6\u5e74\u4efd\uff084\u4f4d\u6570\uff09 <code>YEAR('2024-07-25') \u2192 2024</code> <code>MONTH()</code> <code>MONTH(date)</code> \u63d0\u53d6\u6708\u4efd\uff081-12\uff09 <code>MONTH('2024-07-25') \u2192 7</code> <code>DAY()</code> / <code>DAYOFMONTH()</code> <code>DAY(date)</code> \u63d0\u53d6\u65e5\u671f\u4e2d\u7684\u5929\u6570\uff081-31\uff09 <code>DAY('2024-07-25') \u2192 25</code> <code>HOUR()</code> <code>HOUR(time)</code> \u63d0\u53d6\u5c0f\u65f6\uff080-23\uff09 <code>HOUR('14:30:00') \u2192 14</code> <code>MINUTE()</code> <code>MINUTE(time)</code> \u63d0\u53d6\u5206\u949f\uff080-59\uff09 <code>MINUTE('14:30:00') \u2192 30</code> <code>SECOND()</code> <code>SECOND(time)</code> \u63d0\u53d6\u79d2\u6570\uff080-59\uff09 <code>SECOND('14:30:15') \u2192 15</code> <code>DAYOFWEEK()</code> <code>DAYOFWEEK(date)</code> \u8fd4\u56de\u661f\u671f\u51e0\uff081=\u5468\u65e5\uff0c2=\u5468\u4e00\uff0c...7=\u5468\u516d\uff09 <code>DAYOFWEEK('2024-07-25') \u2192 5</code>\uff08\u5468\u56db\uff09 \u65e5\u671f\u8ba1\u7b97 <code>DATE_ADD()</code> <code>DATE_ADD(date, INTERVAL expr unit)</code> \u65e5\u671f\u52a0\u6cd5\uff08\u5355\u4f4d\uff1aDAY, MONTH, YEAR\u7b49\uff09 <code>DATE_ADD('2024-07-25', INTERVAL 1 MONTH) \u2192 2024-08-25</code> <code>DATE_SUB()</code> <code>DATE_SUB(date, INTERVAL expr unit)</code> \u65e5\u671f\u51cf\u6cd5 <code>DATE_SUB('2024-07-25', INTERVAL 7 DAY) \u2192 2024-07-18</code> <code>DATEDIFF()</code> <code>DATEDIFF(date1, date2)</code> \u8ba1\u7b97\u4e24\u4e2a\u65e5\u671f\u76f8\u5dee\u7684\u5929\u6570\uff08date1 - date2\uff09 <code>DATEDIFF('2024-07-25', '2024-07-20') \u2192 5</code> <code>TIMESTAMPDIFF()</code> <code>TIMESTAMPDIFF(unit, start, end)</code> \u8ba1\u7b97\u65f6\u95f4\u5dee\uff08\u5355\u4f4d\uff1aDAY, MONTH, YEAR\u7b49\uff09 <code>TIMESTAMPDIFF(MONTH, '2024-01-01', '2024-07-25') \u2192 6</code> \u65e5\u671f\u683c\u5f0f\u5316 <code>DATE_FORMAT()</code> <code>DATE_FORMAT(date, format)</code> \u683c\u5f0f\u5316\u65e5\u671f\uff08\u5e38\u7528\u5360\u4f4d\u7b26\uff1a<code>%Y</code>-\u5e74\uff0c<code>%m</code>-\u6708\uff0c<code>%d</code>-\u65e5\uff0c<code>%H</code>-\u5c0f\u65f6\uff0c<code>%i</code>-\u5206\u949f\uff09 <code>DATE_FORMAT(NOW(), '%Y/%m/%d') \u2192 '2024/07/25'</code> <code>STR_TO_DATE()</code> <code>STR_TO_DATE(str, format)</code> \u5b57\u7b26\u4e32\u8f6c\u65e5\u671f\uff08\u9700\u5339\u914d\u683c\u5f0f\uff09 <code>STR_TO_DATE('25,07,2024', '%d,%m,%Y') \u2192 2024-07-25</code> \u5176\u4ed6\u5b9e\u7528\u51fd\u6570 <code>LAST_DAY()</code> <code>LAST_DAY(date)</code> \u8fd4\u56de\u6708\u4efd\u7684\u6700\u540e\u4e00\u5929 <code>LAST_DAY('2024-02-15') \u2192 2024-02-29</code>\uff08\u95f0\u5e74\uff09 <code>TIMESTAMP()</code> <code>TIMESTAMP(date, time)</code> \u5408\u5e76\u65e5\u671f\u548c\u65f6\u95f4 <code>TIMESTAMP('2024-07-25', '14:30:00') \u2192 2024-07-25 14:30:00</code>"},{"location":"MySQL/SQL/#\u6d41\u7a0b\u51fd\u6570","title":"\u6d41\u7a0b\u51fd\u6570","text":"\u51fd\u6570\u540d \u8bed\u6cd5\u793a\u4f8b \u63cf\u8ff0 \u793a\u4f8b\u7ed3\u679c \u6761\u4ef6\u5224\u65ad <code>IF()</code> <code>IF(expr, true_val, false_val)</code> \u5982\u679c\u8868\u8fbe\u5f0f\u4e3a\u771f\u8fd4\u56de<code>true_val</code>\uff0c\u5426\u5219\u8fd4\u56de<code>false_val</code> <code>IF(1&gt;0, 'Yes', 'No') \u2192 'Yes'</code> <code>IFNULL()</code> <code>IFNULL(expr, fallback)</code> \u5982\u679c<code>expr</code>\u4e3aNULL\u5219\u8fd4\u56de<code>fallback</code>\uff0c\u5426\u5219\u8fd4\u56de<code>expr</code> <code>IFNULL(NULL, 'Unknown') \u2192 'Unknown'</code> <code>NULLIF()</code> <code>NULLIF(expr1, expr2)</code> \u5982\u679c<code>expr1 = expr2</code>\u8fd4\u56deNULL\uff0c\u5426\u5219\u8fd4\u56de<code>expr1</code> <code>NULLIF(3, 3) \u2192 NULL</code> \u591a\u5206\u652f\u9009\u62e9 <code>CASE WHEN</code> <code>sql              |   \u591a\u6761\u4ef6\u5206\u652f\u9009\u62e9\uff08\u7c7b\u4f3c\u7f16\u7a0b\u8bed\u8a00\u7684`switch-case`\uff09   |</code>sql CASE CASE WHEN condition1 THEN result1 WHEN score &gt;= 90 THEN 'A' WHEN condition2 THEN result2 WHEN score &gt;= 60 THEN 'B' ELSE default_result ELSE 'C' END END \u2192 'B' (score=75) <code>|                                                   |</code> \u590d\u6742\u903b\u8f91\u5904\u7406 <code>COALESCE()</code> <code>COALESCE(expr1, expr2, ...)</code> \u8fd4\u56de\u7b2c\u4e00\u4e2a\u975eNULL\u7684\u53c2\u6570\uff08\u5e38\u7528\u4e8eNULL\u503c\u515c\u5e95\uff09 <code>COALESCE(NULL, NULL, 'A') \u2192 'A'</code> <code>GREATEST()</code> <code>GREATEST(val1, val2, ...)</code> \u8fd4\u56de\u53c2\u6570\u5217\u8868\u4e2d\u7684\u6700\u5927\u503c <code>GREATEST(3, 5, 1) \u2192 5</code> <code>LEAST()</code> <code>LEAST(val1, val2, ...)</code> \u8fd4\u56de\u53c2\u6570\u5217\u8868\u4e2d\u7684\u6700\u5c0f\u503c <code>LEAST(3, 5, 1) \u2192 1</code>"},{"location":"MySQL/SQL/#\u6570\u636e\u5e93\u8bbe\u8ba1","title":"\u6570\u636e\u5e93\u8bbe\u8ba1","text":"<p>\u8f6f\u4ef6\u7814\u53d1\u6b65\u9aa4</p> <p></p> <p>\u6570\u636e\u5e93\u8bbe\u8ba1\u6982\u5ff5</p> <ul> <li>\u6570\u636e\u5e93\u8bbe\u8ba1\u5c31\u662f\u6839\u636e\u4e1a\u52a1\u7cfb\u7edf\u7684\u5177\u4f53\u9700\u6c42\uff0c\u7ed3\u5408\u9009\u62e9\u7684DBMS\uff0c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u6784\u9020\u51fa\u6700\u4f18\u7684\u6570\u636e\u5b58\u50a8\u6a21\u578b\u3002</li> <li>\u5efa\u7acb\u6570\u636e\u5e93\u4e2d\u7684\u8868\u7ed3\u6784\u4ee5\u53ca\u8868\u4e0e\u8868\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\u7684\u8fc7\u7a0b\u3002</li> </ul> <p>\u6570\u636e\u5e93\u8bbe\u8ba1\u7684\u6b65\u9aa4</p> <ol> <li>\u9700\u6c42\u5206\u6790\uff08\u6709\u4ec0\u4e48\u6570\u636e\uff1f\u6570\u636e\u7684\u5c5e\u6027\uff1f\u6570\u636e\u548c\u5c5e\u6027\u7684\u7279\u70b9\uff1f\uff09</li> <li>\u903b\u8f91\u5206\u6790\uff08E-R\u56fe\u8fdb\u884c\u903b\u8f91\u5efa\u6a21\uff09</li> <li>\u7269\u7406\u8bbe\u8ba1\uff08\u6839\u636e\u6240\u9009\u7684DBMS\u628a\u903b\u8f91\u6a21\u578b\u8f6c\u6362\u4e3a\u7269\u7406\u6a21\u578b\uff09</li> <li>\u7ef4\u62a4\u8bbe\u8ba1\uff08\u65b0\u9700\u6c42\uff0c\u4f18\u5316\u8868\u7ed3\u6784\uff09</li> </ol> <p></p>"},{"location":"MySQL/SQL/#\u7ea6\u675f","title":"\u7ea6\u675f","text":"<p>\u7ea6\u675f\u7684\u6982\u5ff5</p> <ul> <li>\u7ea6\u675f\u662f\u4f5c\u7528\u4e8e\u8868\u4e2d\u5217\u4e0a\u7684\u89c4\u5219\uff0c\u7528\u4e8e\u9650\u5236\u52a0\u5165\u8868\u4e2d\u7684\u6570\u636e</li> <li>\u7ea6\u675f\u7684\u5b58\u5728\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u4e2d\u6570\u636e\u7684\u6b63\u786e\u6027\u3001\u6709\u6548\u6027\u548c\u5b8c\u6574\u6027</li> </ul> <p>\u7ea6\u675f\u7684\u5206\u7c7b\uff1a</p> \u7ea6\u675f\u540d \u8bf4\u660e \u5173\u952e\u5b57 \u975e\u7a7a\u7ea6\u675f \u4fdd\u8bc1\u5217\u4e2d\u6570\u636e\u4e0d\u80fd\u4e3aNULL NOT NULL \u552f\u4e00\u7ea6\u675f \u4fdd\u8bc1\u5217\u4e2d\u6240\u6709\u6570\u636e\u4e2a\u4e0d\u76f8\u540c UNIQUE \u4e3b\u952e\u7ea6\u675f \u4e3b\u952e\u662f\u4e00\u884c\u6570\u636e\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8981\u6c42\u975e\u7a7a\u4e14\u552f\u4e00 PRIMARY KEY \u68c0\u67e5\u7ea6\u675f \u4fdd\u8bc1\u5217\u4e2d\u7684\u6570\u636e\u6ee1\u8db3\u67d0\u4e00\u6761\u4ef6 CHECK \u9ed8\u8ba4\u7ea6\u675f \u63d2\u5165\u6570\u636e\u65f6\uff0c\u672a\u6307\u5b9a\u503c\u5219\u4f7f\u7528\u9ed8\u8ba4\u6570\u636e DEFAULT \u5916\u952e\u7ea6\u675f \u8ba9\u4e24\u5f20\u8868\u5efa\u7acb\u5173\u7cfb\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027 FOREIGN KEY <p>Warning</p> <p>MySQL8.0.16\u4e4b\u524d\u7684\u7248\u672c\u4e0d\u652f\u6301\u68c0\u67e5\u7ea6\u675f</p> <p>\u793a\u4f8b</p> <pre><code>CREATE TABLE emp(\n    id INT PRIMARY KEY, -- id\u4f5c\u4e3b\u952e\uff0c\u552f\u4e00\u6807\u8bc6\n    ename VARCHAR(50) NOT NULL UNIQUE,  -- \u59d3\u540d\u4e0d\u4e3a\u7a7a\u4e14\u552f\u4e00\n    join_date DATE NOT NULL,    -- \u5165\u804c\u65e5\u671f\u4e0d\u4e3a\u7a7a\n    salary DOUBLE(7,2) NOT NULL,    -- \u5de5\u8d44\u975e\u7a7a\n    bonus DOUBLES(7,2) DEFAULT 0    -- \u5956\u91d1\u9ed8\u8ba4\u4e3a0\n)\n</code></pre> <p>\u5916\u952e\u7ea6\u675f</p> <p>\u6dfb\u52a0\u7ea6\u675f</p> <pre><code>-- \u521b\u5efa\u8868\u65f6\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\nCREATE TABLE \u8868\u540d(\n    \u5217\u540d \u6570\u636e\u7c7b\u578b,\n    ...\n    [CONSTRAINT] [\u5916\u952e\u540d] FOREIGN KEY(\u5217\u540d) REFERENCES \u4e3b\u8868(\u4e3b\u8868\u5217\u540d)\n);\n\n\n-- \u521b\u5efa\u8868\u540e\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\nALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u5217\u540d) REFERENCES \u4e3b\u8868(\u4e3b\u8868\u5217\u540d);\n</code></pre> <p>\u5220\u9664\u7ea6\u675f</p> <pre><code>ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d;\n</code></pre> <p>\u5916\u952e\u7ea6\u675f\u7684\u5220\u9664/\u66f4\u65b0\u884c\u4e3a</p> \u884c\u4e3a\u7c7b\u578b \u8bed\u6cd5\u793a\u4f8b \u89e6\u53d1\u65f6\u673a \u5bf9\u4e3b\u8868\uff08\u7236\u8868\uff09\u64cd\u4f5c\u7684\u5f71\u54cd \u5bf9\u4ece\u8868\uff08\u5b50\u8868\uff09\u7684\u5f71\u54cd <code>RESTRICT</code> (\u9ed8\u8ba4) <code>ON DELETE RESTRICT</code> \u5c1d\u8bd5\u5220\u9664/\u66f4\u65b0\u4e3b\u8868\u8bb0\u5f55\u65f6 \u62d2\u7edd\u64cd\u4f5c\uff08\u62a5\u9519\uff09 \u5b50\u8868\u82e5\u5b58\u5728\u5173\u8054\u8bb0\u5f55\uff0c\u963b\u6b62\u4e3b\u8868\u64cd\u4f5c <code>CASCADE</code> <code>ON UPDATE CASCADE</code> \u4e3b\u8868\u8bb0\u5f55\u88ab\u66f4\u65b0/\u5220\u9664\u65f6 \u6267\u884c\u64cd\u4f5c \u7ea7\u8054\u64cd\u4f5c\uff1a \u2022 \u4e3b\u8868\u5220\u9664\u2192\u5b50\u8868\u5173\u8054\u8bb0\u5f55\u81ea\u52a8\u5220\u9664 \u2022 \u4e3b\u8868\u66f4\u65b0\u2192\u5b50\u8868\u5916\u952e\u503c\u540c\u6b65\u66f4\u65b0 <code>SET NULL</code> <code>ON DELETE SET NULL</code> \u4e3b\u8868\u8bb0\u5f55\u88ab\u5220\u9664\u65f6 \u6267\u884c\u64cd\u4f5c \u5b50\u8868\u5916\u952e\u5b57\u6bb5\u81ea\u52a8\u8bbe\u4e3aNULL\uff08\u9700\u5141\u8bb8NULL\uff09 <code>NO ACTION</code> <code>ON UPDATE NO ACTION</code> \u4e8b\u52a1\u63d0\u4ea4\u65f6\u68c0\u67e5 \u7c7b\u4f3c<code>RESTRICT</code>\uff08\u4f46\u5ef6\u8fdf\u68c0\u67e5\uff09 \u82e5\u5b50\u8868\u6709\u5173\u8054\u8bb0\u5f55\uff0c\u4e8b\u52a1\u63d0\u4ea4\u65f6\u62a5\u9519 <code>SET DEFAULT</code> <code>ON DELETE SET DEFAULT</code> \u4e3b\u8868\u8bb0\u5f55\u88ab\u5220\u9664\u65f6 \u6267\u884c\u64cd\u4f5c <p></p>"},{"location":"MySQL/SQL/#\u8868\u4e4b\u95f4\u7684\u5173\u7cfb","title":"\u8868\u4e4b\u95f4\u7684\u5173\u7cfb","text":"<ul> <li>\u4e00\u5bf9\u4e00<ul> <li>\u4f8b\uff1a\u7528\u6237\u548c\u7528\u6237\u8be6\u60c5</li> <li>\u4e00\u5bf9\u4e00\u5173\u7cfb\u591a\u7528\u4e8e\u8868\u62c6\u5206\uff0c\u5c06\u4e00\u4e2a\u5b9e\u4f53\u4e2d\u7ecf\u5e38\u4f7f\u7528\u7684\u5b57\u6bb5\u653e\u5728\u4e00\u5f20\u8868\uff0c\u4e0d\u5e38\u4f7f\u7528\u7684\u653e\u53e6\u4e00\u5f20\u8868\uff0c\u53ef\u63d0\u5347\u67e5\u8be2\u6027\u80fd</li> </ul> </li> <li>\u4e00\u5bf9\u591a<ul> <li>\u4f8b\uff1a\u90e8\u95e8\u548c\u5458\u5de5</li> <li>\u4e00\u4e2a\u90e8\u95e8\u5bf9\u5e94\u591a\u4e2a\u5458\u5de5\uff0c\u4e00\u4e2a\u5458\u5de5\u5bf9\u5e94\u4e00\u4e2a\u90e8\u95e8</li> </ul> </li> <li>\u591a\u5bf9\u591a<ul> <li>\u4f8b\uff1a\u5546\u54c1\u548c\u8ba2\u5355</li> <li>\u4e00\u4e2a\u5546\u54c1\u5bf9\u5e94\u591a\u4e2a\u8ba2\u5355\uff0c\u4e00\u4e2a\u8ba2\u5355\u5bf9\u5e94\u591a\u4e2a\u5546\u54c1</li> </ul> </li> </ul> <p>Note</p> <p>\u5b9e\u73b0\u4e00\u5bf9\u4e00\u5173\u7cfb\u53ea\u9700\u8981\u5728\u53e6\u4e00\u5f20\u8868\u4e2d\u5efa\u7acb\u5916\u952e\u7ea6\u675f\u5173\u8054\u4e3b\u8868\u7684\u4e3b\u952e\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5916\u952e\u552f\u4e00(<code>UNIQUE</code>)\u7ea6\u675f</p> <p>\u4e00\u5bf9\u591a\u57fa\u672c\u540c\u4e00\u5bf9\u4e00\uff0c\u5728\u591a\u7684\u4e00\u65b9\u5efa\u7acb\u5916\u952e\uff0c\u53ea\u662f\u5916\u952e\u4e0d\u9700\u8981\u552f\u4e00\u7ea6\u675f</p> <p>\u5b9e\u73b0\u591a\u5bf9\u591a\u5173\u7cfb\u9700\u8981\u5efa\u7acb\u4e00\u5f20\u4e2d\u95f4\u8868\uff0c\u4e14\u5e94\u5305\u542b\u4e24\u4e2a\u5916\u952e\uff0c\u5206\u522b\u5173\u8054\u4e24\u5f20\u591a\u5bf9\u591a\u5173\u7cfb\u8868\u7684\u4e3b\u952e</p> <p></p>"},{"location":"MySQL/SQL/#\u4e8b\u52a1","title":"\u4e8b\u52a1","text":"<p>\u4e8b\u52a1\u662f\u4e00\u7ec4\u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u5b83\u662f\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u4e8b\u52a1\u4f1a\u628a\u6240\u6709\u64cd\u4f5c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u5411\u7cfb\u7edf\u63d0\u4ea4\u6216\u64a4\u9500\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u540c\u65f6\u6210\u529f\uff0c\u8981\u4e48\u540c\u65f6\u5931\u8d25</p> <p>Warning</p> <p>MySQL\u4e8b\u52a1\u9ed8\u8ba4\u4f1a\u81ea\u52a8\u63d0\u4ea4\uff0c\u9664\u975e\u624b\u52a8\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1</p> <p>\u53ef\u901a\u8fc7 <code>set @@autocommit = 0</code> \u8bbe\u7f6e\u4e3a\u624b\u52a8\u63d0\u4ea4</p> <pre><code>-- \u5f00\u542f\u4e8b\u52a1\nbegin \u6216\u8005 start transaction\n\n-- \u63d0\u4ea4\u4e8b\u52a1\ncommit\n\n-- \u56de\u6eda\u4e8b\u52a1\nrollback\n</code></pre> <p>\u4e8b\u52a1\u56db\u5927\u7279\u6027\uff08ACID\uff09</p> \u7279\u6027 \u63cf\u8ff0 \u91cd\u8981\u6027 Atomicity (\u539f\u5b50\u6027) \u4e8b\u52a1\u662f\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u56de\u6eda \u786e\u4fdd\u4e8b\u52a1\u7684\u5b8c\u6574\u6027 Consistency (\u4e00\u81f4\u6027) \u4e8b\u52a1\u6267\u884c\u524d\u540e\uff0c\u6570\u636e\u5e93\u4ece\u4e00\u4e2a\u4e00\u81f4\u72b6\u6001\u8f6c\u53d8\u4e3a\u53e6\u4e00\u4e2a\u4e00\u81f4\u72b6\u6001 \u4fdd\u8bc1\u6570\u636e\u6709\u6548\u6027 Isolation (\u9694\u79bb\u6027) \u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\uff0c\u4e00\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u4e0d\u5e94\u5f71\u54cd\u5176\u4ed6\u4e8b\u52a1 \u63a7\u5236\u5e76\u53d1\u8bbf\u95ee Durability (\u6301\u4e45\u6027) \u4e8b\u52a1\u4e00\u65e6\u63d0\u4ea4\uff0c\u5176\u7ed3\u679c\u5c31\u662f\u6c38\u4e45\u6027\u7684 \u786e\u4fdd\u6570\u636e\u5b89\u5168 <p>\u5e76\u53d1\u4e8b\u52a1\u95ee\u9898</p> \u95ee\u9898\u7c7b\u578b \u63cf\u8ff0 \u793a\u4f8b\u573a\u666f MySQL\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662f\u5426\u89e3\u51b3 \u810f\u8bfb(Dirty Read) \u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e \u4e8b\u52a1A\u8bfb\u53d6\u4e86\u4e8b\u52a1B\u4fee\u6539\u4f46\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u4e8b\u52a1B\u540e\u6765\u56de\u6eda REPEATABLE READ\u5df2\u89e3\u51b3 \u4e0d\u53ef\u91cd\u590d\u8bfb(Non-repeatable Read) \u540c\u4e00\u4e8b\u52a1\u5185\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6570\u636e\u7ed3\u679c\u4e0d\u540c \u4e8b\u52a1A\u8bfb\u53d6\u67d0\u6570\u636e\u540e\uff0c\u4e8b\u52a1B\u4fee\u6539\u5e76\u63d0\u4ea4\u4e86\u8be5\u6570\u636e\uff0c\u4e8b\u52a1A\u518d\u6b21\u8bfb\u53d6\u53d1\u73b0\u503c\u53d8\u5316 REPEATABLE READ\u5df2\u89e3\u51b3 \u5e7b\u8bfb(Phantom Read) \u540c\u4e00\u4e8b\u52a1\u5185\u591a\u6b21\u67e5\u8be2\u8fd4\u56de\u4e0d\u540c\u884c\u6570 \u4e8b\u52a1A\u67e5\u8be2\u7b26\u5408\u67d0\u6761\u4ef6\u7684\u8bb0\u5f55\u540e\uff0c\u4e8b\u52a1B\u63d2\u5165\u65b0\u8bb0\u5f55\u5e76\u63d0\u4ea4\uff0c\u4e8b\u52a1A\u518d\u6b21\u67e5\u8be2\u53d1\u73b0\"\u5e7b\u5f71\u884c\" SERIALIZABLE\u5b8c\u5168\u89e3\u51b3\uff0cREPEATABLE READ\u901a\u8fc7\u95f4\u9699\u9501\u90e8\u5206\u89e3\u51b3 <p>\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b</p> \u9694\u79bb\u7ea7\u522b \u810f\u8bfb \u4e0d\u53ef\u91cd\u590d\u8bfb \u5e7b\u8bfb \u5b9e\u73b0\u673a\u5236 \u6027\u80fd\u5f71\u54cd READ UNCOMMITTED (\u8bfb\u672a\u63d0\u4ea4) \u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u4e0d\u52a0\u9501 \u6700\u9ad8 READ COMMITTED (\u8bfb\u5df2\u63d0\u4ea4) \u4e0d\u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u884c\u7ea7\u9501(\u8bb0\u5f55\u9501) \u9ad8 REPEATABLE READ (\u53ef\u91cd\u590d\u8bfb) \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u53ef\u80fd(\u90e8\u5206\u89e3\u51b3) \u8bb0\u5f55\u9501+\u95f4\u9699\u9501 \u4e2d SERIALIZABLE (\u53ef\u4e32\u884c\u5316) \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u8868\u7ea7\u9501 \u6700\u4f4e <p>Tip</p> <p>MySQL\u9ed8\u8ba4 \u53ef\u91cd\u590d\u8bfb</p> <p><code>select @@transaction_isolation</code> \u67e5\u770b\u9694\u79bb\u7ea7\u522b</p> <p><code>set [session|global] transaction isolation level \u9694\u79bb\u7ea7\u522b</code>\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b</p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/","title":"SQL\u4f18\u5316","text":""},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#insert\u4f18\u5316","title":"insert\u4f18\u5316","text":"<ul> <li>\u63d2\u5165\u591a\u6761\u6570\u636e\u65f6\uff0c\u4f7f\u7528\u6279\u91cf\u63d2\u5165</li> </ul> <pre><code> Insert  into  tb_test  values(1,'Tom'),(2,'Cat'),(3,'Jerry');\n</code></pre> <ul> <li>\u624b\u52a8\u63d0\u4ea4\u4e8b\u52a1</li> </ul> <pre><code>begin[start transaction];\n...\ncommit;\n</code></pre> <ul> <li>\u4e3b\u952e\u987a\u5e8f\u63d2\u5165\u6027\u80fd\u9ad8\u4e8e\u4e71\u5e8f\u63d2\u5165</li> </ul> <pre><code>\u4e3b\u952e\u4e71\u5e8f\u63d2\u5165 : 8  1  9  21  88  2  4  15  89  5  7  3  \n\u4e3b\u952e\u987a\u5e8f\u63d2\u5165 : 1  2  3  4  5  7  8  9  15  21  88  89\n</code></pre> <ul> <li>\u5927\u6279\u91cf\u6570\u636e\u63d2\u5165</li> </ul> <p>\u5982\u679c\u4e00\u6b21\u6027\u9700\u8981\u63d2\u5165\u5927\u6279\u91cf\u6570\u636e(\u6bd4\u5982: \u51e0\u767e\u4e07\u7684\u8bb0\u5f55)\uff0c\u4f7f\u7528insert\u8bed\u53e5\u63d2\u5165\u6027\u80fd\u8f83\u4f4e\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528MySQL\u6570\u636e\u5e93\u63d0\u4f9b\u7684load\u6307\u4ee4\u8fdb\u884c\u63d2\u5165\u3002</p> <pre><code>-- \u5ba2\u6237\u7aef\u8fde\u63a5\u670d\u52a1\u7aef\u65f6\uff0c\u52a0\u4e0a\u53c2\u6570  -\u2013local-infile\nmysql \u2013-local-infile  -u  root  -p\n\n-- \u8bbe\u7f6e\u5168\u5c40\u53c2\u6570local_infile\u4e3a1\uff0c\u5f00\u542f\u4ece\u672c\u5730\u52a0\u8f7d\u6587\u4ef6\u5bfc\u5165\u6570\u636e\u7684\u5f00\u5173\nset  global  local_infile = 1;\n\n-- \u6267\u884cload\u6307\u4ee4\u5c06\u51c6\u5907\u597d\u7684\u6570\u636e\uff0c\u52a0\u8f7d\u5230\u8868\u7ed3\u6784\u4e2d\nload  data  local  infile  '/root/sql1.log'  into  table  tb_user  fields terminated  by  ','  lines  terminated  by  '\\n' ; \n</code></pre> <p>Info</p> <p>\u6587\u4ef6\u7684\u5185\u5bb9\u5e76\u4e0d\u662fSQL\u8bed\u53e5\uff0c\u800c\u662f\u7b26\u5408\u8868\u7ed3\u6784\u7684\u6570\u636e\uff0c\u7c7b\u4f3cCSV\u6587\u4ef6\uff0c\u5177\u4f53\u53ef\u4f7f\u7528\u641c\u7d22\u5f15\u64ce\u67e5\u8be2</p> <p></p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#\u4e3b\u952e\u4f18\u5316","title":"\u4e3b\u952e\u4f18\u5316","text":"<ul> <li>\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u91cf\u964d\u4f4e\u4e3b\u952e\u7684\u957f\u5ea6\u3002 </li> <li>\u63d2\u5165\u6570\u636e\u65f6\uff0c\u5c3d\u91cf\u9009\u62e9\u987a\u5e8f\u63d2\u5165\uff0c\u9009\u62e9\u4f7f\u7528AUTO_INCREMENT\u81ea\u589e\u4e3b\u952e\u3002 </li> <li>\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528UUID\u505a\u4e3b\u952e\u6216\u8005\u662f\u5176\u4ed6\u81ea\u7136\u4e3b\u952e\uff0c\u5982\u8eab\u4efd\u8bc1\u53f7\u3002 </li> <li>\u4e1a\u52a1\u64cd\u4f5c\u65f6\uff0c\u907f\u514d\u5bf9\u4e3b\u952e\u7684\u4fee\u6539\u3002</li> </ul>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#order-by\u4f18\u5316","title":"order by\u4f18\u5316","text":"<p>MySQL\u7684\u6392\u5e8f\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a </p> <ul> <li>Using filesort : \u901a\u8fc7\u8868\u7684\u7d22\u5f15\u6216\u5168\u8868\u626b\u63cf\uff0c\u8bfb\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u636e\u884c\uff0c\u7136\u540e\u5728\u6392\u5e8f\u7f13\u51b2\u533asort buffer\u4e2d\u5b8c\u6210\u6392\u5e8f\u64cd\u4f5c\uff0c\u6240\u6709\u4e0d\u662f\u901a\u8fc7\u7d22\u5f15\u76f4\u63a5\u8fd4\u56de\u6392\u5e8f\u7ed3\u679c\u7684\u6392\u5e8f\u90fd\u53eb FileSort \u6392\u5e8f\u3002 </li> <li>Using index : \u901a\u8fc7\u6709\u5e8f\u7d22\u5f15\u987a\u5e8f\u626b\u63cf\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e\uff0c\u8fd9\u79cd\u60c5\u51b5\u5373\u4e3a using index\uff0c\u4e0d\u9700\u8981\u989d\u5916\u6392\u5e8f\uff0c\u64cd\u4f5c\u6548\u7387\u9ad8\u3002</li> </ul> <p>\u4f18\u5316\u539f\u5219</p> <ol> <li>\u6839\u636e\u6392\u5e8f\u5b57\u6bb5\u5efa\u7acb\u5408\u9002\u7684\u7d22\u5f15\uff0c\u591a\u5b57\u6bb5\u6392\u5e8f\u65f6\uff0c\u4e5f\u9075\u5faa\u6700\u5de6\u524d\u7f00\u6cd5\u5219\u3002 </li> <li>\u5c3d\u91cf\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u3002 </li> <li>\u591a\u5b57\u6bb5\u6392\u5e8f, \u4e00\u4e2a\u5347\u5e8f\u4e00\u4e2a\u964d\u5e8f\uff0c\u6b64\u65f6\u9700\u8981\u6ce8\u610f\u8054\u5408\u7d22\u5f15\u5728\u521b\u5efa\u65f6\u7684\u89c4\u5219\uff08ASC/DESC\uff09\u3002 </li> <li>\u5982\u679c\u4e0d\u53ef\u907f\u514d\u7684\u51fa\u73b0filesort\uff0c\u5927\u6570\u636e\u91cf\u6392\u5e8f\u65f6\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u5927\u6392\u5e8f\u7f13\u51b2\u533a\u5927\u5c0f  sort_buffer_size(\u9ed8\u8ba4256k)\u3002</li> </ol> <p></p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#group-by\u4f18\u5316","title":"group by\u4f18\u5316","text":"<p>\u5728\u5206\u7ec4\u64cd\u4f5c\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u4e24\u70b9\u8fdb\u884c\u4f18\u5316\uff0c\u4ee5\u63d0\u5347\u6027\u80fd\uff1a </p> <ol> <li>\u5206\u7ec4\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u7d22\u5f15\u6765\u63d0\u9ad8\u6548\u7387\u3002 </li> <li>\u5206\u7ec4\u64cd\u4f5c\u65f6\uff0c\u7d22\u5f15\u7684\u4f7f\u7528\u4e5f\u6ee1\u8db3\u6700\u5de6\u524d\u7f00\u6cd5\u5219\u3002</li> </ol> <p></p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#limit\u4f18\u5316","title":"limit\u4f18\u5316","text":"<p>\u5728\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u65f6\uff0c\u5982\u679c\u8fdb\u884climit\u5206\u9875\u67e5\u8be2\uff0c\u5728\u67e5\u8be2\u65f6\uff0c\u9875\u6570\u8d8a\u5f80\u540e\uff0c\u5206\u9875\u67e5\u8be2\u6548\u7387\u8d8a\u4f4e\u3002</p> <p>Example</p> <p>\u5f53\u5728\u8fdb\u884c\u5206\u9875\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u6267\u884c limit 2000000,10 \uff0c\u6b64\u65f6\u9700\u8981MySQL\u6392\u5e8f\u524d2000009 \u8bb0 \u5f55\uff0c\u4ec5\u4ec5\u8fd4\u56de 2000000 - 2000009 \u7684\u8bb0\u5f55\uff0c\u5176\u4ed6\u8bb0\u5f55\u4e22\u5f03\uff0c\u67e5\u8be2\u6392\u5e8f\u7684\u4ee3\u4ef7\u975e\u5e38\u5927 \u3002</p> <p>\u4f18\u5316\u601d\u8def: \u4e00\u822c\u5206\u9875\u67e5\u8be2\u65f6\uff0c\u901a\u8fc7\u521b\u5efa \u8986\u76d6\u7d22\u5f15 \u80fd\u591f\u6bd4\u8f83\u597d\u5730\u63d0\u9ad8\u6027\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6\u7d22\u5f15\u52a0\u5b50\u67e5\u8be2\u5f62\u5f0f\u8fdb\u884c\u4f18\u5316\u3002</p> <pre><code>explain   select  t.*  from  tb_sku  t  ,  (select  id  from  tb_sku  order  by  id \nlimit  2000000,10)  a  where t.id  =  a.id;\n</code></pre> <p></p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#count\u4f18\u5316","title":"count\u4f18\u5316","text":"<ul> <li>MyISAM \u5f15\u64ce\u628a\u4e00\u4e2a\u8868\u7684\u603b\u884c\u6570\u5b58\u5728\u4e86\u78c1\u76d8\u4e0a\uff0c\u56e0\u6b64\u6267\u884c count(*) \u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u8fd4\u56de\u8fd9\u4e2a\u6570\uff0c\u6548\u7387\u5f88\u9ad8\uff1b \u4f46\u662f\u5982\u679c\u662f\u5e26\u6761\u4ef6\u7684count\uff0cMyISAM\u4e5f\u6162\u3002</li> <li>InnoDB \u5f15\u64ce\u5c31\u9ebb\u70e6\u4e86\uff0c\u5b83\u6267\u884c count(*) \u7684\u65f6\u5019\uff0c\u9700\u8981\u628a\u6570\u636e\u4e00\u884c\u4e00\u884c\u5730\u4ece\u5f15\u64ce\u91cc\u9762\u8bfb\u51fa\u6765\uff0c\u7136\u540e\u7d2f\u79ef\u8ba1\u6570\u3002</li> </ul> <p>\u5982\u679c\u8bf4\u8981\u5927\u5e45\u5ea6\u63d0\u5347InnoDB\u8868\u7684count\u6548\u7387\uff0c\u4e3b\u8981\u7684\u4f18\u5316\u601d\u8def\uff1a\u81ea\u5df1\u8ba1\u6570(\u53ef\u4ee5\u501f\u52a9\u4e8eredis\u8fd9\u6837\u7684\u6570\u636e\u5e93\u8fdb\u884c,\u4f46\u662f\u5982\u679c\u662f\u5e26\u6761\u4ef6\u7684count\u53c8\u6bd4\u8f83\u9ebb\u70e6\u4e86)\u3002</p> <p>count\u7684\u51e0\u79cd\u7528\u6cd5</p> \u7528\u6cd5 \u8bed\u6cd5\u793a\u4f8b \u6267\u884c\u673a\u5236 \u6548\u7387 \u9002\u7528\u573a\u666f \u6ce8\u610f\u4e8b\u9879 COUNT(*) <code>SELECT COUNT(*) FROM table</code> \u76f4\u63a5\u7edf\u8ba1\u884c\u6570\uff0c\u4e0d\u89e3\u6790\u5177\u4f53\u5217 \u2605\u2605\u2605\u2605\u2605 \u6700\u5feb \u7edf\u8ba1\u8868\u603b\u884c\u6570 \u4f18\u5148\u4f7f\u7528\uff0cInnoDB\u505a\u4e86\u7279\u6b8a\u4f18\u5316 COUNT(\u4e3b\u952e) <code>SELECT COUNT(id) FROM table</code> \u904d\u5386\u4e3b\u952e\u7d22\u5f15\u7edf\u8ba1\u975eNULL\u503c \u2605\u2605\u2605\u2605 \u8f83\u5feb \u9700\u8981\u663e\u5f0f\u6307\u5b9a\u4e3b\u952e\u7edf\u8ba1 \u6bd4COUNT(*)\u7a0d\u6162\uff0c\u56e0\u9700\u8bfb\u53d6\u7d22\u5f15 COUNT(\u5b57\u6bb5) <code>SELECT COUNT(name) FROM users</code> \u904d\u5386\u6307\u5b9a\u5b57\u6bb5\u7edf\u8ba1\u975eNULL\u503c \u2605\u2605 \u8f83\u6162 \u7edf\u8ba1\u67d0\u5217\u975eNULL\u503c\u6570\u91cf \u907f\u514d\u5728\u53ef\u4e3aNULL\u7684\u5217\u4f7f\u7528\uff0c\u4e0d\u8d70\u7d22\u5f15\u65f6\u6548\u7387\u6700\u4f4e COUNT(\u6570\u5b57) <code>SELECT COUNT(1) FROM table</code> \u751f\u6210\u6570\u5b57\u5e38\u91cf\u5217\u7edf\u8ba1\u884c\u6570 \u2605\u2605\u2605\u2605 \u5feb \u4e0eCOUNT(*)\u529f\u80fd\u76f8\u540c MySQL 8.0+\u4f18\u5316\u540e\u4e0eCOUNT(*)\u6027\u80fd\u76f8\u5f53 <p></p>"},{"location":"MySQL/SQL%E4%BC%98%E5%8C%96/#update\u4f18\u5316","title":"update\u4f18\u5316","text":"<p>\u66f4\u65b0\u6761\u4ef6\u5c3d\u91cf\u4f7f\u7528\u7d22\u5f15\u5b57\u6bb5\u4e14\u8be5\u7d22\u5f15\u4e0d\u80fd\u5931\u6548\uff0c\u5426\u5219MySQL\u4f1a\u5bf9\u6574\u4e2a\u8868\u52a0\u9501\uff0c\u5f71\u54cd\u6027\u80fd</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/","title":"\u5b58\u50a8\u5f15\u64ce","text":""},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#innodb\u5f15\u64ce","title":"InnoDB\u5f15\u64ce","text":""},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u903b\u8f91\u5b58\u50a8\u7ed3\u6784","title":"\u903b\u8f91\u5b58\u50a8\u7ed3\u6784","text":"<ul> <li>\u8868\u7a7a\u95f4\uff1a\u8868\u7a7a\u95f4\u662fInnoDB\u5b58\u50a8\u5f15\u64ce\u903b\u8f91\u7ed3\u6784\u7684\u6700\u9ad8\u5c42\uff0c\u4e00\u4e2amysql\u5b9e\u4f8b\u53ef\u4ee5\u5bf9\u5e94\u591a\u4e2a\u8868\u7a7a\u95f4\uff0c\u7528\u4e8e\u5b58\u50a8\u8bb0\u5f55\u3001\u7d22\u5f15\u7b49\u6570\u636e\u3002</li> <li>\u6bb5\uff1a\u5206\u4e3a\u6570\u636e\u6bb5\u3001\u7d22\u5f15\u6bb5\u3001\u56de\u6eda\u6bb5\uff0cInnoDB\u662f\u7d22\u5f15\u7ec4\u7ec7\u8868\uff0c\u6570\u636e\u6bb5\u5c31\u662fB+\u6811\u7684\u53f6\u5b50\u8282\u70b9\uff0c \u7d22\u5f15\u6bb5\u5373\u4e3aB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u3002\u6bb5\u7528\u6765\u7ba1\u7406\u591a\u4e2aExtent\uff08\u533a\uff09\u3002</li> <li>\u533a\uff1a\u8868\u7a7a\u95f4\u7684\u5355\u5143\u7ed3\u6784\uff0c\u6bcf\u4e2a\u533a\u7684\u5927\u5c0f\u4e3a1M\u3002</li> <li>\u9875\uff1a\u662fInnoDB \u5b58\u50a8\u5f15\u64ce\u78c1\u76d8\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u6bcf\u4e2a\u9875\u7684\u5927\u5c0f\u9ed8\u8ba4\u4e3a 16KB\u3002\u4e3a\u4e86\u4fdd\u8bc1\u9875\u7684\u8fde\u7eed\u6027\uff0c InnoDB \u5b58\u50a8\u5f15\u64ce\u6bcf\u6b21\u4ece\u78c1\u76d8\u7533\u8bf7 4-5 \u4e2a\u533a</li> <li>\u884c\uff1aInnoDB \u5b58\u50a8\u5f15\u64ce\u6570\u636e\u662f\u6309\u884c\u8fdb\u884c\u5b58\u653e\u7684</li> </ul>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u67b6\u6784","title":"\u67b6\u6784","text":"<p>MySQL5.5 \u7248\u672c\u5f00\u59cb\uff0c\u9ed8\u8ba4\u4f7f\u7528InnoDB\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u64c5\u957f\u4e8b\u52a1\u5904\u7406\uff0c\u5177\u6709\u5d29\u6e83\u6062\u590d\u7279\u6027\uff0c\u5728\u65e5\u5e38\u5f00\u53d1 \u4e2d\u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\u3002</p> <p></p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u5185\u5b58\u7ed3\u6784","title":"\u5185\u5b58\u7ed3\u6784","text":"<ol> <li>Buffer Pool\uff0c\u662f\u4e3b\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u533a\u57df\uff0c\u91cc\u9762\u53ef\u4ee5\u7f13\u5b58\u78c1\u76d8\u4e0a\u7ecf\u5e38\u64cd\u4f5c\u7684\u771f\u5b9e\u6570\u636e\uff0c\u5728\u6267\u884c\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u65f6\uff0c\u5148\u64cd\u4f5c\u7f13\u51b2\u6c60\u4e2d\u7684\u6570\u636e\uff08\u82e5\u7f13\u51b2\u6c60\u6ca1\u6709\u6570\u636e\uff0c\u5219\u4ece\u78c1\u76d8\u52a0\u8f7d\u5e76\u7f13\u5b58\uff09\uff0c\u7136\u540e\u518d\u4ee5\u4e00\u5b9a\u9891\u7387\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8IO\uff0c\u52a0\u5feb\u5904\u7406\u901f\u5ea6\u3002</li> <li> <p>Change Buffer\uff0c\u66f4\u6539\u7f13\u51b2\u533a\uff08\u9488\u5bf9\u4e8e\u975e\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u9875\uff09\uff0c\u5728\u6267\u884cDML\u8bed\u53e5\u65f6\uff0c\u5982\u679c\u8fd9\u4e9b\u6570\u636ePage \u4e0d\u5728Buffer Pool\u4e2d\uff0c\u4e0d\u4f1a\u76f4\u63a5\u64cd\u4f5c\u78c1\u76d8\uff0c\u800c\u662f\u5c06\u6570\u636e\u53d8\u66f4\u5b58\u5728\u66f4\u6539\u7f13\u51b2\u533a Change Buffer \u4e2d\uff0c\u5728\u672a\u6765\u6570\u636e\u88ab\u8bfb\u53d6\u65f6\uff0c\u518d\u5c06\u6570\u636e\u5408\u5e76\u6062\u590d\u5230Buffer Pool\u4e2d\uff0c\u518d\u5c06\u5408\u5e76\u540e\u7684\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002</p> <p>Info</p> <p>\u4e0e\u805a\u96c6\u7d22\u5f15\u4e0d\u540c\uff0c\u4e8c\u7ea7\u7d22\u5f15\u901a\u5e38\u662f\u975e\u552f\u4e00\u7684\uff0c\u5e76\u4e14\u4ee5\u76f8\u5bf9\u968f\u673a\u7684\u987a\u5e8f\u63d2\u5165\u4e8c\u7ea7\u7d22\u5f15\u3002\u540c\u6837\uff0c\u5220\u9664\u548c\u66f4\u65b0\u53ef\u80fd\u4f1a\u5f71\u54cd\u7d22\u5f15\u6811\u4e2d\u4e0d\u76f8\u90bb\u7684\u4e8c\u7ea7\u7d22\u5f15\u9875\uff0c\u5982\u679c\u6bcf\u4e00\u6b21\u90fd\u64cd\u4f5c\u78c1\u76d8\uff0c\u4f1a\u9020\u6210\u5927\u91cf\u7684\u78c1\u76d8IO\u3002\u6709\u4e86 Change Buffer\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7f13\u51b2\u6c60\u4e2d\u8fdb\u884c\u5408\u5e76\u5904\u7406\uff0c\u51cf\u5c11\u78c1\u76d8IO\u3002</p> </li> <li> <p>Adaptive Hash Index \u81ea\u9002\u5e94hash\u7d22\u5f15\uff0c\u7528\u4e8e\u4f18\u5316\u5bf9Buffer Pool\u6570\u636e\u7684\u67e5\u8be2\u3002MySQL\u7684innoDB\u5f15\u64ce\u4e2d\u867d\u7136\u6ca1\u6709\u76f4\u63a5\u652f\u6301 hash \u7d22\u5f15\uff0c\u4f46\u662f\u63d0\u4f9b\u4e86\u81ea\u9002\u5e94hash\u7d22\u5f15\u3002\u4f46\u662fhash\u7d22\u5f15\u4e0d\u9002\u5408\u505a\u8303\u56f4\u67e5\u8be2\u3001\u6a21\u7cca\u5339\u914d\u7b49\u3002 InnoDB\u5b58\u50a8\u5f15\u64ce\u4f1a\u76d1\u63a7\u5bf9\u8868\u4e0a\u5404\u7d22\u5f15\u9875\u7684\u67e5\u8be2\uff0c\u5982\u679c\u89c2\u5bdf\u5230\u5728\u7279\u5b9a\u7684\u6761\u4ef6\u4e0bhash\u7d22\u5f15\u53ef\u4ee5\u63d0\u5347\u901f\u5ea6\uff0c \u5219\u5efa\u7acbhash\u7d22\u5f15\uff0c\u79f0\u4e4b\u4e3a\u81ea\u9002\u5e94hash\u7d22\u5f15\u3002 \u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\uff0c\u65e0\u9700\u4eba\u5de5\u5e72\u9884\uff0c\u662f\u7cfb\u7edf\u6839\u636e\u60c5\u51b5\u81ea\u52a8\u5b8c\u6210\u3002</p> </li> <li>Log Buffer\uff1a\u65e5\u5fd7\u7f13\u51b2\u533a\uff0c\u7528\u6765\u4fdd\u5b58\u8981\u5199\u5165\u5230\u78c1\u76d8\u4e2d\u7684log\u65e5\u5fd7\u6570\u636e\uff08redo log \u3001undo log\uff09\uff0c \u9ed8\u8ba4\u5927\u5c0f\u4e3a 16MB\uff0c\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u65e5\u5fd7\u4f1a\u5b9a\u671f\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002\u5982\u679c\u9700\u8981\u66f4\u65b0\u3001\u63d2\u5165\u6216\u5220\u9664\u8bb8\u591a\u884c\u7684\u4e8b\u52a1\uff0c\u589e\u52a0\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u53ef\u4ee5\u8282\u7701\u78c1\u76d8 I/O\u3002</li> </ol> <p>Info</p> <p>Log Buffer \u76f8\u5173\u7cfb\u7edf\u53d8\u91cf\uff1a</p> <p><code>innodb_log_buffer_size</code>\uff1a\u7f13\u51b2\u533a\u5927\u5c0f</p> <p><code>innodb_flush_log_at_trx_commit</code>\uff1a\u65e5\u5fd7\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u673a\uff0c\u53d6\u503c\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u4e09\u4e2a\uff1a</p> <ul> <li>1 ---&gt; \u65e5\u5fd7\u5728\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u5199\u5165\u5e76\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u9ed8\u8ba4\u503c\u3002</li> <li>0 ---&gt; \u6bcf\u79d2\u5c06\u65e5\u5fd7\u5199\u5165\u5e76\u5237\u65b0\u5230\u78c1\u76d8\u4e00\u6b21\u3002 </li> <li>2 ---&gt; \u65e5\u5fd7\u5728\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u540e\u5199\u5165\uff0c\u5e76\u6bcf\u79d2\u5237\u65b0\u5230\u78c1\u76d8\u4e00\u6b21\u3002</li> </ul>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u78c1\u76d8\u7ed3\u6784","title":"\u78c1\u76d8\u7ed3\u6784","text":"<ol> <li>System Tablespace\uff0c\u7cfb\u7edf\u8868\u7a7a\u95f4\u662f\u66f4\u6539\u7f13\u51b2\u533a\u7684\u5b58\u50a8\u533a\u57df\u3002\u5982\u679c\u8868\u662f\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u800c\u4e0d\u662f\u6bcf\u4e2a\u8868\u6587\u4ef6\u6216\u901a\u7528\u8868\u7a7a\u95f4\u4e2d\u521b\u5efa\u7684\uff0c\u5b83\u4e5f\u53ef\u80fd\u5305\u542b\u8868\u548c\u7d22\u5f15\u6570\u636e\u3002</li> <li>File-Per-Table Tablespaces\uff0c\u5982\u679c\u5f00\u542f\u4e86<code>innodb_file_per_table</code>\u5f00\u5173 \uff0c\u5219\u6bcf\u4e2a\u8868\u7684\u6587\u4ef6\u8868\u7a7a\u95f4\u5305\u542b\u5355\u4e2aInnoDB\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15 \uff0c\u5e76\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u5355\u4e2a\u6570\u636e\u6587\u4ef6\u4e2d\u3002</li> <li> <p>General Tablespaces\uff0c\u901a\u7528\u8868\u7a7a\u95f4\uff0c\u9700\u8981\u901a\u8fc7 CREATE TABLESPACE \u8bed\u6cd5\u521b\u5efa\u901a\u7528\u8868\u7a7a\u95f4\uff0c\u5728\u521b\u5efa\u8868\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u8be5\u8868\u7a7a\u95f4\u3002</p> <p>Tip</p> <pre><code>-- \u521b\u5efa\u8868\u7a7a\u95f4\nCREATE TABLESPACE ts_name  ADD  DATAFILE  'file_name' ENGINE = engine_name;\n\n-- \u521b\u5efa\u8868\u65f6\u6307\u5b9a\u8868\u7a7a\u95f4\nCREATE  TABLE  xxx ...  TABLESPACE  ts_name;\n</code></pre> </li> <li> <p>Undo Tablespaces\uff0c\u64a4\u9500\u8868\u7a7a\u95f4\uff0cMySQL\u5b9e\u4f8b\u5728\u521d\u59cb\u5316\u65f6\u4f1a\u81ea\u52a8\u521b\u5efa\u4e24\u4e2a\u9ed8\u8ba4\u7684undo\u8868\u7a7a\u95f4\uff08\u521d\u59cb\u5927\u5c0f16M\uff09\uff0c\u7528\u4e8e\u5b58\u50a8 undo log\u65e5\u5fd7\u3002</p> </li> <li>Temporary Tablespaces\uff0c InnoDB \u4f7f\u7528\u4f1a\u8bdd\u4e34\u65f6\u8868\u7a7a\u95f4\u548c\u5168\u5c40\u4e34\u65f6\u8868\u7a7a\u95f4\u3002\u5b58\u50a8\u7528\u6237\u521b\u5efa\u7684\u4e34\u65f6\u8868\u7b49\u6570\u636e\u3002</li> <li>Doublewrite Buffer Files \u53cc\u5199\u7f13\u51b2\u533a\uff0cInnoDB\u5f15\u64ce\u5c06\u6570\u636e\u9875\u4eceBuffer Pool\u5237\u65b0\u5230\u78c1\u76d8\u524d\uff0c\u5148\u5c06\u6570\u636e\u9875\u5199\u5165\u53cc\u5199\u7f13\u51b2\u533a\u6587\u4ef6\u4e2d\uff0c\u4fbf\u4e8e\u7cfb\u7edf\u5f02\u5e38\u65f6\u6062\u590d\u6570\u636e\u3002</li> <li>Redo Log \u91cd\u505a\u65e5\u5fd7\uff0c\u662f\u7528\u6765\u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u3002\u8be5\u65e5\u5fd7\u6587\u4ef6\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a\u91cd\u505a\u65e5\u5fd7\u7f13\u51b2\uff08redo log  buffer\uff09\u4ee5\u53ca\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\uff08redo log\uff09,\u524d\u8005\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u540e\u8005\u5728\u78c1\u76d8\u4e2d\u3002\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u4f1a\u628a\u6240\u6709\u4fee\u6539\u4fe1\u606f\u90fd\u4f1a\u5b58\u5230\u8be5\u65e5\u5fd7\u4e2d, \u7528\u4e8e\u5728\u5237\u65b0\u810f\u9875\u5230\u78c1\u76d8\u65f6,\u53d1\u751f\u9519\u8bef\u65f6, \u8fdb\u884c\u6570\u636e\u6062\u590d\u4f7f\u7528\u3002</li> </ol>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u540e\u53f0\u7ebf\u7a0b","title":"\u540e\u53f0\u7ebf\u7a0b","text":"<ol> <li>Master Thread\uff0c\u6838\u5fc3\u540e\u53f0\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u8c03\u5ea6\u5176\u4ed6\u7ebf\u7a0b\uff0c\u8fd8\u8d1f\u8d23\u5c06\u7f13\u51b2\u6c60\u4e2d\u7684\u6570\u636e\u5f02\u6b65\u5237\u65b0\u5230\u78c1\u76d8\u4e2d, \u4fdd\u6301\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c  \u8fd8\u5305\u62ec\u810f\u9875\u7684\u5237\u65b0\u3001\u5408\u5e76\u63d2\u5165\u7f13\u5b58\u3001undo\u9875\u7684\u56de\u6536 \u3002</li> <li>IO Thread\uff0c \u5728InnoDB\u5b58\u50a8\u5f15\u64ce\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86AIO\u6765\u5904\u7406IO\u8bf7\u6c42, \u8fd9\u6837\u53ef\u4ee5\u6781\u5927\u5730\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u800cIO  Thread\u4e3b\u8981\u8d1f\u8d23\u8fd9\u4e9bIO\u8bf7\u6c42\u7684\u56de\u8c03\u3002</li> </ol> \u7ebf\u7a0b\u7c7b\u578b \u9ed8\u8ba4\u7ebf\u7a0b\u6570 \u4f5c\u7528 <code>Read thread</code> 4 \u5904\u7406\u8bfb\u64cd\u4f5c <code>Write thread</code> 4 \u5904\u7406\u5199\u64cd\u4f5c <code>Log thread</code> 1 \u5c06\u65e5\u5fd7\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8 <code>Insert buffer thread</code> 1 \u5c06\u5199\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8 <ol> <li>Purge Thread \u4e3b\u8981\u7528\u4e8e\u56de\u6536\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u4e86\u7684undo log\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0cundo log\u53ef\u80fd\u4e0d\u9700\u8981\u4e86\uff0c\u5c31\u7528\u5b83\u6765\u56de\u6536\u3002</li> <li>Page Cleaner Thread \u534f\u52a9 Master Thread \u5237\u65b0\u810f\u9875\u5230\u78c1\u76d8\u7684\u7ebf\u7a0b\uff0c\u5b83\u53ef\u4ee5\u51cf\u8f7b Master Thread \u7684\u5de5\u4f5c\u538b\u529b\uff0c\u51cf\u5c11\u963b\u585e\u3002</li> </ol>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u4e8b\u52a1\u539f\u7406","title":"\u4e8b\u52a1\u539f\u7406","text":"<p>\u4e8b\u52a1\u662f\u4e00\u7ec4\u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u5b83\u662f\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u4e8b\u52a1\u4f1a\u628a\u6240\u6709\u7684\u64cd\u4f5c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4e00\u8d77\u5411\u7cfb\u7edf\u63d0\u4ea4\u6216\u64a4\u9500\u64cd\u4f5c\u8bf7\u6c42\uff0c\u5373\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u540c\u65f6\u6210\u529f\uff0c\u8981\u4e48\u540c\u65f6\u5931\u8d25\u3002</p> <p>ACID\u7279\u6027</p> <ul> <li>\u539f\u5b50\u6027\uff08Atomicity\uff09\uff1a\u4e8b\u52a1\u662f\u4e0d\u53ef\u5206\u5272\u7684\u6700\u5c0f\u64cd\u4f5c\u5355\u5143\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002</li> <li>\u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u4e8b\u52a1\u5b8c\u6210\u524d\u540e\uff0c\u5fc5\u987b\u4f7f\u6240\u6709\u7684\u6570\u636e\u90fd\u4fdd\u6301\u4e00\u81f4\u72b6\u6001\u3002</li> <li>\u9694\u79bb\u6027\uff08Isolation\uff09\uff1a\u6570\u636e\u5e93\u7cfb\u7edf\u63d0\u4f9b\u7684\u9694\u79bb\u673a\u5236\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u5728\u4e0d\u53d7\u5916\u90e8\u5e76\u53d1\u64cd\u4f5c\u5f71\u54cd\u7684\u72ec\u7acb\u73af\u5883\u4e0b\u8fd0\u884c\u3002</li> <li>\u6301\u4e45\u6027\uff08Durability\uff09\uff1a\u4e8b\u52a1\u4e00\u65e6\u63d0\u4ea4\u6216\u56de\u6eda\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u7684\u6539\u53d8\u5c31\u662f\u6c38\u4e45\u7684\u3002</li> </ul> <p></p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#redo-log","title":"redo log","text":"<p>\u91cd\u505a\u65e5\u5fd7\uff0c\u8bb0\u5f55\u7684\u662f\u4e8b\u52a1\u63d0\u4ea4\u65f6\u6570\u636e\u9875\u7684\u7269\u7406\u4fee\u6539\uff0c\u662f\u7528\u6765\u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u3002</p> <p>\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a\u91cd\u505a\u65e5\u5fd7\u7f13\u51b2\uff08redo log buffer\uff09\u4ee5\u53ca\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\uff08redo log  file\uff09,\u524d\u8005\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u540e\u8005\u5728\u78c1\u76d8\u4e2d\u3002\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u4f1a\u628a\u6240\u6709\u4fee\u6539\u4fe1\u606f\u90fd\u5b58\u5230\u8be5\u65e5\u5fd7\u6587\u4ef6\u4e2d, \u7528\u4e8e\u5728\u5237\u65b0\u810f\u9875\u5230\u78c1\u76d8,\u53d1\u751f\u9519\u8bef\u65f6, \u8fdb\u884c\u6570\u636e\u6062\u590d\u4f7f\u7528\u3002</p> <p></p> <p>Note</p> <p>\u7f13\u51b2\u533a\u7684\u810f\u9875\uff08\u88ab\u4fee\u6539\u4e86\u7684\u6570\u636e\uff09\u662f\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u5237\u65b0\u5230\u78c1\u76d8\u7684\uff0c\u6b64\u8fc7\u7a0b\u53ef\u80fd\u51fa\u73b0\u95ee\u9898\uff0c\u5f15\u5165redo log\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u91cd\u8bd5</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#undo-log","title":"undo log","text":"<p>\u56de\u6eda\u65e5\u5fd7\uff0c\u7528\u4e8e\u8bb0\u5f55\u6570\u636e\u88ab\u4fee\u6539\u524d\u7684\u4fe1\u606f\uff0c\u4f5c\u7528\u5305\u542b\u4e24\u4e2a : \u63d0\u4f9b\u56de\u6eda(\u4fdd\u8bc1\u4e8b\u52a1\u7684\u539f\u5b50\u6027) \u548c  MVCC(\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236) \u3002</p> <p>Note</p> <p>undo log\u548credo log\u8bb0\u5f55\u7269\u7406\u65e5\u5fd7\u4e0d\u4e00\u6837\uff0c\u5b83\u662f\u903b\u8f91\u65e5\u5fd7\u3002\u53ef\u4ee5\u8ba4\u4e3a\u5f53delete\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cundo log\u4e2d\u4f1a\u8bb0\u5f55\u4e00\u6761\u5bf9\u5e94\u7684insert\u8bb0\u5f55\uff0c\u53cd\u4e4b\u4ea6\u7136\uff0c\u5f53update\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u5b83\u8bb0\u5f55\u4e00\u6761\u5bf9\u5e94\u76f8\u53cd\u7684 update\u8bb0\u5f55\u3002\u5f53\u6267\u884crollback\u65f6\uff0c\u5c31\u53ef\u4ee5\u4eceundo log\u4e2d\u7684\u903b\u8f91\u8bb0\u5f55\u8bfb\u53d6\u5230\u76f8\u5e94\u7684\u5185\u5bb9\u5e76\u8fdb\u884c\u56de\u6eda\u3002</p> <ul> <li>Undo log\u9500\u6bc1\uff1aundo log\u5728\u4e8b\u52a1\u6267\u884c\u65f6\u4ea7\u751f\uff0c\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u5220\u9664undo log\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u65e5\u5fd7\u53ef\u80fd\u8fd8\u7528\u4e8eMVCC\u3002</li> <li>Undo log\u5b58\u50a8\uff1aundo log\u91c7\u7528\u6bb5\u7684\u65b9\u5f0f\u8fdb\u884c\u7ba1\u7406\u548c\u8bb0\u5f55\uff0c\u5b58\u653e\u5728\u524d\u9762\u4ecb\u7ecd\u7684 rollback segment  \u56de\u6eda\u6bb5\u4e2d\uff0c\u5185\u90e8\u5305\u542b1024\u4e2aundo log segment\u3002</li> </ul>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#mvcc","title":"MVCC","text":""},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u57fa\u672c\u6982\u5ff5","title":"\u57fa\u672c\u6982\u5ff5","text":"<ol> <li>\u5f53\u524d\u8bfb\uff0c\u8bfb\u53d6\u7684\u662f\u8bb0\u5f55\u7684\u6700\u65b0\u7248\u672c\uff0c\u8bfb\u53d6\u65f6\u8fd8\u8981\u4fdd\u8bc1\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u4e0d\u80fd\u4fee\u6539\u5f53\u524d\u8bb0\u5f55\uff0c\u4f1a\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u8fdb\u884c\u52a0\u9501\u3002\u5bf9\u4e8e\u6211\u4eec\u65e5\u5e38\u7684\u64cd\u4f5c\uff0c\u5982\uff1a<code>select ... lock in share mode(\u5171\u4eab\u9501)\uff0cselect ...  for update\u3001update\u3001insert\u3001delete(\u6392\u4ed6\u9501)</code>\u90fd\u662f\u4e00\u79cd\u5f53\u524d\u8bfb\u3002</li> <li> <p>\u5feb\u7167\u8bfb\uff0c\u7b80\u5355\u7684select\uff08\u4e0d\u52a0\u9501\uff09\u5c31\u662f\u5feb\u7167\u8bfb\uff0c\u5feb\u7167\u8bfb\uff0c\u8bfb\u53d6\u7684\u662f\u8bb0\u5f55\u6570\u636e\u7684\u53ef\u89c1\u7248\u672c\uff0c\u6709\u53ef\u80fd\u662f\u5386\u53f2\u6570\u636e\uff0c \u4e0d\u52a0\u9501\uff0c\u662f\u975e\u963b\u585e\u8bfb\u3002</p> <ul> <li>Read Committed\uff1a\u6bcf\u6b21select\uff0c\u90fd\u751f\u6210\u4e00\u4e2a\u5feb\u7167\u8bfb\u3002 </li> <li>Repeatable Read\uff1a\u5f00\u542f\u4e8b\u52a1\u540e\u7b2c\u4e00\u4e2aselect\u8bed\u53e5\u624d\u662f\u5feb\u7167\u8bfb\u7684\u5730\u65b9\u3002 </li> <li>Serializable\uff1a\u5feb\u7167\u8bfb\u4f1a\u9000\u5316\u4e3a\u5f53\u524d\u8bfb\u3002</li> </ul> </li> <li> <p>MVCC\uff0c\u5168\u79f0 Multi-Version Concurrency Control\uff0c\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u3002\u6307\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7684\u591a\u4e2a\u7248\u672c\uff0c \u4f7f\u5f97\u8bfb\u5199\u64cd\u4f5c\u6ca1\u6709\u51b2\u7a81\uff0c\u5feb\u7167\u8bfb\u4e3aMySQL\u5b9e\u73b0MVCC\u63d0\u4f9b\u4e86\u4e00\u4e2a\u975e\u963b\u585e\u8bfb\u529f\u80fd\u3002MVCC\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u8fd8\u9700\u8981\u4f9d\u8d56\u4e8e\u6570\u636e\u5e93\u8bb0\u5f55\u4e2d\u7684\u4e09\u4e2a\u9690\u5f0f\u5b57\u6bb5\u3001undo log\u65e5\u5fd7\u3001readView\u3002</p> </li> </ol>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#\u9690\u85cf\u5b57\u6bb5","title":"\u9690\u85cf\u5b57\u6bb5","text":"<p>\u624b\u52a8\u521b\u5efa\u4e00\u5f20\u8868\u65f6\uff0cInnoDB\u8fd8\u4f1a\u81ea\u52a8\u7684\u7ed9\u6211\u4eec\u6dfb\u52a0\u9690\u85cf\u5b57\u6bb5</p> \u9690\u85cf\u5b57\u6bb5 \u4f5c\u7528 <code>TB_TRX_ID</code> \u6700\u8fd1\u4fee\u6539\u4e8b\u52a1ID <code>DB_ROLL_PTR</code> \u56de\u6eda\u6307\u9488\uff0c\u914d\u5408undo log\u6307\u5411\u8fd9\u6761\u8bb0\u5f55\u7684\u4e0a\u4e00\u4e2a\u7248\u672c <code>DB_ROW_ID</code> \u9690\u85cf\u4e3b\u952e\uff0c\u5982\u679c\u8868\u7ed3\u6784\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\u5c06\u751f\u6210\u8be5\u9690\u85cf\u5b57\u6bb5"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#undo-log_1","title":"undo log","text":"<p>\u56de\u6eda\u65e5\u5fd7\uff0c\u5728insert\u3001update\u3001delete\u7684\u65f6\u5019\u4ea7\u751f\u7684\u4fbf\u4e8e\u6570\u636e\u56de\u6eda\u7684\u65e5\u5fd7\u3002 </p> <p>\u5f53insert\u7684\u65f6\u5019\uff0c\u4ea7\u751f\u7684undo log\u65e5\u5fd7\u53ea\u5728\u56de\u6eda\u65f6\u9700\u8981\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u53ef\u88ab\u7acb\u5373\u5220\u9664\u3002</p> <p>\u800cupdate\u3001delete\u7684\u65f6\u5019\uff0c\u4ea7\u751f\u7684undo log\u65e5\u5fd7\u4e0d\u4ec5\u5728\u56de\u6eda\u65f6\u9700\u8981\uff0c\u5728\u5feb\u7167\u8bfb\u65f6\u4e5f\u9700\u8981\uff0c\u4e0d\u4f1a\u7acb\u5373\u88ab\u5220\u9664\u3002</p> <p>\u7248\u672c\u94fe </p> <p>\u793a\u4f8b\uff1a</p> <p></p> <p></p> <p>Note</p> <p>\u4e0d\u540c\u4e8b\u52a1\u6216\u76f8\u540c\u4e8b\u52a1\u5bf9\u540c\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\uff0c\u4f1a\u5bfc\u81f4\u8be5\u8bb0\u5f55\u7684undolog\u751f\u6210\u4e00\u6761 \u8bb0\u5f55\u7248\u672c\u94fe\u8868\uff0c\u94fe\u8868\u7684\u5934\u90e8\u662f\u6700\u65b0\u7684\u65e7\u8bb0\u5f55\uff0c\u94fe\u8868\u5c3e\u90e8\u662f\u6700\u65e9\u7684\u65e7\u8bb0\u5f55\u3002</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/#readview","title":"ReadView","text":"<p>ReadView\uff08\u8bfb\u89c6\u56fe\uff09\u662f \u5feb\u7167\u8bfb SQL\u6267\u884c\u65f6MVCC\u63d0\u53d6\u6570\u636e\u7684\u4f9d\u636e\uff0c\u8bb0\u5f55\u5e76\u7ef4\u62a4\u7cfb\u7edf\u5f53\u524d\u6d3b\u8dc3\u7684\u4e8b\u52a1 \uff08\u672a\u63d0\u4ea4\u7684\uff09id\u3002</p> <p>ReadView\u4e2d\u5305\u542b\u4e86\u56db\u4e2a\u6838\u5fc3\u5b57\u6bb5\uff1a</p> \u5b57\u6bb5 \u542b\u4e49 <code>m_ids</code> \u5f53\u524d\u6d3b\u8dc3\u7684\u4e8b\u52a1ID\u96c6\u5408 <code>min_trx_id</code> \u6700\u5c0f\u6d3b\u8dc3\u4e8b\u52a1ID <code>max_trx_id</code> \u9884\u5206\u914d\u4e8b\u52a1ID\uff0c\u5f53\u524d\u6700\u5927\u4e8b\u52a1ID+1 <code>creator_trx_id</code> ReadView\u521b\u5efa\u8005\u7684\u4e8b\u52a1ID <p>\u7248\u672c\u94fe\u8bbf\u95ee\u89c4\u5219</p> <ol> <li>\u81ea\u4fee\u6539\u68c0\u67e5    \u82e5\u88ab\u8bbf\u95ee\u7248\u672c\u7684<code>trx_id == creator_trx_id</code>\uff0c\u8bf4\u660e\u662f\u5f53\u524d\u4e8b\u52a1\u81ea\u5df1\u4fee\u6539\u7684\u8bb0\u5f55\uff0c\u76f4\u63a5\u8bbf\u95ee\u8be5\u7248\u672c</li> <li>\u5df2\u63d0\u4ea4\u4e8b\u52a1\u68c0\u67e5    \u82e5<code>trx_id &lt; min_trx_id</code>\uff0c\u8bf4\u660e\u8be5\u7248\u672c\u5728ReadView\u521b\u5efa\u524d\u5df2\u63d0\u4ea4\uff0c\u53ef\u4ee5\u8bbf\u95ee</li> <li>\u672a\u6765\u4e8b\u52a1\u68c0\u67e5    \u82e5<code>trx_id &gt;= max_trx_id</code>\uff0c\u8bf4\u660e\u8be5\u7248\u672c\u7531\u672a\u6765\u4e8b\u52a1\u521b\u5efa\uff0c\u4e0d\u53ef\u8bbf\u95ee</li> <li>\u6d3b\u8dc3\u4e8b\u52a1\u68c0\u67e5    \u82e5<code>min_trx_id \u2264 trx_id &lt; max_trx_id</code>\uff1a</li> <li>\u82e5<code>trx_id \u2208 m_ids</code>\uff1a\u521b\u5efa\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u4ecd\u6d3b\u8dc3\uff0c\u4e0d\u53ef\u8bbf\u95ee</li> <li>\u82e5<code>trx_id \u2209 m_ids</code>\uff1a\u521b\u5efa\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5df2\u63d0\u4ea4\uff0c\u53ef\u4ee5\u8bbf\u95ee</li> </ol> <p>\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684ReadView</p> \u9694\u79bb\u7ea7\u522b ReadView\u751f\u6210\u65f6\u673a \u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898 READ COMMITTED \u6bcf\u6b21SELECT\u524d\u751f\u6210\u65b0ReadView \u907f\u514d\u810f\u8bfb REPEATABLE READ \u4e8b\u52a1\u9996\u6b21SELECT\u65f6\u751f\u6210ReadView \u907f\u514d\u4e0d\u53ef\u91cd\u590d\u8bfb <p>Read Commited \u7ea7\u522b\u4e0b\u7684\u8bfb\u53d6\u793a\u4f8b</p> <p></p> <p>Note</p> <p>\u4e8b\u52a15\u6839\u636e\u4e0a\u8ff0\u7248\u672c\u94fe\u8bbf\u95ee\u89c4\u5219\uff0c\u7b2c\u4e00\u6b21\u8bfb\u8bbf\u95ee\u5230\u7684\u662f\u4f4d\u4e8e 0x00002 \u7684\u5feb\u7167\uff0c\u7b2c\u4e8c\u6b64\u8bfb\u53d6\u662f 0x00003 \u7684\u5feb\u7167</p> <p>Repeatable Read \u7ea7\u522b\u4e0b\uff0c\u4e0a\u8ff0\u793a\u4f8b\u7684\u7b2c\u4e8c\u6b21\u8bfb\u53d6\u4f1a\u590d\u7528\u7b2c\u4e00\u6b21\u751f\u6210\u7684ReadView\uff0c\u6240\u4ee5\u5b9e\u73b0\u4e86\u53ef\u91cd\u590d\u8bfb</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/","title":"\u5b58\u50a8\u8fc7\u7a0b","text":""},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u5b9a\u4e49","title":"\u5b9a\u4e49","text":"<p>\u5b58\u50a8\u8fc7\u7a0b\u662f\u4e8b\u5148\u7ecf\u8fc7\u7f16\u8bd1\u5e76\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u6bb5 SQL \u8bed\u53e5\u7684\u96c6\u5408\uff0c\u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\u53ef\u4ee5\u7b80\u5316\u5e94\u7528\u5f00\u53d1 \u4eba\u5458\u7684\u5f88\u591a\u5de5\u4f5c\uff0c\u51cf\u5c11\u6570\u636e\u5728\u6570\u636e\u5e93\u548c\u5e94\u7528\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u4f20\u8f93\uff0c\u5bf9\u4e8e\u63d0\u9ad8\u6570\u636e\u5904\u7406\u7684\u6548\u7387\u662f\u6709\u597d\u5904\u7684\u3002 \u5b58\u50a8\u8fc7\u7a0b\u601d\u60f3\u4e0a\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u6570\u636e\u5e93 SQL \u8bed\u8a00\u5c42\u9762\u7684\u4ee3\u7801\u5c01\u88c5\u4e0e\u91cd\u7528\u3002</p> <p>\u7279\u70b9</p> <ul> <li>\u5c01\u88c5\uff0c\u590d\u7528</li> <li>\u53ef\u4ee5\u63a5\u6536\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u8fd4\u56de\u6570\u636e</li> <li>\u51cf\u5c11\u7f51\u7edc\u4ea4\u4e92\uff0c\u6548\u7387\u63d0\u5347</li> </ul> <pre><code>-- \u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b\nCREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d([\u53c2\u6570\u5217\u8868])\nBEGIN\n    SQL\u8bed\u53e5\nEND;\n\n-- \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\nCALL \u5b58\u50a8\u8fc7\u7a0b\u540d([\u53c2\u6570])\n\n-- \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\nSELECT * FROM information_schema.ROUTINES WHERE ROUTINE_SCHEMA = '\u6570\u636e\u5e93\u540d'\nSHOW CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\n\n-- \u5220\u9664\u5b58\u50a8\u8fc7\u7a0b\nDROP PROCEDURE [IF EXISTS] \u5b58\u50a8\u8fc7\u7a0b\u540d\n</code></pre> <p>Tip</p> <p>\u5728\u547d\u4ee4\u884c\u5de5\u5177\u4e2d\u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b\u65f6\u9700\u8981\u4f7f\u7528<code>delimiter</code>\u6307\u5b9a\u7ed3\u675f\u7b26\uff0c\u5426\u5219\u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\";\"\u4f1a\u88ab\u8ba4\u4e3a\u662f\u7ed3\u675f\u7b26\u800c\u65e0\u6cd5\u6210\u529f\u521b\u5efa</p> <p></p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u53d8\u91cf","title":"\u53d8\u91cf","text":"<p>\u5728MySQL\u4e2d\u53d8\u91cf\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b: \u7cfb\u7edf\u53d8\u91cf\u3001\u7528\u6237\u5b9a\u4e49\u53d8\u91cf\u3001\u5c40\u90e8\u53d8\u91cf\u3002</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u7cfb\u7edf\u53d8\u91cf","title":"\u7cfb\u7edf\u53d8\u91cf","text":"<p>\u7cfb\u7edf\u53d8\u91cf\u662fMySQL\u670d\u52a1\u5668\u63d0\u4f9b\uff0c\u4e0d\u662f\u7528\u6237\u5b9a\u4e49\u7684\uff0c\u5c5e\u4e8e\u670d\u52a1\u5668\u5c42\u9762\u3002\u5206\u4e3a\u5168\u5c40\u53d8\u91cf\uff08GLOBAL\uff09\u3001\u4f1a\u8bdd\u53d8\u91cf\uff08SESSION\uff09</p> <pre><code>-- \u67e5\u770b\u6240\u6709\u53d8\u91cf\nSHOW [SESSION|GLOBAL] VARIABLES;\n\n-- \u6a21\u7cca\u5339\u914d\nSHOW [SESSION|GLOBAL] VARIABLES LIKE '...';\n\n-- \u67e5\u770b\u5177\u4f53\u53d8\u91cf\nSELECT @@[SESSION|GLOBAL].\u53d8\u91cf\u540d;\n\n-- \u4fee\u6539\u53d8\u91cf\u503c\nSET [SESSION|GLOBAL] \u53d8\u91cf\u540d = \u503c;\n</code></pre> <p>Warning</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u6307\u5b9aSESSION/GLOBAL\uff0c\u9ed8\u8ba4\u662fSESSION\uff0c\u4f1a\u8bdd\u53d8\u91cf</li> <li>mysql\u670d\u52a1\u91cd\u65b0\u542f\u52a8\u4e4b\u540e\uff0c\u6240\u8bbe\u7f6e\u7684\u5168\u5c40\u53c2\u6570\u4f1a\u5931\u6548\uff0c\u8981\u60f3\u4e0d\u5931\u6548\uff0c\u9700\u8981\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u3002</li> </ul>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u7528\u6237\u81ea\u5b9a\u4e49\u53d8\u91cf","title":"\u7528\u6237\u81ea\u5b9a\u4e49\u53d8\u91cf","text":"<p>\u7528\u6237\u5b9a\u4e49\u53d8\u91cf\u662f\u7528\u6237\u6839\u636e\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u7528\u6237\u53d8\u91cf\u4e0d\u7528\u63d0\u524d\u58f0\u660e\uff0c\u5728\u7528\u7684\u65f6\u5019\u76f4\u63a5\u7528 \"@\u53d8\u91cf\u540d\" \u4f7f\u7528\u5c31\u53ef\u4ee5\u3002\u5176\u4f5c\u7528\u57df\u4e3a\u5f53\u524d\u8fde\u63a5\u3002</p> <pre><code>-- \u53d8\u91cf\u8d4b\u503c\nSET @var_name = expr [, @var_name = expr] ... ; \nSET @var_name := expr [, @var_name := expr] ... ; \n\nSELECT \u5b57\u6bb5\u540d INTO @var_name FROM \u8868\u540d;\n\n-- \u67e5\u770b\u53d8\u91cf\nSELECT @var_name[,@var_name,...];\n</code></pre>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u5c40\u90e8\u53d8\u91cf","title":"\u5c40\u90e8\u53d8\u91cf","text":"<p>\u5c40\u90e8\u53d8\u91cf\u662f\u6839\u636e\u9700\u8981\u5b9a\u4e49\u7684\u5728\u5c40\u90e8\u751f\u6548\u7684\u53d8\u91cf\uff0c\u8bbf\u95ee\u4e4b\u524d\uff0c\u9700\u8981DECLARE\u58f0\u660e\uff0c\u53ef\u7528\u4f5c\u5b58\u50a8\u8fc7\u7a0b\u5185\u7684\u5c40\u90e8\u53d8\u91cf\u548c\u8f93\u5165\u53c2\u6570\u3002</p> <pre><code>DECLARE \u53d8\u91cf\u540d \u53d8\u91cf\u7c7b\u578b[DEFAULT ...];\n\nSET \u53d8\u91cf\u540d = \u503c;\nSET \u53d8\u91cf\u540d := \u503c;\n\nSELECT \u5b57\u6bb5\u540d INTO \u53d8\u91cf\u540d FROM \u8868\u540d;\n</code></pre> <p></p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u6d41\u7a0b\u63a7\u5236","title":"\u6d41\u7a0b\u63a7\u5236","text":""},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#if","title":"if","text":"<pre><code>IF condition THEN \n    .....\nELSEIF condition THEN       -- \u53ef\u9009\n    .....\nELSE                     -- \u53ef\u9009\n    .....\nEND  IF;\n</code></pre>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u53c2\u6570","title":"\u53c2\u6570","text":"<p>\u793a\u4f8b</p> <pre><code>-- \u521b\u5efa\u5e26\u53c2\u6570\u7684\u5b58\u50a8\u8fc7\u7a0b\ncreate procedure test(in score int, out result varchar(10))\nbegin\n    if score &gt;= 85 then\n        set result := '\u4f18\u79c0';\n    elseif score &gt;= 60 then\n        set result := '\u53ca\u683c';\n    else\n        set result := '\u4e0d\u53ca\u683c';\n    end if;\nend;\n\n\n-- \u8c03\u7528\u5e76\u63a5\u6536\u7ed3\u679c\ncall test(85, @result);\nselect @result;\n</code></pre> <p>Note</p> <p><code>in</code> \u6307\u5b9a\u4e3a\u8f93\u5165\u53c2\u6570</p> <p><code>out</code> \u6307\u5b9a\u4e3a\u8f93\u51fa\u53c2\u6570</p> <p><code>inout</code> \u6307\u5b9a\u65e2\u4e3a\u8f93\u5165\u53c2\u6570\u4e5f\u4e3a\u8f93\u51fa\u53c2\u6570</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#case","title":"case","text":"<pre><code>-- \u8bed\u6cd5\u4e00\ncase case_value\n    when value1 then statement1\n    when value2 then statement2\n    ...\n    else statement\nend case;\n\n-- \u8bed\u6cd5\u4e8c\ncase\n    when condition then statement1\n    when condition then statement2\n    ...\nend case;\n</code></pre>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u5faa\u73af","title":"\u5faa\u73af","text":"<pre><code>-- while\u5faa\u73af,condition\u6ee1\u8db3\u65f6\u5faa\u73af\nwhile condition do\n    statement\nend while;\n\n\n-- repeat\u5faa\u73af,condition\u6ee1\u8db3\u65f6\u7ed3\u675f\u5faa\u73af\nrepeat\n    statement\n    until condition\nend repeat;\n\n\n-- loop\u5faa\u73af,leave\u9000\u51fa\u5faa\u73af,iterate\u76f4\u63a5\u8fdb\u5165\u4e0b\u4e00\u5c42\u5faa\u73af\n[begin_label:] looop\n    statement\nend loop [end_label];\n-- \u793a\u4f8b\nlabel:loop\n    if condition then\n        leave label;\n    end if;\n    statement\nend loop lael;\n</code></pre>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u6e38\u6807","title":"\u6e38\u6807","text":"<p>MySQL\u6e38\u6807(Cursor)\u662f\u4e00\u79cd\u6570\u636e\u5e93\u5bf9\u8c61\uff0c\u7528\u4e8e\u5728\u7ed3\u679c\u96c6\u4e2d\u9010\u884c\u5904\u7406\u6570\u636e\u3002</p> <pre><code>-- \u58f0\u660e\u6e38\u6807\ndeclare \u6e38\u6807\u540d\u79f0 cursor for \u67e5\u8be2\u8bed\u53e5\n\n-- \u6253\u5f00\u6e38\u6807\nopen \u6e38\u6807\u540d\u79f0\n\n-- \u83b7\u53d6\u6e38\u6807\u8bb0\u5f55\nfetch \u6e38\u6807\u540d\u79f0 into \u53d8\u91cf\n\n-- \u5173\u95ed\u6e38\u6807\nclose \u6e38\u6807\u540d\u79f0\n\n\n-- \u793a\u4f8b\ncreate procedure test(in uage int)\nbegin\n    declare uname varchar(100);\n    declare uage int;\n\n    -- \u58f0\u660e\u6e38\u6807\n    declare cursor_user cursor for select name, age from tb_user where age &lt;= uage;\n\n    -- \u58f0\u660e\u6e38\u6807\u65e0\u6570\u636e\u65f6\u5904\u7406\u7a0b\u5e8f\n    declare exit handler for sqlstate '02000' close cursor_user;\n\n    create table if not exists user(\n        ...\n    );\n\n    open cursor_suer;\n\n    -- \u6b7b\u5faa\u73af\u5904\u7406\u6570\u636e\uff0c\u7531handler\u5904\u7406\u9000\u51fa\n    while true do\n        fetch cursor_user into uname, age;\n        insert into user(...) values (uname, age);\n    end while;\n\n    close cursor_user;\nend;\n</code></pre>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u6761\u4ef6\u5904\u7406\u7a0b\u5e8f","title":"\u6761\u4ef6\u5904\u7406\u7a0b\u5e8f","text":"<p>\u6761\u4ef6\u5904\u7406\u7a0b\u5e8f\uff08Handler\uff09\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u5728\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898\u65f6\u76f8\u5e94\u7684\u5904\u7406\u6b65\u9aa4\u3002</p> <p>Note</p> <p>\u5982\u4e0a\u5c0f\u8282\u5bf9\u6e38\u6807\u6570\u636e\u5904\u7406\u5b8c\u540e\u7684\u6761\u4ef6\u5904\u7406\u7a0b\u5e8f</p> <pre><code>-- \u5b9a\u4e49handler\ndeclare handler_action handler for condition_value[,condition_value,...] statement;\n\n-- \u53c2\u6570\u8bf4\u660e\nhandler_action\n    continue: \u7ee7\u7eed\u6267\u884c\n    exit: \u505c\u6b62\u6267\u884c\ncondition_value\n    sqlstate sqlstate_value: \u72b6\u6001\u7801\n    sqlwarning: \u4ee501\u5f00\u5934\u7684sqlstate\u4ee3\u7801\u7b80\u5199\n    not found: \u4ee502\u5f00\u5934\u7684sqlstate\u4ee3\u7801\u7b80\u5199\n    sqlexception: \u5176\u4ed6sqlstate\u4ee3\u7801\u7b80\u5199\n</code></pre> <p>&lt;&gt;</p>"},{"location":"MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/#\u5b58\u50a8\u51fd\u6570","title":"\u5b58\u50a8\u51fd\u6570","text":"<p>\u5b58\u50a8\u51fd\u6570\u662f\u6709\u8fd4\u56de\u503c\u7684\u5b58\u50a8\u8fc7\u7a0b\uff0c\u5b58\u50a8\u51fd\u6570\u7684\u53c2\u6570\u53ea\u80fd\u662fIN\u7c7b\u578b\u7684\u3002</p> <pre><code>CREATE  FUNCTION \u5b58\u50a8\u51fd\u6570\u540d\u79f0 ([ \u53c2\u6570\u5217\u8868 ])\nRETURNS  type  [characteristic ...]\n BEGIN\n    -- SQL\u8bed\u53e5\n    RETURN ...;\n END;\n\n-- characteristic\u8bf4\u660e\uff1a\n    DETERMINISTIC\uff1a\u76f8\u540c\u7684\u8f93\u5165\u53c2\u6570\u603b\u662f\u4ea7\u751f\u76f8\u540c\u7684\u7ed3\u679c\n    NO SQL \uff1a\u4e0d\u5305\u542b SQL \u8bed\u53e5\u3002\n    READS SQL DATA\uff1a\u5305\u542b\u8bfb\u53d6\u6570\u636e\u7684\u8bed\u53e5\uff0c\u4f46\u4e0d\u5305\u542b\u5199\u5165\u6570\u636e\u7684\u8bed\u53e5\u3002\n</code></pre>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/","title":"\u67b6\u6784","text":"<p>MySQL\u4f53\u7cfb\u7ed3\u6784</p> <p></p>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/#\u5b58\u50a8\u5f15\u64ce","title":"\u5b58\u50a8\u5f15\u64ce","text":"<p>MySQL\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\u4e3aInnoDB</p> <p>\u5b58\u50a8\u5f15\u64ce\u662fMySQL\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u6570\u636e\u7684\u5b58\u50a8\u3001\u68c0\u7d22\u548c\u7ba1\u7406\u3002MySQL\u91c7\u7528\u63d2\u4ef6\u5f0f\u67b6\u6784\uff0c\u5141\u8bb8\u7528\u6237\u6839\u636e\u9700\u8981\u9009\u62e9\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u3002</p> <pre><code>-- \u6307\u5b9a\u5b58\u50a8\u5f15\u64ce\nCREATE TABLE \u8868\u540d(\n    ...\n)ENGINE=INNODB ...\n</code></pre> \u7279\u6027 InnoDB MyISAM Memory Archive \u4e8b\u52a1\u652f\u6301 \u2705 \u274c \u274c \u274c \u9501\u7c92\u5ea6 \u884c\u9501 \u8868\u9501 \u8868\u9501 \u884c\u9501 \u5916\u952e\u652f\u6301 \u2705 \u274c \u274c \u274c MVCC \u2705 \u274c \u274c \u274c \u5d29\u6e83\u6062\u590d \u5f3a \u5f31 \u6570\u636e\u4e22\u5931 \u4e2d\u7b49 \u5168\u6587\u7d22\u5f15 \u2705(5.6+) \u2705 \u274c \u274c \u538b\u7f29\u5b58\u50a8 \u2705 \u2705 \u274c \u2705 <p></p>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/#innodb","title":"InnoDB","text":"<ol> <li> <p>\u4e8b\u52a1\u5904\u7406\uff1a</p> <ul> <li>\u5b8c\u6574\u7684ACID\u652f\u6301</li> <li>\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0</li> </ul> <pre><code>-- \u67e5\u770b\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\nSHOW VARIABLES LIKE 'transaction_isolation';\n</code></pre> </li> <li> <p>\u805a\u7c07\u7d22\u5f15\uff1a</p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\u7684\u53f6\u8282\u70b9\u76f4\u63a5\u5b58\u50a8\u884c\u6570\u636e</li> <li>\u82e5\u65e0\u4e3b\u952e\u5219\u81ea\u52a8\u521b\u5efa6\u5b57\u8282\u7684ROWID</li> </ul> </li> <li> <p>\u4e8c\u7ea7\u7d22\u5f15\uff1a</p> <ul> <li>\u975e\u4e3b\u952e\u7d22\u5f15\u7684\u53f6\u8282\u70b9\u5b58\u50a8\u4e3b\u952e\u503c</li> <li>\u9700\u8981\u56de\u8868\u67e5\u8be2</li> </ul> </li> <li> <p>\u7f13\u51b2\u6c60\u7ba1\u7406\uff1a</p> <ul> <li>\u91c7\u7528LRU\u7b97\u6cd5\u7ba1\u7406\u5185\u5b58\u9875</li> <li>\u5305\u542b\u591a\u4e2a\u5b50\u6c60\uff085.7+\u652f\u6301\u591a\u5b9e\u4f8b\uff09</li> </ul> </li> </ol> <p></p>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/#myisam","title":"MyISAM","text":"<p>\u5b58\u50a8\u7ed3\u6784</p> <ul> <li><code>.frm</code>\uff1a\u8868\u7ed3\u6784\u6587\u4ef6</li> <li><code>.MYD</code>\uff1a\u6570\u636e\u6587\u4ef6</li> <li><code>.MYI</code>\uff1a\u7d22\u5f15\u6587\u4ef6</li> </ul> <p>\u9002\u7528\u573a\u666f</p> <ul> <li>\u53ea\u8bfb\u6216\u8bfb\u591a\u5199\u5c11\u7684\u6570\u636e</li> <li>\u4e0d\u9700\u8981\u4e8b\u52a1\u7684\u8868</li> <li>\u7a7a\u95f4\u6570\u636e\uff08GIS\u51fd\u6570\u652f\u6301\u8f83\u597d\uff09</li> </ul> <p></p>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/#memory","title":"Memory","text":"<ul> <li>\u7279\u70b9\uff1a\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u91cd\u542f\u4e22\u5931</li> <li>\u4f7f\u7528\u573a\u666f\uff1a<ul> <li>\u4e34\u65f6\u8868</li> <li>\u9ad8\u901f\u7f13\u5b58</li> </ul> </li> </ul>"},{"location":"MySQL/%E6%9E%B6%E6%9E%84/#\u9002\u7528\u573a\u666f","title":"\u9002\u7528\u573a\u666f","text":"\u9700\u6c42 \u63a8\u8350\u5f15\u64ce \u7406\u7531 \u9700\u8981\u4e8b\u52a1 InnoDB \u552f\u4e00\u5b8c\u6574\u652f\u6301ACID\u7684\u5f15\u64ce \u9ad8\u5e76\u53d1\u5199\u5165 InnoDB \u884c\u9501\u6bd4\u8868\u9501\u5e76\u53d1\u5ea6\u9ad8 \u5168\u6587\u641c\u7d22 InnoDB 5.6+\u540e\u529f\u80fd\u5b8c\u5584 \u6570\u636e\u4ed3\u5e93 MyISAM \u8ba1\u6570\u64cd\u4f5c\u66f4\u5feb \u4e34\u65f6\u6570\u636e\u5904\u7406 Memory \u5185\u5b58\u8868\u901f\u5ea6\u5feb \u5386\u53f2\u6570\u636e\u5f52\u6863 Archive \u8d85\u9ad8\u538b\u7f29\u6bd4"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/","title":"\u7d22\u5f15","text":"<p>\u4f5c\u7528</p> <ul> <li>\u52a0\u901f\u67e5\u8be2\uff1a\u7c7b\u4f3c\u4e66\u7c4d\u76ee\u5f55\uff0c\u51cf\u5c11\u5168\u8868\u626b\u63cf</li> <li>\u6392\u5e8f\u4f18\u5316\uff1a\u907f\u514dfilesort\u4e34\u65f6\u6392\u5e8f</li> <li>\u7ea6\u675f\u4fdd\u8bc1\uff1a\u552f\u4e00\u7d22\u5f15\u4fdd\u8bc1\u6570\u636e\u552f\u4e00\u6027</li> </ul> \u4f18\u70b9 \u7f3a\u70b9 \u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6 \u964d\u4f4e\u5199\u64cd\u4f5c\u6027\u80fd \u4fdd\u8bc1\u6570\u636e\u552f\u4e00\u6027 \u5360\u7528\u989d\u5916\u5b58\u50a8\u7a7a\u95f4 \u52a0\u901f\u8868\u8fde\u63a5 \u589e\u52a0\u7ef4\u62a4\u6210\u672c"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u7ed3\u6784","title":"\u7d22\u5f15\u7ed3\u6784","text":"\u7d22\u5f15\u7c7b\u578b \u5b58\u50a8\u7ed3\u6784 \u9002\u7528\u573a\u666f \u793a\u4f8b B+ Tree \u5e73\u8861\u591a\u8def\u641c\u7d22\u6811 \u7cbe\u786e\u5339\u914d/\u8303\u56f4\u67e5\u8be2 \u4e3b\u952e\u7d22\u5f15 Hash \u54c8\u5e0c\u8868 \u7cbe\u786e\u5339\u914d(\u4e0d\u652f\u6301\u8303\u56f4) Memory\u5f15\u64ce Full-Text \u5012\u6392\u7d22\u5f15 \u6587\u672c\u641c\u7d22 \u6587\u7ae0\u5185\u5bb9\u641c\u7d22 R-Tree \u7a7a\u95f4\u7d22\u5f15 GIS\u6570\u636e \u5730\u56fe\u5750\u6807 <p>B\u6811</p> <p>B\u6811\u7684\u8bde\u751f\u662f\u4e3a\u4e86\u89e3\u51b3\u4f20\u7edf\u4e8c\u53c9\u67e5\u627e\u6811\u5728\u78c1\u76d8\u5b58\u50a8\u73af\u5883\u4e0b\u7684\u6027\u80fd\u95ee\u9898\uff1a\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u9ad8\u5ea6\u8f83\u9ad8\uff08\u4f8b\u5982\u767e\u4e07\u6570\u636e\u9700\u8981\u7ea620\u5c42\uff09\uff0c\u6bcf\u6b21\u67e5\u627e\u9700\u8981\u591a\u6b21\u78c1\u76d8I/O\uff0c\u6548\u7387\u4f4e\u4e0b\u3002</p> <p>\u7279\u70b9\uff1a</p> <ol> <li>\u591a\u8def\u5e73\u8861\uff1a\u6bcf\u4e2a\u8282\u70b9\u6709\u591a\u4e2a\u5b50\u8282\u70b9\uff08\u901a\u5e38\u6570\u767e\u4e2a\uff09</li> <li>\u5b8c\u5168\u5e73\u8861\uff1a\u6240\u6709\u53f6\u5b50\u8282\u70b9\u4f4d\u4e8e\u540c\u4e00\u5c42</li> <li>\u8282\u70b9\u5b58\u50a8\uff1a\u952e\u503c+\u6570\u636e\u6307\u9488\uff08\u6240\u6709\u8282\u70b9\u90fd\u5b58\u50a8\u6570\u636e\uff09</li> </ol> <p></p> <p>B+\u6811</p> <ol> <li>\u6570\u636e\u96c6\u4e2d\u5b58\u50a8\uff1a\u4ec5\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u6570\u636e\u8bb0\u5f55</li> <li>\u53f6\u5b50\u8282\u70b9\u94fe\u8868\uff1a\u6240\u6709\u53f6\u5b50\u8282\u70b9\u901a\u8fc7\u6307\u9488\u987a\u5e8f\u94fe\u63a5</li> <li>\u952e\u503c\u5197\u4f59\u5b58\u50a8\uff1a\u975e\u53f6\u5b50\u8282\u70b9\u7684\u952e\u503c\u4f1a\u5728\u53f6\u5b50\u8282\u70b9\u518d\u6b21\u51fa\u73b0</li> </ol> <p></p> <p>\u2705\u4e3a\u4ec0\u4e48\u4f7f\u7528B+\u6811\u4f5c\u4e3a\u7d22\u5f15\u7ed3\u6784</p> <ol> <li>\u78c1\u76d8I/O\u6700\u5c0f\u5316<ul> <li>B+\u6811\u7684\"\u77ee\u80d6\"\u7279\u6027\uff08\u901a\u5e383-4\u5c42\u5c31\u80fd\u5b58\u50a8\u4ebf\u7ea7\u6570\u636e\uff09\u5927\u5e45\u51cf\u5c11\u78c1\u76d8\u8bbf\u95ee\u6b21\u6570</li> <li>\u793a\u4f8b\uff1a\u5343\u4e07\u7ea7\u6570\u636e\u67e5\u8be2\u53ea\u97003\u6b21I/O\uff08\u6839\u8282\u70b9\u5e38\u9a7b\u5185\u5b58\uff0c\u5b9e\u96452\u6b21\u78c1\u76d8I/O\uff09</li> </ul> </li> <li>\u9875\u5bf9\u9f50\u4f18\u5316<ul> <li>B+\u6811\u8282\u70b9\u5927\u5c0f\u8bbe\u8ba1\u4e3a\u78c1\u76d8\u9875\u5927\u5c0f\u7684\u6574\u6570\u500d\uff08InnoDB\u9ed8\u8ba416KB\uff09</li> <li>\u5b8c\u5168\u5339\u914d\u78c1\u76d8\u7684\u5757\u5b58\u50a8\u7279\u6027\uff0c\u907f\u514d\u8bfb\u53d6\u788e\u7247\u6570\u636e</li> </ul> </li> <li>\u8303\u56f4\u67e5\u8be2\u9ad8\u6548<ul> <li>\u53f6\u5b50\u8282\u70b9\u901a\u8fc7\u94fe\u8868\u8fde\u63a5\uff0c\u652f\u6301\u987a\u5e8f\u904d\u5386</li> <li>\u8303\u56f4\u67e5\u8be2\u65e0\u9700\u56de\u5230\u4e0a\u5c42\u8282\u70b9\uff0c\u76f4\u63a5\u987a\u5e8f\u626b\u63cf\u53f6\u5b50\u8282\u70b9</li> </ul> </li> <li>B\u6811 vs B+\u6811<ul> <li>B\u6811\u6240\u6709\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff0c\u5bfc\u81f4\u8282\u70b9\u8f83\u5927\uff0c\u6811\u9ad8\u589e\u52a0</li> <li>B+\u6811\u4ec5\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u66f4\u5c0f\uff0c\u6811\u66f4\u77ee</li> </ul> </li> </ol> \u6570\u636e\u7ed3\u6784 \u4f18\u70b9 \u7f3a\u70b9 \u9002\u7528\u573a\u666f \u54c8\u5e0c\u8868 O(1)\u67e5\u8be2 \u65e0\u6cd5\u8303\u56f4\u67e5\u8be2 \u7f13\u5b58/KV\u5b58\u50a8 \u7ea2\u9ed1\u6811/\u4e8c\u53c9\u6811 \u5185\u5b58\u64cd\u4f5c\u5feb \u6811\u9ad8\u8f83\u5927 \u5185\u5b58\u7d22\u5f15 B+\u6811 \u7efc\u5408\u6027\u80fd\u6700\u4f73 \u5199\u5165\u6210\u672c\u8f83\u9ad8 \u901a\u7528OLTP <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u5206\u7c7b","title":"\u7d22\u5f15\u5206\u7c7b","text":"<p>\u6309\u6570\u636e\u7ed3\u6784\uff1a</p> <p>Tip</p> <p>\u89c1\u4e0a\u4e00\u8282\u201c\u7d22\u5f15\u7ed3\u6784\u201d\u5206\u7c7b</p> <p>\u6309\u5b58\u50a8\u5f62\u5f0f\uff1a</p> \u540d\u79f0 \u542b\u4e49 \u7279\u70b9 \u805a\u7c07\u7d22\u5f15 \u6570\u636e\u4e0e\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u8d77 \u6709\u4e14\u4ec5\u6709\u4e00\u4e2a \u4e8c\u7ea7\u7d22\u5f15 \u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u4e3b\u952e\u503c\uff0c\u9700\u8981\u56de\u8868\u67e5\u8be2 \u6ca1\u6709\u6216\u591a\u4e2a <p>\u805a\u7c07\u7d22\u5f15\u9009\u53d6\u89c4\u5219</p> <ul> <li>\u5b58\u5728\u4e3b\u952e\uff0c\u4e3b\u952e\u7d22\u5f15\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15</li> <li>\u4e0d\u5b58\u5728\u4e3b\u952e\uff0c\u4f7f\u7528\u7b2c\u4e00\u4e2a\u552f\u4e00\u7d22\u5f15\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15</li> <li>\u65e0\u4e3b\u952e\u548c\u552f\u4e00\u7d22\u5f15\uff0c\u81ea\u52a8\u751f\u6210rowid\u4f5c\u4e3a\u9690\u85cf\u7684\u805a\u7c07\u7d22\u5f15</li> </ul> <p>1.\u805a\u7c07\u7d22\u5f15</p> <ul> <li>\u7279\u70b9\uff1a<ul> <li>InnoDB\u4e3b\u952e\u7d22\u5f15</li> <li>\u6570\u636e\u4e0e\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u8d77</li> <li>\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u5b8c\u6574\u6570\u636e\u9875</li> </ul> </li> <li>\u4f18\u52bf\uff1a<ul> <li>\u51cf\u5c11\u56de\u8868\u64cd\u4f5c</li> <li>\u8303\u56f4\u67e5\u8be2\u9ad8\u6548</li> </ul> </li> </ul> <p>2.\u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u805a\u7c07\u7d22\u5f15\uff09</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u4e3b\u952e\u503c</li> <li>\u9700\u8981\u56de\u8868\u67e5\u8be2</li> </ul> <pre><code>-- \u793a\u4f8b\nselect * from user where id = 10;\n\nselect * from user where name = 'Tom';\n</code></pre> <p>Example</p> <p>\u4ee5\u4e0a\u7684\u7b2c\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u6548\u7387\u66f4\u9ad8\uff0c\u56e0\u4e3aid\u662f\u805a\u7c07\u7d22\u5f15\uff08\u6570\u636e\u4e0e\u7d22\u5f15\u5b58\u653e\u5728\u4e00\u8d77\uff09\uff0c\u67e5\u8be2\u5230id\u5373\u67e5\u8be2\u5230\u6240\u6709\u6570\u636e</p> <p>\u800c\u7b2c\u4e8c\u4e2a\u67e5\u8be2\u9700\u8981\u5148\u6839\u636ename\u7684\u7d22\u5f15\u627e\u5230id\uff0c\u518d\u901a\u8fc7id\u53bb\u67e5\u8be2\u6570\u636e\uff08\u56de\u8868\u67e5\u8be2\uff09</p> <p>\u6309\u903b\u8f91\u529f\u80fd\uff1a</p> <p></p> <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u8bed\u6cd5","title":"\u7d22\u5f15\u8bed\u6cd5","text":"<pre><code>-- \u521b\u5efa\u7d22\u5f15\nCREATE [UNIQUE|FULLTEXT] INDEX index_name ON table_name (index_col_name,...);\n\n-- \u67e5\u770b\u7d22\u5f15\nSHOW INDEX FROM table_name;\n\n-- \u5220\u9664\u7d22\u5f15\nDROP IDNEX index_name ON table_name;\n</code></pre>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#sql\u6027\u80fd\u5206\u6790","title":"SQL\u6027\u80fd\u5206\u6790","text":""},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#sql\u6267\u884c\u9891\u7387","title":"SQL\u6267\u884c\u9891\u7387","text":"<p>\u5224\u65ad\u6570\u636e\u5e93\u8bfb\u591a\u8fd8\u662f\u5199\u591a</p> <pre><code>-- \u67e5\u770b\u589e\u5220\u6539\u9891\u7387\nSHOW GLOBAL STATUS LIKE 'Com_______'\n</code></pre> <p></p> <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u6162\u67e5\u8be2\u65e5\u5fd7","title":"\u6162\u67e5\u8be2\u65e5\u5fd7","text":"<pre><code>-- \u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u662f\u5426\u5f00\u542f\nSHOW VARIABLES LIKE 'slow_query_log'\n</code></pre> <p>\u5728MySQL\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7</p> <pre><code>slow_query_log=1\n\n## \u914d\u7f6e\u6162\u67e5\u8be2\u9608\u503c\nlong_query_time=2\n</code></pre> <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#profile\u5206\u6790","title":"profile\u5206\u6790","text":"<p>profile\u53ef\u4ee5\u8bb0\u5f55SQL\u67e5\u8be2\u7684\u8017\u65f6</p> <pre><code>-- \u4f1a\u8bdd\u7ea7\u522b\u5f00\u542f\nSET profiling = 1;\nSET profiling_history_size = 100;  -- \u8bbe\u7f6e\u4fdd\u7559\u7684profile\u6570\u91cf(\u9ed8\u8ba415)\n\n-- \u5217\u51fa\u6240\u6709\u5df2\u8bb0\u5f55\u7684\u67e5\u8be2\nSHOW PROFILES;\n\n-- \u67e5\u770b\u5177\u4f53\u67e5\u8be2\u7684\u8be6\u7ec6\u8017\u65f6\nSHOW PROFILE FOR QUERY 1;\n\n-- \u67e5\u770b\u7279\u5b9a\u7c7b\u578b\u7684\u8017\u65f6\nSHOW PROFILE CPU, BLOCK IO FOR QUERY 2;\n</code></pre> <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#explain\u6267\u884c\u8ba1\u5212","title":"explain\u6267\u884c\u8ba1\u5212","text":"<p>EXPLAIN \u662fMySQL\u67e5\u8be2\u4f18\u5316\u7684\u6838\u5fc3\u5de5\u5177\uff0c\u901a\u8fc7\u5206\u6790\u6267\u884c\u8ba1\u5212\u53ef\u4ee5\u4e86\u89e3SQL\u8bed\u53e5\u7684\u6267\u884c\u7ec6\u8282</p> <pre><code>-- \u6807\u51c6\u7528\u6cd5\nEXPLAIN SELECT * FROM orders WHERE user_id = 100;\n\n-- \u67e5\u770b\u683c\u5f0f\u5316\u7ed3\u679c\uff08MySQL 8.0+\uff09\nEXPLAIN FORMAT=JSON SELECT * FROM products WHERE price &gt; 100;\n\n-- \u7528\u4e8e\u8fde\u63a5\u67e5\u8be2\u5206\u6790\nEXPLAIN SELECT o.* FROM orders o JOIN users u ON o.user_id = u.id WHERE u.age &gt; 30;\n</code></pre> <p>explain\u67e5\u8be2\u6838\u5fc3\u5b57\u6bb5\u89e3\u8bfb</p> <ul> <li>id\uff08\u67e5\u8be2\u987a\u5e8f\uff09<ul> <li>\u76f8\u540cid\u6309\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c</li> <li>\u4e0d\u540cid\uff0c\u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8</li> </ul> </li> <li>select_type\uff08\u67e5\u8be2\u7c7b\u578b\uff09</li> </ul> \u7c7b\u578b \u8bf4\u660e \u51fa\u73b0\u573a\u666f SIMPLE \u7b80\u5355\u67e5\u8be2 \u4e0d\u542b\u5b50\u67e5\u8be2\u6216UNION PRIMARY \u5916\u5c42\u67e5\u8be2 \u590d\u6742\u67e5\u8be2\u7684\u6700\u5916\u5c42 SUBQUERY \u5b50\u67e5\u8be2 WHERE\u4e2d\u7684\u5b50\u67e5\u8be2 DERIVED \u6d3e\u751f\u8868 FROM\u5b50\u53e5\u4e2d\u7684\u5b50\u67e5\u8be2 UNION UNION\u7b2c\u4e8c\u4e2a\u53ca\u4ee5\u540e\u7684SELECT UNION\u67e5\u8be2 UNION RESULT UNION\u7ed3\u679c UNION\u5408\u5e76\u7ed3\u679c <ul> <li>type\uff08\u8bbf\u95ee\u7c7b\u578b\uff0c\u5173\u952e\u6307\u6807\uff09\uff0c\u4ece\u4e0a\u5230\u4e0b\u6027\u80fd\u4f9d\u6b21\u964d\u4f4e<ul> <li>system\uff1a\u7cfb\u7edf\u8868\uff0c\u53ea\u6709\u4e00\u884c\u6570\u636e</li> <li>const\uff1a\u901a\u8fc7\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u67e5\u627e</li> <li>eq_ref\uff1a\u5173\u8054\u67e5\u8be2\u4e2d\u4f7f\u7528\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15</li> <li>ref\uff1a\u4f7f\u7528\u975e\u552f\u4e00\u7d22\u5f15\u67e5\u627e</li> <li>range\uff1a\u7d22\u5f15\u8303\u56f4\u626b\u63cf</li> <li>index\uff1a\u5168\u7d22\u5f15\u626b\u63cf</li> <li>ALL\uff1a\u5168\u8868\u626b\u63cf\uff08\u9700\u4f18\u5316\uff09</li> </ul> </li> <li>possible_keys &amp; key ----&gt; \u53ef\u80fd\u4f7f\u7528\u7684\u7d22\u5f15&amp;\u5b9e\u9645\u4f7f\u7528\u7684\u7d22\u5f15</li> <li>rows (\u9884\u4f30\u626b\u63cf\u884c\u6570)</li> </ul> <p></p>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u4f7f\u7528","title":"\u7d22\u5f15\u4f7f\u7528","text":""},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u6700\u5de6\u524d\u7f00\u6cd5\u5219","title":"\u6700\u5de6\u524d\u7f00\u6cd5\u5219","text":"<p>\u6700\u5de6\u524d\u7f00\u539f\u5219(Leftmost Prefix Principle)\u662fMySQL\u8054\u5408\u7d22\u5f15\u4f7f\u7528\u7684\u6838\u5fc3\u89c4\u5219\uff0c\u51b3\u5b9a\u4e86\u67e5\u8be2\u80fd\u5426\u6709\u6548\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u4f18\u5316\u3002</p> <ol> <li>\u5b9a\u4e49\uff1a\u5f53\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u5fc5\u987b\u4ece\u7d22\u5f15\u7684\u6700\u5de6\u4fa7\u5217\u5f00\u59cb\uff0c\u4e14\u4e0d\u80fd\u8df3\u8fc7\u4e2d\u95f4\u7684\u5217\uff0c\u5426\u5219\u7d22\u5f15\u5c06\u65e0\u6cd5\u5b8c\u5168\u751f\u6548</li> <li>\u5e95\u5c42\u673a\u5236\uff1a<ul> <li>\u8054\u5408\u7d22\u5f15\u5728B+\u6811\u4e2d\u6309\u7167\u5b9a\u4e49\u987a\u5e8f\u6392\u5e8f\u5b58\u50a8</li> <li>\u6570\u636e\u5148\u6309\u7b2c\u4e00\u5217\u6392\u5e8f\uff0c\u7b2c\u4e00\u5217\u76f8\u540c\u518d\u6309\u7b2c\u4e8c\u5217\u6392\u5e8f\uff0c\u4f9d\u6b64\u7c7b\u63a8</li> <li>\u7c7b\u4f3c\u4e8e\u5b57\u5178\u7684\u5b57\u6bcd\u6392\u5e8f\uff1a\u5148\u6309\u9996\u5b57\u6bcd\u6392\u5e8f\uff0c\u9996\u5b57\u6bcd\u76f8\u540c\u518d\u6309\u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u6392\u5e8f</li> </ul> </li> </ol> <p>\u4ee5\u8054\u5408\u7d22\u5f15(A,B,C)\u4e3a\u4f8b\uff1a</p> <pre><code>WHERE A = 1                          \u2705 \u4f7f\u7528A\u5217\u7d22\u5f15\nWHERE A = 1 AND B = 2                \u2705 \u4f7f\u7528A,B\u5217\u7d22\u5f15\nWHERE A = 1 AND B = 2 AND C = 3      \u2705 \u4f7f\u7528A,B,C\u5168\u7d22\u5f15\nWHERE A = 1 AND C = 3                \u26a0\ufe0f \u4ec5\u4f7f\u7528A\u5217\u7d22\u5f15(C\u5217\u65e0\u6cd5\u4f7f\u7528)\nWHERE B = 2                          \u274c \u4e0d\u6ee1\u8db3\u6700\u5de6\u539f\u5219\nWHERE B = 2 AND C = 3                \u274c \u8df3\u8fc7A\u5217\nWHERE A = 1 AND C = 3                \u274c \u8df3\u8fc7B\u5217(C\u5217\u65e0\u6cd5\u4f7f\u7528)\n</code></pre>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u8303\u56f4\u67e5\u8be2","title":"\u8303\u56f4\u67e5\u8be2","text":"<ul> <li>\u8303\u56f4\u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\uff0c\u4f46\u4f1a\u4e2d\u65ad\u540e\u7eed\u7d22\u5f15\u5217\u7684\u4f7f\u7528\uff08\u6700\u5de6\u524d\u7f00\u539f\u5219\uff09</li> <li>\u793a\u4f8b\uff1a\u5bf9\u4e8e\u7d22\u5f15<code>(A,B,C)</code>\uff0c\u67e5\u8be2<code>WHERE A&gt;1 AND B=2</code>\u53ea\u80fd\u4f7f\u7528A\u5217\u7d22\u5f15</li> </ul>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u5217\u8ba1\u7b97","title":"\u7d22\u5f15\u5217\u8ba1\u7b97","text":"<p>\u67e5\u8be2\u65f6\u5728\u7d22\u5f15\u5217\u4e0a\u8fdb\u884c\u8fd0\u7b97\u64cd\u4f5c\uff0c\u5c06\u4f7f\u7d22\u5f15\u5931\u6548</p> <pre><code>-- \u5047\u8bbe\u5728create_time\u4e0a\u5efa\u7acb\u4e86\u7d22\u5f15\n\n-- \u53cd\u4f8b\uff08\u7d22\u5f15\u5931\u6548\uff09\nSELECT * FROM users WHERE YEAR(create_time)=2024;\n\n-- \u6b63\u4f8b\uff08\u4f7f\u7528\u7d22\u5f15\uff09\nSELECT * FROM users WHERE create_time BETWEEN '2024-01-01' AND '2024-12-31';\n</code></pre>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u5b57\u7b26\u4e32\u4e0d\u52a0\u5f15\u53f7","title":"\u5b57\u7b26\u4e32\u4e0d\u52a0\u5f15\u53f7","text":"<p>\u5728MySQL\u4e2d\uff0c\u5b57\u7b26\u4e32\u7c7b\u578b\u5b57\u6bb5\u5728\u67e5\u8be2\u65f6\u5fc5\u987b\u52a0\u5f15\u53f7\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u548c\u6027\u80fd\u95ee\u9898\u3002</p> <ul> <li>\u5b57\u7b26\u4e32\u4e0d\u52a0\u5f15\u53f7\u4f1a\u89e6\u53d1\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548</li> <li>\u6d4b\u8bd5\u6848\u4f8b\u663e\u793a\u6027\u80fd\u5dee\u5f02\u53ef\u8fbe100\u500d</li> </ul> <pre><code>-- \u4e0d\u52a0\u5f15\u53f7\uff08\u7d22\u5f15\u5931\u6548\uff0c\u8017\u65f62.76\u79d2\uff09\nSELECT * FROM member_phone WHERE phone = 1521234541;\n\n-- \u52a0\u5f15\u53f7\uff08\u4f7f\u7528\u7d22\u5f15\uff0c\u8017\u65f60.01\u79d2\uff09\nSELECT * FROM member_phone WHERE phone = '1521234541';\n</code></pre> <p>\u6267\u884c\u8ba1\u5212\u5dee\u5f02\uff1a</p> <ul> <li>\u52a0\u5f15\u53f7\u65f6<code>EXPLAIN</code>\u663e\u793a<code>type=range</code>\uff08\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff09</li> <li>\u4e0d\u52a0\u5f15\u53f7\u663e\u793a<code>type=index</code>\uff08\u5168\u7d22\u5f15\u626b\u63cf\uff0c\u6027\u80fd\u63a5\u8fd1\u5168\u8868\u626b\u63cf\uff09</li> </ul>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u6a21\u7cca\u67e5\u8be2","title":"\u6a21\u7cca\u67e5\u8be2","text":"<p>\u524d\u7f00\u6a21\u7cca\u4f1a\u4f7f\u7d22\u5f15\u5931\u6548</p> <p>\u901a\u914d\u7b26\u4f4d\u7f6e\u539f\u5219</p> <ul> <li>\u63a8\u8350\uff1a<code>LIKE 'abc%'</code>\uff08\u4f7f\u7528\u7d22\u5f15\uff09</li> <li>\u907f\u514d\uff1a<code>LIKE '%abc'</code>\u6216<code>LIKE '%abc%'</code>\uff08\u5168\u8868\u626b\u63cf\uff09</li> </ul>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#or\u6761\u4ef6\u5b58\u5728\u975e\u7d22\u5f15\u5b57\u6bb5","title":"or\u6761\u4ef6\u5b58\u5728\u975e\u7d22\u5f15\u5b57\u6bb5","text":"<p>\u5f53SQL\u67e5\u8be2\u4e2d\u7684OR\u6761\u4ef6\u5305\u542b\u975e\u7d22\u5f15\u5b57\u6bb5\u65f6\uff0c\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898</p> <ol> <li>\u7d22\u5f15\u5931\u6548\u673a\u5236\uff1a\u5f53OR\u6761\u4ef6\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u6bb5\u65e0\u7d22\u5f15\u65f6\uff0cMySQL\u901a\u5e38\u4f1a\u653e\u5f03\u4f7f\u7528\u7d22\u5f15\u800c\u8f6c\u4e3a\u5168\u8868\u626b\u63cf</li> <li>\u6267\u884c\u8ba1\u5212\u8868\u73b0\uff1a\u901a\u8fc7EXPLAIN\u53ef\u89c1<code>type=ALL</code>\uff08\u5168\u8868\u626b\u63cf\uff09\u4e14<code>key=NULL</code>\uff08\u672a\u4f7f\u7528\u7d22\u5f15\uff09</li> </ol> <pre><code>-- \u53cd\u4f8b\uff08department_id\u6709\u7d22\u5f15\uff0cname\u65e0\u7d22\u5f15\uff09\nSELECT * FROM employees WHERE department_id = 1 OR name = 'Alice';\n</code></pre>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#sql\u63d0\u793a","title":"SQL\u63d0\u793a","text":"<p>\u5728SQL\u67e5\u8be2\u4f18\u5316\u4e2d\uff0c\u63d0\u793a\uff08Hints\uff09\u662f\u6307\u5bfc\u6570\u636e\u5e93\u4f18\u5316\u5668\u6267\u884c\u8ba1\u5212\u7684\u91cd\u8981\u5de5\u5177\u3002</p> <ul> <li><code>USE INDEX</code>\uff1a\u63d0\u793a\u4f7f\u7528\u7279\u5b9a\u7d22\u5f15</li> </ul> <pre><code>SELECT * FROM users USE INDEX(idx_email) WHERE email LIKE 'a%';\n</code></pre> <ul> <li><code>FORCE INDEX</code>\uff1a\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7d22\u5f15</li> <li><code>IGNORE INDEX</code>\uff1a\u6392\u9664\u4f4e\u6548\u7d22\u5f15</li> </ul>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u8986\u76d6\u7d22\u5f15","title":"\u8986\u76d6\u7d22\u5f15","text":"<p>\u8986\u76d6\u7d22\u5f15\uff08Covering Index\uff09\u662fMySQL\u67e5\u8be2\u4f18\u5316\u7684\u9ad8\u7ea7\u6280\u672f\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u3002</p> <ol> <li> <p>\u5b9a\u4e49\uff1a\u5f53\u7d22\u5f15\u5305\u542b\u67e5\u8be2\u6240\u9700\u7684\u6240\u6709\u5b57\u6bb5\u65f6\uff0c\u5f15\u64ce\u65e0\u9700\u56de\u8868\u5373\u53ef\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c</p> </li> <li> <p>\u4f18\u52bf\uff1a</p> </li> <li> <p>\u51cf\u5c11I/O\u64cd\u4f5c\uff08\u907f\u514d\u8bbf\u95ee\u6570\u636e\u6587\u4ef6\uff09</p> </li> <li>\u51cf\u5c11CPU\u8ba1\u7b97\uff08\u907f\u514d\u89e3\u6790\u6570\u636e\u884c\uff09</li> <li> <p>\u63d0\u5347\u7f13\u5b58\u6548\u7387\uff08\u7d22\u5f15\u901a\u5e38\u6bd4\u6570\u636e\u5c0f\uff09</p> </li> <li> <p>\u7d22\u5f15\u5fc5\u987b\u5305\u542b\uff1a</p> </li> <li> <p>WHERE\u6761\u4ef6\u4e2d\u7684\u5217</p> </li> <li>ORDER BY/GROUP BY\u4e2d\u7684\u5217</li> <li> <p>SELECT\u9700\u8981\u7684\u6240\u6709\u5217</p> </li> <li> <p>\u9a8c\u8bc1\u65b9\u6cd5\uff1a</p> </li> </ol> <pre><code>EXPLAIN SELECT user_id, username FROM users WHERE age &gt; 20;\n-- Extra\u5217\u663e\u793a\"Using index\"\u5373\u8868\u793a\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\n</code></pre>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u524d\u7f00\u7d22\u5f15","title":"\u524d\u7f00\u7d22\u5f15","text":"<p>\u524d\u7f00\u7d22\u5f15\uff08Prefix Index\uff09\u662f\u9488\u5bf9\u5b57\u7b26\u4e32\u5217\u7684\u4e00\u79cd\u7279\u6b8a\u7d22\u5f15\u4f18\u5316\u6280\u672f\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5904\u7406\u957f\u6587\u672c\u5b57\u6bb5\u7684\u7d22\u5f15\u9700\u6c42\u3002</p> <ol> <li>\u5b9a\u4e49\uff1a\u53ea\u5bf9\u5217\u503c\u7684\u524dN\u4e2a\u5b57\u7b26\u5efa\u7acb\u7d22\u5f15\uff0c\u800c\u975e\u6574\u4e2a\u5b57\u6bb5</li> <li> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>VARCHAR/TEXT\u7b49\u957f\u5b57\u7b26\u4e32\u5b57\u6bb5</li> <li>\u524dN\u4e2a\u5b57\u7b26\u533a\u5206\u5ea6\u8db3\u591f\u9ad8\u7684\u5217</li> <li>\u5b58\u50a8\u7a7a\u95f4\u53d7\u9650\u7684\u73af\u5883</li> </ul> <pre><code>-- \u521b\u5efa\u524d\u7f00\u7d22\u5f15\nCREATE INDEX index_name ON table_name(column(n));\n</code></pre> </li> <li> <p>\u524d\u7f00\u957f\u5ea6\uff1a</p> <pre><code>-- \u8ba1\u7b97\u4e0d\u540c\u524d\u7f00\u957f\u5ea6\u7684\u533a\u5206\u5ea6\nSELECT \nCOUNT(DISTINCT LEFT(column_name, 5))/COUNT(*) AS selectivity5,\nCOUNT(DISTINCT LEFT(column_name, 10))/COUNT(*) AS selectivity10,\nCOUNT(DISTINCT LEFT(column_name, 15))/COUNT(*) AS selectivity15\nFROM table_name;\n-- \u533a\u5206\u5ea6\u8d8a\u63a5\u8fd1\u4e8e1\u67e5\u8be2\u6027\u80fd\u8d8a\u597d\uff0c\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\n</code></pre> </li> <li> <p>\u957f\u5ea6\u9009\u62e9\u539f\u5219\uff1a</p> <ul> <li>\u4fdd\u8bc1\u9009\u62e9\u6027 &gt; 90%</li> <li>\u5e73\u8861\u5b58\u50a8\u8282\u7701\u548c\u67e5\u8be2\u6548\u7387</li> <li>\u5178\u578b\u573a\u666f\uff1a<ul> <li>\u90ae\u7bb1\uff1a\u524d10-15\u5b57\u7b26</li> <li>URL\uff1a\u524d20-30\u5b57\u7b26</li> <li>\u59d3\u540d\uff1a\u524d3-5\u5b57\u7b26\uff08\u4e2d\u6587\uff09</li> </ul> </li> </ul> </li> </ol>"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u5355\u5217\u7d22\u5f15\u548c\u8054\u5408\u7d22\u5f15","title":"\u5355\u5217\u7d22\u5f15\u548c\u8054\u5408\u7d22\u5f15","text":"\u6bd4\u8f83\u7ef4\u5ea6 \u5355\u5217\u7d22\u5f15 \u8054\u5408\u7d22\u5f15 \u7d22\u5f15\u6570\u91cf \u9700\u8981\u591a\u4e2a\u7d22\u5f15 \u4e00\u4e2a\u7d22\u5f15\u8986\u76d6\u591a\u5217 \u5b58\u50a8\u5f00\u9500 \u603b\u4f53\u8f83\u5927\uff08\u6bcf\u5217\u5355\u72ec\u5b58\u50a8\uff09 \u8f83\u5c0f\uff08\u5217\u503c\u7ec4\u5408\u5b58\u50a8\uff09 \u67e5\u8be2\u6027\u80fd \u5355\u6761\u4ef6\u67e5\u8be2\u5feb \u591a\u6761\u4ef6\u67e5\u8be2\u5feb \u5199\u5165\u6027\u80fd \u7ef4\u62a4\u6210\u672c\u9ad8\uff08\u9700\u66f4\u65b0\u591a\u4e2a\u7d22\u5f15\uff09 \u7ef4\u62a4\u6210\u672c\u76f8\u5bf9\u4f4e \u6392\u5e8f\u4f18\u5316 \u53ea\u80fd\u4f18\u5316\u5355\u5217\u6392\u5e8f \u53ef\u4f18\u5316\u591a\u5217\u7ec4\u5408\u6392\u5e8f \u7d22\u5f15\u8986\u76d6 \u96be\u4ee5\u5b9e\u73b0 \u66f4\u5bb9\u6613\u5b9e\u73b0\u8986\u76d6\u7d22\u5f15"},{"location":"MySQL/%E7%B4%A2%E5%BC%95/#\u7d22\u5f15\u8bbe\u8ba1\u539f\u5219","title":"\u7d22\u5f15\u8bbe\u8ba1\u539f\u5219","text":"<ol> <li>\u9488\u5bf9\u4e8e\u6570\u636e\u91cf\u8f83\u5927\uff0c\u4e14\u67e5\u8be2\u6bd4\u8f83\u9891\u7e41\u7684\u8868\u5efa\u7acb\u7d22\u5f15\u3002 </li> <li>\u9488\u5bf9\u4e8e\u5e38\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6\uff08where\uff09\u3001\u6392\u5e8f\uff08order by\uff09\u3001\u5206\u7ec4\uff08group by\uff09\u64cd\u4f5c\u7684\u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u3002 </li> <li>\u5c3d\u91cf\u9009\u62e9\u533a\u5206\u5ea6\u9ad8\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5c3d\u91cf\u5efa\u7acb\u552f\u4e00\u7d22\u5f15\uff0c\u533a\u5206\u5ea6\u8d8a\u9ad8\uff0c\u4f7f\u7528\u7d22\u5f15\u7684\u6548\u7387\u8d8a\u9ad8\u3002 </li> <li>\u5982\u679c\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u5b57\u6bb5\u7684\u957f\u5ea6\u8f83\u957f\uff0c\u53ef\u4ee5\u9488\u5bf9\u4e8e\u5b57\u6bb5\u7684\u7279\u70b9\uff0c\u5efa\u7acb\u524d\u7f00\u7d22\u5f15\u3002</li> <li>\u5c3d\u91cf\u4f7f\u7528\u8054\u5408\u7d22\u5f15\uff0c\u51cf\u5c11\u5355\u5217\u7d22\u5f15\uff0c\u67e5\u8be2\u65f6\uff0c\u8054\u5408\u7d22\u5f15\u5f88\u591a\u65f6\u5019\u53ef\u4ee5\u8986\u76d6\u7d22\u5f15\uff0c\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\uff0c\u907f\u514d\u56de\u8868\uff0c\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u3002 </li> <li>\u8981\u63a7\u5236\u7d22\u5f15\u7684\u6570\u91cf\uff0c\u7d22\u5f15\u5e76\u4e0d\u662f\u591a\u591a\u76ca\u5584\uff0c\u7d22\u5f15\u8d8a\u591a\uff0c\u7ef4\u62a4\u7d22\u5f15\u7ed3\u6784\u7684\u4ee3\u4ef7\u4e5f\u5c31\u8d8a\u5927\uff0c\u4f1a\u5f71\u54cd\u589e\u5220\u6539\u7684\u6548\u7387\u3002</li> <li>\u5982\u679c\u7d22\u5f15\u5217\u4e0d\u80fd\u5b58\u50a8NULL\u503c\uff0c\u8bf7\u5728\u521b\u5efa\u8868\u65f6\u4f7f\u7528NOT NULL\u7ea6\u675f\u5b83\u3002\u5f53\u4f18\u5316\u5668\u77e5\u9053\u6bcf\u5217\u662f\u5426\u5305\u542bNULL\u503c\u65f6\uff0c\u5b83\u53ef\u4ee5\u66f4\u597d\u5730\u786e\u5b9a\u54ea\u4e2a\u7d22\u5f15\u6700\u6709\u6548\u5730\u7528\u4e8e\u67e5\u8be2</li> </ol> <p>\u53c2\u8003AI\u751f\u6210\u7684\u7d22\u5f15\u8bbe\u8ba1\u539f\u5219\u603b\u7ed3</p> <p>MySQL\u7d22\u5f15\u8bbe\u8ba1\u6838\u5fc3\u539f\u5219</p> <p>\u4e00\u3001\u57fa\u7840\u8bbe\u8ba1\u539f\u5219</p> <ol> <li> <p>\u9009\u62e9\u6027\u4f18\u5148\u539f\u5219</p> <p>\u2022 \u9ad8\u9009\u62e9\u6027\u5217\u4f18\u5148\uff1a\u9009\u62e9\u533a\u5206\u5ea6\u9ad8\u7684\u5217\u5efa\u7acb\u7d22\u5f15\uff08\u533a\u5206\u5ea6=\u4e0d\u91cd\u590d\u503c/\u603b\u884c\u6570\uff09</p> <p><pre><code>-- \u8ba1\u7b97\u5217\u7684\u9009\u62e9\u6027\nSELECT COUNT(DISTINCT status)/COUNT(*) FROM orders; -- \u4f4e\u4e8e0.1\u5219\u4e0d\u9002\u5408\u5355\u72ec\u5efa\u7d22\u5f15\n</code></pre> \u200b\u2022 \u907f\u514d\u4f4e\u6548\u7d22\u5f15\uff1a\u6027\u522b\u3001\u72b6\u6001\u6807\u5fd7\u7b49\u4f4e\u533a\u5206\u5ea6\u5b57\u6bb5\u4e0d\u5e94\u5355\u72ec\u5efa\u7d22\u5f15</p> </li> <li> <p>\u6700\u5de6\u524d\u7f00\u5339\u914d\u539f\u5219</p> <p>\u2022 \u8054\u5408\u7d22\u5f15\u5217\u987a\u5e8f\uff1a</p> <pre><code>\u200b\u2022 \u7b2c\u4e00\u539f\u5219\uff1a\u9ad8\u9891\u67e5\u8be2\u6761\u4ef6\u653e\u5de6\u4fa7\n\n\u200b\u2022 \u7b2c\u4e8c\u539f\u5219\uff1a\u9ad8\u533a\u5206\u5ea6\u5217\u4f18\u5148\n\n\u200b\u2022 \u7b2c\u4e09\u539f\u5219\uff1a\u7b49\u503c\u67e5\u8be2\u5217\u4f18\u5148\u4e8e\u8303\u56f4\u67e5\u8be2\u5217\n</code></pre> <p>\u2022 \u793a\u4f8b\uff1a</p> <pre><code>/* \u6b63\u786e\u987a\u5e8f\uff1acountry(\u9ad8\u9891+\u9ad8\u533a\u5206) &gt; city &gt; age(\u8303\u56f4\u67e5\u8be2) */\nCREATE INDEX idx_loc_age ON users(country, city, age);\n</code></pre> </li> </ol> <p>\u4e8c\u3001\u9ad8\u7ea7\u4f18\u5316\u539f\u5219</p> <ol> <li> <p>\u8986\u76d6\u7d22\u5f15\u539f\u5219</p> <p>\u2022 \u7d22\u5f15\u5305\u542b\uff1aSELECT\u3001WHERE\u3001ORDER BY\u3001GROUP BY\u6d89\u53ca\u7684\u6240\u6709\u5217</p> <pre><code>\u200b\u2022 \u4f18\u52bf\uff1a\u907f\u514d\u56de\u8868\u64cd\u4f5c\uff0c\u63d0\u53475-10\u500d\u6027\u80fd\n\n\u200b\u2022 \u793a\u4f8b\uff1a\n\n```sql\n/* \u8986\u76d6\u7d22\u5f15\u4f18\u5316 */\nCREATE INDEX idx_cover ON orders(user_id, status, amount);\nSELECT user_id, amount FROM orders WHERE user_id=100 AND status=1;\n```\n</code></pre> </li> <li> <p>\u4e09\u661f\u7d22\u5f15\u539f\u5219</p> <ol> <li>\u7b2c\u4e00\u9897\u661f\uff1aWHERE\u6761\u4ef6\u5339\u914d\u7d22\u5f15\u5217\uff08\u5feb\u901f\u5b9a\u4f4d\uff09</li> <li>\u7b2c\u4e8c\u9897\u661f\uff1aORDER BY/GROUP BY\u5339\u914d\u7d22\u5f15\u987a\u5e8f\uff08\u907f\u514d\u6392\u5e8f\uff09</li> <li>\u7b2c\u4e09\u9897\u661f\uff1aSELECT\u5217\u88ab\u7d22\u5f15\u8986\u76d6\uff08\u907f\u514d\u56de\u8868\uff09</li> </ol> <p>\u5b8c\u7f8e\u7d22\u5f15\u793a\u4f8b\uff1a <pre><code>-- \u67e5\u8be2\uff1aSELECT user_name FROM users WHERE age&gt;20 AND city='\u5317\u4eac' ORDER BY reg_date\nCREATE INDEX idx_3star ON users(city, age, reg_date, user_name);\n</code></pre></p> </li> </ol> <p>\u4e09\u3001\u6027\u80fd\u6743\u8861\u539f\u5219</p> <ol> <li> <p>\u8bfb\u5199\u5e73\u8861\u539f\u5219</p> \u64cd\u4f5c \u7d22\u5f15\u5f71\u54cd \u4f18\u5316\u5efa\u8bae SELECT \u663e\u8457\u63d0\u5347 \u4f18\u5148\u8003\u8651 INSERT \u964d\u4f4e\u6027\u80fd \u63a7\u5236\u7d22\u5f15\u6570\u91cf UPDATE \u53ef\u80fd\u964d\u4f4e \u907f\u514d\u66f4\u65b0\u7d22\u5f15\u5217 DELETE \u5f71\u54cd\u8f83\u5c0f \u53ef\u63a5\u53d7 <p>\u2022 \u5efa\u8bae\uff1a\u5355\u8868\u7d22\u5f15\u4e0d\u8d85\u8fc75-6\u4e2a\uff0c\u603b\u7d22\u5f15\u957f\u5ea6\u4e0d\u8d85\u8fc7\u8868\u5927\u5c0f\u768450%</p> </li> <li> <p>\u7d22\u5f15\u7cbe\u7b80\u539f\u5219     \u2022 \u907f\u514d\u5197\u4f59\uff1a</p> <p><pre><code>/* \u5197\u4f59\u7d22\u5f15\u793a\u4f8b */\nINDEX(a), INDEX(a,b)  -- \u540e\u8005\u53ef\u66ff\u4ee3\u524d\u8005\n</code></pre> \u200b\u2022 \u4f7f\u7528\u5de5\u5177\u68c0\u6d4b\uff1a</p> <pre><code>SELECT * FROM sys.schema_redundant_indexes;\n</code></pre> </li> </ol> <p>\u56db\u3001\u7279\u6b8a\u573a\u666f\u539f\u5219</p> <ol> <li> <p>\u524d\u7f00\u7d22\u5f15\u4f18\u5316</p> <p>\u2022 \u9002\u7528\u573a\u666f\uff1a\u957f\u5b57\u7b26\u4e32\u5b57\u6bb5\uff08VARCHAR(255)+\u3001TEXT\uff09</p> <p>\u200b   \u2022 \u957f\u5ea6\u9009\u62e9\uff1a</p> <p><pre><code>-- \u8ba1\u7b97\u6700\u4f18\u524d\u7f00\u957f\u5ea6\uff08\u4fdd\u8bc1\u9009\u62e9\u6027&gt;90%\uff09\nSELECT \n    COUNT(DISTINCT LEFT(title,10))/COUNT(*) AS sel10,\n    COUNT(DISTINCT LEFT(title,20))/COUNT(*) AS sel20\nFROM articles;\n</code></pre> \u200b   \u2022 \u793a\u4f8b\uff1a</p> <pre><code>CREATE INDEX idx_title ON articles(title(15));\n</code></pre> </li> <li> <p>\u51fd\u6570\u7d22\u5f15\u7b56\u7565\uff08MySQL 8.0+\uff09     \u2022 \u9002\u7528\u573a\u666f\uff1a\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u5b57\u6bb5\u4f46\u53ef\u51fd\u6570\u8f6c\u6362</p> <p>\u200b   \u2022 \u793a\u4f8b\uff1a</p> <pre><code>-- \u65e5\u671f\u67e5\u8be2\u4f18\u5316\nCREATE INDEX idx_month ON sales((MONTH(create_time)));\nSELECT * FROM sales WHERE MONTH(create_time)=12;\n</code></pre> </li> </ol> <p>\u4e94\u3001\u751f\u4ea7\u5b9e\u8df5\u68c0\u67e5\u6e05\u5355</p> <ol> <li>\u6240\u6709\u5916\u952e\u662f\u5426\u5df2\u5efa\u7acb\u7d22\u5f15</li> <li>\u9ad8\u9891\u67e5\u8be2\u6761\u4ef6\u662f\u5426\u88ab\u7d22\u5f15\u8986\u76d6</li> <li> <p>\u8054\u5408\u7d22\u5f15\u662f\u5426\u9075\u5faaARC\u539f\u5219\uff1a     \u2022 Access frequency\uff08\u8bbf\u95ee\u9891\u7387\uff09</p> <p>\u2022 Range column position\uff08\u8303\u56f4\u5217\u4f4d\u7f6e\uff09</p> <p>\u2022 Cardinality\uff08\u533a\u5206\u5ea6\uff09</p> </li> <li> <p>\u662f\u5426\u5b9a\u671f\u5206\u6790\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5     <pre><code>ANALYZE TABLE orders;\nSELECT * FROM sys.schema_unused_indexes;\n</code></pre></p> </li> <li>\u662f\u5426\u907f\u514d\u5728\u7d22\u5f15\u5217\u4e0a\u4f7f\u7528\u51fd\u6570</li> </ol> <p>\u516d\u3001\u7d22\u5f15\u8bbe\u8ba1\u6d41\u7a0b\u56fe <pre><code>graph TD\n    A[\u5206\u6790SQL\u5de5\u4f5c\u8d1f\u8f7d] --&gt; B[\u8bc6\u522b\u9ad8\u9891\u67e5\u8be2]\n    B --&gt; C[\u786e\u5b9a\u67e5\u8be2\u6761\u4ef6\u5217]\n    C --&gt; D{\u5355\u5217 or \u8054\u5408}\n    D --&gt;|\u9ad8\u533a\u5206\u5ea6\u5355\u67e5| E[\u521b\u5efa\u5355\u5217\u7d22\u5f15]\n    D --&gt;|\u591a\u6761\u4ef6\u7ec4\u5408| F[\u8bbe\u8ba1\u8054\u5408\u7d22\u5f15]\n    F --&gt; G[\u6309ARC\u539f\u5219\u6392\u5e8f]\n    G --&gt; H[\u9a8c\u8bc1\u8986\u76d6\u7d22\u5f15]\n    H --&gt; I[\u68c0\u67e5\u4e09\u661f\u8bc4\u7ea7]\n    I --&gt; J[\u6027\u80fd\u6d4b\u8bd5]\n    J --&gt; K[\u76d1\u63a7\u8c03\u6574]\n</code></pre></p> <p>\u901a\u8fc7\u9075\u5faa\u8fd9\u4e9b\u539f\u5219\uff0c\u53ef\u4f7f\u7d22\u5f15\u6548\u7387\u63d0\u53473-10\u500d\u3002\u5efa\u8bae\u6bcf\u5b63\u5ea6\u4f7f\u7528<code>pt-index-usage</code>\u5de5\u5177\u8fdb\u884c\u7d22\u5f15\u4f7f\u7528\u7387\u5206\u6790\uff0c\u53ca\u65f6\u6e05\u7406\u65e0\u6548\u7d22\u5f15\u3002</p>"},{"location":"MySQL/%E8%A7%86%E5%9B%BE/","title":"\u89c6\u56fe","text":""},{"location":"MySQL/%E8%A7%86%E5%9B%BE/#\u5b9a\u4e49","title":"\u5b9a\u4e49","text":"<p>\u89c6\u56fe\uff08View\uff09\u662f\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u865a\u62df\u8868\uff0c\u5b83\u57fa\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u9645\u8868\uff08\u6216\u5176\u5b83\u89c6\u56fe\uff09\u7684\u67e5\u8be2\u7ed3\u679c\u6784\u5efa\u3002\u89c6\u56fe\u672c\u8eab\u4e0d\u5b58\u50a8\u6570\u636e\uff0c\u800c\u662f\u4fdd\u5b58\u4e86\u67e5\u8be2\u5b9a\u4e49\uff08SQL\u8bed\u53e5\uff09\u3002</p> <pre><code>-- \u521b\u5efa\u89c6\u56fe\nCREATE VIEW  \u89c6\u56fe\u540d[(\u5217\u540d\u5217\u8868)]   AS   SELECT\u8bed\u53e5   [ WITH [ \nCASCADED  |  LOCAL ]  CHECK  OPTION ]\n\n-- \u67e5\u770b\u89c6\u56fe\nSHOW CREATE VIEW \u89c6\u56fe\u540d\u79f0\n\n-- \u67e5\u8be2\u89c6\u56fe\uff0c\u540c\u67e5\u8be2\u8868\nSELECT * FROM\u3000\u89c6\u56fe\u540d\u79f0\n\n-- \u4fee\u6539\u89c6\u56fe\nCREATE OR REPLACE VIEW \u89c6\u56fe\u540d AS SELECT\u8bed\u53e5\nALTER VIEW \u89c6\u56fe\u540d AS SELECT\u8bed\u53e5\n\n-- \u5220\u9664\u89c6\u56fe\nDROP VIEW \u89c6\u56fe\u540d\n</code></pre> <p></p>"},{"location":"MySQL/%E8%A7%86%E5%9B%BE/#\u68c0\u67e5\u9009\u9879","title":"\u68c0\u67e5\u9009\u9879","text":"<p><code>WITH CHECK OPTION</code> \u662f\u521b\u5efa\u89c6\u56fe\u65f6\u7684\u4e00\u4e2a\u91cd\u8981\u9009\u9879\uff0c\u5b83\u7528\u4e8e\u786e\u4fdd\u901a\u8fc7\u89c6\u56fe\u6267\u884c\u7684\u6570\u636e\u4fee\u6539\u64cd\u4f5c\uff08INSERT/UPDATE\uff09\u5fc5\u987b\u6ee1\u8db3\u89c6\u56fe\u5b9a\u4e49\u7684\u7b5b\u9009\u6761\u4ef6\u3002</p> <p>\u5f53\u5728\u89c6\u56fe\u5b9a\u4e49\u4e2d\u4f7f\u7528 <code>WITH CHECK OPTION</code> \u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u5f3a\u5236\uff1a</p> <ol> <li>\u6240\u6709\u901a\u8fc7\u89c6\u56fe\u63d2\u5165\u7684\u6570\u636e\u5fc5\u987b\u6ee1\u8db3\u89c6\u56fe\u7684 WHERE \u6761\u4ef6</li> <li>\u6240\u6709\u901a\u8fc7\u89c6\u56fe\u66f4\u65b0\u7684\u6570\u636e\u5728\u66f4\u65b0\u540e\u5fc5\u987b\u4ecd\u7136\u6ee1\u8db3\u89c6\u56fe\u7684 WHERE \u6761\u4ef6</li> </ol> <p>CHECK OPTION\u4e24\u79cd\u6a21\u5f0f</p> <ol> <li> <p>CASCADED\uff08\u7ea7\u8054\u68c0\u67e5\uff09</p> </li> <li> <p>\u68c0\u67e5\u5f53\u524d\u89c6\u56fe\u548c\u6240\u6709\u5e95\u5c42\u57fa\u89c6\u56fe\u7684\u6761\u4ef6\uff08\u65e0\u8bba\u5e95\u5c42\u89c6\u56fe\u662f\u5426\u5b9a\u4e49\u4e86\u68c0\u67e5\u9009\u9879\uff09</p> </li> <li> <p>\u66f4\u4e25\u683c\uff0c\u786e\u4fdd\u6570\u636e\u6ee1\u8db3\u6574\u4e2a\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u7684\u6761\u4ef6</p> </li> <li> <p>LOCAL\uff08\u672c\u5730\u68c0\u67e5\uff09</p> </li> <li> <p>\u68c0\u67e5\u5f53\u524d\u89c6\u56fe\u7684\u6761\u4ef6</p> </li> <li>\u9012\u5f52\u68c0\u67e5\u5e95\u5c42\u89c6\u56fe\uff0c\u4f46\u4ec5\u5f53\u8fd9\u4e9b\u5e95\u5c42\u89c6\u56fe\u672c\u8eab\u5b9a\u4e49\u4e86\u68c0\u67e5\u9009\u9879\u65f6\u624d\u751f\u6548</li> </ol> <p></p>"},{"location":"MySQL/%E8%A7%86%E5%9B%BE/#\u89c6\u56fe\u66f4\u65b0","title":"\u89c6\u56fe\u66f4\u65b0","text":"<p>\u8981\u4f7f\u89c6\u56fe\u53ef\u66f4\u65b0\uff0c\u89c6\u56fe\u4e2d\u7684\u884c\u4e0e\u57fa\u7840\u8868\u4e2d\u7684\u884c\u4e4b\u95f4\u5fc5\u987b\u5b58\u5728\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\u5982\u679c\u89c6\u56fe\u5305\u542b\u4ee5\u4e0b\u4efb\u4f55\u4e00 \u9879\uff0c\u5219\u8be5\u89c6\u56fe\u4e0d\u53ef\u66f4\u65b0\uff1a</p> <ul> <li>\u805a\u5408\u51fd\u6570\u6216\u7a97\u53e3\u51fd\u6570\uff08SUM()\u3001 MIN()\u3001 MAX()\u3001 COUNT()\u7b49\uff09 </li> <li>DISTINCT </li> <li>GROUP BY </li> <li>HAVING </li> <li>UNION \u6216\u8005 UNION ALL</li> </ul> <p></p>"},{"location":"MySQL/%E8%A7%86%E5%9B%BE/#\u4f5c\u7528","title":"\u4f5c\u7528","text":"<ol> <li> <p>\u7b80\u5355 </p> <p>\u89c6\u56fe\u4e0d\u4ec5\u53ef\u4ee5\u7b80\u5316\u7528\u6237\u5bf9\u6570\u636e\u7684\u7406\u89e3\uff0c\u4e5f\u53ef\u4ee5\u7b80\u5316\u4ed6\u4eec\u7684\u64cd\u4f5c\u3002\u90a3\u4e9b\u88ab\u7ecf\u5e38\u4f7f\u7528\u7684\u67e5\u8be2\u53ef\u4ee5\u88ab\u5b9a\u4e49\u4e3a\u89c6\u56fe\uff0c\u4ece\u800c\u4f7f\u5f97\u7528\u6237\u4e0d\u5fc5\u4e3a\u4ee5\u540e\u7684\u64cd\u4f5c\u6bcf\u6b21\u6307\u5b9a\u5168\u90e8\u7684\u6761\u4ef6\u3002 </p> </li> <li> <p>\u5b89\u5168 </p> <p>\u6570\u636e\u5e93\u53ef\u4ee5\u6388\u6743\uff0c\u4f46\u4e0d\u80fd\u6388\u6743\u5230\u6570\u636e\u5e93\u7279\u5b9a\u884c\u548c\u7279\u5b9a\u7684\u5217\u4e0a\u3002\u901a\u8fc7\u89c6\u56fe\u7528\u6237\u53ea\u80fd\u67e5\u8be2\u548c\u4fee\u6539\u4ed6\u4eec\u6240\u80fd\u89c1\u5230\u7684\u6570\u636e </p> </li> <li> <p>\u6570\u636e\u72ec\u7acb </p> <p>\u89c6\u56fe\u53ef\u5e2e\u52a9\u7528\u6237\u5c4f\u853d\u771f\u5b9e\u8868\u7ed3\u6784\u53d8\u5316\u5e26\u6765\u7684\u5f71\u54cd\u3002</p> </li> </ol>"},{"location":"MySQL/%E8%A7%A6%E5%8F%91%E5%99%A8/","title":"\u89e6\u53d1\u5668","text":""},{"location":"MySQL/%E8%A7%A6%E5%8F%91%E5%99%A8/#\u89e6\u53d1\u5668","title":"\u89e6\u53d1\u5668","text":"<p>\u89e6\u53d1\u5668\u662f\u4e0e\u8868\u6709\u5173\u7684\u6570\u636e\u5e93\u5bf9\u8c61\uff0c\u6307\u5728insert/update/delete\u4e4b\u524d(BEFORE)\u6216\u4e4b\u540e(AFTER)\uff0c\u89e6\u53d1\u5e76\u6267\u884c\u89e6\u53d1\u5668\u4e2d\u5b9a\u4e49\u7684SQL\u8bed\u53e5\u96c6\u5408\u3002\u89e6\u53d1\u5668\u7684\u8fd9\u79cd\u7279\u6027\u53ef\u4ee5\u534f\u52a9\u5e94\u7528\u5728\u6570\u636e\u5e93\u7aef\u786e\u4fdd\u6570\u636e\u7684\u5b8c\u6574\u6027  , \u65e5\u5fd7\u8bb0\u5f55 , \u6570\u636e\u6821\u9a8c\u7b49\u64cd\u4f5c \u3002</p> \u89e6\u53d1\u5668\u7c7b\u578b NEW \u548c OLD INSERT \u89e6\u53d1\u5668 NEW \u8868\u793a\u5c06\u8981\u6216\u8005\u5df2\u7ecf\u65b0\u589e\u7684\u6570\u636e UPDARTE \u89e6\u53d1\u5668 OLD \u8868\u793a\u4fee\u6539\u524d\u7684\u6570\u636e\uff0cNEW \u8868\u793a\u5c06\u8981\u6216\u5df2\u7ecf\u4fee\u6539\u540e\u7684\u6570\u636e DELETE \u89e6\u53d1\u5668 OLD \u8868\u793a\u5c06\u8981\u6216\u8005\u5df2\u7ecf\u5220\u9664\u7684\u6570\u636e <pre><code>-- \u521b\u5efa\u89e6\u53d1\u5668\ncreate trigger trigger_name\nbefore/after insert/update/delete\non table_name for each row\nbegin\n    statement\nend;\n\n-- \u67e5\u770b\u89e6\u53d1\u5668\nshow triggers;\n\n-- \u5220\u9664\u89e6\u53d1\u5668\ndrop trigger [schema_name.]trigger_name;\n</code></pre> <p>\u6848\u4f8b\uff1a\u4f7f\u7528\u89e6\u53d1\u5668\u8bb0\u5f55\u65e5\u5fd7</p> <pre><code>-- \u63d2\u5165\u6570\u636e\u89e6\u53d1\u5668\ncreate trigger insert_trigger\nafter insert on tb_user for each row\nbegin\n    insert into user_log(id,operation,operation_time,operation_id,operation_params) values\n    (null,'insert',now(),new.id,concat('\u63d2\u5165\u6570\u636e\uff1aid=',new.id,',name',new.name,...));\nend;\n\n-- \u66f4\u65b0\u89e6\u53d1\u5668\ncreate trigger update_trigger\nafter update on tb_user for each row\nbegin\n    insert into user_log(id,operation,operation_time,operation_id,operation_params) values\n    (null,'update',now(),new.id,\n        concat('\u66f4\u65b0\u524d\u6570\u636e\uff1a',old.name,...,'\u66f4\u65b0\u540e\u6570\u636e\uff1a',new.name,...)\n    );\nend;\n\n-- \u5220\u9664\u89e6\u53d1\u5668\ncreate trigger delete_trigger\nafter delete on tb_user for each row\nbegin\n    insert into user_log(id,operation,operation_time,operation_id,operation_params) values\n    (null,'delete',now(),new.id,\n        concat('\u5220\u9664\u6570\u636e\uff1a',old.name,...)\n    );\nend;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/","title":"\u8fd0\u7ef4","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u65e5\u5fd7","title":"\u65e5\u5fd7","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u9519\u8bef\u65e5\u5fd7","title":"\u9519\u8bef\u65e5\u5fd7","text":"<p>\u9519\u8bef\u65e5\u5fd7\u662f MySQL \u4e2d\u6700\u91cd\u8981\u7684\u65e5\u5fd7\u4e4b\u4e00\uff0c\u5b83\u8bb0\u5f55\u4e86\u5f53 mysqld \u542f\u52a8\u548c\u505c\u6b62\u65f6\uff0c\u4ee5\u53ca\u670d\u52a1\u5668\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4efb\u4f55\u4e25\u91cd\u9519\u8bef\u65f6\u7684\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u8be5\u65e5\u5fd7\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u9ed8\u8ba4\u5b58\u653e\u76ee\u5f55 /var/log/\uff0c\u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6\u540d\u4e3a mysqld.log \u3002\u67e5\u770b\u65e5\u5fd7\u4f4d\u7f6e</p> <pre><code> show variables like '%log_error%';\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u4e8c\u8fdb\u5236\u65e5\u5fd7","title":"\u4e8c\u8fdb\u5236\u65e5\u5fd7","text":"<p>\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff08BINLOG\uff09\u8bb0\u5f55\u4e86\u6240\u6709\u7684 DDL\uff08\u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff09\u8bed\u53e5\u548c DML\uff08\u6570\u636e\u64cd\u7eb5\u8bed\u8a00\uff09\u8bed\u53e5\uff0c\u4f46\u4e0d\u5305\u62ec\u6570\u636e\u67e5\u8be2\uff08SELECT\u3001SHOW\uff09\u8bed\u53e5</p> <p>\u4f5c\u7528\uff1a</p> <ul> <li>\u707e\u96be\u65f6\u7684\u6570\u636e\u6062\u590d\uff1b</li> <li>MySQL\u7684\u4e3b\u4ece\u590d\u5236\u3002</li> </ul> <pre><code> -- \u67e5\u770b\u65e5\u5fd7\u76ee\u5f55\n show variables like '%log_bin%';\n</code></pre> <p><code>log_bin_basename</code>\uff1a\u5f53\u524d\u6570\u636e\u5e93\u670d\u52a1\u5668\u7684binlog\u65e5\u5fd7\u7684\u57fa\u7840\u540d\u79f0(\u524d\u7f00)\uff0c\u5177\u4f53\u7684binlog\u6587 \u4ef6\u540d\u9700\u8981\u518d\u8be5basename\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u7f16\u53f7(\u7f16\u53f7\u4ece000001\u5f00\u59cb)\u3002 </p> <p><code>log_bin_index</code>\uff1abinlog\u7684\u7d22\u5f15\u6587\u4ef6\uff0c\u91cc\u9762\u8bb0\u5f55\u4e86\u5f53\u524d\u670d\u52a1\u5668\u5173\u8054\u7684binlog\u6587\u4ef6\u6709\u54ea\u4e9b\u3002</p> <p>\u65e5\u5fd7\u683c\u5f0f</p> <p>MySQL\u670d\u52a1\u5668\u4e2d\u63d0\u4f9b\u4e86\u591a\u79cd\u683c\u5f0f\u6765\u8bb0\u5f55\u4e8c\u8fdb\u5236\u65e5\u5fd7</p> <pre><code>-- \u67e5\u770b\u65e5\u5fd7\u683c\u5f0f\nshow variables like '%binlog_format%';\n\n-- \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fee\u6539 binlog_format \u7684\u503c\u5373\u53ef\u4fee\u6539\u65e5\u5fd7\u683c\u5f0f\n</code></pre> \u65e5\u5fd7\u683c\u5f0f \u8bf4\u660e STATEMENT \u57fa\u4e8eSQL\u8bed\u53e5\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u8bb0\u5f55\u7684\u662fSQL\u8bed\u53e5\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u7684SQL\u90fd\u4f1a\u8bb0\u5f55\u5728\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002 ROW \u57fa\u4e8e\u884c\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u8bb0\u5f55\u7684\u662f\u6bcf\u4e00\u884c\u7684\u6570\u636e\u53d8\u66f4\u3002\uff08\u9ed8\u8ba4\uff09 MIXED \u6df7\u5408\u4e86STATEMENT\u548cROW\u4e24\u79cd\u683c\u5f0f\uff0c\u9ed8\u8ba4\u91c7\u7528STATEMENT\uff0c\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u5207\u6362\u4e3aROW\u8fdb\u884c\u8bb0\u5f55\u3002 <p>\u67e5\u770b\u4e8c\u8fdb\u5236\u65e5\u5fd7</p> <pre><code>mysqlbinlog  [ \u53c2\u6570\u9009\u9879 ]  logfilename\n\u53c2\u6570\u9009\u9879\uff1a\n    -d      \u6307\u5b9a\u6570\u636e\u5e93\u540d\u79f0\uff0c\u53ea\u5217\u51fa\u6307\u5b9a\u7684\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c\u3002\n    -o      \u5ffd\u7565\u6389\u65e5\u5fd7\u4e2d\u7684\u524dn\u884c\u547d\u4ee4\u3002\n    -v      \u5c06\u884c\u4e8b\u4ef6(\u6570\u636e\u53d8\u66f4)\u91cd\u6784\u4e3aSQL\u8bed\u53e5\n    -vv     \u5c06\u884c\u4e8b\u4ef6(\u6570\u636e\u53d8\u66f4)\u91cd\u6784\u4e3aSQL\u8bed\u53e5\uff0c\u5e76\u8f93\u51fa\u6ce8\u91ca\u4fe1\u606f\n</code></pre> <p>\u5220\u9664\u65e5\u5fd7</p> \u6307\u4ee4 \u8bf4\u660e reset master \u5220\u9664\u5168\u90e8 binlog \u65e5\u5fd7\uff0c\u5220\u9664\u4e4b\u540e\uff0c\u65e5\u5fd7\u7f16\u53f7\uff0c\u5c06 \u4ece binlog.000001\u91cd\u65b0\u5f00\u59cb purge master logs to 'binlog.*' \u5220\u9664 * \u7f16\u53f7\u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7 purge master logs before 'yyyy-mm-dd hh24:mi:ss' \u5220\u9664\u65e5\u5fd7\u4e3a \"yyyy-mm-dd hh24:mi:ss\" \u4e4b\u524d \u4ea7\u751f\u7684\u6240\u6709\u65e5\u5fd7 <p>Tip</p> <p>\u4e5f\u53ef\u4ee5\u5728mysql\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8fc7\u671f\u4f1a\u81ea\u52a8\u5220\u9664\u3002</p> <pre><code>show variables like '%binlog_expire_logs_seconds%';\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u67e5\u8be2\u65e5\u5fd7","title":"\u67e5\u8be2\u65e5\u5fd7","text":"<p>\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u4e86\u5ba2\u6237\u7aef\u7684\u6240\u6709\u64cd\u4f5c\u8bed\u53e5\uff0c\u800c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u5305\u542b\u67e5\u8be2\u6570\u636e\u7684SQL\u8bed\u53e5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u67e5\u8be2\u65e5\u5fd7\u662f\u672a\u5f00\u542f\u7684\u3002</p> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542f\u67e5\u8be2\u65e5\u5fd7</p> <pre><code>#\u8be5\u9009\u9879\u7528\u6765\u5f00\u542f\u67e5\u8be2\u65e5\u5fd7 \uff0c \u53ef\u9009\u503c \uff1a 0 \u6216\u8005 1 \uff1b 0 \u4ee3\u8868\u5173\u95ed\uff0c 1 \u4ee3\u8868\u5f00\u542f \ngeneral_log=1\n #\u8bbe\u7f6e\u65e5\u5fd7\u7684\u6587\u4ef6\u540d \uff0c \u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c \u9ed8\u8ba4\u7684\u6587\u4ef6\u540d\u4e3a host_name.log \ngeneral_log_file=mysql_query.log\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6162\u67e5\u8be2\u65e5\u5fd7","title":"\u6162\u67e5\u8be2\u65e5\u5fd7","text":"<p>\u6162\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u53c2\u6570 <code>long_query_time</code> \u8bbe\u7f6e\u503c\u5e76\u4e14\u626b\u63cf\u8bb0\u5f55\u6570\u4e0d\u5c0f\u4e8e  <code>min_examined_row_limit</code> \u7684\u6240\u6709\u7684SQL\u8bed\u53e5\u7684\u65e5\u5fd7\uff0c\u9ed8\u8ba4\u672a\u5f00\u542f\u3002</p> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7  </p> <pre><code>## \u6162\u67e5\u8be2\u65e5\u5fd7\nslow_query_log=1\n## \u6162\u67e5\u8be2\u65f6\u95f4\u9608\u503c\nlong_query_time=2\n</code></pre> <p>Info</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u7ba1\u7406\u8bed\u53e5\uff0c\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u4e0d\u4f7f\u7528\u7d22\u5f15\u8fdb\u884c\u67e5\u627e\u7684\u67e5\u8be2\u3002\u53ef\u4ee5\u4f7f\u7528 log_slow_admin_statements \u548c\u66f4\u6539\u6b64\u884c\u4e3a log_queries_not_using_indexes</p> <pre><code>#\u8bb0\u5f55\u6267\u884c\u8f83\u6162\u7684\u7ba1\u7406\u8bed\u53e5\nlog_slow_admin_statements =1\n#\u8bb0\u5f55\u6267\u884c\u8f83\u6162\u7684\u672a\u4f7f\u7528\u7d22\u5f15\u7684\u8bed\u53e5\nlog_queries_not_using_indexes = 1\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u4e3b\u4ece\u590d\u5236","title":"\u4e3b\u4ece\u590d\u5236","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u4e3b\u4ece\u590d\u5236\u662f\u6307\u5c06\u4e3b\u6570\u636e\u5e93\u7684 DDL \u548c DML \u64cd\u4f5c\u901a\u8fc7\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u5230\u4ece\u5e93\u670d\u52a1\u5668\u4e2d\uff0c\u7136\u540e\u5728\u4ece\u5e93\u4e0a\u5bf9\u8fd9\u4e9b\u65e5\u5fd7\u91cd\u65b0\u6267\u884c\uff08\u4e5f\u53eb\u91cd\u505a\uff09\uff0c\u4ece\u800c\u4f7f\u5f97\u4ece\u5e93\u548c\u4e3b\u5e93\u7684\u6570\u636e\u4fdd\u6301\u540c\u6b65\u3002</p> <p></p> <p>MySQL \u4e3b\u4ece\u590d\u5236\u7684\u4f18\u70b9\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u4e09\u4e2a\u65b9\u9762\uff1a </p> <ul> <li>\u4e3b\u5e93\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u5feb\u901f\u5207\u6362\u5230\u4ece\u5e93\u63d0\u4f9b\u670d\u52a1\u3002 </li> <li>\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\uff0c\u964d\u4f4e\u4e3b\u5e93\u7684\u8bbf\u95ee\u538b\u529b\u3002 </li> <li>\u53ef\u4ee5\u5728\u4ece\u5e93\u4e2d\u6267\u884c\u5907\u4efd\uff0c\u4ee5\u907f\u514d\u5907\u4efd\u671f\u95f4\u5f71\u54cd\u4e3b\u5e93\u670d\u52a1\u3002</li> </ul>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u539f\u7406","title":"\u539f\u7406","text":"<p>MySQL\u4e3b\u4ece\u590d\u5236\u7684\u6838\u5fc3\u5c31\u662f \u4e8c\u8fdb\u5236\u65e5\u5fd7</p> <p></p> <p>\u8fc7\u7a0b\uff1a</p> <ol> <li>Master \u4e3b\u5e93\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u4f1a\u628a\u6570\u636e\u53d8\u66f4\u8bb0\u5f55\u5728\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6 Binlog \u4e2d\u3002</li> <li>\u4ece\u5e93\u8bfb\u53d6\u4e3b\u5e93\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6 Binlog \uff0c\u5199\u5165\u5230\u4ece\u5e93\u7684\u4e2d\u7ee7\u65e5\u5fd7 Relay Log \u3002 </li> <li>slave\u91cd\u505a\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u7684\u4e8b\u4ef6\uff0c\u5c06\u6539\u53d8\u53cd\u6620\u5b83\u81ea\u5df1\u7684\u6570\u636e\u3002</li> </ol>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u642d\u5efa\u4e3b\u4ece","title":"\u642d\u5efa\u4e3b\u4ece","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u4e3b\u8282\u70b9","title":"\u4e3b\u8282\u70b9","text":"<p>\u4e3b\u8282\u70b9\u914d\u7f6e\uff1a</p> <pre><code>## mysql \u670d\u52a1ID\uff0c\u4fdd\u8bc1\u6574\u4e2a\u96c6\u7fa4\u73af\u5883\u4e2d\u552f\u4e00\uff0c\u53d6\u503c\u8303\u56f4\uff1a1 ~ (2^32-1)\uff0c\u9ed8\u8ba4\u4e3a1\nserver-id=1\n\n## \u662f\u5426\u53ea\u8bfb,1 \u4ee3\u8868\u53ea\u8bfb, 0 \u4ee3\u8868\u8bfb\u5199\nread-only=0\n\n## \u5ffd\u7565\u7684\u6570\u636e, \u6307\u4e0d\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\n## binlog-ignore-db=mysql\n\n## \u6307\u5b9a\u540c\u6b65\u7684\u6570\u636e\u5e93\n## binlog-do-db=db01\n</code></pre> <p>\u521b\u5efa\u8fdc\u7a0b\u8fde\u63a5\u7528\u6237</p> <pre><code>## \u521b\u5efa\u7528\u6237\uff0c\u5e76\u8bbe\u7f6e\u5bc6\u7801\uff0c\u8be5\u7528\u6237\u53ef\u5728\u4efb\u610f\u4e3b\u673a\u8fde\u63a5\u8be5MySQL\u670d\u52a1\nCREATE USER 'itcast'@'%' IDENTIFIED WITH mysql_native_password BY 'Root@123456';\n\n## \u4e3a\u7528\u6237\u5206\u914d\u4e3b\u4ece\u590d\u5236\u6743\u9650\nGRANT REPLICATION  SLAVE  ON  *.*  TO  'itcast'@'%';\n</code></pre> <p>\u67e5\u770b\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5750\u6807 <code>show master status;</code>\uff0c\u7528\u4e8e\u4ece\u8282\u70b9\u914d\u7f6e</p> <ul> <li>file : \u4ece\u54ea\u4e2a\u65e5\u5fd7\u6587\u4ef6\u5f00\u59cb\u63a8\u9001\u65e5\u5fd7\u6587\u4ef6  </li> <li>position \uff1a \u4ece\u54ea\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u63a8\u9001\u65e5\u5fd7 </li> <li>binlog_ignore_db : \u6307\u5b9a\u4e0d\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93</li> </ul>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u4ece\u8282\u70b9","title":"\u4ece\u8282\u70b9","text":"<p>\u914d\u7f6e\u6587\u4ef6</p> <pre><code>## mysql \u670d\u52a1ID\uff0c\u4fdd\u8bc1\u6574\u4e2a\u96c6\u7fa4\u73af\u5883\u4e2d\u552f\u4e00\uff0c\u53d6\u503c\u8303\u56f4\uff1a1 ~ (2^32-1)\uff0c\u548c\u4e3b\u5e93\u4e0d\u4e00\u6837\u5373\u53ef\nserver-id=2\n\n## \u662f\u5426\u53ea\u8bfb,1 \u4ee3\u8868\u53ea\u8bfb, 0 \u4ee3\u8868\u8bfb\u5199\nread-only=1\n</code></pre> <p>\u8fde\u63a5\u4e3b\u8282\u70b9</p> <pre><code>-- 8.0.23\u7248\u672c\nCHANGE REPLICATION SOURCE TO SOURCE_HOST='\u4e3b\u8282\u70b9IP', SOURCE_USER='\u4e3b\u8282\u70b9\u6388\u6743\u7528\u6237', \nSOURCE_PASSWORD='\u5bc6\u7801', SOURCE_LOG_FILE='binlog.000004', \nSOURCE_LOG_POS=663;\n</code></pre> <p>\u5f00\u542f\u540c\u6b65</p> <pre><code>start replica ; #8.0.22\u4e4b\u540e\nstart  slave ;  #8.0.22\u4e4b\u524d\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5206\u5e93\u5206\u8868","title":"\u5206\u5e93\u5206\u8868","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6982\u8ff0_1","title":"\u6982\u8ff0","text":"<p>\u968f\u7740\u4e92\u8054\u7f51\u53ca\u79fb\u52a8\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u5e94\u7528\u7cfb\u7edf\u7684\u6570\u636e\u91cf\u4e5f\u662f\u6210\u6307\u6570\u5f0f\u589e\u957f\uff0c\u82e5\u91c7\u7528\u5355\u6570\u636e\u5e93\u8fdb\u884c\u6570\u636e\u5b58\u50a8\uff0c\u5b58\u5728\u4ee5\u4e0b\u6027\u80fd\u74f6\u9888\uff1a </p> <ol> <li>IO\u74f6\u9888\uff1a\u70ed\u70b9\u6570\u636e\u592a\u591a\uff0c\u6570\u636e\u5e93\u7f13\u5b58\u4e0d\u8db3\uff0c\u4ea7\u751f\u5927\u91cf\u78c1\u76d8IO\uff0c\u6548\u7387\u8f83\u4f4e\u3002 \u8bf7\u6c42\u6570\u636e\u592a\u591a\uff0c\u5e26\u5bbd\u4e0d\u591f\uff0c\u7f51\u7edcIO\u74f6\u9888\u3002 </li> <li>CPU\u74f6\u9888\uff1a\u6392\u5e8f\u3001\u5206\u7ec4\u3001\u8fde\u63a5\u67e5\u8be2\u3001\u805a\u5408\u7edf\u8ba1\u7b49SQL\u4f1a\u8017\u8d39\u5927\u91cf\u7684CPU\u8d44\u6e90\uff0c\u8bf7\u6c42\u6570\u592a\u591a\uff0cCPU\u8fbe\u5230\u74f6\u9888\u3002</li> </ol> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5206\u5e93\u5206\u8868\u5904\u7406\u3002</p> <p></p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u62c6\u5206\u7b56\u7565","title":"\u62c6\u5206\u7b56\u7565","text":"<p>\u5206\u5e93\u5206\u8868\u7684\u5f62\u5f0f\uff0c\u4e3b\u8981\u662f\u4e24\u79cd\uff1a\u5782\u76f4\u62c6\u5206\u548c\u6c34\u5e73\u62c6\u5206\u3002</p> <p></p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5782\u76f4\u62c6\u5206","title":"\u5782\u76f4\u62c6\u5206","text":"<p>\u5782\u76f4\u5206\u5e93\uff1a\u4ee5\u8868\u4e3a\u4f9d\u636e\uff0c\u6839\u636e\u4e1a\u52a1\u5c06\u4e0d\u540c\u8868\u62c6\u5206\u5230\u4e0d\u540c\u5e93\u4e2d\u3002</p> <p>\u7279\u70b9\uff1a </p> <ul> <li>\u6bcf\u4e2a\u5e93\u7684\u8868\u7ed3\u6784\u90fd\u4e0d\u4e00\u6837\u3002 </li> <li>\u6bcf\u4e2a\u5e93\u7684\u6570\u636e\u4e5f\u4e0d\u4e00\u6837\u3002 </li> <li>\u6240\u6709\u5e93\u7684\u5e76\u96c6\u662f\u5168\u91cf\u6570\u636e\u3002</li> </ul> <p></p> <p>\u5782\u76f4\u5206\u8868\uff1a\u4ee5\u5b57\u6bb5\u4e3a\u4f9d\u636e\uff0c\u6839\u636e\u5b57\u6bb5\u5c5e\u6027\u5c06\u4e0d\u540c\u5b57\u6bb5\u62c6\u5206\u5230\u4e0d\u540c\u8868\u4e2d\u3002</p> <p>\u7279\u70b9\uff1a </p> <ul> <li>\u6bcf\u4e2a\u8868\u7684\u7ed3\u6784\u90fd\u4e0d\u4e00\u6837\u3002 </li> <li>\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u4e5f\u4e0d\u4e00\u6837\uff0c\u4e00\u822c\u901a\u8fc7\u4e00\u5217\uff08\u4e3b\u952e/\u5916\u952e\uff09\u5173\u8054\u3002 </li> <li>\u6240\u6709\u8868\u7684\u5e76\u96c6\u662f\u5168\u91cf\u6570\u636e\u3002</li> </ul> <p></p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6c34\u5e73\u62c6\u5206","title":"\u6c34\u5e73\u62c6\u5206","text":"<p>\u6c34\u5e73\u5206\u5e93\uff1a\u4ee5\u5b57\u6bb5\u4e3a\u4f9d\u636e\uff0c\u6309\u7167\u4e00\u5b9a\u7b56\u7565\uff0c\u5c06\u4e00\u4e2a\u5e93\u7684\u6570\u636e\u62c6\u5206\u5230\u591a\u4e2a\u5e93\u4e2d\u3002</p> <p>\u7279\u70b9\uff1a </p> <ul> <li>\u6bcf\u4e2a\u5e93\u7684\u8868\u7ed3\u6784\u90fd\u4e00\u6837\u3002 </li> <li>\u6bcf\u4e2a\u5e93\u7684\u6570\u636e\u90fd\u4e0d\u4e00\u6837\u3002 </li> <li>\u6240\u6709\u5e93\u7684\u5e76\u96c6\u662f\u5168\u91cf\u6570\u636e\u3002</li> </ul> <p></p> <p>\u6c34\u5e73\u5206\u8868\uff1a\u4ee5\u5b57\u6bb5\u4e3a\u4f9d\u636e\uff0c\u6309\u7167\u4e00\u5b9a\u7b56\u7565\uff0c\u5c06\u4e00\u4e2a\u8868\u7684\u6570\u636e\u62c6\u5206\u5230\u591a\u4e2a\u8868\u4e2d\u3002</p> <p>\u7279\u70b9\uff1a </p> <ul> <li>\u6bcf\u4e2a\u8868\u7684\u8868\u7ed3\u6784\u90fd\u4e00\u6837\u3002 </li> <li>\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u90fd\u4e0d\u4e00\u6837\u3002 </li> <li>\u6240\u6709\u8868\u7684\u5e76\u96c6\u662f\u5168\u91cf\u6570\u636e\u3002</li> </ul> <p></p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5b9e\u73b0\u6280\u672f","title":"\u5b9e\u73b0\u6280\u672f","text":"<ul> <li>shardingJDBC\uff1a\u57fa\u4e8eAOP\u539f\u7406\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5bf9\u672c\u5730\u6267\u884c\u7684SQL\u8fdb\u884c\u62e6\u622a\uff0c\u89e3\u6790\u3001\u6539\u5199\u3001\u8def\u7531\u5904\u7406\u3002\u9700\u8981\u81ea\u884c\u7f16\u7801\u914d\u7f6e\u5b9e\u73b0\uff0c\u53ea\u652f\u6301java\u8bed\u8a00\uff0c\u6027\u80fd\u8f83\u9ad8\u3002 </li> <li>MyCat\uff1a\u6570\u636e\u5e93\u5206\u5e93\u5206\u8868\u4e2d\u95f4\u4ef6\uff0c\u4e0d\u7528\u8c03\u6574\u4ee3\u7801\u5373\u53ef\u5b9e\u73b0\u5206\u5e93\u5206\u8868\uff0c\u652f\u6301\u591a\u79cd\u8bed\u8a00\uff0c\u6027\u80fd\u4e0d\u53ca\u524d\u8005\u3002</li> </ul>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#mycat\u6982\u8ff0","title":"MyCat\u6982\u8ff0","text":"<p>| MYCAT\u5b98\u65b9\u7f51\u7ad9\u2014\u4e2d\u56fd\u5f00\u6e90\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6</p> <p>\u5b89\u88c5\u540e\u76ee\u5f55\u4ecb\u7ecd</p> <p>bin : \u5b58\u653e\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7528\u4e8e\u542f\u52a8\u505c\u6b62mycat</p> <p>conf\uff1a\u5b58\u653emycat\u7684\u914d\u7f6e\u6587\u4ef6 </p> <p>lib\uff1a\u5b58\u653emycat\u7684\u9879\u76ee\u4f9d\u8d56\u5305\uff08jar\uff09 </p> <p>logs\uff1a\u5b58\u653emycat\u7684\u65e5\u5fd7\u6587\u4ef6</p> <p></p> <p>\u5728MyCat\u7684\u903b\u8f91\u7ed3\u6784\u4e3b\u8981\u8d1f\u8d23\u903b\u8f91\u5e93\u3001\u903b\u8f91\u8868\u3001\u5206\u7247\u89c4\u5219\u3001\u5206\u7247\u8282\u70b9\u7b49\u903b\u8f91\u7ed3\u6784\u7684\u5904\u7406\uff0c\u800c\u5177\u4f53\u7684\u6570\u636e \u5b58\u50a8\u8fd8\u662f\u5728\u7269\u7406\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e2d\u5b58\u50a8\u7684\u3002</p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#mycat\u914d\u7f6e","title":"MyCat\u914d\u7f6e","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#schemaxml","title":"schema.xml","text":"<p>schema.xml \u4f5c\u4e3aMyCat\u4e2d\u6700\u91cd\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u4e4b\u4e00 , \u6db5\u76d6\u4e86MyCat\u7684\u903b\u8f91\u5e93 \u3001 \u903b\u8f91\u8868 \u3001 \u5206\u7247\u89c4 \u5219\u3001\u5206\u7247\u8282\u70b9\u53ca\u6570\u636e\u6e90\u7684\u914d\u7f6e\u3002</p> <p>\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u4e09\u7ec4\u6807\u7b7e\uff1a </p> <ul> <li>schema\u6807\u7b7e </li> <li>datanode\u6807\u7b7e </li> <li>datahost\u6807\u7b7e</li> </ul> <p></p> <p>1.schema\u6807\u7b7e</p> <p>\u5b9a\u4e49\u903b\u8f91\u5e93\uff0c\u4e00\u4e2aMyCat\u5b9e\u4f8b\u4e2d, \u53ef\u4ee5\u6709\u591a\u4e2a\u903b\u8f91\u5e93 , \u53ef\u4ee5\u901a \u8fc7 schema \u6807\u7b7e\u6765\u5212\u5206\u4e0d\u540c\u7684\u903b\u8f91\u5e93\u3002MyCat\u4e2d\u7684\u903b\u8f91\u5e93\u7684\u6982\u5ff5\uff0c\u7b49\u540c\u4e8eMySQL\u4e2d\u7684database\u6982\u5ff5\u3002</p> <p>\u4e3b\u8981\u5c5e\u6027\uff1a</p> <ul> <li>name\uff1a\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u903b\u8f91\u5e93\u5e93\u540d </li> <li>checkSQLschema\uff1a\u5728SQL\u8bed\u53e5\u64cd\u4f5c\u65f6\u6307\u5b9a\u4e86\u6570\u636e\u5e93\u540d\u79f0\uff0c\u6267\u884c\u65f6\u662f\u5426\u81ea\u52a8\u53bb\u9664\uff1btrue\uff1a\u81ea\u52a8\u53bb \u9664\uff0cfalse\uff1a\u4e0d\u81ea\u52a8\u53bb\u9664 </li> <li>sqlMaxLimit\uff1a\u5982\u679c\u672a\u6307\u5b9alimit\u8fdb\u884c\u67e5\u8be2\uff0c\u5217\u8868\u67e5\u8be2\u6a21\u5f0f\u67e5\u8be2\u591a\u5c11\u6761\u8bb0\u5f55</li> </ul> <p>\u5b50\u6807\u7b7e\uff1a</p> <ul> <li> <p>table\u5b9a\u4e49\u903b\u8f91\u8868</p> <p>\u4e3b\u8981\u5c5e\u6027\uff1a</p> <ul> <li>name\uff1a\u5b9a\u4e49\u903b\u8f91\u8868\u8868\u540d\uff0c\u5728\u8be5\u903b\u8f91\u5e93\u4e0b\u552f\u4e00 </li> <li>dataNode\uff1a\u5b9a\u4e49\u903b\u8f91\u8868\u6240\u5c5e\u7684dataNode\uff0c\u8be5\u5c5e\u6027\u9700\u8981\u4e0edataNode\u6807\u7b7e\u4e2dname\u5bf9\u5e94\uff1b\u591a\u4e2a dataNode\u9017\u53f7\u5206\u9694 </li> <li>rule\uff1a\u5206\u7247\u89c4\u5219\u7684\u540d\u5b57\uff0c\u5206\u7247\u89c4\u5219\u540d\u5b57\u662f\u5728rule.xml\u4e2d\u5b9a\u4e49\u7684 </li> <li>primaryKey\uff1a\u903b\u8f91\u8868\u5bf9\u5e94\u771f\u5b9e\u8868\u7684\u4e3b\u952e </li> <li>type\uff1a\u903b\u8f91\u8868\u7684\u7c7b\u578b\uff0c\u76ee\u524d\u903b\u8f91\u8868\u53ea\u6709\u5168\u5c40\u8868\u548c\u666e\u901a\u8868\uff0c\u5982\u679c\u672a\u914d\u7f6e\uff0c\u5c31\u662f\u666e\u901a\u8868\uff1b\u5168\u5c40\u8868\uff0c\u914d\u7f6e\u4e3a global</li> </ul> </li> </ul> <p>2.datanode\u6807\u7b7e</p> <p>\u4e3b\u8981\u5c5e\u6027\uff1a </p> <ul> <li>name\uff1a\u5b9a\u4e49\u6570\u636e\u8282\u70b9\u540d\u79f0 </li> <li>dataHost\uff1a\u6570\u636e\u5e93\u5b9e\u4f8b\u4e3b\u673a\u540d\u79f0\uff0c\u5f15\u7528\u81ea dataHost \u6807\u7b7e\u4e2dname\u5c5e\u6027 </li> <li>database\uff1a\u5b9a\u4e49\u5206\u7247\u6240\u5c5e\u6570\u636e\u5e93</li> </ul> <p>3.datahost\u6807\u7b7e</p> <p>\u4e3b\u8981\u5c5e\u6027\uff1a</p> <ul> <li>name\uff1a\u552f\u4e00\u6807\u8bc6\uff0c\u4f9b\u4e0a\u5c42\u6807\u7b7e\u4f7f\u7528 </li> <li>maxCon/minCon\uff1a\u6700\u5927\u8fde\u63a5\u6570/\u6700\u5c0f\u8fde\u63a5\u6570 </li> <li>balance\uff1a\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u53d6\u503c 0,1,2,3 </li> <li>writeType\uff1a\u5199\u64cd\u4f5c\u5206\u53d1\u65b9\u5f0f\uff080\uff1a\u5199\u64cd\u4f5c\u8f6c\u53d1\u5230\u7b2c\u4e00\u4e2awriteHost\uff0c\u7b2c\u4e00\u4e2a\u6302\u4e86\uff0c\u5207\u6362\u5230\u7b2c\u4e8c \u4e2a\uff1b1\uff1a\u5199\u64cd\u4f5c\u968f\u673a\u5206\u53d1\u5230\u914d\u7f6e\u7684writeHost\uff09 </li> <li>dbDriver\uff1a\u6570\u636e\u5e93\u9a71\u52a8\uff0c\u652f\u6301 native\u3001jdbc</li> </ul>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#rulexml","title":"rule.xml","text":"<p>rule.xml\u4e2d\u5b9a\u4e49\u6240\u6709\u62c6\u5206\u8868\u7684\u89c4\u5219, \u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u7075\u6d3b\u7684\u4f7f\u7528\u5206\u7247\u7b97\u6cd5, \u6216\u8005\u5bf9\u540c\u4e00\u4e2a\u5206\u7247\u7b97\u6cd5\u4f7f\u7528\u4e0d\u540c\u7684\u53c2\u6570, \u5b83\u8ba9\u5206\u7247\u8fc7\u7a0b\u53ef\u914d\u7f6e\u5316\u3002</p> <p>\u4e3b\u8981\u5305\u542b\u4e24\u7c7b\u6807\u7b7e\uff1a</p> <ul> <li>tableRule</li> <li>Function</li> </ul>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#serverxml","title":"server.xml","text":"<p>server.xml\u914d\u7f6e\u6587\u4ef6\u5305\u542b\u4e86MyCat\u7684\u7cfb\u7edf\u914d\u7f6e\u4fe1\u606f</p> <p>\u4e3b\u8981\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u6807\u7b7e\uff1a</p> <ul> <li>system</li> <li>user</li> </ul> <p>1.system\u6807\u7b7e</p> <p>\u4e3b\u8981\u914d\u7f6eMyCat\u4e2d\u7684\u7cfb\u7edf\u914d\u7f6e\u4fe1\u606f</p> <pre><code>&lt;property name=\"serverPort\"&gt;8066&lt;/property&gt; &lt;!-- MyCat\u670d\u52a1\u7aef\u53e3 --&gt;\n&lt;property name=\"managerPort\"&gt;9066&lt;/property&gt; &lt;!-- \u7ba1\u7406\u7aef\u53e3 --&gt;\n&lt;property name=\"charset\"&gt;utf8&lt;/property&gt; &lt;!-- \u9ed8\u8ba4\u5b57\u7b26\u96c6 --&gt;\n&lt;property name=\"nonePasswordLogin\"&gt;0&lt;/property&gt; &lt;!-- \u662f\u5426\u5141\u8bb8\u7a7a\u5bc6\u7801\u767b\u5f55(0\u7981\u6b62) --&gt;\n\n&lt;property name=\"processorBufferPoolType\"&gt;0&lt;/property&gt; &lt;!-- 0:NIO,1:AIO --&gt;\n&lt;property name=\"processorBufferLocalPercent\"&gt;100&lt;/property&gt; &lt;!-- \u7ebf\u7a0b\u6c60\u7f13\u51b2\u767e\u5206\u6bd4 --&gt;\n&lt;property name=\"frontSocketSoRcvbuf\"&gt;1048576&lt;/property&gt; &lt;!-- \u524d\u7aef\u63a5\u6536\u7f13\u51b2 --&gt;\n&lt;property name=\"frontSocketSoSndbuf\"&gt;4194304&lt;/property&gt; &lt;!-- \u524d\u7aef\u53d1\u9001\u7f13\u51b2 --&gt;\n&lt;property name=\"processors\"&gt;16&lt;/property&gt; &lt;!-- \u5904\u7406\u7ebf\u7a0b\u6570 --&gt;\n\n&lt;property name=\"defaultSqlParser\"&gt;druidparser&lt;/property&gt; &lt;!-- SQL\u89e3\u6790\u5668 --&gt;\n&lt;property name=\"sequnceHandlerType\"&gt;1&lt;/property&gt; &lt;!-- \u5168\u5c40\u5e8f\u5217\u7c7b\u578b --&gt;\n&lt;property name=\"useOffHeapForMerge\"&gt;0&lt;/property&gt; &lt;!-- \u662f\u5426\u4f7f\u7528\u5806\u5916\u5185\u5b58 --&gt;\n&lt;property name=\"memoryPageSize\"&gt;1m&lt;/property&gt; &lt;!-- \u5185\u5b58\u9875\u5927\u5c0f --&gt;\n\n&lt;property name=\"heartbeatTimeout\"&gt;1000&lt;/property&gt; &lt;!-- \u5fc3\u8df3\u8d85\u65f6(ms) --&gt;\n&lt;property name=\"idleTimeout\"&gt;1800000&lt;/property&gt; &lt;!-- \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6(ms) --&gt;\n</code></pre> <p>2.user\u6807\u7b7e</p> <p>\u914d\u7f6eMyCat\u4e2d\u7684\u7528\u6237\u3001\u8bbf\u95ee\u5bc6\u7801\uff0c\u4ee5\u53ca\u7528\u6237\u9488\u5bf9\u4e8e\u903b\u8f91\u5e93\u3001\u903b\u8f91\u8868\u7684\u6743\u9650\u4fe1\u606f</p> <pre><code>&lt;user name=\"test\" defaultAccount=\"true\"&gt;\n    &lt;property name=\"password\"&gt;test123&lt;/property&gt;\n    &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt; &lt;!-- \u53ef\u8bbf\u95ee\u7684schema --&gt;\n    &lt;property name=\"readOnly\"&gt;false&lt;/property&gt; &lt;!-- \u662f\u5426\u53ea\u8bfb --&gt;\n    &lt;property name=\"benchmark\"&gt;1000&lt;/property&gt; &lt;!-- \u6743\u91cd --&gt;\n\n    &lt;!-- \u8868\u7ea7\u6743\u9650\u63a7\u5236 --&gt;\n    &lt;privileges check=\"true\"&gt;\n        &lt;schema name=\"TESTDB\" dml=\"0110\"&gt;\n            &lt;table name=\"t_user\" dml=\"1111\"&gt;&lt;/table&gt;\n        &lt;/schema&gt;\n    &lt;/privileges&gt;\n&lt;/user&gt;\n</code></pre> <p>Tip</p> <p>dml\u56db\u4f4d\u6570\u5b57\u5206\u522b\u5bf9\u5e94\uff1ainsert(1\u4f4d),update(2\u4f4d),select(3\u4f4d),delete(4\u4f4d)</p> <p>\u4f8b\u5982dml=\"0110\"\u8868\u793a\u5141\u8bb8update\u548cselect</p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#mycat\u5206\u7247","title":"MyCat\u5206\u7247","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5168\u5c40\u8868","title":"\u5168\u5c40\u8868","text":"<p>\u5168\u5c40\u8868\uff08Global Table\uff09\u662f MyCat \u4e2d\u7684\u4e00\u79cd\u7279\u6b8a\u8868\u7c7b\u578b\uff0c\u6307\u5728\u6240\u6709\u6570\u636e\u8282\u70b9\uff08\u5206\u7247\u8282\u70b9\uff09\u4e0a\u90fd\u5b8c\u5168\u5197\u4f59\u5b58\u50a8\u7684\u76f8\u540c\u6570\u636e\u8868\u3002\u5168\u5c40\u8868\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u8de8\u5206\u7247 JOIN \u7684\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u7279\u70b9\uff1a</p> <ol> <li>\u5168\u8282\u70b9\u5197\u4f59\uff1a\u6240\u6709\u6570\u636e\u8282\u70b9\u90fd\u5b58\u50a8\u76f8\u540c\u6570\u636e</li> <li>\u5b9e\u65f6\u540c\u6b65\uff1a\u4efb\u4f55\u8282\u70b9\u7684\u4fee\u6539\u90fd\u4f1a\u540c\u6b65\u5230\u6240\u6709\u8282\u70b9</li> <li>\u8de8\u5206\u7247JOIN\u4f18\u5316\uff1a\u907f\u514d\u8de8\u5206\u7247JOIN\u64cd\u4f5c</li> <li>\u8bfb\u64cd\u4f5c\u672c\u5730\u5316\uff1a\u67e5\u8be2\u64cd\u4f5c\u53ef\u5728\u4efb\u610f\u8282\u70b9\u672c\u5730\u6267\u884c</li> <li>\u5199\u64cd\u4f5c\u5e7f\u64ad\uff1a\u5199\u5165\u64cd\u4f5c\u4f1a\u5e7f\u64ad\u5230\u6240\u6709\u8282\u70b9</li> </ol> <p>\u4f7f\u7528\u573a\u666f</p> <ol> <li>\u6570\u636e\u5b57\u5178\u8868\uff1a\u5982\u5730\u533a\u7f16\u7801\u3001\u7cfb\u7edf\u53c2\u6570\u7b49</li> <li>\u914d\u7f6e\u8868\uff1a\u7cfb\u7edf\u914d\u7f6e\u3001\u4e1a\u52a1\u914d\u7f6e\u7b49</li> <li>\u5c0f\u6570\u636e\u91cf\u8868\uff1a\u6570\u636e\u91cf\u5c0f\u4e14\u66f4\u65b0\u4e0d\u9891\u7e41\u7684\u8868</li> <li>\u9ad8\u9891\u5173\u8054\u8868\uff1a\u7ecf\u5e38\u9700\u8981\u4e0e\u5176\u4ed6\u8868JOIN\u7684\u7ef4\u5ea6\u8868</li> </ol> <pre><code>&lt;table name=\"t_area\" primaryKey=\"id\" type=\"global\" dataNode=\"dn1,dn2,dn3\"/&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5206\u7247\u89c4\u5219","title":"\u5206\u7247\u89c4\u5219","text":""},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u8303\u56f4\u5206\u7247","title":"\u8303\u56f4\u5206\u7247","text":"<p>\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u53ca\u5176\u914d\u7f6e\u7684\u8303\u56f4\u4e0e\u6570\u636e\u8282\u70b9\u7684\u5bf9\u5e94\u60c5\u51b5\uff0c \u6765\u51b3\u5b9a\u8be5\u6570\u636e\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u5206\u7247\u3002</p> <p></p> <pre><code> &lt;table name=\"TB_ORDER\" dataNode=\"dn1,dn2,dn3\" rule=\"auto-sharding-long\" /&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u53d6\u6a21\u5206\u7247","title":"\u53d6\u6a21\u5206\u7247","text":"<p>\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u503c\u4e0e\u8282\u70b9\u6570\u91cf\u8fdb\u884c\u6c42\u6a21\u8fd0\u7b97\uff0c\u6839\u636e\u8fd0\u7b97\u7ed3\u679c\uff0c \u6765\u51b3\u5b9a\u8be5\u6570\u636e\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u5206\u7247\u3002</p> <p></p> <pre><code>&lt;!-- schema.xml --&gt;\n&lt;table name=\"tb_log\" dataNode=\"dn4,dn5,dn6\" primaryKey=\"id\" rule=\"mod-long\" /&gt;\n\n\n&lt;!-- rule.xml --&gt;\n&lt;tableRule name=\"mod-long\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;id&lt;/columns&gt;\n        &lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n    &lt;/rule&gt;\n &lt;/tableRule&gt;\n &lt;function name=\"mod-long\" class=\"io.mycat.route.function.PartitionByMod\"&gt;\n    &lt;property name=\"count\"&gt;3&lt;/property&gt;&lt;!-- \u8282\u70b9\u6570\u91cf --&gt;\n &lt;/function&gt;\n</code></pre> <p>Warning</p> <p>\u8be5\u5206\u7247\u89c4\u5219\uff0c\u4e3b\u8981\u9488\u5bf9\u4e8e\u6570\u5b57\u7c7b\u578b\u7684\u5b57\u6bb5\u9002\u7528</p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u4e00\u81f4\u6027hash\u5206\u7247","title":"\u4e00\u81f4\u6027hash\u5206\u7247","text":"<p>\u4e00\u81f4\u6027\u54c8\u5e0c\uff08Consistent Hashing\uff09\u662fMyCat\u63d0\u4f9b\u7684\u4e00\u79cd\u7279\u6b8a\u5206\u7247\u7b97\u6cd5\uff0c\u5b83\u89e3\u51b3\u4e86\u4f20\u7edf\u54c8\u5e0c\u5206\u7247\u5728\u8282\u70b9\u6269\u5bb9/\u7f29\u5bb9\u65f6\u9700\u8981\u5927\u91cf\u6570\u636e\u8fc1\u79fb\u7684\u95ee\u9898\u3002</p> <p>\u7279\u70b9\uff1a</p> <ol> <li>\u865a\u62df\u8282\u70b9\u73af\uff1a\u5c06\u54c8\u5e0c\u7a7a\u95f4\u7ec4\u7ec7\u6210\u73af\u5f62\u7ed3\u6784</li> <li>\u6570\u636e\u5b9a\u4f4d\uff1a\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u786e\u5b9a\u6570\u636e\u5728\u73af\u4e0a\u7684\u4f4d\u7f6e</li> <li>\u8282\u70b9\u6620\u5c04\uff1a\u7269\u7406\u8282\u70b9\u5747\u5300\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a</li> <li>\u6269\u5bb9\u5f71\u54cd\u5c0f\uff1a\u8282\u70b9\u53d8\u5316\u53ea\u5f71\u54cd\u76f8\u90bb\u8282\u70b9\u6570\u636e</li> </ol> \u7279\u6027 \u4e00\u81f4\u6027\u54c8\u5e0c \u4f20\u7edf\u54c8\u5e0c \u6269\u5bb9\u5f71\u54cd \u53ea\u5f71\u54cd\u76f8\u90bb\u8282\u70b9 \u5f71\u54cd\u6240\u6709\u8282\u70b9 \u6570\u636e\u8fc1\u79fb\u91cf \u7ea61/N\uff08N\u4e3a\u8282\u70b9\u6570\uff09 \u51e0\u4e4e\u5168\u90e8\u6570\u636e \u6570\u636e\u5747\u8861\u6027 \u4f9d\u8d56\u865a\u62df\u8282\u70b9\u6570 \u5b8c\u5168\u5747\u8861 \u5b9e\u73b0\u590d\u6742\u5ea6 \u8f83\u9ad8 \u7b80\u5355 <p>\u914d\u7f6e</p> <pre><code>&lt;!-- schema.xml --&gt;\n&lt;table name=\"t_order\" primaryKey=\"order_id\" dataNode=\"dn1,dn2,dn3\" rule=\"sharding-by-murmur\"/&gt;\n\n\n&lt;!-- rule.xml --&gt;\n&lt;tableRule name=\"sharding-by-murmur\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;order_id&lt;/columns&gt;\n        &lt;algorithm&gt;murmur&lt;/algorithm&gt;\n    &lt;/rule&gt;\n&lt;/tableRule&gt;\n\n&lt;function name=\"murmur\" class=\"io.mycat.route.function.PartitionByMurmurHash\"&gt;\n    &lt;property name=\"seed\"&gt;0&lt;/property&gt; &lt;!-- \u54c8\u5e0c\u79cd\u5b50\uff0c\u9ed8\u8ba40 --&gt;\n    &lt;property name=\"count\"&gt;3&lt;/property&gt; &lt;!-- \u7269\u7406\u8282\u70b9\u6570 --&gt;\n    &lt;property name=\"virtualBucketTimes\"&gt;160&lt;/property&gt; &lt;!-- \u865a\u62df\u8282\u70b9\u500d\u6570 --&gt;\n&lt;/function&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u679a\u4e3e\u5206\u7247","title":"\u679a\u4e3e\u5206\u7247","text":"<p>\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u53ef\u80fd\u7684\u679a\u4e3e\u503c, \u6307\u5b9a\u6570\u636e\u5206\u5e03\u5230\u4e0d\u540c\u6570\u636e\u8282\u70b9\u4e0a, \u672c\u89c4\u5219\u9002\u7528\u4e8e\u6309\u7167\u7701\u4efd\u3001\u6027 \u522b\u3001\u72b6\u6001\u62c6\u5206\u6570\u636e\u7b49\u4e1a\u52a1</p> <pre><code>&lt;table name=\"tb_user\" dataNode=\"dn4,dn5,dn6\" rule=\"sharding-by-intfile-enumstatus\" /&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5e94\u7528\u6307\u5b9a","title":"\u5e94\u7528\u6307\u5b9a","text":"<p>\u8fd0\u884c\u9636\u6bb5\u7531\u5e94\u7528\u81ea\u4e3b\u51b3\u5b9a\u8def\u7531\u5230\u90a3\u4e2a\u5206\u7247 , \u76f4\u63a5\u6839\u636e\u5b57\u7b26\u5b50\u4e32\uff08\u5fc5\u987b\u662f\u6570\u5b57\uff09\u8ba1\u7b97\u5206\u7247\u53f7</p> <pre><code>&lt;table name=\"tb_app\" dataNode=\"dn4,dn5,dn6\" rule=\"sharding-by-substring\" /&gt;\n\n\n\n&lt;tableRule name=\"sharding-by-substring\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;id&lt;/columns&gt;\n        &lt;algorithm&gt;sharding-by-substring&lt;/algorithm&gt;\n    &lt;/rule&gt;\n &lt;/tableRule&gt;\n &lt;function name=\"sharding-by-substring\" class=\"io.mycat.route.function.PartitionDirectBySubString\"&gt;\n    &lt;property name=\"startIndex\"&gt;0&lt;/property&gt; &lt;!-- zero-based --&gt;\n    &lt;property name=\"size\"&gt;2&lt;/property&gt;\n    &lt;property name=\"partitionCount\"&gt;3&lt;/property&gt;\n    &lt;property name=\"defaultPartition\"&gt;0&lt;/property&gt;\n &lt;/function&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u56fa\u5b9a\u5206\u7247hash\u7b97\u6cd5","title":"\u56fa\u5b9a\u5206\u7247hash\u7b97\u6cd5","text":"<p>\u56fa\u5b9a\u5206\u7247\u54c8\u5e0c\u7b97\u6cd5\uff08PartitionByLong\uff09\u662f MyCat \u4e2d\u6700\u5e38\u7528\u7684\u5206\u7247\u7b97\u6cd5\u4e4b\u4e00\uff0c\u5b83\u901a\u8fc7\u5bf9\u5206\u7247\u5b57\u6bb5\u503c\u8fdb\u884c\u56fa\u5b9a\u8303\u56f4\u7684\u54c8\u5e0c\u8ba1\u7b97\u6765\u786e\u5b9a\u6570\u636e\u5206\u5e03\u3002</p> <ol> <li>\u56fa\u5b9a\u8303\u56f4\u5206\u7247\uff1a\u901a\u8fc7\u914d\u7f6e\u786e\u5b9a\u6bcf\u4e2a\u5206\u7247\u7684\u6570\u503c\u8303\u56f4</li> <li>\u7b80\u5355\u9ad8\u6548\uff1a\u76f4\u63a5\u57fa\u4e8e\u6570\u503c\u8ba1\u7b97\uff0c\u6027\u80fd\u4f18\u5f02</li> <li>\u5747\u5300\u5206\u5e03\uff1a\u6570\u636e\u5728\u5206\u7247\u95f4\u5747\u5300\u5206\u5e03\uff08\u53d6\u51b3\u4e8e\u5206\u7247\u952e\uff09</li> <li>\u53ef\u9884\u6d4b\u6027\uff1a\u53ef\u4ee5\u51c6\u786e\u9884\u5224\u6570\u636e\u6240\u5728\u5206\u7247\u4f4d\u7f6e</li> </ol> <pre><code>&lt;tableRule name=\"sharding-by-long\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;user_id&lt;/columns&gt;\n        &lt;algorithm&gt;mod-long&lt;/algorithm&gt;\n    &lt;/rule&gt;\n&lt;/tableRule&gt;\n\n&lt;function name=\"mod-long\" class=\"io.mycat.route.function.PartitionByLong\"&gt;\n    &lt;property name=\"partitionCount\"&gt;2,1&lt;/property&gt;  &lt;!-- \u5206\u7247\u6570\u91cf\u914d\u7f6e --&gt;\n    &lt;property name=\"partitionLength\"&gt;512,256&lt;/property&gt; &lt;!-- \u5206\u7247\u8303\u56f4\u914d\u7f6e --&gt;\n&lt;/function&gt;\n</code></pre> partitionCount \u662f \u5206\u533a\u95f4\u6570\u91cf\u914d\u7f6e \"2,1\" \u8868\u793a2\u4e2a\u5206\u533a\uff0c\u7b2c1\u4e2a\u5206\u533a1\u4efd partitionLength \u662f \u6bcf\u4e2a\u5206\u533a\u7684\u8303\u56f4\u957f\u5ea6 \"512,256\" \u8868\u793a\u7b2c1\u5206\u533a\u6bcf\u4efd512\uff0c\u7b2c2\u5206\u533a\u6bcf\u4efd256 hashSlice \u5426 \u54c8\u5e0c\u53d6\u6a21\u90e8\u5206\u5b57\u7b26\u4e32 \"0:2\" \u8868\u793a\u53d6\u524d2\u4e2a\u5b57\u7b26"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u5b57\u7b26\u4e32hash\u89e3\u6790\u7b97\u6cd5","title":"\u5b57\u7b26\u4e32hash\u89e3\u6790\u7b97\u6cd5","text":"<p>\u622a\u53d6\u5b57\u7b26\u4e32\u4e2d\u7684\u6307\u5b9a\u4f4d\u7f6e\u7684\u5b50\u5b57\u7b26\u4e32, \u8fdb\u884chash\u7b97\u6cd5\uff0c \u7b97\u51fa\u5206\u7247\u3002</p> <pre><code> &lt;table name=\"tb_strhash\" dataNode=\"dn4,dn5\" rule=\"sharding-by-stringhash\" /&gt;\n\n\n\n&lt;tableRule name=\"sharding-by-stringhash\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;name&lt;/columns&gt;\n        &lt;algorithm&gt;sharding-by-stringhash&lt;/algorithm&gt;\n    &lt;/rule&gt;\n &lt;/tableRule&gt;\n &lt;function name=\"sharding-by-stringhash\" class=\"io.mycat.route.function.PartitionByString\"&gt;\n    &lt;property name=\"partitionLength\"&gt;512&lt;/property&gt; &lt;!-- zero-based --&gt;\n    &lt;property name=\"partitionCount\"&gt;2&lt;/property&gt;\n    &lt;property name=\"hashSlice\"&gt;0:2&lt;/property&gt;\n &lt;/function&gt;\n</code></pre> <p>Tip</p> <p>hashSlice: hash\u8fd0\u7b97\u4f4d , \u6839\u636e\u5b50\u5b57\u7b26\u4e32\u7684hash\u8fd0\u7b97 ; 0 \u4ee3\u8868 str.length() , -1 \u4ee3\u8868 str.length()-1 , \u5927\u4e8e0\u53ea\u4ee3\u8868\u6570\u5b57\u81ea\u8eab ; \u53ef\u4ee5\u7406\u89e3 \u4e3asubstring\uff08start\uff0cend\uff09\uff0cstart\u4e3a0\u5219\u53ea\u8868\u793a0</p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6309\u5929\u5206\u7247","title":"\u6309\u5929\u5206\u7247","text":"<p>\u6309\u7167\u65e5\u671f\u53ca\u5bf9\u5e94\u7684\u65f6\u95f4\u5468\u671f\u6765\u5206\u7247\u3002</p> <pre><code>&lt;table name=\"tb_datepart\" dataNode=\"dn4,dn5,dn6\" rule=\"sharding-by-date\" /&gt;\n\n\n\n &lt;tableRule name=\"sharding-by-date\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;create_time&lt;/columns&gt;\n        &lt;algorithm&gt;sharding-by-date&lt;/algorithm&gt;\n    &lt;/rule&gt;\n &lt;/tableRule&gt;\n\n &lt;function name=\"sharding-by-date\" class=\"io.mycat.route.function.PartitionByDate\"&gt;\n    &lt;property name=\"dateFormat\"&gt;yyyy-MM-dd&lt;/property&gt;\n    &lt;property name=\"sBeginDate\"&gt;2022-01-01&lt;/property&gt;\n    &lt;property name=\"sEndDate\"&gt;2022-01-30&lt;/property&gt;\n    &lt;property name=\"sPartionDay\"&gt;10&lt;/property&gt;\n &lt;/function&gt;\n &lt;!--\n    \u4ece\u5f00\u59cb\u65f6\u95f4\u5f00\u59cb\uff0c\u6bcf10\u5929\u4e3a\u4e00\u4e2a\u5206\u7247\uff0c\u5230\u8fbe\u7ed3\u675f\u65f6\u95f4\u4e4b\u540e\uff0c\u4f1a\u91cd\u590d\u5f00\u59cb\u5206\u7247\u63d2\u5165\n     \u914d\u7f6e\u8868\u7684 dataNode \u7684\u5206\u7247\uff0c\u5fc5\u987b\u548c\u5206\u7247\u89c4\u5219\u6570\u91cf\u4e00\u81f4\uff0c\u4f8b\u5982 2022-01-01 \u5230 2022-12-31 \uff0c\u6bcf\n10\u5929\u4e00\u4e2a\u5206\u7247\uff0c\u4e00\u5171\u9700\u898137\u4e2a\u5206\u7247\u3002\n --&gt;\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u6309\u6708\u5206\u7247","title":"\u6309\u6708\u5206\u7247","text":"<p>\u4f7f\u7528\u573a\u666f\u4e3a\u6309\u7167\u6708\u4efd\u6765\u5206\u7247, \u6bcf\u4e2a\u81ea\u7136\u6708\u4e3a\u4e00\u4e2a\u5206\u7247\u3002</p> <pre><code>&lt;table name=\"tb_monthpart\" dataNode=\"dn4,dn5,dn6\" rule=\"sharding-by-month\" /&gt;\n\n\n &lt;tableRule name=\"sharding-by-month\"&gt;\n    &lt;rule&gt;\n        &lt;columns&gt;create_time&lt;/columns&gt;\n        &lt;algorithm&gt;partbymonth&lt;/algorithm&gt;\n    &lt;/rule&gt;\n &lt;/tableRule&gt;\n\n&lt;function name=\"partbymonth\" class=\"io.mycat.route.function.PartitionByMonth\"&gt;\n    &lt;property name=\"dateFormat\"&gt;yyyy-MM-dd&lt;/property&gt;\n    &lt;property name=\"sBeginDate\"&gt;2022-01-01&lt;/property&gt;\n    &lt;property name=\"sEndDate\"&gt;2022-03-31&lt;/property&gt;\n &lt;/function&gt;\n &lt;!-- \n    \u4ece\u5f00\u59cb\u65f6\u95f4\u5f00\u59cb\uff0c\u4e00\u4e2a\u6708\u4e3a\u4e00\u4e2a\u5206\u7247\uff0c\u5230\u8fbe\u7ed3\u675f\u65f6\u95f4\u4e4b\u540e\uff0c\u4f1a\u91cd\u590d\u5f00\u59cb\u5206\u7247\u63d2\u5165\n    \u914d\u7f6e\u8868\u7684 dataNode \u7684\u5206\u7247\uff0c\u5fc5\u987b\u548c\u5206\u7247\u89c4\u5219\u6570\u91cf\u4e00\u81f4\uff0c\u4f8b\u5982 2022-01-01 \u5230 2022-12-31 \uff0c\u4e00\n\u5171\u9700\u898112\u4e2a\u5206\u7247\u3002--\n</code></pre>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#mycat\u7ba1\u7406","title":"MyCat\u7ba1\u7406","text":"<p>Mycat\u9ed8\u8ba4\u5f00\u901a2\u4e2a\u7aef\u53e3\uff0c\u53ef\u4ee5\u5728server.xml\u4e2d\u8fdb\u884c\u4fee\u6539\u3002 </p> <ul> <li>8066 \u6570\u636e\u8bbf\u95ee\u7aef\u53e3\uff0c\u5373\u8fdb\u884c DML \u548c DDL \u64cd\u4f5c\u3002 </li> <li>9066 \u6570\u636e\u5e93\u7ba1\u7406\u7aef\u53e3\uff0c\u5373 mycat \u670d\u52a1\u7ba1\u7406\u63a7\u5236\u529f\u80fd\uff0c\u7528\u4e8e\u7ba1\u7406mycat\u7684\u6574\u4e2a\u96c6\u7fa4\u72b6\u6001 \u8fde\u63a5MyCat\u7684\u7ba1\u7406\u63a7\u5236\u53f0</li> </ul> <pre><code> mysql   -h  192.168.200.210  -p  9066   -uroot   -p123456\n</code></pre> \u547d\u4ee4 \u8bf4\u660e <code>show @@version;</code> \u67e5\u770bMyCat\u7248\u672c <code>show @@server;</code> \u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001 <code>show @@threadpool;</code> \u67e5\u770b\u7ebf\u7a0b\u6c60\u72b6\u6001 <code>show @@processor;</code> \u67e5\u770b\u5904\u7406\u5668\u72b6\u6001 <code>show @@connection;</code> \u67e5\u770b\u8fde\u63a5\u72b6\u6001 <code>show @@backend;</code> \u67e5\u770b\u540e\u7aef\u8fde\u63a5\u72b6\u6001 \u547d\u4ee4 \u8bf4\u660e <code>show @@datanode;</code> \u67e5\u770b\u6570\u636e\u8282\u70b9\u4fe1\u606f <code>show @@datanode where schema=?'</code> \u67e5\u770b\u6307\u5b9aschema\u7684\u8282\u70b9 <code>reload @@datanode</code> \u91cd\u8f7d\u6570\u636e\u8282\u70b9\u914d\u7f6e <code>switch @@datasource name:index</code> \u5207\u6362\u6570\u636e\u6e90(\u4e3b\u4ece\u5207\u6362) \u547d\u4ee4 \u8bf4\u660e <code>show @@sql;</code> \u67e5\u770b\u5f53\u524d\u6267\u884c\u7684SQL <code>show @@sql.slow;</code> \u67e5\u770b\u6162SQL <code>show @@sql.sum;</code> \u67e5\u770bSQL\u6267\u884c\u7edf\u8ba1 <code>show @@sql.where id=?</code> \u67e5\u770b\u6307\u5b9aSQL\u8be6\u60c5 <code>kill @@connection id1,id2,...</code> \u7ec8\u6b62\u6307\u5b9a\u8fde\u63a5 \u547d\u4ee4 \u8bf4\u660e <code>reload @@config</code> \u91cd\u8f7d\u6240\u6709\u914d\u7f6e\u6587\u4ef6 <code>reload @@config_all</code> \u91cd\u8f7d\u6240\u6709\u914d\u7f6e\u5e76\u6e05\u7406\u7f13\u5b58 <code>reload @@route</code> \u91cd\u8f7d\u8def\u7531\u914d\u7f6e <code>reload @@user</code> \u91cd\u8f7d\u7528\u6237\u6743\u9650 <p>MyCat\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7ba1\u7406\u76d1\u63a7\u5e73\u53f0MyCat-Web\uff08MyCat-eye\uff09\u3002 Mycat-web \u662f Mycat \u53ef\u89c6\u5316\u8fd0\u7ef4\u7684\u7ba1\u7406\u548c\u76d1\u63a7\u5e73\u53f0\u3002</p> <p>Note</p> <p>MyCat-eye\u4f9d\u8d56zookeeper\uff0c\u9700\u5148\u5b89\u88c5zookeeper</p>"},{"location":"MySQL/%E8%BF%90%E7%BB%B4/#\u8bfb\u5199\u5206\u79bb","title":"\u8bfb\u5199\u5206\u79bb","text":"<p>\u8bfb\u5199\u5206\u79bb,\u7b80\u5355\u5730\u8bf4\u662f\u628a\u5bf9\u6570\u636e\u5e93\u7684\u8bfb\u548c\u5199\u64cd\u4f5c\u5206\u5f00,\u4ee5\u5bf9\u5e94\u4e0d\u540c\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u3002\u4e3b\u6570\u636e\u5e93\u63d0\u4f9b\u5199\u64cd\u4f5c\uff0c\u4ece\u6570\u636e\u5e93\u63d0\u4f9b\u8bfb\u64cd\u4f5c\uff0c\u8fd9\u6837\u80fd\u6709\u6548\u5730\u51cf\u8f7b\u5355\u53f0\u6570\u636e\u5e93\u7684\u538b\u529b\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li>\u914d\u7f6eMySQL\u4e3b\u4ece\u590d\u5236\uff081\u4e3bN\u4ece\uff09</li> <li>\u786e\u4fdd\u4e3b\u4ece\u540c\u6b65\u6b63\u5e38\uff08<code>SHOW SLAVE STATUS</code>\u68c0\u67e5\uff09</li> <li>\u5efa\u8bae\u4ece\u5e93\u914d\u7f6e<code>read_only=1</code>\u9632\u6b62\u8bef\u5199\u5165</li> </ol> <p>\u914d\u7f6e<code>schema.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;!DOCTYPE mycat:schema SYSTEM \"schema.dtd\"&gt;\n&lt;mycat:schema xmlns:mycat=\"http://io.mycat/\"&gt;\n\n    &lt;!-- \u5b9a\u4e49\u903b\u8f91\u5e93 --&gt;\n    &lt;schema name=\"TESTDB\" checkSQLschema=\"true\" sqlMaxLimit=\"100\"&gt;\n        &lt;!-- \u6240\u6709\u8868\u9ed8\u8ba4\u4f7f\u7528\u8bfb\u5199\u5206\u79bb --&gt;\n        &lt;table name=\"tb1\" primaryKey=\"id\" dataNode=\"dn1\"/&gt;\n    &lt;/schema&gt;\n\n    &lt;!-- \u5b9a\u4e49\u6570\u636e\u8282\u70b9 --&gt;\n    &lt;dataNode name=\"dn1\" dataHost=\"localhost1\" database=\"testdb\" /&gt;\n\n    &lt;!-- \u5b9a\u4e49\u6570\u636e\u4e3b\u673a --&gt;\n    &lt;dataHost name=\"localhost1\" maxCon=\"1000\" minCon=\"10\" balance=\"1\" writeType=\"0\" dbType=\"mysql\" dbDriver=\"native\" switchType=\"1\"  slaveThreshold=\"100\"&gt;\n        &lt;!-- \u5fc3\u8df3\u68c0\u6d4bSQL --&gt;\n        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\n\n        &lt;!-- \u5199\u8282\u70b9(\u4e3b\u5e93)\u914d\u7f6e --&gt;\n        &lt;writeHost host=\"hostM1\" url=\"192.168.1.100:3306\" user=\"root\" password=\"123456\"&gt;\n            &lt;!-- \u8bfb\u8282\u70b9(\u4ece\u5e93)\u914d\u7f6e --&gt;\n            &lt;readHost host=\"hostS1\" url=\"192.168.1.101:3306\" user=\"root\" password=\"123456\" /&gt;\n            &lt;readHost host=\"hostS2\" url=\"192.168.1.102:3306\" user=\"root\" password=\"123456\" /&gt;\n        &lt;/writeHost&gt;\n\n        &lt;!-- \u53ef\u914d\u7f6e\u5907\u7528\u5199\u8282\u70b9(\u4e3b\u4ece\u5207\u6362\u65f6\u4f7f\u7528) --&gt;\n        &lt;!-- &lt;writeHost host=\"hostM2\" url=\"192.168.1.103:3306\" user=\"root\" password=\"123456\"/&gt; --&gt;\n    &lt;/dataHost&gt;\n&lt;/mycat:schema&gt;\n</code></pre> \u53c2\u6570 \u503c \u8bf4\u660e balance 0 \u4e0d\u5f00\u542f\u8bfb\u5199\u5206\u79bb 1 \u5168\u90e8\u8bfb\u64cd\u4f5c\u968f\u673a\u5206\u53d1\u5230readHost 2 \u8bfb\u64cd\u4f5c\u6309\u6743\u91cd\u5206\u53d1\u5230\u6240\u6709host 3 \u8bfb\u64cd\u4f5c\u53ea\u5206\u53d1\u5230writeHost\u5bf9\u5e94\u7684readHost writeType 0 \u6240\u6709\u5199\u64cd\u4f5c\u53d1\u9001\u5230\u7b2c\u4e00\u4e2awriteHost 1 \u968f\u673a\u53d1\u9001\u5230writeHost switchType 1 \u81ea\u52a8\u5207\u6362(\u9ed8\u8ba4) 2 \u57fa\u4e8eMySQL\u4e3b\u4ece\u540c\u6b65\u72b6\u6001\u5207\u6362 3 \u624b\u52a8\u5207\u6362 <p>\u591a\u4e3b\u4ece\u914d\u7f6e\u65b9\u5f0f\uff08\u9ad8\u53ef\u7528\uff09</p> <pre><code>&lt;dataHost ... balance=\"1\" writeType=\"1\"&gt;\n\n  &lt;writeHost host=\"hostM1\" url=\"master1:3306\"...&gt;\n    &lt;readHost .../&gt;\n  &lt;/writeHost&gt;\n\n  &lt;writeHost host=\"hostM2\" url=\"master2:3306\"...&gt;\n    &lt;readHost .../&gt;\n  &lt;/writeHost&gt;\n\n&lt;/dataHost&gt;\n</code></pre> <p>Tip</p> <p>\u4e3b\u8282\u70b9\u4e4b\u95f4\u4e5f\u4e92\u4e3a\u4e3b\u4ece</p> <p>\u5b8c\u7ed3\u6492\u82b1\u30fd( \u2022\u0300 \u03c9 \u2022\u0301 )\u2727</p>"},{"location":"MySQL/%E9%94%81/","title":"\u9501","text":""},{"location":"MySQL/%E9%94%81/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u9501\u662f\u8ba1\u7b97\u673a\u534f\u8c03\u591a\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u67d0\u4e00\u8d44\u6e90\u7684\u673a\u5236\u3002\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u9664\u4f20\u7edf\u7684\u8ba1\u7b97\u8d44\u6e90\uff08CPU\u3001 RAM\u3001I/O\uff09\u4ee5\u5916\uff0c\u6570\u636e\u4e5f\u662f\u4e00\u79cd\u4f9b\u8bb8\u591a\u7528\u6237\u5171\u4eab\u7684\u8d44\u6e90\u3002</p> <p>MySQL\u4e2d\u7684\u9501\uff0c\u6309\u7167\u9501\u7684\u7c92\u5ea6\u5206\uff0c\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b\uff1a </p> <ul> <li>\u5168\u5c40\u9501\uff1a\u9501\u5b9a\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\u3002 </li> <li>\u8868\u7ea7\u9501\uff1a\u6bcf\u6b21\u64cd\u4f5c\u9501\u4f4f\u6574\u5f20\u8868\u3002 </li> <li>\u884c\u7ea7\u9501\uff1a\u6bcf\u6b21\u64cd\u4f5c\u9501\u4f4f\u5bf9\u5e94\u7684\u884c\u6570\u636e\u3002</li> </ul> <p></p>"},{"location":"MySQL/%E9%94%81/#\u5168\u5c40\u9501","title":"\u5168\u5c40\u9501","text":"<p>\u5168\u5c40\u9501\u5c31\u662f\u5bf9\u6574\u4e2a\u6570\u636e\u5e93\u5b9e\u4f8b\u52a0\u9501\uff0c\u52a0\u9501\u540e\u6574\u4e2a\u5b9e\u4f8b\u5c31\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\uff0c\u540e\u7eed\u7684DML\u7684\u5199\u8bed\u53e5\uff0cDDL\u8bed\u53e5\uff0c\u5df2\u7ecf\u66f4\u65b0\u64cd\u4f5c\u7684\u4e8b\u52a1\u63d0\u4ea4\u8bed\u53e5\u90fd\u5c06\u88ab\u963b\u585e\u3002</p> <p>\u5176\u5178\u578b\u7684\u4f7f\u7528\u573a\u666f\u662f\u505a\u5168\u5e93\u7684\u903b\u8f91\u5907\u4efd\uff0c\u5bf9\u6240\u6709\u7684\u8868\u8fdb\u884c\u9501\u5b9a\uff0c\u4ece\u800c\u83b7\u53d6\u4e00\u81f4\u6027\u89c6\u56fe\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002</p> <p>Warning</p> <p>\u4e0d\u52a0\u5168\u5c40\u9501\u7684\u60c5\u51b5\u4e0b\u5907\u4efd\u53ef\u80fd\u53d1\u751f\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898</p> <p></p> <pre><code>-- \u52a0\u5168\u5c40\u9501\nflush tables with read lock;\n\n-- \u903b\u8f91\u5907\u4efd\nmysqldump  -uroot \u2013p******  database_name &gt; database_backup.sql;\n\n-- \u91ca\u653e\u9501\nunlock tables;\n</code></pre> <p>\u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u5f88\u591a\u4e1a\u52a1\u90fd\u4f1a\u963b\u585e\uff0c\u5728InnoDB\u5f15\u64ce\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5907\u4efd\u65f6\u52a0\u4e0a\u53c2\u6570 --single-transaction \u53c2\u6570\u6765\u5b8c\u6210\u4e0d\u52a0\u9501\u7684\u4e00\u81f4\u6027\u6570\u636e\u5907\u4efd\u3002</p> <pre><code>mysqldump --single-transaction -uroot \u2013p******  database_name &gt; database_backup.sql;\n</code></pre> <p>Note</p> <p>\u8be5\u547d\u4ee4\u4f1a\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\u5e76\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b\u4e3a<code>REPEATABLE READ</code>\uff0c\u901a\u8fc7<code>START TRANSACTION WITH CONSISTENT SNAPSHOT</code>\u521b\u5efa\u4e00\u81f4\u6027\u89c6\u56fe\u3002\u5907\u4efd\u8fc7\u7a0b\u4e2d\u8bfb\u53d6\u7684\u90fd\u662f\u4e8b\u52a1\u5f00\u59cb\u65f6\u7684\u4e00\u81f4\u6027\u6570\u636e\u5feb\u7167\uff0c\u4e0d\u53d7\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u4fee\u6539\u7684\u5f71\u54cd</p> <p></p>"},{"location":"MySQL/%E9%94%81/#\u8868\u7ea7\u9501","title":"\u8868\u7ea7\u9501","text":"<p>\u6709\u4e09\u7c7b\u8868\u7ea7\u9501\uff1a</p> <ul> <li>\u8868\u9501 </li> <li>\u5143\u6570\u636e\u9501\uff08meta data lock\uff0cMDL\uff09 </li> <li>\u610f\u5411\u9501</li> </ul> <p>1.\u8868\u9501\u53c8\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u8868\u5171\u4eab\u8bfb\u9501\uff08\u591a\u5ba2\u6237\u7aef\u8bfb\uff09</li> <li>\u8868\u72ec\u5360\u5199\u9501\uff08\u5355\u5ba2\u6237\u7aef\u8bfb\u5199\uff09</li> </ul> <pre><code>-- \u52a0\u9501\nlock tables table_name read/write;\n\n-- \u91ca\u653e\u9501\nunlock tables;\n</code></pre> <p>Note</p> <p>\u8bfb\u9501\u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u5ba2\u6237\u7aef\u7684\u8bfb\uff0c\u4f46\u662f\u4f1a\u963b\u585e\u5199\u3002\u5199\u9501\u65e2\u4f1a\u963b\u585e\u5176\u4ed6\u5ba2\u6237\u7aef\u7684\u8bfb\uff0c\u53c8\u4f1a\u963b\u585e\u5176\u4ed6\u5ba2\u6237\u7aef\u7684\u5199\u3002</p> <p>2.\u5143\u6570\u636e\u9501\uff08MDL\uff09\u52a0\u9501\u8fc7\u7a0b\u662f\u7cfb\u7edf\u81ea\u52a8\u63a7\u5236\uff0c\u65e0\u9700\u663e\u5f0f\u4f7f\u7528\uff0c\u5728\u8bbf\u95ee\u4e00\u5f20\u8868\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u52a0\u4e0a\u3002</p> <p>MDL\u9501\u4e3b\u8981\u4f5c\u7528\u662f\u7ef4\u62a4\u8868\u5143\u6570\u636e\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u5728\u8868\u4e0a\u6709\u6d3b\u52a8\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u4e0d\u53ef\u4ee5\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\u3002\u4e3a\u4e86\u907f\u514dDML\u4e0e DDL\u51b2\u7a81\uff0c\u4fdd\u8bc1\u8bfb\u5199\u7684\u6b63\u786e\u6027\u3002</p> \u64cd\u4f5c\u7c7b\u578b MDL\u9501\u7c7b\u578b \u963b\u585e\u5173\u7cfb SELECT\u67e5\u8be2 SHARED_READ \u4e0d\u963b\u585e\u5176\u4ed6DML INSERT/UPDATE/DELETE SHARED_WRITE \u4e0d\u963b\u585e\u5176\u4ed6DML DDL\u64cd\u4f5c(ALTER\u7b49) EXCLUSIVE \u963b\u585e\u6240\u6709\u64cd\u4f5c \u624b\u52a8\u9501\u8868(READ) SHARED \u963b\u585eDDL \u624b\u52a8\u9501\u8868(WRITE) EXCLUSIVE \u963b\u585e\u6240\u6709\u64cd\u4f5c <p>3.\u4e3a\u4e86\u907f\u514dDML\u5728\u6267\u884c\u65f6\uff0c\u52a0\u7684\u884c\u9501\u4e0e\u8868\u9501\u7684\u51b2\u7a81\uff0c\u5728InnoDB\u4e2d\u5f15\u5165\u4e86\u610f\u5411\u9501</p> <p>Tip</p> <p>\u5047\u5982\u6ca1\u6709\u610f\u5411\u9501\uff0c\u5ba2\u6237\u7aef\u4e00\u5bf9\u8868\u52a0\u4e86\u884c\u9501\u540e\uff0c\u5ba2\u6237\u7aef\u4e8c\u4f1a\u68c0\u67e5\u5f53\u524d\u8868\u662f\u5426\u6709\u5bf9\u5e94\u7684\u884c\u9501\uff08\u9010\u884c\u904d\u5386\uff0c\u6548\u7387\u4f4e\uff09\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u6dfb\u52a0\u8868\u9501</p> <p>\u5ba2\u6237\u7aef\u5728\u6267\u884cDML\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5bf9\u6d89\u53ca\u7684\u884c\u52a0\u884c\u9501\uff0c\u540c\u65f6\u4e5f\u4f1a\u5bf9\u8be5\u8868\u52a0\u4e0a\u610f\u5411\u9501\uff0c\u800c\u5176\u4ed6\u5ba2\u6237\u7aef\uff0c\u5728\u5bf9\u8fd9\u5f20\u8868\u52a0\u8868\u9501\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u8be5\u8868\u4e0a\u6240\u52a0\u7684\u610f\u5411\u9501\u6765\u5224\u5b9a\u662f\u5426\u53ef\u4ee5\u6210\u529f\u52a0\u8868\u9501</p> <ul> <li>\u610f\u5411\u5171\u4eab\u9501(IS): \u7531\u8bed\u53e5select ... lock in share mode\u6dfb\u52a0\u3002\u4e0e\u8868\u9501\u5171\u4eab\u9501 (read)\u517c\u5bb9\uff0c\u4e0e\u8868\u9501\u6392\u4ed6\u9501(write)\u4e92\u65a5\u3002 </li> <li>\u610f\u5411\u6392\u4ed6\u9501(IX): \u7531insert\u3001update\u3001delete\u3001select...for update\u6dfb\u52a0 \u3002\u4e0e\u8868\u9501\u5171\u4eab\u9501(read)\u53ca\u6392\u4ed6\u9501(write)\u90fd\u4e92\u65a5\uff0c\u610f\u5411\u9501\u4e4b\u95f4\u4e0d\u4f1a\u4e92\u65a5\u3002</li> </ul> <p></p>"},{"location":"MySQL/%E9%94%81/#\u884c\u7ea7\u9501","title":"\u884c\u7ea7\u9501","text":"<p>\u884c\u7ea7\u9501\uff0c\u6bcf\u6b21\u64cd\u4f5c\u9501\u4f4f\u5bf9\u5e94\u7684\u884c\u6570\u636e\u3002\u9501\u5b9a\u7c92\u5ea6\u6700\u5c0f\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u4f4e\uff0c\u5e76\u53d1\u5ea6\u6700\u9ad8\u3002\u5e94\u7528\u5728 InnoDB\u5b58\u50a8\u5f15\u64ce\u4e2d\u3002</p> <p>InnoDB\u7684\u6570\u636e\u662f\u57fa\u4e8e\u7d22\u5f15\u7ec4\u7ec7\u7684\uff0c\u884c\u9501\u662f\u901a\u8fc7\u5bf9\u7d22\u5f15\u4e0a\u7684\u7d22\u5f15\u9879\u52a0\u9501\u6765\u5b9e\u73b0\u7684\uff0c\u800c\u4e0d\u662f\u5bf9\u8bb0\u5f55\u52a0\u7684\u9501\u3002</p> <ul> <li>\u884c\u9501\uff08Record Lock\uff09\uff1a\u9501\u5b9a\u5355\u4e2a\u884c\u8bb0\u5f55\u7684\u9501\uff0c\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5bf9\u6b64\u884c\u8fdb\u884cupdate\u548cdelete\u3002</li> <li>\u95f4\u9699\u9501\uff08Gap Lock\uff09\uff1a\u9501\u5b9a\u7d22\u5f15\u8bb0\u5f55\u95f4\u9699\uff08\u4e0d\u542b\u8be5\u8bb0\u5f55\uff09\uff0c\u786e\u4fdd\u7d22\u5f15\u8bb0\u5f55\u95f4\u9699\u4e0d\u53d8\uff0c\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u95f4\u9699\u8fdb\u884cinsert\uff0c\u4ea7\u751f\u5e7b\u8bfb\u3002</li> <li>\u4e34\u952e\u9501\uff08Next-Key Lock\uff09\uff1a\u884c\u9501\u548c\u95f4\u9699\u9501\u7ec4\u5408\uff0c\u540c\u65f6\u9501\u4f4f\u6570\u636e\uff0c\u5e76\u9501\u4f4f\u6570\u636e\u524d\u9762\u7684\u95f4\u9699Gap\u3002</li> </ul> <p>1.\u884c\u9501</p> <p>\u5171\u4eab\u9501\uff08S\uff09\uff1a\u5141\u8bb8\u4e00\u4e2a\u4e8b\u52a1\u8bfb\uff0c\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u83b7\u5f97\u76f8\u540c\u6570\u636e\u96c6\u7684\u6392\u5b83\u9501\u3002 </p> <p>\u6392\u4ed6\u9501\uff08X\uff09\uff1a\u5141\u8bb8\u83b7\u53d6\u6392\u4ed6\u9501\u7684\u4e8b\u52a1\u66f4\u65b0\u6570\u636e\uff0c\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u83b7\u5f97\u76f8\u540c\u6570\u636e\u96c6\u7684\u5171\u4eab\u9501\u548c\u6392\u4ed6\u9501\u3002</p> S X S \u517c\u5bb9 \u51b2\u7a81 X \u51b2\u7a81 \u51b2\u7a81 <p>\u52a0\u9501\u60c5\u51b5</p> SQL \u7c7b\u578b \u52a0\u9501\u65b9\u5f0f insert X \u81ea\u52a8 update X \u81ea\u52a8 delete X \u81ea\u52a8 select... - - select ... lock in share mode S \u624b\u52a8 select ... for update X \u624b\u52a8 <p>Warning</p> <p>\u5982\u679cwhere\u6761\u4ef6\u91cc\u7684\u5b57\u6bb5\u4e0d\u662f\u7d22\u5f15\u9879\uff0c\u884c\u9501\u4f1a\u5347\u7ea7\u4e3a\u8868\u9501</p> <p>2.\u95f4\u9699\u9501&amp;\u4e34\u952e\u9501</p> <ul> <li>\u7d22\u5f15\u4e0a\u7684\u7b49\u503c\u67e5\u8be2(\u552f\u4e00\u7d22\u5f15)\uff0c\u7ed9\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u9501\u65f6, \u4f18\u5316\u4e3a\u95f4\u9699\u9501 \u3002 </li> <li>\u7d22\u5f15\u4e0a\u7684\u7b49\u503c\u67e5\u8be2(\u975e\u552f\u4e00\u666e\u901a\u7d22\u5f15)\uff0c\u5411\u53f3\u904d\u5386\u65f6\u6700\u540e\u4e00\u4e2a\u503c\u4e0d\u6ee1\u8db3\u67e5\u8be2\u9700\u6c42\u65f6\uff0cnext-key  lock \u9000\u5316\u4e3a\u95f4\u9699\u9501\u3002 </li> <li>\u7d22\u5f15\u4e0a\u7684\u8303\u56f4\u67e5\u8be2(\u552f\u4e00\u7d22\u5f15)--\u4f1a\u8bbf\u95ee\u5230\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u7b2c\u4e00\u4e2a\u503c\u4e3a\u6b62\u3002</li> </ul> <p>Note</p> <p>\u95f4\u9699\u9501\u7684\u552f\u4e00\u76ee\u662f\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u95f4\u9699\u3002\u95f4\u9699\u9501\u53ef\u4ee5\u5171\u5b58\uff0c\u4e00\u4e2a\u4e8b\u52a1\u91c7\u7528\u7684\u95f4\u9699\u9501\u4e0d\u4f1a \u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5728\u540c\u4e00\u95f4\u9699\u4e0a\u91c7\u7528\u95f4\u9699\u9501\u3002</p>"},{"location":"Netty/Netty/","title":"Netty","text":"<p>[!Important]</p> <p>Netty \u7f51\u7edc\u7f16\u7a0b\u5f00\u5751\uff01\uff01\uff01q(\u2267\u25bd\u2266q)</p>"},{"location":"Netty/Netty/#nio\u57fa\u7840","title":"NIO\u57fa\u7840","text":"<p>[!Tip]</p> <p>NIO\uff1aNon-blocking I/O \u6216 New I/O</p>"},{"location":"Netty/Netty/#\u4e09\u5927\u7ec4\u4ef6","title":"\u4e09\u5927\u7ec4\u4ef6","text":""},{"location":"Netty/Netty/#channel--buffer","title":"Channel &amp; Buffer","text":"<p>channel \u6709\u4e00\u70b9\u7c7b\u4f3c\u4e8e stream\uff0c\u5b83\u5c31\u662f\u8bfb\u5199\u6570\u636e\u7684\u53cc\u5411\u901a\u9053\uff0c\u53ef\u4ee5\u4ece channel \u5c06\u6570\u636e\u8bfb\u5165 buffer\uff0c\u4e5f\u53ef\u4ee5\u5c06 buffer \u7684\u6570\u636e\u5199\u5165 channel\uff0c\u800c\u4e4b\u524d\u7684 stream \u8981\u4e48\u662f\u8f93\u5165\uff0c\u8981\u4e48\u662f\u8f93\u51fa\uff0cchannel \u6bd4 stream \u66f4\u4e3a\u5e95\u5c42</p> <pre><code>graph LR\nchannel --&gt; buffer\nbuffer --&gt; channel\n</code></pre> <p>\u5e38\u89c1\u7684 Channel \u6709</p> <ul> <li>FileChannel</li> <li>DatagramChannel</li> <li>SocketChannel</li> <li>ServerSocketChannel</li> </ul> <p>buffer \u5219\u7528\u6765\u7f13\u51b2\u8bfb\u5199\u6570\u636e\uff0c\u5e38\u89c1\u7684 buffer \u6709</p> <ul> <li>ByteBuffer</li> <li>MappedByteBuffer</li> <li>DirectByteBuffer</li> <li>HeapByteBuffer</li> <li>ShortBuffer</li> <li>IntBuffer</li> <li>LongBuffer</li> <li>FloatBuffer</li> <li>DoubleBuffer</li> <li>CharBuffer</li> </ul>"},{"location":"Netty/Netty/#selector","title":"Selector","text":"<p>\u4ece\u4f20\u7edf\u670d\u52a1\u5668\u8bbe\u8ba1\u5f00\u59cb\uff1a</p>"},{"location":"Netty/Netty/#\u591a\u7ebf\u7a0b\u7248\u8bbe\u8ba1","title":"\u591a\u7ebf\u7a0b\u7248\u8bbe\u8ba1","text":"<pre><code>graph TD\nsubgraph \u591a\u7ebf\u7a0b\u7248\nt1(thread) --&gt; s1(socket1)\nt2(thread) --&gt; s2(socket2)\nt3(thread) --&gt; s3(socket3)\nend\n</code></pre> <p>\u591a\u7ebf\u7a0b\u7248\u7f3a\u70b9\u26a0</p> <ul> <li>\u5185\u5b58\u5360\u7528\u9ad8</li> <li>\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6210\u672c\u9ad8</li> <li>\u53ea\u9002\u5408\u8fde\u63a5\u6570\u5c11\u7684\u573a\u666f</li> </ul>"},{"location":"Netty/Netty/#\u7ebf\u7a0b\u6c60\u7248\u8bbe\u8ba1","title":"\u7ebf\u7a0b\u6c60\u7248\u8bbe\u8ba1","text":"<pre><code>graph TD\nsubgraph \u7ebf\u7a0b\u6c60\u7248\nt4(thread) --&gt; s4(socket1)\nt5(thread) --&gt; s5(socket2)\nt4(thread) -.-&gt; s6(socket3)\nt5(thread) -.-&gt; s7(socket4)\nend\n</code></pre> <p>\u7ebf\u7a0b\u6c60\u7248\u7f3a\u70b9\u26a0\ufe0f</p> <ul> <li>\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u7ebf\u7a0b\u4ec5\u80fd\u5904\u7406\u4e00\u4e2a socket \u8fde\u63a5</li> <li>\u4ec5\u9002\u5408\u77ed\u8fde\u63a5\u573a\u666f</li> </ul>"},{"location":"Netty/Netty/#selector-\u7248\u8bbe\u8ba1","title":"selector \u7248\u8bbe\u8ba1","text":"<p>selector \u7684\u4f5c\u7528\u5c31\u662f\u914d\u5408\u4e00\u4e2a\u7ebf\u7a0b\u6765\u7ba1\u7406\u591a\u4e2a channel\uff0c\u83b7\u53d6\u8fd9\u4e9b channel \u4e0a\u53d1\u751f\u7684\u4e8b\u4ef6\uff0c\u8fd9\u4e9b channel \u5de5\u4f5c\u5728\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u4e0d\u4f1a\u8ba9\u7ebf\u7a0b\u540a\u6b7b\u5728\u4e00\u4e2a channel \u4e0a\u3002\u9002\u5408\u8fde\u63a5\u6570\u7279\u522b\u591a\uff0c\u4f46\u6d41\u91cf\u4f4e\u7684\u573a\u666f\uff08low traffic\uff09</p> <pre><code>  graph TD\nsubgraph selector \u7248\nthread --&gt; selector\nselector --&gt; c1(channel)\nselector --&gt; c2(channel)\nselector --&gt; c3(channel)\nend\n</code></pre> <p>\u8c03\u7528 selector \u7684 select() \u4f1a\u963b\u585e\u76f4\u5230 channel \u53d1\u751f\u4e86\u8bfb\u5199\u5c31\u7eea\u4e8b\u4ef6\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u53d1\u751f\uff0cselect \u65b9\u6cd5\u5c31\u4f1a\u8fd4\u56de\u8fd9\u4e9b\u4e8b\u4ef6\u4ea4\u7ed9 thread \u6765\u5904\u7406</p>"},{"location":"Netty/Netty/#bytebuffer","title":"ByteBuffer","text":""},{"location":"Netty/Netty/#\u793a\u4f8b","title":"\u793a\u4f8b","text":"<pre><code>@Slf4j\npublic class ChannelDemo1 {\n    public static void main(String[] args) {\n        try (RandomAccessFile file = new RandomAccessFile(\"data.txt\", \"rw\")) {\n            FileChannel channel = file.getChannel();\n            ByteBuffer buffer = ByteBuffer.allocate(10);\n            do {\n                // \u5411 buffer \u5199\u5165\n                int len = channel.read(buffer);\n                log.debug(\"\u8bfb\u5230\u5b57\u8282\u6570\uff1a{}\", len);\n                if (len == -1) {\n                    break;\n                }\n                // \u5207\u6362 buffer \u8bfb\u6a21\u5f0f\n                buffer.flip();\n                while(buffer.hasRemaining()) {\n                    log.debug(\"{}\", (char)buffer.get());\n                }\n                // \u5207\u6362 buffer \u5199\u6a21\u5f0f\n                buffer.clear();\n            } while (true);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre> <p>\u4f7f\u7528\u6b65\u9aa4\uff1a</p> <ol> <li>\u5411 buffer \u5199\u5165\u6570\u636e\uff0c\u4f8b\u5982\u8c03\u7528 channel.read(buffer)</li> <li>\u8c03\u7528 flip() \u5207\u6362\u81f3\u8bfb\u6a21\u5f0f</li> <li>\u4ece buffer \u8bfb\u53d6\u6570\u636e\uff0c\u4f8b\u5982\u8c03\u7528 buffer.get()</li> <li>\u8c03\u7528 clear() \u6216 compact() \u5207\u6362\u81f3\u5199\u6a21\u5f0f</li> </ol>"},{"location":"Netty/Netty/#\u7ed3\u6784","title":"\u7ed3\u6784","text":"<p>ByteBuffer \u6709\u4ee5\u4e0b\u91cd\u8981\u5c5e\u6027</p> <ul> <li>capacity</li> <li>position</li> <li>limit</li> </ul> <p>\u521d\u59cb\u72b6\u6001</p> <p></p> <p>\u5199\u6a21\u5f0f\u4e0b\uff0cposition \u662f\u5199\u5165\u4f4d\u7f6e\uff0climit \u7b49\u4e8e\u5bb9\u91cf\uff0c\u4e0b\u56fe\u8868\u793a\u5199\u5165\u4e86 4 \u4e2a\u5b57\u8282\u540e\u7684\u72b6\u6001</p> <p></p> <p>flip \u52a8\u4f5c\u53d1\u751f\u540e\uff0cposition \u5207\u6362\u4e3a\u8bfb\u53d6\u4f4d\u7f6e\uff0climit \u5207\u6362\u4e3a\u8bfb\u53d6\u9650\u5236</p> <p></p> <p>\u8bfb\u53d6 4 \u4e2a\u5b57\u8282\u540e\uff0c\u72b6\u6001</p> <p></p> <p>clear \u52a8\u4f5c\u53d1\u751f\u540e\uff0c\u72b6\u6001</p> <p></p> <p>compact \u65b9\u6cd5\uff0c\u662f\u628a\u672a\u8bfb\u5b8c\u7684\u90e8\u5206\u5411\u524d\u538b\u7f29\uff0c\u7136\u540e\u5207\u6362\u81f3\u5199\u6a21\u5f0f</p> <p></p>"},{"location":"Netty/Netty/#\u5e38\u89c1\u65b9\u6cd5","title":"\u5e38\u89c1\u65b9\u6cd5","text":""},{"location":"Netty/Netty/#\u5206\u914d\u7a7a\u95f4","title":"\u5206\u914d\u7a7a\u95f4","text":"<p>\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u5206\u914d</p> <pre><code>// \u5206\u914dJava\u5806\u5185\u5b58\nBytebuffer buffer = ByteBuffer.allocate(16);\n\n// \u5206\u914d\u76f4\u63a5\u5185\u5b58\uff0c\u5206\u914d\u6548\u7387\u8f83\u5806\u533a\u4f4e\uff0c\u8bfb\u5199\u6548\u7387\u9ad8\nByteBuffer buffer = ByteBuffer.allocateDirect(16);\n</code></pre>"},{"location":"Netty/Netty/#\u5199\u5165\u6570\u636e","title":"\u5199\u5165\u6570\u636e","text":"<p>\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>channel \u7684 read \u65b9\u6cd5</li> <li>buffer \u81ea\u5df1\u7684 put \u65b9\u6cd5</li> </ul> <pre><code>channel.read(buffer);\n\nbuffer.put((byte) 97);\n</code></pre>"},{"location":"Netty/Netty/#\u8bfb\u53d6\u6570\u636e","title":"\u8bfb\u53d6\u6570\u636e","text":"<p>\u540c\u6837\u6709\u4e24\u79cd\u529e\u6cd5</p> <ul> <li>channel \u7684 write \u65b9\u6cd5</li> <li>buffer \u81ea\u5df1\u7684 get \u65b9\u6cd5</li> </ul> <pre><code>channel.write(buffer);\n\nbuffer.get();\n</code></pre> <p>[!Note]</p> <pre><code>buffer.get(i);    // \u8bfb\u53d6\u4e0b\u6807i\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u6539\u53d8position\u7684\u503c\n\nbuffer.rewind(); // \u91cd\u65b0\u4ece\u5f00\u59cb\u4f4d\u7f6e\u8bfb\u53d6\n\nbuffer.mark();    // \u5728\u8be5\u4f4d\u7f6e\u505a\u4e00\u4e2a\u6807\u8bb0\nbuffer.reset();   // \u91cd\u7f6e\u5230mark\u6807\u8bb0\u4f4d\u7f6e\n</code></pre>"},{"location":"Netty/Netty/#\u8f6c\u6362\u5b57\u7b26\u4e32","title":"\u8f6c\u6362\u5b57\u7b26\u4e32","text":"<pre><code>ByteBuffer buffer = StandardCharsets.UTF_8.encode(\"\u4f60\u597d\");\n\nByteBuffer buffer = Charset.forName(\"utf-8\").encode(\"\u4f60\u597d\");\n\n\nbuffer.flip();\nString str = StandardCharsets.UTF_8.decode(buffer).toString();\n</code></pre> <p>[!Warning]</p> <p>Buffer \u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684</p>"},{"location":"Netty/Netty/#scattering-reads","title":"Scattering Reads","text":"<p>\u5206\u6563\u8bfb\u53d6</p> <pre><code>try (RandomAccessFile file = new RandomAccessFile(\"3parts.txt\", \"rw\")) {\n    FileChannel channel = file.getChannel();\n    ByteBuffer a = ByteBuffer.allocate(3);\n    ByteBuffer b = ByteBuffer.allocate(3);\n    ByteBuffer c = ByteBuffer.allocate(5);\n    channel.read(new ByteBuffer[]{a, b, c});\n    a.flip();\n    b.flip();\n    c.flip();\n    // ...\n} catch (IOException e) {\n    e.printStackTrace();\n}\n</code></pre>"},{"location":"Netty/Netty/#gathering-writes","title":"Gathering Writes","text":"<p>\u5c06\u591a\u4e2a buffer \u7684\u6570\u636e\u586b\u5145\u81f3 channel</p> <pre><code>try (RandomAccessFile file = new RandomAccessFile(\"3parts.txt\", \"rw\")) {\n    FileChannel channel = file.getChannel();\n    ByteBuffer d = ByteBuffer.allocate(4);\n    ByteBuffer e = ByteBuffer.allocate(4);\n    channel.position(11);\n\n    d.put(new byte[]{'f', 'o', 'u', 'r'});\n    e.put(new byte[]{'f', 'i', 'v', 'e'});\n    d.flip();\n    e.flip();\n    channel.write(new ByteBuffer[]{d, e});\n} catch (IOException e) {\n    e.printStackTrace();\n}\n</code></pre>"},{"location":"Netty/Netty/#\u6587\u4ef6\u7f16\u7a0b","title":"\u6587\u4ef6\u7f16\u7a0b","text":""},{"location":"Netty/Netty/#filechannel","title":"FileChannel","text":"<p>[!Warning]</p> <p>FileChannel \u53ea\u80fd\u5de5\u4f5c\u5728\u963b\u585e\u6a21\u5f0f\u4e0b</p>"},{"location":"Netty/Netty/#\u5f97\u5230filechannel","title":"\u5f97\u5230FileChannel","text":"<p>\u4e0d\u80fd\u76f4\u63a5\u6253\u5f00 FileChannel\uff0c\u5fc5\u987b\u901a\u8fc7 FileInputStream\u3001FileOutputStream \u6216\u8005 RandomAccessFile \u6765\u83b7\u53d6 FileChannel\uff0c\u5b83\u4eec\u90fd\u6709 getChannel \u65b9\u6cd5</p> <ul> <li>\u901a\u8fc7 FileInputStream \u83b7\u53d6\u7684 channel \u53ea\u80fd\u8bfb</li> <li>\u901a\u8fc7 FileOutputStream \u83b7\u53d6\u7684 channel \u53ea\u80fd\u5199</li> <li>\u901a\u8fc7 RandomAccessFile \u662f\u5426\u80fd\u8bfb\u5199\u6839\u636e\u6784\u9020 RandomAccessFile \u65f6\u7684\u8bfb\u5199\u6a21\u5f0f\u51b3\u5b9a</li> </ul>"},{"location":"Netty/Netty/#\u8bfb\u53d6","title":"\u8bfb\u53d6","text":"<p>\u4ece channel \u8bfb\u53d6\u6570\u636e\u586b\u5145 ByteBuffer\uff0c\u8fd4\u56de\u503c\u8868\u793a\u8bfb\u5230\u4e86\u591a\u5c11\u5b57\u8282\uff0c-1 \u8868\u793a\u5230\u8fbe\u4e86\u6587\u4ef6\u7684\u672b\u5c3e</p> <pre><code>int readBytes = channel.read(buffer);\n</code></pre>"},{"location":"Netty/Netty/#\u5199\u5165","title":"\u5199\u5165","text":"<pre><code>ByteBuffer buffer = ...;\nbuffer.put(...); // \u5b58\u5165\u6570\u636e\nbuffer.flip();   // \u5207\u6362\u8bfb\u6a21\u5f0f\n\nwhile(buffer.hasRemaining()) {\n    channel.write(buffer);\n}\n</code></pre> <p>[!Tip]</p> <p>\u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u6570\u636e\u7f13\u5b58\uff0c\u4e0d\u4f1a\u7acb\u523b\u5199\u5165\u78c1\u76d8\u3002</p> <p>\u53ef\u4ee5\u8c03\u7528 force(true)  \u65b9\u6cd5\u5c06\u6587\u4ef6\u5185\u5bb9\u548c\u5143\u6570\u636e\uff08\u6587\u4ef6\u7684\u6743\u9650\u7b49\u4fe1\u606f\uff09\u7acb\u523b\u5199\u5165\u78c1\u76d8\u3002</p>"},{"location":"Netty/Netty/#\u5173\u95ed","title":"\u5173\u95ed","text":"<p>channel \u5fc5\u987b\u5173\u95ed\uff0c\u4e0d\u8fc7\u8c03\u7528\u4e86 FileInputStream\u3001FileOutputStream \u6216\u8005 RandomAccessFile \u7684 close \u65b9\u6cd5\u4f1a\u95f4\u63a5\u5730\u8c03\u7528 channel \u7684 close \u65b9\u6cd5</p>"},{"location":"Netty/Netty/#\u4f4d\u7f6e","title":"\u4f4d\u7f6e","text":"<p>\u83b7\u53d6\u5f53\u524d\u4f4d\u7f6e</p> <pre><code>long pos = channel.position();\n</code></pre> <p>\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e</p> <pre><code>long newPos = ...;\nchannel.position(newPos);\n</code></pre> <p>\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e\u65f6\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a\u6587\u4ef6\u7684\u672b\u5c3e</p> <ul> <li>\u8fd9\u65f6\u8bfb\u53d6\u4f1a\u8fd4\u56de -1 </li> <li>\u8fd9\u65f6\u5199\u5165\uff0c\u4f1a\u8ffd\u52a0\u5185\u5bb9\uff0c\u4f46\u8981\u6ce8\u610f\u5982\u679c position \u8d85\u8fc7\u4e86\u6587\u4ef6\u672b\u5c3e\uff0c\u518d\u5199\u5165\u65f6\u5728\u65b0\u5185\u5bb9\u548c\u539f\u672b\u5c3e\u4e4b\u95f4\u4f1a\u6709\u7a7a\u6d1e\uff0800\uff09</li> </ul>"},{"location":"Netty/Netty/#channel\u4e92\u4f20","title":"Channel\u4e92\u4f20","text":"<pre><code>String FROM = \"from.txt\";\nString TO = \"to.txt\";\n\ntry (FileChannel from = new FileInputStream(FROM).getChannel();\n     FileChannel to = new FileOutputStream(TO).getChannel();) {\n    // \u4f20\u8f93\u6570\u636e\uff0c\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u96f6\u62f7\u8d1d\u4f18\u5316\u6548\u7387\u9ad8\n    from.transferTo(0, from.size(), to);\n} catch (IOException e) {\n    e.printStackTrace();\n}\n</code></pre> <p>[!Caution]</p> <p>channel\u4e00\u6b21\u6027\u6700\u5927\u652f\u63012G\u6570\u636e\u4f20\u8f93\uff0c\u8d85\u8fc72G\u7684\u6587\u4ef6\u53ef\u8fdb\u884c\u591a\u6b21\u4f20\u8f93</p> <pre><code>for (long left = size; left &gt; 0; ) {\n    left -= from.transferTo((size - left), left, to);\n}\n</code></pre>"},{"location":"Netty/Netty/#path","title":"Path","text":"<p>jdk7 \u5f15\u5165\u4e86 Path \u548c Paths \u7c7b</p> <ul> <li>Path \u7528\u6765\u8868\u793a\u6587\u4ef6\u8def\u5f84</li> <li>Paths \u662f\u5de5\u5177\u7c7b\uff0c\u7528\u6765\u83b7\u53d6 Path \u5b9e\u4f8b</li> </ul> <pre><code>Path source = Paths.get(\"1.txt\"); // \u76f8\u5bf9\u8def\u5f84 \u4f7f\u7528 user.dir \u73af\u5883\u53d8\u91cf\u6765\u5b9a\u4f4d 1.txt\n\nPath source = Paths.get(\"d:\\\\1.txt\"); // \u7edd\u5bf9\u8def\u5f84 d:\\1.txt\n\nPath source = Paths.get(\"d:/1.txt\"); // \u7edd\u5bf9\u8def\u5f84  d:\\1.txt\n\nPath projects = Paths.get(\"d:\\\\data\", \"projects\"); //  d:\\data\\projects\n</code></pre>"},{"location":"Netty/Netty/#files","title":"Files","text":"<pre><code>// \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\nPath path = Paths.get(\"helloword/data.txt\");\nboolean exist = Files.exists(path);\n\n// \u521b\u5efa\u76ee\u5f55\nPath path = Paths.get(\"helloword/d1\");\nFiles.createDirectory(path);\n\n\nPath source = Paths.get(\"helloword/data.txt\");\nPath target = Paths.get(\"helloword/target.txt\");\n// \u62f7\u8d1d\u6587\u4ef6\nFiles.copy(source, target);\n\n// \u79fb\u52a8\u6587\u4ef6\uff0cStandardCopyOption.ATOMIC_MOVE \u4fdd\u8bc1\u6587\u4ef6\u79fb\u52a8\u7684\u539f\u5b50\u6027\nFiles.move(source, target, StandardCopyOption.ATOMIC_MOVE);\n\n// \u5220\u9664\u6587\u4ef6\nFiles.delete(target);\n\n// \u904d\u5386\u6587\u4ef6\u53ca\u76ee\u5f55\nFiles.walkFileTree(Paths.get(\"E:/\"), new SimpleFileVisitor&lt;&gt;() {...});\n</code></pre>"},{"location":"Netty/Netty/#\u7f51\u7edc\u7f16\u7a0b","title":"\u7f51\u7edc\u7f16\u7a0b","text":""},{"location":"Netty/Netty/#\u963b\u585e-\u548c-\u975e\u963b\u585e","title":"\u963b\u585e \u548c \u975e\u963b\u585e","text":"<pre><code>ByteBuffer buffer = ByteBuffer.allocate(16);\n// 1. \u521b\u5efa\u670d\u52a1\u5668\nServerSocketChannel ssc = ServerSocketChannel.open();\n\n// 2. \u7ed1\u5b9a\u76d1\u542c\u7aef\u53e3\nssc.bind(new InetSocketAddress(8080));\n\n// 3. \u8fde\u63a5\u96c6\u5408\nList&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt;();\nwhile (true) {\n    // 4. accept \u5efa\u7acb\u4e0e\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c SocketChannel \u7528\u6765\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u901a\u4fe1\n    log.debug(\"connecting...\");\n    SocketChannel sc = ssc.accept(); // \u963b\u585e\u65b9\u6cd5\uff0c\u7ebf\u7a0b\u505c\u6b62\u8fd0\u884c\n    log.debug(\"connected... {}\", sc);\n    channels.add(sc);\n    for (SocketChannel channel : channels) {\n        // 5. \u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\n        log.debug(\"before read... {}\", channel);\n        channel.read(buffer); // \u963b\u585e\u65b9\u6cd5\uff0c\u7ebf\u7a0b\u505c\u6b62\u8fd0\u884c\n        buffer.flip();\n        debugRead(buffer);\n        buffer.clear();\n        log.debug(\"after read...{}\", channel);\n    }\n}\n</code></pre> <p>[!Tip]</p> <pre><code>// \u8bbe\u7f6e\u4e3a\u975e\u963b\u585e\u6a21\u5f0f\nServerSocketChannel.configureBlocking(false);\n\nSocketChannel.configureBlocking(false);\n</code></pre>"},{"location":"Netty/Netty/#selector_1","title":"Selector","text":"<ul> <li>\u4e00\u4e2a\u7ebf\u7a0b\u914d\u5408 selector \u5c31\u53ef\u4ee5\u76d1\u63a7\u591a\u4e2a channel \u7684\u4e8b\u4ef6\uff0c\u4e8b\u4ef6\u53d1\u751f\u7ebf\u7a0b\u624d\u53bb\u5904\u7406\u3002\u907f\u514d\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\u6240\u505a\u65e0\u7528\u529f</li> <li>\u8ba9\u8fd9\u4e2a\u7ebf\u7a0b\u80fd\u591f\u88ab\u5145\u5206\u5229\u7528</li> <li>\u8282\u7ea6\u4e86\u7ebf\u7a0b\u7684\u6570\u91cf</li> <li>\u51cf\u5c11\u4e86\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362</li> </ul>"},{"location":"Netty/Netty/#\u521b\u5efa","title":"\u521b\u5efa","text":"<pre><code>Selector selector = Selector.open();\n</code></pre>"},{"location":"Netty/Netty/#\u7ed1\u5b9a-channel-\u4e8b\u4ef6","title":"\u7ed1\u5b9a Channel \u4e8b\u4ef6","text":"<p>\u4e5f\u79f0\u4e4b\u4e3a\u6ce8\u518c\u4e8b\u4ef6\uff0c\u7ed1\u5b9a\u7684\u4e8b\u4ef6 selector \u624d\u4f1a\u5173\u5fc3 </p> <pre><code>channel.configureBlocking(false);\nSelectionKey key = channel.register(selector, \u7ed1\u5b9a\u4e8b\u4ef6);\n</code></pre> <ul> <li>channel \u5fc5\u987b\u5de5\u4f5c\u5728\u975e\u963b\u585e\u6a21\u5f0f</li> <li>FileChannel \u6ca1\u6709\u975e\u963b\u585e\u6a21\u5f0f\uff0c\u56e0\u6b64\u4e0d\u80fd\u914d\u5408 selector \u4e00\u8d77\u4f7f\u7528</li> <li>\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u7c7b\u578b\u53ef\u4ee5\u6709</li> <li>connect - \u5ba2\u6237\u7aef\u8fde\u63a5\u6210\u529f\u65f6\u89e6\u53d1</li> <li>accept - \u670d\u52a1\u5668\u7aef\u6210\u529f\u63a5\u53d7\u8fde\u63a5\u65f6\u89e6\u53d1</li> <li>read - \u6570\u636e\u53ef\u8bfb\u5165\u65f6\u89e6\u53d1\uff0c\u6709\u56e0\u4e3a\u63a5\u6536\u80fd\u529b\u5f31\uff0c\u6570\u636e\u6682\u4e0d\u80fd\u8bfb\u5165\u7684\u60c5\u51b5</li> <li>write - \u6570\u636e\u53ef\u5199\u51fa\u65f6\u89e6\u53d1\uff0c\u6709\u56e0\u4e3a\u53d1\u9001\u80fd\u529b\u5f31\uff0c\u6570\u636e\u6682\u4e0d\u80fd\u5199\u51fa\u7684\u60c5\u51b5</li> </ul>"},{"location":"Netty/Netty/#\u76d1\u542c-channel-\u4e8b\u4ef6","title":"\u76d1\u542c Channel \u4e8b\u4ef6","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u4e09\u79cd\u65b9\u6cd5\u6765\u76d1\u542c\u662f\u5426\u6709\u4e8b\u4ef6\u53d1\u751f\uff0c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4ee3\u8868\u6709\u591a\u5c11 channel \u53d1\u751f\u4e86\u4e8b\u4ef6</p> <ul> <li>\u65b9\u6cd51\uff0c\u963b\u585e\u76f4\u5230\u7ed1\u5b9a\u4e8b\u4ef6\u53d1\u751f</li> </ul> <pre><code>int count = selector.select();\n</code></pre> <ul> <li>\u65b9\u6cd52\uff0c\u963b\u585e\u76f4\u5230\u7ed1\u5b9a\u4e8b\u4ef6\u53d1\u751f\uff0c\u6216\u662f\u8d85\u65f6\uff08\u65f6\u95f4\u5355\u4f4d\u4e3a ms\uff09</li> </ul> <pre><code>int count = selector.select(long timeout);\n</code></pre> <ul> <li>\u65b9\u6cd53\uff0c\u4e0d\u4f1a\u963b\u585e\uff0c\u4e5f\u5c31\u662f\u4e0d\u7ba1\u6709\u6ca1\u6709\u4e8b\u4ef6\uff0c\u7acb\u523b\u8fd4\u56de\uff0c\u81ea\u5df1\u6839\u636e\u8fd4\u56de\u503c\u68c0\u67e5\u662f\u5426\u6709\u4e8b\u4ef6</li> </ul> <pre><code>int count = selector.selectNow();\n</code></pre>"},{"location":"Netty/Netty/#select-\u4f55\u65f6\u4e0d\u963b\u585e","title":"select \u4f55\u65f6\u4e0d\u963b\u585e","text":"<p>[!Tip]</p> <ul> <li>\u4e8b\u4ef6\u53d1\u751f\u65f6</li> <li>\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\uff0c\u4f1a\u89e6\u53d1 accept \u4e8b\u4ef6</li> <li>\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u8fc7\u6765\uff0c\u5ba2\u6237\u7aef\u6b63\u5e38\u3001\u5f02\u5e38\u5173\u95ed\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1 read \u4e8b\u4ef6\uff0c\u53e6\u5916\u5982\u679c\u53d1\u9001\u7684\u6570\u636e\u5927\u4e8e buffer \u7f13\u51b2\u533a\uff0c\u4f1a\u89e6\u53d1\u591a\u6b21\u8bfb\u53d6\u4e8b\u4ef6</li> <li>channel \u53ef\u5199\uff0c\u4f1a\u89e6\u53d1 write \u4e8b\u4ef6</li> <li>\u5728 linux \u4e0b nio bug \u53d1\u751f\u65f6</li> <li>\u8c03\u7528 selector.wakeup()</li> <li>\u8c03\u7528 selector.close()</li> <li>selector \u6240\u5728\u7ebf\u7a0b interrupt</li> </ul>"},{"location":"Netty/Netty/#\u5904\u7406accept\u4e8b\u4ef6","title":"\u5904\u7406accept\u4e8b\u4ef6","text":"<pre><code>    public static void main(String[] args) {\n        try (ServerSocketChannel channel = ServerSocketChannel.open()) {\n            channel.bind(new InetSocketAddress(8080));\n            // \u521b\u5efaselector\u5e76\u6ce8\u518c\u4e8b\u4ef6\n            Selector selector = Selector.open();\n            channel.configureBlocking(false);\n            channel.register(selector, SelectionKey.OP_ACCEPT);\n\n            while (true) {\n                selector.select();\n                // \u83b7\u53d6\u6240\u6709\u4e8b\u4ef6\n                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();\n\n                // \u904d\u5386\u6240\u6709\u4e8b\u4ef6\uff0c\u9010\u4e00\u5904\u7406\n                Iterator&lt;SelectionKey&gt; iter = keys.iterator();\n                while (iter.hasNext()) {\n                    SelectionKey key = iter.next();\n                    // \u5224\u65ad\u4e8b\u4ef6\u7c7b\u578b\n                    if (key.isAcceptable()) {\n                        ServerSocketChannel c = (ServerSocketChannel) key.channel();\n                        // \u5fc5\u987b\u5904\u7406\n                        SocketChannel sc = c.accept();\n                        log.debug(\"{}\", sc);\n                    }\n                    // \u5904\u7406\u5b8c\u6bd5\uff0c\u5fc5\u987b\u5c06\u4e8b\u4ef6\u79fb\u9664\n                    iter.remove();\n                }\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre> <p>[!Important]</p> <p>\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u8981\u4e48\u5904\u7406\uff0c\u8981\u4e48\u53d6\u6d88\uff08cancel\uff09\uff0c\u4e0d\u80fd\u4ec0\u4e48\u90fd\u4e0d\u505a\uff0c\u5426\u5219\u4e0b\u6b21\u8be5\u4e8b\u4ef6\u4ecd\u4f1a\u89e6\u53d1\uff0c\u8fd9\u662f\u56e0\u4e3a nio \u5e95\u5c42\u4f7f\u7528\u7684\u662f\u6c34\u5e73\u89e6\u53d1</p>"},{"location":"Netty/Netty/#\u5904\u7406read\u4e8b\u4ef6","title":"\u5904\u7406read\u4e8b\u4ef6","text":"<pre><code>    public static void main(String[] args) {\n        try (ServerSocketChannel channel = ServerSocketChannel.open()) {\n            channel.bind(new InetSocketAddress(8080));\n\n            Selector selector = Selector.open();\n            channel.configureBlocking(false);\n            channel.register(selector, SelectionKey.OP_ACCEPT);\n\n            while (true) {\n                selector.select();\n                // \u83b7\u53d6\u6240\u6709\u4e8b\u4ef6\n                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();\n                // \u904d\u5386\u6240\u6709\u4e8b\u4ef6\uff0c\u9010\u4e00\u5904\u7406\n                Iterator&lt;SelectionKey&gt; iter = keys.iterator();\n                while (iter.hasNext()) {\n                    SelectionKey key = iter.next();\n                    // \u5224\u65ad\u4e8b\u4ef6\u7c7b\u578b\n                    if (key.isAcceptable()) {\n                        ServerSocketChannel c = (ServerSocketChannel) key.channel();\n                        // \u5fc5\u987b\u5904\u7406\n                        SocketChannel sc = c.accept();\n                        sc.configureBlocking(false);\n                        sc.register(selector, SelectionKey.OP_READ);\n                    } else if (key.isReadable()) {\n                        SocketChannel sc = (SocketChannel) key.channel();\n                        ByteBuffer buffer = ByteBuffer.allocate(128);\n                        int read = sc.read(buffer);\n                        // \u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5\u4e5f\u4f1a\u89e6\u53d1read\u4e8b\u4ef6\uff0c\u6b64\u65f6\u9700\u53d6\u6d88\u8be5\u4e8b\u4ef6\n                        if(read == -1) {\n                            key.cancel();\n                            sc.close();\n                        } else {\n                            buffer.flip();\n                        }\n                    }\n                    // \u5904\u7406\u5b8c\u6bd5\uff0c\u5fc5\u987b\u5c06\u4e8b\u4ef6\u79fb\u9664\n                    iter.remove();\n                }\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre> <p>[!Note]</p> <ol> <li>\u4e3a\u4ec0\u4e48\u8981 iter.remove()</li> <li>\u56e0\u4e3a select \u5728\u4e8b\u4ef6\u53d1\u751f\u540e\uff0c\u5c31\u4f1a\u5c06\u76f8\u5173\u7684 key \u653e\u5165 selectedKeys \u96c6\u5408\uff0c\u4f46\u4e0d\u4f1a\u5728\u5904\u7406\u5b8c\u540e\u4ece selectedKeys \u96c6\u5408\u4e2d\u79fb\u9664\uff0c\u9700\u8981\u6211\u4eec\u81ea\u5df1\u7f16\u7801\u5220\u9664\uff0c\u5426\u5219\u540e\u7eed\u8fd8\u4f1a\u518d\u6b21\u89e6\u53d1\u8be5\u4e8b\u4ef6\u3002</li> <li>cancel \u7684\u4f5c\u7528</li> <li>cancel \u4f1a\u53d6\u6d88\u6ce8\u518c\u5728 selector \u4e0a\u7684 channel\uff0c\u5e76\u4ece keys \u96c6\u5408\u4e2d\u5220\u9664 key \u540e\u7eed\u4e0d\u4f1a\u518d\u76d1\u542c\u4e8b\u4ef6</li> </ol>"},{"location":"Netty/Netty/#\u6d88\u606f\u8fb9\u754c\u5904\u7406","title":"\u6d88\u606f\u8fb9\u754c\u5904\u7406","text":"<p>\u5f53\u63a5\u6536\u7684\u6570\u636e\u957f\u5ea6\u5927\u4e8eBuffer\u65f6\uff0c\u6570\u636e\u7684\u8fb9\u754c\u5c31\u65e0\u6cd5\u5728\u4e00\u6b21\u5904\u7406\u4e2d\u89e3\u51b3</p> <p>\u89e3\u51b3\u601d\u8def\uff1a</p> <ul> <li>\u4e00\u79cd\u601d\u8def\u662f\u56fa\u5b9a\u6d88\u606f\u957f\u5ea6\uff0c\u6570\u636e\u5305\u5927\u5c0f\u4e00\u6837\uff0c\u670d\u52a1\u5668\u6309\u9884\u5b9a\u957f\u5ea6\u8bfb\u53d6\uff0c\u7f3a\u70b9\u662f\u6d6a\u8d39\u5e26\u5bbd</li> <li>\u53e6\u4e00\u79cd\u601d\u8def\u662f\u6309\u5206\u9694\u7b26\u62c6\u5206\uff0c\u7f3a\u70b9\u662f\u6548\u7387\u4f4e\uff08\u9700\u8981\u904d\u5386\u6d88\u606f\u627e\u5230\u8fb9\u754c\uff09</li> <li>TLV \u683c\u5f0f\uff0c\u5373 Type\u3001Length\u3001Value\uff0c\u7c7b\u578b\u548c\u957f\u5ea6\u5df2\u77e5\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u65b9\u4fbf\u83b7\u53d6\u6d88\u606f\u5927\u5c0f\uff0c\u5206\u914d\u5408\u9002\u7684 buffer\uff0c\u7f3a\u70b9\u662f buffer \u9700\u8981\u63d0\u524d\u5206\u914d\uff0c\u5982\u679c\u5185\u5bb9\u8fc7\u5927\uff0c\u5219\u5f71\u54cd server \u541e\u5410\u91cf\uff08\u89c4\u5b9a\u6d88\u606f\u7684\u5934\u90e8\u67d0\u4e9b\u5b57\u6bb5\u5b58\u50a8\u6d88\u606f\u957f\u5ea6\u3001\u7c7b\u578b\u7b49\u6570\u636e\uff09</li> </ul> <pre><code>sequenceDiagram \nparticipant c1 as \u5ba2\u6237\u7aef1\nparticipant s as \u670d\u52a1\u5668\nparticipant b1 as ByteBuffer1\nparticipant b2 as ByteBuffer2\nc1 -&gt;&gt; s: \u53d1\u9001 01234567890abcdef3333\\r\ns -&gt;&gt; b1: \u7b2c\u4e00\u6b21 read \u5b58\u5165 01234567890abcdef\ns -&gt;&gt; b2: \u6269\u5bb9\nb1 -&gt;&gt; b2: \u62f7\u8d1d 01234567890abcdef\ns -&gt;&gt; b2: \u7b2c\u4e8c\u6b21 read \u5b58\u5165 3333\\r\nb2 -&gt;&gt; b2: 01234567890abcdef3333\\r\n</code></pre> <pre><code>    public static void main(String[] args) throws IOException {\n        ServerSocketChannel ssc = ServerSocketChannel.open();\n        ssc.configureBlocking(false);\n        ssc.bind(new InetSocketAddress(8080));\n\n        Selector selector = Selector.open();\n        SelectionKey sscKey = ssc.register(selector, 0, null);\n        sscKey.interestOps(SelectionKey.OP_ACCEPT);\n\n        while (true) {\n            // \u6709\u4e8b\u4ef6\u53d1\u751f\u5219\u8fd0\u884c\uff0c\u6ca1\u6709\u5219\u963b\u585e\n            selector.select();\n            // \u5904\u7406\u4e8b\u4ef6\n            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();\n\n            while (iterator.hasNext()) {\n                SelectionKey key = iterator.next();\n                iterator.remove();\n\n                // \u533a\u5206\u4e8b\u4ef6\u7c7b\u578b\n                if (key.isAcceptable()) {\n                    ServerSocketChannel channel = (ServerSocketChannel) key.channel();\n                    SocketChannel socketChannel = channel.accept();\n                    socketChannel.configureBlocking(false);\n                    ByteBuffer buffer = ByteBuffer.allocate(16);\n\n                    // \u53c2\u65703\u662f\u9644\u4ef6\uff0c\u901a\u5e38\u7528\u4e8e\u5b58\u653e\u4e00\u4e9b\u5bf9\u8c61\uff0c\u8fd9\u91cc\u5b58\u653eByteBuffer\uff0c\u7528\u4e8e\u89e3\u51b3\u6d88\u606f\u8fb9\u754c\u95ee\u9898\n                    SelectionKey scKey = socketChannel.register(selector, 0, buffer);\n                    scKey.interestOps(SelectionKey.OP_READ);\n                } else if (key.isReadable()) {\n                    try {\n                        // \u83b7\u53d6\u4e8b\u4ef6\u6e90Channel\n                        SocketChannel channel = (SocketChannel) key.channel();\n                        // \u83b7\u53d6\u9644\u4ef6\uff08ByteBuffer\uff09\n                        ByteBuffer buffer = (ByteBuffer) key.attachment();\n\n                        // \u5ba2\u6237\u7aefclose()\u65ad\u5f00\u8fde\u63a5\u4e5f\u4f1a\u89e6\u53d1read\u4e8b\u4ef6\uff0c\u4f46\u662fread\u4f1a\u8fd4\u56de-1\n                        int read = channel.read(buffer);\n                        if (read == -1) {\n                            key.cancel();\n                            continue;\n                        }\n                        // \u89e3\u6790\u6d88\u606f\n                        split(buffer);\n                        if (buffer.position() == buffer.limit()) {\n                            // \u6269\u5bb9buffer\n                            ByteBuffer newBuffer = ByteBuffer.allocate(buffer.capacity() * 2);\n                            buffer.flip();\n                            newBuffer.put(buffer);\n                            // \u66ff\u6362buffer\n                            key.attach(newBuffer);\n                        }\n                    } catch (IOException e) {\n                        log.error(e.getMessage());\n                        // \u53d1\u751f\u5f02\u5e38\uff0c\u53d6\u6d88\u6ce8\u518c\n                        key.cancel();\n                    }\n                }\n            }\n        }\n    }\n\n    private static void split(ByteBuffer buffer) {\n        buffer.flip();\n        int oldLimit = buffer.limit();\n        for (int i = 0; i &lt; buffer.limit(); i++) {\n            if (buffer.get(i) == '\\n') {\n                int length = i + 1 - buffer.position();\n                ByteBuffer msg = ByteBuffer.allocate(length);\n                for (int j = 0; j &lt; length; j++) {\n                    msg.put(buffer.get());\n                }\n                msg.flip();\n                System.out.println(StandardCharsets.UTF_8.decode(msg));\n                // \u7ee7\u7eed\u67e5\u627e\u4e0b\u4e00\u4e2a\u5b8c\u6574\u6d88\u606f\n                i = buffer.position() - 1;\n            }\n        }\n        buffer.limit(oldLimit);\n        buffer.compact();\n    }\n</code></pre>"},{"location":"Netty/Netty/#bytebuffer-\u5927\u5c0f\u5206\u914d","title":"ByteBuffer \u5927\u5c0f\u5206\u914d","text":"<ul> <li>\u6bcf\u4e2a channel \u90fd\u9700\u8981\u8bb0\u5f55\u53ef\u80fd\u88ab\u5207\u5206\u7684\u6d88\u606f\uff0c\u56e0\u4e3a ByteBuffer \u4e0d\u80fd\u88ab\u591a\u4e2a channel \u5171\u540c\u4f7f\u7528</li> <li>ByteBuffer \u4e0d\u80fd\u592a\u5927\uff0c\u6bd4\u5982\u4e00\u4e2a ByteBuffer 1Mb \u7684\u8bdd\uff0c\u8981\u652f\u6301\u767e\u4e07\u8fde\u63a5\u5c31\u8981 1Tb \u5185\u5b58\uff0c\u56e0\u6b64\u9700\u8981\u8bbe\u8ba1\u5927\u5c0f\u53ef\u53d8\u7684 ByteBuffer</li> <li>\u4e00\u79cd\u601d\u8def\u662f\u9996\u5148\u5206\u914d\u4e00\u4e2a\u8f83\u5c0f\u7684 buffer\uff0c\u4f8b\u5982 4k\uff0c\u5982\u679c\u53d1\u73b0\u6570\u636e\u4e0d\u591f\uff0c\u518d\u5206\u914d 8k \u7684 buffer\uff0c\u5c06 4k buffer \u5185\u5bb9\u62f7\u8d1d\u81f3 8k buffer\uff0c\u4f18\u70b9\u662f\u6d88\u606f\u8fde\u7eed\u5bb9\u6613\u5904\u7406\uff0c\u7f3a\u70b9\u662f\u6570\u636e\u62f7\u8d1d\u8017\u8d39\u6027\u80fd\uff0c\u53c2\u8003\u5b9e\u73b0 http://tutorials.jenkov.com/java-performance/resizable-array.html</li> <li>\u53e6\u4e00\u79cd\u601d\u8def\u662f\u7528\u591a\u4e2a\u6570\u7ec4\u7ec4\u6210 buffer\uff0c\u4e00\u4e2a\u6570\u7ec4\u4e0d\u591f\uff0c\u628a\u591a\u51fa\u6765\u7684\u5185\u5bb9\u5199\u5165\u65b0\u7684\u6570\u7ec4\uff0c\u4e0e\u524d\u9762\u7684\u533a\u522b\u662f\u6d88\u606f\u5b58\u50a8\u4e0d\u8fde\u7eed\u89e3\u6790\u590d\u6742\uff0c\u4f18\u70b9\u662f\u907f\u514d\u4e86\u62f7\u8d1d\u5f15\u8d77\u7684\u6027\u80fd\u635f\u8017</li> </ul>"},{"location":"Netty/Netty/#\u5904\u7406write\u4e8b\u4ef6","title":"\u5904\u7406write\u4e8b\u4ef6","text":"<ul> <li>\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u628a buffer \u4e2d\u6240\u6709\u6570\u636e\u90fd\u5199\u5165 channel\uff0c\u56e0\u6b64\u9700\u8981\u8ffd\u8e2a write \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff08\u4ee3\u8868\u5b9e\u9645\u5199\u5165\u5b57\u8282\u6570\uff09</li> <li>\u7528 selector \u76d1\u542c\u6240\u6709 channel \u7684\u53ef\u5199\u4e8b\u4ef6\uff0c\u6bcf\u4e2a channel \u90fd\u9700\u8981\u4e00\u4e2a key \u6765\u8ddf\u8e2a buffer\uff0c\u4f46\u8fd9\u6837\u53c8\u4f1a\u5bfc\u81f4\u5360\u7528\u5185\u5b58\u8fc7\u591a\uff0c\u5c31\u6709\u4e24\u9636\u6bb5\u7b56\u7565</li> <li>\u5f53\u6d88\u606f\u5904\u7406\u5668\u7b2c\u4e00\u6b21\u5199\u5165\u6d88\u606f\u65f6\uff0c\u624d\u5c06 channel \u6ce8\u518c\u5230 selector \u4e0a</li> <li>selector \u68c0\u67e5 channel \u4e0a\u7684\u53ef\u5199\u4e8b\u4ef6\uff0c\u5982\u679c\u6240\u6709\u7684\u6570\u636e\u5199\u5b8c\u4e86\uff0c\u5c31\u53d6\u6d88 channel \u7684\u6ce8\u518c</li> <li>\u5982\u679c\u4e0d\u53d6\u6d88\uff0c\u4f1a\u6bcf\u6b21\u53ef\u5199\u5747\u4f1a\u89e6\u53d1 write \u4e8b\u4ef6</li> </ul> <pre><code>public static void main(String[] args) throws IOException {\n        ServerSocketChannel ssc = ServerSocketChannel.open();\n        ssc.configureBlocking(false);\n        ssc.bind(new InetSocketAddress(8080));\n\n        Selector selector = Selector.open();\n        ssc.register(selector, SelectionKey.OP_ACCEPT);\n\n        while(true) {\n            selector.select();\n\n            Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();\n            while (iter.hasNext()) {\n                SelectionKey key = iter.next();\n                iter.remove();\n                if (key.isAcceptable()) {\n                    SocketChannel sc = ssc.accept();\n                    sc.configureBlocking(false);\n                    SelectionKey sckey = sc.register(selector, SelectionKey.OP_READ);\n                    // 1. \u5411\u5ba2\u6237\u7aef\u53d1\u9001\u5185\u5bb9\n                    StringBuilder sb = new StringBuilder();\n                    for (int i = 0; i &lt; 3000000; i++) {\n                        sb.append(\"a\");\n                    }\n                    ByteBuffer buffer = Charset.defaultCharset().encode(sb.toString());\n                    int write = sc.write(buffer);\n                    // 3. write \u8868\u793a\u5b9e\u9645\u5199\u4e86\u591a\u5c11\u5b57\u8282\n                    System.out.println(\"\u5b9e\u9645\u5199\u5165\u5b57\u8282:\" + write);\n                    // 4. \u5982\u679c\u6709\u5269\u4f59\u672a\u8bfb\u5b57\u8282\uff0c\u624d\u9700\u8981\u5173\u6ce8\u5199\u4e8b\u4ef6\n                    if (buffer.hasRemaining()) {\n                        // read 1  write 4\n                        // \u5728\u539f\u6709\u5173\u6ce8\u4e8b\u4ef6\u7684\u57fa\u7840\u4e0a\uff0c\u591a\u5173\u6ce8 \u5199\u4e8b\u4ef6\n                        sckey.interestOps(sckey.interestOps() + SelectionKey.OP_WRITE);\n                        // \u628a buffer \u4f5c\u4e3a\u9644\u4ef6\u52a0\u5165 sckey\n                        sckey.attach(buffer);\n                    }\n                } else if (key.isWritable()) {\n                    ByteBuffer buffer = (ByteBuffer) key.attachment();\n                    SocketChannel sc = (SocketChannel) key.channel();\n                    int write = sc.write(buffer);\n                    System.out.println(\"\u5b9e\u9645\u5199\u5165\u5b57\u8282:\" + write);\n                    if (!buffer.hasRemaining()) { // \u5199\u5b8c\u4e86\n                        key.interestOps(key.interestOps() - SelectionKey.OP_WRITE);\n                        key.attach(null);\n                    }\n                }\n            }\n        }\n    }\n</code></pre>"},{"location":"Netty/Netty/#\u591a\u7ebf\u7a0b\u4f18\u5316","title":"\u591a\u7ebf\u7a0b\u4f18\u5316","text":"<p>\u4f18\u5316\u601d\u8def\uff1a</p> <ul> <li>\u5355\u7ebf\u7a0b\u914d\u4e00\u4e2a\u9009\u62e9\u5668\uff0c\u4e13\u95e8\u5904\u7406 accept \u4e8b\u4ef6</li> <li>\u521b\u5efa cpu \u6838\u5fc3\u6570\u7684\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u914d\u4e00\u4e2a\u9009\u62e9\u5668\uff0c\u8f6e\u6d41\u5904\u7406 read \u4e8b\u4ef6</li> </ul> <pre><code>    public static void main(String[] args) throws IOException {\n        // \u521d\u59cb\u5316\u670d\u52a1\n        ServerSocketChannel ssc = ServerSocketChannel.open();\n        ssc.configureBlocking(false);\n        Selector selector = Selector.open();\n        SelectionKey sscKey = ssc.register(selector, 0, null);\n        sscKey.interestOps(SelectionKey.OP_ACCEPT);\n        ssc.bind(new InetSocketAddress(8080));\n\n        // \u521d\u59cb\u5316\u5de5\u4f5c\u7ebf\u7a0b\n        Worker[] workers = new Worker[Runtime.getRuntime().availableProcessors()];\n        for (int i = 0; i &lt; workers.length; i++) {\n            workers[i] = new Worker(\"worker-\" + i);\n        }\n\n        int index = 0;\n        while (true) {\n            // \u76d1\u542c\u8fde\u63a5\u4e8b\u4ef6\n            selector.select();\n            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();\n            while (iterator.hasNext()) {\n                SelectionKey key = iterator.next();\n                iterator.remove();\n                if (key.isAcceptable()) {\n                    SocketChannel socketChannel = ssc.accept();\n                    socketChannel.configureBlocking(false);\n                    // \u5c06\u8fde\u63a5\u5206\u914d\u5230\u5de5\u4f5c\u7ebf\u7a0b\n                    workers[index % workers.length].register(socketChannel);\n                    index++;\n                }\n            }\n        }\n    }\n\n    static class Worker implements Runnable {\n        private final String name;\n        private final ConcurrentLinkedQueue&lt;Runnable&gt; queue = new ConcurrentLinkedQueue&lt;&gt;();\n        private Selector selector;\n        private volatile boolean isInit = false;\n\n        public Worker(String name) {\n            this.name = name;\n        }\n\n        public void register(SocketChannel socketChannel) throws IOException {\n            if (!isInit) {\n                selector = Selector.open();\n                new Thread(this, this.name).start();\n                isInit = true;\n            }\n            queue.add(() -&gt; {\n                try {\n                    socketChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(16));\n                } catch (ClosedChannelException e) {\n                    throw new RuntimeException(e);\n                }\n            });\n            selector.wakeup();\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                try {\n                    selector.select();\n                    Runnable task = queue.poll();\n                    if (task != null) {\n                        task.run();\n                    }\n                    Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();\n                    while (iterator.hasNext()) {\n                        SelectionKey key = iterator.next();\n                        iterator.remove();\n                        if (key.isReadable()) {\n                            // \u5904\u7406\u6d88\u606f\n                        }\n                    }\n                } catch (IOException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n        }\n    }\n</code></pre> <p>[!Note]</p> <p>\u4e3a\u4ec0\u4e48\u4f7f\u7528\u961f\u5217\u6765\u6ce8\u518c\u4e8b\u4ef6\uff0c\u5e76\u4e14\u8fd8\u8981\u5728\u5de5\u4f5c\u7ebf\u7a0b\u4e2d\u5b8c\u6210\u6ce8\u518c\uff1f</p> <p>\u2714\u56e0\u4e3a\u5f53\u5de5\u4f5c\u7ebf\u7a0b\u542f\u52a8\u540e\u8c03\u7528<code>selector.select()</code>\u4f1a\u88ab\u963b\u585e\uff0c\u6b64\u65f6\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6ce8\u518c\u65b9\u6cd5\u4e5f\u540c\u6837\u4f1a\u88ab\u963b\u585e\u3002\u540c\u65f6\u4e3b\u7ebf\u7a0b\u5411\u961f\u5217\u63d0\u4ea4\u6ce8\u518c\u4efb\u52a1\u540e\u8fd8\u9700\u8981\u8c03\u7528<code>selector.wakeup()</code>\u4f7f\u5de5\u4f5c\u7ebf\u7a0b\u7684selector\u7acb\u5373\u4ece\u963b\u585e\u72b6\u6001\u8fd4\u56de\uff0c\u6267\u884c\u961f\u5217\u4e2d\u7684\u6ce8\u518c\u4efb\u52a1\u3002</p>"},{"location":"Netty/Netty/#udp\u4f20\u8f93","title":"UDP\u4f20\u8f93","text":"<ul> <li>UDP \u662f\u65e0\u8fde\u63a5\u7684\uff0cclient \u53d1\u9001\u6570\u636e\u4e0d\u4f1a\u7ba1 server \u662f\u5426\u5f00\u542f</li> <li>server \u8fd9\u8fb9\u7684 receive \u65b9\u6cd5\u4f1a\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u5b58\u5165 byte buffer\uff0c\u4f46\u5982\u679c\u6570\u636e\u62a5\u6587\u8d85\u8fc7 buffer \u5927\u5c0f\uff0c\u591a\u51fa\u6765\u7684\u6570\u636e\u4f1a\u88ab\u9ed8\u9ed8\u629b\u5f03</li> </ul> <pre><code>    // \u670d\u52a1\u7aef\n    public static void main(String[] args) {\n        try (DatagramChannel channel = DatagramChannel.open()) {\n            channel.socket().bind(new InetSocketAddress(8080));\n            ByteBuffer buffer = ByteBuffer.allocate(32);\n            channel.receive(buffer);\n            buffer.flip();\n            // \u5904\u7406\u6d88\u606f\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    // \u5ba2\u6237\u7aef\n    public static void main(String[] args) {\n        try (DatagramChannel channel = DatagramChannel.open()) {\n            ByteBuffer buffer = StandardCharsets.UTF_8.encode(\"hello\");\n            InetSocketAddress address = new InetSocketAddress(\"localhost\", 8080);\n            channel.send(buffer, address);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>"},{"location":"Netty/Netty/#\u603b\u7ed3","title":"\u603b\u7ed3","text":""},{"location":"Netty/Netty/#io\u6a21\u578b","title":"IO\u6a21\u578b","text":"<p>\u65e0\u8bba\u54ea\u79cdIO\u6a21\u578b\uff0c\u6570\u636e\u4ece\u8bbe\u5907\u5230\u7528\u6237\u7a7a\u95f4\u7684\u4f20\u8f93\u90fd\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ol> <li>\u7b49\u5f85\u6570\u636e\u5c31\u7eea</li> <li>\u5185\u6838\u68c0\u67e5\u6570\u636e\u662f\u5426\u5230\u8fbe\uff08\u5982\u7f51\u5361\u662f\u5426\u6709\u6570\u636e\u3001\u78c1\u76d8\u662f\u5426\u5b8c\u6210\u8bfb\u53d6\uff09\u3002</li> <li>\u82e5\u672a\u5c31\u7eea\uff0c\u6839\u636eIO\u6a21\u578b\u51b3\u5b9a\u662f\u5426\u963b\u585e\u7528\u6237\u7ebf\u7a0b\u3002</li> <li>\u6570\u636e\u62f7\u8d1d</li> <li>\u5c06\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7528\u6237\u7f13\u51b2\u533a\uff08\u5982<code>read()</code>\u7684<code>buf</code>\u53c2\u6570\uff09\u3002</li> </ol>"},{"location":"Netty/Netty/#\u540c\u6b65\u963b\u585ebio","title":"\u540c\u6b65\u963b\u585e\uff08BIO\uff09","text":"<ul> <li>\u7279\u70b9\uff1a\u7528\u6237\u7ebf\u7a0b\u53d1\u8d77IO\u64cd\u4f5c\u540e\u4e00\u76f4\u963b\u585e\uff0c\u76f4\u5230\u6570\u636e\u5c31\u7eea\u5e76\u5b8c\u6210\u6570\u636e\u62f7\u8d1d\u3002</li> <li>\u6d41\u7a0b\uff1a</li> <li>\u7ebf\u7a0b\u8c03\u7528<code>read()</code>\uff0c\u5185\u6838\u5f00\u59cb\u51c6\u5907\u6570\u636e\uff08\u5982\u7b49\u5f85\u7f51\u5361\u6570\u636e\u5230\u8fbe\uff09\u3002</li> <li>\u5185\u6838\u7b49\u5f85\u6570\u636e\u5230\u8fbe\u540e\uff0c\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u3002</li> <li>\u62f7\u8d1d\u5b8c\u6210\u540e\uff0c\u7ebf\u7a0b\u89e3\u9664\u963b\u585e\uff0c\u7ee7\u7eed\u6267\u884c\u3002</li> <li>\u7f3a\u70b9\uff1a\u7ebf\u7a0b\u5728\u7b49\u5f85\u671f\u95f4\u65e0\u6cd5\u505a\u5176\u4ed6\u4e8b\uff0c\u6d6a\u8d39CPU\u8d44\u6e90\u3002</li> <li>\u5e94\u7528\u573a\u666f\uff1a\u7b80\u5355\u4f46\u5e76\u53d1\u4f4e\u7684\u573a\u666f\uff08\u5982\u4f20\u7edfSocket\u7f16\u7a0b\uff09\u3002</li> </ul>"},{"location":"Netty/Netty/#\u540c\u6b65\u975e\u963b\u585enio","title":"\u540c\u6b65\u975e\u963b\u585e\uff08NIO\uff09","text":"<ul> <li>\u7279\u70b9\uff1a\u7528\u6237\u7ebf\u7a0b\u8f6e\u8be2\u68c0\u67e5\u5185\u6838\u6570\u636e\u662f\u5426\u5c31\u7eea\uff0c\u671f\u95f4\u53ef\u6267\u884c\u5176\u4ed6\u4efb\u52a1\u3002</li> <li>\u6d41\u7a0b\uff1a</li> <li>\u7ebf\u7a0b\u8c03\u7528<code>read()</code>\uff0c\u82e5\u6570\u636e\u672a\u5c31\u7eea\uff0c\u5185\u6838\u7acb\u5373\u8fd4\u56de<code>EWOULDBLOCK</code>\u9519\u8bef\u3002</li> <li>\u7ebf\u7a0b\u4e0d\u65ad\u8f6e\u8be2\uff0c\u76f4\u5230\u6570\u636e\u5c31\u7eea\u540e\uff0c\u53d1\u8d77\u6570\u636e\u62f7\u8d1d\uff08\u4ecd\u7531\u7ebf\u7a0b\u540c\u6b65\u5b8c\u6210\uff09\u3002</li> <li>\u7f3a\u70b9\uff1a\u8f6e\u8be2\u6d88\u8017CPU\u8d44\u6e90\uff0c\u54cd\u5e94\u5ef6\u8fdf\u9ad8\u3002</li> <li>\u5e94\u7528\u573a\u666f\uff1a\u6781\u5c11\u4f7f\u7528\uff0c\u901a\u5e38\u7ed3\u5408\u591a\u8def\u590d\u7528\u66ff\u4ee3\u3002</li> </ul>"},{"location":"Netty/Netty/#\u591a\u8def\u590d\u7528io-multiplexing","title":"\u591a\u8def\u590d\u7528\uff08IO Multiplexing\uff09","text":"<ul> <li>\u7279\u70b9\uff1a\u901a\u8fc7\u5355\u4e2a\u7ebf\u7a0b\u76d1\u63a7\u591a\u4e2aIO\u4e8b\u4ef6\uff08\u5982<code>select</code>/<code>poll</code>/<code>epoll</code>\uff09\uff0c\u5c31\u7eea\u540e\u518d\u540c\u6b65\u5904\u7406\u3002</li> <li>\u6d41\u7a0b\uff1a</li> <li>\u7ebf\u7a0b\u8c03\u7528<code>select()</code>\uff0c\u963b\u585e\u7b49\u5f85\u81f3\u5c11\u4e00\u4e2aIO\u4e8b\u4ef6\u5c31\u7eea\u3002</li> <li>\u5f53\u67d0\u4e2aSocket\u6570\u636e\u5c31\u7eea\uff0c<code>select()</code>\u8fd4\u56de\uff0c\u7ebf\u7a0b\u518d\u8c03\u7528<code>read()</code>\u540c\u6b65\u62f7\u8d1d\u6570\u636e\u3002</li> <li>\u4f18\u70b9\uff1a\u5355\u7ebf\u7a0b\u9ad8\u6548\u7ba1\u7406\u591a\u4e2a\u8fde\u63a5\uff0c\u907f\u514d\u591a\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3002</li> <li>\u7f3a\u70b9\uff1a\u6570\u636e\u62f7\u8d1d\u4ecd\u540c\u6b65\u8fdb\u884c\uff0c\u4e14<code>select</code>\u6709FD\u6570\u91cf\u9650\u5236\u3002</li> <li>\u5e94\u7528\u573a\u666f\uff1a\u9ad8\u5e76\u53d1\u7f51\u7edc\u670d\u52a1\uff08\u5982Nginx\u3001Redis\uff09\u3002</li> </ul>"},{"location":"Netty/Netty/#\u4fe1\u53f7\u9a71\u52a8io","title":"\u4fe1\u53f7\u9a71\u52a8IO","text":"<ul> <li>\u7279\u70b9\uff1a\u901a\u8fc7\u4fe1\u53f7\u901a\u77e5\u6570\u636e\u5c31\u7eea\uff0c\u6570\u636e\u62f7\u8d1d\u4ecd\u9700\u7ebf\u7a0b\u540c\u6b65\u5b8c\u6210\u3002</li> <li>\u6d41\u7a0b\uff1a</li> <li>\u7ebf\u7a0b\u6ce8\u518c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5e76\u8c03\u7528<code>sigaction()</code>\u3002</li> <li>\u5185\u6838\u6570\u636e\u5c31\u7eea\u540e\u53d1\u9001\u4fe1\u53f7\uff0c\u7ebf\u7a0b\u518d\u8c03\u7528<code>read()</code>\u540c\u6b65\u62f7\u8d1d\u6570\u636e\u3002</li> <li>\u7f3a\u70b9\uff1a\u4fe1\u53f7\u5904\u7406\u590d\u6742\uff0c\u5b9e\u9645\u5e94\u7528\u5c11\u3002</li> <li>\u6ce8\u610f\uff1a\u4e25\u683c\u6765\u8bf4\uff0c\u8fd9\u4e0d\u662f\u4e3b\u6d41\u5206\u7c7b\uff0c\u901a\u5e38\u5f52\u4e3a\u540c\u6b65\u6a21\u578b\u3002</li> </ul>"},{"location":"Netty/Netty/#\u5f02\u6b65\u975e\u963b\u585eaio","title":"\u5f02\u6b65\u975e\u963b\u585e\uff08AIO\uff09","text":"<ul> <li>\u7279\u70b9\uff1a\u7528\u6237\u7ebf\u7a0b\u53d1\u8d77IO\u64cd\u4f5c\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u5185\u6838\u8d1f\u8d23\u6570\u636e\u5c31\u7eea\u548c\u62f7\u8d1d\uff0c\u5b8c\u6210\u540e\u901a\u77e5\u7ebf\u7a0b\u3002</li> <li>\u6d41\u7a0b\uff1a</li> <li>\u7ebf\u7a0b\u8c03\u7528<code>aio_read()</code>\uff0c\u5185\u6838\u7acb\u5373\u8fd4\u56de\u3002</li> <li>\u5185\u6838\u5b8c\u6210\u6570\u636e\u51c6\u5907\u548c\u62f7\u8d1d\u540e\uff0c\u901a\u8fc7\u56de\u8c03\u6216\u4fe1\u53f7\u901a\u77e5\u7ebf\u7a0b\u3002</li> <li>\u4f18\u70b9\uff1a\u7ebf\u7a0b\u5b8c\u5168\u65e0\u9700\u7b49\u5f85\uff0c\u8d44\u6e90\u5229\u7528\u7387\u6700\u9ad8\u3002</li> <li>\u7f3a\u70b9\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\uff08\u5982Linux\u7684<code>io_uring</code>\uff09\u3002</li> <li>\u5e94\u7528\u573a\u666f\uff1a\u9ad8\u6027\u80fd\u670d\u52a1\u5668\uff08\u5982Proactor\u6a21\u5f0f\uff09\u3002</li> </ul> \u6a21\u578b \u6570\u636e\u5c31\u7eea\u7b49\u5f85\u65b9\u5f0f \u6570\u636e\u62f7\u8d1d\u65b9\u5f0f \u662f\u5426\u540c\u6b65 \u540c\u6b65\u963b\u585e \u7528\u6237\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85 \u7528\u6237\u7ebf\u7a0b\u540c\u6b65 \u540c\u6b65 \u540c\u6b65\u975e\u963b\u585e \u7528\u6237\u7ebf\u7a0b\u8f6e\u8be2\u68c0\u67e5 \u7528\u6237\u7ebf\u7a0b\u540c\u6b65 \u540c\u6b65 \u591a\u8def\u590d\u7528 \u5185\u6838\u6279\u91cf\u76d1\u63a7\u4e8b\u4ef6 \u7528\u6237\u7ebf\u7a0b\u540c\u6b65 \u540c\u6b65 \u4fe1\u53f7\u9a71\u52a8IO \u5185\u6838\u5f02\u6b65\u901a\u77e5 \u7528\u6237\u7ebf\u7a0b\u540c\u6b65 \u540c\u6b65 \u5f02\u6b65\u975e\u963b\u585e\uff08AIO\uff09 \u5185\u6838\u5168\u6743\u5904\u7406 \u5185\u6838\u5f02\u6b65\u5b8c\u6210 \u5f02\u6b65"},{"location":"Netty/Netty/#\u591a\u8def\u590d\u7528-vs-bio","title":"\u591a\u8def\u590d\u7528 VS BIO","text":"<p>1. \u8d44\u6e90\u5360\u7528\u66f4\u5c11\uff0c\u652f\u6301\u66f4\u9ad8\u5e76\u53d1</p> <ul> <li>\u4f20\u7edf\u963b\u585eIO\uff1a   \u6bcf\u4e2a\u8fde\u63a5\u9700\u8981\u5206\u914d\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b/\u8fdb\u7a0b\uff0c\u7ebf\u7a0b\u8d8a\u591a\uff0c\u5185\u5b58\u548cCPU\u7684\u6d88\u8017\u8d8a\u5927\uff08\u4f8b\u5982\uff1a1000\u8fde\u63a5 \u2192 1000\u7ebf\u7a0b\uff09\u3002   \u53d7\u9650\u4e8e\u7cfb\u7edf\u6700\u5927\u7ebf\u7a0b\u6570\u548c\u4e0a\u4e0b\u6587\u5207\u6362\u6210\u672c\uff08\u7ebf\u7a0b\u6808\u3001CPU\u8c03\u5ea6\u5f00\u9500\uff09\u3002</li> <li>\u591a\u8def\u590d\u7528\uff1a   \u5355\u7ebf\u7a0b\u53ef\u7ba1\u7406\u6210\u767e\u4e0a\u5343\u4e2a\u8fde\u63a5\uff08\u4f8b\u5982\uff1a1\u7ebf\u7a0b\u5904\u74061000\u4e2a\u8fde\u63a5\uff09\uff0c\u200b\u200b\u8d44\u6e90\u6d88\u8017\u6781\u4f4e\u200b\u200b\uff0c\u9002\u5408\u9ad8\u5e76\u53d1\u573a\u666f\uff08\u5982Web\u670d\u52a1\u5668\u3001\u5b9e\u65f6\u901a\u4fe1\uff09\u3002</li> </ul> <p>2. \u907f\u514d\u7ebf\u7a0b\u9891\u7e41\u5207\u6362</p> <ul> <li>\u963b\u585eIO\u7684\u4ee3\u4ef7\uff1a   \u6bcf\u4e2a\u963b\u585e\u7684\u7ebf\u7a0b\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6302\u8d77\uff0c\u5f53\u5927\u91cf\u7ebf\u7a0b\u5728\u7b49\u5f85IO\u65f6\uff0cCPU\u65f6\u95f4\u6d6a\u8d39\u5728\u200b\u200b\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u200b\u200b\u4e0a\u3002</li> <li>\u591a\u8def\u590d\u7528\u7684\u4f18\u5316\uff1a   \u53ea\u5728\u6709IO\u4e8b\u4ef6\u5c31\u7eea\u65f6\u5524\u9192\u7ebf\u7a0b\uff08\u5982<code>epoll</code>\u7684\u4e8b\u4ef6\u9a71\u52a8\u673a\u5236\uff09\uff0c\u200b\u200b\u51cf\u5c11\u65e0\u6548\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u200b\u200b\uff0c\u63d0\u5347CPU\u5229\u7528\u7387\u3002</li> </ul> <p>3. \u9ad8\u54cd\u5e94\u901f\u5ea6</p> <ul> <li>\u963b\u585eIO\u7684\u5ef6\u8fdf\uff1a   \u7ebf\u7a0b\u9700\u7b49\u5f85IO\u64cd\u4f5c\u5b8c\u6210\uff0c\u82e5\u67d0\u4e00\u7ebf\u7a0b\u963b\u585e\uff0c\u53ef\u80fd\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u7684\u54cd\u5e94\u3002</li> <li>\u591a\u8def\u590d\u7528\u7684\u4f18\u52bf\uff1a   \u901a\u8fc7\u4e8b\u4ef6\u673a\u5236\uff08\u5982<code>epoll_wait</code>\uff09\u200b\u200b\u5373\u65f6\u611f\u77e5\u5c31\u7eea\u7684IO\u4e8b\u4ef6\u200b\u200b\uff0c\u7b2c\u4e00\u65f6\u95f4\u5904\u7406\u6d3b\u8dc3\u8fde\u63a5\uff08\u5982Redis\u7684\u5355\u7ebf\u7a0b\u9ad8\u6027\u80fd\uff09\u3002</li> </ul> <p>4. \u7edf\u4e00\u7ba1\u7406\u6240\u6709\u8fde\u63a5</p> <ul> <li>\u963b\u585eIO\u7684\u5206\u6563\u6027\uff1a   \u6bcf\u4e2a\u7ebf\u7a0b\u72ec\u7acb\u5904\u7406\u4e00\u4e2a\u8fde\u63a5\uff0c\u903b\u8f91\u5206\u6563\uff0c\u4ee3\u7801\u590d\u6742\u5ea6\u9ad8\uff08\u5982\u9501\u7ade\u4e89\u3001\u8d44\u6e90\u540c\u6b65\u95ee\u9898\uff09\u3002</li> <li>\u591a\u8def\u590d\u7528\u7684\u96c6\u4e2d\u7ba1\u7406\uff1a   \u5355\u7ebf\u7a0b\u7edf\u4e00\u76d1\u63a7\u6240\u6709\u8fde\u63a5\u7684\u72b6\u6001\uff0c\u200b\u200b\u7b80\u5316\u4ee3\u7801\u903b\u8f91\u200b\u200b\uff08\u5982Nginx\u7684\u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784\uff09\uff0c\u964d\u4f4e\u591a\u7ebf\u7a0b\u7f16\u7a0b\u7684\u96be\u5ea6\u3002</li> </ul> <p>5. \u7075\u6d3b\u7684\u6269\u5c55\u80fd\u529b</p> <ul> <li>\u4f20\u7edf\u963b\u585eIO\u7684\u74f6\u9888\uff1a   \u7ebf\u7a0b\u6570\u4e0e\u8fde\u63a5\u6570\u7ebf\u6027\u76f8\u5173\uff0c\u96be\u4ee5\u5e94\u5bf9\u7a81\u53d1\u7684\u9ad8\u5e76\u53d1\uff08\u5982\u6bcf\u79d2\u4e07\u7ea7\u8fde\u63a5\uff09\u3002</li> <li>\u591a\u8def\u590d\u7528\u7684\u53ef\u6269\u5c55\u6027\uff1a   \u91c7\u7528\u975e\u963b\u585e\u4e8b\u4ef6\u673a\u5236\uff08\u5982<code>epoll</code>\u7684<code>ET</code>\u6a21\u5f0f\uff09\uff0c\u8f7b\u677e\u6269\u5c55\u81f3\u652f\u6301\u6570\u4e07\u751a\u81f3\u767e\u4e07\u7ea7\u5e76\u53d1\uff08\u5982\u4e91\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff09\u3002</li> </ul>"},{"location":"Netty/Netty/#\u96f6\u62f7\u8d1d","title":"\u96f6\u62f7\u8d1d","text":"<p>\u4f20\u7edf\u7684 IO \u5c06\u4e00\u4e2a\u6587\u4ef6\u901a\u8fc7 socket \u5199\u51fa</p> <pre><code>File f = new File(\"helloword/data.txt\");\nRandomAccessFile file = new RandomAccessFile(file, \"r\");\n\nbyte[] buf = new byte[(int)f.length()];\nfile.read(buf);\n\nSocket socket = ...;\nsocket.getOutputStream().write(buf);\n</code></pre> <p>\u5185\u90e8\u5de5\u4f5c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <ol> <li>\u78c1\u76d8\u5230\u5185\u6838\u7f13\u51b2\u533a\uff1a    \u6570\u636e\u4ece\u78c1\u76d8\u8bfb\u53d6\u5230\u5185\u6838\u7a7a\u95f4\u7684 \u200b\u200bPage Cache\u200b\u200b\uff08\u901a\u8fc7DMA\u76f4\u63a5\u5185\u5b58\u8bbf\u95ee\uff0c\u65e0\u9700CPU\u53c2\u4e0e\uff09\u3002</li> <li>\u5185\u6838\u7f13\u51b2\u533a\u5230\u7528\u6237\u7f13\u51b2\u533a\uff1a    \u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff08\u7531CPU\u5b8c\u6210\uff0c\u7528\u6237\u7a0b\u5e8f\u901a\u8fc7<code>read()</code>\u8c03\u7528\uff09\u3002</li> <li>\u7528\u6237\u7f13\u51b2\u533a\u5230\u5185\u6838\u7f13\u51b2\u533a\uff1a    \u7528\u6237\u7a0b\u5e8f\u8c03\u7528<code>send()</code>\u53d1\u9001\u6570\u636e\uff0c\u6570\u636e\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u56de\u5185\u6838\u7684 \u200b\u200bSocket Buffer\u200b\u200b\uff08\u7531CPU\u5b8c\u6210\uff09\u3002</li> <li>\u5185\u6838\u7f13\u51b2\u533a\u5230\u7f51\u5361\uff1a    \u6570\u636e\u4eceSocket Buffer\u901a\u8fc7DMA\u62f7\u8d1d\u5230\u7f51\u5361\uff0c\u53d1\u9001\u5230\u7f51\u7edc\u3002</li> </ol> <p>\u603b\u62f7\u8d1d\u6b21\u6570\uff1a4\u6b21\uff082\u6b21CPU\u62f7\u8d1d\uff0c2\u6b21DMA\u62f7\u8d1d\uff09 \u4e0a\u4e0b\u6587\u5207\u6362\uff1a\u7528\u6237\u6001 \u2194 \u5185\u6838\u6001\u7684\u5207\u6362\uff08<code>read()</code>\u548c<code>send()</code>\u4e24\u6b21\u7cfb\u7edf\u8c03\u7528\uff09\u3002</p> <p>\u96f6\u62f7\u8d1d\uff08Zero-Copy\uff09\u7684\u6838\u5fc3\u601d\u60f3\uff1a\u6d88\u9664\u5197\u4f59\u7684\u6570\u636e\u62f7\u8d1d\u548c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u76f4\u63a5\u5728\u5185\u6838\u7a7a\u95f4\u5b8c\u6210\u6570\u636e\u4f20\u8f93\u3002</p> <p></p> <ol> <li>java \u8c03\u7528 transferTo \u65b9\u6cd5\u540e\uff0c\u8981\u4ece java \u7a0b\u5e8f\u7684\u7528\u6237\u6001\u5207\u6362\u81f3\u5185\u6838\u6001\uff0c\u4f7f\u7528 DMA\u5c06\u6570\u636e\u8bfb\u5165\u5185\u6838\u7f13\u51b2\u533a</li> <li>\u53ea\u4f1a\u5c06\u4e00\u4e9b offset \u548c length \u4fe1\u606f\u62f7\u5165 socket \u7f13\u51b2\u533a\uff0c\u51e0\u4e4e\u65e0\u6d88\u8017</li> <li>\u4f7f\u7528 DMA \u5c06 \u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u7f51\u5361\uff0c\u4e0d\u4f1a\u4f7f\u7528 cpu</li> </ol> <p>0\u6b21CPU\u62f7\u8d1d</p> <pre><code>        File file = new File(Paths.get(\"data.txt\").toUri());\n        FileChannel channel = new FileInputStream(file).getChannel();\n        channel.transferTo(0L, channel.size(), Channels.newChannel(System.out));\n        channel.close();\n</code></pre>"},{"location":"Netty/Netty/#\u5f02\u6b65io","title":"\u5f02\u6b65IO","text":"<p>\u5f02\u6b65\u6a21\u578b\u9700\u8981\u5e95\u5c42\u64cd\u4f5c\u7cfb\u7edf\uff08Kernel\uff09\u63d0\u4f9b\u652f\u6301</p> <ul> <li>Windows \u7cfb\u7edf\u901a\u8fc7 IOCP \u5b9e\u73b0\u4e86\u771f\u6b63\u7684\u5f02\u6b65 IO</li> <li>Linux \u7cfb\u7edf\u5f02\u6b65 IO \u5728 2.6 \u7248\u672c\u5f15\u5165\uff0c\u4f46\u5176\u5e95\u5c42\u5b9e\u73b0\u8fd8\u662f\u7528\u591a\u8def\u590d\u7528\u6a21\u62df\u4e86\u5f02\u6b65 IO\uff0c\u6027\u80fd\u6ca1\u6709\u4f18\u52bf</li> </ul>"},{"location":"Netty/Netty/#\u6587\u4ef6-aio","title":"\u6587\u4ef6 AIO","text":"<pre><code>        try (AsynchronousFileChannel channel = AsynchronousFileChannel.open(\n                Paths.get(\"data.txt\"),\n                StandardOpenOption.READ)) {\n            ByteBuffer buffer = ByteBuffer.allocate(16);\n            channel.read(buffer, 0, buffer, new CompletionHandler&lt;&gt;() {\n                @Override\n                public void completed(Integer result, ByteBuffer attachment) {\n                    attachment.flip();\n                    while (attachment.hasRemaining()) {\n                        log.info(String.valueOf(attachment.get()));\n                    }\n                }\n\n                @Override\n                public void failed(Throwable exc, ByteBuffer attachment) {\n                    log.error(exc.toString());\n                }\n            });\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n</code></pre> <p>[!Caution]</p> <p>\u6587\u4ef6\u5f02\u6b65IO\u4f7f\u7528\u7684\u662f\u5b88\u62a4\u7ebf\u7a0b\uff0c\u5373\u5176\u4ed6\u6240\u6709\u7ebf\u7a0b\u7ed3\u675f\uff0c\u8be5\u7ebf\u7a0b\u4e5f\u4f1a\u7acb\u5373\u7ed3\u675f\u800c\u4e0d\u4f1a\u5b8c\u6210\u540e\u7eed\u4efb\u52a1</p>"},{"location":"Netty/Netty/#netty\u57fa\u7840","title":"Netty\u57fa\u7840","text":"<p>\u5165\u95e8\u793a\u4f8b\uff1a</p> <pre><code>        // \u670d\u52a1\u7aef\n        new ServerBootstrap()\n                .group(new NioEventLoopGroup())\n                // \u670d\u52a1\u7aefChannel\u5b9e\u73b0\n                .channel(NioServerSocketChannel.class)\n                // \u8d1f\u8d23\u8bfb\u5199\n                .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() {\n                    @Override\n                    protected void initChannel(NioSocketChannel channel) {\n                        // \u5c06\u6d88\u606f\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n                        channel.pipeline().addLast(new StringDecoder());\n                        // \u5904\u7406\u63a5\u6536\u5230\u7684\u6d88\u606f\n                        channel.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                            @Override\n                            public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                                log.info(\"received a message: {}\", msg);\n                            }\n                        });\n                    }\n                })\n                .bind(8080);\n\n\n        // \u5ba2\u6237\u7aef\n        new Bootstrap()\n                .group(new NioEventLoopGroup())\n                .channel(NioSocketChannel.class)\n                // \u5904\u7406\u5668\n                .handler(new ChannelInitializer&lt;NioSocketChannel&gt;() {\n                    @Override\n                    protected void initChannel(NioSocketChannel ch) {\n                        // \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5b57\u8282\u6570\u7ec4\n                        ch.pipeline().addLast(new StringEncoder());\n                    }\n                })\n                .connect(new InetSocketAddress(\"localhost\", 8080))\n                .sync() // \u963b\u585e\u7b49\u5f85\u8fde\u63a5\u5efa\u7acb\n                .channel()\n                .writeAndFlush(\"Hello, Netty!\");\n</code></pre>"},{"location":"Netty/Netty/#\u7ec4\u4ef6","title":"\u7ec4\u4ef6","text":""},{"location":"Netty/Netty/#eventloop","title":"EventLoop","text":"<p>\u4e8b\u4ef6\u5faa\u73af\u5bf9\u8c61\uff0cEventLoop \u672c\u8d28\u662f\u4e00\u4e2a\u5355\u7ebf\u7a0b\u6267\u884c\u5668\uff08\u540c\u65f6\u7ef4\u62a4\u4e86\u4e00\u4e2a Selector\uff09\uff0c\u5904\u7406 Channel \u4e0a\u6e90\u6e90\u4e0d\u65ad\u7684 io \u4e8b\u4ef6\u3002</p> <ol> <li>\u5355\u7ebf\u7a0b\u8bbe\u8ba1\uff1a\u6bcf\u4e2aEventLoop\u5728\u5176\u751f\u547d\u5468\u671f\u5185\u53ea\u4f7f\u7528\u4e00\u4e2a\u7ebf\u7a0b</li> <li>\u4e8b\u4ef6\u5faa\u73af\uff1a\u4e0d\u65ad\u68c0\u67e5\u662f\u5426\u6709\u65b0\u7684\u4e8b\u4ef6\u9700\u8981\u5904\u7406</li> <li>\u4efb\u52a1\u961f\u5217\uff1a\u7ef4\u62a4\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u7528\u4e8e\u6267\u884c\u975eI/O\u4efb\u52a1</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u786e\u4fdd\u6240\u6709\u4efb\u52a1\u6309\u987a\u5e8f\u6267\u884c</li> </ol> <p>\u4e8b\u4ef6\u5faa\u73af\u7ec4\uff0cEventLoopGroup \u662f\u4e00\u7ec4 EventLoop\uff0cChannel \u4e00\u822c\u4f1a\u8c03\u7528 EventLoopGroup \u7684 register \u65b9\u6cd5\u6765\u7ed1\u5b9a\u5176\u4e2d\u4e00\u4e2a EventLoop\uff0c\u540e\u7eed\u8fd9\u4e2a Channel \u4e0a\u7684 io \u4e8b\u4ef6\u90fd\u7531\u6b64 EventLoop \u6765\u5904\u7406\uff08\u4fdd\u8bc1\u4e86 io \u4e8b\u4ef6\u5904\u7406\u65f6\u7684\u7ebf\u7a0b\u5b89\u5168\uff09</p> <p>[!Tip]</p> <ol> <li>\u907f\u514d\u5728EventLoop\u4e2d\u6267\u884c\u957f\u65f6\u95f4\u963b\u585e\u7684\u64cd\u4f5c</li> <li>\u5c06\u8017\u65f6\u64cd\u4f5c\u653e\u5165\u4e1a\u52a1\u7ebf\u7a0b\u6c60\u5904\u7406</li> <li>\u5408\u7406\u914d\u7f6eEventLoopGroup\u7684\u7ebf\u7a0b\u6570\uff08\u901a\u5e38\u4e0eCPU\u6838\u5fc3\u6570\u76f8\u5173\uff09</li> </ol> <p>IO\u4e8b\u4ef6\u53ef\u4ee5\u7531\u591a\u4e2aHandler\u5904\u7406\uff0c\u800c\u4e14\u8fd9\u4e9bHandler\u53ef\u4ee5\u5728\u4e0d\u540c\u7684EventLoopGroup\u4e2d\uff0cHandler\u95f4\u4ea4\u63a5\u4efb\u52a1\u7684\u6e90\u7801\u5982\u4e0b</p> <pre><code>static void invokeChannelRead(final AbstractChannelHandlerContext next, Object msg) {\n    final Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, \"msg\"), next);\n    // \u4e0b\u4e00\u4e2a handler \u7684\u4e8b\u4ef6\u5faa\u73af\u662f\u5426\u4e0e\u5f53\u524d\u7684\u4e8b\u4ef6\u5faa\u73af\u662f\u540c\u4e00\u4e2a\u7ebf\u7a0b\n    EventExecutor executor = next.executor();\n\n    // \u662f\uff0c\u76f4\u63a5\u8c03\u7528\n    if (executor.inEventLoop()) {\n        next.invokeChannelRead(m);\n    } \n    // \u4e0d\u662f\uff0c\u5c06\u8981\u6267\u884c\u7684\u4ee3\u7801\u4f5c\u4e3a\u4efb\u52a1\u63d0\u4ea4\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u5904\u7406\uff08\u6362\u4eba\uff09\n    else {\n        executor.execute(new Runnable() {\n            @Override\n            public void run() {\n                next.invokeChannelRead(m);\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"Netty/Netty/#channel","title":"Channel","text":"<ul> <li>close() \u53ef\u4ee5\u7528\u6765\u5173\u95ed channel</li> <li>closeFuture() \u7528\u6765\u5904\u7406 channel \u7684\u5173\u95ed</li> <li>sync() \u65b9\u6cd5\u4f5c\u7528\u662f\u540c\u6b65\u7b49\u5f85 channel \u5173\u95ed</li> <li>\u800c addListener() \u65b9\u6cd5\u662f\u5f02\u6b65\u7b49\u5f85 channel \u5173\u95ed</li> <li>pipeline() \u65b9\u6cd5\u6dfb\u52a0\u5904\u7406\u5668</li> <li>write() \u65b9\u6cd5\u5c06\u6570\u636e\u5199\u5165</li> <li>writeAndFlush() \u65b9\u6cd5\u5c06\u6570\u636e\u5199\u5165\u5e76\u5237\u51fa</li> </ul>"},{"location":"Netty/Netty/#channelfuture","title":"ChannelFuture","text":"<ol> <li>\u5f02\u6b65\u901a\u77e5\u673a\u5236\uff1a\u901a\u8fc7\u6dfb\u52a0\u76d1\u542c\u5668\u83b7\u53d6\u64cd\u4f5c\u5b8c\u6210\u901a\u77e5</li> <li>\u64cd\u4f5c\u72b6\u6001\u67e5\u8be2\uff1a\u53ef\u68c0\u67e5\u64cd\u4f5c\u662f\u5426\u5b8c\u6210\u3001\u6210\u529f\u6216\u53d6\u6d88</li> <li>\u4e0d\u53ef\u53d8\u6027\uff1a\u4e00\u65e6\u521b\u5efa\uff0c\u7ed3\u679c\u4e0d\u53ef\u6539\u53d8</li> <li>\u94fe\u5f0f\u64cd\u4f5c\uff1a\u652f\u6301\u6dfb\u52a0\u591a\u4e2a\u76d1\u542c\u5668</li> </ol> <pre><code>// \u6dfb\u52a0\u76d1\u542c\u5668\uff0c\u64cd\u4f5c\u5b8c\u6210\u65f6\u56de\u8c03\nChannelFuture addListener(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt; listener);\n\n// \u79fb\u9664\u76d1\u542c\u5668\nChannelFuture removeListener(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt; listener);\n\n// \u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\uff08\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff09\nChannelFuture sync() throws InterruptedException;\n\n// \u64cd\u4f5c\u662f\u5426\u5b8c\u6210\nboolean isDone();\n\n// \u64cd\u4f5c\u662f\u5426\u6210\u529f\nboolean isSuccess();\n\n// \u53d6\u6d88\u64cd\u4f5c\uff08Netty\u4e2d\u901a\u5e38\u4e0d\u652f\u6301\uff09\nboolean cancel(boolean mayInterruptIfRunning);\n</code></pre> <p>[!Note]</p> <p>\u5ba2\u6237\u7aef\u7684connect\u65b9\u6cd5\u662f\u5f02\u6b65\u65b9\u6cd5\uff0c\u5e76\u4e0d\u4f1a\u7b49\u5f85\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u6240\u4ee5\u9700\u8981ChannelFuture\u6765\u540c\u6b65\u83b7\u53d6\u8fde\u63a5\u7684Channel</p> <pre><code>        ChannelFuture channelFuture = new Bootstrap()\n                .group(new NioEventLoopGroup())\n                .channel(NioSocketChannel.class)\n                // \u5904\u7406\u5668\n                .handler(...)\n                .connect(new InetSocketAddress(\"localhost\", 8080));\n        channelFuture.sync(); // \u7b49\u5f85\u8fde\u63a5\u5efa\u7acb\n        Channel channel = channelFuture.channel();\n        channel.writeAndFlush(\"Hello, Netty!\");\n</code></pre> <p>[!Tip]</p> <p>\u6216\u8005\u4e3aChannelFuture\u6dfb\u52a0\u76d1\u89c6\u5668\u6765\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\uff0c\u81ea\u52a8\u56de\u8c03</p>"},{"location":"Netty/Netty/#\u6b63\u786e\u5173\u95edchannel","title":"\u6b63\u786e\u5173\u95edChannel","text":"<p><code>channel.close()</code>\u4e5f\u662f\u4e00\u4e2a\u5f02\u6b65\u64cd\u4f5c\uff0c\u5982\u679c\u5728\u5173\u95ed\u540e\u624d\u80fd\u8fdb\u884c\u5176\u4ed6\u4efb\u52a1\uff0c\u9700\u8981\u4f7f\u7528\u540c\u6b65\u65b9\u6cd5\u6216\u8005\u76d1\u542c\u5668</p> <pre><code>        // \u540c\u6b65\u7b49\u5f85\n        ChannelFuture closeFuture = channel.closeFuture();\n        closeFuture.sync();\n        // \u5176\u4ed6\u64cd\u4f5c\n        log.debug(\"\u5173\u95ed\u8fde\u63a5\");\n\n\n        // \u6216\u8005\u6dfb\u52a0\u76d1\u542c\u5668\n        closeFuture.addListener(new ChannelFutureListener() {\n            @Override\n            public void operationComplete(ChannelFuture future) throws Exception {\n                //...\n            }\n        });\n</code></pre> <p>[!Tip]</p> <p>\u4ee5\u4e0a\u64cd\u4f5c\u4e4b\u540e\u4fdd\u8bc1\u5728<code>channel.close()</code>\u6210\u529f\u540e\u6267\u884c</p>"},{"location":"Netty/Netty/#\u5173\u95ednetty","title":"\u5173\u95edNetty","text":"<pre><code>        NioEventLoopGroup group = new NioEventLoopGroup();\n        //\u521d\u59cb\u5316Netty\n        //...\n        group.shutdownGracefully();\n</code></pre>"},{"location":"Netty/Netty/#future--promise","title":"Future &amp; Promise","text":"<pre><code>graph LR\nsubgraph \u7ee7\u627f\u4f53\u7cfb\nNetty-Future --&gt; JDK-Future\nPromise --&gt; Netty-Future\nend\n</code></pre> <ul> <li>jdk Future \u53ea\u80fd\u540c\u6b65\u7b49\u5f85\u4efb\u52a1\u7ed3\u675f\uff08\u6216\u6210\u529f\u3001\u6216\u5931\u8d25\uff09\u624d\u80fd\u5f97\u5230\u7ed3\u679c</li> <li>netty Future \u53ef\u4ee5\u540c\u6b65\u7b49\u5f85\u4efb\u52a1\u7ed3\u675f\u5f97\u5230\u7ed3\u679c\uff0c\u4e5f\u53ef\u4ee5\u5f02\u6b65\u65b9\u5f0f\u5f97\u5230\u7ed3\u679c\uff0c\u4f46\u90fd\u662f\u8981\u7b49\u4efb\u52a1\u7ed3\u675f</li> <li>netty Promise \u4e0d\u4ec5\u6709 netty Future \u7684\u529f\u80fd\uff0c\u800c\u4e14\u8131\u79bb\u4e86\u4efb\u52a1\u72ec\u7acb\u5b58\u5728\uff0c\u53ea\u4f5c\u4e3a\u4e24\u4e2a\u7ebf\u7a0b\u95f4\u4f20\u9012\u7ed3\u679c\u7684\u5bb9\u5668</li> </ul> <p>\u5e38\u7528\u65b9\u6cd5\uff1a</p> \u529f\u80fd/\u540d\u79f0 jdk Future netty Future Promise cancel \u53d6\u6d88\u4efb\u52a1 - - isCanceled \u4efb\u52a1\u662f\u5426\u53d6\u6d88 - - isDone \u4efb\u52a1\u662f\u5426\u5b8c\u6210\uff0c\u4e0d\u80fd\u533a\u5206\u6210\u529f\u5931\u8d25 - - get \u83b7\u53d6\u4efb\u52a1\u7ed3\u679c\uff0c\u963b\u585e\u7b49\u5f85 - - getNow - \u83b7\u53d6\u4efb\u52a1\u7ed3\u679c\uff0c\u975e\u963b\u585e\uff0c\u8fd8\u672a\u4ea7\u751f\u7ed3\u679c\u65f6\u8fd4\u56de null - await - \u7b49\u5f85\u4efb\u52a1\u7ed3\u675f\uff0c\u5982\u679c\u4efb\u52a1\u5931\u8d25\uff0c\u4e0d\u4f1a\u629b\u5f02\u5e38\uff0c\u800c\u662f\u901a\u8fc7 isSuccess \u5224\u65ad - sync - \u7b49\u5f85\u4efb\u52a1\u7ed3\u675f\uff0c\u5982\u679c\u4efb\u52a1\u5931\u8d25\uff0c\u629b\u51fa\u5f02\u5e38 - isSuccess - \u5224\u65ad\u4efb\u52a1\u662f\u5426\u6210\u529f - cause - \u83b7\u53d6\u5931\u8d25\u4fe1\u606f\uff0c\u975e\u963b\u585e\uff0c\u5982\u679c\u6ca1\u6709\u5931\u8d25\uff0c\u8fd4\u56denull - addLinstener - \u6dfb\u52a0\u56de\u8c03\uff0c\u5f02\u6b65\u63a5\u6536\u7ed3\u679c - setSuccess - - \u8bbe\u7f6e\u6210\u529f\u7ed3\u679c setFailure - - \u8bbe\u7f6e\u5931\u8d25\u7ed3\u679c"},{"location":"Netty/Netty/#handler--pipeline","title":"Handler &amp; Pipeline","text":"<p>ChannelHandler \u7528\u6765\u5904\u7406 Channel \u4e0a\u7684\u5404\u79cd\u4e8b\u4ef6\uff0c\u5206\u4e3a\u5165\u7ad9\u3001\u51fa\u7ad9\u4e24\u79cd\u3002\u6240\u6709 ChannelHandler \u88ab\u8fde\u6210\u4e00\u4e32\uff0c\u5c31\u662f Pipeline</p> <ul> <li>\u5165\u7ad9\u5904\u7406\u5668\u901a\u5e38\u662f ChannelInboundHandlerAdapter \u7684\u5b50\u7c7b\uff0c\u4e3b\u8981\u7528\u6765\u8bfb\u53d6\u5ba2\u6237\u7aef\u6570\u636e\uff0c\u5199\u56de\u7ed3\u679c</li> <li>\u51fa\u7ad9\u5904\u7406\u5668\u901a\u5e38\u662f ChannelOutboundHandlerAdapter \u7684\u5b50\u7c7b\uff0c\u4e3b\u8981\u5bf9\u5199\u56de\u7ed3\u679c\u8fdb\u884c\u52a0\u5de5</li> </ul> <p></p> <p>[!Tip]</p> <p>\u5165\u7ad9\u987a\u5e8f \u4ece\u5de6\u5230\u53f3</p> <p>\u51fa\u7ad9\u987a\u5e8f \u4ece\u53f3\u5230\u5de6</p> <p>Handler\u95f4\u901a\u8fc7ChannelHandlerContext.fireChannelRead(msg)\u4f20\u9012\u5904\u7406\u7684\u6570\u636e</p> <p>[!Warning]</p> <ul> <li>ChannelHandlerContext.channel().write(msg) \u4ece\u5c3e\u90e8\u5f00\u59cb\u67e5\u627e\u51fa\u7ad9\u5904\u7406\u5668</li> <li>ChannelHandlerContext.write(msg) \u662f\u4ece\u5f53\u524d\u8282\u70b9\u627e\u4e0a\u4e00\u4e2a\u51fa\u7ad9\u5904\u7406\u5668</li> </ul>"},{"location":"Netty/Netty/#bytebuf","title":"ByteBuf","text":"<p>[!Tip]</p> <p>Netty\u4e2d\u7684ByteBuf\u5bf9NIO\u4e2d\u7684ByteBuffer\u8fdb\u884c\u4e86\u529f\u80fd\u589e\u5f3a</p> <p>\u4f18\u52bf\uff1a</p> <ul> <li>\u6c60\u5316 - \u53ef\u4ee5\u91cd\u7528\u6c60\u4e2d ByteBuf \u5b9e\u4f8b\uff0c\u66f4\u8282\u7ea6\u5185\u5b58\uff0c\u51cf\u5c11\u5185\u5b58\u6ea2\u51fa\u7684\u53ef\u80fd</li> <li>\u8bfb\u5199\u6307\u9488\u5206\u79bb\uff0c\u4e0d\u9700\u8981\u50cf ByteBuffer \u4e00\u6837\u5207\u6362\u8bfb\u5199\u6a21\u5f0f</li> <li>\u53ef\u4ee5\u81ea\u52a8\u6269\u5bb9</li> <li>\u652f\u6301\u94fe\u5f0f\u8c03\u7528\uff0c\u4f7f\u7528\u66f4\u6d41\u7545</li> <li>\u5f88\u591a\u5730\u65b9\u4f53\u73b0\u96f6\u62f7\u8d1d\uff0c\u4f8b\u5982 slice\u3001duplicate\u3001CompositeByteBuf</li> </ul>"},{"location":"Netty/Netty/#\u521b\u5efa_1","title":"\u521b\u5efa","text":"<pre><code>// \u76f4\u63a5\u5185\u5b58\nByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(10);\nByteBuf buffer = ByteBufAllocator.DEFAULT.directBuffer(10);\n\n// Java\u5806\u5185\u5b58\nByteBuf buffer = ByteBufAllocator.DEFAULT.heapBuffer(10);\n</code></pre> <p>[!Note]</p> <ul> <li>\u76f4\u63a5\u5185\u5b58\u521b\u5efa\u548c\u9500\u6bc1\u7684\u4ee3\u4ef7\u6602\u8d35\uff0c\u4f46\u8bfb\u5199\u6027\u80fd\u9ad8\uff08\u5c11\u4e00\u6b21\u5185\u5b58\u590d\u5236\uff09\uff0c\u9002\u5408\u914d\u5408\u6c60\u5316\u529f\u80fd\u4e00\u8d77\u7528</li> <li>\u76f4\u63a5\u5185\u5b58\u5bf9 GC \u538b\u529b\u5c0f\uff0c\u56e0\u4e3a\u8fd9\u90e8\u5206\u5185\u5b58\u4e0d\u53d7 JVM \u5783\u573e\u56de\u6536\u7684\u7ba1\u7406\uff0c\u4f46\u4e5f\u8981\u6ce8\u610f\u53ca\u65f6\u4e3b\u52a8\u91ca\u653e</li> </ul>"},{"location":"Netty/Netty/#\u6c60\u5316","title":"\u6c60\u5316","text":"<p>\u6c60\u5316\u7684\u6700\u5927\u610f\u4e49\u5728\u4e8e\u53ef\u4ee5\u91cd\u7528 ByteBuf</p> <ul> <li>\u6ca1\u6709\u6c60\u5316\uff0c\u5219\u6bcf\u6b21\u90fd\u5f97\u521b\u5efa\u65b0\u7684 ByteBuf \u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5bf9\u76f4\u63a5\u5185\u5b58\u4ee3\u4ef7\u6602\u8d35\uff0c\u5c31\u7b97\u662f\u5806\u5185\u5b58\uff0c\u4e5f\u4f1a\u589e\u52a0 GC \u538b\u529b</li> <li>\u6709\u4e86\u6c60\u5316\uff0c\u5219\u53ef\u4ee5\u91cd\u7528\u6c60\u4e2d ByteBuf \u5b9e\u4f8b\uff0c\u5e76\u4e14\u91c7\u7528\u4e86\u4e0e jemalloc \u7c7b\u4f3c\u7684\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u63d0\u5347\u5206\u914d\u6548\u7387</li> <li>\u9ad8\u5e76\u53d1\u65f6\uff0c\u6c60\u5316\u529f\u80fd\u66f4\u8282\u7ea6\u5185\u5b58\uff0c\u51cf\u5c11\u5185\u5b58\u6ea2\u51fa\u7684\u53ef\u80fd</li> </ul> <p>[!Tip]</p> <p>\u9ed8\u8ba4\u5f00\u542f\u6c60\u5316\uff0c\u53ef\u901a\u8fc7<code>-Dio.netty.allocator.type={unpooled|pooled}</code>\u914d\u7f6e</p>"},{"location":"Netty/Netty/#\u7ed3\u6784_1","title":"\u7ed3\u6784","text":""},{"location":"Netty/Netty/#\u5199\u5165_1","title":"\u5199\u5165","text":"\u65b9\u6cd5\u7b7e\u540d \u542b\u4e49 \u5907\u6ce8 writeBoolean(boolean value) \u5199\u5165 boolean \u503c \u7528\u4e00\u5b57\u8282 01|00 \u4ee3\u8868true|false writeByte(int value) \u5199\u5165 byte \u503c writeShort(int value) \u5199\u5165 short \u503c writeInt(int value) \u5199\u5165 int \u503c \uff08\u5927\u7aef\uff09Big Endian\uff0c\u5373 0x250\uff0c\u5199\u5165\u540e 00 00 02 50 writeIntLE(int value) \u5199\u5165 int \u503c \uff08\u5c0f\u7aef\uff09Little Endian\uff0c\u5373 0x250\uff0c\u5199\u5165\u540e 50 02 00 00 writeLong(long value) \u5199\u5165 long \u503c writeChar(int value) \u5199\u5165 char \u503c writeFloat(float value) \u5199\u5165 float \u503c writeDouble(double value) \u5199\u5165 double \u503c writeBytes(ByteBuf src) \u5199\u5165 netty \u7684 ByteBuf writeBytes(byte[] src) \u5199\u5165 byte[] writeBytes(ByteBuffer src) \u5199\u5165 nio \u7684 ByteBuffer int writeCharSequence(CharSequence sequence, Charset charset) \u5199\u5165\u5b57\u7b26\u4e32"},{"location":"Netty/Netty/#\u8bfb\u53d6_1","title":"\u8bfb\u53d6","text":"<p>\u8bfb\u8fc7\u7684\u5185\u5bb9\uff0c\u5c31\u5c5e\u4e8e\u5e9f\u5f03\u90e8\u5206\u4e86\uff0c\u518d\u8bfb\u53ea\u80fd\u8bfb\u90a3\u4e9b\u5c1a\u672a\u8bfb\u53d6\u7684\u90e8\u5206\uff0c\u53ef\u4ee5\u5728 read \u524d\u5148\u505a\u4e2a\u6807\u8bb0 mark</p> <pre><code>buffer.markReaderIndex();\n// ...\nbuffer.resetReaderIndex();\n</code></pre>"},{"location":"Netty/Netty/#\u6269\u5bb9","title":"\u6269\u5bb9","text":"<p>\u6269\u5bb9\u89c4\u5219\u662f</p> <ul> <li>\u5982\u4f55\u5199\u5165\u540e\u6570\u636e\u5927\u5c0f\u672a\u8d85\u8fc7 512\uff0c\u5219\u9009\u62e9\u4e0b\u4e00\u4e2a 16 \u7684\u6574\u6570\u500d\uff0c\u4f8b\u5982\u5199\u5165\u540e\u5927\u5c0f\u4e3a 12 \uff0c\u5219\u6269\u5bb9\u540e capacity \u662f 16</li> <li>\u5982\u679c\u5199\u5165\u540e\u6570\u636e\u5927\u5c0f\u8d85\u8fc7 512\uff0c\u5219\u9009\u62e9\u4e0b\u4e00\u4e2a 2^n\uff0c\u4f8b\u5982\u5199\u5165\u540e\u5927\u5c0f\u4e3a 513\uff0c\u5219\u6269\u5bb9\u540e capacity \u662f 2^10=1024</li> <li>\u6269\u5bb9\u4e0d\u80fd\u8d85\u8fc7 max capacity</li> </ul>"},{"location":"Netty/Netty/#\u5185\u5b58\u56de\u6536","title":"\u5185\u5b58\u56de\u6536","text":"<p>[!Tip]</p> <p>\u4e3b\u8981\u9488\u5bf9\u76f4\u63a5\u5185\u5b58</p> <ul> <li>UnpooledHeapByteBuf \u4f7f\u7528\u7684\u662f JVM \u5185\u5b58\uff0c\u53ea\u9700\u7b49 GC \u56de\u6536\u5185\u5b58\u5373\u53ef</li> <li>UnpooledDirectByteBuf \u4f7f\u7528\u7684\u5c31\u662f\u76f4\u63a5\u5185\u5b58\u4e86\uff0c\u9700\u8981\u7279\u6b8a\u7684\u65b9\u6cd5\u6765\u56de\u6536\u5185\u5b58</li> <li>PooledByteBuf \u548c\u5b83\u7684\u5b50\u7c7b\u4f7f\u7528\u4e86\u6c60\u5316\u673a\u5236\uff0c\u9700\u8981\u66f4\u590d\u6742\u7684\u89c4\u5219\u6765\u56de\u6536\u5185\u5b58</li> </ul> <p>Netty \u91c7\u7528\u4e86\u5f15\u7528\u8ba1\u6570\u6cd5\uff08\u53ef\u53c2\u8003\u7b14\u8bb0JVM\u5783\u573e\u56de\u6536\u7bc7\uff09\u6765\u63a7\u5236\u56de\u6536\u5185\u5b58\uff0c\u6bcf\u4e2a ByteBuf \u90fd\u5b9e\u73b0\u4e86 ReferenceCounted \u63a5\u53e3</p> <ul> <li>\u6bcf\u4e2a ByteBuf \u5bf9\u8c61\u7684\u521d\u59cb\u8ba1\u6570\u4e3a 1</li> <li>\u8c03\u7528 release \u65b9\u6cd5\u8ba1\u6570\u51cf 1\uff0c\u5982\u679c\u8ba1\u6570\u4e3a 0\uff0cByteBuf \u5185\u5b58\u88ab\u56de\u6536</li> <li>\u8c03\u7528 retain \u65b9\u6cd5\u8ba1\u6570\u52a0 1\uff0c\u8868\u793a\u8c03\u7528\u8005\u6ca1\u7528\u5b8c\u4e4b\u524d\uff0c\u5176\u5b83 handler \u5373\u4f7f\u8c03\u7528\u4e86 release \u4e5f\u4e0d\u4f1a\u9020\u6210\u56de\u6536</li> <li>\u5f53\u8ba1\u6570\u4e3a 0 \u65f6\uff0c\u5e95\u5c42\u5185\u5b58\u4f1a\u88ab\u56de\u6536\uff0c\u8fd9\u65f6\u5373\u4f7f ByteBuf \u5bf9\u8c61\u8fd8\u5728\uff0c\u5176\u5404\u4e2a\u65b9\u6cd5\u5747\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528</li> </ul> <p>\u4e00\u4e9b\u5b9e\u8df5\u89c4\u5219\uff1a</p> <ul> <li>\u5165\u7ad9 ByteBuf \u5904\u7406\u539f\u5219</li> <li>\u5bf9\u539f\u59cb ByteBuf \u4e0d\u505a\u5904\u7406\uff0c\u8c03\u7528 ctx.fireChannelRead(msg) \u5411\u540e\u4f20\u9012\uff0c\u8fd9\u65f6\u65e0\u987b release</li> <li>\u5c06\u539f\u59cb ByteBuf \u8f6c\u6362\u4e3a\u5176\u5b83\u7c7b\u578b\u7684 Java \u5bf9\u8c61\uff0c\u8fd9\u65f6 ByteBuf \u5c31\u6ca1\u7528\u4e86\uff0c\u5fc5\u987b release</li> <li>\u5982\u679c\u4e0d\u8c03\u7528 ctx.fireChannelRead(msg) \u5411\u540e\u4f20\u9012\uff0c\u90a3\u4e48\u4e5f\u5fc5\u987b release</li> <li>\u6ce8\u610f\u5404\u79cd\u5f02\u5e38\uff0c\u5982\u679c ByteBuf \u6ca1\u6709\u6210\u529f\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a ChannelHandler\uff0c\u5fc5\u987b release</li> <li>\u5047\u8bbe\u6d88\u606f\u4e00\u76f4\u5411\u540e\u4f20\uff0c\u90a3\u4e48 TailContext \u4f1a\u8d1f\u8d23\u91ca\u653e\u672a\u5904\u7406\u6d88\u606f\uff08\u539f\u59cb\u7684 ByteBuf\uff09</li> <li>\u51fa\u7ad9 ByteBuf \u5904\u7406\u539f\u5219</li> <li>\u51fa\u7ad9\u6d88\u606f\u6700\u7ec8\u90fd\u4f1a\u8f6c\u4e3a ByteBuf \u8f93\u51fa\uff0c\u4e00\u76f4\u5411\u524d\u4f20\uff0c\u7531 HeadContext flush \u540e release</li> </ul>"},{"location":"Netty/Netty/#\u5207\u7247","title":"\u5207\u7247","text":"<p>[!Tip]</p> <p>ByteBuf\u7684\u5207\u7247(Slice)\u662fNetty\u63d0\u4f9b\u7684\u4e00\u79cd\u96f6\u62f7\u8d1d\u673a\u5236\uff0c\u5141\u8bb8\u5728\u4e0d\u5b9e\u9645\u590d\u5236\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u73b0\u6709\u7f13\u51b2\u533a\u7684\u89c6\u56fe(view)\u3002</p> <p>\u5207\u7247\u64cd\u4f5c\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684ByteBuf\u5b9e\u4f8b\uff0c\u8be5\u5b9e\u4f8b\u4e0e\u539f\u59cb\u7f13\u51b2\u533a\u5171\u4eab\u76f8\u540c\u7684\u5185\u5b58\u533a\u57df\uff0c\u4f46\u6709\u81ea\u5df1\u7684\u8bfb\u5199\u7d22\u5f15\u548c\u6807\u8bb0\u3002</p> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u96f6\u62f7\u8d1d\uff1a\u4e0d\u5b9e\u9645\u590d\u5236\u6570\u636e\uff0c\u51cf\u5c11\u5185\u5b58\u5f00\u9500</li> <li>\u5171\u4eab\u5e95\u5c42\u5b58\u50a8\uff1a\u591a\u4e2a\u5207\u7247\u5171\u4eab\u540c\u4e00\u5757\u5185\u5b58</li> <li>\u72ec\u7acb\u7d22\u5f15\uff1a\u6bcf\u4e2a\u5207\u7247\u6709\u81ea\u5df1\u7684\u8bfb\u5199\u7d22\u5f15</li> <li>\u89c6\u56fe\u9650\u5236\uff1a\u5207\u7247\u53ea\u80fd\u8bbf\u95ee\u539f\u59cb\u7f13\u51b2\u533a\u7684\u4e00\u90e8\u5206</li> </ul> <pre><code>// \u521b\u5efa\u4e00\u4e2a\u4ecereaderIndex\u5f00\u59cb\u5230writerIndex\u7ed3\u675f\u7684\u5207\u7247\nByteBuf slice = buffer.slice();\n\n// \u521b\u5efa\u4e00\u4e2a\u4ece\u6307\u5b9aindex\u5f00\u59cb\uff0c\u6307\u5b9alength\u957f\u5ea6\u7684\u5207\u7247\nByteBuf slice = buffer.slice(offset, length);\n\n// \u521b\u5efa\u4e00\u4e2a\u5207\u7247\u5e76\u589e\u52a0\u5f15\u7528\u8ba1\u6570(\u9632\u6b62\u539f\u59cb\u7f13\u51b2\u533a\u88ab\u91ca\u653e)\nByteBuf slice = buffer.retainedSlice();\n</code></pre> <p>[!Caution]</p> <p>\u539f\u59cb\u7684ByteBuf\u91ca\u653e\u5185\u5b58\u540e\uff0c\u5176\u5207\u7247\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86\uff0c\u5efa\u8bae\u4f7f\u7528\u539f\u59cbByteBuf\u7684<code>retainedSlice()</code>\u589e\u52a0\u5f15\u7528\u8ba1\u6570\uff0c\u6216\u8005\u5207\u7247\u7684<code>retain()</code>\u65b9\u6cd5</p>"},{"location":"Netty/Netty/#\u5176\u4ed6","title":"\u5176\u4ed6","text":"<ol> <li>duplicate</li> </ol> <p>\u3010\u96f6\u62f7\u8d1d\u3011\u7684\u4f53\u73b0\u4e4b\u4e00\uff0c\u5c31\u597d\u6bd4\u622a\u53d6\u4e86\u539f\u59cb ByteBuf \u6240\u6709\u5185\u5bb9\uff0c\u5e76\u4e14\u6ca1\u6709 max capacity \u7684\u9650\u5236\uff0c\u4e5f\u662f\u4e0e\u539f\u59cb ByteBuf \u4f7f\u7528\u540c\u4e00\u5757\u5e95\u5c42\u5185\u5b58\uff0c\u53ea\u662f\u8bfb\u5199\u6307\u9488\u662f\u72ec\u7acb\u7684</p> <ol> <li>copy</li> </ol> <p>\u4f1a\u5c06\u5e95\u5c42\u5185\u5b58\u6570\u636e\u8fdb\u884c\u6df1\u62f7\u8d1d\uff0c\u56e0\u6b64\u65e0\u8bba\u8bfb\u5199\uff0c\u90fd\u4e0e\u539f\u59cb ByteBuf \u65e0\u5173</p> <ol> <li>CompositeByteBuf</li> </ol> <p>\u3010\u96f6\u62f7\u8d1d\u3011\u7684\u4f53\u73b0\u4e4b\u4e00\uff0c\u53ef\u4ee5\u5c06\u591a\u4e2a ByteBuf \u5408\u5e76\u4e3a\u4e00\u4e2a\u903b\u8f91\u4e0a\u7684 ByteBuf\uff0c\u907f\u514d\u62f7\u8d1d</p> <pre><code>CompositeByteBuf buf3 = ByteBufAllocator.DEFAULT.compositeBuffer();\n// true \u8868\u793a\u589e\u52a0\u65b0\u7684 ByteBuf \u81ea\u52a8\u9012\u589e write index, \u5426\u5219 write index \u4f1a\u59cb\u7ec8\u4e3a 0\nbuf3.addComponents(true, buf1, buf2);\n</code></pre> <ol> <li>Unpooled</li> </ol> <p>Unpooled \u662f\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u7c7b\u5982\u5176\u540d\uff0c\u63d0\u4f9b\u4e86\u975e\u6c60\u5316\u7684 ByteBuf \u521b\u5efa\u3001\u7ec4\u5408\u3001\u590d\u5236\u7b49\u64cd\u4f5c</p> <p>\u5176\u8ddf\u3010\u96f6\u62f7\u8d1d\u3011\u76f8\u5173\u7684 wrappedBuffer \u65b9\u6cd5\uff0c\u53ef\u4ee5\u7528\u6765\u5305\u88c5 ByteBuf</p>"},{"location":"Netty/Netty/#netty\u8fdb\u9636","title":"Netty\u8fdb\u9636","text":""},{"location":"Netty/Netty/#\u7c98\u5305\u534a\u5305","title":"\u7c98\u5305&amp;\u534a\u5305","text":"<p>\u5728\u57fa\u4e8e\u6d41\u7684\u4f20\u8f93\u534f\u8bae\uff08\u5982TCP\uff09\u4e2d\uff0c\u6570\u636e\u662f\u4ee5\u5b57\u8282\u6d41\u7684\u5f62\u5f0f\u4f20\u8f93\u7684\uff0c\u6ca1\u6709\u660e\u786e\u7684\u6d88\u606f\u8fb9\u754c\uff0c\u8fd9\u4f1a\u5bfc\u81f4\uff1a</p> <ol> <li>\u7c98\u5305\uff08TCP\u7c98\u5305\uff09\uff1a\u53d1\u9001\u65b9\u53d1\u9001\u7684\u591a\u4e2a\u6570\u636e\u5305\u88ab\u63a5\u6536\u65b9\u5f53\u4f5c\u4e00\u4e2a\u6570\u636e\u5305\u63a5\u6536</li> <li>\u534a\u5305\uff08\u62c6\u5305\uff09\uff1a\u63a5\u6536\u65b9\u4e00\u6b21\u6ca1\u6709\u63a5\u6536\u5230\u5b8c\u6574\u7684\u6570\u636e\u5305\uff0c\u53ea\u63a5\u6536\u4e86\u90e8\u5206\u6570\u636e</li> </ol> <p>\u539f\u56e0\uff1a</p> <ol> <li>\u7c98\u5305\u539f\u56e0\uff1a</li> <li>\u53d1\u9001\u65b9\u4f7f\u7528Nagle\u7b97\u6cd5\uff0c\u5c06\u591a\u4e2a\u5c0f\u6570\u636e\u5305\u5408\u5e76\u53d1\u9001</li> <li>\u63a5\u6536\u65b9\u7f13\u51b2\u533a\u8f83\u5927\uff0c\u4e00\u6b21\u8bfb\u53d6\u4e86\u591a\u4e2a\u6570\u636e\u5305</li> <li>\u534a\u5305\u539f\u56e0\uff1a</li> <li>\u53d1\u9001\u7684\u6570\u636e\u5305\u5927\u4e8e\u63a5\u6536\u65b9\u7f13\u51b2\u533a\u5927\u5c0f</li> <li>\u53d1\u9001\u7684\u6570\u636e\u5305\u5927\u4e8eTCP\u6700\u5927\u62a5\u6587\u957f\u5ea6</li> <li>\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5206\u7247</li> </ol>"},{"location":"Netty/Netty/#\u89e3\u51b3\u65b9\u6848","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>Netty\u63d0\u4f9b\u4e86\u591a\u79cd\u89e3\u7801\u5668\u6765\u5904\u7406\u7c98\u5305\u548c\u534a\u5305\u95ee\u9898\uff1a</p> <ol> <li> <p>\u56fa\u5b9a\u957f\u5ea6\u89e3\u7801\u5668 FixedLengthFrameDecoder</p> </li> <li> <p>\u6bcf\u4e2a\u6570\u636e\u5305\u90fd\u4e25\u683c\u6309\u7167\u56fa\u5b9a\u957f\u5ea6\u8fdb\u884c\u62c6\u5206</p> </li> <li>\u5f53\u7d2f\u79ef\u8bfb\u53d6\u5230\u6307\u5b9a\u957f\u5ea6\u7684\u6570\u636e\u540e\uff0c\u89e3\u7801\u5668\u4f1a\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u5b8c\u6574\u6d88\u606f</li> </ol> <pre><code>// \u6bcf\u4e2a\u6570\u636e\u5305\u56fa\u5b9a\u957f\u5ea6\u4e3a100\u5b57\u8282\nch.pipeline().addLast(new FixedLengthFrameDecoder(100));\n</code></pre> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u5b9e\u73b0\u7b80\u5355</li> <li>\u6548\u7387\u9ad8</li> <li> <p>\u4e0d\u591f\u7075\u6d3b\uff0c\u6d6a\u8d39\u5e26\u5bbd\uff08\u9700\u8981\u586b\u5145\u6570\u636e\uff09</p> </li> <li> <p>\u884c\u5206\u9694\u7b26\u89e3\u7801\u5668 LineBasedFrameDecoder</p> </li> <li> <p>\u4ee5\u6362\u884c\u7b26(<code>\\n</code>\u6216<code>\\r\\n</code>)\u4f5c\u4e3a\u6d88\u606f\u5206\u9694\u7b26</p> </li> </ul> <pre><code>// \u4ee5\u6362\u884c\u7b26(\\n\u6216\\r\\n)\u4f5c\u4e3a\u6d88\u606f\u5206\u9694\u7b26\nch.pipeline().addLast(new LineBasedFrameDecoder(1024));\n</code></pre> <ol> <li>\u5206\u9694\u7b26\u89e3\u7801\u5668 DelimiterBasedFrameDecoder</li> </ol> <pre><code>// \u4f7f\u7528\u81ea\u5b9a\u4e49\u5206\u9694\u7b26\nByteBuf delimiter = Unpooled.copiedBuffer(\"$_\".getBytes());\nch.pipeline().addLast(new DelimiterBasedFrameDecoder(1024, delimiter));\n</code></pre> <ol> <li> <p>\u957f\u5ea6\u5b57\u6bb5\u89e3\u7801\u5668 LengthFieldBasedFrameDecoder</p> </li> <li> <p>\u57fa\u4e8e\u6d88\u606f\u5934\u4e2d\u7684\u957f\u5ea6\u5b57\u6bb5\u6765\u6807\u8bc6\u6574\u4e2a\u6d88\u606f\u7684\u957f\u5ea6</p> </li> <li>\u9ad8\u5ea6\u53ef\u914d\u7f6e\uff0c\u80fd\u9002\u5e94\u5404\u79cd\u534f\u8bae\u683c\u5f0f</li> </ol> <pre><code>// \u53c2\u6570\u8bf4\u660e\uff1a\n// maxFrameLength - \u6700\u5927\u5e27\u957f\u5ea6\n// lengthFieldOffset - \u957f\u5ea6\u5b57\u6bb5\u504f\u79fb\u91cf\n// lengthFieldLength - \u957f\u5ea6\u5b57\u6bb5\u5b57\u8282\u6570\n// lengthAdjustment - \u957f\u5ea6\u8c03\u6574\u503c\uff08\u957f\u5ea6\u5b57\u6bb5\u4e4b\u540e\u8fd8\u6709\u591a\u5c11\u5b57\u8282\u624d\u662f\u5185\u5bb9\uff09\n// initialBytesToStrip - \u9700\u8981\u8df3\u8fc7\u7684\u5b57\u8282\u6570\nch.pipeline().addLast(new LengthFieldBasedFrameDecoder(\n    1024 * 1024, \n    0, \n    4, \n    0, \n    4));\n</code></pre> <p>\u81ea\u5b9a\u4e49\u534f\u8bae\u793a\u4f8b</p> <pre><code>// \u534f\u8bae\u683c\u5f0f: [\u957f\u5ea6][\u5185\u5bb9]\npublic class MyProtocolDecoder extends ByteToMessageDecoder {\n    @Override\n    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) {\n        if (in.readableBytes() &lt; 4) {\n            return; // \u957f\u5ea6\u5b57\u6bb5\u4e0d\u8db3\uff0c\u7b49\u5f85\u66f4\u591a\u6570\u636e\n        }\n\n        in.markReaderIndex(); // \u6807\u8bb0\u8bfb\u53d6\u4f4d\u7f6e\n        int length = in.readInt();\n\n        if (in.readableBytes() &lt; length) {\n            in.resetReaderIndex(); // \u6570\u636e\u4e0d\u8db3\uff0c\u91cd\u7f6e\u8bfb\u53d6\u4f4d\u7f6e\n            return;\n        }\n\n        byte[] content = new byte[length];\n        in.readBytes(content);\n        out.add(new String(content, StandardCharsets.UTF_8));\n    }\n}\n</code></pre>"},{"location":"Netty/Netty/#netty\u7684http","title":"Netty\u7684HTTP","text":"<pre><code>        new ServerBootstrap()\n                .group(new NioEventLoopGroup())\n                // \u670d\u52a1\u7aefChannel\u5b9e\u73b0\n                .channel(NioServerSocketChannel.class)\n                // \u8d1f\u8d23\u8bfb\u5199\n                .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() {\n                    @Override\n                    protected void initChannel(NioSocketChannel channel) {\n                        channel.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n\n                        // Http\u7f16\u89e3\u7801\u5668\n                        channel.pipeline().addLast(new HttpServerCodec());\n\n                        channel.pipeline().addLast(new SimpleChannelInboundHandler&lt;HttpRequest&gt;() {\n                            @Override\n                            protected void channelRead0(ChannelHandlerContext ctx, HttpRequest msg) {\n                                DefaultFullHttpResponse res = new DefaultFullHttpResponse(msg.protocolVersion(), HttpResponseStatus.OK);\n                                byte[] bytes = \"Hello Netty\".getBytes(StandardCharsets.UTF_8);\n                                res.content().writeBytes(bytes);\n                                // \u8bbe\u7f6e\u54cd\u5e94\u5185\u5bb9\u957f\u5ea6\n                                res.headers().setInt(CONTENT_LENGTH, bytes.length);\n                                ctx.writeAndFlush(res);\n                            }\n                        });\n                    }\n                })\n                .bind(8080);\n</code></pre>"},{"location":"Netty/Netty/#\u81ea\u5b9a\u4e49\u534f\u8bae","title":"\u81ea\u5b9a\u4e49\u534f\u8bae","text":"<ol> <li> <p>\u534f\u8bae\u6807\u8bc6</p> </li> <li> <p>\u534f\u8bae\u540d\u79f0/\u7248\u672c\uff1a\u660e\u786e\u534f\u8bae\u6807\u8bc6\u53ca\u7248\u672c\u53f7\uff0c\u4fbf\u4e8e\u517c\u5bb9\u6027\u7ba1\u7406\u3002</p> </li> <li>\u7aef\u53e3\u53f7\uff1a\u7ea6\u5b9a\u670d\u52a1\u7aef\u76d1\u542c\u7aef\u53e3\uff08\u5982HTTP-80\uff0cHTTPS-443\uff09\uff0c\u9700\u907f\u514d\u51b2\u7a81\u3002</li> </ol> <ol> <li> <p>\u6d88\u606f\u7ed3\u6784</p> </li> <li> <p>\u5e27\u683c\u5f0f\uff1a\u5b9a\u4e49\u6d88\u606f\u5934\uff08Header\uff09\u548c\u6d88\u606f\u4f53\uff08Body\uff09\u7684\u7ec4\u6210\u3002</p> </li> <li>Header\uff1a\u5305\u542b\u5143\u6570\u636e\uff08\u5982\u6d88\u606f\u7c7b\u578b\u3001\u957f\u5ea6\u3001\u72b6\u6001\u7801\u3001\u65f6\u95f4\u6233\uff09\u3002</li> <li>Body\uff1a\u627f\u8f7d\u5b9e\u9645\u6570\u636e\uff08\u5982JSON\u3001\u4e8c\u8fdb\u5236\u6d41\uff09\u3002</li> <li>\u8fb9\u754c\u6807\u8bc6\uff1a\u901a\u8fc7\u5b9a\u957f\u5b57\u6bb5\u3001\u5206\u9694\u7b26\uff08\u5982<code>\\r\\n</code>\uff09\u6216\u957f\u5ea6\u524d\u7f00\u6807\u8bb0\u6d88\u606f\u8fb9\u754c\u3002</li> </ol> <ol> <li> <p>\u6570\u636e\u7f16\u7801</p> </li> <li> <p>\u5e8f\u5217\u5316\u65b9\u5f0f\uff1aJSON\uff08\u6613\u8bfb\uff09\u3001Protocol Buffers\uff08\u9ad8\u6548\uff09\u3001XML\uff08\u7ed3\u6784\u5316\uff09\u6216\u81ea\u5b9a\u4e49\u4e8c\u8fdb\u5236\u683c\u5f0f\u3002</p> </li> <li>\u5b57\u7b26\u7f16\u7801\uff1a\u5982UTF-8\uff0c\u786e\u4fdd\u591a\u8bed\u8a00\u517c\u5bb9\u3002</li> </ol> <ol> <li> <p>\u4ea4\u4e92\u6a21\u578b</p> </li> <li> <p>\u901a\u4fe1\u6a21\u5f0f\uff1a\u8bf7\u6c42-\u54cd\u5e94\uff08\u5982HTTP\uff09\u3001\u53d1\u5e03-\u8ba2\u9605\uff08\u5982MQTT\uff09\u6216\u5355\u5411\u63a8\u9001\u3002</p> </li> <li>\u72b6\u6001\u7ba1\u7406\uff1a\u65e0\u72b6\u6001\uff08\u5982HTTP\uff09\u6216\u6709\u72b6\u6001\uff08\u5982FTP\u63a7\u5236\u8fde\u63a5\uff09\u3002</li> </ol> <ol> <li> <p>\u9519\u8bef\u5904\u7406</p> </li> <li> <p>\u9519\u8bef\u7801/\u6d88\u606f\uff1a\u5b9a\u4e49\u6807\u51c6\u9519\u8bef\u7801\uff08\u5982<code>404-Not Found</code>\uff09\u548c\u6062\u590d\u673a\u5236\u3002</p> </li> <li>\u91cd\u8bd5\u7b56\u7565\uff1a\u8d85\u65f6\u540e\u91cd\u8bd5\u6b21\u6570\u3001\u9000\u907f\u7b97\u6cd5\uff08Exponential Backoff\uff09\u3002</li> </ol> <ol> <li> <p>\u5b89\u5168\u673a\u5236</p> </li> <li> <p>\u8ba4\u8bc1\uff1aAPI Key\u3001OAuth 2.0\u3001JWT\u7b49\u3002</p> </li> <li>\u52a0\u5bc6\uff1aTLS/SSL\u4f20\u8f93\u52a0\u5bc6\u6216\u7aef\u5230\u7aef\u52a0\u5bc6\uff08\u5982Signal\u534f\u8bae\uff09\u3002</li> <li>\u9632\u7be1\u6539\uff1a\u6570\u5b57\u7b7e\u540d\uff08HMAC\uff09\u9a8c\u8bc1\u6570\u636e\u5b8c\u6574\u6027\u3002</li> </ol> <ol> <li> <p>\u6027\u80fd\u4f18\u5316</p> </li> <li> <p>\u538b\u7f29\uff1aGzip\u3001Brotli\u51cf\u5c11\u4f20\u8f93\u4f53\u79ef\u3002</p> </li> <li>\u957f\u8fde\u63a5\uff1a\u590d\u7528TCP\u8fde\u63a5\uff08\u5982HTTP/2\u591a\u8def\u590d\u7528\uff09\u3002</li> <li>\u7f13\u5b58\u63a7\u5236\uff1a\u7c7b\u4f3cHTTP\u7684<code>Cache-Control</code>\u5934\u3002</li> </ol> <ol> <li> <p>\u6269\u5c55\u6027\u8bbe\u8ba1</p> </li> <li> <p>\u9884\u7559\u5b57\u6bb5\uff1aHeader\u4e2d\u4fdd\u7559\u6269\u5c55\u4f4d\u6216\u81ea\u5b9a\u4e49\u5b57\u6bb5\u3002</p> </li> <li>\u7248\u672c\u534f\u5546\uff1a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u534f\u5546\u652f\u6301\u7684\u534f\u8bae\u7248\u672c\uff08\u5982TLS\u63e1\u624b\uff09\u3002</li> </ol> <ol> <li> <p>\u6d41\u91cf\u63a7\u5236</p> </li> <li> <p>\u9650\u901f\u673a\u5236\uff1a\u4ee4\u724c\u6876\u7b97\u6cd5\u9650\u5236\u8bf7\u6c42\u901f\u7387\u3002</p> </li> <li>\u62e5\u585e\u63a7\u5236\uff1a\u52a8\u6001\u8c03\u6574\u53d1\u9001\u7a97\u53e3\uff08\u7c7b\u4f3cTCP\uff09\u3002</li> </ol> <ol> <li> <p>\u8c03\u8bd5\u4e0e\u65e5\u5fd7</p> </li> <li> <p>\u8bf7\u6c42ID\uff1a\u552f\u4e00\u6807\u8bc6\u8bf7\u6c42\uff0c\u4fbf\u4e8e\u94fe\u8def\u8ffd\u8e2a\u3002</p> </li> <li>\u65e5\u5fd7\u683c\u5f0f\uff1a\u7ed3\u6784\u5316\u65e5\u5fd7\uff08\u5982JSON\uff09\u8bb0\u5f55\u5173\u952e\u4e8b\u4ef6\u3002</li> </ol> <p>\u793a\u4f8b\uff1a</p> <ul> <li>\u9b54\u6570\uff0c\u7528\u6765\u5728\u7b2c\u4e00\u65f6\u95f4\u5224\u5b9a\u662f\u5426\u662f\u65e0\u6548\u6570\u636e\u5305</li> <li>\u7248\u672c\u53f7\uff0c\u53ef\u4ee5\u652f\u6301\u534f\u8bae\u7684\u5347\u7ea7</li> <li>\u5e8f\u5217\u5316\u7b97\u6cd5\uff0c\u6d88\u606f\u6b63\u6587\u5230\u5e95\u91c7\u7528\u54ea\u79cd\u5e8f\u5217\u5316\u53cd\u5e8f\u5217\u5316\u65b9\u5f0f\uff0c\u53ef\u4ee5\u7531\u6b64\u6269\u5c55\uff0c\u4f8b\u5982\uff1ajson\u3001protobuf\u3001hessian\u3001jdk</li> <li>\u6307\u4ee4\u7c7b\u578b</li> <li>\u8bf7\u6c42\u5e8f\u53f7\uff0c\u4e3a\u4e86\u53cc\u5de5\u901a\u4fe1\uff0c\u63d0\u4f9b\u5f02\u6b65\u80fd\u529b</li> <li>\u6b63\u6587\u957f\u5ea6</li> <li>\u6d88\u606f\u6b63\u6587</li> </ul> <p>\u81ea\u5b9a\u4e49\u7f16\u89e3\u7801\u5668\uff1a</p> <pre><code>@Slf4j\npublic class MessageCodec extends ByteToMessageCodec&lt;Message&gt; {\n\n    @Override\n    protected void encode(ChannelHandlerContext ctx, Message msg, ByteBuf out) throws Exception {\n        // 4 \u5b57\u8282\u7684\u9b54\u6570\n        out.writeBytes(new byte[]{1, 2, 3, 4});\n        // 1 \u5b57\u8282\u7684\u7248\u672c,\n        out.writeByte(1);\n        // 1 \u5b57\u8282\u7684\u5e8f\u5217\u5316\u65b9\u5f0f jdk 0 , json 1\n        out.writeByte(0);\n        // 1 \u5b57\u8282\u7684\u6307\u4ee4\u7c7b\u578b\n        out.writeByte(msg.getMessageType());\n        // 4 \u4e2a\u5b57\u8282\n        out.writeInt(msg.getSequenceId());\n        // \u65e0\u610f\u4e49\uff0c\u5bf9\u9f50\u586b\u5145\n        out.writeByte(0xff);\n        // \u83b7\u53d6\u5185\u5bb9\u7684\u5b57\u8282\u6570\u7ec4\n        ByteArrayOutputStream bos = new ByteArrayOutputStream();\n        ObjectOutputStream oos = new ObjectOutputStream(bos);\n        oos.writeObject(msg);\n        byte[] bytes = bos.toByteArray();\n        // \u957f\u5ea6\n        out.writeInt(bytes.length);\n        // \u5199\u5165\u5185\u5bb9\n        out.writeBytes(bytes);\n    }\n\n    @Override\n    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception {\n        int magicNum = in.readInt();\n        byte version = in.readByte();\n        byte serializerType = in.readByte();\n        byte messageType = in.readByte();\n        int sequenceId = in.readInt();\n        in.readByte();\n        int length = in.readInt();\n        byte[] bytes = new byte[length];\n        in.readBytes(bytes, 0, length);\n        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes));\n        Message message = (Message) ois.readObject();\n        log.debug(\"{}, {}, {}, {}, {}, {}\", magicNum, version, serializerType, messageType, sequenceId, length);\n        log.debug(\"{}\", message);\n        out.add(message);\n    }\n}\n</code></pre> <p>[!Warning]</p> <p>\u4ee5\u4e0a\u7f16\u89e3\u7801\u4e0d\u80fd\u89e3\u51b3\u7c98\u5305\u534a\u5305\u95ee\u9898\uff0c\u4ecd\u7136\u9700\u8981\u5728pipeline\u4e2d\u6dfb\u52a0<code>LengthFieldBasedFrameDecoder</code>\u5e27\u89e3\u7801\u5668</p> <p>[!Note]</p> <p><code>@Sharable</code>\u6ce8\u89e3\u5728Netty\u4e2d\u7528\u4e8e\u6807\u8bb0\u7ebf\u7a0b\u5b89\u5168\u7684Handler</p> <ul> <li> <p>\u5982<code>LengthFieldBasedFrameDecoder</code>\uff0c\u5176\u672a\u4f7f\u7528\u6ce8\u89e3\u6807\u8bb0\uff0c\u4f1a\u4ea7\u751f\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff08\u6bcf\u4e2aChannel\u90fd\u5e94\u8be5\u4f7f\u7528\u65b0\u7684\u5b9e\u4f8b\uff09\uff0c\u4e3b\u8981\u539f\u56e0\u662f\u8be5\u89e3\u7801\u5668\u9700\u8981\u8bb0\u5f55\u534a\u5305\u6d88\u606f\u7b49\u5f85\u6d88\u606f\u5b8c\u5168\u5230\u8fbe\uff0c\u5c5e\u4e8e\u6709\u72b6\u6001\u7684\u7c7b</p> </li> <li> <p>\u5bf9\u4e8e\u7f16\u89e3\u7801\u5668\u7c7b\uff08\u4e00\u822c\u7ebf\u7a0b\u5b89\u5168\uff09\uff0c\u4e0d\u5e94\u8be5\u7ee7\u627f <code>ByteToMessageCodec</code> \u6216 <code>CombinedChannelDuplexHandler</code> \uff0c\u56e0\u4e3a\u5176\u88ab\u9650\u5236\u4e86\u4e0d\u80fd\u4f7f\u7528<code>@Sharable</code>\u6ce8\u89e3</p> </li> <li> <p><code>MessageToMessageCodec</code>\u7236\u7c7b\u7684\u5b50\u7c7b\u53ef\u4ee5\u4f7f\u7528<code>@Sharable</code>\u6ce8\u89e3</p> </li> </ul>"},{"location":"Netty/Netty/#\u4f18\u5316","title":"\u4f18\u5316","text":""},{"location":"Netty/Netty/#\u53c2\u6570\u8c03\u4f18","title":"\u53c2\u6570\u8c03\u4f18","text":""},{"location":"Netty/Netty/#connect_timeout_millis","title":"CONNECT_TIMEOUT_MILLIS","text":"<ul> <li>\u5c5e\u4e8e SocketChannal \u53c2\u6570</li> <li>\u7528\u5728\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u5982\u679c\u5728\u6307\u5b9a\u6beb\u79d2\u5185\u65e0\u6cd5\u8fde\u63a5\uff0c\u4f1a\u629b\u51fa timeout \u5f02\u5e38</li> </ul> <p>\u5ba2\u6237\u7aef\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>bootstrap.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 5000);\n</code></pre> <p>[!Tip]</p> <p>\u5728\u5ba2\u6237\u7aef</p> <pre><code>serverBootstrap.option();       // \u914d\u7f6e\u670d\u52a1\u7aef\u53c2\u6570\nserverBootstrap.childOption();  // \u914d\u7f6e\u5ba2\u6237\u7aef\u53c2\u6570\n</code></pre>"},{"location":"Netty/Netty/#so_backlog","title":"SO_BACKLOG","text":"<ul> <li>\u670d\u52a1\u5668\u7aef\u914d\u7f6e</li> <li>\u901a\u8fc7  <code>option(ChannelOption.SO_BACKLOG, value)</code> \u6765\u8bbe\u7f6e\u5927\u5c0f</li> </ul> <pre><code>sequenceDiagram\n\nparticipant c as client\nparticipant s as server\nparticipant sq as syns queue\nparticipant aq as accept queue\n\ns -&gt;&gt; s : bind()\ns -&gt;&gt; s : listen()\nc -&gt;&gt; c : connect()\nc -&gt;&gt; s : 1. SYN\nNote left of c : SYN_SEND\ns -&gt;&gt; sq : put\nNote right of s : SYN_RCVD\ns -&gt;&gt; c : 2. SYN + ACK\nNote left of c : ESTABLISHED\nc -&gt;&gt; s : 3. ACK\nsq -&gt;&gt; aq : put\nNote right of s : ESTABLISHED\naq --&gt;&gt; s : \ns -&gt;&gt; s : accept()\n</code></pre> <ol> <li>\u7b2c\u4e00\u6b21\u63e1\u624b\uff0cclient \u53d1\u9001 SYN \u5230 server\uff0c\u72b6\u6001\u4fee\u6539\u4e3a SYN_SEND\uff0cserver \u6536\u5230\uff0c\u72b6\u6001\u6539\u53d8\u4e3a SYN_REVD\uff0c\u5e76\u5c06\u8be5\u8bf7\u6c42\u653e\u5165 sync queue \u961f\u5217</li> <li>\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0cserver \u56de\u590d SYN + ACK \u7ed9 client\uff0cclient \u6536\u5230\uff0c\u72b6\u6001\u6539\u53d8\u4e3a ESTABLISHED\uff0c\u5e76\u53d1\u9001 ACK \u7ed9 server</li> <li>\u7b2c\u4e09\u6b21\u63e1\u624b\uff0cserver \u6536\u5230 ACK\uff0c\u72b6\u6001\u6539\u53d8\u4e3a ESTABLISHED\uff0c\u5c06\u8be5\u8bf7\u6c42\u4ece sync queue \u653e\u5165 accept queue</li> </ol> <p>\u5176\u4e2d</p> <ul> <li> <p>\u5728 linux 2.2 \u4e4b\u524d\uff0cbacklog \u5927\u5c0f\u5305\u62ec\u4e86\u4e24\u4e2a\u961f\u5217\u7684\u5927\u5c0f\uff0c\u5728 2.2 \u4e4b\u540e\uff0c\u5206\u522b\u7528\u4e0b\u9762\u4e24\u4e2a\u53c2\u6570\u6765\u63a7\u5236</p> </li> <li> <p>sync queue - \u534a\u8fde\u63a5\u961f\u5217</p> </li> <li>\u5927\u5c0f\u901a\u8fc7 /proc/sys/net/ipv4/tcp_max_syn_backlog \u6307\u5b9a\uff0c\u5728 <code>syncookies</code> \u542f\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u903b\u8f91\u4e0a\u6ca1\u6709\u6700\u5927\u503c\u9650\u5236\uff0c\u8fd9\u4e2a\u8bbe\u7f6e\u4fbf\u88ab\u5ffd\u7565</li> <li>accept queue - \u5168\u8fde\u63a5\u961f\u5217</li> <li>\u5176\u5927\u5c0f\u901a\u8fc7 /proc/sys/net/core/somaxconn \u6307\u5b9a\uff0c\u5728\u4f7f\u7528 listen \u51fd\u6570\u65f6\uff0c\u5185\u6838\u4f1a\u6839\u636e\u4f20\u5165\u7684 backlog \u53c2\u6570\u4e0e\u7cfb\u7edf\u53c2\u6570\uff0c\u53d6\u4e8c\u8005\u7684\u8f83\u5c0f\u503c</li> <li>\u5982\u679c accpet queue \u961f\u5217\u6ee1\u4e86\uff0cserver \u5c06\u53d1\u9001\u4e00\u4e2a\u62d2\u7edd\u8fde\u63a5\u7684\u9519\u8bef\u4fe1\u606f\u5230 client</li> </ul>"},{"location":"Netty/Netty/#ulimit--n-value","title":"ulimit -n value","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u53c2\u6570\uff0c\u8bbe\u7f6e\u8fdb\u7a0b\u53ef\u6253\u5f00\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u4e0a\u9650</p>"},{"location":"Netty/Netty/#tcp_nodelay","title":"TCP_NODELAY","text":"<p><code>childOption(ChannelOption.TCP_NODELAY, true)</code> // \u5173\u952e\u914d\u7f6e</p> <ul> <li>Nagle \u7b97\u6cd5\uff1aTCP \u9ed8\u8ba4\u542f\u7528\u8be5\u7b97\u6cd5\uff0c\u4f1a\u7f13\u51b2\u5c0f\u6570\u636e\u5305\uff08\u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4\u6216\u6570\u636e\u91cf\u8fbe\u5230 MSS \u6700\u5927\u62a5\u6587\u6bb5\u5927\u5c0f\uff09\uff0c\u5408\u5e76\u53d1\u9001\u4ee5\u51cf\u5c11\u7f51\u7edc\u62e5\u585e\u3002</li> <li><code>TCP_NODELAY=true</code>\uff1a\u7981\u7528 Nagle \u7b97\u6cd5\uff0c\u6570\u636e\u7acb\u5373\u53d1\u9001\uff0c\u964d\u4f4e\u5ef6\u8fdf\uff08\u9002\u5408\u4ea4\u4e92\u5f0f\u5e94\u7528\uff0c\u5982\u5b9e\u65f6\u6e38\u620f\u3001SSH\u3001RPC\uff09\u3002</li> <li><code>TCP_NODELAY=false</code>\uff1a\u542f\u7528 Nagle \u7b97\u6cd5\uff0c\u63d0\u9ad8\u541e\u5410\u91cf\uff08\u9002\u5408\u5927\u6587\u4ef6\u4f20\u8f93\u7b49\u5ef6\u8fdf\u4e0d\u654f\u611f\u573a\u666f\uff09\u3002</li> </ul>"},{"location":"Netty/Netty/#allocator","title":"ALLOCATOR","text":"<p>\u7528\u4e8e\u914d\u7f6e \u5185\u5b58\u5206\u914d\u5668\uff08ByteBufAllocator\uff09\uff0c\u51b3\u5b9a\u5982\u4f55\u5206\u914d\u548c\u7ba1\u7406\u7f51\u7edc\u901a\u4fe1\u4e2d\u7684\u5185\u5b58\uff08ByteBuf\uff09</p> <ul> <li><code>PooledByteBufAllocator</code>\uff08\u9ed8\u8ba4\uff09\uff1a\u57fa\u4e8e\u5185\u5b58\u6c60\u7684\u9ad8\u6027\u80fd\u5206\u914d\u5668\uff0c\u51cf\u5c11 GC \u538b\u529b\u3002</li> <li><code>UnpooledByteBufAllocator</code>\uff1a\u975e\u6c60\u5316\u5206\u914d\u5668\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u65b0\u5efa <code>ByteBuf</code>\uff08\u7b80\u5355\u4f46\u6548\u7387\u4f4e\uff09\u3002</li> <li><code>PreferHeapByteBufAllocator</code>\uff1a\u4f18\u5148\u4f7f\u7528\u5806\u5185\u5b58\uff08<code>byte[]</code>\uff09\u3002</li> </ul> <p><code>option(ChannelOption.ALLOCATOR, new PreferHeapByteBufAllocator())</code></p> <p><code>option(ChannelOption.ALLOCATOR, PooledByteBufAllocator.DEFAULT)</code></p> <pre><code>## \u6307\u5b9a\u5185\u5b58\u6c60\u4e2d\u6bcf\u4e2a\u533a\u57df\u7684\u5757\u5927\u5c0f\uff08\u9ed8\u8ba4\uff1a16MB\uff09\n-Dio.netty.allocator.pageSize=8192\n## \u662f\u5426\u4f7f\u7528\u76f4\u63a5\u5185\u5b58\uff08\u9ed8\u8ba4\uff1atrue\uff09\n-Dio.netty.noPreferDirect=true\n## \u662f\u5426\u5f00\u542f\u6c60\u5316\n-Dio.netty.allocator.type=pooled\n</code></pre>"},{"location":"Redis/Redis/","title":"Redis","text":""},{"location":"Redis/Redis/#\u539f\u7406\u7bc7","title":"\u539f\u7406\u7bc7","text":""},{"location":"Redis/Redis/#\u6570\u636e\u7ed3\u6784","title":"\u6570\u636e\u7ed3\u6784","text":"<p>[!NOTE]</p> <p><code>Redis</code> \u5e95\u5c42\u57fa\u4e8e C\u8bed\u8a00 \u5b9e\u73b0</p>"},{"location":"Redis/Redis/#\u52a8\u6001\u5b57\u7b26\u4e32sds","title":"\u52a8\u6001\u5b57\u7b26\u4e32SDS","text":"<p>\u5b57\u7b26\u4e32\u662fRedis\u4e2d\u6700\u5e38\u7528\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u3002\u4e0d\u8fc7Redis\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528C\u8bed\u8a00\u4e2d\u7684\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3aC\u8bed\u8a00\u5b57\u7b26\u4e32\u5b58\u5728\u5f88\u591a\u95ee\u9898\uff1a</p> <ul> <li>\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u9700\u8981\u901a\u8fc7\u8fd0\u7b97</li> <li>\u975e\u4e8c\u8fdb\u5236\u5b89\u5168</li> <li>\u4e0d\u53ef\u4fee\u6539</li> </ul> <p>[!TIP]</p> <p>\u4e8c\u8fdb\u5236\u5b89\u5168\uff1a</p> <p>\u200b C \u5b57\u7b26\u4e32\u4f9d\u8d56 <code>\\0</code> \u5224\u65ad\u7ed3\u5c3e\uff0c\u82e5\u5b57\u7b26\u4e32\u4e2d\u5305\u542b <code>\\0</code>\uff08\u5982\u56fe\u7247\u3001\u97f3\u9891\u7b49\u4e8c\u8fdb\u5236\u6570\u636e\uff09\uff0c\u4f1a\u88ab\u622a\u65ad\u3002</p> <p>\u56e0\u6b64\uff0cRedis\u6784\u5efa\u4e86\u4e00\u79cd\u65b0\u7684\u5b57\u7b26\u4e32\u7ed3\u6784\uff0c\u79f0\u4e3a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08Simple Dynamic String\uff09\uff0c\u7b80\u79f0SDS\u3002</p> <p></p> <p>[!TIP]</p> <p><code>Redis</code> \u5b9a\u4e49\u4e86\u591a\u79cd\u5927\u5c0f\u4e0d\u540c\u7684 SDS \u7ed3\u6784\uff0c\u4ee5\u4e0a\u53ea\u662f\u4e00\u4e2a\u793a\u4f8b</p> <p>SDS\u4e4b\u6240\u4ee5\u53eb\u505a\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u662f\u56e0\u4e3a\u5b83\u5177\u5907\u52a8\u6001\u6269\u5bb9\u7684\u80fd\u529b</p> <ol> <li> <p>\u5047\u5982\u6211\u4eec\u8981\u7ed9SDS\u8ffd\u52a0\u4e00\u6bb5\u5b57\u7b26\u4e32\uff0c\u9996\u5148\u4f1a\u7533\u8bf7\u65b0\u5185\u5b58\u7a7a\u95f4\uff1a</p> </li> <li> <p>\u5982\u679c\u65b0\u5b57\u7b26\u4e32\u5c0f\u4e8e1MB\uff0c\u5219\u65b0\u7a7a\u95f4\u4e3a\u6269\u5c55\u540e\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u4e24\u500d+1\uff1b</p> </li> <li> <p>\u5982\u679c\u65b0\u5b57\u7b26\u4e32\u5927\u4e8e1MB\uff0c\u5219\u65b0\u7a7a\u95f4\u4e3a\u6269\u5c55\u540e\u5b57\u7b26\u4e32\u957f\u5ea6+1M+1\u3002\u79f0\u4e3a\u5185\u5b58\u9884\u5206\u914d\u3002</p> </li> </ol> <p>[!NOTE]</p> <p>SDS\u4f18\u70b9</p> <ul> <li>\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)</li> <li>\u652f\u6301\u52a8\u6001\u6269\u5bb9</li> <li>\u51cf\u5c11\u5185\u5b58\u5206\u914d\u6b21\u6570\uff08\u5206\u914d\u5185\u5b58\u6709\u4e00\u5b9a\u6027\u80fd\u5f00\u9500\uff09</li> <li>\u4e8c\u8fdb\u5236\u5b89\u5168</li> </ul>"},{"location":"Redis/Redis/#intset","title":"IntSet","text":"<p>IntSet\u662fRedis\u4e2dset\u96c6\u5408\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u57fa\u4e8e\u6574\u6570\u6570\u7ec4\u6765\u5b9e\u73b0\uff0c\u5e76\u4e14\u5177\u5907\u957f\u5ea6\u53ef\u53d8\u3001\u6709\u5e8f\u7b49\u7279\u5f81\u3002</p> <p></p> <p>\u5176\u4e2d\u7684encoding\u5305\u542b\u4e09\u79cd\u6a21\u5f0f\uff0c\u8868\u793a\u5b58\u50a8\u7684\u6574\u6570\u5927\u5c0f\u4e0d\u540c\uff1a</p> <p></p> <p>\u4e3a\u4e86\u65b9\u4fbf\u67e5\u627e\uff0cRedis\u4f1a\u5c06intset\u4e2d\u6240\u6709\u7684\u6574\u6570\u6309\u7167\u5347\u5e8f\u4f9d\u6b21\u4fdd\u5b58\u5728contents\u6570\u7ec4\u4e2d\uff0c\u7ed3\u6784\u5982\u56fe\uff1a</p> <p></p> <p>\u5982\u679c\u65b0\u63d2\u5165\u7684\u6570\u5b57\u8d85\u51fa\u4e86int16_t\u7684\u8303\u56f4\uff0cintset\u4f1a\u81ea\u52a8\u5347\u7ea7\u7f16\u7801\u65b9\u5f0f\u5230\u5408\u9002\u7684\u5927\u5c0f\u3002 \u4ee5\u5f53\u524d\u6848\u4f8b\u6765\u8bf4\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5347\u7ea7\u7f16\u7801\u4e3aINTSET_ENC_INT32, \u6bcf\u4e2a\u6574\u6570\u53604\u5b57\u8282\uff0c\u5e76\u6309\u7167\u65b0\u7684\u7f16\u7801\u65b9\u5f0f\u53ca\u5143\u7d20\u4e2a\u6570\u6269\u5bb9\u6570\u7ec4</li> <li>\u5012\u5e8f\u4f9d\u6b21\u5c06\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u62f7\u8d1d\u5230\u6269\u5bb9\u540e\u7684\u6b63\u786e\u4f4d\u7f6e</li> <li>\u5c06\u5f85\u6dfb\u52a0\u7684\u5143\u7d20\u653e\u5165\u6570\u7ec4\u672b\u5c3e</li> <li>\u6700\u540e\uff0c\u5c06inset\u7684encoding\u5c5e\u6027\u6539\u4e3aINTSET_ENC_INT32\uff0c\u5c06length\u5c5e\u6027\u52a01</li> </ul> <p>Intset\u53ef\u4ee5\u770b\u505a\u662f\u7279\u6b8a\u7684\u6574\u6570\u6570\u7ec4\uff0c\u5177\u5907\u4e00\u4e9b\u7279\u70b9\uff1a</p> <ul> <li>Redis\u4f1a\u786e\u4fddIntset\u4e2d\u7684\u5143\u7d20\u552f\u4e00\u3001\u6709\u5e8f</li> <li>\u5177\u5907\u7c7b\u578b\u5347\u7ea7\u673a\u5236\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4</li> <li>\u5e95\u5c42\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u65b9\u5f0f\u6765\u67e5\u8be2</li> </ul>"},{"location":"Redis/Redis/#dict","title":"Dict","text":"<p>Redis\u662f\u4e00\u4e2a\u952e\u503c\u578b\uff08Key-Value Pair\uff09\u7684\u6570\u636e\u5e93\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u952e\u5b9e\u73b0\u5feb\u901f\u7684\u589e\u5220\u6539\u67e5\u3002\u800c\u952e\u4e0e\u503c\u7684\u6620\u5c04\u5173\u7cfb\u6b63\u662f\u901a\u8fc7Dict\u6765\u5b9e\u73b0\u7684\u3002</p> <p>Dict\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u662f\uff1a\u54c8\u5e0c\u8868\uff08DictHashTable\uff09\u3001\u54c8\u5e0c\u8282\u70b9\uff08DictEntry\uff09\u3001\u5b57\u5178\uff08Dict\uff09</p> <p></p> <p>\u5f53\u6211\u4eec\u5411Dict\u6dfb\u52a0\u952e\u503c\u5bf9\u65f6\uff0cRedis\u9996\u5148\u6839\u636ekey\u8ba1\u7b97\u51fahash\u503c\uff08h\uff09\uff0c\u7136\u540e\u5229\u7528 <code>(h &amp; sizemask)</code> \u6765\u8ba1\u7b97\u5143\u7d20\u5e94\u8be5\u5b58\u50a8\u5230\u6570\u7ec4\u4e2d\u7684\u54ea\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u3002</p> <p> </p>"},{"location":"Redis/Redis/#dict\u6269\u5bb9","title":"Dict\u6269\u5bb9","text":"<p>Dict\u4e2d\u7684HashTable\u5c31\u662f\u6570\u7ec4\u7ed3\u5408\u5355\u5411\u94fe\u8868\u7684\u5b9e\u73b0\uff0c\u5f53\u96c6\u5408\u4e2d\u5143\u7d20\u8f83\u591a\u65f6\uff0c\u5fc5\u7136\u5bfc\u81f4\u54c8\u5e0c\u51b2\u7a81\u589e\u591a\uff0c\u94fe\u8868\u8fc7\u957f\uff0c\u5219\u67e5\u8be2\u6548\u7387\u4f1a\u5927\u5927\u964d\u4f4e\u3002\u53ef\u91c7\u53d6\u6269\u5bb9\u89e3\u51b3\u3002</p> <p>Dict\u5728\u6bcf\u6b21\u65b0\u589e\u952e\u503c\u5bf9\u65f6\u90fd\u4f1a\u68c0\u67e5\u8d1f\u8f7d\u56e0\u5b50\uff08LoadFactor = used/size\uff09 \uff0c\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u65f6\u4f1a\u89e6\u53d1\u54c8\u5e0c\u8868\u6269\u5bb9\uff1a</p> <ul> <li>\u54c8\u5e0c\u8868\u7684 LoadFactor &gt;= 1\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u6ca1\u6709\u6267\u884c BGSAVE \u6216\u8005 BGREWRITEAOF \u7b49\u540e\u53f0\u8fdb\u7a0b</li> <li>\u54c8\u5e0c\u8868\u7684 LoadFactor &gt; 5 </li> <li>\u5220\u9664\u5143\u7d20\u540e\u5982\u679c LoadFactor &lt; 0.1\uff0c\u4f1a\u89e6\u53d1\u54c8\u5e0c\u8868\u6536\u7f29</li> </ul>"},{"location":"Redis/Redis/#dict\u7684rehash","title":"Dict\u7684rehash","text":"<p>\u4e0d\u7ba1\u662f\u6269\u5bb9\u8fd8\u662f\u6536\u7f29\uff0c\u5fc5\u5b9a\u4f1a\u521b\u5efa\u65b0\u7684\u54c8\u5e0c\u8868\uff0c\u5bfc\u81f4\u54c8\u5e0c\u8868\u7684size\u548csizemask\u53d8\u5316\uff0c\u800ckey\u7684\u67e5\u8be2\u4e0esizemask\u6709\u5173\u3002</p> <p>\u56e0\u6b64\u5fc5\u987b\u5bf9\u54c8\u5e0c\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2akey\u91cd\u65b0\u8ba1\u7b97\u7d22\u5f15\uff0c\u63d2\u5165\u65b0\u7684\u54c8\u5e0c\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3arehash\u3002\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u8ba1\u7b97\u65b0hash\u8868\u7684realeSize\uff0c\u503c\u53d6\u51b3\u4e8e\u5f53\u524d\u8981\u505a\u7684\u662f\u6269\u5bb9\u8fd8\u662f\u6536\u7f29\uff1a</li> <li>\u5982\u679c\u662f\u6269\u5bb9\uff0c\u5219\u65b0size\u4e3a\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8edict.ht[0].used + 1\u76842^n</li> <li> <p>\u5982\u679c\u662f\u6536\u7f29\uff0c\u5219\u65b0size\u4e3a\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8edict.ht[0].used\u76842^n \uff08\u4e0d\u5f97\u5c0f\u4e8e4\uff09</p> </li> <li> <p>\u6309\u7167\u65b0\u7684realeSize\u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\uff0c\u521b\u5efadictht\uff0c\u5e76\u8d4b\u503c\u7ed9dict.ht[1]</p> </li> <li>\u8bbe\u7f6edict.rehashidx = 0\uff0c\u6807\u793a\u5f00\u59cbrehash</li> <li>~~\u5c06dict.ht[0]\u4e2d\u7684\u6bcf\u4e00\u4e2adictEntry\u90fdrehash\u5230dict.ht[1]~~</li> <li>\u6bcf\u6b21\u65b0\u589e\u3001\u67e5\u8be2\u3001\u4fee\u6539\u3001\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u90fd\u68c0\u67e5dict.rehashidx\u662f\u5426\u5927\u4e8e-1,\u5982\u679c\u5927\u4e8e\u5219\u5c06dict.ht[0].table[rehashidx]\u7684entry\u94fe\u8868rehash\u5230dict.ht[1]\uff0c\u5e76\u4e14\u5c06rehashidx++\u3002\u76f4\u81f3\u6240\u6709\u6570\u636e\u8fc1\u79fb\u3002</li> </ul> <p>[!NOTE]</p> <p>\u4ee5\u4e0a\u8fc7\u7a0b\u79f0\u4e3a \u6e10\u8fdb\u5f0frehash</p> <ul> <li>\u5c06dict.ht[1]\u8d4b\u503c\u7ed9dict.ht[0]\uff0c\u7ed9dict.ht[1]\u521d\u59cb\u5316\u4e3a\u7a7a\u54c8\u5e0c\u8868\uff0c\u91ca\u653e\u539f\u6765\u7684dict.ht[0]\u7684\u5185\u5b58</li> <li>\u5728rehash\u8fc7\u7a0b\u4e2d\uff0c\u65b0\u589e\u64cd\u4f5c\uff0c\u5219\u76f4\u63a5\u5199\u5165ht[1]\uff0c\u67e5\u8be2\u3001\u4fee\u6539\u548c\u5220\u9664\u5219\u4f1a\u5728dict.ht[0]\u548cdict.ht[1]\u4f9d\u6b21\u67e5\u627e\u5e76\u6267\u884c\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fddht[0]\u7684\u6570\u636e\u53ea\u51cf\u4e0d\u589e\uff0c\u968f\u7740rehash\u6700\u7ec8\u4e3a\u7a7a</li> </ul>"},{"location":"Redis/Redis/#ziplist","title":"ZipList","text":"<p>ZipList \u662f\u4e00\u79cd\u7279\u6b8a\u7684\u201c\u53cc\u7aef\u961f\u5217\u201d \uff0c\u7531\u4e00\u7cfb\u5217\u7279\u6b8a\u7f16\u7801\u7684\u8fde\u7eed\u5185\u5b58\u5757\u7ec4\u6210\u3002\u53ef\u4ee5\u5728\u4efb\u610f\u4e00\u7aef\u8fdb\u884c\u538b\u5165/\u5f39\u51fa\u64cd\u4f5c, \u5e76\u4e14\u8be5\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002</p> <p></p> \u5c5e\u6027 \u7c7b\u578b \u957f\u5ea6 \u7528\u9014 zlbytes uint32_t 4 \u5b57\u8282 \u8bb0\u5f55\u6574\u4e2a\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u5b57\u8282\u6570 zltail uint32_t 4 \u5b57\u8282 \u8bb0\u5f55\u538b\u7f29\u5217\u8868\u8868\u5c3e\u8282\u70b9\u8ddd\u79bb\u538b\u7f29\u5217\u8868\u7684\u8d77\u59cb\u5730\u5740\u6709\u591a\u5c11\u5b57\u8282\uff0c\u901a\u8fc7\u8fd9\u4e2a\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u786e\u5b9a\u8868\u5c3e\u8282\u70b9\u7684\u5730\u5740\u3002 zllen uint16_t 2 \u5b57\u8282 \u8bb0\u5f55\u4e86\u538b\u7f29\u5217\u8868\u5305\u542b\u7684\u8282\u70b9\u6570\u91cf\u3002 \u6700\u5927\u503c\u4e3aUINT16_MAX \uff0865534\uff09\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u6b64\u5904\u4f1a\u8bb0\u5f55\u4e3a65535\uff0c\u4f46\u8282\u70b9\u7684\u771f\u5b9e\u6570\u91cf\u9700\u8981\u904d\u5386\u6574\u4e2a\u538b\u7f29\u5217\u8868\u624d\u80fd\u8ba1\u7b97\u5f97\u51fa\u3002 entry \u5217\u8868\u8282\u70b9 \u4e0d\u5b9a \u538b\u7f29\u5217\u8868\u5305\u542b\u7684\u5404\u4e2a\u8282\u70b9\uff0c\u8282\u70b9\u7684\u957f\u5ea6\u7531\u8282\u70b9\u4fdd\u5b58\u7684\u5185\u5bb9\u51b3\u5b9a\u3002 zlend uint8_t 1 \u5b57\u8282 \u7279\u6b8a\u503c 0xFF \uff08\u5341\u8fdb\u5236 255 \uff09\uff0c\u7528\u4e8e\u6807\u8bb0\u538b\u7f29\u5217\u8868\u7684\u672b\u7aef\u3002"},{"location":"Redis/Redis/#ziplistentry","title":"ZipListEntry","text":"<p>ZipList \u4e2d\u7684Entry\u5e76\u4e0d\u50cf\u666e\u901a\u94fe\u8868\u90a3\u6837\u8bb0\u5f55\u524d\u540e\u8282\u70b9\u7684\u6307\u9488\uff0c\u56e0\u4e3a\u8bb0\u5f55\u4e24\u4e2a\u6307\u9488\u8981\u5360\u752816\u4e2a\u5b57\u8282\uff0c\u6d6a\u8d39\u5185\u5b58\u3002\u800c\u662f\u91c7\u7528\u4e86\u4e0b\u9762\u7684\u7ed3\u6784\uff1a</p> <p></p> <ul> <li>previous_entry_length\uff1a\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u53601\u4e2a\u62165\u4e2a\u5b57\u8282\u3002</li> <li>\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e254\u5b57\u8282\uff0c\u5219\u91c7\u75281\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c</li> <li> <p>\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e254\u5b57\u8282\uff0c\u5219\u91c7\u75285\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e3a0xfe\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u624d\u662f\u771f\u5b9e\u957f\u5ea6\u6570\u636e</p> </li> <li> <p>encoding\uff1a\u7f16\u7801\u5c5e\u6027\uff0c\u8bb0\u5f55content\u7684\u6570\u636e\u7c7b\u578b\uff08\u5b57\u7b26\u4e32\u8fd8\u662f\u6574\u6570\uff09\u4ee5\u53ca\u957f\u5ea6\uff0c\u5360\u75281\u4e2a\u30012\u4e2a\u62165\u4e2a\u5b57\u8282</p> </li> <li>contents\uff1a\u8d1f\u8d23\u4fdd\u5b58\u8282\u70b9\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u6574\u6570</li> </ul>"},{"location":"Redis/Redis/#encoding\u7f16\u7801","title":"Encoding\u7f16\u7801","text":"<p>encoding\u7f16\u7801\u5206\u4e3a\u5b57\u7b26\u4e32\u548c\u6574\u6570\u4e24\u79cd</p> <ul> <li>\u5982\u679cencoding\u662f\u4ee5\u201c00\u201d\u3001\u201c01\u201d\u6216\u8005\u201c10\u201d\u5f00\u5934\uff0c\u5219\u8bc1\u660econtent\u662f\u5b57\u7b26\u4e32</li> </ul> \u7f16\u7801 \u7f16\u7801\u957f\u5ea6 \u5b57\u7b26\u4e32\u5927\u5c0f |00pppppp| 1 bytes &lt;= 63 bytes |01pppppp|qqqqqqqq| 2 bytes &lt;= 16383 bytes |10000000|qqqqqqqq|rrrrrrrr|ssssssss|tttttttt| 5 bytes &lt;= 4294967295 bytes <ul> <li>\u5982\u679cencoding\u662f\u4ee5\u201c11\u201d\u5f00\u59cb\uff0c\u5219\u8bc1\u660econtent\u662f\u6574\u6570\uff0c\u4e14encoding\u56fa\u5b9a\u53ea\u5360\u75281\u4e2a\u5b57\u8282</li> </ul> \u7f16\u7801 \u7f16\u7801\u957f\u5ea6 \u6574\u6570\u7c7b\u578b 11000000 1 int16_t\uff082 bytes\uff09 11010000 1 int32_t\uff084 bytes\uff09 11100000 1 int64_t\uff088 bytes\uff09 11110000 1 24\u4f4d\u6709\u7b26\u6574\u6570(3 bytes) 11111110 1 8\u4f4d\u6709\u7b26\u6574\u6570(1 bytes) 1111xxxx 1 \u76f4\u63a5\u5728xxxx\u4f4d\u7f6e\u4fdd\u5b58\u6570\u503c\uff0c\u8303\u56f4\u4ece0001~1101\uff0c\u51cf1\u540e\u7ed3\u679c\u4e3a\u5b9e\u9645\u503c\uff080 ~ 12\uff09"},{"location":"Redis/Redis/#ziplist\u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898","title":"ZipList\u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898","text":"<p>ZipList\u7684\u6bcf\u4e2aEntry\u90fd\u5305\u542bprevious_entry_length\u6765\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\uff0c\u957f\u5ea6\u662f1\u4e2a\u62165\u4e2a\u5b57\u8282\uff1a \u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e254\u5b57\u8282\uff0c\u5219\u91c7\u75281\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c \u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e254\u5b57\u8282\uff0c\u5219\u91c7\u75285\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e3a0xfe\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u624d\u662f\u771f\u5b9e\u957f\u5ea6\u6570\u636e \u73b0\u5728\uff0c\u5047\u8bbe\u6211\u4eec\u6709N\u4e2a\u8fde\u7eed\u7684\u3001\u957f\u5ea6\u4e3a250~253\u5b57\u8282\u4e4b\u95f4\u7684entry\uff0c\u56e0\u6b64entry\u7684previous_entry_length\u5c5e\u6027\u75281\u4e2a\u5b57\u8282\u5373\u53ef\u8868\u793a\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u679c\u5728\u5934\u90e8\u65b0\u52a0\u5165\u4e00\u4e2aentry\u4e14\u5927\u5c0f\u5927\u4e8e254\u5b57\u8282\uff0c\u5219\u4e4b\u540e\u7684entry\u90fd\u8981\u8fdb\u884c\u6269\u5bb9\u66f4\u65b0</p> <p>ZipList\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\u4ea7\u751f\u7684\u8fde\u7eed\u591a\u6b21\u7a7a\u95f4\u6269\u5c55\u64cd\u4f5c\u79f0\u4e4b\u4e3a\u8fde\u9501\u66f4\u65b0\uff08Cascade Update\uff09\u3002\u65b0\u589e\u3001\u5220\u9664\u90fd\u53ef\u80fd\u5bfc\u81f4\u8fde\u9501\u66f4\u65b0\u7684\u53d1\u751f\u3002</p>"},{"location":"Redis/Redis/#quicklist","title":"QuickList","text":"<ul> <li>\u95ee\u98981\uff1aZipList\u867d\u7136\u8282\u7701\u5185\u5b58\uff0c\u4f46\u7533\u8bf7\u5185\u5b58\u5fc5\u987b\u662f\u8fde\u7eed\u7a7a\u95f4\uff0c\u5982\u679c\u5185\u5b58\u5360\u7528\u8f83\u591a\uff0c\u7533\u8bf7\u5185\u5b58\u6548\u7387\u5f88\u4f4e\u3002\u600e\u4e48\u529e\uff1f</li> <li> <p>\u7b54\uff1a\u4e3a\u4e86\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5fc5\u987b\u9650\u5236ZipList\u7684\u957f\u5ea6\u548centry\u5927\u5c0f\u3002</p> </li> <li> <p>\u95ee\u98982\uff1a\u4f46\u662f\u6211\u4eec\u8981\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u8d85\u51fa\u4e86ZipList\u6700\u4f73\u7684\u4e0a\u9650\u8be5\u600e\u4e48\u529e\uff1f</p> </li> <li> <p>\u7b54\uff1a\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aZipList\u6765\u5206\u7247\u5b58\u50a8\u6570\u636e\u3002</p> </li> <li> <p>\u95ee\u98983\uff1a\u6570\u636e\u62c6\u5206\u540e\u6bd4\u8f83\u5206\u6563\uff0c\u4e0d\u65b9\u4fbf\u7ba1\u7406\u548c\u67e5\u627e\uff0c\u8fd9\u591a\u4e2aZipList\u5982\u4f55\u5efa\u7acb\u8054\u7cfb\uff1f</p> </li> <li>\u7b54\uff1aRedis\u57283.2\u7248\u672c\u5f15\u5165\u4e86\u65b0\u7684\u6570\u636e\u7ed3\u6784QuickList\uff0c\u5b83\u662f\u4e00\u4e2a\u53cc\u7aef\u94fe\u8868\uff0c\u53ea\u4e0d\u8fc7\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2aZipList\u3002</li> </ul> <p></p> <p>\u4e3a\u4e86\u907f\u514dQuickList\u4e2d\u7684\u6bcf\u4e2aZipList\u4e2dentry\u8fc7\u591a\uff0cRedis\u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u9879\uff1alist-max-ziplist-size\u6765\u9650\u5236\u3002 \u5982\u679c\u503c\u4e3a\u6b63\uff0c\u5219\u4ee3\u8868ZipList\u7684\u5141\u8bb8\u7684entry\u4e2a\u6570\u7684\u6700\u5927\u503c \u5982\u679c\u503c\u4e3a\u8d1f\uff0c\u5219\u4ee3\u8868ZipList\u7684\u6700\u5927\u5185\u5b58\u5927\u5c0f\uff0c\u52065\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>-1\uff1a\u6bcf\u4e2aZipList\u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc74kb</li> <li>-2\uff1a\u6bcf\u4e2aZipList\u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc78kb</li> <li>-3\uff1a\u6bcf\u4e2aZipList\u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc716kb</li> <li>-4\uff1a\u6bcf\u4e2aZipList\u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc732kb</li> <li>-5\uff1a\u6bcf\u4e2aZipList\u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc764kb</li> </ul> <p>\u5176\u9ed8\u8ba4\u503c\u4e3a -2\uff1a</p> <p></p>"},{"location":"Redis/Redis/#skiplist","title":"SkipList","text":"<p>SkipList\uff08\u8df3\u8868\uff09\u9996\u5148\u662f\u94fe\u8868\uff0c\u4f46\u4e0e\u4f20\u7edf\u94fe\u8868\u76f8\u6bd4\u6709\u51e0\u70b9\u5dee\u5f02\uff1a</p> <ul> <li>\u5143\u7d20\u6309\u7167\u5347\u5e8f\u6392\u5217\u5b58\u50a8</li> <li>\u8282\u70b9\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u6307\u9488\uff0c\u6307\u9488\u8de8\u5ea6\u4e0d\u540c\u3002</li> </ul> <p></p> <p></p> <p>SkipList\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u8df3\u8dc3\u8868\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u5305\u542bscore\u548cele\u503c</li> <li>\u8282\u70b9\u6309\u7167score\u503c\u6392\u5e8f\uff0cscore\u503c\u4e00\u6837\u5219\u6309\u7167ele\u5b57\u5178\u6392\u5e8f</li> <li>\u6bcf\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u5305\u542b\u591a\u5c42\u6307\u9488\uff0c\u5c42\u6570\u662f1\u523032\u4e4b\u95f4\u7684\u968f\u673a\u6570</li> <li>\u4e0d\u540c\u5c42\u6307\u9488\u5230\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u8de8\u5ea6\u4e0d\u540c\uff0c\u5c42\u7ea7\u8d8a\u9ad8\uff0c\u8de8\u5ea6\u8d8a\u5927</li> <li>\u589e\u5220\u6539\u67e5\u6548\u7387\u4e0e\u7ea2\u9ed1\u6811\u57fa\u672c\u4e00\u81f4\uff0c\u5b9e\u73b0\u5374\u66f4\u7b80\u5355</li> </ul>"},{"location":"Redis/Redis/#redisobject","title":"RedisObject","text":"<p>Redis\u4e2d\u7684\u4efb\u610f\u6570\u636e\u7c7b\u578b\u7684\u952e\u548c\u503c\u90fd\u4f1a\u88ab\u5c01\u88c5\u4e3a\u4e00\u4e2aRedisObject\uff0c\u4e5f\u53eb\u505aRedis\u5bf9\u8c61\uff0c\u6e90\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>11\u79cd\u7f16\u7801\u65b9\u5f0f\u5982\u4e0b\uff1a</p> \u7f16\u53f7 \u7f16\u7801\u65b9\u5f0f \u8bf4\u660e 0 OBJ_ENCODING_RAW raw\u7f16\u7801\u52a8\u6001\u5b57\u7b26\u4e32 1 OBJ_ENCODING_INT long\u7c7b\u578b\u7684\u6574\u6570\u7684\u5b57\u7b26\u4e32 2 OBJ_ENCODING_HT hash\u8868\uff08\u5b57\u5178dict\uff09 3 OBJ_ENCODING_ZIPMAP \u5df2\u5e9f\u5f03 4 OBJ_ENCODING_LINKEDLIST \u53cc\u7aef\u94fe\u8868 5 OBJ_ENCODING_ZIPLIST \u538b\u7f29\u5217\u8868 6 OBJ_ENCODING_INTSET \u6574\u6570\u96c6\u5408 7 OBJ_ENCODING_SKIPLIST \u8df3\u8868 8 OBJ_ENCODING_EMBSTR embstr\u7684\u52a8\u6001\u5b57\u7b26\u4e32 9 OBJ_ENCODING_QUICKLIST \u5feb\u901f\u5217\u8868 10 OBJ_ENCODING_STREAM Stream\u6d41 <p>Redis\u4e2d\u4f1a\u6839\u636e\u5b58\u50a8\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\uff0c\u9009\u62e9\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u7684\u7f16\u7801\u65b9\u5f0f\u5982\u4e0b\uff1a</p> \u6570\u636e\u7c7b\u578b \u7f16\u7801\u65b9\u5f0f OBJ_STRING int\u3001embstr\u3001raw OBJ_LIST LinkedList\u548cZipList(3.2\u4ee5\u524d)\u3001QuickList\uff083.2\u4ee5\u540e\uff09 OBJ_SET intset\u3001HT OBJ_ZSET ZipList\u3001HT\u3001SkipList OBJ_HASH ZipList\u3001HT"},{"location":"Redis/Redis/#\u4e94\u79cd\u6570\u636e\u7ed3\u6784","title":"\u4e94\u79cd\u6570\u636e\u7ed3\u6784","text":""},{"location":"Redis/Redis/#string","title":"String(\u2741\u00b4\u25e1`\u2741)","text":"<p>String\u662fRedis\u4e2d\u6700\u5e38\u89c1\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b</p> <p>\u5176\u57fa\u672c\u7f16\u7801\u65b9\u5f0f\u662fRAW\uff0c\u57fa\u4e8e\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08SDS\uff09\u5b9e\u73b0\uff0c\u5b58\u50a8\u4e0a\u9650\u4e3a512mb\u3002</p> <p>\u5982\u679c\u5b58\u50a8\u7684SDS\u957f\u5ea6\u5c0f\u4e8e44\u5b57\u8282\uff0c\u5219\u4f1a\u91c7\u7528EMBSTR\u7f16\u7801\uff0c\u6b64\u65f6object head\u4e0eSDS\u662f\u4e00\u6bb5\u8fde\u7eed\u7a7a\u95f4\u3002\u7533\u8bf7\u5185\u5b58\u65f6\u53ea\u9700\u8981\u8c03\u7528\u4e00\u6b21\u5185\u5b58\u5206\u914d\u51fd\u6570\uff0c\u6548\u7387\u66f4\u9ad8\u3002</p> <p>[!TIP]</p> <p>\u5efa\u8bae\u4f7f\u7528Redis\u5b58\u50a8\u5b57\u7b26\u4e32\u65f6\u5c3d\u91cf\u4e0d\u8d85\u8fc744\u5b57\u8282</p> <ul> <li>\u5982\u679c\u2f00\u4e2aString\u7c7b\u578b\u7684value\u7684\u503c\u662f\u6570\u5b57\uff0c\u90a3\u4e48Redis\u5185\u90e8\u4f1a\u628a\u5b83\u8f6c\u6210long\u7c7b\u578b\u6765\u5b58\u50a8\uff0c\u4ece\u800c\u51cf\u5c11\u5185\u5b58\u7684\u4f7f\u7528\u3002</li> <li>\u5982\u679c\u5b58\u50a8\u7684\u5b57\u7b26\u4e32\u662f\u6574\u6570\u503c\uff0c\u5e76\u4e14\u5927\u5c0f\u5728LONG_MAX\u8303\u56f4\u5185\uff0c\u5219\u4f1a\u91c7\u7528INT\u7f16\u7801\uff1a\u76f4\u63a5\u5c06\u6570\u636e\u4fdd\u5b58\u5728RedisObject\u7684ptr\u6307\u9488\u4f4d\u7f6e\uff08\u521a\u597d8\u5b57\u8282\uff09\uff0c\u4e0d\u518d\u9700\u8981SDS\u4e86\u3002</li> </ul>"},{"location":"Redis/Redis/#list","title":"List(\u25cf'\u25e1'\u25cf)","text":"<p>Redis\u7684List\u7c7b\u578b\u53ef\u4ee5\u4ece\u9996\u3001\u5c3e\u64cd\u4f5c\u5217\u8868\u4e2d\u7684\u5143\u7d20</p> <p>\u53ef\u8003\u8651\u7684\u5b9e\u73b0\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>LinkedList \uff1a\u666e\u901a\u94fe\u8868\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u8f83\u9ad8\uff0c\u5185\u5b58\u788e\u7247\u8f83\u591a</li> <li>ZipList \uff1a\u538b\u7f29\u5217\u8868\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u4f4e\uff0c\u5b58\u50a8\u4e0a\u9650\u4f4e</li> <li>QuickList\uff1aLinkedList + ZipList\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u8f83\u4f4e\uff0c\u5305\u542b\u591a\u4e2aZipList\uff0c\u5b58\u50a8\u4e0a\u9650\u9ad8</li> </ul> <p>[!TIP]</p> <p>\u57283.2\u7248\u672c\u4e4b\u524d\uff0cRedis\u91c7\u7528ZipList\u548cLinkedList\u6765\u5b9e\u73b0List\uff0c\u5f53\u5143\u7d20\u6570\u91cf\u5c0f\u4e8e512\u5e76\u4e14\u5143\u7d20\u5927\u5c0f\u5c0f\u4e8e64\u5b57\u8282\u65f6\u91c7\u7528ZipList\u7f16\u7801\uff0c\u8d85\u8fc7\u5219\u91c7\u7528LinkedList\u7f16\u7801\u3002</p> <p>\u57283.2\u7248\u672c\u4e4b\u540e\uff0cRedis\u7edf\u4e00\u91c7\u7528QuickList\u6765\u5b9e\u73b0List</p>"},{"location":"Redis/Redis/#set","title":"Set\u2570(\u00b0\u25bd\u00b0)\u256f","text":"<p>set\u662fRedis\u4e2d\u7684\u5355\u5217\u96c6\u5408\uff0c\u6ee1\u8db3\u4e0b\u5217\u7279\u70b9\uff1a</p> <ul> <li>\u5143\u7d20\u65e0\u5e8f\u6027</li> <li>\u5143\u7d20\u552f\u4e00\u6027</li> <li>\u652f\u6301\u6c42\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6</li> </ul> <p>[!TIP]</p> <ul> <li> <p>\u4e3a\u4e86\u67e5\u8be2\u6548\u7387\u548c\u552f\u4e00\u6027\uff0cset\u91c7\u7528HT\u7f16\u7801\uff08Dict\uff09\u3002Dict\u4e2d\u7684key\u7528\u6765\u5b58\u50a8\u5143\u7d20\uff0cvalue\u7edf\u4e00\u4e3anull\u3002</p> </li> <li> <p>\u5f53\u5b58\u50a8\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u6574\u6570\uff0c\u5e76\u4e14\u5143\u7d20\u6570\u91cf\u4e0d\u8d85\u8fc7 <code>set-max-intset-entries</code> \u65f6\uff0cSet\u4f1a\u91c7\u7528IntSet\u7f16\u7801\uff0c\u4ee5\u8282\u7701\u5185\u5b58</p> </li> </ul>"},{"location":"Redis/Redis/#zset-oo","title":"Zset o(\u2267\u25bd\u2266)o","text":"<p>ZSet\u4e5f\u5c31\u662fSortedSet\uff0c\u5176\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u9700\u8981\u6307\u5b9a\u4e00\u4e2ascore\u503c\u548cmember\u503c\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u5f81\uff1a</p> <ul> <li>\u53ef\u4ee5\u6839\u636escore\u503c\u6392\u5e8f</li> <li>member\u5fc5\u987b\u552f\u4e00</li> <li>\u53ef\u4ee5\u6839\u636emember\u67e5\u8be2\u5206\u6570</li> </ul> <p>[!TIP]</p> <p>Redis\u91c7\u7528\u5982\u4e0b\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u5b9e\u73b0zset</p> <ul> <li>SkipList\uff1a\u53ef\u4ee5\u6392\u5e8f\uff0c\u5e76\u4e14\u53ef\u4ee5\u540c\u65f6\u5b58\u50a8score\u548cele\u503c\uff08member\uff09</li> <li>HT\uff08Dict\uff09\uff1a\u53ef\u4ee5\u952e\u503c\u5b58\u50a8\uff0c\u5e76\u4e14\u53ef\u4ee5\u6839\u636ekey\u627evalue</li> </ul> <p></p> <p></p> <p>\u5f53\u5143\u7d20\u6570\u91cf\u4e0d\u591a\u65f6\uff0cHT\u548cSkipList\u7684\u4f18\u52bf\u4e0d\u660e\u663e\uff0c\u800c\u4e14\u66f4\u8017\u5185\u5b58\u3002\u56e0\u6b64zset\u8fd8\u4f1a\u91c7\u7528ZipList\u7ed3\u6784\u6765\u8282\u7701\u5185\u5b58\uff0c\u4e0d\u8fc7\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li>\u5143\u7d20\u6570\u91cf\u5c0f\u4e8ezset_max_ziplist_entries\uff0c\u9ed8\u8ba4\u503c128</li> <li>\u6bcf\u4e2a\u5143\u7d20\u90fd\u5c0f\u4e8ezset_max_ziplist_value\u5b57\u8282\uff0c\u9ed8\u8ba4\u503c64</li> </ul> <p>[!TIP]</p> <p>ziplist\u672c\u8eab\u6ca1\u6709\u6392\u5e8f\u529f\u80fd\uff0c\u800c\u4e14\u6ca1\u6709\u952e\u503c\u5bf9\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u9700\u8981\u901a\u8fc7\u7f16\u7801\u5b9e\u73b0\uff1a</p> <ul> <li>ZipList\u662f\u8fde\u7eed\u5185\u5b58\uff0c\u56e0\u6b64score\u548celement\u662f\u7d27\u6328\u5728\u4e00\u8d77\u7684\u4e24\u4e2aentry\uff0c element\u5728\u524d\uff0cscore\u5728\u540e</li> <li>score\u8d8a\u5c0f\u8d8a\u63a5\u8fd1\u961f\u9996\uff0cscore\u8d8a\u5927\u8d8a\u63a5\u8fd1\u961f\u5c3e\uff0c\u6309\u7167score\u503c\u5347\u5e8f\u6392\u5217</li> </ul>"},{"location":"Redis/Redis/#hash-\u3064-_-\u3064","title":"Hash\u0f3c \u3064 \u25d5_\u25d5 \u0f3d\u3064","text":"<p>Hash\u7ed3\u6784\u4e0eRedis\u4e2d\u7684Zset\u975e\u5e38\u7c7b\u4f3c\uff1a</p> <ul> <li>\u90fd\u662f\u952e\u503c\u5b58\u50a8</li> <li>\u90fd\u9700\u6c42\u6839\u636e\u952e\u83b7\u53d6\u503c</li> <li>\u952e\u5fc5\u987b\u552f\u4e00</li> </ul> <p>\u533a\u522b\u5982\u4e0b\uff1a</p> <ul> <li>zset\u7684\u952e\u662fmember\uff0c\u503c\u662fscore\uff1bhash\u7684\u952e\u548c\u503c\u90fd\u662f\u4efb\u610f\u503c</li> <li>zset\u8981\u6839\u636escore\u6392\u5e8f\uff1bhash\u5219\u65e0\u9700\u6392\u5e8f</li> </ul> <p>[!TIP]</p> <p>\u5f53Hash\u4e2d\u6570\u636e\u9879\u6bd4\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0cHash\u5e95\u5c42\u4f7f\u7528\u538b\u7f29\u5217\u8868ziplist\u8fdb\u884c\u5b58\u50a8\u6570\u636e\uff0c\u968f\u7740\u6570\u636e\u7684\u589e\u52a0\uff0c\u5e95\u5c42\u7684ziplist\u5c31\u53ef\u80fd\u4f1a\u8f6c\u6210dict</p> <p>\u8f6c\u6362\u9608\u503c\uff1a</p> <p><code>hash-max-ziplist-entries 512</code></p> <p><code>hash-max-ziplist-value 64</code></p>"},{"location":"Redis/Redis/#\u7f51\u7edc\u6a21\u578b","title":"\u7f51\u7edc\u6a21\u578b","text":""},{"location":"Redis/Redis/#\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4","title":"\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4","text":"<p>\u4e3a\u4e86\u8ba9\u7528\u6237\u5e94\u7528\u8bbf\u95ee\u8ba1\u7b97\u673a\u786c\u4ef6\u8d44\u6e90\uff0c\u8ba1\u7b97\u673a\u5c31\u5fc5\u987b\u8981\u901a\u8fc7\u5bf9\u5916\u66b4\u9732\u7684\u4e00\u4e9b\u63a5\u53e3\uff0c\u624d\u80fd\u8bbf\u95ee\u5230\uff0c\u4ece\u800c\u7b80\u4ecb\u7684\u5b9e\u73b0\u5bf9\u5185\u6838\u7684\u64cd\u63a7\uff0c\u4f46\u662f\u5185\u6838\u672c\u8eab\u4e0a\u6765\u8bf4\u4e5f\u662f\u4e00\u4e2a\u5e94\u7528\uff0c\u6240\u4ee5\u4ed6\u672c\u8eab\u4e5f\u9700\u8981\u8ba1\u7b97\u673a\u8d44\u6e90</p> <p>\u56e0\u6b64\u9700\u8981\u628a\u7528\u6237\u548c\u5185\u6838\u9694\u79bb\u5f00\uff0c\u5206\u4e3a\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4</p> <p>Linux\u7cfb\u7edf\u4e3a\u4e86\u63d0\u9ad8IO\u6548\u7387\uff0c\u4f1a\u5728\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u90fd\u52a0\u5165\u7f13\u51b2\u533a\uff1a</p> <ul> <li> <p>\u5199\u6570\u636e\u65f6\uff0c\u8981\u628a\u7528\u6237\u7f13\u51b2\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7136\u540e\u5199\u5165\u8bbe\u5907</p> </li> <li> <p>\u8bfb\u6570\u636e\u65f6\uff0c\u8981\u4ece\u8bbe\u5907\u8bfb\u53d6\u6570\u636e\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7136\u540e\u62f7\u8d1d\u5230\u7528\u6237\u7f13\u51b2\u533a</p> </li> </ul> <p>\u9488\u5bf9\u8fd9\u4e2a\u64cd\u4f5c\uff1a\u6211\u4eec\u7684\u7528\u6237\u5728\u5199\u8bfb\u6570\u636e\u65f6\uff0c\u4f1a\u53bb\u5411\u5185\u6838\u6001\u7533\u8bf7\uff0c\u60f3\u8981\u8bfb\u53d6\u5185\u6838\u7684\u6570\u636e\uff0c\u800c\u5185\u6838\u6570\u636e\u8981\u53bb\u7b49\u5f85\u9a71\u52a8\u7a0b\u5e8f\u4ece\u786c\u4ef6\u4e0a\u8bfb\u53d6\u6570\u636e\uff0c\u5f53\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u5230\u6570\u636e\u4e4b\u540e\uff0c\u5185\u6838\u4f1a\u5c06\u6570\u636e\u5199\u5165\u5230\u5185\u6838\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u518d\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u6001\u7684buffer\u4e2d\uff0c\u7136\u540e\u518d\u8fd4\u56de\u7ed9\u5e94\u7528\u7a0b\u5e8f\uff0c\u6574\u4f53\u800c\u8a00\uff0c\u901f\u5ea6\u6162\uff0c\u5c31\u662f\u8fd9\u4e2a\u539f\u56e0\uff0c\u4e3a\u4e86\u52a0\u901f\uff0c\u6211\u4eec\u5e0c\u671bread\u4e5f\u597d\uff0c\u8fd8\u662fwait for data\u4e5f\u6700\u597d\u90fd\u4e0d\u8981\u7b49\u5f85\uff0c\u6216\u8005\u65f6\u95f4\u5c3d\u91cf\u7684\u77ed\u3002</p>"},{"location":"Redis/Redis/#\u963b\u585eio","title":"\u963b\u585eIO","text":"<p>[!NOTE]</p> <p>\u5728\u300aUNIX\u7f51\u7edc\u7f16\u7a0b\u300b\u4e00\u4e66\u4e2d\uff0c\u603b\u7ed3\u5f52\u7eb3\u4e865\u79cdIO\u6a21\u578b\uff1a</p> <ul> <li>\u963b\u585eIO\uff08Blocking IO\uff09</li> <li>\u975e\u963b\u585eIO\uff08Nonblocking IO\uff09</li> <li>IO\u591a\u8def\u590d\u7528\uff08IO Multiplexing\uff09</li> <li>\u4fe1\u53f7\u9a71\u52a8IO\uff08Signal Driven IO\uff09</li> <li>\u5f02\u6b65IO\uff08Asynchronous IO\uff09</li> </ul> <p></p> <p>\u963b\u585eIO\u5c31\u662f\u4e24\u4e2a\u9636\u6bb5\u90fd\u5fc5\u987b\u963b\u585e\u7b49\u5f85\uff1a</p> <p>\u9636\u6bb5\u4e00\uff1a</p> <ul> <li>\u7528\u6237\u8fdb\u7a0b\u5c1d\u8bd5\u8bfb\u53d6\u6570\u636e\uff08\u6bd4\u5982\u7f51\u5361\u6570\u636e\uff09</li> <li>\u6b64\u65f6\u6570\u636e\u5c1a\u672a\u5230\u8fbe\uff0c\u5185\u6838\u9700\u8981\u7b49\u5f85\u6570\u636e</li> <li>\u6b64\u65f6\u7528\u6237\u8fdb\u7a0b\u4e5f\u5904\u4e8e\u963b\u585e\u72b6\u6001</li> </ul> <p>\u9636\u6bb5\u4e8c\uff1a</p> <ul> <li>\u6570\u636e\u5230\u8fbe\u5e76\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u4ee3\u8868\u5df2\u5c31\u7eea</li> <li>\u5c06\u5185\u6838\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7f13\u51b2\u533a</li> <li>\u62f7\u8d1d\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237\u8fdb\u7a0b\u4f9d\u7136\u963b\u585e\u7b49\u5f85</li> <li>\u62f7\u8d1d\u5b8c\u6210\uff0c\u7528\u6237\u8fdb\u7a0b\u89e3\u9664\u963b\u585e\uff0c\u5904\u7406\u6570\u636e</li> </ul>"},{"location":"Redis/Redis/#\u975e\u963b\u585eio","title":"\u975e\u963b\u585eIO","text":"<p>\u975e\u963b\u585eIO\u7684recvfrom\u64cd\u4f5c\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\u800c\u4e0d\u662f\u963b\u585e\u7528\u6237\u8fdb\u7a0b\u3002</p> <p>\u9636\u6bb5\u4e00\uff1a</p> <ul> <li>\u7528\u6237\u8fdb\u7a0b\u5c1d\u8bd5\u8bfb\u53d6\u6570\u636e\uff08\u6bd4\u5982\u7f51\u5361\u6570\u636e\uff09</li> <li>\u6b64\u65f6\u6570\u636e\u5c1a\u672a\u5230\u8fbe\uff0c\u5185\u6838\u9700\u8981\u7b49\u5f85\u6570\u636e</li> <li>\u8fd4\u56de\u5f02\u5e38\u7ed9\u7528\u6237\u8fdb\u7a0b</li> <li>\u7528\u6237\u8fdb\u7a0b\u62ff\u5230error\u540e\uff0c\u518d\u6b21\u5c1d\u8bd5\u8bfb\u53d6</li> <li>\u5faa\u73af\u5f80\u590d\uff0c\u76f4\u5230\u6570\u636e\u5c31\u7eea</li> </ul> <p>\u9636\u6bb5\u4e8c\uff1a</p> <ul> <li>\u5c06\u5185\u6838\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7f13\u51b2\u533a</li> <li>\u62f7\u8d1d\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237\u8fdb\u7a0b\u4f9d\u7136\u963b\u585e\u7b49\u5f85</li> <li>\u62f7\u8d1d\u5b8c\u6210\uff0c\u7528\u6237\u8fdb\u7a0b\u89e3\u9664\u963b\u585e\uff0c\u5904\u7406\u6570\u636e</li> <li>\u53ef\u4ee5\u770b\u5230\uff0c\u975e\u963b\u585eIO\u6a21\u578b\u4e2d\uff0c\u7528\u6237\u8fdb\u7a0b\u5728\u7b2c\u4e00\u4e2a\u9636\u6bb5\u662f\u975e\u963b\u585e\uff0c\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u662f\u963b\u585e\u72b6\u6001\u3002\u867d\u7136\u662f\u975e\u963b\u585e\uff0c\u4f46\u6027\u80fd\u5e76\u6ca1\u6709\u5f97\u5230\u63d0\u9ad8\u3002\u800c\u4e14\u5fd9\u7b49\u673a\u5236\u4f1a\u5bfc\u81f4CPU\u7a7a\u8f6c\uff0cCPU\u4f7f\u7528\u7387\u66b4\u589e\u3002</li> </ul> <p></p>"},{"location":"Redis/Redis/#io\u591a\u8def\u590d\u7528","title":"IO\u591a\u8def\u590d\u7528","text":"<p>\u65e0\u8bba\u662f\u963b\u585eIO\u8fd8\u662f\u975e\u963b\u585eIO\uff0c\u7528\u6237\u5e94\u7528\u5728\u4e00\u9636\u6bb5\u90fd\u9700\u8981\u8c03\u7528recvfrom\u6765\u83b7\u53d6\u6570\u636e\uff0c\u5dee\u522b\u5728\u4e8e\u65e0\u6570\u636e\u65f6\u7684\u5904\u7406\u65b9\u6848\uff1a</p> <ul> <li>\u5982\u679c\u8c03\u7528recvfrom\u65f6\uff0c\u6070\u597d\u6ca1\u6709\u6570\u636e\uff0c\u963b\u585eIO\u4f1a\u4f7fCPU\u963b\u585e\uff0c\u975e\u963b\u585eIO\u4f7fCPU\u7a7a\u8f6c\uff0c\u90fd\u4e0d\u80fd\u5145\u5206\u53d1\u6325CPU\u7684\u4f5c\u7528\u3002</li> <li>\u5982\u679c\u8c03\u7528recvfrom\u65f6\uff0c\u6070\u597d\u6709\u6570\u636e\uff0c\u5219\u7528\u6237\u8fdb\u7a0b\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\uff0c\u8bfb\u53d6\u5e76\u5904\u7406\u6570\u636e</li> </ul> <p>[!WARNING]</p> <p>\u5728\u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u4f9d\u6b21\u5904\u7406IO\u4e8b\u4ef6\uff0c\u5982\u679c\u6b63\u5728\u5904\u7406\u7684IO\u4e8b\u4ef6\u6070\u597d\u672a\u5c31\u7eea\uff08\u6570\u636e\u4e0d\u53ef\u8bfb\u6216\u4e0d\u53ef\u5199\uff09\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u6240\u6709IO\u4e8b\u4ef6\u90fd\u5fc5\u987b\u7b49\u5f85\uff0c\u6027\u80fd\u81ea\u7136\u4f1a\u5f88\u5dee</p> <p>\u901a\u8fc7FD\uff0c\u6211\u4eec\u7684\u7f51\u7edc\u6a21\u578b\u53ef\u4ee5\u5229\u7528\u4e00\u4e2a\u7ebf\u7a0b\u76d1\u542c\u591a\u4e2aFD\uff0c\u5e76\u5728\u67d0\u4e2aFD\u53ef\u8bfb\u3001\u53ef\u5199\u65f6\u5f97\u5230\u901a\u77e5\uff0c\u4ece\u800c\u907f\u514d\u65e0\u6548\u7684\u7b49\u5f85\uff0c\u5145\u5206\u5229\u7528CPU\u8d44\u6e90\u3002</p> <p>[!NOTE]</p> <p>\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08File Descriptor\uff09\uff1a\u7b80\u79f0FD\uff0c\u662f\u4e00\u4e2a\u4ece0 \u5f00\u59cb\u7684\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u7528\u6765\u5173\u8054Linux\u4e2d\u7684\u4e00\u4e2a\u6587\u4ef6\u3002\u5728Linux\u4e2d\uff0c\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u4f8b\u5982\u5e38\u89c4\u6587\u4ef6\u3001\u89c6\u9891\u3001\u786c\u4ef6\u8bbe\u5907\u7b49\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u7f51\u7edc\u5957\u63a5\u5b57\uff08Socket\uff09\u3002</p> <p>IO\u591a\u8def\u590d\u7528\u662f\u5229\u7528\u5355\u4e2a\u7ebf\u7a0b\u6765\u540c\u65f6\u76d1\u542c\u591a\u4e2aFD\uff0c\u5e76\u5728\u67d0\u4e2aFD\u53ef\u8bfb\u3001\u53ef\u5199\u65f6\u5f97\u5230\u901a\u77e5\uff0c\u4ece\u800c\u907f\u514d\u65e0\u6548\u7684\u7b49\u5f85\uff0c\u5145\u5206\u5229\u7528CPU\u8d44\u6e90\u3002\u4e0d\u8fc7\u76d1\u542cFD\u7684\u65b9\u5f0f\u3001\u901a\u77e5\u7684\u65b9\u5f0f\u53c8\u6709\u591a\u79cd\u5b9e\u73b0\uff0c\u5e38\u89c1\u7684\u6709\uff1a</p> <ul> <li>select</li> <li>poll</li> <li>epoll</li> </ul> <p>\u5176\u4e2dselect\u548cpool\u76f8\u5f53\u4e8e\u662f\u5f53\u88ab\u76d1\u542c\u7684\u6570\u636e\u51c6\u5907\u597d\u4e4b\u540e\uff0c\u4ed6\u4f1a\u628a\u4f60\u76d1\u542c\u7684FD\u6574\u4e2a\u6570\u636e\u90fd\u53d1\u7ed9\u4f60\uff0c\u4f60\u9700\u8981\u5230\u6574\u4e2aFD\u4e2d\u53bb\u627e\uff0c\u54ea\u4e9b\u662f\u5904\u7406\u597d\u4e86\u7684\uff0c\u9700\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u6027\u80fd\u4e5f\u5e76\u4e0d\u662f\u90a3\u4e48\u597d</p> <p>\u800cepoll\uff0c\u5219\u76f8\u5f53\u4e8e\u5185\u6838\u51c6\u5907\u597d\u4e86\u4e4b\u540e\uff0c\u4ed6\u4f1a\u628a\u51c6\u5907\u597d\u7684\u6570\u636e\uff0c\u76f4\u63a5\u53d1\u7ed9\u4f60\uff0c\u54b1\u4eec\u5c31\u7701\u53bb\u4e86\u904d\u5386\u7684\u52a8\u4f5c\u3002</p> <p>[!TIP]</p> <p>\u7528IO\u590d\u7528\u6a21\u5f0f\uff0c\u53ef\u4ee5\u786e\u4fdd\u53bb\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u6570\u636e\u662f\u4e00\u5b9a\u5b58\u5728\u7684\uff0c\u4ed6\u7684\u6548\u7387\u6bd4\u539f\u6765\u7684\u963b\u585eIO\u548c\u975e\u963b\u585eIO\u6027\u80fd\u90fd\u8981\u9ad8</p>"},{"location":"Redis/Redis/#io\u591a\u8def\u590d\u7528-select","title":"IO\u591a\u8def\u590d\u7528-select","text":"<p>select\u662fLinux\u6700\u65e9\u662f\u7531\u7684I/O\u591a\u8def\u590d\u7528\u6280\u672f\uff1a</p> <p>\u7b80\u5355\u8bf4\uff0c\u5c31\u662f\u6211\u4eec\u628a\u9700\u8981\u5904\u7406\u7684\u6570\u636e\u5c01\u88c5\u6210FD\uff0c\u7136\u540e\u5c06\u6574\u4e2aFD\u53d1\u7ed9\u5185\u6838\uff0c\u5185\u6838\u4f1a\u68c0\u67e5\u6570\u636e\u662f\u5426\u5c31\u7eea\uff08\u6ca1\u6709\u5c31\u7eea\u5219\u4f11\u7720\uff0c\u76f4\u5230\u6570\u636e\u5c31\u7eea\u5c06\u5176\u5524\u9192\uff09\uff0c\u6570\u636e\u5c31\u7eea\u540e\uff0c\u518d\u5c06\u51c6\u5907\u597d\u7684FD\u96c6\u5408\u5199\u56de\u5230\u7528\u6237\u6001\u4e2d\u53bb\uff0c\u7528\u6237\u6001\u4e5f\u9700\u8981\u53bb\u8fdb\u884c\u904d\u5386\uff0c\u7136\u540e\u627e\u5230\u5bf9\u5e94\u51c6\u5907\u597d\u6570\u636e\u7684\u8282\u70b9\uff0c\u518d\u53bb\u53d1\u8d77\u8bfb\u8bf7\u6c42</p> <p>\u8fd9\u79cd\u6a21\u5f0f\u4e0b\u4ed6\u867d\u7136\u6bd4\u963b\u585eIO\u548c\u975e\u963b\u585eIO\u597d\uff0c\u4f46\u662f\u4f9d\u7136\u6709\u9700\u8981\u9891\u7e41\u7684\u4f20\u9012fd\u96c6\u5408\uff0c\u9891\u7e41\u7684\u53bb\u904d\u5386FD\u7b49\u95ee\u9898</p> <p></p>"},{"location":"Redis/Redis/#io\u591a\u8def\u590d\u7528-poll","title":"IO\u591a\u8def\u590d\u7528-poll","text":"<p>poll\u6a21\u5f0f\u5bf9select\u6a21\u5f0f\u505a\u4e86\u7b80\u5355\u6539\u8fdb\uff0c\u4f46\u6027\u80fd\u63d0\u5347\u4e0d\u660e\u663e</p> <p>IO\u6d41\u7a0b\uff1a</p> <ul> <li>\u521b\u5efapollfd\u6570\u7ec4\uff0c\u5411\u5176\u4e2d\u6dfb\u52a0\u5173\u6ce8\u7684fd\u4fe1\u606f\uff0c\u6570\u7ec4\u5927\u5c0f\u81ea\u5b9a\u4e49</li> <li>\u8c03\u7528poll\u51fd\u6570\uff0c\u5c06pollfd\u6570\u7ec4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u8f6c\u94fe\u8868\u5b58\u50a8\uff0c\u65e0\u4e0a\u9650</li> <li>\u5185\u6838\u904d\u5386fd\uff0c\u5224\u65ad\u662f\u5426\u5c31\u7eea</li> <li>\u6570\u636e\u5c31\u7eea\u6216\u8d85\u65f6\u540e\uff0c\u62f7\u8d1dpollfd\u6570\u7ec4\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u8fd4\u56de\u5c31\u7eeafd\u6570\u91cfn</li> <li>\u7528\u6237\u8fdb\u7a0b\u5224\u65adn\u662f\u5426\u5927\u4e8e0,\u5927\u4e8e0\u5219\u904d\u5386pollfd\u6570\u7ec4\uff0c\u627e\u5230\u5c31\u7eea\u7684fd</li> </ul> <p>\u4e0eselect\u5bf9\u6bd4\uff1a</p> <ul> <li>select\u6a21\u5f0f\u4e2d\u7684fd_set\u5927\u5c0f\u56fa\u5b9a\u4e3a1024\uff0c\u800cpollfd\u5728\u5185\u6838\u4e2d\u91c7\u7528\u94fe\u8868\uff0c\u7406\u8bba\u4e0a\u65e0\u4e0a\u9650</li> <li>\u76d1\u542cFD\u8d8a\u591a\uff0c\u6bcf\u6b21\u904d\u5386\u6d88\u8017\u65f6\u95f4\u4e5f\u8d8a\u4e45\uff0c\u6027\u80fd\u53cd\u800c\u4f1a\u4e0b\u964d</li> </ul> <p></p>"},{"location":"Redis/Redis/#io\u591a\u8def\u590d\u7528-epoll","title":"IO\u591a\u8def\u590d\u7528-epoll","text":"<p>poll\u6a21\u5f0f\u662f\u5bf9select\u548cpoll\u7684\u6539\u8fdb\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e09\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1a</p> <ol> <li><code>eventpoll</code></li> </ol> <p>[!NOTE]</p> <p>\u4f1a\u521b\u5efa\u5982\u4e0b\u6570\u636e\u7ed3\u6784</p> <ul> <li> <p>\u7ea2\u9ed1\u6811 ---&gt; \u8bb0\u5f55\u8981\u76d1\u542c\u7684FD</p> </li> <li> <p>\u94fe\u8868 ---&gt; \u4e00\u4e2a\u94fe\u8868\uff0c\u8bb0\u5f55\u5c31\u7eea\u7684FD</p> </li> </ul> <ol> <li><code>epoll_ctl</code></li> </ol> <p>[!NOTE]</p> <p>\u5c06\u8981\u76d1\u542c\u7684\u6570\u636e\u6dfb\u52a0\u5230\u7ea2\u9ed1\u6811\u4e0a\u53bb\uff0c\u5e76\u4e14\u7ed9\u6bcf\u4e2afd\u8bbe\u7f6e\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5728fd\u6570\u636e\u5c31\u7eea\u65f6\u89e6\u53d1\uff0c\u4f1a\u628afd\u628a\u6570\u636e\u6dfb\u52a0\u5230list_head\u4e2d\u53bb</p> <ol> <li><code>epoll_wait</code></li> </ol> <p>[!NOTE]</p> <p>\u5f53\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5148\u521b\u5efaevents\u6570\u7ec4\uff0c\u7136\u540e\u68c0\u67e5list_head\uff08\u4f1a\u6709\u7b49\u5f85\u65f6\u95f4\uff0c\u4f9d\u636e\u6570\u636e\u7ed3\u6784\u7684\u914d\u7f6e\uff09\uff0clist_head\u4e2d\u6709\u6570\u636e\u4f1a\u5c06\u6570\u636e\u653e\u5165\u5230events\u6570\u7ec4\u4e2d\uff0c\u7528\u6237\u5e94\u7528\u6536\u5230\u54cd\u5e94\u540e\uff0c\u5c31\u53ef\u4ee5\u53bb\u53d6\u6570\u636e</p>"},{"location":"Redis/Redis/#io\u591a\u8def\u590d\u7528-\u4e8b\u4ef6\u901a\u77e5\u673a\u5236","title":"IO\u591a\u8def\u590d\u7528-\u4e8b\u4ef6\u901a\u77e5\u673a\u5236","text":"<p>\u5f53FD\u6709\u6570\u636e\u53ef\u8bfb\u65f6\uff0c\u6211\u4eec\u8c03\u7528epoll_wait\uff08\u6216\u8005select\u3001poll\uff09\u53ef\u4ee5\u5f97\u5230\u901a\u77e5\u3002\u4f46\u662f\u4e8b\u4ef6\u901a\u77e5\u7684\u6a21\u5f0f\u6709\u4e24\u79cd\uff1a</p> <ul> <li>LevelTriggered\uff1a\u7b80\u79f0LT\uff0c\u4e5f\u53eb\u505a\u6c34\u5e73\u89e6\u53d1\u3002\u53ea\u8981\u67d0\u4e2aFD\u4e2d\u6709\u6570\u636e\u53ef\u8bfb\uff0c\u6bcf\u6b21\u8c03\u7528epoll_wait\u90fd\u4f1a\u5f97\u5230\u901a\u77e5\u3002</li> <li>EdgeTriggered\uff1a\u7b80\u79f0ET\uff0c\u4e5f\u53eb\u505a\u8fb9\u6cbf\u89e6\u53d1\u3002\u53ea\u6709\u5728\u67d0\u4e2aFD\u6709\u72b6\u6001\u53d8\u5316\u65f6\uff0c\u8c03\u7528epoll_wait\u624d\u4f1a\u88ab\u901a\u77e5\u3002</li> </ul> <p>\u200b                                                                                                                                                        </p> <p>\u4e3e\u4e2a\u6817\u5b50\uff08\uffe3\ufe36\uffe3\uff09\u2197\u3000\uff1a</p> <ul> <li>\u5047\u8bbe\u4e00\u4e2a\u5ba2\u6237\u7aefsocket\u5bf9\u5e94\u7684FD\u5df2\u7ecf\u6ce8\u518c\u5230\u4e86epoll\u5b9e\u4f8b\u4e2d</li> <li>\u5ba2\u6237\u7aefsocket\u53d1\u9001\u4e862kb\u7684\u6570\u636e</li> <li>\u670d\u52a1\u7aef\u8c03\u7528epoll_wait\uff0c\u5f97\u5230\u901a\u77e5\u8bf4FD\u5c31\u7eea</li> <li>\u670d\u52a1\u7aef\u4eceFD\u8bfb\u53d6\u4e861kb\u6570\u636e\u56de\u5230\u6b65\u9aa43\uff08\u518d\u6b21\u8c03\u7528epoll_wait\uff0c\u5f62\u6210\u5faa\u73af\uff09</li> </ul> <p>[!TIP]</p> <p>\u5982\u679c\u6211\u4eec\u91c7\u7528LT\u6a21\u5f0f\uff0c\u56e0\u4e3aFD\u4e2d\u4ecd\u67091kb\u6570\u636e\uff0c\u5219\u7b2c\u2464\u6b65\u4f9d\u7136\u4f1a\u8fd4\u56de\u7ed3\u679c\uff0c\u5e76\u4e14\u5f97\u5230\u901a\u77e5 \u5982\u679c\u6211\u4eec\u91c7\u7528ET\u6a21\u5f0f\uff0c\u56e0\u4e3a\u7b2c\u2462\u6b65\u5df2\u7ecf\u6d88\u8d39\u4e86FD\u53ef\u8bfb\u4e8b\u4ef6\uff0c\u7b2c\u2464\u6b65FD\u72b6\u6001\u6ca1\u6709\u53d8\u5316\uff0c\u56e0\u6b64epoll_wait\u4e0d\u4f1a\u8fd4\u56de\uff0c\u6570\u636e\u65e0\u6cd5\u8bfb\u53d6\uff0c\u5ba2\u6237\u7aef\u54cd\u5e94\u8d85\u65f6\u3002</p> <p>\u7ed3\u8bba\uff1a</p> <ul> <li> ET\u6a21\u5f0f\u907f\u514d\u4e86LT\u6a21\u5f0f\u53ef\u80fd\u51fa\u73b0\u7684\u60ca\u7fa4\u73b0\u8c61</li> <li> ET\u6a21\u5f0f\u6700\u597d\u7ed3\u5408\u975e\u963b\u585eIO\u8bfb\u53d6\u6570\u636e\uff0c\u76f8\u6bd4LT\u66f4\u590d\u6742\u4e00\u4e9b</li> </ul> <p>[!NOTE]</p> <p>\u60ca\u7fa4\u73b0\u8c61</p> <p>\u60ca\u7fa4\u73b0\u8c61\u662f\u6307\u5728\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u5f53\u591a\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u540c\u65f6\u7b49\u5f85\u540c\u4e00\u4e2a\u4e8b\u4ef6\uff08\u5982\u8d44\u6e90\u53ef\u7528\u3001\u4fe1\u53f7\u89e6\u53d1\u7b49\uff09\u65f6\uff0c\u5f53\u8be5\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u6240\u6709\u7b49\u5f85\u8005\u90fd\u88ab\u5524\u9192\uff0c\u4f46\u6700\u7ec8\u53ea\u6709\u4e00\u4e2a\u80fd\u6210\u529f\u83b7\u53d6\u8d44\u6e90\uff0c\u5176\u4f59\u7684\u90fd\u56e0\u7ade\u4e89\u5931\u8d25\u800c\u4e0d\u5f97\u4e0d\u91cd\u65b0\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u7684\u73b0\u8c61\u3002</p>"},{"location":"Redis/Redis/#\u4fe1\u53f7\u9a71\u52a8io","title":"\u4fe1\u53f7\u9a71\u52a8IO","text":"<p>\u4fe1\u53f7\u9a71\u52a8IO\u662f\u4e0e\u5185\u6838\u5efa\u7acbSIGIO\u7684\u4fe1\u53f7\u5173\u8054\u5e76\u8bbe\u7f6e\u56de\u8c03\uff0c\u5f53\u5185\u6838\u6709FD\u5c31\u7eea\u65f6\uff0c\u4f1a\u53d1\u51faSIGIO\u4fe1\u53f7\u901a\u77e5\u7528\u6237\uff0c\u671f\u95f4\u7528\u6237\u5e94\u7528\u53ef\u4ee5\u6267\u884c\u5176\u5b83\u4e1a\u52a1\uff0c\u65e0\u9700\u963b\u585e\u7b49\u5f85\u3002</p> <p></p> <p>\u4e0d\u8db3\uff1a</p> <p>\u200b   \u5f53\u6709\u5927\u91cfIO\u64cd\u4f5c\u65f6\uff0c\u4fe1\u53f7\u8f83\u591a\uff0cSIGIO\u5904\u7406\u51fd\u6570\u4e0d\u80fd\u53ca\u65f6\u5904\u7406\u53ef\u80fd\u5bfc\u81f4\u4fe1\u53f7\u961f\u5217\u6ea2\u51fa\uff0c\u800c\u4e14\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u9891\u7e41\u4fe1\u53f7\u4ea4\u4e92\u6027\u80fd\u4e5f\u8f83\u4f4e\u3002</p>"},{"location":"Redis/Redis/#\u5f02\u6b65io","title":"\u5f02\u6b65IO","text":"<p>\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4e0d\u4ec5\u4ec5\u662f\u7528\u6237\u6001\u5728\u8bd5\u56fe\u8bfb\u53d6\u6570\u636e\u540e\uff0c\u4e0d\u963b\u585e\uff0c\u800c\u4e14\u5f53\u5185\u6838\u7684\u6570\u636e\u51c6\u5907\u5b8c\u6210\u540e\uff0c\u4e5f\u4e0d\u4f1a\u963b\u585e</p> <p>\u7531\u5185\u6838\u5c06\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u6210\uff0c\u5e76\u7531\u5185\u6838\u5c06\u6570\u636e\u5199\u5165\u5230\u7528\u6237\u6001\u4e2d\uff0c\u7136\u540e\u624d\u7b97\u5b8c\u6210\uff0c\u6240\u4ee5\u6027\u80fd\u6781\u9ad8\uff0c\u4e0d\u4f1a\u6709\u4efb\u4f55\u963b\u585e\uff0c\u5168\u90e8\u90fd\u7531\u5185\u6838\u5b8c\u6210\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5f02\u6b65IO\u6a21\u578b\u4e2d\uff0c\u7528\u6237\u8fdb\u7a0b\u5728\u4e24\u4e2a\u9636\u6bb5\u90fd\u662f\u975e\u963b\u585e\u72b6\u6001\u3002</p> <p></p>"},{"location":"Redis/Redis/#\u603b\u7ed3","title":"\u603b\u7ed3","text":""},{"location":"Redis/Redis/#redis\u7f51\u7edc\u6a21\u578b","title":"Redis\u7f51\u7edc\u6a21\u578b","text":"<p>[!IMPORTANT]</p> <p>Redis\u5230\u5e95\u662f\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b\uff1f</p> <ul> <li>\u5982\u679c\u4ec5\u4ec5\u662fRedis\u7684\u6838\u5fc3\u4e1a\u52a1\u90e8\u5206\uff08\u547d\u4ee4\u5904\u7406\uff09\uff0c\u7b54\u6848\u662f\u5355\u7ebf\u7a0b</li> <li>\u5982\u679c\u662f\u6574\u4e2aRedis\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u591a\u7ebf\u7a0b</li> </ul> <p>\u4e3a\u4ec0\u4e48Redis\u8981\u9009\u62e9\u5355\u7ebf\u7a0b\uff1f</p> <ul> <li>\u629b\u5f00\u6301\u4e45\u5316\u4e0d\u8c08\uff0cRedis\u662f\u7eaf\u5185\u5b58\u64cd\u4f5c\uff0c\u6267\u884c\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5b83\u7684\u6027\u80fd\u74f6\u9888\u662f\u7f51\u7edc\u5ef6\u8fdf\u800c\u4e0d\u662f\u6267\u884c\u901f\u5ea6\uff0c\u56e0\u6b64\u591a\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u5e26\u6765\u5de8\u5927\u7684\u6027\u80fd\u63d0\u5347\u3002</li> <li>\u591a\u7ebf\u7a0b\u4f1a\u5bfc\u81f4\u8fc7\u591a\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u5f00\u9500</li> <li>\u5f15\u5165\u591a\u7ebf\u7a0b\u4f1a\u9762\u4e34\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u5fc5\u7136\u8981\u5f15\u5165\u7ebf\u7a0b\u9501\u8fd9\u6837\u7684\u5b89\u5168\u624b\u6bb5\uff0c\u5b9e\u73b0\u590d\u6742\u5ea6\u589e\u9ad8\uff0c\u800c\u4e14\u6027\u80fd\u4e5f\u4f1a\u5927\u6253\u6298\u6263</li> </ul> <p></p> <p>\u4f18\u5316\uff0c\u5c06\u547d\u4ee4\u56de\u590d\u5904\u7406\u548c\u8bfb\u53d6\u5e76\u89e3\u6790Redis\u547d\u4ee4\u6539\u4e3a\u591a\u7ebf\u7a0b\u64cd\u4f5c</p> <p>\u5f53\u6211\u4eec\u7684\u5ba2\u6237\u7aef\u60f3\u8981\u53bb\u8fde\u63a5\u6211\u4eec\u670d\u52a1\u5668\uff0c\u4f1a\u53bb\u5148\u5230IO\u591a\u8def\u590d\u7528\u6a21\u578b\u53bb\u8fdb\u884c\u6392\u961f\uff0c\u4f1a\u6709\u4e00\u4e2a\u8fde\u63a5\u5e94\u7b54\u5904\u7406\u5668\uff0c\u4ed6\u4f1a\u53bb\u63a5\u53d7\u8bfb\u8bf7\u6c42\uff0c\u7136\u540e\u628a\u8bfb\u8bf7\u6c42\u6ce8\u518c\u5230\u5177\u4f53\u6a21\u578b\u4e2d\u53bb\uff0c\u6b64\u65f6\u8fd9\u4e9b\u5efa\u7acb\u8d77\u6765\u7684\u8fde\u63a5\uff0c\u5982\u679c\u662f\u5ba2\u6237\u7aef\u8bf7\u6c42\u5904\u7406\u5668\u53bb\u8fdb\u884c\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u4ed6\u4f1a\u53bb\u628a\u6570\u636e\u8bfb\u53d6\u51fa\u6765\uff0c\u7136\u540e\u628a\u6570\u636e\u653e\u5165\u5230client\u4e2d\uff0c client\u53bb\u89e3\u6790\u5f53\u524d\u7684\u547d\u4ee4\u8f6c\u5316\u4e3aredis\u8ba4\u8bc6\u7684\u547d\u4ee4\uff0c\u63a5\u4e0b\u6765\u5c31\u5f00\u59cb\u5904\u7406\u8fd9\u4e9b\u547d\u4ee4\uff0c\u4eceredis\u4e2d\u7684command\u4e2d\u627e\u5230\u8fd9\u4e9b\u547d\u4ee4\uff0c\u7136\u540e\u5c31\u771f\u6b63\u7684\u53bb\u64cd\u4f5c\u5bf9\u5e94\u7684\u6570\u636e\u4e86\uff0c\u5f53\u6570\u636e\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u4f1a\u53bb\u627e\u5230\u547d\u4ee4\u56de\u590d\u5904\u7406\u5668\uff0c\u7531\u5176\u5c06\u6570\u636e\u5199\u51fa\u3002</p>"},{"location":"Redis/Redis/#\u901a\u4fe1\u534f\u8bae-resp","title":"\u901a\u4fe1\u534f\u8bae-RESP","text":"<p>Redis\u662f\u4e00\u4e2aCS\u67b6\u6784\u7684\u8f6f\u4ef6\uff0c\u901a\u4fe1\u4e00\u822c\u5206\u4e24\u6b65\uff08\u4e0d\u5305\u62ecpipeline\u548cPubSub\uff09\uff1a</p> <ol> <li> <p>\u5ba2\u6237\u7aef\uff08client\uff09\u5411\u670d\u52a1\u7aef\uff08server\uff09\u53d1\u9001\u4e00\u6761\u547d\u4ee4</p> </li> <li> <p>\u670d\u52a1\u7aef\u89e3\u6790\u5e76\u6267\u884c\u547d\u4ee4\uff0c\u8fd4\u56de\u54cd\u5e94\u7ed3\u679c\u7ed9\u5ba2\u6237\u7aef</p> </li> </ol> <p>\u56e0\u6b64\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u7684\u683c\u5f0f\u3001\u670d\u52a1\u7aef\u54cd\u5e94\u7ed3\u679c\u7684\u683c\u5f0f\u5fc5\u987b\u6709\u4e00\u4e2a\u89c4\u8303\uff0c\u8fd9\u4e2a\u89c4\u8303\u5c31\u662f\u901a\u4fe1\u534f\u8bae\u3002</p> <p>\u800c\u5728Redis\u4e2d\u91c7\u7528\u7684\u662fRESP\uff08Redis Serialization Protocol\uff09\u534f\u8bae</p> <p>[!TIP]</p> <p>Redis 1.2\u7248\u672c\u5f15\u5165\u4e86RESP\u534f\u8bae</p> <p>Redis 2.0\u7248\u672c\u4e2d\u6210\u4e3a\u4e0eRedis\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u6807\u51c6\uff0c\u79f0\u4e3aRESP2</p> <p>Redis 6.0\u7248\u672c\u4e2d\uff0c\u4eceRESP2\u5347\u7ea7\u5230\u4e86RESP3\u534f\u8bae\uff0c\u589e\u52a0\u4e86\u66f4\u591a\u6570\u636e\u7c7b\u578b\u5e76\u4e14\u652f\u63016.0\u7684\u65b0\u7279\u6027--\u5ba2\u6237\u7aef\u7f13\u5b58</p> <p>\u4f46\u76ee\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u4f9d\u7136\u662fRESP2\u534f\u8bae\uff0c\u4e5f\u662f\u6211\u4eec\u8981\u5b66\u4e60\u7684\u534f\u8bae\u7248\u672c\uff08\u4ee5\u4e0b\u7b80\u79f0RESP\uff09\u3002</p> <p>\u5728RESP\u4e2d\uff0c\u901a\u8fc7\u9996\u5b57\u8282\u7684\u5b57\u7b26\u6765\u533a\u5206\u4e0d\u540c\u6570\u636e\u7c7b\u578b\uff0c\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\u5305\u62ec5\u79cd\uff1a</p> <ul> <li> <p>\u5355\u884c\u5b57\u7b26\u4e32\uff1a\u9996\u5b57\u8282\u662f \u2018+\u2019 \uff0c\u540e\u9762\u8ddf\u4e0a\u5355\u884c\u5b57\u7b26\u4e32\uff0c\u4ee5CRLF\uff08 \"\\r\\n\" \uff09\u7ed3\u5c3e\u3002\u4f8b\u5982\u8fd4\u56de\"OK\"\uff1a \"+OK\\r\\n\"</p> </li> <li> <p>\u9519\u8bef\uff08Errors\uff09\uff1a\u9996\u5b57\u8282\u662f \u2018-\u2019 \uff0c\u4e0e\u5355\u884c\u5b57\u7b26\u4e32\u683c\u5f0f\u4e00\u6837\uff0c\u53ea\u662f\u5b57\u7b26\u4e32\u662f\u5f02\u5e38\u4fe1\u606f\uff0c\u4f8b\u5982\uff1a\"-Error message\\r\\n\"</p> </li> <li> <p>\u6570\u503c\uff1a\u9996\u5b57\u8282\u662f \u2018:\u2019 \uff0c\u540e\u9762\u8ddf\u4e0a\u6570\u5b57\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5CRLF\u7ed3\u5c3e\u3002\u4f8b\u5982\uff1a\":10\\r\\n\"</p> </li> <li> <p>\u591a\u884c\u5b57\u7b26\u4e32\uff1a\u9996\u5b57\u8282\u662f \u2018$\u2019 \uff0c\u8868\u793a\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\uff0c\u6700\u5927\u652f\u6301512MB\uff1a</p> </li> <li> <p>\u5982\u679c\u5927\u5c0f\u4e3a0\uff0c\u5219\u4ee3\u8868\u7a7a\u5b57\u7b26\u4e32\uff1a\"$0\\r\\n\\r\\n\"</p> </li> <li> <p>\u5982\u679c\u5927\u5c0f\u4e3a-1\uff0c\u5219\u4ee3\u8868\u4e0d\u5b58\u5728\uff1a\"$-1\\r\\n\"</p> </li> <li> <p>\u6570\u7ec4\uff1a\u9996\u5b57\u8282\u662f \u2018*\u2019\uff0c\u540e\u9762\u8ddf\u4e0a\u6570\u7ec4\u5143\u7d20\u4e2a\u6570\uff0c\u518d\u8ddf\u4e0a\u5143\u7d20\uff0c\u5143\u7d20\u6570\u636e\u7c7b\u578b\u4e0d\u9650:</p> </li> </ul> <p></p>"},{"location":"Redis/Redis/#\u5185\u5b58\u7b56\u7565","title":"\u5185\u5b58\u7b56\u7565","text":"<p>Redis\u4e4b\u6240\u4ee5\u6027\u80fd\u5f3a\uff0c\u6700\u4e3b\u8981\u7684\u539f\u56e0\u5c31\u662f\u57fa\u4e8e\u5185\u5b58\u5b58\u50a8\u3002\u7136\u800c\u5355\u8282\u70b9\u7684Redis\u5176\u5185\u5b58\u5927\u5c0f\u4e0d\u5b9c\u8fc7\u5927\uff0c\u4f1a\u5f71\u54cd\u6301\u4e45\u5316\u6216\u4e3b\u4ece\u540c\u6b65\u6027\u80fd\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539redis.conf\u6587\u4ef6\uff0c\u6dfb\u52a0\u4e0b\u9762\u7684\u914d\u7f6e\u6765\u914d\u7f6eRedis\u7684\u6700\u5927\u5185\u5b58\uff1a</p> <pre><code>maxmemory 1gb\n</code></pre> <p>\u5f53\u5185\u5b58\u8fbe\u5230\u4e0a\u9650\uff0c\u5c31\u65e0\u6cd5\u5b58\u50a8\u66f4\u591a\u6570\u636e\u4e86\u3002\u56e0\u6b64\uff0cRedis\u5185\u90e8\u4f1a\u6709\u4e24\u5957\u5185\u5b58\u56de\u6536\u7684\u7b56\u7565\uff1a</p> <ul> <li>\u5185\u5b58\u8fc7\u671f\u7b56\u7565</li> <li>\u5185\u5b58\u6dd8\u6c70\u7b56\u7565</li> </ul>"},{"location":"Redis/Redis/#\u5185\u5b58\u8fc7\u671f","title":"\u5185\u5b58\u8fc7\u671f","text":"<p>Redis\u4e0d\u7ba1\u6709\u591a\u5c11\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u672c\u8d28\u662f\u4e00\u4e2a<code>KEY-VALUE</code>\u7684\u952e\u503c\u578b\u6570\u636e\u5e93\uff0c\u800c\u8fd9\u79cd\u952e\u503c\u6620\u5c04\u5e95\u5c42\u6b63\u5f0f\u57fa\u4e8eHashTable\u6765\u5b9e\u73b0\u7684\uff0c\u5728Redis\u4e2d\u53eb\u505aDict.</p> <p>\u6765\u770b\u4e0bRedisDB\u7684\u5e95\u5c42\u6e90\u7801\uff1a</p> <pre><code>typedef struct redisDb {\n    dict dict;                 / The keyspace for this DB , \u4e5f\u5c31\u662f\u5b58\u653eKEY\u548cVALUE\u7684\u54c8\u5e0c\u8868*/\n    dict *expires;              /* \u540c\u6837\u662f\u54c8\u5e0c\u8868\uff0c\u4f46\u4fdd\u5b58\u7684\u662f\u8bbe\u7f6e\u4e86TTL\u7684KEY\uff0c\u53ca\u5176\u5230\u671f\u65f6\u95f4*/\n    dict *blocking_keys;        /* Keys with clients waiting for data (BLPOP)*/\n    dict *ready_keys;           /* Blocked keys that received a PUSH */\n    dict *watched_keys;         /* WATCHED keys for MULTI/EXEC CAS /\n    int id;                     / Database ID, 0 ~ 15 /\n    long long avg_ttl;          / Average TTL, just for stats /\n    unsigned long expires_cursor; / Cursor of the active expire cycle. */\n    list *defrag_later;         /* List of key names to attempt to defrag one by one, gradually. */\n} redisDb;\n</code></pre> <ul> <li> \u9762\u8bd5\u9898\uff1aRedis\u5982\u4f55\u5224\u65adKEY\u662f\u5426\u8fc7\u671f\u5462\uff1f</li> </ul> <p>\u7b54\uff1a\u5728Redis\u4e2d\u4f1a\u6709\u4e24\u4e2aDict\uff0c\u4e5f\u5c31\u662fHashTable\uff0c\u5176\u4e2d\u4e00\u4e2a\u8bb0\u5f55KEY-VALUE\u952e\u503c\u5bf9\uff0c\u53e6\u4e00\u4e2a\u8bb0\u5f55KEY\u548c\u8fc7\u671f\u65f6\u95f4\u3002\u8981\u5224\u65ad\u4e00\u4e2aKEY\u662f\u5426\u8fc7\u671f\uff0c\u53ea\u9700\u8981\u5230\u8bb0\u5f55\u8fc7\u671f\u65f6\u95f4\u7684Dict\u4e2d\u6839\u636eKEY\u67e5\u8be2\u5373\u53ef\u3002</p> <p>Redis\u5e76\u4e0d\u4f1a\u5728KEY\u8fc7\u671f\u65f6\u7acb\u523b\u5220\u9664KEY\uff0c\u56e0\u4e3a\u8981\u5b9e\u73b0\u8fd9\u6837\u7684\u6548\u679c\u5c31\u5fc5\u987b\u7ed9\u6bcf\u4e00\u4e2a\u8fc7\u671f\u7684KEY\u8bbe\u7f6e\u65f6\u949f\uff0c\u5e76\u76d1\u63a7\u8fd9\u4e9bKEY\u7684\u8fc7\u671f\u72b6\u6001\u3002\u65e0\u8bba\u5bf9CPU\u8fd8\u662f\u5185\u5b58\u90fd\u4f1a\u5e26\u6765\u6781\u5927\u7684\u8d1f\u62c5\u3002</p> <p>Redis\u7684\u8fc7\u671fKEY\u5220\u9664\u7b56\u7565\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u60f0\u6027\u5220\u9664</li> <li>\u5468\u671f\u5220\u9664</li> </ul>"},{"location":"Redis/Redis/#\u60f0\u6027\u5220\u9664","title":"\u60f0\u6027\u5220\u9664","text":"<p>Redis\u4f1a\u5728\u6bcf\u6b21\u8bbf\u95eeKEY\u7684\u65f6\u5019\u5224\u65ad\u5f53\u524dKEY\u6709\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5982\u679c\u6709\uff0c\u8fc7\u671f\u65f6\u95f4\u662f\u5426\u5df2\u7ecf\u5230\u671f\u3002</p>"},{"location":"Redis/Redis/#\u5468\u671f\u5220\u9664","title":"\u5468\u671f\u5220\u9664","text":"<p>\u901a\u8fc7\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u5468\u671f\u6027\u7684\u62bd\u6837\u90e8\u5206\u8fc7\u671f\u7684key\uff0c\u7136\u540e\u6267\u884c\u5220\u9664\u3002</p> <p>\u6267\u884c\u5468\u671f\u6709\u4e24\u79cd\uff1a</p> <ul> <li>SLOW\u6a21\u5f0f\uff1aRedis\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1<code>serverCron()</code>\uff0c\u6309\u7167<code>server.hz</code>\u7684\u9891\u7387\u6765\u6267\u884c\u8fc7\u671fkey\u6e05\u7406</li> <li>FAST\u6a21\u5f0f\uff1aRedis\u7684\u6bcf\u4e2a\u4e8b\u4ef6\u5faa\u73af\u524d\u6267\u884c\u8fc7\u671fkey\u6e05\u7406\uff08\u4e8b\u4ef6\u5faa\u73af\u5c31\u662fNIO\u4e8b\u4ef6\u5904\u7406\u7684\u5faa\u73af\uff09\u3002</li> </ul> <p>SLOW\u6a21\u5f0f\u89c4\u5219\uff1a</p> <ul> <li>\u2460 \u6267\u884c\u9891\u7387\u53d7<code>server.hz</code>\u5f71\u54cd\uff0c\u9ed8\u8ba4\u4e3a10\uff0c\u5373\u6bcf\u79d2\u6267\u884c10\u6b21\uff0c\u6bcf\u4e2a\u6267\u884c\u5468\u671f100ms\u3002</li> <li>\u2461 \u6267\u884c\u6e05\u7406\u8017\u65f6\u4e0d\u8d85\u8fc7\u4e00\u6b21\u6267\u884c\u5468\u671f\u768425%\uff0c\u537325ms.</li> <li>\u2462 \u9010\u4e2a\u904d\u5386db\uff0c\u9010\u4e2a\u904d\u5386db\u4e2d\u7684bucket\uff0c\u62bd\u53d620\u4e2akey\u5224\u65ad\u662f\u5426\u8fc7\u671f</li> <li>\u2463 \u5982\u679c\u6ca1\u8fbe\u5230\u65f6\u95f4\u4e0a\u9650\uff0825ms\uff09\u5e76\u4e14\u8fc7\u671fkey\u6bd4\u4f8b\u5927\u4e8e10%\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u62bd\u6837\uff0c\u5426\u5219\u7ed3\u675f</li> </ul> <p>FAST\u6a21\u5f0f\u89c4\u5219\uff08\u8fc7\u671fkey\u6bd4\u4f8b\u5c0f\u4e8e10%\u4e0d\u6267\u884c\uff09\uff1a</p> <ul> <li>\u2460 \u6267\u884c\u9891\u7387\u53d7<code>beforeSleep()</code>\u8c03\u7528\u9891\u7387\u5f71\u54cd\uff0c\u4f46\u4e24\u6b21FAST\u6a21\u5f0f\u95f4\u9694\u4e0d\u4f4e\u4e8e2ms</li> <li>\u2461 \u6267\u884c\u6e05\u7406\u8017\u65f6\u4e0d\u8d85\u8fc71ms</li> <li>\u2462 \u9010\u4e2a\u904d\u5386db\uff0c\u9010\u4e2a\u904d\u5386db\u4e2d\u7684bucket\uff0c\u62bd\u53d620\u4e2akey\u5224\u65ad\u662f\u5426\u8fc7\u671f</li> <li>\u2463 \u5982\u679c\u6ca1\u8fbe\u5230\u65f6\u95f4\u4e0a\u9650\uff081ms\uff09\u5e76\u4e14\u8fc7\u671fkey\u6bd4\u4f8b\u5927\u4e8e10%\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u62bd\u6837\uff0c\u5426\u5219\u7ed3\u675f</li> </ul>"},{"location":"Redis/Redis/#\u5185\u5b58\u6dd8\u6c70","title":"\u5185\u5b58\u6dd8\u6c70","text":"<p>\u5bf9\u4e8e\u67d0\u4e9b\u7279\u522b\u4f9d\u8d56\u4e8eRedis\u7684\u9879\u76ee\u800c\u8a00\uff0c\u4ec5\u4ec5\u4f9d\u9760\u8fc7\u671fKEY\u6e05\u7406\u662f\u4e0d\u591f\u7684\uff0c\u5185\u5b58\u53ef\u80fd\u5f88\u5feb\u5c31\u8fbe\u5230\u4e0a\u9650\u3002\u56e0\u6b64Redis\u5141\u8bb8\u8bbe\u7f6e\u5185\u5b58\u544a\u8b66\u9608\u503c\uff0c\u5f53\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u9608\u503c\u65f6\u5c31\u4f1a\u4e3b\u52a8\u6311\u9009\u90e8\u5206KEY\u5220\u9664\u4ee5\u91ca\u653e\u66f4\u591a\u5185\u5b58\u3002\u8fd9\u53eb\u505a\u5185\u5b58\u6dd8\u6c70\u673a\u5236\u3002</p> <p>Redis\u6bcf\u6b21\u6267\u884c\u4efb\u4f55\u547d\u4ee4\u65f6\uff0c\u90fd\u4f1a\u5224\u65ad\u5185\u5b58\u662f\u5426\u8fbe\u5230\u9608\u503c</p> <p>Redis\u652f\u63018\u79cd\u4e0d\u540c\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff1a</p> <ul> <li><code>noeviction</code>\uff1a \u4e0d\u6dd8\u6c70\u4efb\u4f55key\uff0c\u4f46\u662f\u5185\u5b58\u6ee1\u65f6\u4e0d\u5141\u8bb8\u5199\u5165\u65b0\u6570\u636e\uff0c\u9ed8\u8ba4\u5c31\u662f\u8fd9\u79cd\u7b56\u7565\u3002</li> <li><code>volatile-ttl</code>\uff1a \u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u6bd4\u8f83key\u7684\u5269\u4f59TTL\u503c\uff0cTTL\u8d8a\u5c0f\u8d8a\u5148\u88ab\u6dd8\u6c70</li> <li><code>allkeys-random</code>\uff1a\u5bf9\u5168\u4f53key \uff0c\u968f\u673a\u8fdb\u884c\u6dd8\u6c70\u3002\u4e5f\u5c31\u662f\u76f4\u63a5\u4ecedb-&gt;dict\u4e2d\u968f\u673a\u6311\u9009</li> <li><code>volatile-random</code>\uff1a\u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key \uff0c\u968f\u673a\u8fdb\u884c\u6dd8\u6c70\u3002\u4e5f\u5c31\u662f\u4ecedb-&gt;expires\u4e2d\u968f\u673a\u6311\u9009\u3002</li> <li><code>allkeys-lru</code>\uff1a \u5bf9\u5168\u4f53key\uff0c\u57fa\u4e8eLRU\u7b97\u6cd5\u8fdb\u884c\u6dd8\u6c70</li> <li><code>volatile-lru</code>\uff1a \u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u57fa\u4e8eLRU\u7b97\u6cd5\u8fdb\u884c\u6dd8\u6c70</li> <li><code>allkeys-lfu</code>\uff1a \u5bf9\u5168\u4f53key\uff0c\u57fa\u4e8eLFU\u7b97\u6cd5\u8fdb\u884c\u6dd8\u6c70</li> <li> <p><code>volatile-lfu</code>\uff1a \u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u57fa\u4e8eLFU\u7b97\u6cd5\u8fdb\u884c\u6dd8\u6c70\uff08\u63a8\u8350\uff09</p> </li> <li> <p> LRU\uff08<code>L</code><code>east</code><code>R</code><code>ecently</code><code>U</code><code>sed</code>\uff09\uff0c\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u3002\u7528\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u8fd9\u4e2a\u503c\u8d8a\u5927\u5219\u6dd8\u6c70\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002</p> </li> <li> <p> LFU\uff08<code>L</code><code>east</code><code>F</code><code>requently</code><code>U</code><code>sed</code>\uff09\uff0c\u6700\u5c11\u9891\u7387\u4f7f\u7528\u3002\u4f1a\u7edf\u8ba1\u6bcf\u4e2akey\u7684\u8bbf\u95ee\u9891\u7387\uff0c\u503c\u8d8a\u5c0f\u6dd8\u6c70\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002</p> </li> </ul> <p></p> <p>\u5176\u4e2d\u7684<code>lru</code>\u5c31\u662f\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u548c\u8bbf\u95ee\u9891\u7387\u7684\u3002\u9009\u62e9<code>LRU</code>\u548c<code>LFU</code>\u65f6\u7684\u8bb0\u5f55\u65b9\u5f0f\u4e0d\u540c\uff1a</p> <ul> <li>LRU\uff1a\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u957f\u5ea624bit</li> <li>LFU\uff1a\u9ad816\u4f4d\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u4f4e8\u4f4d\u8bb0\u5f55\u903b\u8f91\u8bbf\u95ee\u6b21\u6570</li> </ul> <p>\u903b\u8f91\u8bbf\u95ee\u6b21\u6570</p> <ul> <li>\u2460 \u751f\u6210<code>[0,1)</code>\u4e4b\u95f4\u7684\u968f\u673a\u6570<code>R</code></li> <li>\u2461 \u8ba1\u7b97 <code>1/(\u65e7\u6b21\u6570 * lfu_log_factor + 1)</code>\uff0c\u8bb0\u5f55\u4e3a<code>P</code>\uff0c <code>lfu_log_factor</code>\u9ed8\u8ba4\u4e3a10</li> <li>\u2462 \u5982\u679c <code>R</code> &lt; <code>P</code>\uff0c\u5219\u8ba1\u6570\u5668 <code>+1</code>\uff0c\u4e14\u6700\u5927\u4e0d\u8d85\u8fc7255</li> <li>\u2463 \u8bbf\u95ee\u6b21\u6570\u4f1a\u968f\u65f6\u95f4\u8870\u51cf\uff0c\u8ddd\u79bb\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u6bcf\u9694 <code>lfu_decay_time</code> \u5206\u949f(\u9ed8\u8ba41) \uff0c\u8ba1\u6570\u5668<code>-1</code></li> </ul> <p>\u663e\u7136LFU\u7684\u57fa\u4e8e\u8bbf\u95ee\u9891\u7387\u7684\u7edf\u8ba1\u66f4\u7b26\u5408\u6211\u4eec\u7684\u6dd8\u6c70\u76ee\u6807\uff0c\u56e0\u6b64\u5b98\u65b9\u63a8\u8350\u4f7f\u7528LFU\u7b97\u6cd5\u3002</p>"},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/","title":"Redis\u5ba2\u6237\u7aef","text":""},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/#java\u5ba2\u6237\u7aef","title":"Java\u5ba2\u6237\u7aef","text":"<p>\u5728Redis\u63d0\u4f9b\u4e86\u5404\u79cd\u8bed\u8a00\u7684\u5ba2\u6237\u7aef</p> <p></p>"},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/#jedis","title":"Jedis","text":"<p>1.\u5f15\u5165\u4f9d\u8d56</p> <p>2.\u521b\u5efaJedis\u5bf9\u8c61\uff0c\u5efa\u7acb\u8fde\u63a5</p> <p>3.\u4f7f\u7528Jedis\uff0c\u65b9\u6cd5\u540d\u4e0eRedis\u547d\u4ee4\u4e00\u81f4</p> <p>4.\u91ca\u653e\u8d44\u6e90</p> <p></p> <p>\u5bfc\u5165\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;redis.clients&lt;/groupId&gt;\n    &lt;artifactId&gt;jedis&lt;/artifactId&gt;\n    &lt;version&gt;x.x.x&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u4f7f\u7528\u5ba2\u6237\u7aef</p> <pre><code>public void setUp() {\n    // \u5efa\u7acb\u8fde\u63a5\n    Jedis jedis = new Jedis(\"localhost\", 6379);\n    // \u9a8c\u8bc1\u5bc6\u7801\n    jedis.auth(\"123456\");\n    // \u9009\u62e9\u6570\u636e\u5e93\n    jedis.select(0);\n}\n\npublic void tearDown() {\n    // \u5173\u95ed\u8fde\u63a5\n    if (jedis != null) {\n        jedis.close();\n    }\n}\n\nvoid testString() {\n    jedis.set(\"ysh\",\"666\");\n\n    String ysh = jedis.get(\"ysh\");\n}\n</code></pre> <p>Note</p> <p>Jedis\u7684API\u4e0eRedis\u5b98\u65b9\u6307\u4ee4\u4e00\u81f4</p> <p>Jedis\u8fde\u63a5\u6c60</p> <p>Jedis\u672c\u8eab\u662f\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\uff0c\u5e76\u4e14\u9891\u7e41\u7684\u521b\u5efa\u548c\u9500\u6bc1\u8fde\u63a5\u4f1a\u6709\u6027\u80fd\u635f\u8017\uff0c\u56e0\u6b64\u63a8\u8350\u4f7f\u7528Jedis\u8fde\u63a5\u6c60\u4ee3\u66ffJedis\u7684\u76f4\u8fde\u65b9\u5f0f\u3002</p> <pre><code>public class JedisPoolConnection {\n    // \u58f0\u660e\u4e00\u4e2a\u9759\u6001\u7684JedisPool\u5bf9\u8c61\uff0c\u7528\u4e8e\u7ba1\u7406Jedis\u8fde\u63a5\u6c60\n    private static final JedisPool jedisPool;\n\n    // \u9759\u6001\u4ee3\u7801\u5757\uff0c\u5728\u7c7b\u52a0\u8f7d\u65f6\u6267\u884c\uff0c\u7528\u4e8e\u521d\u59cb\u5316Jedis\u8fde\u63a5\u6c60\n    static {\n        // \u521b\u5efaJedisPoolConfig\u5bf9\u8c61\uff0c\u7528\u4e8e\u914d\u7f6e\u8fde\u63a5\u6c60\u53c2\u6570\n        JedisPoolConfig config = new JedisPoolConfig();\n        // \u8bbe\u7f6e\u8fde\u63a5\u6c60\u4e2d\u6700\u591a\u53ef\u4ee5\u5b58\u5728\u7684\u8fde\u63a5\u6570\n        config.setMaxTotal(10);\n        // \u8bbe\u7f6e\u8fde\u63a5\u6c60\u4e2d\u6700\u591a\u53ef\u4ee5\u5b58\u5728\u7684\u7a7a\u95f2\u8fde\u63a5\u6570\n        config.setMaxIdle(10);\n        // \u8bbe\u7f6e\u8fde\u63a5\u6c60\u4e2d\u6700\u5c11\u53ef\u4ee5\u5b58\u5728\u7684\u7a7a\u95f2\u8fde\u63a5\u6570\n        config.setMinIdle(5);\n        // \u8bbe\u7f6e\u8fde\u63a5\u6c60\u4e2d\u5f53\u8fde\u63a5\u6570\u8fbe\u5230\u6700\u5927\u503c\u65f6\uff0c\u83b7\u53d6\u8fde\u63a5\u7684\u6700\u957f\u7b49\u5f85\u65f6\u95f4\n        config.setMaxWait(Duration.ofMillis(10000));\n\n        // \u521b\u5efaJedisPool\u5bf9\u8c61\uff0c\u4f20\u5165\u914d\u7f6e\u4fe1\u606f\u3001Redis\u670d\u52a1\u5668\u5730\u5740\u3001\u7aef\u53e3\u3001\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u548c\u5bc6\u7801\n        jedisPool = new JedisPool(config,\n                \"localhost\", 6379, 2000, \"123456\");\n    }\n\n    // \u63d0\u4f9b\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5\uff0c\u7528\u4e8e\u83b7\u53d6Jedis\u8fde\u63a5\n    public static Jedis getConnection() {\n        // \u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u4e00\u4e2aJedis\u5b9e\u4f8b\n        return jedisPool.getResource();\n    }\n}\n</code></pre>"},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/#springdataredis","title":"SpringDataRedis","text":"<p>SpringData\u662fSpring\u4e2d\u6570\u636e\u64cd\u4f5c\u7684\u6a21\u5757\uff0c\u5305\u542b\u5bf9\u5404\u79cd\u6570\u636e\u5e93\u7684\u96c6\u6210\uff0c\u5176\u4e2d\u5bf9Redis\u7684\u96c6\u6210\u6a21\u5757\u5c31\u53eb\u505aSpringDataRedis</p> <ul> <li>\u63d0\u4f9b\u4e86\u5bf9\u4e0d\u540cRedis\u5ba2\u6237\u7aef\u7684\u6574\u5408\uff08Lettuce\u548cJedis\uff09</li> <li>\u63d0\u4f9b\u4e86RedisTemplate\u7edf\u4e00API\u6765\u64cd\u4f5cRedis</li> <li>\u652f\u6301Redis\u7684\u53d1\u5e03\u8ba2\u9605\u6a21\u578b</li> <li>\u652f\u6301Redis\u54e8\u5175\u548cRedis\u96c6\u7fa4</li> <li>\u652f\u6301\u57fa\u4e8eLettuce\u7684\u54cd\u5e94\u5f0f\u7f16\u7a0b</li> <li>\u652f\u6301\u57fa\u4e8eJDK\u3001JSON\u3001\u5b57\u7b26\u4e32\u3001Spring\u5bf9\u8c61\u7684\u6570\u636e\u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316</li> <li>\u652f\u6301\u57fa\u4e8eRedis\u7684JDKCollection\u5b9e\u73b0</li> </ul> <p></p> <p>1.\u5f15\u5165\u4f9d\u8d56</p> <pre><code>&lt;!-- redis --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;!-- commons-pool2 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>Warning</p> <p>\u6ce8\u610f<code>commons-pool2</code>\u7248\u672c\u7684\u517c\u5bb9\u6027\u95ee\u9898</p> <p>2.\u7f16\u5199\u914d\u7f6e\u6587\u4ef6</p> <pre><code>spring:\n  data:\n    redis:\n      host: localhost\n      port: 6379\n      password: 123456\n      lettuce:\n        pool:\n          enabled: true\n          max-active: 8\n          max-idle: 8\n          min-idle: 0\n          max-wait: 1000ms\n      database: 0\n</code></pre> <p>Warning</p> <p>SpringBoot2.x  \u914d\u7f6eredis\u7684\u914d\u7f6e\u9879\u4e3aspring.redis</p> <p>3.\u6ce8\u5165RedisTemplate\u4f7f\u7528</p> <pre><code>    @Autowired\n    private RedisTemplate&lt;String, String&gt; redisTemplate;\n\n    @Test\n    void contextLoads() {\n        redisTemplate.opsForValue().set(\"key\", \"value\");\n        Object key = redisTemplate.opsForValue().get(\"key\");\n        System.out.println(\"key = \" + key);\n    }\n</code></pre>"},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/#\u5e8f\u5217\u5316","title":"\u5e8f\u5217\u5316","text":"<p>RedisTemplate\u53ef\u4ee5\u63a5\u6536\u4efb\u610fObject\u4f5c\u4e3a\u503c\u5199\u5165Redis\uff0c\u53ea\u4e0d\u8fc7\u5199\u5165\u524d\u4f1a\u628aObject\u5e8f\u5217\u5316\u4e3a\u5b57\u8282\u5f62\u5f0f\uff0c\u9ed8\u8ba4\u662f\u91c7\u7528JDK\u5e8f\u5217\u5316</p> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u53ef\u8bfb\u6027\u5dee</li> <li>\u5185\u5b58\u5360\u7528\u8f83\u5927</li> </ul> <p>\u53ef\u4ee5\u81ea\u5b9a\u4e49RedisTemplate\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\uff1a</p> <pre><code>    @Bean\n    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {\n        // \u521b\u5efa RedisTemplate \u5bf9\u8c61\n        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();\n\n        // \u8bbe\u7f6e\u8fde\u63a5\u5de5\u5382\n        template.setConnectionFactory(factory);\n\n        // \u521b\u5efaJSON\u5e8f\u5217\u5316\u5668\n        GenericJackson2JsonRedisSerializer jackson2JsonRedisSerializer = new GenericJackson2JsonRedisSerializer();\n\n        // \u8bbe\u7f6ekey\u7684\u5e8f\u5217\u5316\u5668\u4e3aString\u5e8f\u5217\u5316\u5668\n        template.setKeySerializer(RedisSerializer.string());\n        template.setHashKeySerializer(RedisSerializer.string());\n\n        // \u8bbe\u7f6evalue\u7684\u5e8f\u5217\u5316\u5668\u4e3aJSON\u5e8f\u5217\u5316\u5668\n        template.setValueSerializer(jackson2JsonRedisSerializer);\n        template.setHashValueSerializer(jackson2JsonRedisSerializer);\n\n        return template;\n    }\n</code></pre> <p>Note</p> <p>\u9700\u8981\u5f15\u5165Jackson\u4f9d\u8d56</p>"},{"location":"Redis/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/#stringredistemplate","title":"StringRedisTemplate","text":"<p>\u5c3d\u7ba1JSON\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\u53ef\u4ee5\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\uff0c\u4f46\u4f9d\u7136\u5b58\u5728\u4e00\u4e9b\u95ee\u9898</p> <p></p> <p>\u4e3a\u4e86\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u77e5\u9053\u5bf9\u8c61\u7684\u7c7b\u578b\uff0cJSON\u5e8f\u5217\u5316\u5668\u4f1a\u5c06\u7c7b\u7684class\u7c7b\u578b\u5199\u5165json\u7ed3\u679c\u4e2d\uff0c\u5b58\u5165Redis\uff0c\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5185\u5b58\u5f00\u9500\u3002</p> <p>\u4e3a\u4e86\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u5e76\u4e0d\u4f1a\u4f7f\u7528JSON\u5e8f\u5217\u5316\u5668\u6765\u5904\u7406value\uff0c\u800c\u662f\u7edf\u4e00\u4f7f\u7528String\u5e8f\u5217\u5316\u5668\uff0c\u8981\u6c42\u53ea\u80fd\u5b58\u50a8String\u7c7b\u578b\u7684key\u548cvalue\u3002\u5f53\u9700\u8981\u5b58\u50a8Java\u5bf9\u8c61\u65f6\uff0c\u624b\u52a8\u5b8c\u6210\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002</p> <p></p> <p>Spring\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e00\u4e2aStringRedisTemplate\u7c7b\uff0c\u5b83\u7684key\u548cvalue\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\u9ed8\u8ba4\u5c31\u662fString\u65b9\u5f0f\u3002\u7701\u53bb\u4e86\u6211\u4eec\u81ea\u5b9a\u4e49RedisTemplate\u7684\u8fc7\u7a0b</p> <pre><code>    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n\n    private static final ObjectMapper mapper = new ObjectMapper();\n\n    @Test\n    void contextLoads() throws JsonProcessingException {\n        User user = new User(\"ysh\", 21);\n        String json = mapper.writeValueAsString(user);\n        stringRedisTemplate.opsForValue().set(\"user:1\", json);\n\n        String result = stringRedisTemplate.opsForValue().get(\"user:1\");\n        User user1 = mapper.readValue(result, User.class);\n        System.out.println(\"user1 = \" + user1);\n    }\n</code></pre> <p>Tip</p> <p>\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u5e8f\u5217\u5316\u5de5\u5177\u5982FastJson\u3001hutool</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/","title":"Redis\u5e94\u7528\u573a\u666f","text":""},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u77ed\u4fe1\u767b\u5f55","title":"\u77ed\u4fe1\u767b\u5f55","text":""},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#redis\u5b9e\u73b0\u7f13\u5b58","title":"Redis\u5b9e\u73b0\u7f13\u5b58","text":"<p>\u7f13\u5b58\u5c31\u662f\u6570\u636e\u4ea4\u6362\u7684\u7f13\u51b2\u533a\uff08\u79f0\u4f5cCache [ k\u00e6\u0283 ] \uff09\uff0c\u662f\u5b58\u8d2e\u6570\u636e\u7684\u4e34\u65f6\u5730\u65b9\uff0c\u4e00\u822c\u8bfb\u5199\u6027\u80fd\u8f83\u9ad8</p> <p>\u4f18\u52bf\uff1a</p> <ul> <li>\u964d\u4f4e\u670d\u52a1\u5668\u8d1f\u8f7d</li> <li>\u63d0\u9ad8\u54cd\u5e94\u901f\u5ea6</li> </ul> <p>\u52a3\u52bf\uff1a</p> <ul> <li>\u6570\u636e\u4e0d\u4e00\u81f4</li> <li>\u589e\u52a0\u7ef4\u62a4\u590d\u6742\u5ea6</li> </ul> <p></p> <p></p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u7f13\u5b58\u66f4\u65b0\u7b56\u7565","title":"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li><code>Cache Aside Pattern</code>\uff1a\u7531\u7f13\u5b58\u7684\u8c03\u7528\u8005\uff0c\u5728\u66f4\u65b0\u6570\u636e\u5e93\u7684\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\uff08\u63a8\u8350\uff09</li> <li><code>Read/Write Through Pattern</code>\uff1a\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u6574\u5408\u4e3a\u4e00\u4e2a\u670d\u52a1\uff0c\u7531\u670d\u52a1\u6765\u7ef4\u62a4\u4e00\u81f4\u6027\u3002\u8c03\u7528\u8005\u8c03\u7528\u8be5\u670d\u52a1\uff0c\u65e0\u9700\u5173\u5fc3\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\u3002</li> <li><code>Write Behind Caching Pattern</code>\uff1a\u8c03\u7528\u8005\u53ea\u64cd\u4f5c\u7f13\u5b58\uff0c\u7531\u5176\u5b83\u7ebf\u7a0b\u5f02\u6b65\u7684\u5c06\u7f13\u5b58\u6570\u636e\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\uff0c\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u3002</li> </ol> <p>\u64cd\u4f5c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u65f6\u6709\u4e09\u4e2a\u95ee\u9898\u9700\u8981\u8003\u8651\uff1a</p> <p>1.\u5220\u9664\u7f13\u5b58\u8fd8\u662f\u66f4\u65b0\u7f13\u5b58\uff1f</p> <ul> <li> <p>\u66f4\u65b0\u7f13\u5b58\uff1a\u6bcf\u6b21\u66f4\u65b0\u6570\u636e\u5e93\u90fd\u66f4\u65b0\u7f13\u5b58\uff0c\u65e0\u6548\u5199\u64cd\u4f5c\u8f83\u591a\u274c</p> </li> <li> <p>\u5220\u9664\u7f13\u5b58\uff1a\u66f4\u65b0\u6570\u636e\u5e93\u65f6\u8ba9\u7f13\u5b58\u5931\u6548\uff0c\u67e5\u8be2\u65f6\u518d\u66f4\u65b0\u7f13\u5b58\u2714</p> </li> </ul> <p>2.\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u7684\u540c\u65f6\u6210\u529f\u6216\u5931\u8d25\uff1f</p> <ul> <li> <p>\u5355\u4f53\u7cfb\u7edf\uff0c\u5c06\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u653e\u5728\u4e00\u4e2a\u4e8b\u52a1</p> </li> <li> <p>\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u5229\u7528TCC\u7b49\u5206\u5e03\u5f0f\u4e8b\u52a1\u65b9\u6848</p> </li> </ul> <p>3.\u5148\u64cd\u4f5c\u7f13\u5b58\u8fd8\u662f\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff1f</p> <ul> <li> <p>\u5148\u5199\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58</p> </li> <li> <p>\u8981\u786e\u4fdd\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u64cd\u4f5c\u7684\u539f\u5b50\u6027</p> </li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u7f13\u5b58\u7a7f\u900f","title":"\u7f13\u5b58\u7a7f\u900f","text":"<p>\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u4e0d\u5b58\u5728\uff0c\u8fd9\u6837\u7f13\u5b58\u6c38\u8fdc\u4e0d\u4f1a\u751f\u6548\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u90fd\u4f1a\u5230\u8fbe\u6570\u636e\u5e93\u3002</p> <p>\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li> <p>\u7f13\u5b58\u7a7a\u5bf9\u8c61</p> <ul> <li>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u7ef4\u62a4\u65b9\u4fbf</li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u989d\u5916\u7684\u5185\u5b58\u6d88\u8017</li> <li>\u53ef\u80fd\u9020\u6210\u77ed\u671f\u7684\u4e0d\u4e00\u81f4</li> </ul> </li> </ul> </li> <li> <p>\u5e03\u9686\u8fc7\u6ee4</p> <ul> <li>\u4f18\u70b9\uff1a\u5185\u5b58\u5360\u7528\u8f83\u5c11\uff0c\u6ca1\u6709\u591a\u4f59key</li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u5b9e\u73b0\u590d\u6742</li> <li>\u5b58\u5728\u8bef\u5224\u53ef\u80fd</li> </ul> </li> </ul> </li> </ul> <p></p> <p>\u53ef\u884c\u65b9\u6848\uff1a</p> <ul> <li>\u7f13\u5b58null\u503c</li> <li>\u5e03\u9686\u8fc7\u6ee4</li> <li>\u589e\u5f3aid\u7684\u590d\u6742\u5ea6\uff0c\u907f\u514d\u88ab\u731c\u6d4bid\u89c4\u5f8b</li> <li>\u505a\u597d\u6570\u636e\u7684\u57fa\u7840\u683c\u5f0f\u6821\u9a8c</li> <li>\u52a0\u5f3a\u7528\u6237\u6743\u9650\u6821\u9a8c</li> <li>\u505a\u597d\u70ed\u70b9\u53c2\u6570\u7684\u9650\u6d41</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u7f13\u5b58\u96ea\u5d29","title":"\u7f13\u5b58\u96ea\u5d29","text":"<p>\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5728\u540c\u4e00\u65f6\u6bb5\u5927\u91cf\u7684\u7f13\u5b58key\u540c\u65f6\u5931\u6548\u6216\u8005Redis\u670d\u52a1\u5b95\u673a\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u5230\u8fbe\u6570\u636e\u5e93\uff0c\u5e26\u6765\u5de8\u5927\u538b\u529b\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u7ed9\u4e0d\u540c\u7684Key\u7684TTL\u6dfb\u52a0\u968f\u673a\u503c</li> <li>\u5229\u7528Redis\u96c6\u7fa4\u63d0\u9ad8\u670d\u52a1\u7684\u53ef\u7528\u6027</li> <li>\u7ed9\u7f13\u5b58\u4e1a\u52a1\u6dfb\u52a0\u964d\u7ea7\u9650\u6d41\u7b56\u7565</li> <li>\u7ed9\u4e1a\u52a1\u6dfb\u52a0\u591a\u7ea7\u7f13\u5b58</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u7f13\u5b58\u51fb\u7a7f","title":"\u7f13\u5b58\u51fb\u7a7f","text":"<p>\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u4e5f\u53eb\u70ed\u70b9Key\u95ee\u9898\uff0c\u5c31\u662f\u4e00\u4e2a\u88ab\u9ad8\u5e76\u53d1\u8bbf\u95ee\u5e76\u4e14\u7f13\u5b58\u91cd\u5efa\u4e1a\u52a1\u8f83\u590d\u6742\u7684key\u7a81\u7136\u5931\u6548\u4e86\uff0c\u65e0\u6570\u7684\u8bf7\u6c42\u8bbf\u95ee\u4f1a\u5728\u77ac\u95f4\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u51b2\u51fb\u3002</p> <p>\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u4e92\u65a5\u9501</li> <li>\u903b\u8f91\u8fc7\u671f</li> </ul> \u89e3\u51b3\u65b9\u6848 \u4f18\u70b9 \u7f3a\u70b9 \u4e92\u65a5\u9501 \u6ca1\u6709\u989d\u5916\u5185\u5b58\u6d88\u8017\u4fdd\u8bc1\u4e00\u81f4\u6027\u5b9e\u73b0\u7b80\u5355 \u7ebf\u7a0b\u9700\u8981\u7b49\u5f85\uff0c\u6027\u80fd\u53d7\u5f71\u54cd\u53ef\u80fd\u6709\u6b7b\u9501\u98ce\u9669 \u903b\u8f91\u8fc7\u671f \u7ebf\u7a0b\u65e0\u9700\u7b49\u5f85\uff0c\u6027\u80fd\u8f83\u597d \u4e0d\u4fdd\u8bc1\u4e00\u81f4\u6027\u6709\u989d\u5916\u5185\u5b58\u6d88\u8017\u5b9e\u73b0\u590d\u6742"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u5168\u5c40\u552f\u4e00id","title":"\u5168\u5c40\u552f\u4e00ID","text":"<p>\u5168\u5c40ID\u751f\u6210\u5668\uff0c\u662f\u4e00\u79cd\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7528\u6765\u751f\u6210\u5168\u5c40\u552f\u4e00ID\u7684\u5de5\u5177\uff0c\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u7279\u6027\uff1a</p> <ul> <li>\u552f\u4e00\u6027</li> <li>\u9ad8\u53ef\u7528</li> <li>\u9ad8\u6027\u80fd</li> <li>\u9012\u589e\u6027</li> <li>\u5b89\u5168\u6027</li> </ul> <p>\u5e38\u89c1\u7684\u5b9e\u73b0\u65b9\u5f0f\u5305\u62ecUUID\u3001Snowflake\u7b97\u6cd5\u7b49\u3002</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#uuid","title":"UUID","text":"<p>UUID \u662f\u4e00\u4e2a128\u4f4d\u7684\u6807\u8bc6\u7b26\uff0c\u901a\u5e38\u8868\u793a\u4e3a32\u4e2a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\uff0c\u5206\u4e3a5\u6bb5\uff088-4-4-4-12\uff09\u3002UUID \u7684\u751f\u6210\u57fa\u4e8e\u65f6\u95f4\u6233\u3001\u968f\u673a\u6570\u6216\u786c\u4ef6\u5730\u5740\u7b49\uff0c\u786e\u4fdd\u5168\u5c40\u552f\u4e00\u6027\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>550e8400-e29b-41d4-a716-446655440000\n</code></pre> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u65e0\u9700\u4e2d\u5fc3\u5316\u670d\u52a1\uff0c\u5206\u5e03\u5f0f\u751f\u6210\u3002</li> <li>\u5168\u7403\u552f\u4e00\u6027\u9ad8\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u957f\u5ea6\u8f83\u957f\uff0836\u5b57\u7b26\uff09\u3002</li> <li>\u65e0\u5e8f\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3a\u6570\u636e\u5e93\u4e3b\u952e\uff08\u53ef\u80fd\u5bfc\u81f4\u7d22\u5f15\u788e\u7247\uff09\u3002</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#snowflake\u7b97\u6cd5","title":"Snowflake\u7b97\u6cd5","text":"<p>Snowflake \u662f Twitter \u5f00\u6e90\u7684\u5206\u5e03\u5f0fID\u751f\u6210\u7b97\u6cd5\uff0c\u751f\u6210\u4e00\u4e2a64\u4f4d\u7684ID\uff0c\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li>1\u4f4d\uff1a\u7b26\u53f7\u4f4d\uff08\u56fa\u5b9a\u4e3a0\uff09\u3002</li> <li>41\u4f4d\uff1a\u65f6\u95f4\u6233\uff08\u6beb\u79d2\u7ea7\uff0c\u53ef\u752869\u5e74\uff09\u3002</li> <li>10\u4f4d\uff1a\u673a\u5668ID\uff08\u652f\u63011024\u4e2a\u8282\u70b9\uff09\u3002</li> <li>12\u4f4d\uff1a\u5e8f\u5217\u53f7\uff08\u6bcf\u6beb\u79d2\u53ef\u751f\u62104096\u4e2aID\uff09\u3002</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>1234567890123456789\n</code></pre> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u77ed\u5c0f\u7cbe\u608d\uff0864\u4f4d\u6574\u6570\uff09\u3002</li> <li>\u65f6\u95f4\u6709\u5e8f\uff0c\u9002\u5408\u4f5c\u4e3a\u6570\u636e\u5e93\u4e3b\u952e\u3002</li> <li>\u9ad8\u6027\u80fd\uff0c\u652f\u6301\u9ad8\u5e76\u53d1\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4f9d\u8d56\u7cfb\u7edf\u65f6\u949f\uff0c\u65f6\u949f\u56de\u62e8\u53ef\u80fd\u5bfc\u81f4ID\u51b2\u7a81\u3002</li> <li>\u9700\u8981\u7ba1\u7406\u673a\u5668ID\u7684\u5206\u914d\u3002</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#redis\u81ea\u589e","title":"Redis\u81ea\u589e","text":"<p>Redis\u81ea\u589eID\u751f\u6210\u5668\u5229\u7528Redis\u7684\u539f\u5b50\u6027INCR\u547d\u4ee4\u751f\u6210\u5168\u5c40\u552f\u4e00ID\uff0c\u7ed3\u5408\u65f6\u95f4\u6233\u548c\u5e8f\u5217\u53f7\u4fdd\u8bc1ID\u7684\u552f\u4e00\u6027\u548c\u9012\u589e\u6027\u3002</p> <p>\u5b9e\u73b0\u539f\u7406\uff1a</p> <ol> <li>\u65f6\u95f4\u6233\u90e8\u5206\uff1a\u4f7f\u7528\u81ea\u5b9a\u4e49\u8d77\u59cb\u65f6\u95f4\u6233\uff08\u59822025\u5e741\u67081\u65e5\uff09\u4f5c\u4e3a\u57fa\u51c6\uff0c\u8ba1\u7b97\u5f53\u524d\u65f6\u95f4\u4e0e\u57fa\u51c6\u65f6\u95f4\u7684\u79d2\u6570\u5dee\u503c\uff0c\u4f5c\u4e3aID\u7684\u9ad8\u4f4d\u90e8\u5206</li> <li>\u5e8f\u5217\u53f7\u90e8\u5206\uff1a\u4f7f\u7528Redis\u7684INCR\u547d\u4ee4\u5bf9\u6bcf\u5929\u7684\u8ba1\u6570\u5668\u8fdb\u884c\u539f\u5b50\u6027\u81ea\u589e\uff0c\u4f5c\u4e3aID\u7684\u4f4e\u4f4d\u90e8\u5206</li> <li>\u4f4d\u8fd0\u7b97\u7ec4\u5408\uff1a\u5c06\u65f6\u95f4\u6233\u5de6\u79fb32\u4f4d\uff0c\u4e0e\u5e8f\u5217\u53f7\u8fdb\u884c\u6309\u4f4d\u6216\u8fd0\u7b97\uff0c\u751f\u6210\u6700\u7ec8\u768464\u4f4dID</li> </ol> <p>ID\u7ed3\u6784\uff0864\u4f4d\uff09\uff1a</p> <ul> <li>32\u4f4d\u65f6\u95f4\u6233\uff1a\u76f8\u5bf9\u4e8e\u8d77\u59cb\u65f6\u95f4\u7684\u79d2\u6570\uff08\u53ef\u752868\u5e74\uff09</li> <li>32\u4f4d\u5e8f\u5217\u53f7\uff1a\u6bcf\u5929\u91cd\u7f6e\u7684\u81ea\u589e\u5e8f\u5217\uff08\u6bcf\u5929\u53ef\u751f\u621042\u4ebf\u4e2aID\uff09</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u9ad8\u6027\u80fd\uff1a\u57fa\u4e8eRedis\u7684\u5185\u5b58\u64cd\u4f5c\uff0c\u6027\u80fd\u6781\u9ad8</li> <li>\u5168\u5c40\u552f\u4e00\uff1a\u65f6\u95f4\u6233+\u65e5\u671f+\u5e8f\u5217\u53f7\u786e\u4fdd\u552f\u4e00\u6027</li> <li>\u8d8b\u52bf\u9012\u589e\uff1a\u65f6\u95f4\u7ef4\u5ea6\u4e0aID\u5448\u9012\u589e\u8d8b\u52bf</li> <li>\u4fe1\u606f\u53ef\u8bfb\uff1a\u53ef\u4eceID\u4e2d\u89e3\u6790\u51fa\u751f\u6210\u65f6\u95f4</li> <li>\u9ad8\u53ef\u7528\uff1a\u652f\u6301Redis\u96c6\u7fa4\u90e8\u7f72</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4f9d\u8d56Redis\uff1aRedis\u6545\u969c\u4f1a\u5f71\u54cdID\u751f\u6210</li> <li>\u65f6\u949f\u654f\u611f\uff1a\u4f9d\u8d56\u7cfb\u7edf\u65f6\u949f\u7684\u51c6\u786e\u6027</li> </ul> <pre><code>@Component\n@RequiredArgsConstructor\npublic class RedisIdWorker {\n\n    private final StringRedisTemplate redisTemplate;\n\n    // \u81ea\u5b9a\u4e49\u8d77\u59cb\u65f6\u95f4\u6233\uff082025\u5e741\u67081\u65e50\u65f60\u52060\u79d2\uff09\n    private final long BEGIN_TIME_STAMP = 1735689600L;\n\n    public long nextId(String prefix) {\n        // 1. \u751f\u6210\u65f6\u95f4\u6233\n        LocalDateTime now = LocalDateTime.now();\n        long epochSecond = now.toEpochSecond(ZoneOffset.UTC);\n        long nowEpochSecond = epochSecond - BEGIN_TIME_STAMP;\n\n        // 2. \u751f\u6210\u5e8f\u5217\u53f7\uff08\u6bcf\u5929\u4e00\u4e2akey\uff0c\u907f\u514d\u5355key\u8fc7\u5927\uff09\n        String date = now.format(DateTimeFormatter.ofPattern(\"yyyyMMdd\"));\n        long increment = redisTemplate.opsForValue().increment(\"icr:\" + prefix + \":\" + date);\n\n        // 3. \u62fc\u63a5\u5e76\u8fd4\u56de\uff08\u65f6\u95f4\u6233\u5de6\u79fb32\u4f4d + \u5e8f\u5217\u53f7\uff09\n        return nowEpochSecond &lt;&lt; 32 | increment;\n    }\n\n}\n</code></pre>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u8d85\u5356\u95ee\u9898","title":"\u8d85\u5356\u95ee\u9898","text":"<p>\u8d85\u5356\u95ee\u9898\uff08Overselling\uff09\u662f\u7535\u5546\u3001\u79d2\u6740\u3001\u5e93\u5b58\u7ba1\u7406\u7b49\u573a\u666f\u4e2d\u5e38\u89c1\u7684\u6838\u5fc3\u95ee\u9898\uff0c\u6307\u7cfb\u7edf\u5b9e\u9645\u9500\u552e\u6570\u91cf\u8d85\u8fc7\u5e93\u5b58\u6570\u91cf\uff0c\u5bfc\u81f4\u8ba2\u5355\u65e0\u6cd5\u5c65\u7ea6\u3002</p> <p>\u539f\u56e0\uff1a</p> <ol> <li>\u5e76\u53d1\u8bf7\u6c42\u51b2\u7a81<ul> <li>\u591a\u4e2a\u7528\u6237\u540c\u65f6\u8bf7\u6c42\u8d2d\u4e70\u540c\u4e00\u5546\u54c1\uff0c\u7cfb\u7edf\u672a\u6b63\u786e\u5904\u7406\u5e76\u53d1\u6263\u51cf\u5e93\u5b58\u3002</li> </ul> </li> <li>\u6570\u636e\u5e93\u66f4\u65b0\u5ef6\u8fdf<ul> <li>\u6570\u636e\u5e93\u8bfb\u5199\u5206\u79bb\u65f6\uff0c\u4ece\u5e93\u540c\u6b65\u5ef6\u8fdf\u5bfc\u81f4\u8bfb\u53d6\u5230\u65e7\u5e93\u5b58\u6570\u636e\u3002</li> </ul> </li> <li>\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u4e0d\u4e00\u81f4<ul> <li>\u7f13\u5b58\u5c42\uff08\u5982 Redis\uff09\u4e0e\u6570\u636e\u5e93\u7684\u5e93\u5b58\u6570\u636e\u672a\u540c\u6b65\u3002</li> </ul> </li> <li>\u975e\u539f\u5b50\u6027\u64cd\u4f5c<ul> <li>\u67e5\u8be2\u5e93\u5b58\u3001\u6263\u51cf\u5e93\u5b58\u5206\u6b65\u6267\u884c\uff0c\u4e2d\u95f4\u8fc7\u7a0b\u88ab\u5176\u4ed6\u8bf7\u6c42\u63d2\u5165\u3002</li> </ul> </li> </ol> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>\u6570\u636e\u5e93\u5c42\u9762\uff1a\u9501\u673a\u5236</p> <ul> <li>\u60b2\u89c2\u9501\uff08Pessimistic Lock\uff09   \u901a\u8fc7 <code>SELECT ... FOR UPDATE</code> \u9501\u5b9a\u8bb0\u5f55\uff0c\u786e\u4fdd\u4e32\u884c\u64cd\u4f5c\u3002</li> </ul> <pre><code>BEGIN;\nSELECT stock FROM products WHERE id=1 FOR UPDATE;\nUPDATE products SET stock = stock - 1 WHERE id=1;\nCOMMIT;\n</code></pre> <p>\u7f3a\u70b9\uff1a\u9ad8\u5e76\u53d1\u4e0b\u6027\u80fd\u5dee\uff0c\u53ef\u80fd\u5f15\u53d1\u6b7b\u9501\u3002</p> <ul> <li>\u4e50\u89c2\u9501\uff08Optimistic Lock\uff09   \u4f7f\u7528\u7248\u672c\u53f7\u6216\u5e93\u5b58\u5b57\u6bb5\u672c\u8eab\u4f5c\u4e3a\u6761\u4ef6\u66f4\u65b0\u3002</li> </ul> <pre><code>UPDATE products \nSET stock = stock - 1, version = version + 1 \nWHERE id=1 AND stock &gt; 0 AND version = {current_version};\n</code></pre> <p>\u4f18\u70b9\uff1a\u65e0\u9501\u7ade\u4e89\uff0c\u9002\u5408\u9ad8\u5e76\u53d1\u3002   \u7f3a\u70b9\uff1a\u9700\u5904\u7406\u66f4\u65b0\u5931\u8d25\uff08\u5982\u91cd\u8bd5\u6216\u63d0\u793a\u7528\u6237\uff09\u3002</p> <p>\u5206\u5e03\u5f0f\u9501</p> <ul> <li>Redis \u9501   \u4f7f\u7528 <code>SET key value NX EX</code> \u5b9e\u73b0\u539f\u5b50\u9501\uff1a</li> </ul> <pre><code>lock = redis.set(\"product_1_lock\", \"locked\", nx=True, ex=5)\nif lock:\n    try:\n        # \u6263\u51cf\u5e93\u5b58\u903b\u8f91\n    finally:\n        redis.delete(\"product_1_lock\")\n</code></pre> <p>\u6ce8\u610f\uff1a\u9700\u89e3\u51b3\u9501\u8fc7\u671f\u548c\u8bef\u5220\u95ee\u9898\uff08\u5982 Redlock \u7b97\u6cd5\uff09\u3002</p> <p>\u7f13\u5b58\u5c42\u539f\u5b50\u64cd\u4f5c</p> <ul> <li>Redis \u539f\u5b50\u6263\u51cf   \u5229\u7528 Redis \u7684\u539f\u5b50\u547d\u4ee4\uff08\u5982 <code>DECR</code> \u6216 Lua \u811a\u672c\uff09\uff1a</li> </ul> <pre><code>-- Lua \u811a\u672c\uff08\u539f\u5b50\u6263\u51cf\u5e93\u5b58\uff09\nlocal stock = tonumber(redis.call('GET', KEYS[1]))\nif stock &gt; 0 then\n    redis.call('DECR', KEYS[1])\n    return 1  -- \u6210\u529f\nelse\n    return 0  -- \u5931\u8d25\nend\n</code></pre> <p>\u4f18\u70b9\uff1a\u9ad8\u6027\u80fd\uff0c\u907f\u514d\u76f4\u63a5\u7a7f\u900f\u5230\u6570\u636e\u5e93\u3002</p> <ul> <li>\u9884\u6263\u5e93\u5b58\uff08\u9884\u5360\u673a\u5236\uff09   \u7528\u6237\u4e0b\u5355\u65f6\u5148\u5728 Redis \u4e2d\u6263\u51cf\u5e93\u5b58\uff0c\u5f02\u6b65\u540c\u6b65\u5230\u6570\u636e\u5e93\uff1a</li> </ul> <pre><code>if redis.decr(\"product_1_stock\") &gt;= 0:\n    # \u521b\u5efa\u8ba2\u5355\uff0c\u5f02\u6b65\u66f4\u65b0\u6570\u636e\u5e93\nelse:\n    # \u6062\u590d\u5e93\u5b58\uff1aredis.incr(\"product_1_stock\")\n</code></pre> <p>\u6d88\u606f\u961f\u5217\u524a\u5cf0</p> <ul> <li>\u5c06\u8bf7\u6c42\u653e\u5165\u961f\u5217\uff08\u5982 Kafka\u3001RabbitMQ\uff09\uff0c\u7531\u6d88\u8d39\u8005\u987a\u5e8f\u5904\u7406\uff1a</li> </ul> <pre><code># \u751f\u4ea7\u8005\uff08\u7528\u6237\u8bf7\u6c42\u5165\u961f\uff09\nproducer.send(\"order_topic\", {\"user_id\": 123, \"product_id\": 1})\n\n# \u6d88\u8d39\u8005\uff08\u987a\u5e8f\u6263\u51cf\u5e93\u5b58\uff09\nconsumer.subscribe(\"order_topic\")\nfor message in consumer:\n    process_order(message)\n</code></pre> <p>\u4f18\u70b9\uff1a\u6d41\u91cf\u524a\u5cf0\uff0c\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u3002</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u4e00\u4eba\u4e00\u5355","title":"\u4e00\u4eba\u4e00\u5355","text":""},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u5355\u5b9e\u4f8b\u90e8\u7f72","title":"\u5355\u5b9e\u4f8b\u90e8\u7f72","text":"<p>\u67d0\u4e9b\u4e1a\u52a1\u53ea\u5141\u8bb8\u7528\u6237\u8fdb\u884c\u4e00\u6b21\u4ea4\u6613</p> <p>\u4f46\u5f53\u4e00\u4e2a\u7528\u6237\u540c\u4e00\u65f6\u95f4\u53d1\u8d77\u591a\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5c31\u6709\u53ef\u80fd\u53d1\u751f\u4e00\u4eba\u591a\u5355\u95ee\u9898\uff08\u591a\u4e2a\u7ebf\u7a0b\u90fd\u67e5\u8be2\u5230\u6570\u636e\u5e93\u4e2d\u5e76\u6ca1\u6709\u8ba2\u5355\u5b58\u5728\uff0c\u90fd\u53ef\u4ee5\u521b\u5efa\u8ba2\u5355\uff09</p> <p>\u53ef\u4ee5\u5bf9\u6570\u636e\u64cd\u4f5c\u4ee3\u7801\u52a0\u9501\u540c\u6b65</p> <pre><code>synchronized (userId.toString().intern()) {\n            // \u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\uff0c\u89e3\u51b3spring\u4e8b\u52a1\u5931\u6548\u95ee\u9898\n            IVoucherOrderService proxy =(IVoucherOrderService) AopContext.currentProxy();\n            return proxy.createOrder(id, userId);\n        }\n</code></pre> <p>Info</p> <p>\u4ee5\u4e0a\u4ee3\u7801\u53ea\u5bf9\u540c\u4e00\u4e2a\u7528\u6237\u52a0\u9501\uff0c\u907f\u514d\u4e0d\u540c\u7528\u6237\u88ab\u963b\u585e\u7684\u6027\u80fd\u95ee\u9898\uff08intern()\u5c06\u5b57\u7b26\u4e32\u52a0\u5165\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u907f\u514d\u540c\u4e00\u4e2a\u7528\u6237id\u6709\u591a\u4e2a\u5bf9\u8c61\uff0c\u540c\u6b65\u5931\u6548\uff09</p> <p>Spring\u7684\u4e8b\u52a1\u7ba1\u7406\u57fa\u4e8eAOP\u4ee3\u7406\u5bf9\u8c61\u5b9e\u73b0\uff0c\u5982\u679c\u5728\u7c7b\u7684\u65b9\u6cd5\u5185\u8c03\u7528\u81ea\u8eab\u7684\u65b9\u6cd5\uff0c\u7b49\u540c\u4e8ethis.xxx()\uff0c\u5e76\u6ca1\u6709\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u5b9e\u73b0\u4e8b\u52a1\u589e\u5f3a\uff0c\u89e3\u51b3\u65b9\u6848\u4e3a\u5148\u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\u8be5\u65b9\u6cd5</p> <p>\u9700\u8981\u5f15\u5165<code>aspectjweaver</code>\u4f9d\u8d56\uff0c\u5e76\u5728\u542f\u52a8\u7c7b\u4e0a\u52a0\u4e0a<code>@EnableAspectJAutoProxy(exposeProxy = true)</code>\u6ce8\u89e3</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u591a\u5b9e\u4f8b\u90e8\u7f72","title":"\u591a\u5b9e\u4f8b\u90e8\u7f72","text":"<p>\u4ee5\u4e0a\u65b9\u6848\u5728\u591a\u5b9e\u4f8b\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u4ecd\u4f1a\u53d1\u751f\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u539f\u56e0\u662f\u591a\u4e2a\u5b9e\u4f8b\u5404\u81ea\u90fd\u6709\u81ea\u8eab\u7684<code>JVM</code>\u5b9e\u73b0\u540c\u6b65\u9501\uff0c\u65e0\u6cd5\u5171\u4eab</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>\u200b   \u5206\u5e03\u5f0f\u9501\uff1a\u6ee1\u8db3\u5206\u5e03\u5f0f\u7cfb\u7edf\u6216\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u591a\u8fdb\u7a0b\u53ef\u89c1\u5e76\u4e14\u4e92\u65a5\u7684\u9501</p> <ul> <li>\u591a\u8fdb\u7a0b\u53ef\u89c1</li> <li>\u4e92\u65a5</li> <li>\u9ad8\u6027\u80fd</li> <li>\u5b89\u5168\u6027</li> <li>\u9ad8\u53ef\u7528</li> </ul> <p>\u5e38\u89c1\u5b9e\u73b0\u65b9\u5f0f</p> MySQL Redis Zookeeper \u4e92\u65a5 \u5229\u7528\u672c\u8eab\u4e92\u65a5\u9501\u673a\u5236 \u5229\u7528setnx\u8fd9\u7c7b\u4e92\u65a5\u547d\u4ee4 \u5229\u7528\u8282\u70b9\u552f\u4e00\u6027\u548c\u6709\u5e8f\u6027\u5b9e\u73b0 \u9ad8\u53ef\u7528 \u4f18\u79c0 \u4f18\u79c0 \u4f18\u79c0 \u9ad8\u6027\u80fd \u4e00\u822c \u4f18\u79c0 \u4e00\u822c \u5b89\u5168\u6027 \u65ad\u5f00\u8fde\u63a5\u81ea\u52a8\u91ca\u653e\u9501 \u9501\u5230\u671f\u81ea\u52a8\u91ca\u653e\uff0c\u907f\u514d\u6b7b\u9501 \u4e34\u65f6\u8282\u70b9\u65ad\u5f00\u8fde\u63a5\u81ea\u52a8\u91ca\u653e"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u57fa\u4e8eredis\u7684\u5206\u5e03\u5f0f\u9501","title":"\u57fa\u4e8eRedis\u7684\u5206\u5e03\u5f0f\u9501","text":""},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u7b80\u5355\u5b9e\u73b0","title":"\u7b80\u5355\u5b9e\u73b0","text":"<p>\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\u9700\u8981\u5b9e\u73b0\u7684\u4e24\u4e2a\u57fa\u672c\u65b9\u6cd5\uff1a</p> <ul> <li>\u83b7\u53d6\u9501\uff1a</li> </ul> <pre><code>SET lock thread1 EX 10 NX\n</code></pre> <p>Tip</p> <p>EX\u53c2\u6570\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0cNX\u53c2\u6570\u5b9e\u73b0\u4e0e<code>SETNX</code>\u76f8\u540c\u7684\u529f\u80fd</p> <p>Danger</p> <p>\u4e0d\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528<code>SETNX</code>,\u56e0\u4e3a\u65e0\u6cd5\u540c\u65f6\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u53ef\u80fd\u53d1\u751f\u83b7\u5f97\u9501\u540e\u670d\u52a1\u5b95\u673a\uff0c\u800c\u672a\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u6700\u7ec8\u5bfc\u81f4\u6b7b\u9501\u3002</p> <ul> <li>\u91ca\u653e\u9501\uff1a</li> </ul> <pre><code>DEL lock\n</code></pre> <p></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>@Override\npublic boolean tryLock(long timeout) {\n    // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0bID\n    long threadId = Thread.currentThread().getId();\n\n    Boolean success = stringRedisTemplate.opsForValue()\n            .setIfAbsent(KEY_PREFIX + name, threadId + \"\", timeout, TimeUnit.SECONDS);\n\n    return Boolean.TRUE.equals(success);\n}\n\n@Override\npublic void unlock() {\n    // \u91ca\u653e\u9501\n    stringRedisTemplate.delete(KEY_PREFIX + name);\n}\n</code></pre>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u9501\u8bef\u5220\u95ee\u9898","title":"\u9501\u8bef\u5220\u95ee\u9898","text":"<p>\u4e3b\u8981\u53d1\u751f\u5728\u67d0\u4e2a\u7ebf\u7a0b\u963b\u585e\u65f6\u9501\u88ab\u8d85\u65f6\u91ca\u653e\u4e86\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u83b7\u5f97\u9501\uff0c\u5f53\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u6062\u590d\u540e\u5c31\u4f1a\u5220\u9664\u4e0d\u5c5e\u4e8e\u81ea\u5df1\u7684\u9501</p> <p></p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>\u4e3a\u7ebf\u7a0b\u7684\u9501\u52a0\u5165\u552f\u4e00\u6807\u8bc6\uff0c\u91ca\u653e\u524d\u5224\u65ad\u9501\u662f\u5426\u5c5e\u4e8e\u81ea\u5df1</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u539f\u5b50\u6027\u95ee\u9898","title":"\u539f\u5b50\u6027\u95ee\u9898","text":"<p>\u5982\u679c\u67e5\u8be2\u548c\u5220\u9664\u9501\u4e0d\u80fd\u539f\u5b50\u6027\u6267\u884c\uff0c\u4ecd\u7136\u6709\u53ef\u80fd\u53d1\u751f\u9501\u8bef\u5220\u95ee\u9898</p> <p></p> <p>Lua\u811a\u672c</p> <p>Redis\u63d0\u4f9b\u4e86Lua\u811a\u672c\u529f\u80fd\uff0c\u5728\u4e00\u4e2a\u811a\u672c\u4e2d\u7f16\u5199\u591a\u6761Redis\u547d\u4ee4\uff0c\u786e\u4fdd\u591a\u6761\u547d\u4ee4\u6267\u884c\u65f6\u7684\u539f\u5b50\u6027\u3002Lua\u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u57fa\u672c\u8bed\u6cd5\u53ef\u4ee5\u53c2\u8003\u7f51\u7ad9</p> <p>Redis\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6267\u884cLua\u811a\u672c</p> <pre><code>EVAL \"&lt;\u811a\u672c\u5185\u5bb9&gt;\"\n\n-- \u793a\u4f8b\n\nEVAL \"return redis.call('set','key','value')\" 0\n</code></pre> <p>Note</p> <p>\u53c2\u65700\u8868\u793a\u9700\u8981\u7684key\u7c7b\u578b\u7684\u53c2\u6570\u4e2a\u6570</p> <p>\u811a\u672c\u4e2d\u7684key\u3001value\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002key\u7c7b\u578b\u53c2\u6570\u4f1a\u653e\u5165<code>KEYS</code>\u6570\u7ec4\uff0c\u5176\u5b83\u53c2\u6570\u4f1a\u653e\u5165<code>ARGV</code>\u6570\u7ec4\uff0c\u5728\u811a\u672c\u4e2d\u53ef\u4ee5\u4eceKEYS\u548cARGV\u6570\u7ec4\u83b7\u53d6\u8fd9\u4e9b\u53c2\u6570\uff1a</p> <pre><code>EVAL \"return redis.call('set',KEYS[1],ARGV[1])\" 1 key value\n</code></pre> <p>\u91ca\u653e\u9501\u811a\u672c\u793a\u4f8b\uff1a</p> <pre><code>-- \u83b7\u53d6key\nlocal key = KEYS[1]\n\n-- \u83b7\u53d6\u7ebf\u7a0bID\nlocal threadId = ARGV[1]\n\nlocal id = redis.call('get',key)\n\nif(id == threadId)\nthen\n    return redis.call('del',key)\nend\nreturn 0\n</code></pre> <pre><code>    private static final DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;\n\n    static {\n        UNLOCK_SCRIPT = new DefaultRedisScript&lt;&gt;();\n        UNLOCK_SCRIPT.setLocation(new ClassPathResource(\"unlock.lua\"));\n        UNLOCK_SCRIPT.setResultType(Long.class);\n    }    \n\n        // \u6267\u884cLua\u811a\u672c\u91ca\u653e\u9501\n        stringRedisTemplate.execute(\n                UNLOCK_SCRIPT,\n                Collections.singletonList(KEY_PREFIX + name),\n                ID_PREFIX + Thread.currentThread().getId()\n        );\n</code></pre>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#redission","title":"Redission","text":"<p>\u57fa\u4e8e<code>SETNX</code>\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u9501\u5b58\u5728\u4e0b\u9762\u7684\u95ee\u9898</p> <p></p> <p>Redisson\u662f\u4e00\u4e2a\u5728Redis\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7684Java\u9a7b\u5185\u5b58\u6570\u636e\u7f51\u683c\uff08In-Memory Data Grid\uff09\u3002\u5b83\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u5206\u5e03\u5f0f\u7684Java\u5e38\u7528\u5bf9\u8c61\uff0c\u8fd8\u63d0\u4f9b\u4e86\u8bb8\u591a\u5206\u5e03\u5f0f\u670d\u52a1\uff0c\u5176\u4e2d\u5c31\u5305\u542b\u4e86\u5404\u79cd\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1a https://redisson.org</p> <p></p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<p>\u5f15\u5165\u4f9d\u8d56</p> <pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.redisson&lt;/groupId&gt;\n            &lt;artifactId&gt;redisson&lt;/artifactId&gt;\n            &lt;version&gt;3.36.0&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre> <p>\u914d\u7f6eRedisson</p> <pre><code>@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedissonClient redisson() {\n        // \u914d\u7f6eRedisson\n        Config config = new Config();\n        config.useSingleServer()\n                .setAddress(\"redis://localhost:6379\")\n                .setPassword(\"123456\");\n\n        // \u521b\u5efaRedisson\u5ba2\u6237\u7aef\n        return Redisson.create(config);\n    }\n}\n</code></pre> <p>\u5728\u4e1a\u52a1\u4e2d\u6ce8\u5165<code>RedissonClient</code>\u7136\u540e\u83b7\u53d6\u9501\u5373\u53ef</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u53ef\u91cd\u5165\u9501\u539f\u7406","title":"\u53ef\u91cd\u5165\u9501\u539f\u7406","text":"<p>\u5229\u7528hash\u7ed3\u6784\u8bb0\u5f55\u7ebf\u7a0bid\u548c\u91cd\u5165\u6b21\u6570</p> <p></p> <p>\u83b7\u53d6\u9501</p> <pre><code>local key = KEYS[1]; -- \u9501\u7684key\nlocal threadId = ARGV[1]; -- \u7ebf\u7a0b\u552f\u4e00\u6807\u8bc6\nlocal releaseTime = ARGV[2]; -- \u9501\u7684\u81ea\u52a8\u91ca\u653e\u65f6\u95f4\n-- \u5224\u65ad\u662f\u5426\u5b58\u5728\nif(redis.call('exists', key) == 0) then\n    -- \u4e0d\u5b58\u5728, \u83b7\u53d6\u9501\n    redis.call('hset', key, threadId, '1'); \n    -- \u8bbe\u7f6e\u6709\u6548\u671f\n    redis.call('expire', key, releaseTime); \n    return 1; -- \u8fd4\u56de\u7ed3\u679c\nend;\n-- \u9501\u5df2\u7ecf\u5b58\u5728\uff0c\u5224\u65adthreadId\u662f\u5426\u662f\u81ea\u5df1\nif(redis.call('hexists', key, threadId) == 1) then\n    -- \u4e0d\u5b58\u5728, \u83b7\u53d6\u9501\uff0c\u91cd\u5165\u6b21\u6570+1\n    redis.call('hincrby', key, threadId, '1'); \n    -- \u8bbe\u7f6e\u6709\u6548\u671f\n    redis.call('expire', key, releaseTime); \n    return 1; -- \u8fd4\u56de\u7ed3\u679c\nend;\nreturn 0; -- \u4ee3\u7801\u8d70\u5230\u8fd9\u91cc,\u8bf4\u660e\u83b7\u53d6\u9501\u7684\u4e0d\u662f\u81ea\u5df1\uff0c\u83b7\u53d6\u9501\u5931\u8d25\n</code></pre> <p>\u91ca\u653e\u9501</p> <pre><code>local key = KEYS[1]; -- \u9501\u7684key\nlocal threadId = ARGV[1]; -- \u7ebf\u7a0b\u552f\u4e00\u6807\u8bc6\nlocal releaseTime = ARGV[2]; -- \u9501\u7684\u81ea\u52a8\u91ca\u653e\u65f6\u95f4\n-- \u5224\u65ad\u5f53\u524d\u9501\u662f\u5426\u8fd8\u662f\u88ab\u81ea\u5df1\u6301\u6709\nif (redis.call('HEXISTS', key, threadId) == 0) then\n    return nil; -- \u5982\u679c\u5df2\u7ecf\u4e0d\u662f\u81ea\u5df1\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\nend;\n-- \u662f\u81ea\u5df1\u7684\u9501\uff0c\u5219\u91cd\u5165\u6b21\u6570-1\nlocal count = redis.call('HINCRBY', key, threadId, -1);\n-- \u5224\u65ad\u662f\u5426\u91cd\u5165\u6b21\u6570\u662f\u5426\u5df2\u7ecf\u4e3a0 \nif (count &gt; 0) then\n    -- \u5927\u4e8e0\u8bf4\u660e\u4e0d\u80fd\u91ca\u653e\u9501\uff0c\u91cd\u7f6e\u6709\u6548\u671f\u7136\u540e\u8fd4\u56de\n    redis.call('EXPIRE', key, releaseTime);\n    return nil;\nelse  -- \u7b49\u4e8e0\u8bf4\u660e\u53ef\u4ee5\u91ca\u653e\u9501\uff0c\u76f4\u63a5\u5220\u9664\n    redis.call('DEL', key);\n    return nil;\nend;\n</code></pre>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u91cd\u8bd5\u673a\u5236\u548c\u770b\u95e8\u72d7","title":"\u91cd\u8bd5\u673a\u5236\u548c\u770b\u95e8\u72d7","text":"<p>\u2022\u53ef\u91cd\u8bd5\uff1a\u5229\u7528\u4fe1\u53f7\u91cf\u548cPubSub\u529f\u80fd\u5b9e\u73b0\u7b49\u5f85\u3001\u5524\u9192\uff0c\u83b7\u53d6\u9501\u5931\u8d25\u7684\u91cd\u8bd5\u673a\u5236</p> <p>\u2022\u8d85\u65f6\u7eed\u7ea6\uff1a\u5229\u7528watchDog\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff08releaseTime / 3\uff09\uff0c\u91cd\u7f6e\u8d85\u65f6\u65f6\u95f4</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u4e3b\u4ece\u4e00\u81f4\u6027","title":"\u4e3b\u4ece\u4e00\u81f4\u6027","text":"<p>\u539f\u7406\uff1a\u591a\u4e2a\u72ec\u7acb\u7684Redis\u8282\u70b9\uff0c\u5fc5\u987b\u5728\u6240\u6709\u8282\u70b9\u90fd\u83b7\u53d6\u91cd\u5165\u9501\uff0c\u624d\u7b97\u83b7\u53d6\u9501\u6210\u529f</p> <p>\u7f3a\u9677\uff1a\u8fd0\u7ef4\u6210\u672c\u9ad8\u3001\u5b9e\u73b0\u590d\u6742</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u57fa\u4e8eredis\u7684\u6d88\u606f\u961f\u5217","title":"\u57fa\u4e8eRedis\u7684\u6d88\u606f\u961f\u5217","text":"<p>\u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\uff0c\u5b57\u9762\u610f\u601d\u5c31\u662f\u5b58\u653e\u6d88\u606f\u7684\u961f\u5217\u3002\u6700\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\u6a21\u578b\u5305\u62ec3\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>\u6d88\u606f\u961f\u5217\uff1a\u5b58\u50a8\u548c\u7ba1\u7406\u6d88\u606f\uff0c\u4e5f\u88ab\u79f0\u4e3a\u6d88\u606f\u4ee3\u7406\uff08Message Broker\uff09</li> <li>\u751f\u4ea7\u8005\uff1a\u53d1\u9001\u6d88\u606f\u5230\u6d88\u606f\u961f\u5217</li> <li>\u6d88\u8d39\u8005\uff1a\u4ece\u6d88\u606f\u961f\u5217\u83b7\u53d6\u6d88\u606f\u5e76\u5904\u7406\u6d88\u606f</li> </ul> <p>Redis\u63d0\u4f9b\u4e86\u4e09\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u6d88\u606f\u961f\u5217\uff1a</p> <ul> <li>list\u7ed3\u6784\uff1a\u57fa\u4e8eList\u7ed3\u6784\u6a21\u62df\u6d88\u606f\u961f\u5217</li> <li>PubSub\uff1a\u57fa\u672c\u7684\u70b9\u5bf9\u70b9\u6d88\u606f\u6a21\u578b</li> <li>Stream\uff1a\u6bd4\u8f83\u5b8c\u5584\u7684\u6d88\u606f\u961f\u5217\u6a21\u578b</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u4f7f\u7528list\u5b9e\u73b0","title":"\u4f7f\u7528list\u5b9e\u73b0","text":"<p>Redis\u7684list\u6570\u636e\u7ed3\u6784\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5f88\u5bb9\u6613\u6a21\u62df\u51fa\u961f\u5217\u6548\u679c\u3002\u961f\u5217\u662f\u5165\u53e3\u548c\u51fa\u53e3\u4e0d\u5728\u4e00\u8fb9\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5229\u7528\uff1aLPUSH \u7ed3\u5408 RPOP\u3001\u6216\u8005 RPUSH \u7ed3\u5408 LPOP\u6765\u5b9e\u73b0\u3002</p> <p>\u4e0d\u8fc7\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6RPOP\u6216LPOP\u64cd\u4f5c\u4f1a\u8fd4\u56denull\uff0c\u5e76\u4e0d\u50cfJVM\u7684\u963b\u585e\u961f\u5217\u90a3\u6837\u4f1a\u963b\u585e\u5e76\u7b49\u5f85\u6d88\u606f\u3002\u56e0\u6b64\u8fd9\u91cc\u5e94\u8be5\u4f7f\u7528BRPOP\u6216\u8005BLPOP\u6765\u5b9e\u73b0\u963b\u585e\u6548\u679c\u3002</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u5229\u7528Redis\u5b58\u50a8\uff0c\u4e0d\u53d7\u9650\u4e8eJVM\u5185\u5b58\u4e0a\u9650</li> <li>\u57fa\u4e8eRedis\u7684\u6301\u4e45\u5316\u673a\u5236\uff0c\u6570\u636e\u5b89\u5168\u6027\u6709\u4fdd\u8bc1</li> <li>\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u6709\u5e8f\u6027</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u65e0\u6cd5\u907f\u514d\u6d88\u606f\u4e22\u5931</li> <li>\u53ea\u652f\u6301\u5355\u6d88\u8d39\u8005</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u4f7f\u7528pubsub\u5b9e\u73b0","title":"\u4f7f\u7528PubSub\u5b9e\u73b0","text":"<p>PubSub\uff08\u53d1\u5e03\u8ba2\u9605\uff09\u662fRedis2.0\u7248\u672c\u5f15\u5165\u7684\u6d88\u606f\u4f20\u9012\u6a21\u578b\u3002\u6d88\u8d39\u8005\u53ef\u4ee5\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2achannel\uff0c\u751f\u4ea7\u8005\u5411\u5bf9\u5e94channel\u53d1\u9001\u6d88\u606f\u540e\uff0c\u6240\u6709\u8ba2\u9605\u8005\u90fd\u80fd\u6536\u5230\u76f8\u5173\u6d88\u606f\u3002</p> <ul> <li><code>SUBSCRIBE channel [channel]</code> \uff1a\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053</li> <li><code>PUBLISH channel msg</code> \uff1a\u5411\u4e00\u4e2a\u9891\u9053\u53d1\u9001\u6d88\u606f</li> <li><code>PSUBSCRIBE pattern[pattern]</code> \uff1a\u8ba2\u9605\u4e0epattern\u683c\u5f0f\u5339\u914d\u7684\u6240\u6709\u9891\u9053</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u91c7\u7528\u53d1\u5e03\u8ba2\u9605\u6a21\u578b\uff0c\u652f\u6301\u591a\u751f\u4ea7\u3001\u591a\u6d88\u8d39</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4e0d\u652f\u6301\u6570\u636e\u6301\u4e45\u5316</li> <li>\u65e0\u6cd5\u907f\u514d\u6d88\u606f\u4e22\u5931</li> <li>\u6d88\u606f\u5806\u79ef\u6709\u4e0a\u9650\uff0c\u8d85\u51fa\u65f6\u6570\u636e\u4e22\u5931</li> </ul>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#\u4f7f\u7528stream\u5b9e\u73b0","title":"\u4f7f\u7528Stream\u5b9e\u73b0","text":"<p><code>Stream</code>\u662fRedis5.0\u5f15\u5165\u7684\u4e00\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u529f\u80fd\u8f83\u5b8c\u5584\u7684\u6d88\u606f\u961f\u5217</p> <p>\u53d1\u9001\u6d88\u606f</p> <p></p> <p>Example</p> <p><code>xadd user * name ysh age 22</code> </p> <p>\u8bfb\u53d6\u6d88\u606f</p> <p></p> <p>Example</p> <p><code>xread cout 1 block 2000 streams user $</code> \u963b\u585e\u5f0f\u8bfb\u53d6</p> <p>\u6ce8\u610f</p> <p>\u5f53\u6211\u4eec\u6307\u5b9a\u8d77\u59cbID\u4e3a$\u65f6\uff0c\u4ee3\u8868\u8bfb\u53d6\u6700\u65b0\u7684\u6d88\u606f\uff0c\u5982\u679c\u6211\u4eec\u5904\u7406\u4e00\u6761\u6d88\u606f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53c8\u6709\u8d85\u8fc71\u6761\u4ee5\u4e0a\u7684\u6d88\u606f\u5230\u8fbe\u961f\u5217\uff0c\u5219\u4e0b\u6b21\u83b7\u53d6\u65f6\u4e5f\u53ea\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u4e00\u6761\uff0c\u4f1a\u51fa\u73b0\u6f0f\u8bfb\u6d88\u606f\u7684\u95ee\u9898\u3002</p> <p>STREAM\u7c7b\u578b\u6d88\u606f\u961f\u5217\u7684XREAD\u547d\u4ee4\u7279\u70b9\uff1a</p> <ul> <li>\u6d88\u606f\u53ef\u56de\u6eaf</li> <li>\u4e00\u4e2a\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6</li> <li>\u53ef\u4ee5\u963b\u585e\u8bfb\u53d6</li> <li>\u6709\u6d88\u606f\u6f0f\u8bfb\u7684\u98ce\u9669</li> </ul> <p>\u6d88\u8d39\u8005\u7ec4</p> <p></p> <pre><code>## \u521b\u5efa\u6d88\u8d39\u8005\u7ec4\nxgroup create key groupName ID\n\n## \u5220\u9664\u6d88\u8d39\u8005\u7ec4\nxgroup destroy key groupName\n\n## \u5c06\u6d88\u8d39\u8005\u6dfb\u52a0\u5230\u6d88\u8d39\u8005\u7ec4\nxgroup createconsumer key groupName consumerName\n\n## \u5220\u9664\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u6d88\u8d39\u8005\nxgroup delconsumer key groupName consumerName\n</code></pre> <p></p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#feed\u6d41\u6a21\u5f0f\u63a8\u6d41","title":"Feed\u6d41\u6a21\u5f0f\uff08\u63a8\u6d41\uff09","text":"<p>Feed\u6d41\u4ea7\u54c1\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u6a21\u5f0f\uff1a</p> <ul> <li>TimeLine:\u4e0d\u505a\u5185\u5bb9\u7b5b\u9009\uff0c\u7b80\u5355\u7684\u6309\u7167\u5185\u5bb9\u53d1\u5e03\u65f6\u95f4\u6392\u5e8f\uff0c\u5e38\u7528\u4e8e\u597d\u53cb\u6216\u5173\u6ce8\u3002\u4f8b\u5982\u670b\u53cb\u5708<ul> <li>\u4f18\u70b9\uff1a\u4fe1\u606f\u5168\u9762\uff0c\u4e0d\u4f1a\u6709\u7f3a\u5931\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e5f\u76f8\u5bf9\u7b80\u5355</li> <li>\u4f18\u70b9\uff1a\u4fe1\u606f\u566a\u97f3\u591a\uff0c\u7528\u6237\u4e0d\u4e00\u5b9a\u611f\u5174\u8da3\uff0c\u5185\u5bb9\u83b7\u53d6\u6548\u7387\u4f4e</li> </ul> </li> <li>\u667a\u80fd\u6392\u5e8f:\u5229\u7528\u667a\u80fd\u7b97\u6cd5\u5c4f\u853d\u8fdd\u89c4\u7684\u3001\u7528\u6237\u4e0d\u611f\u5174\u8da3\u7684\u5185\u5bb9\uff0c\u63a8\u9001\u7528\u6237\u611f\u5174\u8da3\u7684\u4fe1\u606f\u6765\u5438\u5f15\u7528\u6237<ul> <li>\u4f18\u70b9\uff1a\u6295\u5582\u7528\u6237\u611f\u5174\u8da3\u7684\u4fe1\u606f\uff0c\u7528\u6237\u9ecf\u5ea6\u5f88\u9ad8\uff0c\u5bb9\u6613\u6c89\u8ff7</li> <li>\u7f3a\u70b9\uff1a\u7b97\u6cd5\u5982\u679c\u4e0d\u7cbe\u51c6\uff0c\u53ef\u80fd\u8d77\u53cd\u4f5c\u7528</li> </ul> </li> </ul> <p>\u63a8\u9001\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u62c9\u6a21\u5f0f\uff1a\u6d88\u8d39\u7aef\u4e3b\u52a8\u62c9\u53d6\uff08\u8bfb\u8981\u6c42\u9ad8\uff0c\u4e0d\u63a8\u8350\uff09</p> </li> <li> <p>\u63a8\u6a21\u5f0f\uff1a\u751f\u4ea7\u8005\u4e3b\u52a8\u63a8\u9001\uff08\u5199\u8981\u6c42\u9ad8\uff0c\u7528\u6237\u91cf\u5c11\u65f6\u63a8\u8350\uff09</p> </li> <li> <p>\u63a8\u62c9\u7ed3\u5408\uff1a\u4ee5\u4e0a\u4e24\u8005\u7ed3\u5408\uff08\u7528\u6237\u5343\u4e07\u4ee5\u4e0a\u63a8\u8350\uff09</p> </li> </ul> <p>\u5b9e\u73b0\u65b9\u5f0f</p> <p>\u521b\u5efa\u53d1\u4ef6\u7bb1\u548c\u6536\u4ef6\u7bb1\uff0c\u6309\u7167\u63a8\u9001\u65b9\u5f0f\u5c06\u63a8\u9001\u5185\u5bb9\u7684\u6807\u8bc6\uff08\u901a\u5e38\u4e3aID\uff09\u53d1\u9001\u5230\u5bf9\u5e94\u4f4d\u7f6e</p> <p>Warning</p> <p>Feed\u6d41\u4e2d\u7684\u6570\u636e\u4f1a\u4e0d\u65ad\u66f4\u65b0\uff0c\u6570\u636e\u7684\u89d2\u6807\u4e5f\u4f1a\u53d8\u5316\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u4f20\u7edf\u7684\u5206\u9875\u67e5\u8be2 \u5e94\u8be5\u91c7\u7528\u6eda\u52a8\u5206\u9875\u6cd5\uff0c\u5373\u6bcf\u6b21\u67e5\u8be2\u8bb0\u5f55\u6700\u540e\u4e00\u6761\u6570\u636e\u7684\u503c\u800c\u4e0d\u662f\u89d2\u6807\uff0c\u4e0b\u4e00\u6b21\u67e5\u8be2\u518d\u4ece\u8be5\u5143\u7d20\u5f00\u59cb \u6bcf\u6b21\u67e5\u8be2\u65f6\u9700\u8981\u7684\u53c2\u6570\u4e3a\u4e0a\u6b21\u67e5\u8be2\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u503c\uff0c\u4e0e\u4e0a\u4e00\u6761\u8bb0\u5f55\u503c\u76f8\u540c\u7684\u8bb0\u5f55\u6570\uff08offset\uff09</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#geo\u6570\u636e","title":"GEO\u6570\u636e","text":"<p>GEO\u5c31\u662fGeolocation\u7684\u7b80\u5199\u5f62\u5f0f\uff0c\u4ee3\u8868\u5730\u7406\u5750\u6807\u3002Redis\u57283.2\u7248\u672c\u4e2d\u52a0\u5165\u4e86\u5bf9GEO\u7684\u652f\u6301\uff0c\u5141\u8bb8\u5b58\u50a8\u5730\u7406\u5750\u6807\u4fe1\u606f\uff0c\u5e2e\u52a9\u6211\u4eec\u6839\u636e\u7ecf\u7eac\u5ea6\u6765\u68c0\u7d22\u6570\u636e\u3002\u5e38\u89c1\u7684\u547d\u4ee4\u6709\uff1a</p> <p>GEOADD\uff1a\u6dfb\u52a0\u4e00\u4e2a\u5730\u7406\u7a7a\u95f4\u4fe1\u606f\uff0c\u5305\u542b\uff1a\u7ecf\u5ea6\uff08longitude\uff09\u3001\u7eac\u5ea6\uff08latitude\uff09\u3001\u503c\uff08member\uff09</p> <p>GEODIST\uff1a\u8ba1\u7b97\u6307\u5b9a\u7684\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u5e76\u8fd4\u56de</p> <p>GEOHASH\uff1a\u5c06\u6307\u5b9amember\u7684\u5750\u6807\u8f6c\u4e3ahash\u5b57\u7b26\u4e32\u5f62\u5f0f\u5e76\u8fd4\u56de</p> <p>GEOPOS\uff1a\u8fd4\u56de\u6307\u5b9amember\u7684\u5750\u6807</p> <p>GEORADIUS\uff1a\u6307\u5b9a\u5706\u5fc3\u3001\u534a\u5f84\uff0c\u627e\u5230\u8be5\u5706\u5185\u5305\u542b\u7684\u6240\u6709member\uff0c\u5e76\u6309\u7167\u4e0e\u5706\u5fc3\u4e4b\u95f4\u7684\u8ddd\u79bb\u6392\u5e8f\u540e\u8fd4\u56de\u30026.2\u4ee5\u540e\u5df2\u5e9f\u5f03</p> <p>GEOSEARCH\uff1a\u5728\u6307\u5b9a\u8303\u56f4\u5185\u641c\u7d22member\uff0c\u5e76\u6309\u7167\u4e0e\u6307\u5b9a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u6392\u5e8f\u540e\u8fd4\u56de\u3002\u8303\u56f4\u53ef\u4ee5\u662f\u5706\u5f62\u6216\u77e9\u5f62\u30026.2.\u65b0\u529f\u80fd</p> <p>GEOSEARCHSTORE\uff1a\u4e0eGEOSEARCH\u529f\u80fd\u4e00\u81f4\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u628a\u7ed3\u679c\u5b58\u50a8\u5230\u4e00\u4e2a\u6307\u5b9a\u7684key\u3002 6.2.\u65b0\u529f\u80fd</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#bitmap","title":"BitMap","text":"<p>Redis\u4e2d\u5229\u7528string\u7c7b\u578b\u6570\u636e\u7ed3\u6784\u5b9e\u73b0BitMap\uff0c\u56e0\u6b64\u6700\u5927\u4e0a\u9650\u662f512M\uff0c\u8f6c\u6362\u4e3abit\u5219\u662f 2^32\u4e2abit\u4f4d\u3002</p> <p>BitMap\u7684\u64cd\u4f5c\u547d\u4ee4\u6709\uff1a</p> <p>SETBIT\uff1a\u5411\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u5b58\u5165\u4e00\u4e2a0\u62161</p> <p>GETBIT \uff1a\u83b7\u53d6\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u7684bit\u503c</p> <p>BITCOUNT \uff1a\u7edf\u8ba1BitMap\u4e2d\u503c\u4e3a1\u7684bit\u4f4d\u7684\u6570\u91cf</p> <p>BITFIELD \uff1a\u64cd\u4f5c\uff08\u67e5\u8be2\u3001\u4fee\u6539\u3001\u81ea\u589e\uff09BitMap\u4e2dbit\u6570\u7ec4\u4e2d\u7684\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u7684\u503c</p> <p>BITFIELD_RO \uff1a\u83b7\u53d6BitMap\u4e2dbit\u6570\u7ec4\uff0c\u5e76\u4ee5\u5341\u8fdb\u5236\u5f62\u5f0f\u8fd4\u56de</p> <p>BITOP \uff1a\u5c06\u591a\u4e2aBitMap\u7684\u7ed3\u679c\u505a\u4f4d\u8fd0\u7b97\uff08\u4e0e \u3001\u6216\u3001\u5f02\u6216\uff09</p> <p>BITPOS \uff1a\u67e5\u627ebit\u6570\u7ec4\u4e2d\u6307\u5b9a\u8303\u56f4\u5185\u7b2c\u4e00\u4e2a0\u62161\u51fa\u73b0\u7684\u4f4d\u7f6e</p>"},{"location":"Redis/Redis%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#hyperlogloguv\u7edf\u8ba1","title":"HyperLogLog&amp;&amp;UV\u7edf\u8ba1","text":"<ul> <li> <p>UV\uff1a\u5168\u79f0Unique Visitor\uff0c\u4e5f\u53eb\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff0c\u662f\u6307\u901a\u8fc7\u4e92\u8054\u7f51\u8bbf\u95ee\u3001\u6d4f\u89c8\u8fd9\u4e2a\u7f51\u9875\u7684\u81ea\u7136\u4eba\u30021\u5929\u5185\u540c\u4e00\u4e2a\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8be5\u7f51\u7ad9\uff0c\u53ea\u8bb0\u5f551\u6b21\u3002</p> </li> <li> <p>PV\uff1a\u5168\u79f0Page View\uff0c\u4e5f\u53eb\u9875\u9762\u8bbf\u95ee\u91cf\u6216\u70b9\u51fb\u91cf\uff0c\u7528\u6237\u6bcf\u8bbf\u95ee\u7f51\u7ad9\u7684\u4e00\u4e2a\u9875\u9762\uff0c\u8bb0\u5f551\u6b21PV\uff0c\u7528\u6237\u591a\u6b21\u6253\u5f00\u9875\u9762\uff0c\u5219\u8bb0\u5f55\u591a\u6b21PV\u3002\u5f80\u5f80\u7528\u6765\u8861\u91cf\u7f51\u7ad9\u7684\u6d41\u91cf\u3002</p> </li> </ul> <p>UV\u7edf\u8ba1\u5728\u670d\u52a1\u7aef\u505a\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u8981\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u7edf\u8ba1\u8fc7\u4e86\uff0c\u9700\u8981\u5c06\u7edf\u8ba1\u8fc7\u7684\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u3002\u4f46\u662f\u5982\u679c\u6bcf\u4e2a\u8bbf\u95ee\u7684\u7528\u6237\u90fd\u4fdd\u5b58\u5230Redis\u4e2d\uff0c\u6570\u636e\u91cf\u4f1a\u975e\u5e38\u5927\u3002</p> <p>Hyperloglog(HLL)\u662f\u4eceLoglog\u7b97\u6cd5\u6d3e\u751f\u7684\u6982\u7387\u7b97\u6cd5\uff0c\u7528\u4e8e\u786e\u5b9a\u975e\u5e38\u5927\u7684\u96c6\u5408\u7684\u57fa\u6570\uff0c\u800c\u4e0d\u9700\u8981\u5b58\u50a8\u5176\u6240\u6709\u503c\u3002\u76f8\u5173\u7b97\u6cd5\u539f\u7406\u53ef\u4ee5\u53c2\u8003\uff1ahttps://juejin.cn/post/6844903785744056333#heading-0</p> <p>Redis\u4e2d\u7684HLL\u662f\u57fa\u4e8estring\u7ed3\u6784\u5b9e\u73b0\u7684\uff0c\u5355\u4e2aHLL\u7684\u5185\u5b58\u6c38\u8fdc\u5c0f\u4e8e16kb\uff0c\u5185\u5b58\u5360\u7528\u4f4e\uff0c\u4f46\u662f\u5176\u6d4b\u91cf\u7ed3\u679c\u662f\u6982\u7387\u6027\u7684\uff0c\u6709\u5c0f\u4e8e0.81\uff05\u7684\u8bef\u5dee\u3002\u4e0d\u8fc7\u5bf9\u4e8eUV\u7edf\u8ba1\u6765\u8bf4\uff0c\u8fd9\u5b8c\u5168\u53ef\u4ee5\u5ffd\u7565\u3002</p> <pre><code>// \u6d4b\u8bd5\u4ee3\u7801\n    @Test\n    public void testHyperLogLog() {\n        String[] values = new String[10000];\n        int j;\n        for (int i = 0; i &lt; 1000000; i++) {\n            j = i % 10000;\n            values[j] = \"user_\" + i;\n            if (j == 9999) {\n                stringRedisTemplate.opsForHyperLogLog().add(\"hll\", values);\n            }\n        }\n        Long hll = stringRedisTemplate.opsForHyperLogLog().size(\"hll\");\n        System.out.println(\"hll = \" + hll);\n    }\n</code></pre>"},{"location":"Redis/SQL%E4%B8%8ENoSQL/","title":"SQL\u4e0eNoSQL","text":"<p>SQL\uff08Structured Query Language\uff09\u548cNoSQL\uff08Not Only SQL\uff09\u662f\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u4eec\u5728\u6570\u636e\u5b58\u50a8\u3001\u67e5\u8be2\u3001\u6269\u5c55\u6027\u548c\u4f7f\u7528\u573a\u666f\u4e0a\u6709\u663e\u8457\u533a\u522b\u3002</p>"},{"location":"Redis/SQL%E4%B8%8ENoSQL/#sql\u5173\u7cfb\u578b\u6570\u636e\u5e93","title":"SQL\uff08\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09","text":"<p>\u7279\u70b9\uff1a</p> <ol> <li>\u7ed3\u6784\u5316\u6570\u636e\uff1a\u6570\u636e\u5b58\u50a8\u5728\u9884\u5b9a\u4e49\u7684\u8868\u4e2d\uff0c\u8868\u7531\u884c\u548c\u5217\u7ec4\u6210\u3002</li> <li>\u6a21\u5f0f\u56fa\u5b9a\uff1a\u8868\u7ed3\u6784\uff08schema\uff09\u5728\u521b\u5efa\u65f6\u5b9a\u4e49\uff0c\u4fee\u6539\u7ed3\u6784\u53ef\u80fd\u6bd4\u8f83\u590d\u6742\u3002</li> <li>ACID\u4e8b\u52a1\uff1a\u652f\u6301\u539f\u5b50\u6027\uff08Atomicity\uff09\u3001\u4e00\u81f4\u6027\uff08Consistency\uff09\u3001\u9694\u79bb\u6027\uff08Isolation\uff09\u3001\u6301\u4e45\u6027\uff08Durability\uff09\uff0c\u786e\u4fdd\u6570\u636e\u5b8c\u6574\u6027\u3002</li> <li>\u6807\u51c6\u5316\u67e5\u8be2\u8bed\u8a00\uff1a\u4f7f\u7528SQL\u8fdb\u884c\u6570\u636e\u64cd\u4f5c\u548c\u67e5\u8be2\u3002</li> <li>\u5173\u7cfb\u6a21\u578b\uff1a\u652f\u6301\u8868\u4e4b\u95f4\u7684\u590d\u6742\u5173\u7cfb\uff08\u5982\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u591a\uff09\u3002</li> </ol> <p>\u5e38\u89c1SQL\u6570\u636e\u5e93\uff1a</p> <ul> <li>MySQL</li> <li>PostgreSQL</li> <li>Oracle</li> <li>SQL Server</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u9700\u8981\u590d\u6742\u67e5\u8be2\u548c\u4e8b\u52a1\u652f\u6301\u7684\u573a\u666f\uff08\u5982\u91d1\u878d\u7cfb\u7edf\u3001ERP\uff09\u3002</li> <li>\u6570\u636e\u7ed3\u6784\u76f8\u5bf9\u56fa\u5b9a\u4e14\u5173\u7cfb\u660e\u786e\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"Redis/SQL%E4%B8%8ENoSQL/#nosql\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93","title":"NoSQL\uff08\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09","text":"<p>\u7279\u70b9\uff1a</p> <ol> <li>\u7075\u6d3b\u7684\u6570\u636e\u6a21\u578b\uff1a\u652f\u6301\u6587\u6863\u3001\u952e\u503c\u5bf9\u3001\u5217\u65cf\u3001\u56fe\u7b49\u591a\u79cd\u6570\u636e\u683c\u5f0f\uff0c\u65e0\u9700\u56fa\u5b9a\u6a21\u5f0f\u3002</li> <li>\u9ad8\u6269\u5c55\u6027\uff1a\u901a\u5e38\u8bbe\u8ba1\u4e3a\u5206\u5e03\u5f0f\u67b6\u6784\uff0c\u6613\u4e8e\u6c34\u5e73\u6269\u5c55\u3002</li> <li>\u9ad8\u6027\u80fd\uff1a\u9488\u5bf9\u7279\u5b9a\u573a\u666f\u4f18\u5316\uff0c\u8bfb\u5199\u901f\u5ea6\u8f83\u5feb\u3002</li> <li>\u5f31\u5316\u4e8b\u52a1\u652f\u6301\uff1a\u90e8\u5206NoSQL\u6570\u636e\u5e93\u4e0d\u652f\u6301ACID\u4e8b\u52a1\uff0c\u800c\u662f\u63d0\u4f9b\u6700\u7ec8\u4e00\u81f4\u6027\uff08Eventual Consistency\uff09\u3002</li> <li>\u65e0\u56fa\u5b9a\u67e5\u8be2\u8bed\u8a00\uff1a\u6bcf\u79cdNoSQL\u6570\u636e\u5e93\u6709\u81ea\u5df1\u7684\u67e5\u8be2\u65b9\u5f0f\u3002</li> </ol> <p>\u5e38\u89c1NoSQL\u6570\u636e\u5e93\uff1a</p> <ul> <li>\u6587\u6863\u578b\uff1aMongoDB\u3001Couchbase</li> <li>\u952e\u503c\u578b\uff1aRedis\u3001DynamoDB</li> <li>\u5217\u65cf\u578b\uff1aCassandra\u3001HBase</li> <li>\u56fe\u6570\u636e\u5e93\uff1aNeo4j\u3001ArangoDB</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u6570\u636e\u7ed3\u6784\u591a\u53d8\u6216\u975e\u7ed3\u6784\u5316\u7684\u573a\u666f\uff08\u5982\u793e\u4ea4\u5a92\u4f53\u3001\u65e5\u5fd7\u5b58\u50a8\uff09\u3002</li> <li>\u9700\u8981\u9ad8\u5e76\u53d1\u548c\u6c34\u5e73\u6269\u5c55\u7684\u573a\u666f\uff08\u5982\u5927\u6570\u636e\u3001\u5b9e\u65f6\u5206\u6790\uff09\u3002</li> <li>\u5bf9\u4e8b\u52a1\u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"Redis/SQL%E4%B8%8ENoSQL/#sql-vs-nosql","title":"SQL vs NoSQL","text":"\u7279\u6027 SQL NoSQL \u6570\u636e\u6a21\u578b \u7ed3\u6784\u5316\uff0c\u8868\u683c\u5f0f \u7075\u6d3b\uff0c\u652f\u6301\u6587\u6863\u3001\u952e\u503c\u3001\u56fe\u7b49 \u6a21\u5f0f \u56fa\u5b9a\uff0c\u9700\u9884\u5148\u5b9a\u4e49 \u52a8\u6001\uff0c\u65e0\u9700\u56fa\u5b9a\u6a21\u5f0f \u6269\u5c55\u6027 \u5782\u76f4\u6269\u5c55\uff08\u589e\u52a0\u786c\u4ef6\u6027\u80fd\uff09 \u6c34\u5e73\u6269\u5c55\uff08\u589e\u52a0\u8282\u70b9\uff09 \u4e8b\u52a1\u652f\u6301 \u5f3a\uff08ACID\uff09 \u5f31\uff08\u901a\u5e38\u4e3a\u6700\u7ec8\u4e00\u81f4\u6027\uff09 \u67e5\u8be2\u8bed\u8a00 SQL \u65e0\u7edf\u4e00\u8bed\u8a00\uff0c\u4f9d\u8d56\u5177\u4f53\u6570\u636e\u5e93 \u6027\u80fd \u9002\u5408\u590d\u6742\u67e5\u8be2 \u9002\u5408\u9ad8\u5e76\u53d1\u548c\u7b80\u5355\u67e5\u8be2 \u9002\u7528\u573a\u666f \u7ed3\u6784\u5316\u6570\u636e\u3001\u590d\u6742\u5173\u7cfb\u3001\u4e8b\u52a1\u9700\u6c42 \u975e\u7ed3\u6784\u5316\u6570\u636e\u3001\u9ad8\u6269\u5c55\u6027\u9700\u6c42"},{"location":"Redis/SQL%E4%B8%8ENoSQL/#\u9009\u62e9\u4f9d\u636e","title":"\u9009\u62e9\u4f9d\u636e","text":"<ol> <li>\u6570\u636e\u7ed3\u6784\uff1a\u5982\u679c\u6570\u636e\u7ed3\u6784\u56fa\u5b9a\u4e14\u5173\u7cfb\u590d\u6742\uff0c\u9009\u62e9SQL\uff1b\u5982\u679c\u6570\u636e\u7ed3\u6784\u591a\u53d8\uff0c\u9009\u62e9NoSQL\u3002</li> <li>\u6269\u5c55\u9700\u6c42\uff1a\u9700\u8981\u6c34\u5e73\u6269\u5c55\u65f6\uff0cNoSQL\u66f4\u5408\u9002\u3002</li> <li>\u4e8b\u52a1\u9700\u6c42\uff1a\u9700\u8981\u5f3a\u4e00\u81f4\u6027\u4e8b\u52a1\u65f6\uff0c\u9009\u62e9SQL\u3002</li> <li>\u6027\u80fd\u9700\u6c42\uff1a\u9ad8\u5e76\u53d1\u8bfb\u5199\u573a\u666f\u4e0b\uff0cNoSQL\u901a\u5e38\u8868\u73b0\u66f4\u597d\u3002</li> </ol> <p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cSQL\u548cNoSQL\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528\uff0c\u4f8b\u5982\u7528SQL\u5904\u7406\u6838\u5fc3\u4e1a\u52a1\u6570\u636e\uff0c\u7528NoSQL\u5904\u7406\u65e5\u5fd7\u6216\u7f13\u5b58\u6570\u636e\u3002</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/","title":"\u591a\u7ea7\u7f13\u5b58","text":"<p>\u4f20\u7edf\u7684\u7f13\u5b58\u7b56\u7565\u4e00\u822c\u662f\u8bf7\u6c42\u5230\u8fbeTomcat\u540e\uff0c\u5148\u67e5\u8be2Redis\uff0c\u5982\u679c\u672a\u547d\u4e2d\u5219\u67e5\u8be2\u6570\u636e\u5e93</p> <p>\u5b58\u5728\u4e0b\u9762\u7684\u95ee\u9898\uff1a</p> <ul> <li> <p>\u8bf7\u6c42\u8981\u7ecf\u8fc7Tomcat\u5904\u7406\uff0cTomcat\u7684\u6027\u80fd\u6210\u4e3a\u6574\u4e2a\u7cfb\u7edf\u7684\u74f6\u9888</p> </li> <li> <p>Redis\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u4f1a\u5bf9\u6570\u636e\u5e93\u4ea7\u751f\u51b2\u51fb</p> </li> </ul> <p>\u591a\u7ea7\u7f13\u5b58\u5c31\u662f\u5145\u5206\u5229\u7528\u8bf7\u6c42\u5904\u7406\u7684\u6bcf\u4e2a\u73af\u8282\uff0c\u5206\u522b\u6dfb\u52a0\u7f13\u5b58\uff0c\u51cf\u8f7bTomcat\u538b\u529b\uff0c\u63d0\u5347\u670d\u52a1\u6027\u80fd\uff1a</p> <ul> <li>\u6d4f\u89c8\u5668\u8bbf\u95ee\u9759\u6001\u8d44\u6e90\u65f6\uff0c\u4f18\u5148\u8bfb\u53d6\u6d4f\u89c8\u5668\u672c\u5730\u7f13\u5b58</li> <li>\u8bbf\u95ee\u975e\u9759\u6001\u8d44\u6e90\uff08ajax\u67e5\u8be2\u6570\u636e\uff09\u65f6\uff0c\u8bbf\u95ee\u670d\u52a1\u7aef</li> <li>\u8bf7\u6c42\u5230\u8fbeNginx\u540e\uff0c\u4f18\u5148\u8bfb\u53d6Nginx\u672c\u5730\u7f13\u5b58</li> <li>\u5982\u679cNginx\u672c\u5730\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5219\u53bb\u76f4\u63a5\u67e5\u8be2Redis\uff08\u4e0d\u7ecf\u8fc7Tomcat\uff09</li> <li>\u5982\u679cRedis\u67e5\u8be2\u672a\u547d\u4e2d\uff0c\u5219\u67e5\u8be2Tomcat</li> <li>\u8bf7\u6c42\u8fdb\u5165Tomcat\u540e\uff0c\u4f18\u5148\u67e5\u8be2JVM\u8fdb\u7a0b\u7f13\u5b58</li> <li>\u5982\u679cJVM\u8fdb\u7a0b\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5219\u67e5\u8be2\u6570\u636e\u5e93</li> </ul> <p></p> <p>\u5728\u591a\u7ea7\u7f13\u5b58\u67b6\u6784\u4e2d\uff0cNginx\u5185\u90e8\u9700\u8981\u7f16\u5199\u672c\u5730\u7f13\u5b58\u67e5\u8be2\u3001Redis\u67e5\u8be2\u3001Tomcat\u67e5\u8be2\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u56e0\u6b64\u8fd9\u6837\u7684nginx\u670d\u52a1\u4e0d\u518d\u662f\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u800c\u662f\u4e00\u4e2a\u7f16\u5199\u4e1a\u52a1\u7684Web\u670d\u52a1\u5668\u4e86\u3002</p> <p></p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#jvm\u8fdb\u7a0b\u7f13\u5b58","title":"JVM\u8fdb\u7a0b\u7f13\u5b58","text":""},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#caffeine","title":"Caffeine","text":"<ul> <li>\u5206\u5e03\u5f0f\u7f13\u5b58\uff0c\u4f8b\u5982Redis\uff1a<ul> <li>\u4f18\u70b9\uff1a\u5b58\u50a8\u5bb9\u91cf\u66f4\u5927\u3001\u53ef\u9760\u6027\u66f4\u597d\u3001\u53ef\u4ee5\u5728\u96c6\u7fa4\u95f4\u5171\u4eab</li> <li>\u7f3a\u70b9\uff1a\u8bbf\u95ee\u7f13\u5b58\u6709\u7f51\u7edc\u5f00\u9500</li> <li>\u573a\u666f\uff1a\u7f13\u5b58\u6570\u636e\u91cf\u8f83\u5927\u3001\u53ef\u9760\u6027\u8981\u6c42\u8f83\u9ad8\u3001\u9700\u8981\u5728\u96c6\u7fa4\u95f4\u5171\u4eab</li> </ul> </li> <li>\u8fdb\u7a0b\u672c\u5730\u7f13\u5b58\uff0c\u4f8b\u5982HashMap\u3001GuavaCache\uff1a<ul> <li>\u4f18\u70b9\uff1a\u8bfb\u53d6\u672c\u5730\u5185\u5b58\uff0c\u6ca1\u6709\u7f51\u7edc\u5f00\u9500\uff0c\u901f\u5ea6\u66f4\u5feb</li> <li>\u7f3a\u70b9\uff1a\u5b58\u50a8\u5bb9\u91cf\u6709\u9650\u3001\u53ef\u9760\u6027\u8f83\u4f4e\u3001\u65e0\u6cd5\u5171\u4eab</li> <li>\u573a\u666f\uff1a\u6027\u80fd\u8981\u6c42\u8f83\u9ad8\uff0c\u7f13\u5b58\u6570\u636e\u91cf\u8f83\u5c0f</li> </ul> </li> </ul> <p>Caffeine\u662f\u4e00\u4e2a\u57fa\u4e8eJava8\u5f00\u53d1\u7684\uff0c\u63d0\u4f9b\u4e86\u8fd1\u4e4e\u6700\u4f73\u547d\u4e2d\u7387\u7684\u9ad8\u6027\u80fd\u7684\u672c\u5730\u7f13\u5b58\u5e93\u3002\u76ee\u524dSpring\u5185\u90e8\u7684\u7f13\u5b58\u4f7f\u7528\u7684\u5c31\u662fCaffeine\u3002GitHub\u5730\u5740</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.github.ben-manes.caffeine&lt;/groupId&gt;\n    &lt;artifactId&gt;caffeine&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u57fa\u672c\u4f7f\u7528</p> <pre><code>@Test\nvoid testBasicOps() {\n    // \u6784\u5efacache\u5bf9\u8c61\n    Cache&lt;String, String&gt; cache = Caffeine.newBuilder().build();\n\n    // \u5b58\u6570\u636e\n    cache.put(\"gf\", \"\u8fea\u4e3d\u70ed\u5df4\");\n\n    // \u53d6\u6570\u636e\n    String gf = cache.getIfPresent(\"gf\");\n    System.out.println(\"gf = \" + gf);\n\n    // \u53d6\u6570\u636e\uff0c\u5305\u542b\u4e24\u4e2a\u53c2\u6570\uff1a\n    // \u53c2\u6570\u4e00\uff1a\u7f13\u5b58\u7684key\n    // \u53c2\u6570\u4e8c\uff1aLambda\u8868\u8fbe\u5f0f\uff0c\u8868\u8fbe\u5f0f\u53c2\u6570\u5c31\u662f\u7f13\u5b58\u7684key\uff0c\u65b9\u6cd5\u4f53\u662f\u67e5\u8be2\u6570\u636e\u5e93\u7684\u903b\u8f91\n    // \u4f18\u5148\u6839\u636ekey\u67e5\u8be2JVM\u7f13\u5b58\uff0c\u5982\u679c\u672a\u547d\u4e2d\uff0c\u5219\u6267\u884c\u53c2\u6570\u4e8c\u7684Lambda\u8868\u8fbe\u5f0f\n    String defaultGF = cache.get(\"defaultGF\", key -&gt; {\n        // \u6839\u636ekey\u53bb\u6570\u636e\u5e93\u67e5\u8be2\u6570\u636e\n        return \"\u67f3\u5ca9\";\n    });\n    System.out.println(\"defaultGF = \" + defaultGF);\n}\n</code></pre> <p>Caffeine\u63d0\u4f9b\u4e86\u4e09\u79cd\u7f13\u5b58\u6e05\u9664\u7b56\u7565\uff1a</p> <ul> <li>\u57fa\u4e8e\u5bb9\u91cf\uff1a\u8bbe\u7f6e\u7f13\u5b58\u7684\u6570\u91cf\u4e0a\u9650</li> </ul> <pre><code>// \u521b\u5efa\u7f13\u5b58\u5bf9\u8c61\nCache&lt;String, String&gt; cache = Caffeine.newBuilder()\n    .maximumSize(1) // \u8bbe\u7f6e\u7f13\u5b58\u5927\u5c0f\u4e0a\u9650\u4e3a 1\n    .build();\n</code></pre> <ul> <li>\u57fa\u4e8e\u65f6\u95f4\uff1a\u8bbe\u7f6e\u7f13\u5b58\u7684\u6709\u6548\u65f6\u95f4</li> </ul> <pre><code>// \u521b\u5efa\u7f13\u5b58\u5bf9\u8c61\nCache&lt;String, String&gt; cache = Caffeine.newBuilder()\n    // \u8bbe\u7f6e\u7f13\u5b58\u6709\u6548\u671f\u4e3a 10 \u79d2\uff0c\u4ece\u6700\u540e\u4e00\u6b21\u5199\u5165\u5f00\u59cb\u8ba1\u65f6 \n    .expireAfterWrite(Duration.ofSeconds(10)) \n    .build();\n</code></pre> <ul> <li>\u57fa\u4e8e\u5f15\u7528\uff1a\u8bbe\u7f6e\u7f13\u5b58\u4e3a\u8f6f\u5f15\u7528\u6216\u5f31\u5f15\u7528\uff0c\u5229\u7528GC\u6765\u56de\u6536\u7f13\u5b58\u6570\u636e\u3002\u6027\u80fd\u8f83\u5dee\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002</li> </ul> <p>Note</p> <p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u4e00\u4e2a\u7f13\u5b58\u5143\u7d20\u8fc7\u671f\u7684\u65f6\u5019\uff0cCaffeine\u4e0d\u4f1a\u81ea\u52a8\u7acb\u5373\u5c06\u5176\u6e05\u7406\u548c\u9a71\u9010\u3002\u800c\u662f\u5728\u4e00\u6b21\u8bfb\u6216\u5199\u64cd\u4f5c\u540e\uff0c\u6216\u8005\u5728\u7a7a\u95f2\u65f6\u95f4\u5b8c\u6210\u5bf9\u5931\u6548\u6570\u636e\u7684\u9a71\u9010\u3002</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u6848\u4f8b","title":"\u6848\u4f8b","text":"<pre><code>@Configuration\npublic class CaffeineConfig {\n\n    @Bean\n    public Cache&lt;Long, Item&gt; itemCache(){\n        return Caffeine.newBuilder()\n                .initialCapacity(100)\n                .maximumSize(10_000)\n                .build();\n    }\n}\n\n\n@RestController\n@RequestMapping(\"item\")\npublic class ItemController {\n\n    @Autowired\n    private IItemService itemService;\n\n    @Autowired\n    private Cache&lt;Long, Item&gt; itemCache;\n\n    @GetMapping(\"/{id}\")\n    public Item findById(@PathVariable(\"id\") Long id) {\n        // \u5148\u67e5\u8be2\u7f13\u5b58\uff0c\u518d\u5224\u65ad\u662f\u5426\u67e5\u8be2\u6570\u636e\u5e93\n        return itemCache.get(id, key -&gt; itemService.query()\n                .ne(\"status\", 3)\n                .eq(\"id\", key)\n                .one()\n        );\n    }\n}\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#lua\u5165\u95e8","title":"Lua\u5165\u95e8","text":"<p><code>Nginx</code>\u7f16\u7a0b\u9700\u8981\u7528\u5230Lua\u8bed\u8a00\uff0cLua \u662f\u4e00\u79cd\u8f7b\u91cf\u5c0f\u5de7\u7684\u811a\u672c\u8bed\u8a00\uff0c\u7528\u6807\u51c6C\u8bed\u8a00\u7f16\u5199\u5e76\u4ee5\u6e90\u4ee3\u7801\u5f62\u5f0f\u5f00\u653e\uff0c\u5176\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u5d4c\u5165\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u4ece\u800c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7075\u6d3b\u7684\u6269\u5c55\u548c\u5b9a\u5236\u529f\u80fd\u3002\u5b98\u7f51</p> <p>Info</p> <p>Lua\u7ecf\u5e38\u5d4c\u5165\u5230C\u8bed\u8a00\u5f00\u53d1\u7684\u7a0b\u5e8f\u4e2d\uff0c\u4f8b\u5982\u6e38\u620f\u5f00\u53d1\u3001\u6e38\u620f\u63d2\u4ef6\u7b49\u3002 Nginx\u672c\u8eab\u4e5f\u662fC\u8bed\u8a00\u5f00\u53d1\uff0c\u56e0\u6b64\u4e5f\u5141\u8bb8\u57fa\u4e8eLua\u505a\u62d3\u5c55\u3002</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u53d8\u91cf","title":"\u53d8\u91cf","text":"<p>Lua\u4e2d\u652f\u6301\u7684\u5e38\u89c1\u6570\u636e\u7c7b\u578b\u5305\u62ec\uff1a</p> <p></p> <p>Tip</p> <p>Lua\u63d0\u4f9b\u4e86type()\u51fd\u6570\u6765\u5224\u65ad\u4e00\u4e2a\u53d8\u91cf\u7684\u6570\u636e\u7c7b\u578b print(type('hello world')) --------&gt; string</p> <p>Lua\u58f0\u660e\u53d8\u91cf\u7684\u65f6\u5019\u65e0\u9700\u6307\u5b9a\u6570\u636e\u7c7b\u578b\uff0c\u800c\u662f\u7528local\u6765\u58f0\u660e\u53d8\u91cf\u4e3a\u5c40\u90e8\u53d8\u91cf\uff1a</p> <pre><code>-- \u58f0\u660e\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\uff0c\nlocal str = 'hello'\n-- \u5b57\u7b26\u4e32\u62fc\u63a5\u53ef\u4ee5\u4f7f\u7528 ..\nlocal str2 = 'hello' .. 'world'\n-- \u58f0\u660e\u6570\u5b57\nlocal num = 21\n-- \u58f0\u660e\u5e03\u5c14\u7c7b\u578b\nlocal flag = true\n</code></pre> <p>Lua\u4e2d\u7684table\u7c7b\u578b\u65e2\u53ef\u4ee5\u4f5c\u4e3a\u6570\u7ec4\uff0c\u53c8\u53ef\u4ee5\u4f5c\u4e3aJava\u4e2d\u7684map\u6765\u4f7f\u7528\u3002\u6570\u7ec4\u5c31\u662f\u7279\u6b8a\u7684table\uff0ckey\u662f\u6570\u7ec4\u89d2\u6807\u800c\u5df2\uff1a</p> <pre><code>-- \u58f0\u660e\u6570\u7ec4 \uff0ckey\u4e3a\u89d2\u6807\u7684 table\nlocal arr = {'java', 'python', 'lua'}\n-- \u58f0\u660etable\uff0c\u7c7b\u4f3cjava\u7684map\nlocal map =  {name='Jack', age=21}\n</code></pre> <p>Lua\u4e2d\u7684\u6570\u7ec4\u89d2\u6807\u662f\u4ece1\u5f00\u59cb\uff0c\u8bbf\u95ee\u7684\u65f6\u5019\u4e0eJava\u4e2d\u7c7b\u4f3c\uff1a</p> <pre><code>-- \u8bbf\u95ee\u6570\u7ec4\uff0clua\u6570\u7ec4\u7684\u89d2\u6807\u4ece1\u5f00\u59cb\nprint(arr[1])\n</code></pre> <p>Lua\u4e2d\u7684table\u53ef\u4ee5\u7528key\u6765\u8bbf\u95ee\uff1a</p> <pre><code>-- \u8bbf\u95eetable\nprint(map['name'])\nprint(map.age)\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u5faa\u73af","title":"\u5faa\u73af","text":"<p>\u904d\u5386\u6570\u7ec4\uff1a</p> <pre><code>-- \u58f0\u660e\u6570\u7ec4 key\u4e3a\u7d22\u5f15\u7684 table\nlocal arr = {'java', 'python', 'lua'}\n-- \u904d\u5386\u6570\u7ec4\nfor index,value in ipairs(arr) \ndo\n    print(index, value) \nend\n</code></pre> <p>\u904d\u5386\u666e\u901atable</p> <pre><code>-- \u58f0\u660emap\uff0c\u4e5f\u5c31\u662ftable\nlocal map = {name='Jack', age=21}\n-- \u904d\u5386table\nfor key,value in pairs(map) do\n   print(key, value) \nend\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u51fd\u6570","title":"\u51fd\u6570","text":"<p>\u5b9a\u4e49\u51fd\u6570\u7684\u8bed\u6cd5\uff1a</p> <pre><code>function \u51fd\u6570\u540d(argument1, argument2..., argumentn)\n    -- \u51fd\u6570\u4f53\n    return \u8fd4\u56de\u503c\nend\n\n\n-- \u793a\u4f8b\nfunction printArr(arr)\n    for index, value in ipairs(arr) do\n        print(value)\n    end\nend\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u6761\u4ef6\u63a7\u5236","title":"\u6761\u4ef6\u63a7\u5236","text":"<pre><code>if(\u5e03\u5c14\u8868\u8fbe\u5f0f)\nthen\n   --[ \u5e03\u5c14\u8868\u8fbe\u5f0f\u4e3a true \u65f6\u6267\u884c\u8be5\u8bed\u53e5\u5757 --]\nelse\n   --[ \u5e03\u5c14\u8868\u8fbe\u5f0f\u4e3a false \u65f6\u6267\u884c\u8be5\u8bed\u53e5\u5757 --]\nend\n</code></pre> <p>\u4e0ejava\u4e0d\u540c\uff0c\u5e03\u5c14\u8868\u8fbe\u5f0f\u4e2d\u7684\u903b\u8f91\u8fd0\u7b97\u662f\u57fa\u4e8e\u82f1\u6587\u5355\u8bcd\uff1a</p> <p></p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#openresty","title":"OpenResty","text":"<p>OpenResty\u00ae \u662f\u4e00\u4e2a\u57fa\u4e8e Nginx\u7684\u9ad8\u6027\u80fd Web \u5e73\u53f0\uff0c\u7528\u4e8e\u65b9\u4fbf\u5730\u642d\u5efa\u80fd\u591f\u5904\u7406\u8d85\u9ad8\u5e76\u53d1\u3001\u6269\u5c55\u6027\u6781\u9ad8\u7684\u52a8\u6001 Web \u5e94\u7528\u3001Web \u670d\u52a1\u548c\u52a8\u6001\u7f51\u5173\u3002</p> <p>\u5176\u5177\u5907\u4e0b\u5217\u7279\u70b9\uff1a</p> <ul> <li>\u5177\u5907Nginx\u7684\u5b8c\u6574\u529f\u80fd</li> <li>\u57fa\u4e8eLua\u8bed\u8a00\u8fdb\u884c\u6269\u5c55\uff0c\u96c6\u6210\u4e86\u5927\u91cf\u7cbe\u826f\u7684 Lua \u5e93\u3001\u7b2c\u4e09\u65b9\u6a21\u5757</li> <li>\u5141\u8bb8\u4f7f\u7528Lua\u81ea\u5b9a\u4e49\u4e1a\u52a1\u903b\u8f91\u3001\u81ea\u5b9a\u4e49\u5e93</li> </ul> <p>\u5b98\u65b9\u7f51\u7ad9</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#openresty\u76d1\u542c\u8bf7\u6c42","title":"OpenResty\u76d1\u542c\u8bf7\u6c42","text":"<p>OpenResty\u7684\u5f88\u591a\u529f\u80fd\u90fd\u4f9d\u8d56\u4e8e\u5176\u76ee\u5f55\u4e0b\u7684Lua\u5e93\uff0c\u9700\u8981\u5728nginx.conf\u4e2d\u6307\u5b9a\u4f9d\u8d56\u5e93\u7684\u76ee\u5f55\uff0c\u5e76\u5bfc\u5165\u4f9d\u8d56\uff1a</p> <ol> <li> <p>\u6dfb\u52a0\u5bf9OpenResty\u7684Lua\u6a21\u5757\u7684\u52a0\u8f7d</p> <p>\u4fee\u6539<code>/usr/local/openresty/nginx/conf/nginx.conf</code>\u6587\u4ef6\uff0c\u5728\u5176\u4e2d\u7684http\u4e0b\u9762\uff0c\u6dfb\u52a0\u4e0b\u9762\u4ee3\u7801\uff1a</p> <pre><code>##lua \u6a21\u5757\nlua_package_path \"/usr/local/openresty/lualib/?.lua;;\";\n##c\u6a21\u5757     \nlua_package_cpath \"/usr/local/openresty/lualib/?.so;;\";  \n</code></pre> </li> <li> <p>\u76d1\u542c/api/item\u8def\u5f84</p> <p>\u4fee\u6539<code>/usr/local/openresty/nginx/conf/nginx.conf</code>\u6587\u4ef6\uff0c\u5728nginx.conf\u7684server\u4e0b\u9762\uff0c\u6dfb\u52a0\u5bf9/api/item\u8fd9\u4e2a\u8def\u5f84\u7684\u76d1\u542c\uff1a</p> <pre><code>location  /api/item {\n    # \u9ed8\u8ba4\u7684\u54cd\u5e94\u7c7b\u578b\n    default_type application/json;\n    # \u54cd\u5e94\u7ed3\u679c\u7531lua/item.lua\u6587\u4ef6\u6765\u51b3\u5b9a\n    content_by_lua_file lua/item.lua;\n}\n</code></pre> </li> <li> <p>\u5728<code>/usr/loca/openresty/nginx/lua</code>\u6587\u4ef6\u5939\u4e0b\uff0c\u65b0\u5efa\u6587\u4ef6\uff1aitem.lua</p> <pre><code>ngx.say('\u5185\u5bb9')\n</code></pre> </li> </ol>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u8bf7\u6c42\u53c2\u6570\u5904\u7406","title":"\u8bf7\u6c42\u53c2\u6570\u5904\u7406","text":"<p><code>openresty</code>\u63d0\u4f9b\u4e86API\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570</p> <p></p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u67e5\u8be2tomcat","title":"\u67e5\u8be2Tomcat","text":"<p>nginx\u63d0\u4f9b\u4e86\u5185\u90e8API\u7528\u4ee5\u53d1\u9001http\u8bf7\u6c42\uff1a</p> <pre><code>local resp = ngx.location.capture(\"/path\",{\n    method = ngx.HTTP_GET,   -- \u8bf7\u6c42\u65b9\u5f0f\n    args = {a=1,b=2},  -- get\u65b9\u5f0f\u4f20\u53c2\u6570\uff08POST\u65b9\u5f0f\u4f7f\u7528body\uff09\n})\n</code></pre> <p>\u8fd4\u56de\u7684\u54cd\u5e94\u5185\u5bb9\u5305\u62ec\uff1a</p> <ul> <li>resp.status\uff1a\u54cd\u5e94\u72b6\u6001\u7801</li> <li>resp.header\uff1a\u54cd\u5e94\u5934\uff0c\u662f\u4e00\u4e2atable</li> <li>resp.body\uff1a\u54cd\u5e94\u4f53\uff0c\u5c31\u662f\u54cd\u5e94\u6570\u636e</li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u7684path\u662f\u8def\u5f84\uff0c\u5e76\u4e0d\u5305\u542bIP\u548c\u7aef\u53e3\u3002\u8fd9\u4e2a\u8bf7\u6c42\u4f1a\u88abnginx\u5185\u90e8\u7684server\u76d1\u542c\u5e76\u5904\u7406\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u5e0c\u671b\u8fd9\u4e2a\u8bf7\u6c42\u53d1\u9001\u5230Tomcat\u670d\u52a1\u5668\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u7f16\u5199\u4e00\u4e2aserver\u6765\u5bf9\u8fd9\u4e2a\u8def\u5f84\u505a\u53cd\u5411\u4ee3\u7406\uff1a</p> <pre><code> location /path {\n     # Tomcat\u5730\u5740\n     proxy_pass http://IP:PORT; \n }\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u5c01\u88c5http\u5de5\u5177","title":"\u5c01\u88c5http\u5de5\u5177","text":"<p>\u5728<code>/usr/local/openresty/lualib</code>\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efa\u4e00\u4e2acommon.lua\u6587\u4ef6\uff1a</p> <pre><code>vi /usr/local/openresty/lualib/common.lua\n</code></pre> <p>\u5185\u5bb9\u5982\u4e0b:</p> <pre><code>-- \u5c01\u88c5\u51fd\u6570\uff0c\u53d1\u9001http\u8bf7\u6c42\uff0c\u5e76\u89e3\u6790\u54cd\u5e94\nlocal function read_http(path, params)\n    local resp = ngx.location.capture(path,{\n        method = ngx.HTTP_GET,\n        args = params,\n    })\n    if not resp then\n        -- \u8bb0\u5f55\u9519\u8bef\u4fe1\u606f\uff0c\u8fd4\u56de404\n        ngx.log(ngx.ERR, \"http\u8bf7\u6c42\u67e5\u8be2\u5931\u8d25, path: \", path , \", args: \", args)\n        ngx.exit(404)\n    end\n    return resp.body\nend\n-- \u5c06\u65b9\u6cd5\u5bfc\u51fa\nlocal _M = {  \n    read_http = read_http\n}  \nreturn _M\n</code></pre> <p>Tip</p> <p>\u8fd9\u4e2a\u5de5\u5177\u5c06read_http\u51fd\u6570\u5c01\u88c5\u5230_M\u8fd9\u4e2atable\u7c7b\u578b\u7684\u53d8\u91cf\u4e2d\uff0c\u5e76\u4e14\u8fd4\u56de\uff0c\u8fd9\u7c7b\u4f3c\u4e8e\u5bfc\u51fa\u3002 \u4f7f\u7528\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5229\u7528<code>require('common')</code>\u6765\u5bfc\u5165\u8be5\u51fd\u6570\u5e93\uff0c\u8fd9\u91cc\u7684common\u662f\u51fd\u6570\u5e93\u7684\u6587\u4ef6\u540d\u3002</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#cjson\u5de5\u5177\u7c7b","title":"CJSON\u5de5\u5177\u7c7b","text":"<p>OpenResty\u63d0\u4f9b\u4e86\u4e00\u4e2acjson\u7684\u6a21\u5757\u7528\u6765\u5904\u7406JSON\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002</p> <p>\u5b98\u65b9\u5730\u5740</p> <ol> <li> <p>\u5f15\u5165cjson\u6a21\u5757\uff1a</p> <pre><code>local cjson = require \"cjson\"\n</code></pre> </li> <li> <p>\u5e8f\u5217\u5316</p> <pre><code>local obj = {\n    name = 'jack',\n    age = 21\n}\n-- \u628a table \u5e8f\u5217\u5316\u4e3a json\nlocal json = cjson.encode(obj)\n</code></pre> </li> <li> <p>\u53cd\u5e8f\u5217\u5316</p> <pre><code>local json = '{\"name\": \"jack\", \"age\": 21}'\n-- \u53cd\u5e8f\u5217\u5316 json\u4e3a table\nlocal obj = cjson.decode(json);\nprint(obj.name)\n</code></pre> </li> </ol>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u57fa\u4e8eid\u8d1f\u8f7d\u5747\u8861","title":"\u57fa\u4e8eID\u8d1f\u8f7d\u5747\u8861","text":"<p>\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0cOpenResty\u9700\u8981\u5bf9tomcat\u96c6\u7fa4\u505a\u8d1f\u8f7d\u5747\u8861\u3002</p> <p>\u800c\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u5747\u8861\u89c4\u5219\u662f\u8f6e\u8be2\u6a21\u5f0f\uff0c\u4f8b\u5982\uff0c\u5f53\u6211\u4eec\u67e5\u8be2/item/10001\u65f6\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u4f1a\u8bbf\u95ee8081\u7aef\u53e3\u7684tomcat\u670d\u52a1\uff0c\u5728\u8be5\u670d\u52a1\u5185\u90e8\u5c31\u5f62\u6210\u4e86JVM\u8fdb\u7a0b\u7f13\u5b58</li> <li>\u7b2c\u4e8c\u6b21\u4f1a\u8bbf\u95ee8082\u7aef\u53e3\u7684tomcat\u670d\u52a1\uff0c\u8be5\u670d\u52a1\u5185\u90e8\u6ca1\u6709JVM\u7f13\u5b58\uff08\u56e0\u4e3aJVM\u7f13\u5b58\u65e0\u6cd5\u5171\u4eab\uff09\uff0c\u4f1a\u67e5\u8be2\u6570\u636e\u5e93</li> <li>...</li> </ul> <p>\u8fd9\u6837\u5c31\u65e0\u6cd5\u5229\u7528JVM\u8fdb\u7a0b\u7f13\u5b58\uff0c\u5f71\u54cd\u6027\u80fd\u3002</p> <p>nginx\u63d0\u4f9b\u4e86\u57fa\u4e8e\u8bf7\u6c42\u8def\u5f84\u505a\u8d1f\u8f7d\u5747\u8861\u7684\u7b97\u6cd5\uff1a</p> <p>nginx\u6839\u636e\u8bf7\u6c42\u8def\u5f84\u505ahash\u8fd0\u7b97\uff0c\u628a\u5f97\u5230\u7684\u6570\u503c\u5bf9tomcat\u670d\u52a1\u7684\u6570\u91cf\u53d6\u4f59\uff0c\u4f59\u6570\u662f\u51e0\uff0c\u5c31\u8bbf\u95ee\u7b2c\u51e0\u4e2a\u670d\u52a1\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u3002</p> <p>Example</p> <ul> <li>\u6211\u4eec\u7684\u8bf7\u6c42\u8def\u5f84\u662f /item/10001</li> <li>tomcat\u603b\u6570\u4e3a2\u53f0\uff088081\u30018082\uff09</li> <li>\u5bf9\u8bf7\u6c42\u8def\u5f84/item/1001\u505ahash\u8fd0\u7b97\u6c42\u4f59\u7684\u7ed3\u679c\u4e3a1</li> <li>\u5219\u8bbf\u95ee\u7b2c\u4e00\u4e2atomcat\u670d\u52a1\uff0c\u4e5f\u5c31\u662f8081</li> </ul> <p>\u53ea\u8981id\u4e0d\u53d8\uff0c\u6bcf\u6b21hash\u8fd0\u7b97\u7ed3\u679c\u4e5f\u4e0d\u4f1a\u53d8\uff0c\u90a3\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u4e2a\u5546\u54c1\uff0c\u4e00\u76f4\u8bbf\u95ee\u540c\u4e00\u4e2atomcat\u670d\u52a1\uff0c\u786e\u4fddJVM\u7f13\u5b58\u751f\u6548\u3002</p> <p>\u5b9e\u73b0</p> <p>\u4fee\u6539<code>/usr/local/openresty/nginx/conf/nginx.conf</code>\u6587\u4ef6\uff0c\u5b9e\u73b0\u57fa\u4e8eID\u505a\u8d1f\u8f7d\u5747\u8861\u3002</p> <p>\u9996\u5148\uff0c\u5b9a\u4e49tomcat\u96c6\u7fa4\uff0c\u5e76\u8bbe\u7f6e\u57fa\u4e8e\u8def\u5f84\u505a\u8d1f\u8f7d\u5747\u8861\uff1a</p> <pre><code>upstream tomcat-cluster {\n    hash $request_uri;\n    server 192.168.150.1:8081;\n    server 192.168.150.1:8082;\n}\n</code></pre> <p>\u7136\u540e\uff0c\u4fee\u6539\u5bf9tomcat\u670d\u52a1\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u76ee\u6807\u6307\u5411tomcat\u96c6\u7fa4\uff1a</p> <pre><code>location /item {\n    proxy_pass http://tomcat-cluster;\n}\n</code></pre> <p>\u91cd\u65b0\u52a0\u8f7dOpenResty</p> <pre><code>nginx -s reload\n</code></pre>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#redis\u7f13\u5b58","title":"Redis\u7f13\u5b58","text":"<p>Redis\u7f13\u5b58\u9884\u70ed</p> <p>Redis\u7f13\u5b58\u4f1a\u9762\u4e34\u51b7\u542f\u52a8\u95ee\u9898\uff1a</p> <p>\u51b7\u542f\u52a8\uff1a\u670d\u52a1\u521a\u521a\u542f\u52a8\u65f6\uff0cRedis\u4e2d\u5e76\u6ca1\u6709\u7f13\u5b58\uff0c\u5982\u679c\u6240\u6709\u5546\u54c1\u6570\u636e\u90fd\u5728\u7b2c\u4e00\u6b21\u67e5\u8be2\u65f6\u6dfb\u52a0\u7f13\u5b58\uff0c\u53ef\u80fd\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u8f83\u5927\u538b\u529b\u3002</p> <p>\u7f13\u5b58\u9884\u70ed\uff1a\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5927\u6570\u636e\u7edf\u8ba1\u7528\u6237\u8bbf\u95ee\u7684\u70ed\u70b9\u6570\u636e\uff0c\u5728\u9879\u76ee\u542f\u52a8\u65f6\u5c06\u8fd9\u4e9b\u70ed\u70b9\u6570\u636e\u63d0\u524d\u67e5\u8be2\u5e76\u4fdd\u5b58\u5230Redis\u4e2d\u3002</p> <p>Tip</p> <p>\u53ef\u4ee5\u5229\u7528<code>InitializingBean</code>\u63a5\u53e3\u6765\u5b9e\u73b0\uff0c\u56e0\u4e3a<code>InitializingBean</code>\u4e2d\u7684\u65b9\u6cd5<code>afterPropertiesSet</code>\u53ef\u4ee5\u5728\u5bf9\u8c61\u88abSpring\u521b\u5efa\u5e76\u4e14\u6210\u5458\u53d8\u91cf\u5168\u90e8\u6ce8\u5165\u540e\u6267\u884c\u3002</p> <p>\u67e5\u8be2Redis\u7f13\u5b58</p> <p>\u5f53\u8bf7\u6c42\u8fdb\u5165OpenResty\u4e4b\u540e\uff1a</p> <ul> <li>\u4f18\u5148\u67e5\u8be2Redis\u7f13\u5b58</li> <li>\u5982\u679cRedis\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u518d\u67e5\u8be2Tomcat</li> </ul> <p>OpenResty\u63d0\u4f9b\u4e86\u64cd\u4f5cRedis\u7684\u6a21\u5757\uff0c\u6211\u4eec\u53ea\u8981\u5f15\u5165\u8be5\u6a21\u5757\u5c31\u80fd\u76f4\u63a5\u4f7f\u7528\u3002\u4f46\u662f\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u5c06Redis\u64cd\u4f5c\u5c01\u88c5\u5230\u4e4b\u524d\u7684common.lua\u5de5\u5177\u5e93\u4e2d\u3002</p> <p>\u4fee\u6539<code>/usr/local/openresty/lualib/common.lua</code>\u6587\u4ef6\uff1a</p> <ol> <li> <p>\u5f15\u5165Redis\u6a21\u5757\uff0c\u5e76\u521d\u59cb\u5316Redis\u5bf9\u8c61</p> <pre><code>-- \u5bfc\u5165redis\nlocal redis = require('resty.redis')\n-- \u521d\u59cb\u5316redis\nlocal red = redis:new()\nred:set_timeouts(1000, 1000, 1000)\n</code></pre> </li> <li> <p>\u5c01\u88c5\u51fd\u6570\uff0c\u7528\u6765\u91ca\u653eRedis\u8fde\u63a5\uff0c\u5176\u5b9e\u662f\u653e\u5165\u8fde\u63a5\u6c60</p> <pre><code>-- \u5173\u95edredis\u8fde\u63a5\u7684\u5de5\u5177\u65b9\u6cd5\uff0c\u5176\u5b9e\u662f\u653e\u5165\u8fde\u63a5\u6c60\nlocal function close_redis(red)\n    local pool_max_idle_time = 10000 -- \u8fde\u63a5\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\n    local pool_size = 100 --\u8fde\u63a5\u6c60\u5927\u5c0f\n    local ok, err = red:set_keepalive(pool_max_idle_time, pool_size)\n    if not ok then\n        ngx.log(ngx.ERR, \"\u653e\u5165redis\u8fde\u63a5\u6c60\u5931\u8d25: \", err)\n    end\nend\n</code></pre> </li> <li> <p>\u5c01\u88c5\u51fd\u6570\uff0c\u6839\u636ekey\u67e5\u8be2Redis\u6570\u636e</p> <pre><code>-- \u67e5\u8be2redis\u7684\u65b9\u6cd5 ip\u548cport\u662fredis\u5730\u5740\uff0ckey\u662f\u67e5\u8be2\u7684key\nlocal function read_redis(ip, port, key)\n    -- \u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\n    local ok, err = red:connect(ip, port)\n    if not ok then\n        ngx.log(ngx.ERR, \"\u8fde\u63a5redis\u5931\u8d25 : \", err)\n        return nil\n    end\n    -- \u67e5\u8be2redis\n    local resp, err = red:get(key)\n    -- \u67e5\u8be2\u5931\u8d25\u5904\u7406\n    if not resp then\n        ngx.log(ngx.ERR, \"\u67e5\u8be2Redis\u5931\u8d25: \", err, \", key = \" , key)\n    end\n    --\u5f97\u5230\u7684\u6570\u636e\u4e3a\u7a7a\u5904\u7406\n    if resp == ngx.null then\n        resp = nil\n        ngx.log(ngx.ERR, \"\u67e5\u8be2Redis\u6570\u636e\u4e3a\u7a7a, key = \", key)\n    end\n    close_redis(red)\n    return resp\nend\n</code></pre> </li> <li> <p>\u5bfc\u51fa</p> <pre><code>-- \u5c06\u65b9\u6cd5\u5bfc\u51fa\nlocal _M = {  \n    read_http = read_http,\n    read_redis = read_redis\n}  \nreturn _M\n</code></pre> </li> </ol>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#nginx\u672c\u5730\u7f13\u5b58","title":"Nginx\u672c\u5730\u7f13\u5b58","text":"<p>OpenResty\u4e3aNginx\u63d0\u4f9b\u4e86shared dict\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5728nginx\u7684\u591a\u4e2aworker\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u5b9e\u73b0\u7f13\u5b58\u529f\u80fd\u3002</p> <ol> <li> <p>\u5f00\u542f\u5171\u4eab\u5b57\u5178\uff0c\u5728nginx.conf\u7684http\u4e0b\u6dfb\u52a0\u914d\u7f6e\uff1a</p> <pre><code># \u5171\u4eab\u5b57\u5178\uff0c\u4e5f\u5c31\u662f\u672c\u5730\u7f13\u5b58\uff0c\u540d\u79f0\u53eb\u505a\uff1aitem_cache\uff0c\u5927\u5c0f150m\nlua_shared_dict item_cache 150m; \n</code></pre> </li> <li> <p>\u64cd\u4f5c\u5171\u4eab\u5b57\u5178\uff1a</p> <pre><code>-- \u83b7\u53d6\u672c\u5730\u7f13\u5b58\u5bf9\u8c61\nlocal item_cache = ngx.shared.item_cache\n-- \u5b58\u50a8, \u6307\u5b9akey\u3001value\u3001\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4ds\uff0c\u9ed8\u8ba4\u4e3a0\u4ee3\u8868\u6c38\u4e0d\u8fc7\u671f\nitem_cache:set('key', 'value', 1000)\n-- \u8bfb\u53d6\nlocal val = item_cache:get('key')\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>-- \u5bfc\u5165\u5171\u4eab\u8bcd\u5178\uff0c\u672c\u5730\u7f13\u5b58\nlocal item_cache = ngx.shared.item_cache\n\n-- \u5c01\u88c5\u67e5\u8be2\u51fd\u6570\nfunction read_data(key, expire, path, params)\n    -- \u67e5\u8be2\u672c\u5730\u7f13\u5b58\n    local val = item_cache:get(key)\n    if not val then\n        ngx.log(ngx.ERR, \"\u672c\u5730\u7f13\u5b58\u67e5\u8be2\u5931\u8d25\uff0c\u5c1d\u8bd5\u67e5\u8be2Redis\uff0c key: \", key)\n        -- \u67e5\u8be2redis\n        val = read_redis(\"127.0.0.1\", 6379, key)\n        -- \u5224\u65ad\u67e5\u8be2\u7ed3\u679c\n        if not val then\n            ngx.log(ngx.ERR, \"redis\u67e5\u8be2\u5931\u8d25\uff0c\u5c1d\u8bd5\u67e5\u8be2http\uff0c key: \", key)\n            -- redis\u67e5\u8be2\u5931\u8d25\uff0c\u53bb\u67e5\u8be2http\n            val = read_http(path, params)\n        end\n    end\n    -- \u67e5\u8be2\u6210\u529f\uff0c\u628a\u6570\u636e\u5199\u5165\u672c\u5730\u7f13\u5b58\n    item_cache:set(key, val, expire)\n    -- \u8fd4\u56de\u6570\u636e\n    return val\nend\n</code></pre> </li> </ol>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u7f13\u5b58\u540c\u6b65","title":"\u7f13\u5b58\u540c\u6b65","text":"<p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6d4f\u89c8\u5668\u67e5\u8be2\u5230\u7684\u90fd\u662f\u7f13\u5b58\u6570\u636e\uff0c\u5982\u679c\u7f13\u5b58\u6570\u636e\u4e0e\u6570\u636e\u5e93\u6570\u636e\u5b58\u5728\u8f83\u5927\u5dee\u5f02\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u6bd4\u8f83\u4e25\u91cd\u7684\u540e\u679c\u3002 \u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6570\u636e\u5e93\u6570\u636e\u3001\u7f13\u5b58\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u7684\u540c\u6b65\u3002</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u7f13\u5b58\u540c\u6b65\u7b56\u7565","title":"\u7f13\u5b58\u540c\u6b65\u7b56\u7565","text":"<ol> <li> <p>\u8bbe\u7f6e\u6709\u6548\u671f\uff1a\u7ed9\u7f13\u5b58\u8bbe\u7f6e\u6709\u6548\u671f\uff0c\u5230\u671f\u540e\u81ea\u52a8\u5220\u9664\u3002\u518d\u6b21\u67e5\u8be2\u65f6\u66f4\u65b0</p> <ul> <li> <p>\u4f18\u52bf\uff1a\u7b80\u5355\u3001\u65b9\u4fbf</p> </li> <li> <p>\u7f3a\u70b9\uff1a\u65f6\u6548\u6027\u5dee\uff0c\u7f13\u5b58\u8fc7\u671f\u4e4b\u524d\u53ef\u80fd\u4e0d\u4e00\u81f4</p> </li> <li> <p>\u573a\u666f\uff1a\u66f4\u65b0\u9891\u7387\u8f83\u4f4e\uff0c\u65f6\u6548\u6027\u8981\u6c42\u4f4e\u7684\u4e1a\u52a1</p> </li> </ul> </li> <li> <p>\u540c\u6b65\u53cc\u5199\uff1a\u5728\u4fee\u6539\u6570\u636e\u5e93\u7684\u540c\u65f6\uff0c\u76f4\u63a5\u4fee\u6539\u7f13\u5b58</p> <ul> <li> <p>\u4f18\u52bf\uff1a\u65f6\u6548\u6027\u5f3a\uff0c\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u5f3a\u4e00\u81f4</p> </li> <li> <p>\u7f3a\u70b9\uff1a\u6709\u4ee3\u7801\u4fb5\u5165\uff0c\u8026\u5408\u5ea6\u9ad8</p> </li> <li> <p>\u573a\u666f\uff1a\u5bf9\u4e00\u81f4\u6027\u3001\u65f6\u6548\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u7f13\u5b58\u6570\u636e</p> </li> </ul> </li> <li> <p>\u5f02\u6b65\u901a\u77e5\uff1a\u4fee\u6539\u6570\u636e\u5e93\u65f6\u53d1\u9001\u4e8b\u4ef6\u901a\u77e5\uff0c\u76f8\u5173\u670d\u52a1\u76d1\u542c\u5230\u901a\u77e5\u540e\u4fee\u6539\u7f13\u5b58\u6570\u636e</p> <ul> <li> <p>\u4f18\u52bf\uff1a\u4f4e\u8026\u5408\uff0c\u53ef\u4ee5\u540c\u65f6\u901a\u77e5\u591a\u4e2a\u7f13\u5b58\u670d\u52a1</p> </li> <li> <p>\u7f3a\u70b9\uff1a\u65f6\u6548\u6027\u4e00\u822c\uff0c\u53ef\u80fd\u5b58\u5728\u4e2d\u95f4\u4e0d\u4e00\u81f4\u72b6\u6001</p> </li> <li> <p>\u573a\u666f\uff1a\u65f6\u6548\u6027\u8981\u6c42\u4e00\u822c\uff0c\u6709\u591a\u4e2a\u670d\u52a1\u9700\u8981\u540c\u6b65</p> </li> </ul> </li> </ol> <p>\u5f02\u6b65\u901a\u77e5\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u57fa\u4e8e<code>MQ</code>\uff08\u6709\u5c11\u91cf\u7684\u4ee3\u7801\u4fb5\u5165\uff09\u6216\u8005<code>Canal</code>\uff08\u4ee3\u7801\u96f6\u4fb5\u5165\uff09</p> <p></p> <p></p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#canal","title":"Canal","text":"<p>Canal [k\u0259'n\u00e6l]\uff0c\u8bd1\u610f\u4e3a\u6c34\u9053/\u7ba1\u9053/\u6c9f\u6e20\uff0ccanal\u662f\u963f\u91cc\u5df4\u5df4\u65d7\u4e0b\u7684\u4e00\u6b3e\u5f00\u6e90\u9879\u76ee\uff0c\u57fa\u4e8eJava\u5f00\u53d1\u3002\u57fa\u4e8e\u6570\u636e\u5e93\u589e\u91cf\u65e5\u5fd7\u89e3\u6790\uff0c\u63d0\u4f9b\u589e\u91cf\u6570\u636e\u8ba2\u9605&amp;\u6d88\u8d39\u3002GitHub\u7684\u5730\u5740</p> <p>Canal\u662f\u57fa\u4e8emysql\u7684\u4e3b\u4ece\u540c\u6b65\u6765\u5b9e\u73b0\u7684\uff08Canal\u5c31\u662f\u628a\u81ea\u5df1\u4f2a\u88c5\u6210MySQL\u7684\u4e00\u4e2aslave\u8282\u70b9\uff0c\u4ece\u800c\u76d1\u542cmaster\u7684binary log\u53d8\u5316\uff09\uff0c\u518d\u628a\u5f97\u5230\u7684\u53d8\u5316\u4fe1\u606f\u901a\u77e5\u7ed9Canal\u7684\u5ba2\u6237\u7aef\uff0c\u8fdb\u800c\u5b8c\u6210\u5bf9\u5176\u5b83\u6570\u636e\u5e93\u7684\u540c\u6b65\u3002</p> <p>\u914d\u7f6e\u5b89\u88c5\u8fc7\u7a0b\u8be6\u89c1Canal\u5b89\u88c5</p>"},{"location":"Redis/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/#\u76d1\u542ccanal","title":"\u76d1\u542cCanal","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528Canal\u63d0\u4f9b\u7684Java\u5ba2\u6237\u7aef\uff0c\u76d1\u542cCanal\u901a\u77e5\u6d88\u606f\u3002\u5f53\u6536\u5230\u53d8\u5316\u7684\u6d88\u606f\u65f6\uff0c\u5b8c\u6210\u5bf9\u7f13\u5b58\u7684\u66f4\u65b0\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528GitHub\u4e0a\u7684\u7b2c\u4e09\u65b9\u5f00\u6e90\u7684canal-starter\u5ba2\u6237\u7aef\u3002\u5730\u5740\uff1ahttps://github.com/NormanGyllenhaal/canal-client</p> <p>\u4e0eSpringBoot\u5b8c\u7f8e\u6574\u5408\uff0c\u81ea\u52a8\u88c5\u914d\u3002</p> <ol> <li> <p>\u5f15\u5165\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;top.javatool&lt;/groupId&gt;\n    &lt;artifactId&gt;canal-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;1.2.1-RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u914d\u7f6e\u6587\u4ef6</p> <pre><code>canal:\ndestination: heima # canal\u7684\u96c6\u7fa4\u540d\u5b57\uff0c\u8981\u4e0e\u5b89\u88c5canal\u65f6\u8bbe\u7f6e\u7684\u540d\u79f0\u4e00\u81f4\nserver: 192.168.150.101:11111 # canal\u670d\u52a1\u5730\u5740\n</code></pre> </li> <li> <p>\u4fee\u6539\u5b9e\u4f53\u7c7b</p> <p>\u901a\u8fc7<code>@Id</code>\u3001<code>@Column</code> \u7b49\u6ce8\u89e3\u5b8c\u6210\u5b9e\u4f53\u7c7b\u4e0e\u6570\u636e\u5e93\u8868\u5b57\u6bb5\u7684\u6620\u5c04</p> <pre><code>@Data\n@TableName(\"tb_item\")\npublic class Item {\n    @TableId(type = IdType.AUTO)\n    @Id\n    private Long id;//\u5546\u54c1id\n\n    @Column(name = \"name\")\n    private String name;//\u5546\u54c1\u540d\u79f0\n\n    private String title;//\u5546\u54c1\u6807\u9898\n    private Long price;//\u4ef7\u683c\uff08\u5206\uff09\n    private String image;//\u5546\u54c1\u56fe\u7247\n    private String category;//\u5206\u7c7b\u540d\u79f0\n    private String brand;//\u54c1\u724c\u540d\u79f0\n    private String spec;//\u89c4\u683c\n    private Integer status;//\u5546\u54c1\u72b6\u6001 1-\u6b63\u5e38\uff0c2-\u4e0b\u67b6\n    private Date createTime;//\u521b\u5efa\u65f6\u95f4\n    private Date updateTime;//\u66f4\u65b0\u65f6\u95f4\n\n    @TableField(exist = false)\n    @Transient  // \u4e0d\u5c5e\u4e8e\u6570\u636e\u5e93\u8868\u7684\u6570\u636e\n    private Integer stock;\n\n    @TableField(exist = false)\n    @Transient\n    private Integer sold;\n}\n</code></pre> </li> <li> <p>\u7f16\u5199\u76d1\u542c\u5668</p> <p>\u901a\u8fc7\u5b9e\u73b0<code>EntryHandler&lt;T&gt;</code>\u63a5\u53e3\u7f16\u5199\u76d1\u542c\u5668\uff0c\u76d1\u542cCanal\u6d88\u606f\u3002\u6ce8\u610f\u4e24\u70b9\uff1a</p> <ul> <li>\u5b9e\u73b0\u7c7b\u901a\u8fc7<code>@CanalTable(\"tb_item\")</code>\u6307\u5b9a\u76d1\u542c\u7684\u8868\u4fe1\u606f</li> <li><code>EntryHandler</code>\u7684\u6cdb\u578b\u662f\u4e0e\u8868\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b</li> </ul> <pre><code>@CanalTable(\"tb_item\")  // \u76d1\u542c\u7684\u6570\u636e\u5e93\u8868\u540d\n@Component\npublic class ItemHandler implements EntryHandler&lt;Item&gt; {\n\n    @Autowired\n    private RedisHandler redisHandler;  // \u5c01\u88c5\u7684Redis\u64cd\u4f5c\u7c7b\uff0c\u53ef\u4f7f\u7528StringRedisTemplate\u7c7b\u4ee3\u66ff\n    @Autowired\n    private Cache&lt;Long, Item&gt; itemCache;\n\n    @Override\n    public void insert(Item item) {\n        // \u5199\u6570\u636e\u5230JVM\u8fdb\u7a0b\u7f13\u5b58\n        itemCache.put(item.getId(), item);\n        // \u5199\u6570\u636e\u5230redis\n        redisHandler.saveItem(item);\n    }\n\n    @Override\n    public void update(Item before, Item after) {\n        // \u5199\u6570\u636e\u5230JVM\u8fdb\u7a0b\u7f13\u5b58\n        itemCache.put(after.getId(), after);\n        // \u5199\u6570\u636e\u5230redis\n        redisHandler.saveItem(after);\n    }\n\n    @Override\n    public void delete(Item item) {\n        // \u5220\u9664\u6570\u636e\u5230JVM\u8fdb\u7a0b\u7f13\u5b58\n        itemCache.invalidate(item.getId());\n        // \u5220\u9664\u6570\u636e\u5230redis\n        redisHandler.deleteItemById(item.getId());\n    }\n}\n</code></pre> </li> </ol>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/","title":"\u5b89\u88c5\u548c\u914d\u7f6eCanal","text":"<p>\u4e0b\u9762\u6211\u4eec\u5c31\u5f00\u542fmysql\u7684\u4e3b\u4ece\u540c\u6b65\u673a\u5236\uff0c\u8ba9Canal\u6765\u6a21\u62dfsalve</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#1\u5f00\u542fmysql\u4e3b\u4ece","title":"1.\u5f00\u542fMySQL\u4e3b\u4ece","text":"<p>Canal\u662f\u57fa\u4e8eMySQL\u7684\u4e3b\u4ece\u540c\u6b65\u529f\u80fd\uff0c\u56e0\u6b64\u5fc5\u987b\u5148\u5f00\u542fMySQL\u7684\u4e3b\u4ece\u529f\u80fd\u624d\u53ef\u4ee5\u3002</p> <p>\u8fd9\u91cc\u4ee5\u4e4b\u524d\u7528Docker\u8fd0\u884c\u7684mysql\u4e3a\u4f8b\uff1a</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#11\u5f00\u542fbinlog","title":"1.1.\u5f00\u542fbinlog","text":"<p>\u6253\u5f00mysql\u5bb9\u5668\u6302\u8f7d\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u6211\u7684\u5728<code>/tmp/mysql/conf</code>\u76ee\u5f55:</p> <p>\u4fee\u6539\u6587\u4ef6\uff1a</p> <pre><code>vi /tmp/mysql/conf/my.cnf\n</code></pre> <p>\u6dfb\u52a0\u5185\u5bb9\uff1a</p> <pre><code>log-bin=/var/lib/mysql/mysql-bin\nbinlog-do-db=heima\n</code></pre> <p>\u914d\u7f6e\u89e3\u8bfb\uff1a</p> <ul> <li><code>log-bin=/var/lib/mysql/mysql-bin</code>\uff1a\u8bbe\u7f6ebinary log\u6587\u4ef6\u7684\u5b58\u653e\u5730\u5740\u548c\u6587\u4ef6\u540d\uff0c\u53eb\u505amysql-bin</li> <li><code>binlog-do-db=heima</code>\uff1a\u6307\u5b9a\u5bf9\u54ea\u4e2adatabase\u8bb0\u5f55binary log events\uff0c\u8fd9\u91cc\u8bb0\u5f55heima\u8fd9\u4e2a\u5e93</li> </ul> <p>\u6700\u7ec8\u6548\u679c\uff1a</p> <pre><code>[mysqld]\nskip-name-resolve\ncharacter_set_server=utf8\ndatadir=/var/lib/mysql\nserver-id=1000\nlog-bin=/var/lib/mysql/mysql-bin\nbinlog-do-db=heima\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#12\u8bbe\u7f6e\u7528\u6237\u6743\u9650","title":"1.2.\u8bbe\u7f6e\u7528\u6237\u6743\u9650","text":"<p>\u63a5\u4e0b\u6765\u6dfb\u52a0\u4e00\u4e2a\u4ec5\u7528\u4e8e\u6570\u636e\u540c\u6b65\u7684\u8d26\u6237\uff0c\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u8fd9\u91cc\u4ec5\u63d0\u4f9b\u5bf9heima\u8fd9\u4e2a\u5e93\u7684\u64cd\u4f5c\u6743\u9650\u3002</p> <pre><code>create user canal@'%' IDENTIFIED by 'canal';\nGRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO 'canal'@'%' identified by 'canal';\nFLUSH PRIVILEGES;\n</code></pre> <p>\u91cd\u542fmysql\u5bb9\u5668\u5373\u53ef</p> <pre><code>docker restart mysql\n</code></pre> <p>\u6d4b\u8bd5\u8bbe\u7f6e\u662f\u5426\u6210\u529f\uff1a\u5728mysql\u63a7\u5236\u53f0\uff0c\u6216\u8005Navicat\u4e2d\uff0c\u8f93\u5165\u547d\u4ee4\uff1a</p> <pre><code>show master status;\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#2\u5b89\u88c5canal","title":"2.\u5b89\u88c5Canal","text":""},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#21\u521b\u5efa\u7f51\u7edc","title":"2.1.\u521b\u5efa\u7f51\u7edc","text":"<p>\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7f51\u7edc\uff0c\u5c06MySQL\u3001Canal\u3001MQ\u653e\u5230\u540c\u4e00\u4e2aDocker\u7f51\u7edc\u4e2d\uff1a</p> <pre><code>docker network create heima\n</code></pre> <p>\u8ba9mysql\u52a0\u5165\u8fd9\u4e2a\u7f51\u7edc\uff1a</p> <pre><code>docker network connect heima mysql\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85Canal/#23\u5b89\u88c5canal","title":"2.3.\u5b89\u88c5Canal","text":"<p>\u4f7f\u7528<code>docker</code>\u5b89\u88c5</p> <p>\u8fd0\u884c\u547d\u4ee4\u521b\u5efaCanal\u5bb9\u5668\uff1a</p> <pre><code>docker run -p 11111:11111 --name canal \\\n-e canal.destinations=heima \\\n-e canal.instance.master.address=mysql:3306  \\\n-e canal.instance.dbUsername=canal  \\\n-e canal.instance.dbPassword=canal  \\\n-e canal.instance.connectionCharset=UTF-8 \\\n-e canal.instance.tsdb.enable=true \\\n-e canal.instance.gtidon=false  \\\n-e canal.instance.filter.regex=heima\\\\..* \\\n--network heima \\\n-d canal/canal-server:v1.1.5\n</code></pre> <p>\u8bf4\u660e:</p> <ul> <li><code>-p 11111:11111</code>\uff1a\u8fd9\u662fcanal\u7684\u9ed8\u8ba4\u76d1\u542c\u7aef\u53e3</li> <li><code>-e canal.instance.master.address=mysql:3306</code>\uff1a\u6570\u636e\u5e93\u5730\u5740\u548c\u7aef\u53e3\uff0c\u5982\u679c\u4e0d\u77e5\u9053mysql\u5bb9\u5668\u5730\u5740\uff0c\u53ef\u4ee5\u901a\u8fc7<code>docker inspect \u5bb9\u5668id</code>\u6765\u67e5\u770b</li> <li><code>-e canal.instance.dbUsername=canal</code>\uff1a\u6570\u636e\u5e93\u7528\u6237\u540d</li> <li><code>-e canal.instance.dbPassword=canal</code> \uff1a\u6570\u636e\u5e93\u5bc6\u7801</li> <li><code>-e canal.instance.filter.regex=</code>\uff1a\u8981\u76d1\u542c\u7684\u8868\u540d\u79f0</li> </ul> <p>\u8868\u540d\u79f0\u76d1\u542c\u652f\u6301\u7684\u8bed\u6cd5\uff1a</p> <pre><code>mysql \u6570\u636e\u89e3\u6790\u5173\u6ce8\u7684\u8868\uff0cPerl\u6b63\u5219\u8868\u8fbe\u5f0f.\n\u591a\u4e2a\u6b63\u5219\u4e4b\u95f4\u4ee5\u9017\u53f7(,)\u5206\u9694\uff0c\u8f6c\u4e49\u7b26\u9700\u8981\u53cc\u659c\u6760(\\\\) \n\u5e38\u89c1\u4f8b\u5b50\uff1a\n1.  \u6240\u6709\u8868\uff1a.*   or  .*\\\\..*\n2.  canal schema\u4e0b\u6240\u6709\u8868\uff1a canal\\\\..*\n3.  canal\u4e0b\u7684\u4ee5canal\u6253\u5934\u7684\u8868\uff1acanal\\\\.canal.*\n4.  canal schema\u4e0b\u7684\u4e00\u5f20\u8868\uff1acanal.test1\n5.  \u591a\u4e2a\u89c4\u5219\u7ec4\u5408\u4f7f\u7528\u7136\u540e\u4ee5\u9017\u53f7\u9694\u5f00\uff1acanal\\\\..*,mysql.test1,mysql.test2 \n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/","title":"\u5b89\u88c5OpenResty","text":""},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#1\u5b89\u88c5","title":"1.\u5b89\u88c5","text":"<p>\u9996\u5148\u4f60\u7684Linux\u865a\u62df\u673a\u5fc5\u987b\u8054\u7f51</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#1\u5b89\u88c5\u5f00\u53d1\u5e93","title":"1\uff09\u5b89\u88c5\u5f00\u53d1\u5e93","text":"<p>\u9996\u5148\u8981\u5b89\u88c5OpenResty\u7684\u4f9d\u8d56\u5f00\u53d1\u5e93\uff0c\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>yum install -y pcre-devel openssl-devel gcc --skip-broken\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#2\u5b89\u88c5openresty\u4ed3\u5e93","title":"2\uff09\u5b89\u88c5OpenResty\u4ed3\u5e93","text":"<p>\u4f60\u53ef\u4ee5\u5728\u4f60\u7684 CentOS \u7cfb\u7edf\u4e2d\u6dfb\u52a0 <code>openresty</code> \u4ed3\u5e93\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fbf\u4e8e\u672a\u6765\u5b89\u88c5\u6216\u66f4\u65b0\u6211\u4eec\u7684\u8f6f\u4ef6\u5305\uff08\u901a\u8fc7 <code>yum check-update</code> \u547d\u4ee4\uff09\u3002\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u53ef\u4ee5\u6dfb\u52a0\u6211\u4eec\u7684\u4ed3\u5e93\uff1a</p> <pre><code>yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo\n</code></pre> <p>\u5982\u679c\u63d0\u793a\u8bf4\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u5219\u8fd0\u884c\uff1a</p> <pre><code>yum install -y yum-utils \n</code></pre> <p>\u7136\u540e\u518d\u91cd\u590d\u4e0a\u9762\u7684\u547d\u4ee4</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#3\u5b89\u88c5openresty","title":"3\uff09\u5b89\u88c5OpenResty","text":"<p>\u7136\u540e\u5c31\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u6837\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u6bd4\u5982 <code>openresty</code>\uff1a</p> <pre><code>yum install -y openresty\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#4\u5b89\u88c5opm\u5de5\u5177","title":"4\uff09\u5b89\u88c5opm\u5de5\u5177","text":"<p>opm\u662fOpenResty\u7684\u4e00\u4e2a\u7ba1\u7406\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5b89\u88c5\u4e00\u4e2a\u7b2c\u4e09\u65b9\u7684Lua\u6a21\u5757\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u5b89\u88c5\u547d\u4ee4\u884c\u5de5\u5177 <code>opm</code>\uff0c\u90a3\u4e48\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u6837\u5b89\u88c5 <code>openresty-opm</code> \u5305\uff1a</p> <pre><code>yum install -y openresty-opm\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#5\u76ee\u5f55\u7ed3\u6784","title":"5\uff09\u76ee\u5f55\u7ed3\u6784","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cOpenResty\u5b89\u88c5\u7684\u76ee\u5f55\u662f\uff1a/usr/local/openresty</p> <p>\u770b\u5230\u91cc\u9762\u7684nginx\u76ee\u5f55\u4e86\u5417\uff0cOpenResty\u5c31\u662f\u5728Nginx\u57fa\u7840\u4e0a\u96c6\u6210\u4e86\u4e00\u4e9bLua\u6a21\u5757\u3002</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#6\u914d\u7f6enginx\u7684\u73af\u5883\u53d8\u91cf","title":"6\uff09\u914d\u7f6enginx\u7684\u73af\u5883\u53d8\u91cf","text":"<p>\u6253\u5f00\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>vi /etc/profile\n</code></pre> <p>\u5728\u6700\u4e0b\u9762\u52a0\u5165\u4e24\u884c\uff1a</p> <pre><code>export NGINX_HOME=/usr/local/openresty/nginx\nexport PATH=${NGINX_HOME}/sbin:$PATH\n</code></pre> <p>NGINX_HOME\uff1a\u540e\u9762\u662fOpenResty\u5b89\u88c5\u76ee\u5f55\u4e0b\u7684nginx\u7684\u76ee\u5f55</p> <p>\u7136\u540e\u8ba9\u914d\u7f6e\u751f\u6548\uff1a</p> <pre><code>source /etc/profile\n</code></pre>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#2\u542f\u52a8\u548c\u8fd0\u884c","title":"2.\u542f\u52a8\u548c\u8fd0\u884c","text":"<p>OpenResty\u5e95\u5c42\u662f\u57fa\u4e8eNginx\u7684\uff0c\u67e5\u770bOpenResty\u76ee\u5f55\u7684nginx\u76ee\u5f55\uff0c\u7ed3\u6784\u4e0ewindows\u4e2d\u5b89\u88c5\u7684nginx\u57fa\u672c\u4e00\u81f4\uff1a</p> <p>\u6240\u4ee5\u8fd0\u884c\u65b9\u5f0f\u4e0enginx\u57fa\u672c\u4e00\u81f4\uff1a</p> <pre><code># \u542f\u52a8nginx\nnginx\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\nnginx -s reload\n# \u505c\u6b62\nnginx -s stop\n</code></pre> <p>nginx\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u6ce8\u91ca\u592a\u591a\uff0c\u5f71\u54cd\u540e\u7eed\u6211\u4eec\u7684\u7f16\u8f91\uff0c\u8fd9\u91cc\u5c06nginx.conf\u4e2d\u7684\u6ce8\u91ca\u90e8\u5206\u5220\u9664\uff0c\u4fdd\u7559\u6709\u6548\u90e8\u5206\u3002</p> <p>\u4fee\u6539<code>/usr/local/openresty/nginx/conf/nginx.conf</code>\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>#user  nobody;\nworker_processes  1;\nerror_log  logs/error.log;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    server {\n        listen       8081;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n</code></pre> <p>\u5728Linux\u7684\u63a7\u5236\u53f0\u8f93\u5165\u547d\u4ee4\u4ee5\u542f\u52a8nginx\uff1a</p> <pre><code>nginx\n</code></pre> <p>\u7136\u540e\u8bbf\u95ee\u9875\u9762\uff1ahttp://192.168.150.101:8081\uff0c\u6ce8\u610fip\u5730\u5740\u66ff\u6362\u4e3a\u4f60\u81ea\u5df1\u7684\u865a\u62df\u673aIP\uff1a</p>"},{"location":"Redis/%E5%AE%89%E8%A3%85OpenResty/#3\u5907\u6ce8","title":"3.\u5907\u6ce8","text":"<p>\u52a0\u8f7dOpenResty\u7684lua\u6a21\u5757\uff1a</p> <pre><code>#lua \u6a21\u5757\nlua_package_path \"/usr/local/openresty/lualib/?.lua;;\";\n#c\u6a21\u5757     \nlua_package_cpath \"/usr/local/openresty/lualib/?.so;;\";  \n</code></pre> <p>common.lua</p> <pre><code>-- \u5c01\u88c5\u51fd\u6570\uff0c\u53d1\u9001http\u8bf7\u6c42\uff0c\u5e76\u89e3\u6790\u54cd\u5e94\nlocal function read_http(path, params)\n    local resp = ngx.location.capture(path,{\n        method = ngx.HTTP_GET,\n        args = params,\n    })\n    if not resp then\n        -- \u8bb0\u5f55\u9519\u8bef\u4fe1\u606f\uff0c\u8fd4\u56de404\n        ngx.log(ngx.ERR, \"http not found, path: \", path , \", args: \", args)\n        ngx.exit(404)\n    end\n    return resp.body\nend\n-- \u5c06\u65b9\u6cd5\u5bfc\u51fa\nlocal _M = {  \n    read_http = read_http\n}  \nreturn _M\n</code></pre> <p>\u91ca\u653eRedis\u8fde\u63a5API\uff1a</p> <pre><code>-- \u5173\u95edredis\u8fde\u63a5\u7684\u5de5\u5177\u65b9\u6cd5\uff0c\u5176\u5b9e\u662f\u653e\u5165\u8fde\u63a5\u6c60\nlocal function close_redis(red)\n    local pool_max_idle_time = 10000 -- \u8fde\u63a5\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\n    local pool_size = 100 --\u8fde\u63a5\u6c60\u5927\u5c0f\n    local ok, err = red:set_keepalive(pool_max_idle_time, pool_size)\n    if not ok then\n        ngx.log(ngx.ERR, \"\u653e\u5165redis\u8fde\u63a5\u6c60\u5931\u8d25: \", err)\n    end\nend\n</code></pre> <p>\u8bfb\u53d6Redis\u6570\u636e\u7684API\uff1a</p> <pre><code>-- \u67e5\u8be2redis\u7684\u65b9\u6cd5 ip\u548cport\u662fredis\u5730\u5740\uff0ckey\u662f\u67e5\u8be2\u7684key\nlocal function read_redis(ip, port, key)\n    -- \u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\n    local ok, err = red:connect(ip, port)\n    if not ok then\n        ngx.log(ngx.ERR, \"\u8fde\u63a5redis\u5931\u8d25 : \", err)\n        return nil\n    end\n    -- \u67e5\u8be2redis\n    local resp, err = red:get(key)\n    -- \u67e5\u8be2\u5931\u8d25\u5904\u7406\n    if not resp then\n        ngx.log(ngx.ERR, \"\u67e5\u8be2Redis\u5931\u8d25: \", err, \", key = \" , key)\n    end\n    --\u5f97\u5230\u7684\u6570\u636e\u4e3a\u7a7a\u5904\u7406\n    if resp == ngx.null then\n        resp = nil\n        ngx.log(ngx.ERR, \"\u67e5\u8be2Redis\u6570\u636e\u4e3a\u7a7a, key = \", key)\n    end\n    close_redis(red)\n    return resp\nend\n</code></pre> <p>\u5f00\u542f\u5171\u4eab\u8bcd\u5178\uff1a</p> <pre><code># \u5171\u4eab\u5b57\u5178\uff0c\u4e5f\u5c31\u662f\u672c\u5730\u7f13\u5b58\uff0c\u540d\u79f0\u53eb\u505a\uff1aitem_cache\uff0c\u5927\u5c0f150m\nlua_shared_dict item_cache 150m;\u00a0\n</code></pre>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#redis\u952e\u503c\u8bbe\u8ba1","title":"Redis\u952e\u503c\u8bbe\u8ba1","text":""},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u4f18\u96c5\u7684key\u7ed3\u6784","title":"\u4f18\u96c5\u7684key\u7ed3\u6784","text":"<p>Redis\u7684Key\u867d\u7136\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u4f46\u6700\u597d\u9075\u5faa\u4e0b\u9762\u7684\u51e0\u4e2a\u6700\u4f73\u5b9e\u8df5\u7ea6\u5b9a\uff1a</p> <ul> <li>\u9075\u5faa\u57fa\u672c\u683c\u5f0f\uff1a[\u4e1a\u52a1\u540d\u79f0]:[\u6570\u636e\u540d]:[id]</li> <li>\u957f\u5ea6\u4e0d\u8d85\u8fc744\u5b57\u8282</li> <li>\u4e0d\u5305\u542b\u7279\u6b8a\u5b57\u7b26</li> </ul> <p>\u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904\uff1a</p> <ul> <li>\u53ef\u8bfb\u6027\u5f3a</li> <li>\u907f\u514dkey\u51b2\u7a81</li> <li>\u65b9\u4fbf\u7ba1\u7406</li> <li>\u66f4\u8282\u7701\u5185\u5b58\uff1a key\u662fstring\u7c7b\u578b\uff0c\u5e95\u5c42\u7f16\u7801\u5305\u542bint\u3001embstr\u548craw\u4e09\u79cd\u3002embstr\u5728\u5c0f\u4e8e44\u5b57\u8282\u4f7f\u7528\uff0c\u91c7\u7528\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\uff0c\u5185\u5b58\u5360\u7528\u66f4\u5c0f\u3002\u5f53\u5b57\u8282\u6570\u5927\u4e8e44\u5b57\u8282\u65f6\uff0c\u4f1a\u8f6c\u4e3araw\u6a21\u5f0f\u5b58\u50a8\uff0c\u5728raw\u6a21\u5f0f\u4e0b\uff0c\u5185\u5b58\u7a7a\u95f4\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u800c\u662f\u91c7\u7528\u4e00\u4e2a\u6307\u9488\u6307\u5411\u4e86\u53e6\u5916\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u8fd9\u6bb5\u7a7a\u95f4\u91cc\u5b58\u50a8SDS\u5185\u5bb9\uff0c\u8fd9\u6837\u7a7a\u95f4\u4e0d\u8fde\u7eed\uff0c\u8bbf\u95ee\u7684\u65f6\u5019\u6027\u80fd\u4e5f\u5c31\u4f1a\u6536\u5230\u5f71\u54cd\uff0c\u8fd8\u6709\u53ef\u80fd\u4ea7\u751f\u5185\u5b58\u788e\u7247</li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u62d2\u7eddbigkey","title":"\u62d2\u7eddBigKey","text":"<p>BigKey\u901a\u5e38\u4ee5Key\u7684\u5927\u5c0f\u548cKey\u4e2d\u6210\u5458\u7684\u6570\u91cf\u6765\u7efc\u5408\u5224\u5b9a\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>Key\u672c\u8eab\u7684\u6570\u636e\u91cf\u8fc7\u5927\uff1a\u4e00\u4e2aString\u7c7b\u578b\u7684Key\uff0c\u5b83\u7684\u503c\u4e3a5 MB</li> <li>Key\u4e2d\u7684\u6210\u5458\u6570\u8fc7\u591a\uff1a\u4e00\u4e2aZSET\u7c7b\u578b\u7684Key\uff0c\u5b83\u7684\u6210\u5458\u6570\u91cf\u4e3a10,000\u4e2a</li> <li>Key\u4e2d\u6210\u5458\u7684\u6570\u636e\u91cf\u8fc7\u5927\uff1a\u4e00\u4e2aHash\u7c7b\u578b\u7684Key\uff0c\u5b83\u7684\u6210\u5458\u6570\u91cf\u867d\u7136\u53ea\u67091,000\u4e2a\u4f46\u8fd9\u4e9b\u6210\u5458\u7684Value\uff08\u503c\uff09\u603b\u5927\u5c0f\u4e3a100 MB</li> </ul> <p>Tip</p> <p>redis\u4e2d\u53ef\u4f7f\u7528\u547d\u4ee4<code>MEMORY USAGE key</code>\u67e5\u770bKey\u5360\u7528\u5185\u5b58</p> <p>\u63a8\u8350\u503c\uff1a</p> <ul> <li>\u5355\u4e2akey\u7684value\u5c0f\u4e8e10KB</li> <li>\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u7684key\uff0c\u5efa\u8bae\u5143\u7d20\u6570\u91cf\u5c0f\u4e8e1000</li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#bigkey\u7684\u5371\u5bb3","title":"BigKey\u7684\u5371\u5bb3","text":"<ul> <li>\u7f51\u7edc\u963b\u585e<ul> <li>\u5bf9BigKey\u6267\u884c\u8bfb\u8bf7\u6c42\u65f6\uff0c\u5c11\u91cf\u7684QPS\u5c31\u53ef\u80fd\u5bfc\u81f4\u5e26\u5bbd\u4f7f\u7528\u7387\u88ab\u5360\u6ee1\uff0c\u5bfc\u81f4Redis\u5b9e\u4f8b\uff0c\u4e43\u81f3\u6240\u5728\u7269\u7406\u673a\u53d8\u6162</li> </ul> </li> <li>\u6570\u636e\u503e\u659c<ul> <li>BigKey\u6240\u5728\u7684Redis\u5b9e\u4f8b\u5185\u5b58\u4f7f\u7528\u7387\u8fdc\u8d85\u5176\u4ed6\u5b9e\u4f8b\uff0c\u65e0\u6cd5\u4f7f\u6570\u636e\u5206\u7247\u7684\u5185\u5b58\u8d44\u6e90\u8fbe\u5230\u5747\u8861</li> </ul> </li> <li>Redis\u963b\u585e<ul> <li>\u5bf9\u5143\u7d20\u8f83\u591a\u7684hash\u3001list\u3001zset\u7b49\u505a\u8fd0\u7b97\u4f1a\u8017\u65f6\u8f83\u4e45\uff0c\u4f7f\u4e3b\u7ebf\u7a0b\u88ab\u963b\u585e</li> </ul> </li> <li>CPU\u538b\u529b<ul> <li>\u5bf9BigKey\u7684\u6570\u636e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u4f1a\u5bfc\u81f4CPU\u7684\u4f7f\u7528\u7387\u98d9\u5347\uff0c\u5f71\u54cdRedis\u5b9e\u4f8b\u548c\u672c\u673a\u5176\u5b83\u5e94\u7528</li> </ul> </li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u53d1\u73b0bigkey","title":"\u53d1\u73b0BigKey","text":"<ol> <li> <p><code>redis-cli --bigkeys</code> \u547d\u4ee4</p> <p>Note</p> <p>\u5229\u7528redis-cli\u63d0\u4f9b\u7684--bigkeys\u53c2\u6570\uff0c\u53ef\u4ee5\u904d\u5386\u5206\u6790\u6240\u6709key\uff0c\u5e76\u8fd4\u56deKey\u7684\u6574\u4f53\u7edf\u8ba1\u4fe1\u606f\u4e0e\u6bcf\u4e2a\u6570\u636e\u7684Top1\u7684key\uff08\u4e0d\u4e00\u5b9a\u662fBigKey\uff09</p> </li> <li> <p>scan\u626b\u63cf</p> <p>\u7f16\u7a0b\uff0c\u5229\u7528scan\u626b\u63cfRedis\u4e2d\u7684\u6240\u6709key\uff0c\u5229\u7528strlen\u3001hlen\u7b49\u547d\u4ee4\u5224\u65adkey\u7684\u957f\u5ea6\uff08\u6b64\u5904\u4e0d\u5efa\u8bae\u4f7f\u7528MEMORY USAGE\uff09</p> </li> <li> <p>\u7b2c\u4e09\u65b9\u5de5\u5177</p> <p>\u5229\u7528\u7b2c\u4e09\u65b9\u5de5\u5177\uff0c\u5982 Redis-Rdb-Tools \u5206\u6790RDB\u5feb\u7167\u6587\u4ef6\uff0c\u5168\u9762\u5206\u6790\u5185\u5b58\u4f7f\u7528\u60c5\u51b5</p> </li> <li> <p>\u7f51\u7edc\u76d1\u63a7</p> <ul> <li>\u81ea\u5b9a\u4e49\u5de5\u5177\uff0c\u76d1\u63a7\u8fdb\u51faRedis\u7684\u7f51\u7edc\u6570\u636e\uff0c\u8d85\u51fa\u9884\u8b66\u503c\u65f6\u4e3b\u52a8\u544a\u8b66</li> <li>\u4e00\u822c\u963f\u91cc\u4e91\u642d\u5efa\u7684\u4e91\u670d\u52a1\u5668\u5c31\u6709\u76f8\u5173\u76d1\u63a7\u9875\u9762</li> </ul> </li> </ol>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u5220\u9664bigkaey","title":"\u5220\u9664BigKaey","text":"<p>BigKey\u5185\u5b58\u5360\u7528\u8f83\u591a\uff0c\u5373\u4fbf\u65f6\u5220\u9664\u8fd9\u6837\u7684key\u4e5f\u9700\u8981\u8017\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u5bfc\u81f4Redis\u4e3b\u7ebf\u7a0b\u963b\u585e\uff0c\u5f15\u53d1\u4e00\u7cfb\u5217\u95ee\u9898\u3002</p> <ul> <li> <p>redis 3.0 \u53ca\u4ee5\u4e0b\u7248\u672c</p> <ul> <li>\u5982\u679c\u662f\u96c6\u5408\u7c7b\u578b\uff0c\u5219\u904d\u5386BigKey\u7684\u5143\u7d20\uff0c\u5148\u9010\u4e2a\u5220\u9664\u5b50\u5143\u7d20\uff0c\u6700\u540e\u5220\u9664BigKey</li> </ul> </li> <li> <p>Redis 4.0\u4ee5\u540e</p> <ul> <li>Redis\u57284.0\u540e\u63d0\u4f9b\u4e86\u5f02\u6b65\u5220\u9664\u7684\u547d\u4ee4\uff1a<code>unlink</code></li> </ul> </li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u6070\u5f53\u7684\u6570\u636e\u7c7b\u578b","title":"\u6070\u5f53\u7684\u6570\u636e\u7c7b\u578b","text":""},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u4f8b1","title":"\u4f8b1","text":"<p>\u6bd4\u5982\u5b58\u50a8\u4e00\u4e2aUser\u5bf9\u8c61\uff0c\u6211\u4eec\u6709\u4e09\u79cd\u5b58\u50a8\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u65b9\u5f0f\u4e00\uff1ajson\u5b57\u7b26\u4e32</p> <p>| user:1 | {\"name\": \"Jack\", \"age\": 21} |</p> <p>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\u7c97\u66b4</p> <p>\u7f3a\u70b9\uff1a\u6570\u636e\u8026\u5408\uff0c\u4e0d\u591f\u7075\u6d3b</p> </li> <li> <p>\u65b9\u5f0f\u4e8c\uff1a\u5b57\u6bb5\u62c6\u5206</p> user:1:name Jack user:1:age 21 <p>\u4f18\u70b9\uff1a\u53ef\u4ee5\u7075\u6d3b\u8bbf\u95ee\u5bf9\u8c61\u4efb\u610f\u5b57\u6bb5</p> <p>\u7f3a\u70b9\uff1a\u5360\u7528\u7a7a\u95f4\u5927\u3001\u6ca1\u529e\u6cd5\u505a\u7edf\u4e00\u63a7\u5236</p> </li> <li> <p>\u65b9\u5f0f\u4e09\uff1ahash\uff08\u63a8\u8350\uff09</p> <p> user:1 name jack age 21 </p> <p>\u4f18\u70b9\uff1a\u5e95\u5c42\u4f7f\u7528ziplist\uff0c\u7a7a\u95f4\u5360\u7528\u5c0f\uff0c\u53ef\u4ee5\u7075\u6d3b\u8bbf\u95ee\u5bf9\u8c61\u7684\u4efb\u610f\u5b57\u6bb5</p> <p>\u7f3a\u70b9\uff1a\u4ee3\u7801\u76f8\u5bf9\u590d\u6742</p> </li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u4f8b2","title":"\u4f8b2","text":"<p>\u5047\u5982\u6709hash\u7c7b\u578b\u7684key\uff0c\u5176\u4e2d\u6709100\u4e07\u5bf9field\u548cvalue\uff0cfield\u662f\u81ea\u589eid\uff0c\u8fd9\u4e2akey\u5b58\u5728\u4ec0\u4e48\u95ee\u9898\uff1f\u5982\u4f55\u4f18\u5316\uff1f</p> key field value someKey id:0 value0 ..... ..... id:999999 value999999 <p>Info</p> <p>\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <ul> <li>hash\u7684entry\u6570\u91cf\u8d85\u8fc7500\u65f6\uff0c\u4f1a\u4f7f\u7528\u54c8\u5e0c\u8868\u800c\u4e0d\u662fZipList\uff0c\u5185\u5b58\u5360\u7528\u8f83\u591a</li> <li>\u53ef\u4ee5\u901a\u8fc7hash-max-ziplist-entries\u914d\u7f6eentry\u4e0a\u9650\u3002\u4f46\u662f\u5982\u679centry\u8fc7\u591a\u5c31\u4f1a\u5bfc\u81f4BigKey\u95ee\u9898</li> </ul> <ul> <li>\u65b9\u6848\u4e00</li> </ul> <p>\u62c6\u5206\u4e3astring\u7c7b\u578b</p> key value id:0 value0 ..... ..... id:999999 value999999 <p>Warning</p> <p>\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <ul> <li>string\u7ed3\u6784\u5e95\u5c42\u6ca1\u6709\u592a\u591a\u5185\u5b58\u4f18\u5316\uff0c\u5185\u5b58\u5360\u7528\u8f83\u591a</li> <li>\u60f3\u8981\u6279\u91cf\u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u6bd4\u8f83\u9ebb\u70e6</li> </ul> <ul> <li>\u65b9\u6848\u4e8c\uff08\u63a8\u8350\uff09</li> </ul> <p>\u62c6\u5206\u4e3a\u5c0f\u7684hash\uff0c\u5c06 <code>id / 100</code> \u4f5c\u4e3akey\uff0c \u5c06 <code>id % 100</code> \u4f5c\u4e3afield\uff0c\u8fd9\u6837\u6bcf100\u4e2a\u5143\u7d20\u4e3a\u4e00\u4e2aHash</p> key field value key:0 id:00 value0 ..... ..... id:99 value99 key:1 id:00 value100 ..... ..... id:99 value199 .... key:9999 id:00 value999900 ..... ..... id:99 value999999"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u6279\u5904\u7406\u4f18\u5316","title":"\u6279\u5904\u7406\u4f18\u5316","text":""},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#mset","title":"MSET","text":"<p>redis\u5904\u7406\u6307\u4ee4\u662f\u5f88\u5feb\u7684\uff0c\u4e3b\u8981\u82b1\u8d39\u7684\u65f6\u5019\u5728\u4e8e\u7f51\u7edc\u4f20\u8f93\u3002\u4e8e\u662f\u4e4e\u5f88\u5bb9\u6613\u60f3\u5230\u5c06\u591a\u6761\u6307\u4ee4\u6279\u91cf\u7684\u4f20\u8f93\u7ed9redis</p> <p>Redis\u63d0\u4f9b\u4e86\u5f88\u591aMxxx\u8fd9\u6837\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6279\u91cf\u63d2\u5165\u6570\u636e\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>mset</li> <li>hmset</li> </ul> <p>\u63d2\u516510\u4e07\u6761\u6570\u636e</p> <pre><code>void testMxx() {\n    String[] arr = new String[2000];\n    int j;\n    long b = System.currentTimeMillis();\n    for (int i = 1; i &lt;= 100000; i++) {\n        j = (i % 1000) &lt;&lt; 1;\n        arr[j] = \"test:key_\" + i;\n        arr[j + 1] = \"value_\" + i;\n        if (j == 0) {\n            jedis.mset(arr);\n        }\n    }\n    long e = System.currentTimeMillis();\n    System.out.println(\"time: \" + (e - b));\n}\n</code></pre> <p>Warning</p> <p>\u4e0d\u8981\u5728\u4e00\u6b21\u6279\u5904\u7406\u4e2d\u4f20\u8f93\u592a\u591a\u6570\u636e\uff0c\u5426\u5219\u5355\u6b21\u547d\u4ee4\u5360\u7528\u5e26\u5bbd\u8fc7\u591a\uff0c\u5bfc\u81f4\u7f51\u7edc\u963b\u585e</p>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#pipline\u7ba1\u9053","title":"Pipline\uff08\u7ba1\u9053\uff09","text":"<p>MSET\u867d\u7136\u53ef\u4ee5\u6279\u5904\u7406\uff0c\u4f46\u662f\u5374\u53ea\u80fd\u64cd\u4f5c\u90e8\u5206\u6570\u636e\u7c7b\u578b\uff0c\u56e0\u6b64\u5982\u679c\u6709\u5bf9\u590d\u6742\u6570\u636e\u7c7b\u578b\u7684\u6279\u5904\u7406\u9700\u8981\uff0c\u5efa\u8bae\u4f7f\u7528Pipeline</p> <pre><code>@Test\nvoid testPipeline() {\n    // \u521b\u5efa\u7ba1\u9053\n    Pipeline pipeline = jedis.pipelined();\n    long b = System.currentTimeMillis();\n    for (int i = 1; i &lt;= 100000; i++) {\n        // \u653e\u5165\u547d\u4ee4\u5230\u7ba1\u9053\n        pipeline.set(\"test:key_\" + i, \"value_\" + i);\n        if (i % 1000 == 0) {\n            // \u6bcf\u653e\u51651000\u6761\u547d\u4ee4\uff0c\u6279\u91cf\u6267\u884c\n            pipeline.sync();\n        }\n    }\n    long e = System.currentTimeMillis();\n    System.out.println(\"time: \" + (e - b));\n}\n</code></pre>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u96c6\u7fa4\u4e0b\u7684\u6279\u5904\u7406","title":"\u96c6\u7fa4\u4e0b\u7684\u6279\u5904\u7406","text":"<p>\u5982MSET\u6216Pipeline\u8fd9\u6837\u7684\u6279\u5904\u7406\u9700\u8981\u5728\u4e00\u6b21\u8bf7\u6c42\u4e2d\u643a\u5e26\u591a\u6761\u547d\u4ee4\uff0c\u800c\u6b64\u65f6\u5982\u679cRedis\u662f\u4e00\u4e2a\u96c6\u7fa4\uff0c\u90a3\u6279\u5904\u7406\u547d\u4ee4\u7684\u591a\u4e2akey\u5fc5\u987b\u843d\u5728\u540c\u4e00\u4e2a\u63d2\u69fd\u4e2d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u6267\u884c\u5931\u8d25\u3002</p> <p>\u89e3\u51b3\u65b9\u6848</p> <ol> <li> <p>\u7b2c\u4e00\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u4e32\u884c\u6267\u884c\uff0c\u6240\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6ca1\u6709\u4ec0\u4e48\u610f\u4e49\uff0c\u5f53\u7136\uff0c\u6267\u884c\u8d77\u6765\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u7f3a\u70b9\u5c31\u662f\u8017\u65f6\u8fc7\u4e45\u3002</li> </ul> </li> <li> <p>\u7b2c\u4e8c\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u4e32\u884cslot\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u6267\u884c\u524d\uff0c\u5ba2\u6237\u7aef\u5148\u8ba1\u7b97\u4e00\u4e0b\u5bf9\u5e94\u7684key\u7684slot\uff0c\u4e00\u6837slot\u7684key\u5c31\u653e\u5230\u4e00\u4e2a\u7ec4\u91cc\u8fb9\uff0c\u4e0d\u540c\u7684\uff0c\u5c31\u653e\u5230\u4e0d\u540c\u7684\u7ec4\u91cc\u8fb9\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u7ec4\u6267\u884cpipeline\u7684\u6279\u5904\u7406\uff0c\u4ed6\u5c31\u80fd\u4e32\u884c\u6267\u884c\u5404\u4e2a\u7ec4\u7684\u547d\u4ee4\uff0c\u8fd9\u79cd\u505a\u6cd5\u6bd4\u7b2c\u4e00\u79cd\u65b9\u6cd5\u8017\u65f6\u8981\u5c11\uff0c\u4f46\u662f\u7f3a\u70b9\u5462\uff0c\u76f8\u5bf9\u6765\u8bf4\u590d\u6742\u4e00\u70b9\uff0c\u6240\u4ee5\u8fd9\u79cd\u65b9\u6848\u8fd8\u9700\u8981\u4f18\u5316\u4e00\u4e0b</li> </ul> </li> <li> <p>\u7b2c\u4e09\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u5e76\u884cslot\uff0c\u76f8\u8f83\u4e8e\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u5728\u5206\u7ec4\u5b8c\u6210\u540e\u4e32\u884c\u6267\u884c\uff0c\u7b2c\u4e09\u79cd\u65b9\u6848\uff0c\u5c31\u53d8\u6210\u4e86\u5e76\u884c\u6267\u884c\u5404\u4e2a\u547d\u4ee4\uff0c\u6240\u4ee5\u4ed6\u7684\u8017\u65f6\u5c31\u975e\u5e38\u77ed\uff0c\u4f46\u662f\u5b9e\u73b0\u5462\uff0c\u4e5f\u66f4\u52a0\u590d\u6742\u3002</li> </ul> </li> <li> <p>\u7b2c\u56db\u79cd\uff1a</p> <ul> <li>hash_tag\uff0credis\u8ba1\u7b97key\u7684slot\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u6839\u636ekey\u7684\u6709\u6548\u90e8\u5206\u6765\u8ba1\u7b97\u7684\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u80fd\u4e00\u6b21\u5904\u7406\u6240\u6709\u7684key\uff0c\u8fd9\u79cd\u65b9\u5f0f\u8017\u65f6\u6700\u77ed\uff0c\u5b9e\u73b0\u4e5f\u7b80\u5355\uff0c\u4f46\u662f\u5982\u679c\u901a\u8fc7\u64cd\u4f5ckey\u7684\u6709\u6548\u90e8\u5206\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u6240\u6709\u7684key\u90fd\u843d\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\uff0c\u4ea7\u751f\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u7b2c\u4e09\u79cd\u65b9\u5f0f\u3002</li> </ul> </li> <li> <p>Jedis\u4ee3\u7801\u5b9e\u73b0</p> </li> </ol> <pre><code>    @Test\n    void testMSet2() {\n        Map&lt;String, String&gt; map = new HashMap&lt;&gt;(3);\n        map.put(\"name\", \"Jack\");\n        map.put(\"age\", \"21\");\n        map.put(\"sex\", \"Male\");\n        //\u5bf9Map\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u3002\u6839\u636e\u76f8\u540c\u7684slot\u653e\u5728\u4e00\u4e2a\u5206\u7ec4\n        //key\u5c31\u662fslot\uff0cvalue\u5c31\u662f\u4e00\u4e2a\u7ec4\n        Map&lt;Integer, List&lt;Map.Entry&lt;String, String&gt;&gt;&gt; result = map.entrySet()\n                .stream()\n                .collect(Collectors.groupingBy(\n                        entry -&gt; ClusterSlotHashUtil.calculateSlot(entry.getKey()))\n                );\n        //\u4e32\u884c\u7684\u53bb\u6267\u884cmset\u7684\u903b\u8f91\n        for (List&lt;Map.Entry&lt;String, String&gt;&gt; list : result.values()) {\n            String[] arr = new String[list.size() * 2];\n            int j = 0;\n            for (int i = 0; i &lt; list.size(); i++) {\n                j = i&lt;&lt;2;\n                Map.Entry&lt;String, String&gt; e = list.get(0);\n                arr[j] = e.getKey();\n                arr[j + 1] = e.getValue();\n            }\n            jedisCluster.mset(arr);\n        }\n    }\n</code></pre> <ul> <li>Srping\u4e0b\u7684\u5b9e\u73b0</li> </ul> <pre><code>   @Test\n    void testMSetInCluster() {\n        Map&lt;String, String&gt; map = new HashMap&lt;&gt;(3);\n        map.put(\"name\", \"Rose\");\n        map.put(\"age\", \"21\");\n        map.put(\"sex\", \"Female\");\n        stringRedisTemplate.opsForValue().multiSet(map);\n\n\n        List&lt;String&gt; strings = stringRedisTemplate.opsForValue().multiGet(Arrays.asList(\"name\", \"age\", \"sex\"));\n        strings.forEach(System.out::println);\n\n    }\n</code></pre>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u670d\u52a1\u5668\u7aef\u4f18\u5316","title":"\u670d\u52a1\u5668\u7aef\u4f18\u5316","text":""},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u6301\u4e45\u5316\u914d\u7f6e","title":"\u6301\u4e45\u5316\u914d\u7f6e","text":"<p>\u51e0\u70b9\u5efa\u8bae\uff1a</p> <ul> <li>\u7528\u6765\u505a\u7f13\u5b58\u7684Redis\u5b9e\u4f8b\u5c3d\u91cf\u4e0d\u8981\u5f00\u542f\u6301\u4e45\u5316\u529f\u80fd</li> <li>\u5efa\u8bae\u5173\u95edRDB\u6301\u4e45\u5316\u529f\u80fd\uff0c\u4f7f\u7528AOF\u6301\u4e45\u5316</li> <li>\u5229\u7528\u811a\u672c\u5b9a\u671f\u5728slave\u8282\u70b9\u505aRDB\uff0c\u5b9e\u73b0\u6570\u636e\u5907\u4efd</li> <li>\u8bbe\u7f6e\u5408\u7406\u7684rewrite\u9608\u503c\uff0c\u907f\u514d\u9891\u7e41\u7684bgrewrite</li> <li>\u914d\u7f6eno-appendfsync-on-rewrite = yes\uff0c\u7981\u6b62\u5728rewrite\u671f\u95f4\u505aaof\uff0c\u907f\u514d\u56e0AOF\u5f15\u8d77\u7684\u963b\u585e</li> <li>\u90e8\u7f72\u6709\u5173\u5efa\u8bae\uff1a<ul> <li>Redis\u5b9e\u4f8b\u7684\u7269\u7406\u673a\u8981\u9884\u7559\u8db3\u591f\u5185\u5b58\uff0c\u5e94\u5bf9fork\u548crewrite</li> <li>\u5355\u4e2aRedis\u5b9e\u4f8b\u5185\u5b58\u4e0a\u9650\u4e0d\u8981\u592a\u5927\uff0c\u4f8b\u59824G\u62168G\u3002\u53ef\u4ee5\u52a0\u5febfork\u7684\u901f\u5ea6\u3001\u51cf\u5c11\u4e3b\u4ece\u540c\u6b65\u3001\u6570\u636e\u8fc1\u79fb\u538b\u529b</li> <li>\u4e0d\u8981\u4e0eCPU\u5bc6\u96c6\u578b\u5e94\u7528\u90e8\u7f72\u5728\u4e00\u8d77</li> <li>\u4e0d\u8981\u4e0e\u9ad8\u786c\u76d8\u8d1f\u8f7d\u5e94\u7528\u4e00\u8d77\u90e8\u7f72\u3002\u4f8b\u5982\uff1a\u6570\u636e\u5e93\u3001\u6d88\u606f\u961f\u5217</li> </ul> </li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u6162\u67e5\u8be2","title":"\u6162\u67e5\u8be2","text":"<p>\u5728Redis\u6267\u884c\u65f6\u8017\u65f6\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u7684\u547d\u4ee4\uff0c\u79f0\u4e3a\u6162\u67e5\u8be2\u3002</p> <p>\u6162\u67e5\u8be2\u7684\u5371\u5bb3\uff1a</p> <ul> <li>\u7531\u4e8eRedis\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u5f53\u5ba2\u6237\u7aef\u53d1\u51fa\u6307\u4ee4\u540e\uff0c\u4ed6\u4eec\u90fd\u4f1a\u8fdb\u5165\u5230redis\u5e95\u5c42\u7684queue\u6765\u6267\u884c\uff0c\u5982\u679c\u6b64\u65f6\u6709\u4e00\u4e9b\u6162\u67e5\u8be2\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u963b\u585e\uff0c\u4ece\u800c\u5f15\u8d77\u62a5\u9519</li> </ul> <p>\u6162\u67e5\u8be2\u7684\u9608\u503c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6307\u5b9a\uff1a</p> <ul> <li><code>slowlog-log-slower-than</code>\uff1a\u6162\u67e5\u8be2\u9608\u503c\uff0c\u5355\u4f4d\u662f\u5fae\u79d2\u3002\u9ed8\u8ba4\u662f10000\uff0c\u5efa\u8bae1000</li> </ul> <p>\u6162\u67e5\u8be2\u4f1a\u88ab\u653e\u5165\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\uff0c\u65e5\u5fd7\u7684\u957f\u5ea6\u6709\u4e0a\u9650\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6307\u5b9a\uff1a</p> <ul> <li><code>slowlog-max-len</code>\uff1a\u6162\u67e5\u8be2\u65e5\u5fd7\uff08\u672c\u8d28\u662f\u4e00\u4e2a\u961f\u5217\uff09\u7684\u957f\u5ea6\u3002\u9ed8\u8ba4\u662f128\uff0c\u5efa\u8bae1000</li> </ul> <p>\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u5217\u8868\uff1a</p> <ul> <li><code>slowlog len</code>\uff1a\u67e5\u8be2\u6162\u67e5\u8be2\u65e5\u5fd7\u957f\u5ea6</li> <li><code>slowlog get [n]</code>\uff1a\u8bfb\u53d6n\u6761\u6162\u67e5\u8be2\u65e5\u5fd7</li> <li><code>slowlog reset</code>\uff1a\u6e05\u7a7a\u6162\u67e5\u8be2\u5217\u8868</li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u547d\u4ee4\u53ca\u5b89\u5168\u914d\u7f6e","title":"\u547d\u4ee4\u53ca\u5b89\u5168\u914d\u7f6e","text":"<p>Redis\u4f1a\u7ed1\u5b9a\u57280.0.0.0:6379\uff0c\u8fd9\u6837\u5c06\u4f1a\u5c06Redis\u670d\u52a1\u66b4\u9732\u5230\u516c\u7f51\u4e0a\uff0c\u800cRedis\u5982\u679c\u6ca1\u6709\u505a\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4f1a\u51fa\u73b0\u4e25\u91cd\u7684\u5b89\u5168\u6f0f\u6d1e. \u6f0f\u6d1e\u91cd\u73b0\u65b9\u5f0f\uff1ahttps://cloud.tencent.com/developer/article/1039000</p> <p>\u6f0f\u6d1e\u51fa\u73b0\u7684\u6838\u5fc3\u7684\u539f\u56e0\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li>Redis\u672a\u8bbe\u7f6e\u5bc6\u7801</li> <li>\u5229\u7528\u4e86Redis\u7684config set\u547d\u4ee4\u52a8\u6001\u4fee\u6539Redis\u914d\u7f6e</li> <li>\u4f7f\u7528\u4e86Root\u8d26\u53f7\u6743\u9650\u542f\u52a8Redis</li> </ul> <p>Danger</p> <p>\u4e00\u4e9b\u5efa\u8bae\uff1a</p> <ul> <li>Redis\u4e00\u5b9a\u8981\u8bbe\u7f6e\u5bc6\u7801</li> <li>\u7981\u6b62\u7ebf\u4e0a\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\uff1akeys\u3001flushall\u3001flushdb\u3001config set\u7b49\u547d\u4ee4\u3002\u53ef\u4ee5\u5229\u7528rename-command\u7981\u7528\u3002</li> <li>bind\uff1a\u9650\u5236\u7f51\u5361\uff0c\u7981\u6b62\u5916\u7f51\u7f51\u5361\u8bbf\u95ee</li> <li>\u5f00\u542f\u9632\u706b\u5899</li> <li>\u4e0d\u8981\u4f7f\u7528Root\u8d26\u6237\u542f\u52a8Redis</li> <li>\u5c3d\u91cf\u4e0d\u662f\u6709\u9ed8\u8ba4\u7684\u7aef\u53e3</li> </ul>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u5185\u5b58\u914d\u7f6e","title":"\u5185\u5b58\u914d\u7f6e","text":"<p>\u5f53Redis\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u53ef\u80fd\u5bfc\u81f4Key\u9891\u7e41\u88ab\u5220\u9664\u3001\u54cd\u5e94\u65f6\u95f4\u53d8\u957f\u3001QPS\u4e0d\u7a33\u5b9a\u7b49\u95ee\u9898\u3002\u5f53\u5185\u5b58\u4f7f\u7528\u7387\u8fbe\u523090%\u4ee5\u4e0a\u65f6\u5c31\u9700\u8981\u6211\u4eec\u8b66\u60d5\uff0c\u5e76\u5feb\u901f\u5b9a\u4f4d\u5230\u5185\u5b58\u5360\u7528\u7684\u539f\u56e0\u3002</p> \u5185\u5b58\u5360\u7528 \u8bf4\u660e \u6570\u636e\u5185\u5b58 \u662fRedis\u6700\u4e3b\u8981\u7684\u90e8\u5206\uff0c\u5b58\u50a8Redis\u7684\u952e\u503c\u4fe1\u606f\u3002\u4e3b\u8981\u95ee\u9898\u662fBigKey\u95ee\u9898\u3001\u5185\u5b58\u788e\u7247\u95ee\u9898 \u8fdb\u7a0b\u5185\u5b58 Redis\u4e3b\u8fdb\u7a0b\u672c\u8eab\u8fd0\u884c\u80af\u5b9a\u9700\u8981\u5360\u7528\u5185\u5b58\uff0c\u5982\u4ee3\u7801\u3001\u5e38\u91cf\u6c60\u7b49\u7b49\uff1b\u8fd9\u90e8\u5206\u5185\u5b58\u5927\u7ea6\u51e0\u5146\uff0c\u5728\u2f24\u591a\u6570\u751f\u4ea7\u73af\u5883\u4e2d\u4e0eRedis\u6570\u636e\u5360\u7528\u7684\u5185\u5b58\u76f8\u6bd4\u53ef\u4ee5\u5ffd\u7565\u3002 \u7f13\u51b2\u533a\u5185\u5b58 \u4e00\u822c\u5305\u62ec\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u3001AOF\u7f13\u51b2\u533a\u3001\u590d\u5236\u7f13\u51b2\u533a\u7b49\u3002\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u53c8\u5305\u62ec\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a\u4e24\u79cd\u3002\u8fd9\u90e8\u5206\u5185\u5b58\u5360\u7528\u6ce2\u52a8\u8f83\u5927\uff0c\u4e0d\u5f53\u4f7f\u7528BigKey\uff0c\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002 <p>\u67e5\u770bRedis\u76ee\u524d\u7684\u5185\u5b58\u5206\u914d\u72b6\u6001\uff1a</p> <ul> <li> <p><code>info memory</code>\uff1a\u67e5\u770b\u5185\u5b58\u5206\u914d\u7684\u60c5\u51b5</p> </li> <li> <p><code>memory xxx</code>\uff1a\u67e5\u770bkey\u7684\u4e3b\u8981\u5360\u7528\u60c5\u51b5</p> </li> </ul> <p>\u5185\u5b58\u7f13\u51b2\u533a\u5e38\u89c1\u7684\u6709\u4e09\u79cd\uff1a</p> <ul> <li>\u590d\u5236\u7f13\u51b2\u533a\uff1a\u4e3b\u4ece\u590d\u5236\u7684 <code>repl_backlog_buf</code>\uff0c\u5982\u679c\u592a\u5c0f\u53ef\u80fd\u5bfc\u81f4\u9891\u7e41\u7684\u5168\u91cf\u590d\u5236\uff0c\u5f71\u54cd\u6027\u80fd\u3002\u901a\u8fc7 <code>replbacklog-size</code> \u6765\u8bbe\u7f6e\uff0c\u9ed8\u8ba41mb</li> <li>AOF\u7f13\u51b2\u533a\uff1aAOF\u5237\u76d8\u4e4b\u524d\u7684\u7f13\u5b58\u533a\u57df\uff0cAOF\u6267\u884crewrite\u7684\u7f13\u51b2\u533a\u3002\u65e0\u6cd5\u8bbe\u7f6e\u5bb9\u91cf\u4e0a\u9650</li> <li>\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\uff1a\u5206\u4e3a\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u8f93\u5165\u7f13\u51b2\u533a\u6700\u59271G\u4e14\u4e0d\u80fd\u8bbe\u7f6e\u3002\u8f93\u51fa\u7f13\u51b2\u533a\u53ef\u4ee5\u8bbe\u7f6e</li> </ul> <p>Note</p> <p>\u6700\u53ef\u80fd\u53d1\u751f\u95ee\u9898\u7684\u5c31\u662f\u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a</p>"},{"location":"Redis/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#\u670d\u52a1\u5668\u7aef\u96c6\u7fa4\u4f18\u5316","title":"\u670d\u52a1\u5668\u7aef\u96c6\u7fa4\u4f18\u5316","text":"<p>\u96c6\u7fa4\u867d\u7136\u5177\u5907\u9ad8\u53ef\u7528\u7279\u6027\uff0c\u80fd\u5b9e\u73b0\u81ea\u52a8\u6545\u969c\u6062\u590d\uff0c\u4f46\u662f\u5982\u679c\u4f7f\u7528\u4e0d\u5f53\uff0c\u4e5f\u4f1a\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li>\u96c6\u7fa4\u5b8c\u6574\u6027\u95ee\u9898</li> <li>\u96c6\u7fa4\u5e26\u5bbd\u95ee\u9898</li> <li>\u6570\u636e\u503e\u659c\u95ee\u9898</li> <li>\u5ba2\u6237\u7aef\u6027\u80fd\u95ee\u9898</li> <li>\u547d\u4ee4\u7684\u96c6\u7fa4\u517c\u5bb9\u6027\u95ee\u9898</li> <li>lua\u548c\u4e8b\u52a1\u95ee\u9898</li> </ul> <p>\u95ee\u98981\u3001\u5728Redis\u7684\u9ed8\u8ba4\u914d\u7f6e\u4e2d\uff0c\u5982\u679c\u53d1\u73b0\u4efb\u610f\u4e00\u4e2a\u63d2\u69fd\u4e0d\u53ef\u7528\uff0c\u5219\u6574\u4e2a\u96c6\u7fa4\u90fd\u4f1a\u505c\u6b62\u5bf9\u5916\u670d\u52a1\uff1a </p> <p>\u5927\u5bb6\u53ef\u4ee5\u8bbe\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u6709\u51e0\u4e2aslot\u4e0d\u80fd\u4f7f\u7528\uff0c\u90a3\u4e48\u6b64\u65f6\u6574\u4e2a\u96c6\u7fa4\u90fd\u4e0d\u80fd\u7528\u4e86\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\uff0c\u5176\u5b9e\u6700\u91cd\u8981\u7684\u662f\u53ef\u7528\u6027\uff0c\u6240\u4ee5\u9700\u8981\u628a\u5982\u4e0b\u914d\u7f6e\u4fee\u6539\u6210no\uff0c\u5373\u6709slot\u4e0d\u80fd\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u7684redis\u96c6\u7fa4\u8fd8\u662f\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1</p> <pre><code>cluster-require-full-coverage no\n</code></pre> <p>\u95ee\u98982\u3001\u96c6\u7fa4\u5e26\u5bbd\u95ee\u9898</p> <p>\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u4f1a\u4e0d\u65ad\u7684\u4e92\u76f8Ping\u6765\u786e\u5b9a\u96c6\u7fa4\u4e2d\u5176\u5b83\u8282\u70b9\u7684\u72b6\u6001\u3002\u6bcf\u6b21Ping\u643a\u5e26\u7684\u4fe1\u606f\u81f3\u5c11\u5305\u62ec\uff1a</p> <ul> <li>\u63d2\u69fd\u4fe1\u606f</li> <li>\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f</li> </ul> <p>\u96c6\u7fa4\u4e2d\u8282\u70b9\u8d8a\u591a\uff0c\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u6570\u636e\u91cf\u4e5f\u8d8a\u5927\uff0c10\u4e2a\u8282\u70b9\u7684\u76f8\u5173\u4fe1\u606f\u53ef\u80fd\u8fbe\u52301kb\uff0c\u6b64\u65f6\u6bcf\u6b21\u96c6\u7fa4\u4e92\u901a\u9700\u8981\u7684\u5e26\u5bbd\u4f1a\u975e\u5e38\u9ad8\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u4e2d\u5927\u91cf\u7684\u5e26\u5bbd\u90fd\u4f1a\u88abping\u4fe1\u606f\u6240\u5360\u7528\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u53ef\u6015\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53bb\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898</p> <p>\u89e3\u51b3\u9014\u5f84\uff1a</p> <ul> <li>\u907f\u514d\u5927\u96c6\u7fa4\uff0c\u96c6\u7fa4\u8282\u70b9\u6570\u4e0d\u8981\u592a\u591a\uff0c\u6700\u597d\u5c11\u4e8e1000\uff0c\u5982\u679c\u4e1a\u52a1\u5e9e\u5927\uff0c\u5219\u5efa\u7acb\u591a\u4e2a\u96c6\u7fa4\u3002</li> <li>\u907f\u514d\u5728\u5355\u4e2a\u7269\u7406\u673a\u4e2d\u8fd0\u884c\u592a\u591aRedis\u5b9e\u4f8b</li> <li>\u914d\u7f6e\u5408\u9002\u7684 <code>cluster-node-timeout</code> \u503c</li> </ul> <p>\u95ee\u98983\u3001\u547d\u4ee4\u7684\u96c6\u7fa4\u517c\u5bb9\u6027\u95ee\u9898</p> <p>\u6709\u5173\u8fd9\u4e2a\u95ee\u9898\u54b1\u4eec\u5df2\u7ecf\u63a2\u8ba8\u8fc7\u4e86\uff0c\u5f53\u6211\u4eec\u4f7f\u7528\u6279\u5904\u7406\u7684\u547d\u4ee4\u65f6\uff0credis\u8981\u6c42\u6211\u4eec\u7684key\u5fc5\u987b\u843d\u5728\u76f8\u540c\u7684slot\u4e0a\uff0c\u7136\u540e\u5927\u91cf\u7684key\u540c\u65f6\u64cd\u4f5c\u65f6\uff0c\u662f\u65e0\u6cd5\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u5fc5\u987b\u8981\u5bf9\u8fd9\u6837\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u4e9b\u65b9\u6848\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u63a2\u8ba8\u8fc7\u4e86\uff0c\u6240\u4ee5\u4e0d\u518d\u8fd9\u4e2a\u5730\u65b9\u8d58\u8ff0\u4e86\u3002</p> <p>\u95ee\u98984\u3001lua\u548c\u4e8b\u52a1\u7684\u95ee\u9898</p> <p>lua\u548c\u4e8b\u52a1\u90fd\u662f\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u95ee\u9898\uff0c\u5982\u679ckey\u4e0d\u5728\u4e00\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u662f\u65e0\u6cd5\u4fdd\u8bc1lua\u7684\u6267\u884c\u548c\u4e8b\u52a1\u7684\u7279\u6027\u7684\uff0c\u6240\u4ee5\u5728\u96c6\u7fa4\u6a21\u5f0f\u662f\u6ca1\u6709\u529e\u6cd5\u6267\u884clua\u548c\u4e8b\u52a1\u7684</p> <p>Info</p> <p>\u96c6\u7fa4\u8fd8\u662f\u4e3b\u4ece \u5355\u4f53Redis\uff08\u4e3b\u4eceRedis\uff09\u5df2\u7ecf\u80fd\u8fbe\u5230\u4e07\u7ea7\u522b\u7684QPS\uff0c\u5e76\u4e14\u4e5f\u5177\u5907\u5f88\u5f3a\u7684\u9ad8\u53ef\u7528\u7279\u6027\u3002\u5982\u679c\u4e3b\u4ece\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u662f\u5728\u4e07\u4e0d\u5f97\u5df2\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u91cf\u4e0d\u642d\u5efaRedis\u96c6\u7fa4</p>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/","title":"\u8ba4\u8bc6Redis","text":"<p>Redis\u8bde\u751f\u4e8e2009\u5e74\uff0c\u5168\u79f0\u662fRemote Dictionary Server\uff0c\u8fdc\u7a0b\u8bcd\u5178\u670d\u52a1\u5668\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u952e\u503c\u578bNoSQL\u6570\u636e\u5e93\u3002</p> <p>Redis - The Real-time Data Platform</p> <p>\u7279\u5f81\uff1a</p> <ul> <li>\u952e\u503c\uff08key-value\uff09\u578b\uff0cvalue\u652f\u6301\u591a\u79cd\u4e0d\u540c\u6570\u636e\u7ed3\u6784\uff0c\u529f\u80fd\u4e30\u5bcc</li> <li>\u5355\u7ebf\u7a0b\uff08\u65e9\u671f\u7248\u672c\uff09\uff0c\u6bcf\u4e2a\u547d\u4ee4\u5177\u5907\u539f\u5b50\u6027</li> <li>\u4f4e\u5ef6\u8fdf\uff0c\u901f\u5ea6\u5feb\uff08\u57fa\u4e8e\u5185\u5b58\u3001IO\u591a\u8def\u590d\u7528\u3001\u826f\u597d\u7684\u7f16\u7801\uff09\u3002</li> <li>\u652f\u6301\u6570\u636e\u6301\u4e45\u5316</li> <li>\u652f\u6301\u4e3b\u4ece\u96c6\u7fa4\u3001\u5206\u7247\u96c6\u7fa4</li> <li>\u652f\u6301\u591a\u8bed\u8a00\u5ba2\u6237\u7aef</li> </ul> <p>\u7b80\u5355\u5b89\u88c5Redis</p> <pre><code>## Docker \u521b\u5efa Redis \u5bb9\u5668\u547d\u4ee4\ndocker run -d \\\n--log-opt max-size=100m \\\n--log-opt max-file=2 \\\n-p 6379:6379 \\\n--name redis \\\n-v /home/ysh/redis/conf/redis.conf:/etc/redis/redis.conf  \\\n-v /home/ysh/redis/data:/data \\\n-d redis redis-server /etc/redis/redis.conf \\\n--appendonly yes \\\n--requirepass 123456 #\u5bc6\u7801\n</code></pre> <p>\u8fdb\u5165\u5bb9\u5668\u5185\u90e8\u6d4b\u8bd5redis</p> <pre><code>docker exec -it redis /bin/bash\n\nredis-cli -h localhost -p 6379 -a 123456\n\nping\n</code></pre>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#redis\u901a\u7528\u547d\u4ee4","title":"Redis\u901a\u7528\u547d\u4ee4","text":"<ul> <li>KEYS\uff1a\u67e5\u770b\u7b26\u5408\u6a21\u677f\u7684\u6240\u6709key\uff0c\u652f\u6301\u901a\u914d\u7b26\uff0c\u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528</li> <li>DEL\uff1a\u5220\u9664\u4e00\u4e2a\uff08\u6216\u591a\u4e2a\uff09\u6307\u5b9a\u7684key</li> <li>EXISTS\uff1a\u5224\u65adkey\u662f\u5426\u5b58\u5728</li> <li>EXPIRE\uff1a\u7ed9\u4e00\u4e2akey\u8bbe\u7f6e\u6709\u6548\u671f\uff08\u5355\u4f4d\u79d2\uff09\uff0c\u6709\u6548\u671f\u5230\u671f\u65f6\u8be5key\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\uff0c\u4e0d\u8bbe\u7f6e\u6709\u6548\u671f\u65f6\u9ed8\u8ba4\u4e3a-1\uff08\u6c38\u4e45\u6709\u6548\uff09</li> <li>TTL\uff1a\u67e5\u770b\u4e00\u4e2aKEY\u7684\u5269\u4f59\u6709\u6548\u671f</li> </ul> <p>Tip</p> <p>\u901a\u8fc7help [command] \u53ef\u4ee5\u67e5\u770b\u4e00\u4e2a\u547d\u4ee4\u7684\u5177\u4f53\u7528\u6cd5</p>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#key\u7684\u7ed3\u6784","title":"key\u7684\u7ed3\u6784","text":"<p>Redis\u7684key\u5141\u8bb8\u6709\u591a\u4e2a\u5355\u8bcd\u5f62\u6210\u5c42\u7ea7\u7ed3\u6784\uff0c\u591a\u4e2a\u5355\u8bcd\u4e4b\u95f4\u7528':'\u9694\u5f00\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a <pre><code>*\u9879\u76ee\u540d:\u4e1a\u52a1\u540d:\u7c7b\u578b:id*\n</code></pre></p> <p>\u4f8b\u5982\u6211\u4eec\u7684\u9879\u76ee\u540d\u79f0\u53eb ysh\uff0c\u6709user\u548cproduct\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49key\uff1a <pre><code>user\u76f8\u5173\u7684key\uff1aysh:user:1\n\nproduct\u76f8\u5173\u7684key\uff1aysh:product:1\n</code></pre></p>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#\u6570\u636e\u7c7b\u578b","title":"\u6570\u636e\u7c7b\u578b","text":""},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#string","title":"String","text":"<p>String\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u662fRedis\u4e2d\u6700\u7b80\u5355\u7684\u5b58\u50a8\u7c7b\u578b\u3002</p> <p>\u5176value\u662f\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u6839\u636e\u5b57\u7b26\u4e32\u7684\u683c\u5f0f\u4e0d\u540c\uff0c\u53c8\u53ef\u4ee5\u5206\u4e3a3\u7c7b\uff1a</p> <ul> <li>string\uff1a\u666e\u901a\u5b57\u7b26\u4e32</li> <li>int\uff1a\u6574\u6570\u7c7b\u578b\uff0c\u53ef\u4ee5\u505a\u81ea\u589e\u3001\u81ea\u51cf\u64cd\u4f5c</li> <li>float\uff1a\u6d6e\u70b9\u7c7b\u578b\uff0c\u53ef\u4ee5\u505a\u81ea\u589e\u3001\u81ea\u51cf\u64cd\u4f5c</li> </ul> <p>\u4e0d\u7ba1\u662f\u54ea\u79cd\u683c\u5f0f\uff0c\u5e95\u5c42\u90fd\u662f\u5b57\u8282\u6570\u7ec4\u5f62\u5f0f\u5b58\u50a8\uff0c\u53ea\u4e0d\u8fc7\u662f\u7f16\u7801\u65b9\u5f0f\u4e0d\u540c\u3002\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6700\u5927\u7a7a\u95f4\u4e0d\u80fd\u8d85\u8fc7512m.</p> <p>String\u7684\u5e38\u89c1\u547d\u4ee4\u6709\uff1a</p> <ul> <li>SET\uff1a\u6dfb\u52a0\u6216\u8005\u4fee\u6539\u5df2\u7ecf\u5b58\u5728\u7684\u4e00\u4e2aString\u7c7b\u578b\u7684\u952e\u503c\u5bf9<code>SET key value</code></li> <li>GET\uff1a\u6839\u636ekey\u83b7\u53d6String\u7c7b\u578b\u7684value<code>GET key</code></li> <li>MSET\uff1a\u6279\u91cf\u6dfb\u52a0\u591a\u4e2aString\u7c7b\u578b\u7684\u952e\u503c\u5bf9</li> <li>MGET\uff1a\u6839\u636e\u591a\u4e2akey\u83b7\u53d6\u591a\u4e2aString\u7c7b\u578b\u7684value</li> <li>INCR\uff1a\u8ba9\u4e00\u4e2a\u6574\u578b\u7684key\u81ea\u589e1</li> <li>INCRBY:\u8ba9\u4e00\u4e2a\u6574\u578b\u7684key\u81ea\u589e\u5e76\u6307\u5b9a\u6b65\u957f\uff0c\u4f8b\u5982\uff1aincrby num 2 \u8ba9num\u503c\u81ea\u589e2</li> <li>INCRBYFLOAT\uff1a\u8ba9\u4e00\u4e2a\u6d6e\u70b9\u7c7b\u578b\u7684\u6570\u5b57\u81ea\u589e\u5e76\u6307\u5b9a\u6b65\u957f</li> <li>SETNX\uff1a\u6dfb\u52a0\u4e00\u4e2aString\u7c7b\u578b\u7684\u952e\u503c\u5bf9\uff0c\u524d\u63d0\u662f\u8fd9\u4e2akey\u4e0d\u5b58\u5728\uff0c\u5426\u5219\u4e0d\u6267\u884c</li> <li>SETEX\uff1a\u6dfb\u52a0\u4e00\u4e2aString\u7c7b\u578b\u7684\u952e\u503c\u5bf9\uff0c\u5e76\u4e14\u6307\u5b9a\u6709\u6548\u671f</li> </ul>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#hash","title":"Hash","text":"<p>Hash\u7c7b\u578b\uff0c\u4e5f\u53eb\u6563\u5217\uff0c\u5176value\u662f\u4e00\u4e2a\u65e0\u5e8f\u5b57\u5178\uff0c\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684HashMap\u7ed3\u6784\u3002</p> <p>\u53ef\u4ee5\u5c06\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3aJSON\u5b57\u7b26\u4e32\u540e\u5b58\u50a8\u4e3aString\u7ed3\u6784\uff0c\u4f46\u662f\u9700\u8981\u4fee\u6539\u5bf9\u8c61\u67d0\u4e2a\u5b57\u6bb5\u65f6\u5f88\u4e0d\u65b9\u4fbf</p> <p>Hash\u7ed3\u6784\u53ef\u4ee5\u5c06\u5bf9\u8c61\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u72ec\u7acb\u5b58\u50a8\uff0c\u53ef\u4ee5\u9488\u5bf9\u5355\u4e2a\u5b57\u6bb5\u505aCRUD</p> <p></p> <p>Hash\u7684\u5e38\u89c1\u547d\u4ee4\u6709\uff1a</p> <ul> <li>HSET key field value\uff1a\u6dfb\u52a0\u6216\u8005\u4fee\u6539hash\u7c7b\u578bkey\u7684field\u7684\u503c</li> <li>HGET key field\uff1a\u83b7\u53d6\u4e00\u4e2ahash\u7c7b\u578bkey\u7684field\u7684\u503c</li> <li>HMSET\uff1a\u6279\u91cf\u6dfb\u52a0\u591a\u4e2ahash\u7c7b\u578bkey\u7684field\u7684\u503c</li> <li>HMGET\uff1a\u6279\u91cf\u83b7\u53d6\u591a\u4e2ahash\u7c7b\u578bkey\u7684field\u7684\u503c</li> <li>HGETALL\uff1a\u83b7\u53d6\u4e00\u4e2ahash\u7c7b\u578b\u7684key\u4e2d\u7684\u6240\u6709\u7684field\u548cvalue</li> <li>HKEYS\uff1a\u83b7\u53d6\u4e00\u4e2ahash\u7c7b\u578b\u7684key\u4e2d\u7684\u6240\u6709\u7684field</li> <li>HVALS\uff1a\u83b7\u53d6\u4e00\u4e2ahash\u7c7b\u578b\u7684key\u4e2d\u7684\u6240\u6709\u7684value</li> <li>HINCRBY:\u8ba9\u4e00\u4e2ahash\u7c7b\u578bkey\u7684\u5b57\u6bb5\u503c\u81ea\u589e\u5e76\u6307\u5b9a\u6b65\u957f</li> <li>HSETNX\uff1a\u6dfb\u52a0\u4e00\u4e2ahash\u7c7b\u578b\u7684key\u7684field\u503c\uff0c\u524d\u63d0\u662f\u8fd9\u4e2afield\u4e0d\u5b58\u5728\uff0c\u5426\u5219\u4e0d\u6267\u884c</li> </ul>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#list","title":"List","text":"<p>Redis\u4e2d\u7684List\u7c7b\u578b\u4e0eJava\u4e2d\u7684LinkedList\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u7ed3\u6784\u3002</p> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u6709\u5e8f</li> <li>\u5143\u7d20\u53ef\u4ee5\u91cd\u590d</li> <li>\u63d2\u5165\u548c\u5220\u9664\u5feb</li> <li>\u67e5\u8be2\u901f\u5ea6\u4e00\u822c</li> </ul> <p>List\u7684\u5e38\u89c1\u547d\u4ee4\u6709\uff1a</p> <ul> <li>LPUSH key element ... \uff1a\u5411\u5217\u8868\u5de6\u4fa7\u63d2\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20</li> <li>LPOP key\uff1a\u79fb\u9664\u5e76\u8fd4\u56de\u5217\u8868\u5de6\u4fa7\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u6ca1\u6709\u5219\u8fd4\u56denil</li> <li>RPUSH key element ... \uff1a\u5411\u5217\u8868\u53f3\u4fa7\u63d2\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20</li> <li>RPOP key\uff1a\u79fb\u9664\u5e76\u8fd4\u56de\u5217\u8868\u53f3\u4fa7\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20</li> <li>LRANGE key star end\uff1a\u8fd4\u56de\u4e00\u6bb5\u89d2\u6807\u8303\u56f4\u5185\u7684\u6240\u6709\u5143\u7d20</li> <li>BLPOP\u548cBRPOP\uff1a\u4e0eLPOP\u548cRPOP\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5728\u6ca1\u6709\u5143\u7d20\u65f6\u7b49\u5f85\u6307\u5b9a\u65f6\u95f4\uff08\u963b\u585e\u5f0f\uff09\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8fd4\u56denil</li> </ul> <p></p>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#set","title":"Set","text":"<p>Redis\u7684Set\u7ed3\u6784\u4e0eJava\u4e2d\u7684HashSet\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u4e2avalue\u4e3anull\u7684HashMap\u3002\u56e0\u4e3a\u4e5f\u662f\u4e00\u4e2ahash\u8868\uff0c\u56e0\u6b64\u5177\u5907\u4e0eHashSet\u7c7b\u4f3c\u7684\u7279\u5f81</p> <ul> <li>\u65e0\u5e8f</li> <li>\u5143\u7d20\u4e0d\u53ef\u91cd\u590d</li> <li>\u67e5\u627e\u5feb</li> <li>\u652f\u6301\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6\u7b49\u529f\u80fd</li> </ul> <p>Set\u7684\u5e38\u89c1\u547d\u4ee4\u6709\uff1a</p> <ul> <li>SADD key member ... \uff1a\u5411set\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20</li> <li>SREM key member ... : \u79fb\u9664set\u4e2d\u7684\u6307\u5b9a\u5143\u7d20</li> <li>SCARD key\uff1a \u8fd4\u56deset\u4e2d\u5143\u7d20\u7684\u4e2a\u6570</li> <li>SISMEMBER key member\uff1a\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5b58\u5728\u4e8eset\u4e2d</li> <li>SMEMBERS\uff1a\u83b7\u53d6set\u4e2d\u7684\u6240\u6709\u5143\u7d20</li> <li>SINTER key1 key2 ... \uff1a\u6c42key1\u4e0ekey2\u7684\u4ea4\u96c6</li> <li>SDIFF key1 key2 ... \uff1a\u6c42key1\u4e0ekey2\u7684\u5dee\u96c6 </li> <li>SUNION key1 key2 ..\uff1a\u6c42key1\u548ckey2\u7684\u5e76\u96c6</li> </ul> <p></p>"},{"location":"Redis/%E8%AE%A4%E8%AF%86Redis/#sortedset","title":"SortedSet","text":"<p>Redis\u7684SortedSet\u662f\u4e00\u4e2a\u53ef\u6392\u5e8f\u7684set\u96c6\u5408\uff0c\u4e0eJava\u4e2d\u7684TreeSet\u6709\u4e9b\u7c7b\u4f3c\uff0c\u4f46\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5374\u5dee\u522b\u5f88\u5927\u3002SortedSet\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u5e26\u6709\u4e00\u4e2ascore\u5c5e\u6027\uff0c\u53ef\u4ee5\u57fa\u4e8escore\u5c5e\u6027\u5bf9\u5143\u7d20\u6392\u5e8f\uff0c\u5e95\u5c42\u7684\u5b9e\u73b0\u662f\u4e00\u4e2a\u8df3\u8868\uff08SkipList\uff09\u52a0 hash\u8868\u3002</p> <ul> <li>\u53ef\u6392\u5e8f</li> <li>\u5143\u7d20\u4e0d\u91cd\u590d</li> <li>\u67e5\u8be2\u901f\u5ea6\u5feb</li> </ul> <p>SortedSet\u7684\u5e38\u89c1\u547d\u4ee4\u6709\uff1a</p> <ul> <li>ZADD key score member\uff1a\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20\u5230sorted set \uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u5219\u66f4\u65b0\u5176score\u503c</li> <li>ZREM key member\uff1a\u5220\u9664sorted set\u4e2d\u7684\u4e00\u4e2a\u6307\u5b9a\u5143\u7d20</li> <li>ZSCORE key member : \u83b7\u53d6sorted set\u4e2d\u7684\u6307\u5b9a\u5143\u7d20\u7684score\u503c</li> <li>ZRANK key member\uff1a\u83b7\u53d6sorted set \u4e2d\u7684\u6307\u5b9a\u5143\u7d20\u7684\u6392\u540d\uff08\u6392\u540d\u4ece0\u5f00\u59cb\uff09</li> <li>ZCARD key\uff1a\u83b7\u53d6sorted set\u4e2d\u7684\u5143\u7d20\u4e2a\u6570</li> <li>ZCOUNT key min max\uff1a\u7edf\u8ba1score\u503c\u5728\u7ed9\u5b9a\u8303\u56f4\u5185\u7684\u6240\u6709\u5143\u7d20\u7684\u4e2a\u6570</li> <li>ZINCRBY key increment member\uff1a\u8ba9sorted set\u4e2d\u7684\u6307\u5b9a\u5143\u7d20\u81ea\u589e\uff0c\u6b65\u957f\u4e3a\u6307\u5b9a\u7684increment\u503c</li> <li>ZRANGE key min max\uff1a\u6309\u7167score\u6392\u5e8f\u540e\uff0c\u83b7\u53d6\u6307\u5b9a\u6392\u540d\u8303\u56f4\u5185\u7684\u5143\u7d20</li> <li>ZRANGEBYSCORE key min max\uff1a\u6309\u7167score\u6392\u5e8f\u540e\uff0c\u83b7\u53d6\u6307\u5b9ascore\u8303\u56f4\u5185\u7684\u5143\u7d20</li> <li>ZDIFF\u3001ZINTER\u3001ZUNION\uff1a\u6c42\u5dee\u96c6\u3001\u4ea4\u96c6\u3001\u5e76\u96c6</li> </ul> <p>Tip</p> <p>\u6240\u6709\u7684\u6392\u540d\u9ed8\u8ba4\u90fd\u662f\u5347\u5e8f\uff0c\u5982\u679c\u8981\u964d\u5e8f\u5219\u5728\u547d\u4ee4\u7684Z\u540e\u9762\u6dfb\u52a0REV\u5373\u53ef</p>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/","title":"\u96c6\u7fa4","text":""},{"location":"Redis/%E9%9B%86%E7%BE%A4/#redis\u96c6\u7fa4","title":"Redis\u96c6\u7fa4","text":"<p>\u5355\u673aRedis\u5b58\u5728\u5982\u4e0b\u95ee\u9898\uff1a</p> <ol> <li>\u6570\u636e\u4e22\u5931\u95ee\u95ee\u9898</li> <li>\u5e76\u53d1\u4e0d\u8db3\u95ee\u9898</li> <li>\u5b58\u50a8\u80fd\u529b\u95ee\u9898</li> <li>\u6545\u969c\u6062\u590d\u95ee\u9898</li> </ol> <p></p> <p>\u5bf9\u5e94\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u6301\u4e45\u5316</li> <li>\u4e3b\u4ece\u96c6\u7fa4</li> <li>\u5206\u7247\u96c6\u7fa4</li> <li>\u54e8\u5175\u673a\u5236</li> </ol>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#redis\u6301\u4e45\u5316","title":"Redis\u6301\u4e45\u5316","text":"<p>Redis\u6709\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u6848\uff1a</p> <ul> <li>RDB\u6301\u4e45\u5316</li> <li>AOF\u6301\u4e45\u5316</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#rdb\u6301\u4e45\u5316","title":"RDB\u6301\u4e45\u5316","text":"<p>RDB\u5168\u79f0Redis Database Backup file\uff08Redis\u6570\u636e\u5907\u4efd\u6587\u4ef6\uff09\uff0c\u4e5f\u88ab\u53eb\u505aRedis\u6570\u636e\u5feb\u7167\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u628a\u5185\u5b58\u4e2d\u7684\u6240\u6709\u6570\u636e\u90fd\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\u3002\u5f53Redis\u5b9e\u4f8b\u6545\u969c\u91cd\u542f\u540e\uff0c\u4ece\u78c1\u76d8\u8bfb\u53d6\u5feb\u7167\u6587\u4ef6\uff0c\u6062\u590d\u6570\u636e\u3002\u5feb\u7167\u6587\u4ef6\u79f0\u4e3aRDB\u6587\u4ef6\uff0c\u9ed8\u8ba4\u662f\u4fdd\u5b58\u5728\u5f53\u524d\u8fd0\u884c\u76ee\u5f55\u3002</p> <p>RDB\u6301\u4e45\u5316\u5728\u56db\u79cd\u60c5\u51b5\u4e0b\u4f1a\u6267\u884c\uff1a</p> <ul> <li>\u6267\u884csave\u547d\u4ee4\uff08\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b\uff09</li> <li>\u6267\u884cbgsave\u547d\u4ee4\uff08\u5f02\u6b65\u6267\u884c\uff09</li> <li>Redis\u505c\u673a\u65f6</li> <li>\u89e6\u53d1RDB\u6761\u4ef6\u65f6</li> </ul> <p>Redis\u5185\u90e8\u6709\u89e6\u53d1RDB\u7684\u673a\u5236\uff0c\u53ef\u4ee5\u5728redis.conf\u6587\u4ef6\u4e2d\u627e\u5230\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>## 900\u79d2\u5185\uff0c\u5982\u679c\u81f3\u5c11\u67091\u4e2akey\u88ab\u4fee\u6539\uff0c\u5219\u6267\u884cbgsave \uff0c \u5982\u679c\u662fsave \"\" \u5219\u8868\u793a\u7981\u7528RDB\nsave 900 1  \nsave 300 10  \nsave 60 10000 \n</code></pre> <p>RDB\u7684\u5176\u5b83\u914d\u7f6e\u4e5f\u53ef\u4ee5\u5728redis.conf\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff1a</p> <pre><code>## \u662f\u5426\u538b\u7f29 ,\u5efa\u8bae\u4e0d\u5f00\u542f\uff0c\u538b\u7f29\u4e5f\u4f1a\u6d88\u8017cpu\uff0c\u78c1\u76d8\u7684\u8bdd\u4e0d\u503c\u94b1\nrdbcompression yes\n\n## RDB\u6587\u4ef6\u540d\u79f0\ndbfilename dump.rdb  \n\n## \u6587\u4ef6\u4fdd\u5b58\u7684\u8def\u5f84\u76ee\u5f55\ndir ./ \n</code></pre> <p>bgsave\u5f00\u59cb\u65f6\u4f1afork\u4e3b\u8fdb\u7a0b\u5f97\u5230\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u5171\u4eab\u4e3b\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u3002\u5b8c\u6210fork\u540e\u8bfb\u53d6\u5185\u5b58\u6570\u636e\u5e76\u5199\u5165 RDB \u6587\u4ef6\u3002</p> <p>fork\u91c7\u7528\u7684\u662fcopy-on-write\u6280\u672f\uff08\u5199\u65f6\u590d\u5236\uff09\uff1a</p> <ul> <li>\u5f53\u4e3b\u8fdb\u7a0b\u6267\u884c\u8bfb\u64cd\u4f5c\u65f6\uff0c\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\uff1b</li> <li>\u5f53\u4e3b\u8fdb\u7a0b\u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u5219\u4f1a\u62f7\u8d1d\u4e00\u4efd\u6570\u636e\uff0c\u6267\u884c\u5199\u64cd\u4f5c\u3002</li> </ul> <p></p> <p>RDB\u65b9\u5f0fbgsave\u7684\u57fa\u672c\u6d41\u7a0b\uff1f</p> <ul> <li>fork\u4e3b\u8fdb\u7a0b\u5f97\u5230\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5171\u4eab\u5185\u5b58\u7a7a\u95f4</li> <li>\u5b50\u8fdb\u7a0b\u8bfb\u53d6\u5185\u5b58\u6570\u636e\u5e76\u5199\u5165\u65b0\u7684RDB\u6587\u4ef6</li> <li>\u7528\u65b0RDB\u6587\u4ef6\u66ff\u6362\u65e7\u7684RDB\u6587\u4ef6</li> </ul> <p>RDB\u4f1a\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c\uff1fsave 60 1000\u4ee3\u8868\u4ec0\u4e48\u542b\u4e49\uff1f</p> <ul> <li>\u9ed8\u8ba4\u662f\u670d\u52a1\u505c\u6b62\u65f6</li> <li>\u4ee3\u886860\u79d2\u5185\u81f3\u5c11\u6267\u884c1000\u6b21\u4fee\u6539\u5219\u89e6\u53d1RDB</li> </ul> <p>RDB\u7684\u7f3a\u70b9\uff1f</p> <ul> <li>RDB\u6267\u884c\u95f4\u9694\u65f6\u95f4\u957f\uff0c\u4e24\u6b21RDB\u4e4b\u95f4\u5199\u5165\u6570\u636e\u6709\u4e22\u5931\u7684\u98ce\u9669</li> <li>fork\u5b50\u8fdb\u7a0b\u3001\u538b\u7f29\u3001\u5199\u51faRDB\u6587\u4ef6\u90fd\u6bd4\u8f83\u8017\u65f6</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#aof\u6301\u4e45\u5316","title":"AOF\u6301\u4e45\u5316","text":"<p>AOF\u5168\u79f0\u4e3aAppend Only File\uff08\u8ffd\u52a0\u6587\u4ef6\uff09\u3002Redis\u5904\u7406\u7684\u6bcf\u4e00\u4e2a\u5199\u547d\u4ee4\u90fd\u4f1a\u8bb0\u5f55\u5728AOF\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u547d\u4ee4\u65e5\u5fd7\u6587\u4ef6\u3002</p> <p>AOF\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u9700\u8981\u4fee\u6539redis.conf\u914d\u7f6e\u6587\u4ef6\u6765\u5f00\u542fAOF\uff1a</p> <pre><code>## \u662f\u5426\u5f00\u542fAOF\u529f\u80fd\uff0c\u9ed8\u8ba4\u662fno\nappendonly yes\n## AOF\u6587\u4ef6\u7684\u540d\u79f0\nappendfilename \"appendonly.aof\"\n</code></pre> <p>AOF\u7684\u547d\u4ee4\u8bb0\u5f55\u7684\u9891\u7387\u4e5f\u53ef\u4ee5\u901a\u8fc7redis.conf\u6587\u4ef6\u6765\u914d\u7f6e\uff1a</p> <pre><code>## \u8868\u793a\u6bcf\u6267\u884c\u4e00\u6b21\u5199\u547d\u4ee4\uff0c\u7acb\u5373\u8bb0\u5f55\u5230AOF\u6587\u4ef6\nappendfsync always \n## \u5199\u547d\u4ee4\u6267\u884c\u5b8c\u5148\u653e\u5165AOF\u7f13\u51b2\u533a\uff0c\u7136\u540e\u8868\u793a\u6bcf\u96941\u79d2\u5c06\u7f13\u51b2\u533a\u6570\u636e\u5199\u5230AOF\u6587\u4ef6\uff0c\u662f\u9ed8\u8ba4\u65b9\u6848\nappendfsync everysec \n## \u5199\u547d\u4ee4\u6267\u884c\u5b8c\u5148\u653e\u5165AOF\u7f13\u51b2\u533a\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u78c1\u76d8\nappendfsync no\n</code></pre> <p>\u5bf9\u6bd4\uff1a</p> \u914d\u7f6e\u9879 \u5b58\u76d8\u673a\u5236 \u4f18\u70b9 \u7f3a\u70b9 Always \u540c\u6b65 \u53ef\u9760\u6027\u9ad8 \u6027\u80fd\u5f71\u54cd\u5927 everysec \u6bcf\u79d2 \u6027\u80fd\u9002\u4e2d \u53ef\u80fd\u4e22\u59311\u79d2\u6570\u636e no \u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236 \u6027\u80fd\u6700\u597d \u53ef\u9760\u6027\u5dee <p>AOF\u6587\u4ef6\u91cd\u5199</p> <p>\u56e0\u4e3a\u662f\u8bb0\u5f55\u547d\u4ee4\uff0cAOF\u6587\u4ef6\u4f1a\u6bd4RDB\u6587\u4ef6\u5927\u7684\u591a\u3002\u800c\u4e14AOF\u4f1a\u8bb0\u5f55\u5bf9\u540c\u4e00\u4e2akey\u7684\u591a\u6b21\u5199\u64cd\u4f5c\uff0c\u4f46\u53ea\u6709\u6700\u540e\u4e00\u6b21\u5199\u64cd\u4f5c\u624d\u6709\u610f\u4e49\u3002\u901a\u8fc7\u6267\u884c<code>bgrewriteaof</code>\u547d\u4ee4\uff0c\u53ef\u4ee5\u8ba9AOF\u6587\u4ef6\u6267\u884c\u91cd\u5199\u529f\u80fd\uff0c\u7528\u6700\u5c11\u7684\u547d\u4ee4\u8fbe\u5230\u76f8\u540c\u6548\u679c\u3002</p> <p>Redis\u4e5f\u4f1a\u5728\u89e6\u53d1\u9608\u503c\u65f6\u81ea\u52a8\u53bb\u91cd\u5199AOF\u6587\u4ef6\u3002\u9608\u503c\u4e5f\u53ef\u4ee5\u5728redis.conf\u4e2d\u914d\u7f6e\uff1a</p> <pre><code>## AOF\u6587\u4ef6\u6bd4\u4e0a\u6b21\u6587\u4ef6 \u589e\u957f\u8d85\u8fc7\u591a\u5c11\u767e\u5206\u6bd4\u5219\u89e6\u53d1\u91cd\u5199\nauto-aof-rewrite-percentage 100\n## AOF\u6587\u4ef6\u4f53\u79ef\u6700\u5c0f\u591a\u5927\u4ee5\u4e0a\u624d\u89e6\u53d1\u91cd\u5199 \nauto-aof-rewrite-min-size 64mb \n</code></pre> <p>\u5bf9\u6bd4</p> RDB AOF \u6301\u4e45\u5316\u65b9\u5f0f \u5b9a\u65f6\u505a\u5185\u5b58\u5feb\u7167 \u8bb0\u5f55\u5199\u547d\u4ee4 \u6570\u636e\u5b8c\u6574\u6027 \u4e0d\u5b8c\u6574\uff0c\u672a\u5907\u4efd\u7684\u6570\u636e\u4e22\u5931 \u76f8\u5bf9\u5b8c\u6574\uff0c\u53d6\u51b3\u4e8e\u5b58\u76d8\u7b56\u7565 \u6587\u4ef6\u5927\u5c0f \u6709\u538b\u7f29\u673a\u5236\uff0c\u4f53\u79ef\u5c0f \u8bb0\u5f55\u547d\u4ee4\uff0c\u4f53\u79ef\u5927 \u5b95\u673a\u6062\u590d\u901f\u5ea6 \u5f88\u5feb \u6162 \u6570\u636e\u6062\u590d\u4f18\u5148\u7ea7 \u4f4e \u9ad8\uff08\u56e0\u4e3a\u5b8c\u6574\u6027\u66f4\u9ad8\uff09 \u7cfb\u7edf\u8d44\u6e90\u5360\u7528 \u9ad8\uff0c\u5927\u91cfCPU\u548c\u5185\u5b58\u6d88\u8017 \u4f4e\uff0c\u4e3b\u8981\u5360\u7528\u78c1\u76d8IO\uff08\u6587\u4ef6\u91cd\u5199\u65f6\u5360\u7528CPU\u548c\u5185\u5b58\uff09 \u4f7f\u7528\u573a\u666f \u53ef\u4ee5\u5bb9\u5fcd\u90e8\u5206\u6570\u636e\u4e22\u5931 \u5bf9\u6570\u636e\u5b8c\u6574\u6027\u8981\u6c42\u9ad8"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u4e3b\u4ece\u96c6\u7fa4","title":"\u4e3b\u4ece\u96c6\u7fa4","text":"<p>\u5355\u8282\u70b9Redis\u7684\u5e76\u53d1\u80fd\u529b\u662f\u6709\u4e0a\u9650\u7684\uff0c\u8981\u8fdb\u4e00\u6b65\u63d0\u9ad8Redis\u7684\u5e76\u53d1\u80fd\u529b\uff0c\u5c31\u9700\u8981\u642d\u5efa\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\u3002</p> <p>\u7b80\u5355\u67b6\u6784\u56fe\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u96c6\u7fa4\u4e2d\u6709\u4e00\u4e2amaster\u8282\u70b9\u3001\u4e24\u4e2aslave\u8282\u70b9\uff08\u73b0\u5df2\u6539\u4e3areplica\uff09\u3002\u5f53\u6211\u4eec\u901a\u8fc7Redis\u7684Java\u5ba2\u6237\u7aef\u8bbf\u95ee\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u5e94\u8be5\u505a\u597d\u8def\u7531\uff1a</p> <ul> <li>\u5982\u679c\u662f\u5199\u64cd\u4f5c\uff0c\u5e94\u8be5\u8bbf\u95eemaster\u8282\u70b9\uff0cmaster\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4e24\u4e2aslave\u8282\u70b9</li> <li>\u5982\u679c\u662f\u8bfb\u64cd\u4f5c\uff0c\u5efa\u8bae\u8bbf\u95ee\u5404\u4e2aslave\u8282\u70b9\uff0c\u4ece\u800c\u5206\u62c5\u5e76\u53d1\u538b\u529b</li> </ul> <p>\u4f7f\u7528docker compose\u542f\u52a8\u591a\u4e2aRedis\u5b9e\u4f8b\uff1a</p> <pre><code>version: \"3.2\"\n\nservices:\n  r1:\n    image: redis\n    container_name: r1\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7001\"]\n  r2:\n    image: redis\n    container_name: r2\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7002\"]\n  r3:\n    image: redis\n    container_name: r3\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7003\"]\n</code></pre> <p>\u9700\u8981\u901a\u8fc7\u547d\u4ee4\u6765\u914d\u7f6e\u4e3b\u4ece\u5173\u7cfb\uff1a</p> <pre><code>## \u4f7f\u7528redis-cli\u8fde\u63a5\u5230slave\u8282\u70b9\n\n## Redis5.0\u4ee5\u524d\nslaveof &lt;masterip&gt; &lt;masterport&gt;\n## Redis5.0\u4ee5\u540e\nreplicaof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre> <p>\u6709\u4e34\u65f6\u548c\u6c38\u4e45\u4e24\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li>\u6c38\u4e45\u751f\u6548\uff1a\u5728redis.conf\u6587\u4ef6\u4e2d\u5229\u7528<code>slaveof</code>\u547d\u4ee4\u6307\u5b9a<code>master</code>\u8282\u70b9</li> <li>\u4e34\u65f6\u751f\u6548\uff1a\u76f4\u63a5\u5229\u7528redis-cli\u63a7\u5236\u53f0\u8f93\u5165<code>slaveof</code>\u547d\u4ee4\uff0c\u6307\u5b9a<code>master</code>\u8282\u70b9</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u5168\u91cf\u540c\u6b65","title":"\u5168\u91cf\u540c\u6b65","text":"<p>\u4e3b\u4ece\u7b2c\u4e00\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u4f1a\u6267\u884c\u5168\u91cf\u540c\u6b65\uff0c\u5c06master\u8282\u70b9\u7684\u6240\u6709\u6570\u636e\u90fd\u62f7\u8d1d\u7ed9slave\u8282\u70b9</p> <p></p> <p><code>master</code>\u5982\u4f55\u5224\u65ad<code>salve</code>\u662f\u5426\u662f\u7b2c\u4e00\u6b21\u6765\u540c\u6b65\uff1f</p> <ul> <li><code>Replication Id</code>\uff1a\u7b80\u79f0<code>replid</code>\uff0c\u662f\u6570\u636e\u96c6\u7684\u6807\u8bb0\uff0creplid\u4e00\u81f4\u5219\u662f\u540c\u4e00\u6570\u636e\u96c6\u3002\u6bcf\u4e2a<code>master</code>\u90fd\u6709\u552f\u4e00\u7684<code>replid</code>\uff0c<code>slave</code>\u5219\u4f1a\u7ee7\u627f<code>master</code>\u8282\u70b9\u7684<code>replid</code></li> <li><code>offset</code>\uff1a\u504f\u79fb\u91cf\uff0c\u968f\u7740\u8bb0\u5f55\u5728<code>repl_baklog</code>\u4e2d\u7684\u6570\u636e\u589e\u591a\u800c\u9010\u6e10\u589e\u5927\u3002<code>slave</code>\u5b8c\u6210\u540c\u6b65\u65f6\u4e5f\u4f1a\u8bb0\u5f55\u5f53\u524d\u540c\u6b65\u7684<code>offset</code>\u3002\u5982\u679c<code>slave</code>\u7684<code>offset</code>\u5c0f\u4e8e<code>master</code>\u7684<code>offset</code>\uff0c\u8bf4\u660e<code>slave</code>\u6570\u636e\u843d\u540e\u4e8e<code>master</code>\uff0c\u9700\u8981\u66f4\u65b0\u3002</li> </ul> <p>Note</p> <p>master\u5224\u65ad\u4e00\u4e2a\u8282\u70b9\u662f\u5426\u662f\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u4f9d\u636e\uff0c\u5c31\u662f\u770breplid\u662f\u5426\u4e00\u81f4</p>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u589e\u91cf\u540c\u6b65","title":"\u589e\u91cf\u540c\u6b65","text":"<p>\u5168\u91cf\u540c\u6b65\u9700\u8981\u5148\u505aRDB\uff0c\u7136\u540e\u5c06RDB\u6587\u4ef6\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u4e2aslave\uff0c\u6210\u672c\u592a\u9ad8\u4e86\u3002 \u56e0\u6b64\u9664\u4e86\u7b2c\u4e00\u6b21\u505a\u5168\u91cf\u540c\u6b65\uff0c\u5176\u5b83\u5927\u591a\u6570\u65f6\u5019slave\u4e0emaster\u90fd\u662f\u505a\u589e\u91cf\u540c\u6b65</p> <p></p> <p>\u4e3b\u8981\u7531<code>repl_baklog</code>\u6587\u4ef6\u5b9e\u73b0\u3002\u8fd9\u4e2a\u6587\u4ef6\u662f\u4e00\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684\u6570\u7ec4\uff0c\u53ea\u4e0d\u8fc7\u6570\u7ec4\u662f\u73af\u5f62\uff0c\u4e5f\u5c31\u662f\u8bf4\u89d2\u6807\u5230\u8fbe\u6570\u7ec4\u672b\u5c3e\u540e\uff0c\u4f1a\u518d\u6b21\u4ece0\u5f00\u59cb\u8bfb\u5199\uff0c\u8fd9\u6837\u6570\u7ec4\u5934\u90e8\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u8986\u76d6\u3002</p> <p><code>repl_baklog</code>\u4e2d\u4f1a\u8bb0\u5f55Redis\u5904\u7406\u8fc7\u7684\u547d\u4ee4\u53ca<code>offset</code>\uff0c\u5305\u62ecmaster\u5f53\u524d\u7684<code>offset</code>\uff0c\u548cslave\u5df2\u7ecf\u62f7\u8d1d\u5230\u7684<code>offset</code>\uff1a</p> <p></p> <p>slave\u4e0emaster\u7684offset\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u5c31\u662fslave\u9700\u8981\u589e\u91cf\u62f7\u8d1d\u7684\u6570\u636e\u4e86\u3002</p> <p>\u5982\u679cslave\u51fa\u73b0\u7f51\u7edc\u963b\u585e\uff0c\u5bfc\u81f4master\u7684<code>offset</code>\u8fdc\u8fdc\u8d85\u8fc7\u4e86slave\u7684<code>offset</code>\uff0c\u5f53master\u7684offset\u8986\u76d6\u4e86slave\u672a\u540c\u6b65\u7684offset,\u5982\u679cslave\u6062\u590d\uff0c\u9700\u8981\u540c\u6b65\uff0c\u5374\u53d1\u73b0\u81ea\u5df1\u7684<code>offset</code>\u90fd\u6ca1\u6709\u4e86\uff0c\u65e0\u6cd5\u5b8c\u6210\u589e\u91cf\u540c\u6b65\u4e86\u3002\u53ea\u80fd\u505a\u5168\u91cf\u540c\u6b65\u3002</p>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u4e3b\u4ece\u540c\u6b65\u4f18\u5316","title":"\u4e3b\u4ece\u540c\u6b65\u4f18\u5316","text":"<ul> <li> <p>\u5728master\u4e2d\u914d\u7f6e<code>repl-diskless-sync  yes</code>\u542f\u7528\u65e0\u78c1\u76d8\u590d\u5236\uff0c\u907f\u514d\u5168\u91cf\u540c\u6b65\u65f6\u7684\u78c1\u76d8IO\u3002</p> </li> <li> <p>Redis\u5355\u8282\u70b9\u4e0a\u7684\u5185\u5b58\u5360\u7528\u4e0d\u8981\u592a\u5927\uff0c\u51cf\u5c11RDB\u5bfc\u81f4\u7684\u8fc7\u591a\u78c1\u76d8IO</p> </li> <li> <p>\u9002\u5f53\u63d0\u9ad8<code>repl_baklog</code>\u7684\u5927\u5c0f\uff0c\u53d1\u73b0slave\u5b95\u673a\u65f6\u5c3d\u5feb\u5b9e\u73b0\u6545\u969c\u6062\u590d\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u5168\u91cf\u540c\u6b65</p> </li> <li> <p>\u9650\u5236\u4e00\u4e2amaster\u4e0a\u7684slave\u8282\u70b9\u6570\u91cf\uff0c\u5982\u679c\u5b9e\u5728\u662f\u592a\u591aslave\uff0c\u5219\u53ef\u4ee5\u91c7\u7528<code>\u4e3b-\u4ece-\u4ece</code>\u94fe\u5f0f\u7ed3\u6784\uff0c\u51cf\u5c11master\u538b\u529b</p> </li> </ul> <p><code>\u4e3b-\u4ece-\u4ece</code>\u67b6\u6784\u56fe\uff1a</p> <p></p>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u54e8\u5175\u6a21\u5f0f","title":"\u54e8\u5175\u6a21\u5f0f","text":"<p>Redis\u63d0\u4f9b\u4e86<code>\u54e8\u5175</code>\uff08<code>Sentinel</code>\uff09\u673a\u5236\u6765\u76d1\u63a7\u4e3b\u4ece\u96c6\u7fa4\u76d1\u63a7\u72b6\u6001\uff0c\u786e\u4fdd\u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u6027\u3002</p> <p></p> <p>\u54e8\u5175\u7684\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ul> <li>\u72b6\u6001\u76d1\u63a7\uff1a<code>Sentinel</code> \u4f1a\u4e0d\u65ad\u68c0\u67e5<code>master</code>\u548c<code>slave</code>\u662f\u5426\u6309\u9884\u671f\u5de5\u4f5c</li> <li>\u6545\u969c\u6062\u590d\uff08failover\uff09\uff1a\u5982\u679c<code>master</code>\u6545\u969c\uff0c<code>Sentinel</code>\u4f1a\u5c06\u4e00\u4e2a<code>slave</code>\u63d0\u5347\u4e3a<code>master</code>\u3002\u5f53\u6545\u969c\u5b9e\u4f8b\u6062\u590d\u540e\u4f1a\u6210\u4e3a<code>slave</code></li> <li>\u72b6\u6001\u901a\u77e5\uff1a<code>Sentinel</code>\u5145\u5f53<code>Redis</code>\u5ba2\u6237\u7aef\u7684\u670d\u52a1\u53d1\u73b0\u6765\u6e90\uff0c\u5f53\u96c6\u7fa4\u53d1\u751f<code>failover</code>\u65f6\uff0c\u4f1a\u5c06\u6700\u65b0\u96c6\u7fa4\u4fe1\u606f\u63a8\u9001\u7ed9<code>Redis</code>\u7684\u5ba2\u6237\u7aef</li> </ul> <p><code>Sentinel</code>\u57fa\u4e8e\u5fc3\u8df3\u673a\u5236\u76d1\u6d4b\u670d\u52a1\u72b6\u6001\uff0c\u6bcf\u96941\u79d2\u5411\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u53d1\u9001ping\u547d\u4ee4\uff0c\u5e76\u901a\u8fc7\u5b9e\u4f8b\u7684\u54cd\u5e94\u7ed3\u679c\u6765\u505a\u51fa\u5224\u65ad\uff1a</p> <ul> <li>\u4e3b\u89c2\u4e0b\u7ebf\uff08sdown\uff09\uff1a\u5982\u679c\u67d0sentinel\u8282\u70b9\u53d1\u73b0\u67d0Redis\u8282\u70b9\u672a\u5728\u89c4\u5b9a\u65f6\u95f4\u54cd\u5e94\uff0c\u5219\u8ba4\u4e3a\u8be5\u8282\u70b9\u4e3b\u89c2\u4e0b\u7ebf\u3002</li> <li>\u5ba2\u89c2\u4e0b\u7ebf(odown)\uff1a\u82e5\u8d85\u8fc7\u6307\u5b9a\u6570\u91cf\uff08\u901a\u8fc7<code>quorum</code>\u8bbe\u7f6e\uff09\u7684sentinel\u90fd\u8ba4\u4e3a\u8be5\u8282\u70b9\u4e3b\u89c2\u4e0b\u7ebf\uff0c\u5219\u8be5\u8282\u70b9\u5ba2\u89c2\u4e0b\u7ebf\u3002quorum\u503c\u6700\u597d\u8d85\u8fc7Sentinel\u8282\u70b9\u6570\u91cf\u7684\u4e00\u534a\uff0cSentinel\u8282\u70b9\u6570\u91cf\u81f3\u5c113\u53f0\u3002</li> </ul> <p>\u4e00\u65e6\u53d1\u73b0master\u6545\u969c\uff0csentinel\u9700\u8981\u5728salve\u4e2d\u9009\u62e9\u4e00\u4e2a\u4f5c\u4e3a\u65b0\u7684master\uff0c\u9009\u62e9\u4f9d\u636e\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u9996\u5148\u4f1a\u5224\u65adslave\u8282\u70b9\u4e0emaster\u8282\u70b9\u65ad\u5f00\u65f6\u95f4\u957f\u77ed\uff0c\u5982\u679c\u8d85\u8fc7<code>down-after-milliseconds * 10</code>\u5219\u4f1a\u6392\u9664\u8be5slave\u8282\u70b9</li> <li>\u7136\u540e\u5224\u65adslave\u8282\u70b9\u7684<code>slave-priority</code>\u503c\uff0c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u5982\u679c\u662f0\u5219\u6c38\u4e0d\u53c2\u4e0e\u9009\u4e3e\uff08\u9ed8\u8ba4\u90fd\u662f1\uff09\u3002</li> <li>\u5982\u679c<code>slave-prority</code>\u4e00\u6837\uff0c\u5219\u5224\u65adslave\u8282\u70b9\u7684<code>offset</code>\u503c\uff0c\u8d8a\u5927\u8bf4\u660e\u6570\u636e\u8d8a\u65b0\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8</li> <li>\u6700\u540e\u662f\u5224\u65adslave\u8282\u70b9\u7684<code>run_id</code>\u5927\u5c0f\uff0c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff08<code>\u901a\u8fc7info server\u53ef\u4ee5\u67e5\u770brun_id</code>\uff09\u3002</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u642d\u5efa\u54e8\u5175\u96c6\u7fa4","title":"\u642d\u5efa\u54e8\u5175\u96c6\u7fa4","text":"<p>sentinel.conf\u6587\u4ef6</p> <pre><code>sentinel announce-ip \"localhost\"\nsentinel monitor hmaster localhost 7001 2\nsentinel down-after-milliseconds hmaster 5000\nsentinel failover-timeout hmaster 60000\n</code></pre> <ul> <li><code>sentinel announce-ip \"localhost\"</code>\uff1a\u58f0\u660e\u5f53\u524dsentinel\u7684ip</li> <li><code>sentinel monitor hmaster localhost 7001 2</code>\uff1a\u6307\u5b9a\u96c6\u7fa4\u7684\u4e3b\u8282\u70b9\u4fe1\u606f <ul> <li><code>hmaster</code>\uff1a\u4e3b\u8282\u70b9\u540d\u79f0\uff0c\u81ea\u5b9a\u4e49\uff0c\u4efb\u610f\u5199</li> <li><code>localhost 7001</code>\uff1a\u4e3b\u8282\u70b9\u7684ip\u548c\u7aef\u53e3</li> <li><code>2</code>\uff1a\u8ba4\u5b9a<code>master</code>\u4e0b\u7ebf\u65f6\u7684<code>quorum</code>\u503c</li> </ul> </li> <li><code>sentinel down-after-milliseconds hmaster 5000</code>\uff1a\u58f0\u660emaster\u8282\u70b9\u8d85\u65f6\u591a\u4e45\u540e\u88ab\u6807\u8bb0\u4e0b\u7ebf</li> <li><code>sentinel failover-timeout hmaster 60000</code>\uff1a\u5728\u7b2c\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u5931\u8d25\u540e\u591a\u4e45\u518d\u6b21\u91cd\u8bd5</li> </ul> <p><code>docker-compose.yaml</code></p> <pre><code>version: \"3.2\"\n\nservices:\n  r1:\n    image: redis\n    container_name: r1\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7001\"]\n  r2:\n    image: redis\n    container_name: r2\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7002\", \"--slaveof\", \"localhost\", \"7001\"]\n  r3:\n    image: redis\n    container_name: r3\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7003\", \"--slaveof\", \"localhost\", \"7001\"]\n  s1:\n    image: redis\n    container_name: s1\n    volumes:\n      - /root/redis/s1:/etc/redis\n    network_mode: \"host\"\n    entrypoint: [\"redis-sentinel\", \"/etc/redis/sentinel.conf\", \"--port\", \"27001\"]\n  s2:\n    image: redis\n    container_name: s2\n    volumes:\n      - /root/redis/s2:/etc/redis\n    network_mode: \"host\"\n    entrypoint: [\"redis-sentinel\", \"/etc/redis/sentinel.conf\", \"--port\", \"27002\"]\n  s3:\n    image: redis\n    container_name: s3\n    volumes:\n      - /root/redis/s3:/etc/redis\n    network_mode: \"host\"\n    entrypoint: [\"redis-sentinel\", \"/etc/redis/sentinel.conf\", \"--port\", \"27003\"]\n</code></pre>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#redistemplate\u8fde\u63a5\u54e8\u5175","title":"RedisTemplate\u8fde\u63a5\u54e8\u5175","text":"<p>1.\u5f15\u5165redis\u4f9d\u8d56</p> <p>2.\u914d\u7f6e<code>application.yaml</code></p> <pre><code>spring:\n  redis:\n    sentinel:\n      master: mymaster # \u4e3b\u8282\u70b9\u540d\u79f0\n      nodes: # \u54e8\u5175\u96c6\u7fa4\u5730\u5740\n        - 192.168.150.101:7001\n        - 192.168.150.101:7002\n        - 192.168.150.101:7003\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0a\u914d\u7f6e\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u54e8\u5175\u627e\u5230\u4e3b\u4ece\u8282\u70b9</p> <p>3.\u914d\u7f6e\u8bfb\u5199\u5206\u79bb</p> <pre><code>@Bean\npublic LettuceClientConfigurationBuilderCustomizer clientConfigurationBuilderCustomizer(){\n    return clientConfigurationBuilder -&gt; clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);\n}\n</code></pre> <p>Note</p> <p>\u8fd9\u4e2abean\u4e2d\u914d\u7f6e\u7684\u5c31\u662f\u8bfb\u5199\u7b56\u7565\uff0c\u5305\u62ec\u56db\u79cd\uff1a</p> <ul> <li><code>MASTER</code>\uff1a\u4ece\u4e3b\u8282\u70b9\u8bfb\u53d6</li> <li><code>MASTER_PREFERRED</code>\uff1a\u4f18\u5148\u4ecemaster\u8282\u70b9\u8bfb\u53d6\uff0cmaster\u4e0d\u53ef\u7528\u624d\u8bfb\u53d6replica</li> <li><code>REPLICA</code>\uff1a\u4eceslave\uff08replica\uff09\u8282\u70b9\u8bfb\u53d6</li> <li><code>REPLICA _PREFERRED</code>\uff1a\u4f18\u5148\u4eceslave\uff08replica\uff09\u8282\u70b9\u8bfb\u53d6\uff0c\u6240\u6709\u7684slave\u90fd\u4e0d\u53ef\u7528\u624d\u8bfb\u53d6master</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u5206\u7247\u96c6\u7fa4","title":"\u5206\u7247\u96c6\u7fa4","text":"<p>\u4e3b\u4ece\u6a21\u5f0f\u53ef\u4ee5\u89e3\u51b3\u9ad8\u53ef\u7528\u3001\u9ad8\u5e76\u53d1\u8bfb\u7684\u95ee\u9898\u3002\u4f46\u4f9d\u7136\u6709\u4e24\u4e2a\u95ee\u9898\u6ca1\u6709\u89e3\u51b3\uff1a</p> <ul> <li>\u6d77\u91cf\u6570\u636e\u5b58\u50a8</li> <li>\u9ad8\u5e76\u53d1\u5199</li> </ul> <p>\u8981\u89e3\u51b3\u8fd9\u4e24\u4e2a\u95ee\u9898\u5c31\u9700\u8981\u7528\u5230\u5206\u7247\u96c6\u7fa4\u4e86\u3002\u5206\u7247\u7684\u610f\u601d\uff0c\u5c31\u662f\u628a\u6570\u636e\u62c6\u5206\u5b58\u50a8\u5230\u4e0d\u540c\u8282\u70b9\uff0c\u8fd9\u6837\u6574\u4e2a\u96c6\u7fa4\u7684\u5b58\u50a8\u6570\u636e\u91cf\u5c31\u66f4\u5927\u4e86\u3002</p> <p>Redis\u5206\u7247\u96c6\u7fa4\u7684\u7ed3\u6784\u5982\u56fe\uff1a</p> <p></p> <p>\u7279\u5f81\uff1a</p> <ul> <li>\u96c6\u7fa4\u4e2d\u6709\u591a\u4e2amaster\uff0c\u6bcf\u4e2amaster\u4fdd\u5b58\u4e0d\u540c\u5206\u7247\u6570\u636e \uff0c\u89e3\u51b3\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u95ee\u9898</li> <li>\u6bcf\u4e2amaster\u90fd\u53ef\u4ee5\u6709\u591a\u4e2aslave\u8282\u70b9 \uff0c\u786e\u4fdd\u9ad8\u53ef\u7528</li> <li>master\u4e4b\u95f4\u901a\u8fc7ping\u76d1\u6d4b\u5f7c\u6b64\u5065\u5eb7\u72b6\u6001 \uff0c\u7c7b\u4f3c\u54e8\u5175\u4f5c\u7528</li> <li>\u5ba2\u6237\u7aef\u8bf7\u6c42\u53ef\u4ee5\u8bbf\u95ee\u96c6\u7fa4\u4efb\u610f\u8282\u70b9\uff0c\u6700\u7ec8\u90fd\u4f1a\u88ab\u8f6c\u53d1\u5230\u6570\u636e\u6240\u5728\u8282\u70b9 </li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u642d\u5efa\u5206\u7247\u96c6\u7fa4","title":"\u642d\u5efa\u5206\u7247\u96c6\u7fa4","text":"<p>\u5206\u7247\u96c6\u7fa4\u4e2d\u7684Redis\u8282\u70b9\u5fc5\u987b\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\uff0c\u4e00\u822c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e0b\u9762\u53c2\u6570\uff1a</p> <pre><code>port 7000\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly yes\n</code></pre> <ul> <li><code>cluster-enabled</code>\uff1a\u662f\u5426\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f</li> <li><code>cluster-config-file</code>\uff1a\u96c6\u7fa4\u6a21\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\uff0c\u65e0\u9700\u624b\u52a8\u521b\u5efa\uff0c\u7531\u96c6\u7fa4\u81ea\u52a8\u7ef4\u62a4</li> <li><code>cluster-node-timeout</code>\uff1a\u96c6\u7fa4\u4e2d\u8282\u70b9\u4e4b\u95f4\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4</li> </ul> <p><code>docker-compose.yaml</code>\u90e8\u7f72\u8282\u70b9</p> <pre><code>version: \"3.2\"\n\nservices:\n  r1:\n    image: redis\n    container_name: r1\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7001\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n  r2:\n    image: redis\n    container_name: r2\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7002\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n  r3:\n    image: redis\n    container_name: r3\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7003\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n  r4:\n    image: redis\n    container_name: r4\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7004\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n  r5:\n    image: redis\n    container_name: r5\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7005\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n  r6:\n    image: redis\n    container_name: r6\n    network_mode: \"host\"\n    entrypoint: [\"redis-server\", \"--port\", \"7006\", \"--cluster-enabled\", \"yes\", \"--cluster-config-file\", \"node.conf\"]\n</code></pre> <p>Warning</p> <p>\u4f7f\u7528Docker\u90e8\u7f72Redis\u96c6\u7fa4\uff0cnetwork\u6a21\u5f0f\u5fc5\u987b\u91c7\u7528host</p> <p>\u521b\u5efa\u96c6\u7fa4</p> <pre><code>## \u8fdb\u5165\u4efb\u610f\u8282\u70b9\u5bb9\u5668\ndocker exec -it r1 bash\n## \u7136\u540e\uff0c\u6267\u884c\u547d\u4ee4\nredis-cli --cluster create --cluster-replicas 1 \\\n192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 \\\n192.168.150.101:7004 192.168.150.101:7005 192.168.150.101:7006\n</code></pre> <ul> <li><code>redis-cli --cluster</code>\uff1a\u4ee3\u8868\u96c6\u7fa4\u64cd\u4f5c\u547d\u4ee4</li> <li><code>create</code>\uff1a\u4ee3\u8868\u662f\u521b\u5efa\u96c6\u7fa4</li> <li><code>--cluster-replicas 1</code> \uff1a\u6307\u5b9a\u96c6\u7fa4\u4e2d\u6bcf\u4e2a<code>master</code>\u7684\u526f\u672c(<code>slave</code>)\u4e2a\u6570\u4e3a1</li> <li>\u6b64\u65f6<code>\u8282\u70b9\u603b\u6570 \u00f7 (replicas + 1)</code> \u5f97\u5230\u7684\u5c31\u662f<code>master</code>\u7684\u6570\u91cf<code>n</code>\u3002\u56e0\u6b64\u8282\u70b9\u5217\u8868\u4e2d\u7684\u524d<code>n</code>\u4e2a\u8282\u70b9\u5c31\u662f<code>master</code>\uff0c\u5176\u5b83\u8282\u70b9\u90fd\u662f<code>slave</code>\u8282\u70b9\uff0c\u968f\u673a\u5206\u914d\u5230\u4e0d\u540c<code>master</code></li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff1a</p> <pre><code>redis-cli -p 7001 cluster nodes\n</code></pre>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u6563\u5217\u63d2\u69fd","title":"\u6563\u5217\u63d2\u69fd","text":"<p>\u636e\u8981\u5206\u7247\u5b58\u50a8\u5230\u4e0d\u540c\u7684Redis\u8282\u70b9\uff0c\u80af\u5b9a\u9700\u8981\u6709\u5206\u7247\u7684\u4f9d\u636e\uff0c\u8fd9\u6837\u4e0b\u6b21\u67e5\u8be2\u7684\u65f6\u5019\u624d\u80fd\u77e5\u9053\u53bb\u54ea\u4e2a\u8282\u70b9\u67e5\u8be2\u3002\u5f88\u591a\u6570\u636e\u5206\u7247\u90fd\u4f1a\u91c7\u7528\u4e00\u81f4\u6027hash\u7b97\u6cd5\u3002\u800cRedis\u5219\u662f\u5229\u7528\u6563\u5217\u63d2\u69fd\uff08<code>hash slot</code>\uff09\u7684\u65b9\u5f0f\u5b9e\u73b0\u6570\u636e\u5206\u7247\u3002</p> <p>\u5728Redis\u96c6\u7fa4\u4e2d\uff0c\u5171\u670916384\u4e2a<code>hash slots</code>\uff0c\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2amaster\u8282\u70b9\u90fd\u4f1a\u5206\u914d\u4e00\u5b9a\u6570\u91cf\u7684<code>hash slots</code>\u3002\u5177\u4f53\u7684\u5206\u914d\u5728\u96c6\u7fa4\u521b\u5efa\u65f6\u5c31\u5df2\u7ecf\u6307\u5b9a\u4e86</p> <p>\u5f53\u6211\u4eec\u8bfb\u5199\u6570\u636e\u65f6\uff0cRedis\u57fa\u4e8e<code>CRC16</code> \u7b97\u6cd5\u5bf9<code>key</code>\u505a<code>hash</code>\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e0e<code>16384</code>\u53d6\u4f59\uff0c\u5c31\u8ba1\u7b97\u51fa\u4e86\u8fd9\u4e2a<code>key</code>\u7684<code>slot</code>\u503c\u3002\u7136\u540e\u5230<code>slot</code>\u6240\u5728\u7684Redis\u8282\u70b9\u6267\u884c\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p>Note</p> <p><code>hash slot</code>\u7684\u8ba1\u7b97\u4e5f\u5206\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5f53<code>key</code>\u4e2d\u5305\u542b<code>{}</code>\u65f6\uff0c\u6839\u636e<code>{}</code>\u4e4b\u95f4\u7684\u5b57\u7b26\u4e32\u8ba1\u7b97<code>hash slot</code></li> <li>\u5f53<code>key</code>\u4e2d\u4e0d\u5305\u542b<code>{}</code>\u65f6\uff0c\u5219\u6839\u636e\u6574\u4e2a<code>key</code>\u5b57\u7b26\u4e32\u8ba1\u7b97<code>hash slot</code></li> </ul> <p>\u8fde\u63a5\u96c6\u7fa4\u65f6\uff0c\u8981\u52a0<code>-c</code>\u53c2\u6570\uff1a</p> <pre><code>## \u901a\u8fc77001\u8fde\u63a5\u96c6\u7fa4\nredis-cli -c -p 7001\n## \u5b58\u5165\u6570\u636e\nset user jack\n</code></pre> <p>\u5982\u4f55\u5c06\u540c\u4e00\u7c7b\u6570\u636e\u56fa\u5b9a\u7684\u4fdd\u5b58\u5728\u540c\u4e00\u4e2aRedis\u5b9e\u4f8b\uff1f</p> <ul> <li>Redis\u8ba1\u7b97key\u7684\u63d2\u69fd\u503c\u65f6\u4f1a\u5224\u65adkey\u4e2d\u662f\u5426\u5305\u542b<code>{}</code>\uff0c\u5982\u679c\u6709\u5219\u57fa\u4e8e<code>{}</code>\u5185\u7684\u5b57\u7b26\u8ba1\u7b97\u63d2\u69fd</li> <li>\u6570\u636e\u7684key\u4e2d\u53ef\u4ee5\u52a0\u5165<code>{\u7c7b\u578b}</code>\uff0c\u4f8b\u5982key\u90fd\u4ee5<code>{typeId}</code>\u4e3a\u524d\u7f00\uff0c\u8fd9\u6837\u540c\u7c7b\u578b\u6570\u636e\u8ba1\u7b97\u7684\u63d2\u69fd\u4e00\u5b9a\u76f8\u540c</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u96c6\u7fa4\u4f38\u7f29","title":"\u96c6\u7fa4\u4f38\u7f29","text":"<p>redis-cli --cluster\u63d0\u4f9b\u4e86\u5f88\u591a\u64cd\u4f5c\u96c6\u7fa4\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>redis-cli --cluster help</code></p> <p>\u4f8b\uff1a\u6dfb\u52a0\u8282\u70b9<code>redis-cli --cluster add-node new_host:new_port existing_host:existing_port</code></p> <p>Note</p> <p>\u9ed8\u8ba4\u4f5c\u4e3a\u4e3b\u8282\u70b9\uff0c\u53c2\u6570<code>--cluster-slave</code>\u548c<code>--cluster-master-id &lt;arg&gt;</code>\u6307\u5b9a\u4e3a\u4ece\u8282\u70b9</p> <p>\u65b0\u8282\u70b9\u9ed8\u8ba4\u65e0\u63d2\u69fd\uff0c\u9700\u8981\u5206\u914d\uff0c\u53ef\u4ee5\u4ece\u5176\u4ed6\u8282\u70b9\u8f6c\u79fb\u63d2\u69fd <code>redis-cli --cluster reshard host:port</code></p>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#\u6545\u969c\u8f6c\u79fb","title":"\u6545\u969c\u8f6c\u79fb","text":"<p>\u5206\u7247\u96c6\u7fa4\u9ed8\u8ba4\u5b58\u5728\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\uff0c\u6709\u8282\u70b9\u5b95\u673a\u4f1a\u81ea\u52a8\u4e3b\u4ece\u5207\u6362</p> <p>\u624b\u52a8\u6545\u969c\u8f6c\u79fb</p> <p>\u5229\u7528cluster failover\u547d\u4ee4\u53ef\u4ee5\u624b\u52a8\u8ba9\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2amaster\u5b95\u673a\uff0c\u5207\u6362\u5230\u6267\u884ccluster failover\u547d\u4ee4\u7684\u8fd9\u4e2aslave\u8282\u70b9\uff0c\u5b9e\u73b0\u65e0\u611f\u77e5\u7684\u6570\u636e\u8fc1\u79fb\u3002</p> <p></p> <p>\u8fd9\u79cdfailover\u547d\u4ee4\u53ef\u4ee5\u6307\u5b9a\u4e09\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li>\u7f3a\u7701\uff1a\u9ed8\u8ba4\u7684\u6d41\u7a0b\uff0c\u5982\u56fe1~6\u6b69</li> <li>force\uff1a\u7701\u7565\u4e86\u5bf9offset\u7684\u4e00\u81f4\u6027\u6821\u9a8c</li> <li>takeover\uff1a\u76f4\u63a5\u6267\u884c\u7b2c5\u6b69\uff0c\u5ffd\u7565\u6570\u636e\u4e00\u81f4\u6027\u3001\u5ffd\u7565master\u72b6\u6001\u548c\u5176\u5b83master\u7684\u610f\u89c1</li> </ul>"},{"location":"Redis/%E9%9B%86%E7%BE%A4/#redistemplate\u8fde\u63a5\u5206\u7247\u96c6\u7fa4","title":"RedisTemplate\u8fde\u63a5\u5206\u7247\u96c6\u7fa4","text":"<ol> <li> <p>\u5f15\u5165Redis\u4f9d\u8d56</p> </li> <li> <p>\u914d\u7f6e\u5206\u7247\u96c6\u7fa4\u5730\u5740\uff08\u4ec5\u8be5\u6b65\u9aa4\u4e8e\u54e8\u5175\u6a21\u5f0f\u6709\u533a\u522b\uff09</p> <pre><code>spring:\n    redis:\n    cluster:\n        nodes:\n        - 192.168.150.101:7001\n        - 192.168.150.101:7002\n        - 192.168.150.101:7003\n        - 192.168.150.101:8001\n        - 192.168.150.101:8002\n        - 192.168.150.101:8003\n</code></pre> </li> <li> <p>\u914d\u7f6e\u8bfb\u5199\u5206\u79bb</p> </li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/","title":"\u9762\u8bd5\u9898","text":""},{"location":"Redis/%E9%9D%A2%E8%AF%95/#redis\u5e94\u7528\u573a\u666f","title":"Redis\u5e94\u7528\u573a\u666f","text":"<ol> <li>\u7f13\u5b58</li> <li>\u5206\u5e03\u5f0f\u9501</li> <li>\u6d88\u606f\u961f\u5217</li> <li>\u5ef6\u65f6\u961f\u5217</li> <li>\u8ba1\u6570\u5668</li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u7a7f\u900f","title":"\u7f13\u5b58\u7a7f\u900f","text":"<p>\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u67e5\u8be2\u4e00\u4e2a\u6839\u672c\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u7531\u4e8e\u7f13\u5b58\u548c\u6570\u636e\u5e93\u90fd\u6ca1\u6709\u8fd9\u4e2a\u6570\u636e\uff0c\u56e0\u6b64\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u76f4\u63a5\u843d\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u9020\u6210\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\uff0c\u751a\u81f3\u5b95\u673a\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u7f13\u5b58\u7a7a\u5bf9\u8c61<ul> <li>\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5b58\u50a8\u4e00\u4e2a\u7a7a\u5bf9\u8c61\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2a\u8f83\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u6bd4\u59825\u5206\u949f\uff09\u3002\u8fd9\u6837\u4e0b\u6b21\u67e5\u8be2\u540c\u6837\u4e0d\u5b58\u5728\u7684\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\uff0c\u907f\u514d\u4e86\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u3002</li> </ul> </li> <li>\u5e03\u9686\u8fc7\u6ee4\u5668<ul> <li>\u5e03\u9686\u8fc7\u6ee4\u5668\u4f7f\u7528\u4f4d\u56fe\u548c\u591a\u4e2a\u54c8\u5e0c\u51fd\u6570\u6765\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5b58\u5728\u4e8e\u96c6\u5408\u4e2d\u3002\u5b83\u53ef\u4ee5\u9ad8\u6548\u5730\u8fc7\u6ee4\u6389\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u4ece\u800c\u51cf\u5c11\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u3002</li> <li>\u5e03\u9686\u8fc7\u6ee4\u5668\u6709\u4e00\u5b9a\u7684\u8bef\u5224\u7387\uff0c\u5373\u53ef\u80fd\u4f1a\u8bef\u5224\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6570\u636e\u4e3a\u5b58\u5728\uff0c\u4f46\u4e0d\u4f1a\u8bef\u5224\u4e00\u4e2a\u5b58\u5728\u7684\u6570\u636e\u4e3a\u4e0d\u5b58\u5728\u3002\u901a\u8fc7\u8c03\u6574\u4f4d\u56fe\u5927\u5c0f\u548c\u54c8\u5e0c\u51fd\u6570\u6570\u91cf\uff0c\u53ef\u4ee5\u63a7\u5236\u8bef\u5224\u7387\u5728\u53ef\u63a5\u53d7\u8303\u56f4\u5185\u3002</li> <li>\u5b9e\u73b0\uff1aRedisson\u3001Guava</li> </ul> </li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u51fb\u7a7f","title":"\u7f13\u5b58\u51fb\u7a7f","text":"<p>\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u67d0\u4e2a\u70ed\u70b9\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u5931\u6548\u540e\uff0c\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u76f4\u63a5\u843d\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u9020\u6210\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\uff0c\u751a\u81f3\u5b95\u673a\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u4e92\u65a5\u9501<ul> <li>\u7f13\u5b58\u91cd\u5efa\u65f6\uff0c\u4f7f\u7528\u4e92\u65a5\u9501\u6765\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u6570\u636e\u5e93\u5e76\u91cd\u5efa\u7f13\u5b58\u3002\u5176\u4ed6\u7ebf\u7a0b\u7b49\u5f85\u9501\u91ca\u653e\u540e\uff0c\u518d\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\u3002</li> </ul> </li> <li>\u903b\u8f91\u8fc7\u671f<ul> <li>\u7ed9\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u4e00\u4e2a\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\uff0c\u5373\u4f7f\u6570\u636e\u8fc7\u671f\u4e86\uff0c\u4ecd\u7136\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u65e7\u6570\u636e\u3002</li> <li>\u5f53\u6709\u8bf7\u6c42\u53d1\u73b0\u6570\u636e\u8fc7\u671f\u65f6\uff0c\u5148\u83b7\u53d6\u4e92\u65a5\u9501\uff0c\u7136\u540e\u5f02\u6b65\u66f4\u65b0\u7f13\u5b58\uff0c\u5176\u4ed6\u8bf7\u6c42\u83b7\u53d6\u9501\u5931\u8d25\u5219\u7ee7\u7eed\u4f7f\u7528\u65e7\u6570\u636e\u3002</li> <li>\u8be5\u65b9\u6848\u5b58\u5728\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u98ce\u9669\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u5408\u7406\u8bbe\u7f6e\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\u6765\u964d\u4f4e\u98ce\u9669\u3002</li> </ul> </li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u96ea\u5d29","title":"\u7f13\u5b58\u96ea\u5d29","text":"<p>\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5927\u91cf\u7f13\u5b58\u6570\u636e\u5728\u540c\u4e00\u65f6\u95f4\u5931\u6548\u6216\u8005\u7f13\u5b58\u670d\u52a1\u5b95\u673a\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u76f4\u63a5\u843d\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u9020\u6210\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\uff0c\u751a\u81f3\u5b95\u673a\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u4e3a\u4e0d\u540c\u7f13\u5b58key\u8bbe\u7f6e\u968f\u673a\u6027\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u5927\u91cf\u7f13\u5b58\u540c\u65f6\u5931\u6548\u3002</li> <li>\u63d0\u9ad8\u7f13\u5b58\u670d\u52a1\u7684\u53ef\u7528\u6027\uff0c\u4f7f\u7528\u96c6\u7fa4\u3001\u4e3b\u4ece\u590d\u5236\u7b49\u65b9\u5f0f\uff0c\u907f\u514d\u5355\u70b9\u6545\u969c\u3002</li> <li>\u9650\u6d41\u964d\u7ea7\u7b56\u7565\uff0c\u5f53\u7f13\u5b58\u670d\u52a1\u4e0d\u53ef\u7528\u65f6\uff0c\u9650\u5236\u8bf7\u6c42\u901f\u7387\u6216\u8005\u76f4\u63a5\u8fd4\u56de\u9ed8\u8ba4\u503c\uff0c\u907f\u514d\u5927\u91cf\u8bf7\u6c42\u843d\u5230\u6570\u636e\u5e93\u4e0a\u3002</li> <li>\u591a\u7ea7\u7f13\u5b58\u65b9\u6848\uff0c\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u76f8\u7ed3\u5408\u7684\u65b9\u5f0f\uff0c\u964d\u4f4e\u5bf9\u6570\u636e\u5e93\u7684\u538b\u529b\u3002</li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#\u53cc\u5199\u4e00\u81f4","title":"\u53cc\u5199\u4e00\u81f4","text":"<p>\u53cc\u5199\u4e00\u81f4\u662f\u6307\u5728\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93\uff0c\u786e\u4fdd\u4e24\u8005\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <ol> <li>\u5ef6\u65f6\u53cc\u5220<ul> <li>\u5728\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u5148\u5220\u9664\u7f13\u5b58\uff0c\u7136\u540e\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6700\u540e\u518d\u5ef6\u65f6\u5220\u9664\u7f13\u5b58\uff08\u6570\u636e\u5e93\u53ef\u80fd\u662f\u4e3b\u4ece\u67b6\u6784\u8bfb\u5199\u5206\u79bb\uff0c\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u540c\u6b65\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u662f\u6700\u65b0\u7684\u3002</li> <li>\u8be5\u65b9\u6848\u5b58\u5728\u77ed\u6682\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u98ce\u9669\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u5408\u7406\u8bbe\u7f6e\u5220\u9664\u7f13\u5b58\u7684\u65f6\u95f4\u95f4\u9694\u6765\u964d\u4f4e\u98ce\u9669\u3002</li> </ul> </li> <li>\u5206\u5e03\u5f0f\u8bfb\u5199\u9501<ul> <li>\u4f7f\u7528\u5206\u5e03\u5f0f\u8bfb\u5199\u9501\u6765\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u66f4\u65b0\u6570\u636e\u3002\u8bfb\u64cd\u4f5c\u53ef\u4ee5\u5e76\u53d1\u8fdb\u884c\uff0c\u5199\u64cd\u4f5c\u9700\u8981\u83b7\u53d6\u5199\u9501\u3002</li> <li>\u8be5\u65b9\u6848\u5b9e\u73b0\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u4f46\u53ef\u4ee5\u786e\u4fdd\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\u3002</li> </ul> </li> <li>\u6d88\u606f\u961f\u5217<ul> <li>\u5728\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u5c06\u66f4\u65b0\u64cd\u4f5c\u53d1\u9001\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u7531\u4e13\u95e8\u7684\u6d88\u8d39\u8005\u7ebf\u7a0b\u6765\u5904\u7406\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002</li> <li>\u8be5\u65b9\u6848\u53ea\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u800c\u4e14\u6709\u6d88\u606f\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4f46\u53ef\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u548c\u53ef\u7528\u6027\u3002</li> </ul> </li> </ol>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#\u6301\u4e45\u5316","title":"\u6301\u4e45\u5316","text":"<p>Redis\u63d0\u4f9b\u4e86\u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236\uff1a</p> <ul> <li>RDB</li> <li>AOF</li> </ul> <p>RDB\uff08Redis DataBase\uff09\u662fRedis\u9ed8\u8ba4\u7684\u6301\u4e45\u5316\u673a\u5236\uff0c\u5b83\u4f1a\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5feb\u7167\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u3002RDB\u6587\u4ef6\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5305\u542b\u4e86Redis\u6570\u636e\u5e93\u7684\u5b8c\u6574\u72b6\u6001\u3002 <pre><code>redis-cli\n\nsave    # \u624b\u52a8\u89e6\u53d1RDB\u6301\u4e45\u5316\uff0c\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b\nbgsave  # fork\u5b50\u8fdb\u7a0b\u5f02\u6b65\u89e6\u53d1RDB\u6301\u4e45\u5316\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b\uff08\u5199\u65f6\u590d\u5236\uff0c\u4e3b\u8fdb\u7a0b\u6267\u884c\u5199\u64cd\u4f5c\u65f6\u624d\u62f7\u8d1d\u6570\u636e\uff09\n</code></pre></p> <p>AOF\uff08Append Only File\uff09\u662fRedis\u7684\u53e6\u4e00\u79cd\u6301\u4e45\u5316\u673a\u5236\uff0c\u5b83\u4f1a\u5c06\u6bcf\u4e2a\u5199\u64cd\u4f5c\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u8ffd\u52a0\u5230AOF\u6587\u4ef6\u4e2d\u3002AOF\u6587\u4ef6\u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5305\u542b\u4e86\u6240\u6709\u5bf9Redis\u6570\u636e\u5e93\u7684\u5199\u64cd\u4f5c\u3002 <pre><code>appendonly yes          # \u5f00\u542fAOF\u6301\u4e45\u5316\nappendfilename \"appendonly.aof\"  # AOF\u6587\u4ef6\u540d\nappendfsync everysec     # \u6bcf\u79d2\u540c\u6b65\u5230\u78c1\u76d8\n</code></pre></p> <p>Note</p> <p>appendfsync\u914d\u7f6e\u7684\u662fAOF\u6587\u4ef6\u540c\u6b65\u5230\u78c1\u76d8\u7684\u9891\u7387\uff0c\u5199\u547d\u4ee4\u9996\u5148\u4f1a\u88ab\u653e\u5165\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\u533a\uff0c\u7136\u540e\u7531\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002appendfsync\u914d\u7f6e\u7684\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u7684\u9891\u7387\u3002</p> <p>\u652f\u6301\u7684\u9009\u9879\u6709\uff1a</p> <ul> <li>always\uff1a\u6bcf\u6b21\u6709\u5199\u64cd\u4f5c\u65f6\u90fd\u540c\u6b65\u5230\u78c1\u76d8\uff0c\u6027\u80fd\u6700\u5dee</li> <li>everysec\uff1a\u6bcf\u79d2\u540c\u6b65\u5230\u78c1\u76d8\uff0c\u6027\u80fd\u8f83\u597d\uff0c\u6570\u636e\u4e22\u5931\u98ce\u9669\u8f83\u4f4e\uff08\u9ed8\u8ba4\uff09</li> <li>no\uff1a\u5b8c\u5168\u4f9d\u8d56\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6027\u80fd\u6700\u597d\uff0c\u4f46\u6570\u636e\u4e22\u5931\u98ce\u9669\u6700\u9ad8</li> </ul> <p>Info</p> <p>AOF\u6587\u4ef6\u5360\u7528\u8f83\u5927\uff0c\u53ef\u901a\u8fc7<code>bgrewriteaof</code>\u547d\u4ee4\u91cd\u5199AOF\u6587\u4ef6\uff0c\u5220\u9664\u5197\u4f59\u547d\u4ee4\uff0c\u51cf\u5c0f\u6587\u4ef6\u5927\u5c0f\u3002</p>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#redis\u7684key\u8fc7\u671f\u540e\u662f\u5426\u4f1a\u88ab\u7acb\u5373\u5220\u9664","title":"Redis\u7684key\u8fc7\u671f\u540e\u662f\u5426\u4f1a\u88ab\u7acb\u5373\u5220\u9664","text":"<p>\u5e76\u4e0d\u4f1a\uff0cRedis\u6709\u4e24\u79cd\u5220\u9664\u7b56\u7565\uff1a\u60f0\u6027\u5220\u9664\u548c\u5b9a\u671f\u5220\u9664</p> <ul> <li>\u60f0\u6027\u5220\u9664\uff1a\u6bcf\u6b21\u8bbf\u95eekey\u65f6\uff0c\u68c0\u67e5\u662f\u5426\u8fc7\u671f\uff0c\u8fc7\u671f\u5219\u5220\u9664</li> <li>\u5b9a\u671f\u5220\u9664\uff1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff0c\u968f\u673a\u68c0\u67e5\u90e8\u5206key\uff0c\u5220\u9664\u8fc7\u671f</li> </ul> <p>Redis\u4e2d\u4e24\u79cd\u5220\u9664\u7b56\u7565\u7ed3\u5408\u4f7f\u7528\uff0c\u786e\u4fdd\u8fc7\u671fkey\u6700\u7ec8\u88ab\u5220\u9664\uff0c\u4f46\u4e0d\u4f1a\u7acb\u5373\u5220\u9664\uff0c\u907f\u514d\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#redis\u5185\u5b58\u6dd8\u6c70redis\u5185\u5b58\u4e0d\u8db3","title":"Redis\u5185\u5b58\u6dd8\u6c70\uff08Redis\u5185\u5b58\u4e0d\u8db3\uff09","text":"<p>Redis\u63d0\u4f9b\u4e86\u591a\u79cd\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u5e38\u7528\u7684\u6709\uff1a</p> <ul> <li>noeviction\uff1a\u4e0d\u6dd8\u6c70\u4efb\u4f55key\uff0c\u5185\u5b58\u6ee1\u65f6\u5199\u64cd\u4f5c\u62a5\u9519\uff08\u9ed8\u8ba4\uff09</li> <li>volatile-ttl\uff1a\u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u6bd4\u8f83key\u7684\u5269\u4f59TTL\u503c\uff0cTTL\u8d8a\u5c0f\u8d8a\u5148\u88ab\u6dd8\u6c70</li> <li>allkeys-random\uff1a\u5bf9\u6240\u6709key\uff0c\u968f\u673a\u6dd8\u6c70</li> <li>volatile-random\uff1a\u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u968f\u673a\u6dd8\u6c70</li> <li>allkeys-lru\uff1a\u5bf9\u6240\u6709key\uff0c\u57fa\u4e8eLRU\u7b97\u6cd5\u6dd8\u6c70</li> <li>volatile-lru\uff1a\u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u57fa\u4e8eLRU\u7b97\u6cd5\u6dd8\u6c70</li> <li>allkeys-lfu\uff1a\u5bf9\u6240\u6709key\uff0c\u57fa\u4e8eLFU\u7b97\u6cd5\u6dd8\u6c70</li> <li>volatile-lfu\uff1a\u5bf9\u8bbe\u7f6e\u4e86TTL\u7684key\uff0c\u57fa\u4e8eLFU\u7b97\u6cd5\u6dd8\u6c70\uff08\u63a8\u8350\uff09</li> </ul> <p>LRU\u548cLFU\u7b97\u6cd5</p> <p>LRU\uff08\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff09</p> <ul> <li>\u901a\u8fc7\u8bb0\u5f55\u6bcf\u4e2akey\u7684\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\uff0c\u6765\u5224\u65ad\u54ea\u4e2akey\u6700\u4e45\u672a\u88ab\u4f7f\u7528\uff0c\u4ece\u800c\u8fdb\u884c\u6dd8\u6c70\u3002</li> </ul> <p>LFU\uff08\u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\uff09</p> <ul> <li>\u901a\u8fc7\u8bb0\u5f55\u6bcf\u4e2akey\u7684\u8bbf\u95ee\u9891\u7387\uff0c\u6765\u5224\u65ad\u54ea\u4e2akey\u6700\u5c11\u88ab\u4f7f\u7528\uff0c\u4ece\u800c\u8fdb\u884c\u6dd8\u6c70\u3002</li> </ul>"},{"location":"Redis/%E9%9D%A2%E8%AF%95/#redis\u5206\u5e03\u5f0f\u9501","title":"Redis\u5206\u5e03\u5f0f\u9501","text":"<p>Redis\u5206\u5e03\u5f0f\u9501\u662f\u901a\u8fc7Redis\u7684setnx\u547d\u4ee4\u5b9e\u73b0\u7684\uff0c\u57fa\u672c\u539f\u7406\u5982\u4e0b\uff1a 1. \u5ba2\u6237\u7aef\u5c1d\u8bd5\u901a\u8fc7setnx\u547d\u4ee4\u8bbe\u7f6e\u4e00\u4e2a\u552f\u4e00\u7684key\uff0c\u5982\u679c\u8bbe\u7f6e\u6210\u529f\uff0c\u8868\u793a\u83b7\u53d6\u9501\u6210\u529f 2. \u5ba2\u6237\u7aef\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u9632\u6b62\u6b7b\u9501 3. \u5ba2\u6237\u7aef\u6267\u884c\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c\u5220\u9664key\uff0c\u91ca\u653e\u9501</p> <p>Redission\u662f\u4e00\u4e2a\u57fa\u4e8eRedis\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u9501\u5e93\uff0c\u63d0\u4f9b\u4e86\u66f4\u5b8c\u5584\u7684\u5206\u5e03\u5f0f\u9501\u529f\u80fd\uff0c\u5305\u62ec\u81ea\u52a8\u7eed\u671f\u3001\u9501\u91cd\u5165\u7b49\u3002</p>"},{"location":"Spring/","title":"Spring","text":"<ul> <li>Spring\u6982\u8ff0</li> <li>\u57fa\u4e8eXML\u7684Spring\u5e94\u7528</li> <li>\u57fa\u4e8e\u6ce8\u89e3\u7684Spring\u5e94\u7528</li> <li>Spring AOP</li> <li>Spring Web</li> <li>Spring MVC</li> </ul>"},{"location":"Spring/Spring-AOP/","title":"Spring AOP","text":""},{"location":"Spring/Spring-AOP/#aop\u7b80\u4ecb","title":"AOP\u7b80\u4ecb","text":"<p>AOP\uff0cAspect Oriented Programming\uff0c\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff0c\u662f\u5bf9\u9762\u5411\u5bf9\u8c61\u7f16\u7a0bOOP\u7684\u5347\u534e\u3002</p> <p>OOP\u662f\u7eb5\u5411\u5bf9\u4e00\u4e2a\u4e8b\u7269\u7684\u62bd\u8c61\uff0c\u4e00\u4e2a\u5bf9\u8c61\u5305\u62ec\u9759\u6001\u7684\u5c5e\u6027\u4fe1\u606f\uff0c\u5305\u62ec\u52a8\u6001\u7684\u65b9\u6cd5\u4fe1\u606f\u7b49\u3002</p> <p>\u800cAOP\u662f\u6a2a\u5411\u7684\u5bf9\u4e0d\u540c\u4e8b\u7269\u7684\u62bd\u8c61\uff0c\u5c5e\u6027\u4e0e\u5c5e\u6027\u3001\u65b9\u6cd5\u4e0e\u65b9\u6cd5\u3001\u5bf9\u8c61\u4e0e\u5bf9\u8c61\u90fd\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u5207\u9762\uff0c\u800c\u7528\u8fd9\u79cd\u601d\u7ef4\u53bb\u8bbe\u8ba1\u7f16\u7a0b\u7684\u65b9\u5f0f\u53eb\u505a\u9762\u5411\u5207\u9762\u7f16\u7a0b</p>"},{"location":"Spring/Spring-AOP/#aop\u601d\u60f3\u7684\u5b9e\u73b0\u65b9\u6848","title":"AOP\u601d\u60f3\u7684\u5b9e\u73b0\u65b9\u6848","text":"<p>\u52a8\u6001\u4ee3\u7406\u6280\u672f\uff0c\u5728\u8fd0\u884c\u671f\u95f4\uff0c\u5bf9\u76ee\u6807\u5bf9\u8c61\u7684\u65b9\u6cd5\u8fdb\u884c\u589e\u5f3a\uff0c\u4ee3\u7406\u5bf9\u8c61\u540c\u540d\u65b9\u6cd5\u5185\u53ef\u4ee5\u6267\u884c\u539f\u6709\u903b\u8f91\u7684\u540c\u65f6\u5d4c\u5165\u6267\u884c\u5176\u4ed6\u589e\u5f3a\u903b\u8f91\u6216\u5176\u4ed6\u5bf9\u8c61\u7684\u65b9\u6cd5</p> <p></p>"},{"location":"Spring/Spring-AOP/#aop\u6a21\u62df\u5b9e\u73b0","title":"AOP\u6a21\u62df\u5b9e\u73b0","text":"<pre><code>@Component\npublic class AopBeanPostProcessor implements BeanPostProcessor, ApplicationContextAware {\n\n    private ApplicationContext applicationContext;\n\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        //\u5bf9\u539f\u59cb\u5bf9\u8c61\u8fdb\u884c\u589e\u5f3a\u5904\u7406\n        if(bean.getClass().getName().startsWith(\"com.ysh.service.impl\")){\n            //\u751f\u6210 Proxy \u5bf9\u8c61\n            return Proxy.newProxyInstance(\n                    bean.getClass().getClassLoader(),\n                    bean.getClass().getInterfaces(),\n                    (Object proxy, Method method, Object[] args) -&gt; {\n                        MyAdvice myAdvice = applicationContext.getBean(MyAdvice.class);\n                        myAdvice.beforeAdvice();//\u6267\u884c\u524d\u901a\u77e5\n                        Object result = method.invoke(bean, args);//\u539f\u59cb\u65b9\u6cd5\n                        myAdvice.afterAdvice();//\u6267\u884c\u540e\u901a\u77e5\n                        return result;\n                    }\n            );\n        }\n        return BeanPostProcessor.super.postProcessAfterInitialization(bean, beanName);\n    }\n\n    @Override\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        this.applicationContext = applicationContext;\n    }\n}\n</code></pre>"},{"location":"Spring/Spring-AOP/#aop\u76f8\u5173\u6982\u5ff5","title":"AOP\u76f8\u5173\u6982\u5ff5","text":"\u6982\u5ff5 \u5355\u8bcd \u89e3\u91ca \u76ee\u6807\u5bf9\u8c61 Target \u88ab\u589e\u5f3a\u7684\u65b9\u6cd5\u6240\u5728\u7684\u5bf9\u8c61 \u4ee3\u7406\u5bf9\u8c61 Proxy \u5bf9\u76ee\u6807\u5bf9\u8c61\u8fdb\u884c\u589e\u5f3a\u540e\u7684\u5bf9\u8c61\uff0c\u5ba2\u6237\u7aef\u5b9e\u9645\u8c03\u7528\u7684\u5bf9\u8c61 \u8fde\u63a5\u70b9 JoinPoint \u76ee\u6807\u5bf9\u8c61\u4e2d\u53ef\u4ee5\u88ab\u589e\u5f3a\u7684\u65b9\u6cd5 \u5207\u5165\u70b9 PointCut \u76ee\u6807\u5bf9\u8c61\u4e2d\u5b9e\u9645\u88ab\u589e\u5f3a\u7684\u65b9\u6cd5 \u901a\u77e5/\u589e\u5f3a Advice \u589e\u5f3a\u90e8\u5206\u7684\u4ee3\u7801\u903b\u8f91 \u5207\u9762 Aspect \u589e\u5f3a\u548c\u5207\u5165\u70b9\u7684\u7ec4\u5408 \u7ec7\u5165 Weaving \u5c06\u901a\u77e5\u548c\u5207\u5165\u70b9\u7ec4\u5408\u52a8\u6001\u7ec4\u5408\u7684\u8fc7\u7a0b"},{"location":"Spring/Spring-AOP/#\u57fa\u4e8exml\u65b9\u5f0f\u914d\u7f6eaop","title":"\u57fa\u4e8exml\u65b9\u5f0f\u914d\u7f6eAOP","text":""},{"location":"Spring/Spring-AOP/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<p>\u6b65\u9aa4</p> <ol> <li> <p>\u5bfc\u5165AOP\u76f8\u5173\u5750\u6807\uff1b</p> </li> <li> <p>\u51c6\u5907\u76ee\u6807\u7c7b\u3001\u51c6\u5907\u589e\u5f3a\u7c7b\uff0c\u5e76\u914d\u7f6e\u7ed9Spring\u7ba1\u7406\uff1b</p> </li> <li> <p>\u914d\u7f6e\u5207\u70b9\u8868\u8fbe\u5f0f\uff08\u54ea\u4e9b\u65b9\u6cd5\u88ab\u589e\u5f3a\uff09\uff1b</p> </li> <li> <p>\u914d\u7f6e\u7ec7\u5165\uff08\u5207\u70b9\u88ab\u54ea\u4e9b\u901a\u77e5\u65b9\u6cd5\u589e\u5f3a\uff0c\u662f\u524d\u7f6e\u589e\u5f3a\u8fd8\u662f\u540e\u7f6e\u589e\u5f3a\uff09\u3002</p> </li> </ol> <p></p> <p>\u5bfc\u5165\u5750\u6807 <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;\n    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;\n    &lt;version&gt;1.9.6&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>\u51c6\u5907\u76ee\u6807\u7c7b\u3001\u51c6\u5907\u589e\u5f3a\u7c7b\uff0c\u5e76\u914d\u7f6e\u7531Spring\u7ba1\u7406</p> <p>\u914d\u7f6e\u5207\u70b9\u8868\u8fbe\u5f0f</p> <p>\u914d\u7f6e\u7ec7\u5165 <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xmlns:aop=\"http://www.springframework.org/schema/aop\"\n        xsi:schemaLocation=\"\n        http://www.springframework.org/schema/beans\n        http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/aop\n        http://www.springframework.org/schema/aop/spring-aop.xsd\"&gt;\n\n    &lt;!-- \u901a\u77e5 --&gt;\n    &lt;bean id=\"advice\" class=\"com.ysh.advice.MyAdvice\" /&gt;\n    &lt;!-- \u76ee\u6807\u5bf9\u8c61 --&gt;\n    &lt;bean id=\"userService\" class=\"com.ysh.service.impl.UserServiceImpl\"/&gt;\n\n    &lt;aop:config&gt;\n        &lt;!--\u5207\u70b9\u8868\u8fbe\u5f0f--&gt;\n        &lt;aop:pointcut id=\"myPointcut\" expression=\"execution(void com.ysh.service.impl.*.*(..))\"/&gt;\n        &lt;!--\u914d\u7f6e\u7ec7\u5165--&gt;\n        &lt;aop:aspect ref=\"advice\"&gt;\n            &lt;aop:before method=\"beforeAdvice\" pointcut-ref=\"myPointcut\"/&gt;\n        &lt;/aop:aspect&gt;\n    &lt;/aop:config&gt;\n\n&lt;/beans&gt;\n</code></pre></p>"},{"location":"Spring/Spring-AOP/#aop\u8be6\u7ec6\u914d\u7f6e\u7684\u7ec6\u8282","title":"AOP\u8be6\u7ec6\u914d\u7f6e\u7684\u7ec6\u8282","text":"<ul> <li> <p>\u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u914d\u7f6e\u65b9\u5f0f</p> </li> <li> <p>\u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u914d\u7f6e\u8bed\u6cd5</p> </li> <li> <p>\u901a\u77e5\u7684\u7c7b\u578b</p> </li> <li> <p>AOP\u7684\u914d\u7f6e\u7684\u4e24\u79cd\u65b9\u5f0f</p> </li> </ul>"},{"location":"Spring/Spring-AOP/#\u914d\u7f6e\u8bed\u6cd5","title":"\u914d\u7f6e\u8bed\u6cd5","text":"<p>\u5207\u70b9\u8868\u8fbe\u5f0f\u662f\u914d\u7f6e\u8981\u5bf9\u54ea\u4e9b\u8fde\u63a5\u70b9\uff08\u54ea\u4e9b\u7c7b\u7684\u54ea\u4e9b\u65b9\u6cd5\uff09\u8fdb\u884c\u901a\u77e5\u7684\u589e\u5f3a\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>execution([\u8bbf\u95ee\u4fee\u9970\u7b26] \u8fd4\u56de\u503c\u7c7b\u578b \u5305\u540d.\u7c7b\u540d.\u65b9\u6cd5\u540d(\u53c2\u6570))\n</code></pre> <ul> <li> <p>\u8bbf\u95ee\u4fee\u9970\u7b26\u53ef\u4ee5\u7701\u7565\u4e0d\u5199\uff1b</p> </li> <li> <p>\u8fd4\u56de\u503c\u7c7b\u578b\u3001\u67d0\u4e00\u7ea7\u5305\u540d\u3001\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\u53ef\u4ee5\u4f7f\u7528<code>*</code> \u8868\u793a\u4efb\u610f\uff1b</p> </li> <li> <p>\u5305\u540d\u4e0e\u7c7b\u540d\u4e4b\u95f4\u4f7f\u7528\u5355\u70b9<code>.</code>\u8868\u793a\u8be5\u5305\u4e0b\u7684\u7c7b\uff0c\u4f7f\u7528\u53cc\u70b9<code>..</code> \u8868\u793a\u8be5\u5305\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u7c7b\uff1b</p> </li> <li> <p>\u53c2\u6570\u5217\u8868\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a\u70b9<code>..</code> \u8868\u793a\u4efb\u610f\u53c2\u6570\u3002</p> </li> </ul> <p>Example</p> <pre><code>//\u8868\u793a\u8bbf\u95ee\u4fee\u9970\u7b26\u4e3apublic\u3001\u65e0\u8fd4\u56de\u503c\u3001\u5728com.itheima.aop\u5305\u4e0b\u7684TargetImpl\u7c7b\u7684\u65e0\u53c2\u65b9\u6cd5show\nexecution(public void com.itheima.aop.TargetImpl.show())\n\n//\u8868\u793acom.itheima.aop\u5305\u4e0b\u7684TargetImpl\u7c7b\u7684\u4efb\u610f\u65b9\u6cd5\nexecution(* com.itheima.aop.TargetImpl.*(..))\n\n//\u8868\u793acom.itheima.aop\u5305\u4e0b\u7684\u4efb\u610f\u7c7b\u7684\u4efb\u610f\u65b9\u6cd5\nexecution(* com.itheima.aop.*.*(..))\n\n//\u8868\u793acom.itheima.aop\u5305\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u4efb\u610f\u7c7b\u7684\u4efb\u610f\u65b9\u6cd5\nexecution(* com.itheima.aop..*.*(..))\n\n//\u8868\u793a\u4efb\u610f\u5305\u4e2d\u7684\u4efb\u610f\u7c7b\u7684\u4efb\u610f\u65b9\u6cd5\nexecution(* *..*.*(..))\n</code></pre>"},{"location":"Spring/Spring-AOP/#\u901a\u77e5\u7c7b\u578b","title":"\u901a\u77e5\u7c7b\u578b","text":"\u901a\u77e5\u7c7b\u578b \u914d\u7f6e\u65b9\u5f0f \u6267\u884c\u65f6\u673a \u524d\u7f6e\u901a\u77e5 <code>&lt;aop:before&gt;</code> \u76ee\u6807\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884c \u540e\u7f6e\u901a\u77e5 <code>&lt;aop:after-returning&gt;</code> \u76ee\u6807\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u6267\u884c\uff0c\u76ee\u6807\u65b9\u6cd5\u5f02\u5e38\u65f6\uff0c\u4e0d\u518d\u6267\u884c \u73af\u7ed5\u901a\u77e5 <code>&lt;aop:around&gt;</code> \u76ee\u6807\u65b9\u6cd5\u6267\u884c\u524d\u540e\u6267\u884c\uff0c\u76ee\u6807\u65b9\u6cd5\u5f02\u5e38\u65f6\uff0c\u73af\u7ed5\u540e\u65b9\u6cd5\u4e0d\u518d\u6267\u884c \u5f02\u5e38\u901a\u77e5 <code>&lt;aop:after-throwing&gt;</code> \u76ee\u6807\u65b9\u6cd5\u629b\u51fa\u5f02\u5e38\u65f6\u6267\u884c \u6700\u7ec8\u901a\u77e5 <code>&lt;aop:after&gt;</code> \u4e0d\u7ba1\u76ee\u6807\u65b9\u6cd5\u662f\u5426\u6709\u5f02\u5e38\uff0c\u6700\u7ec8\u90fd\u4f1a\u6267\u884c"},{"location":"Spring/Spring-AOP/#\u901a\u77e5\u53c2\u6570","title":"\u901a\u77e5\u53c2\u6570","text":"<p>\u901a\u77e5\u65b9\u6cd5\u5728\u88ab\u8c03\u7528\u65f6\uff0cSpring\u53ef\u4ee5\u4e3a\u5176\u4f20\u9012\u4e00\u4e9b\u5fc5\u8981\u7684\u53c2\u6570</p> \u53c2\u6570\u7c7b\u578b \u4f5c\u7528 JoinPoint \u8fde\u63a5\u70b9\u5bf9\u8c61\uff0c\u4efb\u4f55\u901a\u77e5\u90fd\u53ef\u4f7f\u7528\uff0c\u53ef\u4ee5\u83b7\u5f97\u5f53\u524d\u76ee\u6807\u5bf9\u8c61\u3001\u76ee\u6807\u65b9\u6cd5\u53c2\u6570\u7b49\u4fe1\u606f ProceedingJoinPoint JoinPoint\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e3b\u8981\u662f\u5728\u73af\u7ed5\u901a\u77e5\u4e2d\u6267\u884cproceed()\uff0c\u8fdb\u800c\u6267\u884c\u76ee\u6807\u65b9\u6cd5 Throwable \u5f02\u5e38\u5bf9\u8c61\uff0c\u4f7f\u7528\u5728\u5f02\u5e38\u901a\u77e5\u4e2d\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u51fa\u5f02\u5e38\u5bf9\u8c61\u540d\u79f0 <p>Example</p> <pre><code>public Object around(ProceedingJoinPoint joinPoint) throws Throwable {\n    System.out.println(joinPoint.getArgs());//\u83b7\u5f97\u76ee\u6807\u65b9\u6cd5\u7684\u53c2\u6570\n    System.out.println(joinPoint.getTarget());//\u83b7\u5f97\u76ee\u6807\u5bf9\u8c61\n    System.out.println(joinPoint.getStaticPart());//\u83b7\u5f97\u7cbe\u786e\u7684\u5207\u70b9\u8868\u8fbe\u5f0f\u4fe1\u606f\n    Object result = joinPoint.proceed();//\u6267\u884c\u76ee\u6807\u65b9\u6cd5\n    return result;//\u8fd4\u56de\u76ee\u6807\u65b9\u6cd5\u8fd4\u56de\u503c\n}\n</code></pre> <p>\u5bf9\u4e8eThrowable\uff1a</p> <pre><code>public void afterThrowing(JoinPoint joinPoint,Throwable th){\n    //\u83b7\u5f97\u5f02\u5e38\u4fe1\u606f\n    System.out.println(\"\u5f02\u5e38\u5bf9\u8c61\u662f\uff1a\"+th+\"\u5f02\u5e38\u4fe1\u606f\u662f\uff1a\"+th.getMessage());\n}\n</code></pre> <pre><code>&lt;aop:after-throwing method=\"afterThrowing\" pointcut-ref=\"myPointcut\" throwing=\"th\"/&gt;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u9700\u5728\u914d\u7f6e\u65f6\u6307\u5b9athrowing\u5c5e\u6027</p>"},{"location":"Spring/Spring-AOP/#\u53e6\u4e00\u79cd\u914d\u7f6e\u65b9\u5f0f","title":"\u53e6\u4e00\u79cd\u914d\u7f6e\u65b9\u5f0f","text":"<p>AOP\u7684\u53e6\u4e00\u79cd\u914d\u7f6e\u65b9\u5f0f\uff0c\u8be5\u65b9\u5f0f\u9700\u8981\u901a\u77e5\u7c7b\u5b9e\u73b0Advice\u7684\u5b50\u529f\u80fd\u63a5\u53e3</p> <pre><code>public interface Advice {}\n</code></pre> <p></p> <p>\u4f8b\u5982\uff1a\u901a\u77e5\u7c7b\u5b9e\u73b0\u4e86\u524d\u7f6e\u901a\u77e5\u548c\u540e\u7f6e\u901a\u77e5\u63a5\u53e3</p> <pre><code>public class Advices implements MethodBeforeAdvice, AfterReturningAdvice {\n    public void before(Method method, Object[] objects, Object o) throws Throwable {\n        System.out.println(\"This is before Advice ...\");\n    }\n\n    public void afterReturning(Object o, Method method, Object[] objects, Object o1) throws\n            Throwable {\n        System.out.println(\"This is afterReturn Advice ...\");\n    }\n}\n</code></pre> <pre><code>&lt;aop:config&gt;\n     &lt;!--\u5c06\u901a\u77e5\u548c\u5207\u70b9\u8fdb\u884c\u7ed3\u5408--&gt;\n     &lt;aop:advisor advice-ref=\"advices\" pointcut=\"execution(void com.itheima.aop.TargetImpl.show())\"/&gt;\n &lt;/aop:config&gt;\n</code></pre>"},{"location":"Spring/Spring-AOP/#\u539f\u7406","title":"\u539f\u7406","text":"<p>xml\u89e3\u6790\u5668\u5411Spring\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e86\u4e00\u4e2aBeanPostProcessor\uff0c\u8be5BeanPostProcessor\u5728\u9700\u8981\u5207\u5165\u7684Bean\u7684\u751f\u547d\u5468\u671f\u4e2d\u751f\u6210\u4e86\u4ee3\u7406\u5bf9\u8c61</p> <p>\u52a8\u6001\u4ee3\u7406\u7684\u5b9e\u73b0\u7684\u9009\u62e9\uff0c\u5728\u8c03\u7528getProxy() \u65b9\u6cd5\u65f6\uff0c\u6211\u4eec\u53ef\u9009\u7528\u7684AopProxy\u63a5\u53e3\u6709\u4e24\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u4e00\u79cd\u5c31\u662f\u57fa\u4e8eJDK\uff0c\u4e00\u79cd\u662f\u57fa\u4e8eCglib</p> \u4ee3\u7406\u6280\u672f \u4f7f\u7528\u6761\u4ef6 \u914d\u7f6e\u65b9\u5f0f JDK\u52a8\u6001\u4ee3\u7406\u6280\u672f \u76ee\u6807\u7c7b\u6709\u63a5\u53e3\uff0c\u662f\u57fa\u4e8e\u63a5\u53e3\u52a8\u6001\u751f\u6210\u5b9e\u73b0\u7c7b\u7684\u4ee3\u7406\u5bf9\u8c61 \u76ee\u6807\u7c7b\u6709\u63a5\u53e3\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u65b9\u5f0f Cglib\u52a8\u6001\u4ee3\u7406\u6280\u672f \u76ee\u6807\u7c7b\u65e0\u63a5\u53e3\u4e14\u4e0d\u80fd\u4f7f\u7528final\u4fee\u9970\uff0c\u662f\u57fa\u4e8e\u88ab\u4ee3\u7406\u5bf9\u8c61\u52a8\u6001\u751f\u6210\u5b50\u5bf9\u8c61\u4e3a\u4ee3\u7406\u5bf9\u8c61 \u76ee\u6807\u7c7b\u65e0\u63a5\u53e3\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u8be5\u65b9\u5f0f\uff1b\u76ee\u6807\u7c7b\u6709\u63a5\u53e3\u65f6\uff0c\u624b\u52a8\u914d\u7f6e<code>&lt;aop:configproxytarget-class=\u201ctrue\u201d&gt;</code>\u5f3a\u5236\u4f7f\u7528Cglib\u65b9\u5f0f <p></p> <p>Cglib\u6d4b\u8bd5\u4ee3\u7801:</p> <pre><code>public class CglibTest {\n    public static &lt;Advices&gt; void main(String[] args) {\n        Target target = new Target();//\u76ee\u6807\u5bf9\u8c61\n        Advices advices = new Advices();//\u901a\u77e5\u5bf9\u8c61\n        Enhancer enhancer = new Enhancer();//\u589e\u5f3a\u5668\u5bf9\u8c61\n        enhancer.setSuperclass(Target.class);//\u589e\u5f3a\u5668\u8bbe\u7f6e\u7236\u7c7b\n        //\u589e\u5f3a\u5668\u8bbe\u7f6e\u56de\u8c03\n        enhancer.setCallback((MethodInterceptor)(o, method, objects, methodProxy) -&gt; {\n            advices.before();\n            Object result = method.invoke(target, objects);\n            advices.afterReturning();\n            return result;\n        });\n        //\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\n        Target targetProxy = (Target) enhancer.create();\n        //\u6d4b\u8bd5\n        String result = targetProxy.show(\"haohao\");\n    }\n}\n</code></pre>"},{"location":"Spring/Spring-AOP/#\u57fa\u4e8e\u6ce8\u89e3\u65b9\u5f0f\u914d\u7f6eaop","title":"\u57fa\u4e8e\u6ce8\u89e3\u65b9\u5f0f\u914d\u7f6eAOP","text":""},{"location":"Spring/Spring-AOP/#\u57fa\u672c\u4f7f\u7528","title":"\u57fa\u672c\u4f7f\u7528","text":"<pre><code>@Component\n@Aspect\npublic class MyAdvice {\n    @Around(\"execution(void com.ysh.service.impl.*.*(..)))\")\n    public Object beforeAdvice() {\n        System.out.println(\"\u524d\u7f6e\u901a\u77e5\");\n        return null;\n    }\n    @Before(\"execution(* *.*(..))\")\n    public void afterAdvice() {\n        System.out.println(\"\u540e\u7f6e\u901a\u77e5\");\n    }\n}\n</code></pre> <p>\u6ce8\u89e3@Aspect\u3001@Around\u9700\u8981\u88abSpring\u89e3\u6790\uff0c\u6240\u4ee5\u5728Spring\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u9700\u8981\u914d\u7f6easpectj\u7684\u81ea\u52a8\u4ee3\u7406</p> <pre><code>&lt;aop:aspectj-autoproxy/&gt;\n</code></pre> <p>Tip</p> <p>\u6ce8\u89e3\u65b9\u5f0f\u914d\u7f6e\u4e3a@EnableAspectJAutoProxy</p>"},{"location":"Spring/Spring-AOP/#\u914d\u7f6e\u8be6\u89e3","title":"\u914d\u7f6e\u8be6\u89e3","text":"<pre><code>//\u524d\u7f6e\u901a\u77e5\n@Before(\"execution(* com.ysh.aop.*.*(..))\")\npublic void before(JoinPoint joinPoint){}\n\n//\u540e\u7f6e\u901a\u77e5\n@AfterReturning(\"execution(* com.ysh.aop.*.*(..))\")\npublic void AfterReturning(JoinPoint joinPoint){}\n\n//\u73af\u7ed5\u901a\u77e5\n@Around(\"execution(* com.ysh.aop.*.*(..))\")\npublic void around(ProceedingJoinPoint joinPoint) throws Throwable {}\n\n//\u5f02\u5e38\u901a\u77e5\n@AfterThrowing(pointcut = \"execution(* com.ysh.aop.*.*(..))\",throwing = \"throwable\")\npublic void AfterThrowing(Throwable throwable) {}\n\n//\u6700\u7ec8\u901a\u77e5\n@After(\"execution(* com.ysh.aop.*.*(..))\")\npublic void After(JoinPoint joinPoint){}\n</code></pre> <p>\u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u62bd\u53d6\uff1a\u4f7f\u7528\u4e00\u4e2a\u7a7a\u65b9\u6cd5\uff0c\u5c06\u5207\u70b9\u8868\u8fbe\u5f0f\u6807\u6ce8\u5728\u7a7a\u65b9\u6cd5\u4e0a\uff0c\u5176\u4ed6\u901a\u77e5\u65b9\u6cd5\u5f15\u7528\u5373\u53ef:</p> <pre><code>@Component\n@Aspect\npublic class AnnoAdvice {\n    //\u5207\u70b9\u8868\u8fbe\u5f0f\u62bd\u53d6\n    @Pointcut(\"execution(* com.itheima.aop.*.*(..))\")\n    public void pointcut(){}\n\n    //\u524d\u7f6e\u901a\u77e5\n    @Before(\"pointcut()\")\n    public void before(JoinPoint joinPoint){}\n    //\u540e\u7f6e\u901a\u77e5\n    @AfterReturning(\"AnnoAdvice.pointcut()\")\n    public void AfterReturning(JoinPoint joinPoint){}\n    // ...  \u7701\u7565\u5176\u4ed6\u4ee3\u7801...\n}\n</code></pre>"},{"location":"Spring/Spring-AOP/#\u539f\u7406\u89e3\u6790","title":"\u539f\u7406\u89e3\u6790","text":""},{"location":"Spring/Spring-AOP/#\u57fa\u4e8eaop\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1\u63a7\u5236","title":"\u57fa\u4e8eAOP\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1\u63a7\u5236","text":""},{"location":"Spring/Spring-AOP/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u4e8b\u52a1\u662f\u5f00\u53d1\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e1c\u897f\uff0c\u4f7f\u7528JDBC\u5f00\u53d1\u65f6\uff0c\u6211\u4eec\u4f7f\u7528connnection\u5bf9\u4e8b\u52a1\u8fdb\u884c\u63a7\u5236\uff0c\u4f7f\u7528MyBatis\u65f6\uff0c\u6211\u4eec\u4f7f\u7528SqlSession\u5bf9\u4e8b\u52a1\u8fdb\u884c\u63a7\u5236\uff0c\u7f3a\u70b9\u663e\u800c\u6613\u89c1\uff0c\u5f53\u6211\u4eec\u5207\u6362\u6570\u636e\u5e93\u8bbf\u95ee\u6280\u672f\u65f6\uff0c\u4e8b\u52a1\u63a7\u5236\u7684\u65b9\u5f0f\u603b\u4f1a\u53d8\u5316\uff0cSpring \u5c31\u5c06\u8fd9\u4e9b\u6280\u672f\u57fa\u7840\u4e0a\uff0c\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u63a7\u5236\u4e8b\u52a1\u7684\u63a5\u53e3\u3002</p> <p>Spring\u7684\u4e8b\u52a1\u5206\u4e3a\uff1a\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u63a7\u5236\u548c\u58f0\u660e\u5f0f\u4e8b\u52a1\u63a7\u5236</p> \u4e8b\u52a1\u63a7\u5236\u65b9\u5f0f \u8bf4\u660e \u7f16\u7a0b\u5f0f\u4e8b\u52a1\u63a7\u5236 Spring\u63d0\u4f9b\u4e86\u4e8b\u52a1\u63a7\u5236\u7684\u7c7b\u548c\u65b9\u6cd5\uff0c\u4f7f\u7528\u7f16\u7801\u7684\u65b9\u5f0f\u5bf9\u4e1a\u52a1\u4ee3\u7801\u8fdb\u884c\u4e8b\u52a1\u63a7\u5236\uff0c\u4e8b\u52a1\u63a7\u5236\u4ee3\u7801\u548c\u4e1a\u52a1\u64cd\u4f5c\u4ee3\u7801\u8026\u5408\u5230\u4e86\u4e00\u8d77\uff0c\u5f00\u53d1\u4e2d\u4e0d\u4f7f\u7528 \u58f0\u660e\u5f0f\u4e8b\u52a1\u63a7\u5236 Spring\u5c06\u4e8b\u52a1\u63a7\u5236\u7684\u4ee3\u7801\u5c01\u88c5\uff0c\u5bf9\u5916\u63d0\u4f9b\u4e86Xml\u548c\u6ce8\u89e3\u914d\u7f6e\u65b9\u5f0f\uff0c\u901a\u8fc7\u914d\u7f6e\u7684\u65b9\u5f0f\u5b8c\u6210\u4e8b\u52a1\u7684\u63a7\u5236\uff0c\u53ef\u4ee5\u8fbe\u5230\u4e8b\u52a1\u63a7\u5236\u4e0e\u4e1a\u52a1\u64cd\u4f5c\u4ee3\u7801\u89e3\u8026\u5408\uff0c\u5f00\u53d1\u4e2d\u63a8\u8350\u4f7f\u7528 <p>Spring\u4e8b\u52a1\u7f16\u7a0b\u76f8\u5173\u7684\u7c7b\u4e3b\u8981\u6709\u5982\u4e0b\u4e09\u4e2a</p> \u7c7b \u8bf4\u660e \u5e73\u53f0\u4e8b\u52a1\u7ba1\u7406\u5668PlatformTransactionManager \u662f\u4e00\u4e2a\u63a5\u53e3\u6807\u51c6\uff0c\u5b9e\u73b0\u7c7b\u90fd\u5177\u5907\u4e8b\u52a1\u63d0\u4ea4\u3001\u56de\u6eda\u548c\u83b7\u5f97\u4e8b\u52a1\u5bf9\u8c61\u7684\u529f\u80fd\uff0c\u4e0d\u540c\u6301\u4e45\u5c42\u6846\u67b6\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\u5b9e\u73b0\u65b9\u6848 \u4e8b\u52a1\u5b9a\u4e49TransactionDefinition \u5c01\u88c5\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u3001\u4f20\u64ad\u884c\u4e3a\u3001\u8fc7\u671f\u65f6\u95f4\u7b49\u5c5e\u6027\u4fe1\u606f \u4e8b\u52a1\u72b6\u6001TransactionStatus \u5b58\u50a8\u5f53\u524d\u4e8b\u52a1\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5982\u679c\u4e8b\u52a1\u662f\u5426\u63d0\u4ea4\u3001\u662f\u5426\u56de\u6eda\u3001\u662f\u5426\u6709\u56de\u6eda\u70b9\u7b49"},{"location":"Spring/Spring-AOP/#xml\u65b9\u5f0f","title":"xml\u65b9\u5f0f","text":"<p>\u5bfc\u5165Spring\u4e8b\u52a1\u7684\u76f8\u5173\u7684\u5750\u6807\uff0cspring-jdbc\u5750\u6807\u5df2\u7ecf\u5f15\u5165spring-tx\u5750\u6807</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n    &lt;version&gt;6.1.14&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5f15\u5165\u547d\u540d\u7a7a\u95f4</p> <pre><code>xmlns:tx=\"http://www.springframework.org/schema/tx\"\nhttp://www.springframework.org/schema/tx\nhttp://www.springframework.org/schema/tx/spring-tx.xsd\n</code></pre> <p>\u914d\u7f6e\u4e8b\u52a1\u589e\u5f3a</p> <pre><code>&lt;!-- \u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668 --&gt;\n&lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt;\n    &lt;property name=\"dataSource\" ref=\"dataSource\"/&gt;\n&lt;/bean&gt;\n\n&lt;!-- \u914d\u7f6eSpring\u4e8b\u52a1\u589e\u5f3aadvice --&gt;\n&lt;tx:advice id=\"txAdvice\" transaction-manager=\"transactionManager\"&gt;\n    &lt;tx:attributes&gt;\n        &lt;tx:method name=\"*\"/&gt;\n    &lt;/tx:attributes&gt;\n&lt;/tx:advice&gt;\n\n&lt;!-- \u914d\u7f6e\u5207\u9762 --&gt;\n&lt;aop:config&gt;\n    &lt;aop:pointcut id=\"myPointcut\" expression=\"execution(* com.ysh.service.*.*(..))\"/&gt;\n    &lt;!-- \u914d\u7f6espring\u4e8b\u52a1\u589e\u5f3aadvisor(\u7531spring\u63d0\u4f9b) --&gt;\n    &lt;aop:advisor advice-ref=\"txAdvice\" pointcut-ref=\"myPointcut\" /&gt;\n&lt;/aop:config&gt;\n</code></pre> <p>Note</p> <p>\u5e73\u53f0\u4e8b\u52a1\u7ba1\u7406\u5668PlatformTransactionManager\u662fSpring\u63d0\u4f9b\u7684\u5c01\u88c5\u4e8b\u52a1\u5177\u4f53\u64cd\u4f5c\u7684\u89c4\u8303\u63a5\u53e3\uff0c\u5c01\u88c5\u4e86\u4e8b\u52a1\u7684\u63d0\u4ea4\u548c\u56de\u6eda\u65b9\u6cd5</p> <p>\u4e0d\u540c\u7684\u6301\u4e45\u5c42\u6846\u67b6\u4e8b\u52a1\u64cd\u4f5c\u7684\u65b9\u5f0f\u6709\u53ef\u80fd\u4e0d\u540c\uff0c\u6240\u4ee5\u4e0d\u540c\u7684\u6301\u4e45\u5c42\u6846\u67b6\u6709\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\u7684\u5e73\u53f0\u4e8b\u52a1\u7ba1\u7406\u5668\u5b9e\u73b0\uff0c\u4f8b\u5982:</p> <ul> <li> <p>MyBatis\u4f5c\u4e3a\u6301\u4e45\u5c42\u6846\u67b6\u65f6\uff0c\u4f7f\u7528\u7684\u5e73\u53f0\u4e8b\u52a1\u7ba1\u7406\u5668\u5b9e\u73b0\u662fDataSourceTransactionManager\u3002</p> </li> <li> <p>Hibernate\u4f5c\u4e3a\u6301\u4e45\u5c42\u6846\u67b6\u65f6\uff0c\u4f7f\u7528\u7684\u5e73\u53f0\u4e8b\u52a1\u7ba1\u7406\u5668\u662fHibernateTransactionManager\u3002</p> </li> </ul> <p>\u4e8b\u52a1\u5b9a\u4e49\u4fe1\u606f\u914d\u7f6e\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u6709\u5f88\u591a\u7279\u6027\uff0c\u4f8b\u5982\uff1a\u9694\u79bb\u7ea7\u522b\u3001\u53ea\u8bfb\u72b6\u6001\u3001\u8d85\u65f6\u65f6\u95f4\u7b49\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5728\u5f00\u53d1\u65f6\u53ef\u4ee5\u901a\u8fc7connection\u8fdb\u884c\u6307\u5b9a\uff0c\u800c\u6b64\u5904\u8981\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e</p> <pre><code>&lt;tx:attributes&gt;\n    &lt;tx:method name=\"\u65b9\u6cd5\u540d\u79f0\"\n                isolation=\"\u9694\u79bb\u7ea7\u522b\"\n                propagation=\"\u4f20\u64ad\u884c\u4e3a\"\n                read-only=\"\u53ea\u8bfb\u72b6\u6001\"\n                timeout=\"\u8d85\u65f6\u65f6\u95f4\"/&gt;\n&lt;/tx:attributes&gt;\n</code></pre> <ul> <li>name\u5c5e\u6027\uff1a\u6307\u5b9a\u54ea\u4e2a\u65b9\u6cd5\u8981\u8fdb\u884c\u54ea\u4e9b\u4e8b\u52a1\u7684\u5c5e\u6027\u914d\u7f6e</li> </ul> <p>\u65b9\u6cd5\u540d\u5728\u914d\u7f6e\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528* \u8fdb\u884c\u6a21\u7cca\u5339\u914d</p> <ul> <li>isolation\u5c5e\u6027\uff1a\u6307\u5b9a\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u4e8b\u52a1\u5e76\u53d1\u5b58\u5728\u4e09\u5927\u95ee\u9898\uff1a\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb/\u865a\u8bfb\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6765\u4fdd\u8bc1\u5e76\u53d1\u95ee\u9898\u7684\u51fa\u73b0\uff0c\u5e38\u7528\u7684\u662fREAD_COMMITTED \u548cREPEATABLE_READ</li> </ul> \u5c5e\u6027 \u8bf4\u660e DEFAULT \u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff0c\u53d6\u51b3\u4e8e\u5f53\u524d\u6570\u636e\u5e93\u9694\u79bb\u7ea7\u522b\uff0c\u4f8b\u5982MySQL\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662fREPEATABLE_READ READ_UNCOMMITTED A\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u5230B\u4e8b\u52a1\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u8bb0\u5f55\uff0c\u4e0d\u80fd\u89e3\u51b3\u4efb\u4f55\u5e76\u53d1\u95ee\u9898\uff0c\u5b89\u5168\u6027\u6700\u4f4e\uff0c\u6027\u80fd\u6700\u9ad8 READ_COMMITTED A\u4e8b\u52a1\u53ea\u80fd\u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u7684\u8bb0\u5f55\uff0c\u4e0d\u80fd\u8bfb\u53d6\u5230\u672a\u63d0\u4ea4\u7684\u8bb0\u5f55\u3002\u53ef\u4ee5\u89e3\u51b3\u810f\u8bfb\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u80fd\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb REPEATABLE_READ A\u4e8b\u52a1\u591a\u6b21\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u67d0\u6761\u8bb0\u5f55\u7ed3\u679c\u4e00\u81f4\uff0c\u53ef\u4ee5\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u4e0d\u53ef\u4ee5\u89e3\u51b3\u5e7b\u8bfb SERIALIZABLE \u4e32\u884c\u5316\uff0c\u53ef\u4ee5\u89e3\u51b3\u4efb\u4f55\u5e76\u53d1\u95ee\u9898\uff0c\u5b89\u5168\u6027\u6700\u9ad8\uff0c\u4f46\u662f\u6027\u80fd\u6700\u4f4e <ul> <li>read-only\u5c5e\u6027\uff1a\u8bbe\u7f6e\u5f53\u524d\u7684\u53ea\u8bfb\u72b6\u6001\uff0c\u5982\u679c\u662f\u67e5\u8be2\u5219\u8bbe\u7f6e\u4e3atrue\uff0c\u53ef\u4ee5\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\uff0c\u5982\u679c\u662f\u66f4\u65b0\uff08\u589e\u5220\u6539\uff09\u64cd\u4f5c\u5219\u8bbe\u7f6e\u4e3afalse</li> </ul> <pre><code>&lt;!-- \u4e00\u822c\u67e5\u8be2\u76f8\u5173\u7684\u4e1a\u52a1\u64cd\u4f5c\u90fd\u4f1a\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u6a21\u5f0f--&gt;\n &lt;tx:method name=\"select*\" read-only=\"true\"/&gt;\n &lt;tx:method name=\"find*\" read-only=\"true\"/&gt;\n</code></pre> <ul> <li> <p>timeout\u5c5e\u6027\uff1a\u8bbe\u7f6e\u4e8b\u52a1\u6267\u884c\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u5982\u679c\u8d85\u8fc7\u8be5\u65f6\u95f4\u9650\u5236\u4f46\u4e8b\u52a1\u8fd8\u6ca1\u6709\u5b8c\u6210\uff0c\u5219\u81ea\u52a8\u56de\u6eda\u4e8b\u52a1\uff0c\u4e0d\u5728\u7ee7\u7eed\u6267\u884c\u3002\u9ed8\u8ba4\u503c\u662f-1\uff0c\u5373\u6ca1\u6709\u8d85\u65f6\u65f6\u95f4\u9650\u5236</p> </li> <li> <p>propagation\u5c5e\u6027\uff1a\u8bbe\u7f6e\u4e8b\u52a1\u7684\u4f20\u64ad\u884c\u4e3a\uff0c\u4e3b\u8981\u89e3\u51b3\u662fA\u65b9\u6cd5\u8c03\u7528B\u65b9\u6cd5\u65f6\uff0c\u4e8b\u52a1\u7684\u4f20\u64ad\u65b9\u5f0f\u95ee\u9898\u7684\uff0c\u4f8b\u5982\uff1a\u4f7f\u7528\u5355\u65b9\u7684\u4e8b\u52a1\uff0c\u8fd8\u662fA\u548cB\u90fd\u4f7f\u7528\u81ea\u5df1\u7684\u4e8b\u52a1\u7b49\u3002\u4e8b\u52a1\u7684\u4f20\u64ad\u884c\u4e3a\u6709\u5982\u4e0b\u4e03\u79cd\u5c5e\u6027\u503c\u53ef\u914d\u7f6e</p> </li> </ul> \u5c5e\u6027 \u8bf4\u660e REQUIRED\uff08\u9ed8\u8ba4\u503c\uff09 A\u8c03\u7528B\uff0cB\u9700\u8981\u4e8b\u52a1\uff0c\u5982\u679cA\u6709\u4e8b\u52a1B\u5c31\u52a0\u5165A\u7684\u4e8b\u52a1\u4e2d\uff0c\u5982\u679cA\u6ca1\u6709\u4e8b\u52a1\uff0cB\u5c31\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u4e8b\u52a1 REQUIRED_NEW A\u8c03\u7528B\uff0cB\u9700\u8981\u65b0\u4e8b\u52a1\uff0c\u5982\u679cA\u6709\u4e8b\u52a1\u5c31\u6302\u8d77\uff0cB\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4e8b\u52a1 SUPPORTS A\u8c03\u7528B\uff0cB\u6709\u65e0\u4e8b\u52a1\u65e0\u6240\u8c13\uff0cA\u6709\u4e8b\u52a1\u5c31\u52a0\u5165\u5230A\u4e8b\u52a1\u4e2d\uff0cA\u65e0\u4e8b\u52a1B\u5c31\u4ee5\u975e\u4e8b\u52a1\u65b9\u5f0f\u6267\u884c NOT_SUPPORTS A\u8c03\u7528B\uff0cB\u4ee5\u65e0\u4e8b\u52a1\u65b9\u5f0f\u6267\u884c\uff0cA\u5982\u6709\u4e8b\u52a1\u5219\u6302\u8d77 NEVER A\u8c03\u7528B\uff0cB\u4ee5\u65e0\u4e8b\u52a1\u65b9\u5f0f\u6267\u884c\uff0cA\u5982\u6709\u4e8b\u52a1\u5219\u629b\u51fa\u5f02\u5e38 MANDATORY A\u8c03\u7528B\uff0cB\u8981\u52a0\u5165A\u7684\u4e8b\u52a1\u4e2d\uff0c\u5982\u679cA\u65e0\u4e8b\u52a1\u5c31\u629b\u51fa\u5f02\u5e38 NESTED A\u8c03\u7528B\uff0cB\u521b\u5efa\u4e00\u4e2a\u65b0\u4e8b\u52a1\uff0cA\u6709\u4e8b\u52a1\u5c31\u4f5c\u4e3a\u5d4c\u5957\u4e8b\u52a1\u5b58\u5728\uff0cA\u6ca1\u4e8b\u52a1\u5c31\u4ee5\u521b\u5efa\u7684\u65b0\u4e8b\u52a1\u6267\u884c <p>xml\u65b9\u5f0f\u58f0\u660e\u5f0f\u4e8b\u52a1\u63a7\u5236\u539f\u7406\uff1a</p> <p><code>&lt;tx:advice&gt;</code>\u914d\u7f6e\u7684\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u9075\u5b88\u4e86Advice\u89c4\u8303\u7684\u7c7b\uff0c\u8be5\u7c7b\u5b9e\u73b0\u4e86<code>MethodInterceptor</code>\u63a5\u53e3\u53ef\u4ee5\u5bf9\u65b9\u6cd5\u8fdb\u884c\u73af\u7ed5\u589e\u5f3a\u3002(AOP\u539f\u7406)</p>"},{"location":"Spring/Spring-AOP/#\u6ce8\u89e3\u65b9\u5f0f","title":"\u6ce8\u89e3\u65b9\u5f0f","text":"<p>\u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0@Transactional\u6ce8\u89e3\uff0c\u8be5\u6ce8\u89e3\u53ef\u4ee5\u914d\u7f6e\u4e8b\u52a1\u5b9a\u4e49\u4fe1\u606f\u914d\u7f6e</p> <p>\u82e5\u914d\u7f6e\u5728\u7c7b\u4e0a\uff0c\u5219\u8be5\u7c7b\u5168\u5c40\u53d7\u4e8b\u52a1\u63a7\u5236</p> <pre><code>    &lt;tx:annotation-driven/&gt;\n    &lt;!-- \u4e8b\u52a1\u81ea\u52a8\u4ee3\u7406 --&gt;\n</code></pre> <p>\u82e5\u4f7f\u7528\u5168\u6ce8\u89e3\u65b9\u5f0f\uff1a</p> <pre><code>@Configuration\n@ComponentScan(\"com.ysh\")\n@MapperScan(\"com.ysh.mapper\")\n@EnableTransactionManagement    //\u81ea\u52a8\u4e8b\u52a1\u7ba1\u7406\npublic class SpringConfig {\n    @Bean\n    public DataSource dataSource() {\n        DruidDataSource dataSource =  new DruidDataSource();\n        dataSource.setUsername(\"root\");\n        dataSource.setPassword(\"123456\");\n        dataSource.setUrl(\"jdbc:mysql://8.138.186.154:3306/mp\");\n        dataSource.setDriverClassName(\"com.mysql.cj.jdbc.Driver\");\n        return dataSource;\n    }\n\n    @Bean\n    public SqlSessionFactoryBean sqlSessionFactoryBean(DataSource dataSource) {\n        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();\n        sqlSessionFactoryBean.setDataSource(dataSource);\n        return sqlSessionFactoryBean;\n    }\n\n    // \u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668\n    @Bean(\"transactionManager\")\n    public DataSourceTransactionManager transactionManager(DataSource dataSource) {\n        DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager(dataSource);\n        dataSourceTransactionManager.setDataSource(dataSource);\n        return dataSourceTransactionManager;\n    }\n}\n</code></pre>"},{"location":"Spring/Spring-AOP/#\u4e8b\u52a1\u5931\u6548","title":"\u4e8b\u52a1\u5931\u6548","text":""},{"location":"Spring/Spring-AOP/#1-\u65b9\u6cd5\u975e-public-\u4fee\u9970","title":"1. \u65b9\u6cd5\u975e <code>public</code> \u4fee\u9970","text":"<ul> <li>\u95ee\u9898\uff1aSpring \u4e8b\u52a1\u57fa\u4e8e AOP \u52a8\u6001\u4ee3\u7406\u5b9e\u73b0\uff0c\u9ed8\u8ba4\u53ea\u4ee3\u7406 <code>public</code> \u65b9\u6cd5\u3002</li> <li>\u89e3\u51b3\uff1a\u786e\u4fdd <code>@Transactional</code> \u6ce8\u89e3\u7684\u65b9\u6cd5\u4e3a <code>public</code>\u3002</li> </ul>"},{"location":"Spring/Spring-AOP/#2-\u4e8b\u52a1\u65b9\u6cd5\u88ab\u540c\u7c7b\u5185\u90e8\u8c03\u7528","title":"2. \u4e8b\u52a1\u65b9\u6cd5\u88ab\u540c\u7c7b\u5185\u90e8\u8c03\u7528","text":"<ul> <li> <p>\u95ee\u9898\uff1a\u4e8b\u52a1\u65b9\u6cd5\u88ab\u540c\u7c7b\u4e2d\u7684\u5176\u4ed6\u65b9\u6cd5\u76f4\u63a5\u8c03\u7528\uff08\u7ed5\u8fc7\u4ee3\u7406\u5bf9\u8c61\uff09\u3002</p> </li> <li> <p>\u89e3\u51b3\uff1a</p> </li> <li> <p>\u65b9\u5f0f1\uff1a\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\uff08\u6ce8\u5165\u81ea\u8eab Bean\uff09\uff1a</p> <pre><code>@Service\npublic class UserService {\n  @Autowired\n  private UserService userService; // \u6ce8\u5165\u81ea\u8eab\u4ee3\u7406\u5bf9\u8c61\n\n  public void methodA() {\n    userService.methodB(); // \u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\n  }\n\n  @Transactional\n  public void methodB() {\n    // \u4e1a\u52a1\u903b\u8f91\n  }\n}\n</code></pre> </li> <li> <p>\u65b9\u5f0f2\uff1a\u4f7f\u7528 <code>AopContext</code> \u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\uff1a</p> <pre><code>public void methodA() {\n  ((UserService) AopContext.currentProxy()).methodB();\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u9700\u5728\u542f\u52a8\u7c7b\u6dfb\u52a0 <code>@EnableAspectJAutoProxy(exposeProxy = true)</code>\u3002</p> </li> </ul>"},{"location":"Spring/Spring-AOP/#3-\u5f02\u5e38\u672a\u88ab\u6b63\u786e\u629b\u51fa","title":"3. \u5f02\u5e38\u672a\u88ab\u6b63\u786e\u629b\u51fa","text":"<ul> <li>\u95ee\u9898\uff1a\u9ed8\u8ba4\u4e8b\u52a1\u4ec5\u5bf9 <code>RuntimeException</code> \u548c <code>Error</code> \u56de\u6eda\uff0c\u5176\u4ed6\u5f02\u5e38\u9700\u624b\u52a8\u914d\u7f6e\u3002</li> <li>\u89e3\u51b3\uff1a</li> <li>\u624b\u52a8\u629b\u51fa <code>RuntimeException</code>\uff1a</li> <li>\u6307\u5b9a\u56de\u6eda\u5f02\u5e38\u7c7b\u578b\uff1a</li> </ul>"},{"location":"Spring/Spring-AOP/#4-\u4e8b\u52a1\u4f20\u64ad\u673a\u5236\u914d\u7f6e\u9519\u8bef","title":"4. \u4e8b\u52a1\u4f20\u64ad\u673a\u5236\u914d\u7f6e\u9519\u8bef","text":"<ul> <li> <p>\u95ee\u9898\uff1a\u9ed8\u8ba4\u4f20\u64ad\u673a\u5236\u4e3a <code>REQUIRED</code>\uff0c\u82e5\u5d4c\u5957\u4e8b\u52a1\u914d\u7f6e\u4e0d\u5f53\uff0c\u53ef\u80fd\u5bfc\u81f4\u9884\u671f\u5916\u7684\u884c\u4e3a\u3002</p> </li> <li> <p>\u89e3\u51b3\uff1a\u6839\u636e\u573a\u666f\u9009\u62e9\u4f20\u64ad\u673a\u5236\uff1a</p> </li> </ul> <p>\u4e0a\u4e00\u8282\uff1a \u57fa\u4e8e\u6ce8\u89e3\u7684Spring\u5e94\u7528</p> <p>\u4e0b\u4e00\u8282\uff1a \u6574\u5408Web\u73af\u5883</p>"},{"location":"Spring/Spring-Annotation/","title":"\u57fa\u4e8e\u6ce8\u89e3\u7684Spring\u5e94\u7528","text":""},{"location":"Spring/Spring-Annotation/#bean\u7684\u57fa\u672c\u6ce8\u89e3\u5f00\u53d1","title":"Bean\u7684\u57fa\u672c\u6ce8\u89e3\u5f00\u53d1","text":"<p>\u4f7f\u7528\u6ce8\u89e3\u5bf9\u9700\u8981\u88abSpring\u5b9e\u4f8b\u5316\u7684Bean\u8fdb\u884c\u6807\u6ce8\uff0c\u9700\u8981\u544a\u8bc9Spring\u53bb\u54ea\u627e\u8fd9\u4e9bBean\uff0c\u8981\u914d\u7f6e\u7ec4\u4ef6\u626b\u63cf\u8def\u5f84\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\n    &lt;!--\u6ce8\u89e3\u7ec4\u4ef6\u626b\u63cf\uff1a\u626b\u63cf\u6307\u5b9a\u5305\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u7c7b\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u4e3aSpring Bean--&gt;\n    &lt;context:component-scan base-package=\"com.ysh\"/&gt;\n\n&lt;/beans&gt;\n</code></pre> xml\u914d\u7f6e \u6ce8\u89e3 \u63cf\u8ff0 <code>&lt;bean id=\"\" class=\"\"&gt;</code> @Component \u88ab\u8be5\u6ce8\u89e3\u6807\u8bc6\u7684\u7c7b\uff0c\u4f1a\u5728\u6307\u5b9a\u626b\u63cf\u8303\u56f4\u5185\u88abSpring\u52a0\u8f7d\u5e76\u5b9e\u4f8b\u5316 <code>&lt;bean scope=\"\"&gt;</code> @Scope \u5728\u7c7b\u4e0a\u6216\u4f7f\u7528\u4e86@Bean\u6807\u6ce8\u7684\u65b9\u6cd5\u4e0a\uff0c\u6807\u6ce8Bean\u7684\u4f5c\u7528\u8303\u56f4\uff0c\u53d6\u503c\u4e3asingleton\u6216prototype <code>&lt;bean lazy-init=\"\"&gt;</code> @Lazy \u5728\u7c7b\u4e0a\u6216\u4f7f\u7528\u4e86@Bean\u6807\u6ce8\u7684\u65b9\u6cd5\u4e0a\uff0c\u6807\u6ce8Bean\u662f\u5426\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u53d6\u503c\u4e3atrue\u548cfalse <code>&lt;bean init-method=\"\"&gt;</code> @PostConstruct \u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528\uff0c\u6807\u6ce8Bean\u7684\u5b9e\u4f8b\u5316\u540e\u6267\u884c\u7684\u65b9\u6cd5 <code>&lt;bean destroy-method=\"\"&gt;</code> @PreDestroy \u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528\uff0c\u6807\u6ce8Bean\u7684\u9500\u6bc1\u524d\u6267\u884c\u65b9\u6cd5 <p>\u53ef\u4ee5\u901a\u8fc7@Component\u6ce8\u89e3\u7684value\u5c5e\u6027\u6307\u5b9a\u5f53\u524dBean\u5b9e\u4f8b\u7684beanName\uff0c\u4e5f\u53ef\u4ee5\u7701\u7565\u4e0d\u5199\uff0c\u4e0d\u5199\u7684\u60c5\u51b5\u4e0b\u4e3a\u5f53\u524d \u7c7b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199</p> <pre><code>//\u83b7\u53d6\u65b9\u5f0f\uff1aapplicationContext.getBean(\"userDao\");\n@Component(\"userDao\")\npublic class UserDaoImpl implements UserDao {\n}\n//\u83b7\u53d6\u65b9\u5f0f\uff1aapplicationContext.getBean(\"userDaoImpl\");\n@Component\npublic class UserDaoImpl implements UserDao {\n}\n</code></pre> <p>Example</p> <pre><code>@Component(\"userDao\")\n@Scope(\"singleton\")\n@Lazy(true)\npublic class UserDaoImpl implements UserDao{\n    @PostConstruct\n    public void init(){}\n    @PreDestroy\n    public void destroy(){}\n}\n</code></pre> <p></p> <p>\u7531\u4e8eJavaEE\u5f00\u53d1\u662f\u5206\u5c42\u7684\uff0c\u4e3a\u4e86\u6bcf\u5c42Bean\u6807\u8bc6\u7684\u6ce8\u89e3\u8bed\u4e49\u5316\u66f4\u52a0\u660e\u786e\uff0c@Component\u53c8\u884d\u751f\u51fa\u5982\u4e0b\u4e09\u4e2a\u6ce8\u89e3\uff1a</p> @Component\u884d\u751f\u6ce8\u89e3 \u63cf\u8ff0 @Repository \u5728Dao\u5c42\u7c7b\u4e0a\u4f7f\u7528 @Service \u5728Service\u5c42\u7c7b\u4e0a\u4f7f\u7528 @Controller \u5728Web\u5c42\u7c7b\u4e0a\u4f7f\u7528"},{"location":"Spring/Spring-Annotation/#bean\u4f9d\u8d56\u6ce8\u5165\u6ce8\u89e3\u5f00\u53d1","title":"Bean\u4f9d\u8d56\u6ce8\u5165\u6ce8\u89e3\u5f00\u53d1","text":"<p>Bean\u4f9d\u8d56\u6ce8\u5165\u7684\u6ce8\u89e3\uff0c\u4e3b\u8981\u662f\u4f7f\u7528\u6ce8\u89e3\u7684\u65b9\u5f0f\u66ff\u4ee3xml\u7684 \u6807\u7b7e\u5b8c\u6210\u5c5e\u6027\u7684\u6ce8\u5165\u64cd\u4f5c</p> <pre><code>    &lt;bean id=\"\" class=\"\"&gt;\n        &lt;property name=\"\" value=\"\"/&gt;\n        &lt;property name=\"\" ref=\"\"/&gt;\n    &lt;/bean&gt;\n</code></pre> <p>Spring\u4e3b\u8981\u63d0\u4f9b\u5982\u4e0b\u6ce8\u89e3\uff0c\u7528\u4e8e\u5728Bean\u5185\u90e8\u8fdb\u884c\u5c5e\u6027\u6ce8\u5165\u7684\uff1a</p> \u6ce8\u89e3 \u63cf\u8ff0 <code>@Value</code> \u4f7f\u7528\u5728\u5b57\u6bb5\u6216\u65b9\u6cd5\u4e0a\uff0c\u7528\u4e8e\u6ce8\u5165\u666e\u901a\u6570\u636e <code>@Autowired</code> \u4f7f\u7528\u5728\u5b57\u6bb5\u6216\u65b9\u6cd5\u4e0a\uff0c\u7528\u4e8e\u6839\u636e\u7c7b\u578b\uff08byType\uff09\u6ce8\u5165\u5f15\u7528\u6570\u636e <code>@Qualifier</code> \u4f7f\u7528\u5728\u5b57\u6bb5\u6216\u65b9\u6cd5\u4e0a\uff0c\u7ed3\u5408@Autowired\uff0c\u6839\u636e\u540d\u79f0\u6ce8\u5165 <code>@Resource</code> \u4f7f\u7528\u5728\u5b57\u6bb5\u6216\u65b9\u6cd5\u4e0a\uff0c\u6839\u636e\u7c7b\u578b\u6216\u540d\u79f0\u8fdb\u884c\u6ce8\u5165 <p>Quote</p> <p>@Resource\u6ce8\u89e3\u7531JavaEE\u89c4\u8303\u5b9a\u4e49\uff0cSpring\u6846\u67b6\u652f\u6301\u5e76\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u6807\u51c6\u6ce8\u89e3 </p>"},{"location":"Spring/Spring-Annotation/#value\u6ce8\u5165","title":"@Value\u6ce8\u5165","text":"<ul> <li>\u76f4\u63a5\u6ce8\u5165\u666e\u901a\u5c5e\u6027\uff1a</li> </ul> <pre><code>@Value(\"haohao\")// \u5b9e\u9645\u5f00\u53d1\u610f\u4e49\u4e0d\u5927\nprivate String username;\n\n@Value(\"haohao\")\npublic void setUsername(String username){\n    System.out.println(username);\n}\n</code></pre> <ul> <li>\u6ce8\u5165properties\u6587\u4ef6\u4e2d\u7684\u5c5e\u6027:</li> </ul> <pre><code>@Value(\"${jdbc.username}\")\nprivate String username;\n\n@Value(\"${jdbc.username}\")\npublic void setUsername(String username){\n    System.out.println(username);\n}\n</code></pre> <p>Tip</p> <p>\u5728<code>applicationContext.xml</code>\u4e2d\u52a0\u8f7dproperties\u6587\u4ef6:</p> <pre><code>&lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt;\n</code></pre>"},{"location":"Spring/Spring-Annotation/#autowired\u6ce8\u5165","title":"@Autowired\u6ce8\u5165","text":"<p>\u7528\u4e8e\u6839\u636e \u7c7b\u578b \u8fdb\u884c\u6ce8\u5165</p> <pre><code>//\u4f7f\u7528\u5728\u5c5e\u6027\u4e0a\u76f4\u63a5\u6ce8\u5165\n@Autowired\nprivate UserDao userDao;\n\n//\u4f7f\u7528\u5728\u65b9\u6cd5\u4e0a\u76f4\u63a5\u6ce8\u5165\n@Autowired\npublic void setUserDao(UserDao userDao){\n    System.out.println(userDao);\n}\n</code></pre> <p>Tip</p> <p>\u5f53\u5bb9\u5668\u4e2d\u540c\u4e00\u7c7b\u578b\u7684Bean\u5b9e\u4f8b\u6709\u591a\u4e2a\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u81ea\u52a8\u6839\u636e\u540d\u5b57\u8fdb\u884c\u5339\u914d</p> <p>\u5f53\u5bb9\u5668\u4e2d\u540c\u4e00\u7c7b\u578b\u7684Bean\u5b9e\u4f8b\u6709\u591a\u4e2a\u65f6\uff0c\u4e14\u540d\u5b57\u4e0e\u88ab\u6ce8\u5165Bean\u540d\u79f0\u4e0d\u5339\u914d\u65f6\u4f1a\u62a5\u9519</p> <p>\u53ef\u6ce8\u5165\u96c6\u5408\uff0c\u4ece\u5bb9\u5668\u4e2d\u627e\u591a\u4e2a\u540c\u7c7b\u578b\u7684\u5bf9\u8c61</p> <pre><code>@Autowired\npublic void test(List&lt;UserDao&gt; list){\n//\n}\n</code></pre>"},{"location":"Spring/Spring-Annotation/#qualifier\u6ce8\u5165","title":"@Qualifier\u6ce8\u5165","text":"<p><code>@Qualifier</code>\u914d\u5408<code>@Autowired</code>\u53ef\u4ee5\u5b8c\u6210\u6839\u636e\u540d\u79f0\u6ce8\u5165Bean\u5b9e\u4f8b\uff0c\u4f7f\u7528<code>@Qualifier</code>\u6307\u5b9a\u540d\u79f0:</p> <pre><code>@Autowired\n@Qualifier(\"userDao2\")\nprivate UserDao userDao;\n\n@Autowired\n@Qualifier(\"userDao2\")\npublic void setUserDao(UserDao userDao){\n    System.out.println(userDao);\n}\n</code></pre>"},{"location":"Spring/Spring-Annotation/#resource\u6ce8\u5165","title":"@Resource\u6ce8\u5165","text":"<p>@Resource\u6ce8\u89e3\u65e2\u53ef\u4ee5\u6839\u636e\u7c7b\u578b\u6ce8\u5165\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u540d\u79f0\u6ce8\u5165\uff0c\u65e0\u53c2\u5c31\u662f\u6839\u636e\u7c7b\u578b\u6ce8\u5165\uff0c\u6709\u53c2\u6570(name)\u5c31\u662f\u6839\u636e\u540d\u79f0\u6ce8\u5165</p> <pre><code>@Resource\nprivate UserDao userDao;\n\n@Resource(name = \"userDao2\")\npublic void setUserDao(UserDao userDao){\n    System.out.println(userDao);\n}\n</code></pre> <p>Quote</p> <p><code>@Resource</code>\u6ce8\u89e3\u5728 javax.annotation \u5305\u4e2d\uff08\u8be5\u6ce8\u89e3\u6765\u81eaJDK\uff09\uff0cSpring\u5bf9\u5176\u8fdb\u884c\u4e86\u89e3\u6790</p> <p></p>"},{"location":"Spring/Spring-Annotation/#\u975e\u81ea\u5b9a\u4e49bean\u6ce8\u89e3\u5f00\u53d1","title":"\u975e\u81ea\u5b9a\u4e49Bean\u6ce8\u89e3\u5f00\u53d1","text":"<p>\u975e\u81ea\u5b9a\u4e49Bean\u4e0d\u80fd\u50cf\u81ea\u5b9a\u4e49Bean\u4e00\u6837\u4f7f\u7528@Component\u8fdb\u884c\u7ba1\u7406\uff0c\u975e\u81ea\u5b9a\u4e49Bean\u8981\u901a\u8fc7\u5de5\u5382\u7684\u65b9\u5f0f\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u4f7f\u7528<code>@Bean</code>\u6807\u6ce8\u65b9\u6cd5\u5373\u53ef\uff0c@Bean\u7684\u5c5e\u6027\u4e3abeanName\uff0c\u5982\u4e0d\u6307\u5b9a\u5373\u4e3a\u5f53\u524d\u5de5\u5382\u65b9\u6cd5\u540d\u79f0</p> <pre><code>//\u5c06\u65b9\u6cd5\u8fd4\u56de\u503cBean\u5b9e\u4f8b\u4ee5@Bean\u6ce8\u89e3\u6307\u5b9a\u7684\u540d\u79f0\u5b58\u50a8\u5230Spring\u5bb9\u5668\u4e2d\n@Bean(\"dataSource\")\npublic DataSource dataSource(){\n \u00a0\u00a0\u00a0\u00a0DruidDataSource dataSource = new DruidDataSource();\n \u00a0\u00a0\u00a0\u00a0dataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\n\u00a0\u00a0\u00a0\u00a0 dataSource.setUrl(\"jdbc:mysql://localhost:3306/mybatis\");\n\u00a0\u00a0\u00a0\u00a0 dataSource.setUsername(\"root\");\n\u00a0\u00a0\u00a0\u00a0 dataSource.setPassword(\"root\");\n\u00a0\u00a0\u00a0\u00a0 return dataSource;\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5de5\u5382\u65b9\u6cd5\u6240\u5728\u7c7b\u5fc5\u987b\u8981\u88abSpring\u7ba1\u7406</p> <p>\u5982\u679c@Bean\u5de5\u5382\u65b9\u6cd5\u9700\u8981\u53c2\u6570\u7684\u8bdd\uff0c\u5219\u6709\u5982\u4e0b\u51e0\u79cd\u6ce8\u5165\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u4f7f\u7528@Autowired \u6839\u636e\u7c7b\u578b\u81ea\u52a8\u8fdb\u884cBean\u7684\u5339\u914d\uff0c@Autowired\u53ef\u4ee5\u7701\u7565\uff1b</p> </li> <li> <p>\u4f7f\u7528@Qualifier \u6839\u636e\u540d\u79f0\u8fdb\u884cBean\u7684\u5339\u914d\uff1b</p> </li> <li> <p>\u4f7f\u7528@Value \u6839\u636e\u540d\u79f0\u8fdb\u884c\u666e\u901a\u6570\u636e\u7c7b\u578b\u5339\u914d\u3002</p> </li> </ul>"},{"location":"Spring/Spring-Annotation/#bean\u914d\u7f6e\u7c7b\u7684\u6ce8\u89e3\u5f00\u53d1","title":"Bean\u914d\u7f6e\u7c7b\u7684\u6ce8\u89e3\u5f00\u53d1","text":"<p><code>@Configuration</code>\u6ce8\u89e3\u6807\u8bc6\u7684\u7c7b\u4e3a\u914d\u7f6e\u7c7b\uff0c\u66ff\u4ee3\u539f\u6709xml\u914d\u7f6e\u6587\u4ef6\uff0c\u8be5\u6ce8\u89e3\u7b2c\u4e00\u4e2a\u4f5c\u7528\u662f\u6807\u8bc6\u8be5\u7c7b\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u7b2c\u4e8c\u4e2a\u4f5c\u7528\u662f\u5177\u5907<code>@Component</code>\u7684\u4f5c\u7528</p> <pre><code>@Configuration\npublic class ApplicationContextConfig {}\n</code></pre> <p><code>@ComponentScan</code>\u7ec4\u4ef6\u626b\u63cf\u914d\u7f6e</p> <pre><code> @Configuration\n @ComponentScan({\"com.itheima.service\",\"com.itheima.dao\"})\n public class ApplicationContextConfig {}\n</code></pre> <p>Tip</p> <ul> <li> <p>\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u5305\u540d\uff1a\u626b\u63cf\u6307\u5b9a\u5305\u53ca\u5176\u5b50\u5305\u4e0b\u4f7f\u7528\u6ce8\u89e3\u7684\u7c7b</p> </li> <li> <p>\u4e0d\u914d\u7f6e\u5305\u540d\uff1a\u626b\u63cf\u5f53\u524d@componentScan\u6ce8\u89e3\u914d\u7f6e\u7c7b\u6240\u5728\u5305\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u7c7b</p> </li> </ul> <p><code>@PropertySource</code>\u6ce8\u89e3\u7528\u4e8e\u52a0\u8f7d\u5916\u90e8properties\u8d44\u6e90\u914d\u7f6e</p> <pre><code> @Configuration\n @ComponentScan\n @PropertySource({\"classpath:jdbc.properties\",\"classpath:xxx.properties\"})\n public class ApplicationContextConfig {}\n</code></pre> <p><code>@Import</code> \u7528\u4e8e\u52a0\u8f7d\u5176\u4ed6\u914d\u7f6e\u7c7b</p> <pre><code> @Configuration\n @ComponentScan\n @PropertySource(\"classpath:jdbc.properties\")\n @Import(OtherConfig.class)\n public class ApplicationContextConfig {}\n</code></pre> <p>\u4f7f\u7528<code>AnnotationConfigApplicationContext</code>\u66ff\u4ee3\u4ee5xml\u65b9\u5f0f\u52a0\u8f7d\u7684Spring\u5bb9\u5668</p> <pre><code>ApplicationContext context = new AnnotationConfigApplicationContext(SpringConfiguration.class);\n</code></pre>"},{"location":"Spring/Spring-Annotation/#spring\u914d\u7f6e\u5176\u4ed6\u6ce8\u89e3","title":"Spring\u914d\u7f6e\u5176\u4ed6\u6ce8\u89e3","text":"<p><code>@Primary</code>\u6ce8\u89e3\u7528\u4e8e\u6807\u6ce8\u76f8\u540c\u7c7b\u578b\u7684Bean\u4f18\u5148\u4f7f\u7528\u6743\uff0c@Primary \u662fSpring3.0\u5f15\u5165\u7684\uff0c\u4e0e@Component\u548c@Bean\u4e00\u8d77\u4f7f\u7528\uff0c\u6807\u6ce8Bean\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\uff0c\u5219\u5728\u901a\u8fc7\u7c7b\u578b\u83b7\u53d6Bean\u6216\u901a\u8fc7@Autowired\u6839\u636e\u7c7b\u578b\u8fdb\u884c\u6ce8\u5165\u65f6\uff0c\u4f1a\u9009\u7528\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684</p> <p><code>@Profile</code> \u6ce8\u89e3\u662f\u8fdb\u884c\u73af\u5883\u5207\u6362\u4f7f\u7528\u7684</p> <p>Note</p> <p>\u6ce8\u89e3@Profile \u6807\u6ce8\u5728\u7c7b\u6216\u65b9\u6cd5\u4e0a\uff0c\u6807\u6ce8\u5f53\u524d\u4ea7\u751f\u7684Bean\u4ece\u5c5e\u4e8e\u54ea\u4e2a\u73af\u5883\uff0c\u53ea\u6709\u6fc0\u6d3b\u4e86\u5f53\u524d\u73af\u5883\uff0c\u88ab\u6807\u6ce8\u7684Bean\u624d\u80fd\u88ab\u6ce8\u518c\u5230Spring\u5bb9\u5668\u91cc\uff0c\u4e0d\u6307\u5b9a\u73af\u5883\u7684Bean\uff0c\u4efb\u4f55\u73af\u5883\u4e0b\u90fd\u80fd\u6ce8\u518c\u5230Spring\u5bb9\u5668\u91cc</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u6307\u5b9a\u88ab\u6fc0\u6d3b\u7684\u73af\u5883\uff1a</p> <ul> <li> <p>\u4f7f\u7528\u547d\u4ee4\u884c\u52a8\u6001\u53c2\u6570\uff0c\u865a\u62df\u673a\u53c2\u6570\u4f4d\u7f6e\u52a0\u8f7d<code>-Dspring.profiles.active=test</code> </p> </li> <li> <p>\u4f7f\u7528\u4ee3\u7801\u7684\u65b9\u5f0f\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf<code>System.setProperty(\"spring.profiles.active\",\"test\")</code></p> </li> </ul>"},{"location":"Spring/Spring-Annotation/#spring\u6ce8\u89e3\u89e3\u6790\u539f\u7406","title":"Spring\u6ce8\u89e3\u89e3\u6790\u539f\u7406","text":""},{"location":"Spring/Spring-Annotation/#\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6","title":"\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6","text":"<p>\u4ee5MyBatis\u4e3a\u4f8b</p> <p>\u5bfc\u5165\u4f9d\u8d56\uff1a</p> <pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n            &lt;artifactId&gt;druid&lt;/artifactId&gt;\n            &lt;version&gt;1.2.23&lt;/version&gt;\n            &lt;scope&gt;compile&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n            &lt;version&gt;8.0.33&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;\n            &lt;version&gt;3.5.16&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;\n            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;\n            &lt;version&gt;3.0.3&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n            &lt;version&gt;6.1.14&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre> <p>\u914d\u7f6e\u7b2c\u4e09\u65b9Bean</p> <pre><code>@ComponentScan\n@Configuration\n@PropertySource(\"classpath:jdbc.properties\")\n@MapperScan(\"com.ysh.mapper\")\npublic class SpringConfiguration {\n\n    @Bean\n    public DataSource dataSource(\n            @Value(\"${jdbc.url}\") String url,\n            @Value(\"${jdbc.username}\") String username,\n            @Value(\"${jdbc.password}\") String password,\n            @Value(\"${jdbc.driverClassName}\") String driverClassName\n    ) {\n        DruidDataSource dataSource = new DruidDataSource();\n        dataSource.setUrl(url);\n        dataSource.setUsername(username);\n        dataSource.setPassword(password);\n        dataSource.setDriverClassName(driverClassName);\n        return dataSource;\n    }\n\n    @Bean\n    public SqlSessionFactoryBean sqlSessionFactoryBean(DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();\n        sqlSessionFactoryBean.setDataSource(dataSource);\n        return sqlSessionFactoryBean;\n    }\n}\n</code></pre> <p>\u7b2c\u4e09\u65b9\u6846\u67b6\u4e0eSpring\u6574\u5408xml\u65b9\u5f0f\u5f88\u591a\u662f\u51ed\u501f\u81ea\u5b9a\u4e49\u6807\u7b7e\u5b8c\u6210\u7684\uff0c\u800c\u7b2c\u4e09\u65b9\u6846\u67b6\u4e0eSpring\u6574\u5408\u6ce8\u89e3\u65b9\u5f0f\u5f88\u591a\u662f\u9760@Import\u6ce8\u89e3\u5b8c\u6210\u7684</p> <p>@Import\u53ef\u4ee5\u5bfc\u5165\u5982\u4e0b\u4e09\u79cd\u7c7b\uff1a</p> <ul> <li> <p>\u666e\u901a\u7684\u914d\u7f6e\u7c7b</p> </li> <li> <p>\u5b9e\u73b0<code>ImportSelector</code>\u63a5\u53e3\u7684\u7c7b</p> </li> <li> <p>\u5b9e\u73b0<code>ImportBeanDefinitionRegistrar</code>\u63a5\u53e3\u7684\u7c7b</p> </li> </ul> <p>\u4e0a\u4e00\u8282\uff1a \u57fa\u4e8eXML\u7684Spring\u5e94\u7528</p> <p>\u4e0b\u4e00\u8282\uff1a Spring\u7684AOP\u5f00\u53d1</p>"},{"location":"Spring/Spring-MVC/","title":"Spring MVC\u6846\u67b6","text":""},{"location":"Spring/Spring-MVC/#\u7b80\u4ecb","title":"\u7b80\u4ecb","text":""},{"location":"Spring/Spring-MVC/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>SpringMVC\u662f\u4e00\u4e2a\u57fa\u4e8eSpring\u5f00\u53d1\u7684MVC\u8f7b\u91cf\u7ea7\u6846\u67b6\uff0cSpring3.0\u540e\u53d1\u5e03\u7684\u7ec4\u4ef6\uff0cSpringMVC\u548cSpring\u53ef\u4ee5\u65e0\u7f1d\u6574\u5408\uff0c\u4f7f\u7528DispatcherServlet\u4f5c\u4e3a\u524d\u7aef\u63a7\u5236\u5668\uff0c\u4e14\u5185\u90e8\u63d0\u4f9b\u4e86\u5904\u7406\u5668\u6620\u5c04\u5668\u3001\u5904\u7406\u5668\u9002\u914d\u5668\u3001\u89c6\u56fe\u89e3\u6790\u5668\u7b49\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u7b80\u5316JavaBean\u5c01\u88c5\uff0cJson\u8f6c\u5316\u3001\u6587\u4ef6\u4e0a\u4f20\u7b49\u64cd\u4f5c\u3002</p> <p></p>"},{"location":"Spring/Spring-MVC/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<ul> <li>\u5bfc\u5165<code>spring-webmvc</code>\u5750\u6807\uff08pom.xml\uff09</li> </ul> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n    &lt;version&gt;5.3.23&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <ul> <li>\u7f16\u5199\u4e00\u4e2a\u63a7\u5236\u5668Controller\uff0c\u914d\u7f6e\u6620\u5c04\u4fe1\u606f</li> </ul> <pre><code>@Controller\npublic class UserController {\n    @RequestMapping(\"/show\")\n    public String show(){\n        System.out.println(\"show \u6267\u884c....\");\n        //\u89c6\u56fe\u8df3\u8f6c\u5230index.jsp\n        return \"/index.jsp\";\n    }\n}\n</code></pre> <ul> <li>\u5728web.xml\u4e2d\u914d\u7f6eSpringMVC\u7684\u524d\u7aef\u63a7\u5236\u5668ServletDispatcher</li> </ul> <pre><code>    &lt;servlet&gt;\n        &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n        &lt;!--\u6307\u5b9aspringMVC\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e--&gt;\n        &lt;init-param&gt;\n            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n            &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;\n        &lt;/init-param&gt;\n        &lt;!--\u670d\u52a1\u5668\u542f\u52a8\u5c31\u521b\u5efa--&gt;\n        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;\n    &lt;/servlet&gt;\n    &lt;servlet-mapping&gt;\n        &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;\n        &lt;url-pattern&gt;/&lt;/url-pattern&gt;\n    &lt;/servlet-mapping&gt;\n</code></pre> <ul> <li>\u521b\u5efaspringMVC\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 spring-mvc.xml\uff0c\u5e76\u914d\u7f6eweb\u5c42\u7ec4\u4ef6\u626b\u63cf</li> </ul> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\n    &lt;context:component-scan base-package=\"com.ysh.controller\" /&gt;\n\n&lt;/beans&gt;\n</code></pre>"},{"location":"Spring/Spring-MVC/#controller\u4e2d\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684bean","title":"Controller\u4e2d\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684Bean","text":"<ul> <li>\u521b\u5efa\u4e00\u4e2aapplicationContext.xml\u6587\u4ef6</li> </ul> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\n    &lt;context:component-scan base-package=\"com.ysh\"&gt;\n        &lt;context:exclude-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\"/&gt;\n    &lt;/context:component-scan&gt;\n\n&lt;/beans&gt;\n</code></pre> <ul> <li>\u5728web.xml\u4e2d\u914d\u7f6eContextLoaderListener</li> </ul> <pre><code>&lt;!-- \u914d\u7f6eSpring\u5bb9\u5668 --&gt;\n&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;classpath:application.xml&lt;/param-value&gt;\n&lt;/context-param&gt;\n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n</code></pre> <ul> <li> <p>\u7f16\u5199Service\u7c7b\u5e76\u4f7f\u7528<code>@Service</code>\u6ce8\u89e3\u6807\u8bb0</p> </li> <li> <p>\u4f7f\u7528@Autowried\u6ce8\u5165\u5373</p> </li> </ul>"},{"location":"Spring/Spring-MVC/#spring-mvc\u5173\u952e\u7ec4\u4ef6\u6d45\u6790","title":"Spring MVC\u5173\u952e\u7ec4\u4ef6\u6d45\u6790","text":"\u7ec4\u4ef6 \u63cf\u8ff0 \u5e38\u7528\u7c7b \u5904\u7406\u5668\u6620\u5c04\u5668\uff1aHandlerMapping \u5339\u914d\u6620\u5c04\u8def\u5f84\u5bf9\u5e94\u7684Handler\uff0c\u8fd4\u56de\u53ef\u6267\u884c\u7684\u5904\u7406\u5668\u94fe\u5bf9\u8c61HandlerExecutionChain\u5bf9\u8c61 RequestMappingHandlerMapping \u5904\u7406\u5668\u9002\u914d\u5668\uff1aHandlerAdapter \u5339\u914dHandlerExecutionChain\u5bf9\u5e94\u7684\u9002\u914d\u5668\u8fdb\u884c\u5904\u7406\u5668\u8c03\u7528\uff0c\u8fd4\u56de\u89c6\u56fe\u6a21\u578b\u5bf9\u8c61 RequestMappingHandlerAdapter \u89c6\u56fe\u89e3\u6790\u5668\uff1aViewResolver \u5bf9\u89c6\u56fe\u6a21\u578b\u5bf9\u8c61\u8fdb\u884c\u89e3\u6790 InternalResourceViewResolver <ul> <li> <p>SpringMVC\u7684\u9ed8\u8ba4\u7ec4\u4ef6\uff0cSpringMVC\u5728\u524d\u7aef\u63a7\u5236\u5668 <code>DispatcherServlet</code>\u52a0\u8f7d\u65f6\uff0c\u5c31\u4f1a\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5728\u8fdb\u884c\u521d\u59cb\u5316\u65f6\uff0c\u5c31\u4f1a\u52a0\u8f7dSpringMVC\u9ed8\u8ba4\u6307\u5b9a\u7684\u4e00\u4e9b\u7ec4\u4ef6\uff0c\u8fd9\u4e9b\u9ed8\u8ba4\u7ec4\u4ef6\u914d\u7f6e\u5728\u4e0espring-webmvc.jar\u5305\u4e0b\u7684 <code>org\\springframework\\web\\servlet\\DispatcherServlet.properties</code></p> </li> <li> <p>\u5728DispatcherServlet\u4e2d\u5b58\u5728\u96c6\u5408\u5b58\u50a8\u7740\u8fd9\u4e9b\u7ec4\u4ef6\uff0cSpringMVC\u7684\u9ed8\u8ba4\u7ec4\u4ef6\u4f1a\u5728 DispatcherServlet \u4e2d\u8fdb\u884c\u7ef4\u62a4\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u5b58\u50a8\u5728\u4e0eSpringMVC\u7684\u5bb9\u5668\u4e2d</p> </li> <li> <p>\u5982\u679c\u4e0d\u60f3\u4f7f\u7528\u9ed8\u8ba4\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5c06\u66ff\u4ee3\u65b9\u6848\u4f7f\u7528Spring Bean\u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e,<code>&lt;bean /&gt;</code></p> </li> </ul>"},{"location":"Spring/Spring-MVC/#spring-mvc\u7684\u8bf7\u6c42\u5904\u7406","title":"Spring MVC\u7684\u8bf7\u6c42\u5904\u7406","text":""},{"location":"Spring/Spring-MVC/#\u8bf7\u6c42\u6620\u5c04\u8def\u5f84\u7684\u914d\u7f6e","title":"\u8bf7\u6c42\u6620\u5c04\u8def\u5f84\u7684\u914d\u7f6e","text":"<p>\u914d\u7f6e\u6620\u5c04\u8def\u5f84\uff0c\u6620\u5c04\u5904\u7406\u5668\u624d\u80fd\u627e\u5230Controller\u7684\u65b9\u6cd5\u8d44\u6e90\uff0c\u76ee\u524d\u4e3b\u6d41\u6620\u5c04\u8def\u5f84\u914d\u7f6e\u65b9\u5f0f\u5c31\u662f<code>@RequestMapping</code></p> \u6ce8\u89e3 \u4f5c\u7528 \u4f7f\u7528\u4f4d\u7f6e @RequestMapping \u8bbe\u7f6e\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u8bbf\u95ee\u8d44\u6e90\u8def\u5f84\uff0c\u53ef\u4ee5\u63a5\u6536\u4efb\u4f55\u8bf7\u6c42\u4f7f\u7528\u4f4d\u7f6e \u65b9\u6cd5\u548c\u7c7b\u4e0a @GetMapping \u8bbe\u7f6e\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u8bbf\u95ee\u8d44\u6e90\u8def\u5f84\uff0c\u53ef\u4ee5\u63a5\u6536GET\u8bf7\u6c42 \u65b9\u6cd5\u548c\u7c7b\u4e0a @PostMapping \u8bbe\u7f6e\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u8bbf\u95ee\u8d44\u6e90\u8def\u5f84\uff0c\u53ef\u4ee5\u63a5\u6536POST\u8bf7\u6c42 \u65b9\u6cd5\u548c\u7c7b\u4e0a <p>@RequestMapping\u6ce8\u89e3\uff0c\u4e3b\u8981\u4f7f\u7528\u5728\u63a7\u5236\u5668\u7684\u65b9\u6cd5\u4e0a\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\u8bbf\u95ee\u8d44\u6e90\u8def\u5f84\uff0c\u5e38\u7528\u7684\u5c5e\u6027\u6709value\u3001path\u3001method\u3001headers\u3001params\u7b49\u3002</p> <p>value\u548cpath\u6307\u5b9a\u5355\u4e2a\u6216\u591a\u4e2a\u8def\u5f84</p> <pre><code>@RequestMapping(value = \"/show\")//\u4f7f\u7528value\u5c5e\u6027\u6307\u5b9a\u4e00\u4e2a\u8bbf\u95ee\u8def\u5f84\npublic String show(){}\n\n@RequestMapping(value = {\"/show\",\"/haohao\",\"/abc\"})//\u4f7f\u7528value\u5c5e\u6027\u6307\u5b9a\u591a\u4e2a\u8bbf\u95ee\u8def\u5f84\npublic String show(){}\n\n@RequestMapping(path = \"/show\")//\u4f7f\u7528path\u5c5e\u6027\u6307\u5b9a\u4e00\u4e2a\u8bbf\u95ee\u8def\u5f84\npublic String show(){}\n\n@RequestMapping(path = {\"/show\",\"/haohao\",\"/abc\"})//\u4f7f\u7528path\u5c5e\u6027\u6307\u5b9a\u591a\u4e2a\u8bbf\u95ee\u8def\u5f84\npublic String show(){}\n\n@RequestMapping(\"/show\")//\u5982\u679c\u53ea\u8bbe\u7f6e\u8bbf\u95ee\u8def\u5f84\u65f6\uff0cvalue\u548cpath\u53ef\u4ee5\u7701\u7565\npublic String show(){}\n\n@RequestMapping({\"/show\",\"/haohao\",\"/abc\"})\npublic String show(){}\n</code></pre> <p>method\u5c5e\u6027\uff0c\u9650\u5b9a\u8bbf\u95ee\u65b9\u5f0f</p> <pre><code>//\u8bf7\u6c42\u5730\u5740\u662f /show,\u4e14\u8bf7\u6c42\u65b9\u5f0f\u5fc5\u987b\u662fPOST\u624d\u80fd\u5339\u914d\u6210\u529f\n@RequestMapping(value = \"/show\",method = RequestMethod.POST)\npublic String show(){}\n</code></pre> <p>method\u7684\u5c5e\u6027\u503c\u662f\u4e00\u4e2a\u679a\u4e3e\u7c7b\u578b\uff0c\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>public enum RequestMethod {\n    GET,\n    HEAD,\n    POST,\n    PUT,\n    PATCH,\n    DELETE,\n    OPTIONS,\n    TRACE;\n\n    private RequestMethod() {\n    }\n}\n</code></pre> <p>@GetMapping\uff0c\u5f53\u8bf7\u6c42\u65b9\u5f0f\u662fGET\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528@GetMapping\u66ff\u4ee3@RequestMapping</p> <p>@PostMapping\uff0c\u5f53\u8bf7\u6c42\u65b9\u5f0f\u662fPOST\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528@PostMapping\u66ff\u4ee3@RequestMapping</p> <p>\u4ee5\u4e0a\u6ce8\u89e3\u4f7f\u7528\u5728\u7c7b\u4e0a\u540e\uff0c\u8be5\u7c7b\u6240\u6709\u65b9\u6cd5\u90fd\u516c\u7528\u8be5\u6ce8\u89e3\u8bbe\u7f6e\u7684\u5c5e\u6027\uff0c\u8bbf\u95ee\u8def\u5f84\u5219\u4e3a\u7c7b\u4e0a\u7684<code>\u6620\u5c04\u5730\u5740+\u65b9\u6cd5\u4e0a</code>\u7684\u6620\u5c04\u5730\u5740</p>"},{"location":"Spring/Spring-MVC/#\u8bf7\u6c42\u6570\u636e\u7684\u63a5\u6536","title":"\u8bf7\u6c42\u6570\u636e\u7684\u63a5\u6536","text":""},{"location":"Spring/Spring-MVC/#\u4e00\u822c\u6570\u636e","title":"\u4e00\u822c\u6570\u636e","text":"<ul> <li>\u5f53\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u6570\u636e\u662f\u666e\u901a\u952e\u503c\u5bf9\u5f62\u5f0f\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528\u540c\u540d\u5f62\u53c2\u63a5\u6536\u5373\u53ef</li> </ul> <p>\u8bf7\u6c42\uff1a<code>http://localhost/mvc/hello?name=lisi</code></p> <pre><code>    @GetMapping(\"hello\")\n    public String hello(String name){\n        System.out.println(name);\n        return \"OK\";\n    }\n    // \u63a7\u5236\u53f0\u8f93\u51fa lisi\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5f53\u8bf7\u6c42\u53c2\u6570\u7684\u540d\u79f0\u4e0e\u65b9\u6cd5\u53c2\u6570\u540d\u4e0d\u4e00\u81f4\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528@RequestParam\u6ce8\u89e3\u8fdb\u884c\u6807\u6ce8</p> <p>Example</p> <p>\u8bf7\u6c42\uff1a<code>http://localhost/mvc/hello?username=lisi</code></p> <pre><code>    @GetMapping(\"hello\")\n    public String hello(@RequestParam(value = \"username\",required = true) String name){\n        System.out.println(name);\n        return \"OK\";\n    }\n</code></pre> <p></p> <ul> <li>\u63a5\u6536JavaBean\u5c5e\u6027\u6570\u636e\uff0c\u5355\u4e2aJavaBean\u6570\u636e\uff1a\u63d0\u4ea4\u7684\u53c2\u6570\u540d\u79f0\u53ea\u8981\u4e0eJava\u7684\u5c5e\u6027\u540d\u4e00\u81f4\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u81ea\u52a8\u5c01\u88c5</li> </ul> <p>Note</p> <p>\u5d4c\u5957JavaBean\u6570\u636e\uff1a\u63d0\u4ea4\u7684\u53c2\u6570\u540d\u79f0\u7528<code>.</code>\u63cf\u8ff0\u5d4c\u5957\u5bf9\u8c61\u7684\u5c5e\u6027\u5173\u7cfb\u5373\u53ef eg\uff1aaddress.city</p> <p></p> <ul> <li>\u63a5\u6536\u6570\u7ec4\u6216\u96c6\u5408\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u4f20\u9012\u591a\u4e2a\u540c\u540d\u53c2\u6570\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u63a5\u6536</li> </ul> <p>Note</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5355\u5217\u96c6\u5408\u63a5\u6536\uff0c\u4f46\u662f\u9700\u8981\u4f7f\u7528<code>@RequestParam</code>\u8fdb\u884c\u4fee\u9970</p> <p></p> <ul> <li>\u63a5\u6536\u6570\u7ec4\u6216\u96c6\u5408\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u4f20\u9012\u591a\u4e2a\u4e0d\u540c\u540d\u53c2\u6570\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 Map \u8fdb\u884c\u63a5\u6536\uff0c\u540c\u6837\u9700\u8981\u7528<code>@RequestParam</code> \u8fdb\u884c\u4fee\u9970</li> </ul> <p></p> <ul> <li>\u63a5\u6536Json\u6570\u636e\u683c\u5f0f\u6570\u636e\uff0cJson\u6570\u636e\u90fd\u662f\u4ee5\u8bf7\u6c42\u4f53\u7684\u65b9\u5f0f\u63d0\u4ea4\u7684\uff0c\u4e14\u4e0d\u662f\u539f\u59cb\u7684\u952e\u503c\u5bf9\u683c\u5f0f\u7684\uff0c\u6240\u4ee5\u8981\u4f7f\u7528<code>@RequestBody</code>\u6ce8\u89e3\u6574\u4f53\u63a5\u6536\u8be5\u6570\u636e\u3002(\u63a5\u6536\u5230\u7684\u6570\u636e\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b)</li> </ul> <p>Note</p> <p>\u4f7f\u7528Json\u5e8f\u5217\u5316\u5de5\u5177\uff08\u5982jackson\uff09\u5c06Json\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8f6c\u5316\u4e3aJavaBean\u8fdb\u884c\u64cd\u4f5c</p> <p>\u914d\u7f6e<code>RequestMappingHandlerAdapter</code>\uff0c\u6307\u5b9a\u6d88\u606f\u8f6c\u6362\u5668\uff0c\u5c31\u4e0d\u9700\u8981\u624b\u52a8\u8f6c\u6362json\u683c\u5f0f\u5b57\u7b26\u4e32\u4e86(\u4ecd\u9700<code>@RequestBody</code>\u6ce8\u89e3)</p> <pre><code>&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\"&gt;\n    &lt;property name=\"messageConverters\"&gt;\n        &lt;list&gt;\n            &lt;bean class=\"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter\"/&gt;\n        &lt;/list&gt;\n    &lt;/property&gt;\n&lt;/bean&gt;\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u63a5\u6536restful\u98ce\u683c\u6570\u636e","title":"\u63a5\u6536Restful\u98ce\u683c\u6570\u636e","text":"<p>Rest(Representational State Transfer)\u8868\u8c61\u5316\u72b6\u6001\u8f6c\u53d8\uff08\u8868\u8ff0\u6027\u72b6\u6001\u8f6c\u53d8\uff09\uff0c\u57282000\u5e74\u88ab\u63d0\u51fa\uff0c\u57fa\u4e8eHTTP\u3001URI\u3001xml\u3001JSON\u7b49\u6807\u51c6\u548c\u534f\u8bae\uff0c\u652f\u6301\u8f7b\u91cf\u7ea7\u3001\u8de8\u5e73\u53f0\u3001\u8de8\u8bed\u8a00\u7684\u67b6\u6784\u8bbe\u8ba1\u3002\u662fWeb\u670d\u52a1\u7684\u4e00\u79cd\u65b0\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u98ce\u683c\u548c\u5f00\u53d1\u65b9\u5f0f\u3002</p> <p>Restful\u98ce\u683c\u7684\u8bf7\u6c42\uff0c\u5e38\u89c1\u7684\u89c4\u5219\u6709\u5982\u4e0b\u4e09\u70b9\uff1a</p> \u6a21\u5757 URI\u8d44\u6e90 \u7528\u6237\u6a21\u5757 <code>http://localhost/user</code> \u5546\u54c1\u6a21\u5757 <code>http://localhost/product</code> \u8d26\u6237\u6a21\u5757 <code>http://localhost/account</code> \u65e5\u5fd7\u6a21\u5757 <code>http://localhost/log</code> <ul> <li>\u7528\u8bf7\u6c42\u65b9\u5f0f\u8868\u793a\u6a21\u5757\u5177\u4f53\u4e1a\u52a1\u52a8\u4f5c\uff0c\u4f8b\u5982\uff1aGET\u8868\u793a\u67e5\u8be2\u3001POST\u8868\u793a\u63d2\u5165\u3001PUT\u8868\u793a\u66f4\u65b0\u3001DELETE\u8868\u793a\u5220\u9664</li> </ul> <p></p> <ul> <li>\u7528HTTP\u54cd\u5e94\u72b6\u6001\u7801\u8868\u793a\u7ed3\u679c\uff0c\u56fd\u5185\u5e38\u7528\u7684\u54cd\u5e94\u5305\u62ec\u4e09\u90e8\u5206\uff1a\u72b6\u6001\u7801\u3001\u72b6\u6001\u4fe1\u606f\u3001\u54cd\u5e94\u6570\u636e <pre><code>{\n  \"code\":200,\n  \"message\":\"\u6210\u529f\",\n  \"data\":{\n    \"username\":\"ysh\",\n    \"age\":18\n\n  }\n}\n</code></pre></li> </ul> <p>\u63a5\u6536Restful\u98ce\u683c\u6570\u636e\uff0cRestful\u8bf7\u6c42\u6570\u636e\u4e00\u822c\u4f1a\u5728URL\u5730\u5740\u4e0a\u643a\u5e26\uff0c\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3 <code>@PathVariable</code>(\u5360\u4f4d\u7b26\u53c2\u6570\u540d\u79f0)</p> <pre><code>@PostMapping(\"/user/{id}\")\n public String findUserById(@PathVariable(\"id\") Integer id){\n    System.out.println(id);\n    return \"/index.jsp\";\n }\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u6587\u4ef6\u4e0a\u4f20","title":"\u6587\u4ef6\u4e0a\u4f20","text":"<p>\u63a5\u6536\u6587\u4ef6\u4e0a\u4f20\u7684\u6570\u636e\uff0c\u5bf9\u6587\u4ef6\u4e0a\u4f20\u7684\u8868\u5355\u9700\u8981\u4e00\u5b9a\u7684\u8981\u6c42\uff1a</p> <ul> <li> <p>\u8868\u5355\u7684\u63d0\u4ea4\u65b9\u5f0f\u5fc5\u987b\u662fPOST </p> </li> <li> <p>\u8868\u5355\u7684enctype\u5c5e\u6027\u5fc5\u987b\u662f<code>multipart/form-data</code></p> </li> <li> <p>\u6587\u4ef6\u4e0a\u4f20\u9879\u9700\u8981\u6709name\u5c5e\u6027 <pre><code>&lt;form action=\"\" enctype=\"multipart/form-data\"&gt;\n &lt;input type=\"file\" name=\"myFile\"&gt;\n&lt;/form&gt;\n</code></pre></p> </li> </ul> <p>\u670d\u52a1\u5668\u7aef\uff0c\u7531\u4e8e\u6620\u5c04\u5668\u9002\u914d\u5668\u9700\u8981\u6587\u4ef6\u4e0a\u4f20\u89e3\u6790\u5668\uff0c\u800c\u8be5\u89e3\u6790\u5668\u9ed8\u8ba4\u672a\u88ab\u6ce8\u518c\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u6ce8\u518c</p> <pre><code>&lt;!--\u914d\u7f6e\u6587\u4ef6\u4e0a\u4f20\u89e3\u6790\u5668\uff0c\u6ce8\u610f\uff1aid\u662f\u56fa\u5b9a\u5199\u6cd5--&gt;\n&lt;bean id=\"multipartResolver\" class=\"org.springframework.web.multipart.commons.CommonsMultipartResolver\"&gt;\n    &lt;property name=\"defaultEncoding\" value=\"UTF-8\"/&gt;&lt;!--\u6587\u4ef6\u7684\u7f16\u7801\u683c\u5f0f \u9ed8\u8ba4\u662fISO8859-1--&gt;\n    &lt;property name=\"maxUploadSizePerFile\" value=\"1048576\"/&gt;&lt;!--\u4e0a\u4f20\u7684\u6bcf\u4e2a\u6587\u4ef6\u9650\u5236\u7684\u5927\u5c0f \u5355\u4f4d\u5b57\u8282--&gt;\n    &lt;property name=\"maxUploadSize\" value=\"3145728\"/&gt;&lt;!--\u4e0a\u4f20\u6587\u4ef6\u7684\u603b\u5927\u5c0f--&gt;\n    &lt;property name=\"maxInMemorySize\" value=\"1048576\"/&gt;&lt;!--\u4e0a\u4f20\u6587\u4ef6\u7684\u7f13\u5b58\u5927\u5c0f--&gt;\n&lt;/bean&gt;\n</code></pre> <p>CommonsMultipartResolver\u5e95\u5c42\u4f7f\u7528\u7684\u662fApache\u7684Common-fileuplad\u7b49\u5de5\u5177\u7684API\u8fdb\u884c\u7684\u6587\u4ef6\u4e0a\u4f20\uff0c\u6240\u4ee5\u8fd8\u9700\u5f15\u5165\u4f9d\u8d56 <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;\n    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;\n    &lt;version&gt;1.4&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>\u4f7f\u7528<code>MultipartFile</code>\u7c7b\u578b\u63a5\u6536\u4e0a\u4f20\u6587\u4ef6 <pre><code>@PostMapping(\"/fileUpload\")\npublic String fileUpload(@RequestBody MultipartFile myFile) throws IOException {\n    System.out.println(myFile);\n    //\u83b7\u5f97\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u6d41\u5bf9\u8c61\n    InputStream inputStream = myFile.getInputStream();\n    //\u4f7f\u7528commons-io\u5b58\u50a8\u6587\u4ef6\n    FileOutputStream outputStream = new\n            FileOutputStream(\"D:\\\\\"+myFile.getOriginalFilename());\n    IOUtils.copy(inputStream,outputStream);\n    //\u5173\u95ed\u8d44\u6e90\n    inputStream.close();\n    outputStream.close();\n    return \"/index.jsp\";\n}\n</code></pre></p> <p>Tip</p> <p>\u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528MultipartFile[]\u6570\u7ec4\uff0c\u6216\u8005\u4f7f\u7528\u591a\u4e2aMultipartFile\u53c2\u6570</p>"},{"location":"Spring/Spring-MVC/#\u83b7\u53d6\u8bf7\u6c42\u5934\u6570\u636e","title":"\u83b7\u53d6\u8bf7\u6c42\u5934\u6570\u636e","text":"<p>\u63a5\u6536\u6307\u5b9a\u540d\u79f0\u7684HTTP\u8bf7\u6c42\u5934\u6570\u636e --&gt; <code>@RequestHeader</code> <pre><code>@GetMapping(\"/headers\")\npublic String headers(@RequestHeader(\"Accept-Encoding\") String acceptEncoding){\n    System.out.println(\"Accept-Encoding:\"+acceptEncoding);\n    return \"/index.jsp\";\n}\n</code></pre></p> <p>\u63a5\u6536\u6240\u6709\u7684\u8bf7\u6c42\u5934\u4fe1\u606f <pre><code>@GetMapping(\"/headersMap\")\npublic String headersMap(@RequestHeader Map&lt;String,String&gt; map){\n    map.forEach((k,v)-&gt;{\n        System.out.println(k+\":\"+v);\n    });\n    return \"/index.jsp\";\n}\n</code></pre></p> <p>\u83b7\u5f97\u5ba2\u6237\u7aef\u643a\u5e26\u7684Cookie\u6570\u636e --&gt; <code>@CookieValue</code></p> <pre><code>@GetMapping(\"/cookies\")\npublic String cookies(@CookieValue(value = \"JSESSIONID\",defaultValue = \"\") String jsessionid){\n    System.out.println(jsessionid);\n    return \"/index.jsp\";\n}\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u83b7\u5f97\u8f6c\u53d1request\u57df\u4e2d\u6570\u636e","title":"\u83b7\u5f97\u8f6c\u53d1Request\u57df\u4e2d\u6570\u636e","text":"<p>\u5728\u8fdb\u884c\u8d44\u6e90\u4e4b\u95f4\u8f6c\u53d1\u65f6\uff0c\u6709\u65f6\u9700\u8981\u5c06\u4e00\u4e9b\u53c2\u6570\u5b58\u50a8\u5230request\u57df\u4e2d\u643a\u5e26\u7ed9\u4e0b\u4e00\u4e2a\u8d44\u6e90</p> <pre><code>@GetMapping(\"/request1\")\npublic String request1(HttpServletRequest request){\n    //\u5b58\u50a8\u6570\u636e\n    request.setAttribute(\"username\",\"haohao\");\n    return \"forward:/request2\";\n}\n\n@GetMapping(\"/request2\")\npublic String request2(@RequestAttribute(\"username\") String username){\n    System.out.println(username);\n    return \"/index.jsp\";\n}\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u8bf7\u6c42\u53c2\u6570\u4e71\u7801\u7684\u89e3\u51b3","title":"\u8bf7\u6c42\u53c2\u6570\u4e71\u7801\u7684\u89e3\u51b3","text":"<p>\u4f7f\u7528Spring\u5df2\u7ecf\u63d0\u4f9b\u597d\u7684<code>CharacterEncodingFilter</code>\u6765\u8fdb\u884c\u7f16\u7801\u8fc7\u6ee4 <pre><code>&lt;!--\u914d\u7f6e\u5168\u5c40\u7684\u7f16\u7801\u8fc7\u6ee4\u5668--&gt;\n&lt;filter&gt;\n    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;\n    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;encoding&lt;/param-name&gt;\n        &lt;param-value&gt;UTF-8&lt;/param-value&gt;\n    &lt;/init-param&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;\n    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n</code></pre></p>"},{"location":"Spring/Spring-MVC/#javaweb\u5e38\u7528\u5bf9\u8c61\u83b7\u53d6","title":"Javaweb\u5e38\u7528\u5bf9\u8c61\u83b7\u53d6","text":"<p>\u6709\u65f6\u5728Controller\u65b9\u6cd5\u4e2d\u9700\u8981\u7528\u5230Javaweb\u7684\u539f\u751f\u5bf9\u8c61\uff0c\u4f8b\u5982\uff1aRequest\u3001Response\u7b49</p> <p>\u53ea\u9700\u8981\u5c06\u9700\u8981\u7684\u5bf9\u8c61\u4ee5\u5f62\u53c2\u7684\u5f62\u5f0f\u5199\u5728\u65b9\u6cd5\u4e0a\uff0cSpringMVC\u6846\u67b6\u5728\u8c03\u7528Controller\u65b9\u6cd5\u65f6\uff0c\u4f1a\u81ea\u52a8\u4f20\u9012\u5b9e\u53c2</p> <pre><code>@GetMapping(\"/javawebObject\")\npublic String javawebObject(HttpServletRequest request, HttpServletResponse response, HttpSession session){\n    return null;\n}\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u8bf7\u6c42\u9759\u6001\u8d44\u6e90","title":"\u8bf7\u6c42\u9759\u6001\u8d44\u6e90","text":"<p>\u9759\u6001\u8d44\u6e90\u8bf7\u6c42\u5931\u6548\u7684\u539f\u56e0\uff0c\u5f53DispatcherServlet\u7684\u6620\u5c04\u8def\u5f84\u914d\u7f6e\u4e3a / \u7684\u65f6\u5019\uff0c\u90a3\u4e48\u5c31\u8986\u76d6\u7684Tomcat\u5bb9\u5668\u9ed8\u8ba4\u7684Servlet</p> <p>\u5728Tomcat\u7684config\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a web.xml \u662f\u5bf9\u6240\u6709\u7684web\u9879\u76ee\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u5176\u4e2d\u6709\u5982\u4e0b\u914d\u7f6e <pre><code>&lt;servlet&gt;\n    &lt;servlet-name&gt;default&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;\n    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;default&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n</code></pre></p> <p>\u539f\u56e0</p> <p>url-pattern\u914d\u7f6e\u4e3a / \u7684Servlet\u79f0\u4e3a\u7f3a\u7701Servlet\uff0c\u4f5c\u7528\u662f\u5f53\u5176\u4ed6Servlet\u90fd\u5339\u914d\u4e0d\u6210\u529f\u65f6\uff0c\u5c31\u4f7f\u7528\u7f3a\u7701Servlet\u3002</p> <p>\u9759\u6001\u8d44\u6e90\u7531\u4e8e\u6ca1\u6709\u5339\u914d\u6210\u529f\u7684Servlet\uff0c\u6240\u4ee5\u901a\u8fc7\u7f3a\u7701Servlet\uff0c\u8be5Servlet\u5177\u5907\u4e8c\u6b21\u5339\u914d\u9759\u6001\u8d44\u6e90\u7684\u529f\u80fd\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u914d\u7f6eDispatcherServlet\u540e\u5c31\u5c06\u5176\u8986\u76d6\u4e86\uff0c\u800cDispatcherServlet\u4f1a\u5c06\u8bf7\u6c42\u7684\u9759\u6001\u8d44\u6e90\u7684\u540d\u79f0\u5f53\u6210Controller\u7684\u6620\u5c04\u8def\u5f84\u53bb\u5339\u914d\uff0c\u5bfc\u81f4\u9759\u6001\u8d44\u6e90\u8bbf\u95ee\u4e0d\u6210\u529f\u3002</p> <p>\u4e09\u79cd\u89e3\u51b3\u65b9\u6848</p> <ul> <li>\u53ef\u4ee5\u518d\u6b21\u6fc0\u6d3bTomcat\u7684DefaultServlet\uff0cServlet\u7684url-pattern\u7684\u5339\u914d\u4f18\u5148\u7ea7\u662f\uff1a\u7cbe\u786e\u5339\u914d&gt;\u76ee\u5f55\u5339\u914d&gt;\u6269\u5c55\u540d\u5339\u914d&gt;\u7f3a\u7701\u5339\u914d\uff0c\u6240\u4ee5\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e2a\u76ee\u5f55\u4e0b\u6216\u67d0\u4e2a\u6269\u5c55\u540d\u7684\u8d44\u6e90\u4f7f\u7528DefaultServlet\u8fdb\u884c\u89e3\u6790</li> </ul> <pre><code>&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;default&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/img/*&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;default&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n</code></pre> <ul> <li>\u5728spring-mvc.xml\u4e2d\u914d\u7f6e\u9759\u6001\u8d44\u6e90\u6620\u5c04\uff0c\u5339\u914d\u6620\u5c04\u8def\u5f84\u7684\u8bf7\u6c42\u5230\u6307\u5b9a\u7684\u4f4d\u7f6e\u53bb\u5339\u914d\u8d44\u6e90</li> </ul> <pre><code>&lt;!-- mapping\u662f\u6620\u5c04\u8d44\u6e90\u8def\u5f84\uff0clocation\u662f\u5bf9\u5e94\u8d44\u6e90\u6240\u5728\u7684\u4f4d\u7f6e --&gt;\n&lt;mvc:resources mapping=\"/img/*\" location=\"/img/\"/&gt;\n&lt;mvc:resources mapping=\"/css/*\" location=\"/css/\"/&gt;\n&lt;mvc:resources mapping=\"/css/*\" location=\"/js/\"/&gt;\n&lt;mvc:resources mapping=\"/html/*\" location=\"/html/\"/&gt;\n</code></pre> <ul> <li>\u5728spring-mvc.xml\u4e2d\u914d\u7f6e\uff0c\u8be5\u65b9\u5f0f\u6ce8\u518c\u4e86\u4e00\u4e2aDefaultServletHttpRequestHandler\uff0c\u9759\u6001\u8d44\u6e90\u7684\u8bbf\u95ee\u7531\u8be5\u5904\u7406\u5668\u5904\u7406\uff0c\u8fd9\u4e5f\u662f\u5f00\u53d1\u4e2d\u4f7f\u7528\u6700\u591a\u7684 <pre><code>&lt;mvc:default-servlet-handler/&gt;\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u6ce8\u89e3\u9a71\u52a8","title":"\u6ce8\u89e3\u9a71\u52a8<code>&lt;mvc:annotation-driven/&gt;</code>","text":"<p>\u901a\u8fc7\u9759\u6001\u8d44\u6e90\u914d\u7f6e\u7684\u7b2c\u4e8c\u7b2c\u4e09\u79cd\u65b9\u5f0f\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u9759\u6001\u8d44\u6e90\u4e86\uff0c\u4f46\u662fController\u53c8\u65e0\u6cd5\u8bbf\u95ee\u4e86\uff0c\u9519\u8bef\u7801404\uff0c\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u8d44\u6e90</p> <p>\u539f\u56e0\u5206\u6790</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u662f\u901a\u8fc7SpringMVC\u53bb\u89e3\u6790mvc\u547d\u540d\u7a7a\u95f4\u4e0b\u7684resources\u6807\u7b7e\u5b8c\u6210\u7684\u9759\u6001\u8d44\u6e90\u89e3\u6790\uff0c\u7b2c\u4e09\u79cd\u65b9\u5f0f\u5f0f\u901a\u8fc7SpringMVC\u53bb\u89e3\u6790mvc\u547d\u540d\u7a7a\u95f4\u4e0b\u7684default-servlet-handler\u6807\u7b7e\u5b8c\u6210\u7684\u9759\u6001\u8d44\u6e90\u89e3\u6790\uff0c\u6839\u636e\u524d\u9762\u6240\u5b66\u4e60\u7684\u81ea\u5b9a\u4e49\u547d\u540d\u7a7a\u95f4\u7684\u89e3\u6790\u7684\u77e5\u8bc6\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e0d\u7ba1\u662f\u4ee5\u4e0a\u54ea\u79cd\u65b9\u5f0f\uff0c\u6700\u7ec8\u90fd\u4f1a\u6ce8\u518c<code>SimpleUrlHandlerMapping</code></p> <p>\u4e00\u65e6SpringMVC\u5bb9\u5668\u4e2d\u5b58\u5728 HandlerMapping \u7c7b\u578b\u7684\u7ec4\u4ef6\u65f6\uff0c\u524d\u7aef\u63a7\u5236\u5668DispatcherServlet\u5728\u8fdb\u884c\u521d\u59cb\u5316\u65f6\uff0c\u5c31\u4f1a\u4ece\u5bb9\u5668\u4e2d\u83b7\u5f97HandlerMapping \uff0c\u4e0d\u518d\u52a0\u8f7d dispatcherServlet.properties\u4e2d\u9ed8\u8ba4\u5904\u7406\u5668\u6620\u5c04\u5668\u7b56\u7565\uff0c\u90a3\u4e5f\u5c31\u610f\u5473\u7740<code>RequestMappingHandlerMapping</code>\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u3002(\u5373Spring\u65e0\u6cd5\u89e3\u6790Controller\u4e2d\u7684Mapping)</p> <p>\u89e3\u51b3\u529e\u6cd5</p> <p>\u53ef\u4ee5\u624b\u52a8\u6ce8\u518cHandler,\u4f46\u6bd4\u8f83\u9ebb\u70e6</p> <p>\u63a8\u8350\u4f7f\u7528<code>&lt;mvc:annotation-driven/&gt;</code>\u8be5\u6807\u7b7e\u4f1a\u5e2e\u6211\u4eec\u6ce8\u518cRequestMappingHandlerMapping\u3001\u6ce8\u518cRequestMappingHandlerAdapter\u5e76\u6ce8\u5165Json\u6d88\u606f\u8f6c\u6362\u5668\u7b49 <pre><code> &lt;!--mvc\u6ce8\u89e3\u9a71\u52a8--&gt;\n &lt;mvc:annotation-driven/&gt;\n &lt;!--\u914d\u7f6eDefaultServletHttpRequestHandler--&gt;\n &lt;mvc:default-servlet-handler/&gt;\n</code></pre></p>"},{"location":"Spring/Spring-MVC/#springmvc\u7684\u54cd\u5e94\u5904\u7406","title":"SpringMVC\u7684\u54cd\u5e94\u5904\u7406","text":"<p>\u54cd\u5e94\u6570\u636e\u4e3b\u8981\u5206\u4e3a\u4e24\u79cd\u5f62\u5f0f\uff1a</p> <ul> <li> <p>\u4f20\u7edf\u540c\u6b65\u65b9\u5f0f\uff1a\u51c6\u5907\u597d\u6a21\u578b\u6570\u636e\uff0c\u518d\u8df3\u8f6c\u5230\u6267\u884c\u9875\u9762\u8fdb\u884c\u5c55\u793a\uff0c\u6b64\u65b9\u5f0f\u4f7f\u7528\u8d8a\u6765\u8d8a\u5c11\u4e86\uff0c\u57fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u4e00\u4e9b\u65e7\u9879\u76ee\u8fd8\u5728\u4f7f\u7528\uff1b</p> </li> <li> <p>\u524d\u540e\u7aef\u5206\u79bb\u5f02\u6b65\u65b9\u5f0f\uff1a\u524d\u7aef\u4f7f\u7528Ajax\u6280\u672f+Restful\u98ce\u683c\u4e0e\u670d\u52a1\u7aef\u8fdb\u884cJson\u683c\u5f0f\u4e3a\u4e3b\u7684\u6570\u636e\u4ea4\u4e92\uff0c\u76ee\u524d\u5e02\u573a\u4e0a\u51e0\u4e4e\u90fd\u662f\u6b64\u65b9\u5f0f\u3002</p> </li> </ul>"},{"location":"Spring/Spring-MVC/#\u4f20\u7edf\u540c\u6b65\u4e1a\u52a1\u6570\u636e\u54cd\u5e94","title":"\u4f20\u7edf\u540c\u6b65\u4e1a\u52a1\u6570\u636e\u54cd\u5e94","text":"<p>\u4f20\u7edf\u540c\u6b65\u4e1a\u52a1\u5728\u6570\u636e\u54cd\u5e94\u65f6\uff0c\u53c8\u6d89\u53ca\u5982\u4e0b\u56db\u79cd\u7c7b\u578b\uff1a</p> <ul> <li> <p>\u8bf7\u6c42\u8d44\u6e90\u8f6c\u53d1\uff1b</p> </li> <li> <p>\u8bf7\u6c42\u8d44\u6e90\u91cd\u5b9a\u5411\uff1b</p> </li> <li> <p>\u54cd\u5e94\u6a21\u578b\u6570\u636e\uff1b</p> </li> <li> <p>\u76f4\u63a5\u56de\u5199\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff1b</p> </li> </ul> \u533a\u5206\"\u8f6c\u53d1\"\u4e0e\"\u91cd\u5b9a\u5411\" <p></p> <p>\u54cd\u5e94\u6a21\u578b\u6570\u636e\uff0c\u54cd\u5e94\u6a21\u578b\u6570\u636e\u672c\u8d28\u4e5f\u662f\u8f6c\u53d1\uff0c\u5728\u8f6c\u53d1\u65f6\u53ef\u4ee5\u51c6\u5907\u6a21\u578b\u6570\u636e</p> <pre><code>@GetMapping(\"/forward5\")\npublic ModelAndView forward5(ModelAndView modelAndView){\n    //\u51c6\u5907JavaBean\u6a21\u578b\u6570\u636e\n    User user = new User();\n    user.setUsername(\"haohao\");\n    //\u8bbe\u7f6e\u6a21\u578b\n    modelAndView.addObject(\"user\",user);\n    //\u8bbe\u7f6e\u89c6\u56fe\n    modelAndView.setViewName(\"/index.jsp\");\n    return modelAndView;\n}\n</code></pre> <p>\u76f4\u63a5\u56de\u5199\u6570\u636e\uff0c\u76f4\u63a5\u901a\u8fc7\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u5b57\u7b26\u4e32\uff0c\u4f46\u662fSpringMVC\u9ed8\u8ba4\u7684\u65b9\u6cd5\u8fd4\u56de\u503c\u662f\u89c6\u56fe\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>@ResponseBody</code> \u6ce8\u89e3\u663e\u5f0f\u7684\u544a\u77e5\u6b64\u5904\u7684\u8fd4\u56de\u503c\u4e0d\u8981\u8fdb\u884c\u89c6\u56fe\u5904\u7406\uff0c\u662f\u8981\u4ee5\u54cd\u5e94\u4f53\u7684\u65b9\u5f0f\u5904\u7406</p> <pre><code>@GetMapping(\"/response2\")\n@ResponseBody\npublic String response2() throws IOException {\n    return \"Hello haohao!\";\n}\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u524d\u540e\u7aef\u5206\u79bb\u5f02\u6b65\u4e1a\u52a1\u6570\u636e\u54cd\u5e94","title":"\u524d\u540e\u7aef\u5206\u79bb\u5f02\u6b65\u4e1a\u52a1\u6570\u636e\u54cd\u5e94","text":"<ul> <li> <p>\u540c\u6b65\u65b9\u5f0f\u56de\u5199\u6570\u636e\uff0c\u662f\u5c06\u6570\u636e\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\u8fdb\u884c\u9875\u9762\u5c55\u793a\u7684\uff0c\u800c\u5f02\u6b65\u65b9\u5f0f\u56de\u5199\u6570\u636e\u4e00\u822c\u662f\u56de\u5199\u7ed9Ajax\u5f15\u64ce\u7684\uff0c\u5373\u8c01\u8bbf\u95ee\u670d\u52a1\u5668\u7aef\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u5c06\u6570\u636e\u54cd\u5e94\u7ed9\u8c01</p> </li> <li> <p>\u540c\u6b65\u65b9\u5f0f\u56de\u5199\u7684\u6570\u636e\uff0c\u4e00\u822c\u5c31\u662f\u4e00\u4e9b\u65e0\u7279\u5b9a\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u800c\u5f02\u6b65\u65b9\u5f0f\u56de\u5199\u7684\u6570\u636e\u5927\u591a\u662fJson\u683c\u5f0f\u5b57\u7b26\u4e32</p> </li> </ul> <p>\u56de\u5199\u666e\u901a\u6570\u636e\u4f7f\u7528<code>@ResponseBody</code>\u6807\u6ce8\u65b9\u6cd5\uff0c\u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\u5373\u53ef</p> <p>\u56de\u5199Json\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c<code>@ResponseBody</code>\u4f1a\u81ea\u52a8\u5c06JavaBean\u8f6c\u6362\u6210Json\u683c\u5f0f\u5b57\u7b26\u4e32\u56de\u54cd\u5e94</p> <p>Tip</p> <p>\u53ef\u4ee5\u4f7f\u7528<code>@RestController</code>\u66ff\u4ee3@Controller\u548c@ResponseBody\uff0c@RestController\u5185\u90e8\u5177\u5907\u7684\u8fd9\u4e24\u4e2a\u6ce8\u89e3\u7684\u529f\u80fd</p>"},{"location":"Spring/Spring-MVC/#springmvc\u7684\u62e6\u622a\u5668","title":"SpringMVC\u7684\u62e6\u622a\u5668","text":""},{"location":"Spring/Spring-MVC/#\u62e6\u622a\u5668-interceptor-\u7b80\u4ecb","title":"\u62e6\u622a\u5668 Interceptor \u7b80\u4ecb","text":"<p>SpringMVC\u7684\u62e6\u622a\u5668Interceptor\u89c4\u8303\uff0c\u4e3b\u8981\u662f\u5bf9Controller\u8d44\u6e90\u8bbf\u95ee\u65f6\u8fdb\u884c\u62e6\u622a\u64cd\u4f5c\u7684\u6280\u672f\uff0c\u62e6\u622a\u540e\u53ef\u4ee5\u8fdb\u884c\u6743\u9650\u63a7\u5236\u3001\u529f\u80fd\u589e\u5f3a\u7b49\u3002\u62e6\u622a\u5668\u7c7b\u4f3c Javaweb \u5f00\u53d1\u4e2d\u7684Filter\uff0c\u4f46\u4e8c\u8005\u5e76\u4e0d\u76f8\u540c\uff1a</p> <p></p> Filter Interceptor \u6280\u672f\u8303\u7574 JavaWeb\u539f\u751f\u6280\u672f SpringMVC\u6846\u67b6\u6280\u672f \u62e6\u622a/\u8fc7\u6ee4 \u53ef\u4ee5\u5bf9\u6240\u6709\u8bf7\u6c42\u90fd\u8fc7\u6ee4\uff0c\u5305\u62ec\u4efb\u4f55Servlet\u3001Jsp\u3001\u5176\u4ed6\u8d44\u6e90\u7b49 \u53ea\u5bf9\u8fdb\u5165\u4e86SpringMVC\u7ba1\u8f96\u8303\u56f4\u7684\u624d\u62e6\u622a\uff0c\u4e3b\u8981\u62e6\u622aController\u8bf7\u6c42 \u6267\u884c\u65f6\u673a \u65e9\u4e8e\u4efb\u4f55Servlet\u6267\u884c \u665a\u4e8eDispatcherServlet\u6267\u884c <p>Note</p> <p>\u5b9e\u73b0\u4e86<code>HandlerInterceptor</code>\u63a5\u53e3\uff0c\u4e14\u88abSpring\u7ba1\u7406\u7684Bean\u90fd\u662f\u62e6\u622a\u5668</p> <p><code>HandlerInterceptor</code>\u63a5\u53e3\u65b9\u6cd5\u7684\u4f5c\u7528\u53ca\u5176\u53c2\u6570\u3001\u8fd4\u56de\u503c\u5982\u4e0b\uff1a</p> \u65b9\u6cd5 \u4f5c\u7528 \u53c2\u6570 \u8fd4\u56de\u503c preHandle \u5bf9\u62e6\u622a\u5230\u7684\u8bf7\u6c42\u8fdb\u884c\u9884\u5904\u7406\uff0c\u8fd4\u56detrue\u653e\u884c\uff0cfalse\u4e0d\u653e\u884c Handler\u662f\u62e6\u622a\u5230\u7684Controller\u65b9\u6cd5\u5904\u7406\u5668 \u4e00\u65e6\u8fd4\u56defalse\uff0c\u4ee3\u8868\u7ec8\u6b62\u5411\u540e\u6267\u884c\uff0c\u6240\u6709\u540e\u7f6e\u65b9\u6cd5\u90fd\u4e0d\u6267\u884c postHandle \u5728\u5904\u7406\u5668\u7684\u65b9\u6cd5\u6267\u884c\u540e\uff0c\u5bf9\u62e6\u622a\u5230\u7684\u8bf7\u6c42\u8fdb\u884c\u540e\u5904\u7406\uff0c\u53ef\u4ee5\u5728\u65b9\u6cd5\u4e2d\u5bf9\u6a21\u578b\u6570\u636e\u548c\u89c6\u56fe\u8fdb\u884c\u4fee\u6539 Handler\u662f\u62e6\u622a\u5230\u7684Controller\u65b9\u6cd5\u5904\u7406\u5668\uff1bmodelAndView\u662f\u8fd4\u56de\u7684\u6a21\u578b\u89c6\u56fe\u5bf9\u8c61 \u65e0 afterCompletion \u89c6\u56fe\u6e32\u67d3\u5b8c\u6210\u540e(\u6574\u4e2a\u6d41\u7a0b\u7ed3\u675f\u4e4b\u540e)\uff0c\u8fdb\u884c\u6700\u540e\u7684\u5904\u7406\uff0c\u5982\u679c\u8bf7\u6c42\u6d41\u7a0b\u4e2d\u6709\u5f02\u5e38\uff0c\u53ef\u4ee5\u5904\u7406\u5f02\u5e38\u5bf9\u8c61 Handler\u662f\u62e6\u622a\u5230\u7684Controller\u65b9\u6cd5\u5904\u7406\u5668\uff1bex\u662f\u5f02\u5e38\u5bf9\u8c61 \u65e0"},{"location":"Spring/Spring-MVC/#\u62e6\u622a\u5668\u5feb\u901f\u5165\u95e8","title":"\u62e6\u622a\u5668\u5feb\u901f\u5165\u95e8","text":"<p>\u5b9e\u73b0HandlerInterceptor\u63a5\u53e3</p> <pre><code>public class MyInterceptor implements HandlerInterceptor {\n    @Override\n    public boolean preHandle(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler) throws Exception {\n        System.out.println(\"preHandle\u6267\u884c\u4e86\");\n        return true;\n    }\n\n    @Override\n    public void postHandle(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        System.out.println(\"postHandle\u6267\u884c\u4e86\");\n    }\n\n    @Override\n    public void afterCompletion(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        System.out.println(\"afterCompletion\u6267\u884c\u4e86\");\n    }\n}\n</code></pre> <p>\u914d\u7f6e\u62e6\u622a\u5668</p> <pre><code>&lt;!-- \u914d\u7f6e\u62e6\u622a\u5668 --&gt;\n&lt;mvc:interceptors&gt;\n    &lt;mvc:interceptor&gt;\n        &lt;!-- \u914d\u7f6e\u62e6\u622a\u8def\u5f84 --&gt;\n        &lt;mvc:mapping path=\"/**\"/&gt;\n        &lt;bean class=\"com.ysh.interceptor.MyInterceptor\"/&gt;\n    &lt;/mvc:interceptor&gt;\n&lt;/mvc:interceptors&gt;\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u62e6\u622a\u5668\u6267\u884c\u987a\u5e8f","title":"\u62e6\u622a\u5668\u6267\u884c\u987a\u5e8f","text":"<p>\u6ce8\u610f</p> <p>\u4ee5\u4e0a\u8def\u5f84\u53ea\u5728\u6240\u6709interceptor\u90fd\u653e\u884c\u7684\u60c5\u51b5\u4e0b\u6ee1\u8db3</p> <p>Interceptor3\u4e0d\u653e\u884c\u7684\u60c5\u51b5</p> <p></p> <p>Tip</p> <p>\u62e6\u622a\u5668\u6267\u884c\u987a\u5e8f\u53d6\u51b3\u4e8e interceptor \u7684\u914d\u7f6e\u987a\u5e8f</p>"},{"location":"Spring/Spring-MVC/#\u62e6\u622a\u5668\u6267\u884c\u539f\u7406","title":"\u62e6\u622a\u5668\u6267\u884c\u539f\u7406","text":"<p>\u8bf7\u6c42\u5230\u8fbe\u65f6\u5148\u4f1a\u4f7f\u7528\u7ec4\u4ef6HandlerMapping\u53bb\u5339\u914dController\u7684\u65b9\u6cd5\uff08Handler\uff09\u548c\u7b26\u5408\u62e6\u622a\u8def\u5f84\u7684Interceptor\uff0cHandler\u548c\u591a\u4e2aInterceptor\u88ab\u5c01\u88c5\u6210\u4e00\u4e2a<code>HandlerExecutionChain</code>\u7684\u5bf9\u8c61:</p> <pre><code>public class HandlerExecutionChain {\n    //\u6620\u5c04\u7684Controller\u7684\u65b9\u6cd5\n    private final Object handler;\n    //\u5f53\u524dHandler\u5339\u914d\u7684\u62e6\u622a\u5668\u96c6\u5408\n    private final List&lt;HandlerInterceptor&gt; interceptorList;\n    // ... \u7701\u7565\u5176\u4ed6\u4ee3\u7801 ...\n}\n</code></pre> <p>\u5728<code>DispatcherServlet</code>\u7684<code>doDispatch</code>\u65b9\u6cd5\u4e2d\u4f1a\u83b7\u5f97<code>HandlerExecutionChain</code>\u7684\u5bf9\u8c61\uff0c\u7136\u540e\u6309\u903b\u8f91\u6267\u884c\u5176\u4e2d\u62e6\u622a\u5668\u65b9\u6cd5</p>"},{"location":"Spring/Spring-MVC/#springmvc\u7684\u5168\u6ce8\u89e3\u5f00\u53d1","title":"SpringMVC\u7684\u5168\u6ce8\u89e3\u5f00\u53d1","text":""},{"location":"Spring/Spring-MVC/#spring-mvcxml-\u4e2d\u7ec4\u4ef6\u8f6c\u5316\u4e3a\u6ce8\u89e3\u5f62\u5f0f","title":"spring-mvc.xml \u4e2d\u7ec4\u4ef6\u8f6c\u5316\u4e3a\u6ce8\u89e3\u5f62\u5f0f","text":"<ul> <li> <p>\u7ec4\u4ef6\u626b\u63cf\uff0c\u53ef\u4ee5\u901a\u8fc7@ComponentScan\u6ce8\u89e3\u5b8c\u6210\uff1b</p> </li> <li> <p>\u6587\u4ef6\u4e0a\u4f20\u89e3\u6790\u5668<code>MultipartResolver</code>\u53ef\u4ee5\u901a\u8fc7\u975e\u81ea\u5b9a\u4e49Bean\u7684\u6ce8\u89e3\u914d\u7f6e\u65b9\u5f0f\uff0c\u5373@Bean\u6ce8\u89e3\u5b8c\u6210</p> </li> </ul> <pre><code>@Configuration\n@ComponentScan(\"com.ysh.controller\")\n@EnableWebMvc\npublic class MVCConfig {\n\n    @Bean(name = \"multipartResolver\")\n    public CommonsMultipartResolver multipartResolver() {\n        CommonsMultipartResolver resolver = new CommonsMultipartResolver();\n        resolver.setMaxUploadSize(10000000);\n        resolver.setDefaultEncoding(\"UTF-8\");\n        // ...\n        return resolver;\n    }\n}\n</code></pre> <ul> <li> <p><code>&lt;mvc:default-servlet-handler/&gt;</code>\u548c<code>&lt;mvc:interceptor/&gt;</code>  SpringMVC\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6ce8\u89e3\u53eb\u505a<code>@EnableWebMvc</code>\uff0c\u5185\u90e8\u901a\u8fc7@Import \u5bfc\u5165\u4e86DelegatingWebMvcConfiguration\u7c7b,\u8be5\u7c7b\u6709\u5982\u4e0b\u7684\u65b9\u6cd5\uff1a <pre><code>//\u4ece\u5bb9\u5668\u4e2d\u6ce8\u5165WebMvcConfigurer\u7c7b\u578b\u7684Bean\n@Autowired(required = false)\npublic void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) {\n    if (!CollectionUtils.isEmpty(configurers)) {\n        this.configurers.addWebMvcConfigurers(configurers);\n    }}\n//\u7701\u7565\u5176\u4ed6\u4ee3\u7801\n\n//\u8be5\u65b9\u6cd5\u4f1a\u83b7\u5f97WebMvcConfigurer\u7c7b\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u65b9\u6cd5\n</code></pre></p> </li> <li> <p><code>WebMvcConfigurer</code>\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b: <pre><code>public interface WebMvcConfigurer {\n    //\u914d\u7f6e\u9ed8\u8ba4Servet\u5904\u7406\u5668\n    default void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) { }\n\n    //\u6dfb\u52a0\u62e6\u622a\u5668\n    default void addInterceptors(InterceptorRegistry registry) { }\n\n    //\u6dfb\u52a0\u8d44\u6e90\u5904\u7406\u5668\n    default void addResourceHandlers(ResourceHandlerRegistry registry) { }\n\n    //\u6dfb\u52a0\u89c6\u56fe\u63a7\u5236\u5668\n    default void addViewControllers(ViewControllerRegistry registry) { }\n\n    //\u914d\u7f6e\u89c6\u56fe\u89e3\u6790\u5668\n    default void configureViewResolvers(ViewResolverRegistry registry) { }\n\n    //\u6dfb\u52a0\u53c2\u6570\u89e3\u6790\u5668\n    default void addArgumentResolvers(List&lt;HandlerMethodArgumentResolver&gt; resolvers) { }\n    //... \u7701\u7565\u5176\u4ed6\u4ee3\u7801 ...\n}\n</code></pre></p> </li> </ul> <p>\u53ea\u8981\u5b9e\u73b0\u8be5\u63a5\u53e3\uff0c\u5e76\u4ea4\u7ed9Spring\u5bb9\u5668\u7ba1\u7406\uff0c\u5e76\u5728\u914d\u7f6e\u7c7b\u4e0a\u52a0\u5165<code>@EnableWebMvc</code>\u5373\u53ef\u8fdb\u884c\u914d\u7f6e <pre><code>@Component\npublic class WebMVCConfig implements WebMvcConfigurer {\n    @Override\n    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {\n        configurer.enable();\n    }\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(new MyInterceptor()).addPathPatterns(\"/**\");\n    }\n}\n</code></pre></p>"},{"location":"Spring/Spring-MVC/#dispatcherservlet\u52a0\u8f7d\u6838\u5fc3\u914d\u7f6e\u7c7b","title":"DispatcherServlet\u52a0\u8f7d\u6838\u5fc3\u914d\u7f6e\u7c7b","text":"<p>\u73b0\u5728\u4f7f\u7528SpringMVCConfig\u6838\u5fc3\u914d\u7f6e\u7c7b\u66ff\u4ee3spring-mvc.xml\uff0c\u600e\u4e48\u52a0\u8f7d\u8be5\u914d\u7f6e\u7c7b\u5462\uff1f</p> <p>\u53c2\u7167Spring\u7684ContextLoaderListener\u52a0\u8f7d\u6838\u5fc3\u914d\u7f6e\u7c7b\u7684\u505a\u6cd5\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2aAnnotationConfigWebApplicationContext\uff0c\u901a\u8fc7\u4ee3\u7801\u6ce8\u518c\u6838\u5fc3\u914d\u7f6e\u7c7b</p> <pre><code>public class MyAnnotationConfigWebApplicationContext extends AnnotationConfigWebApplicationContext {\n    public MyAnnotationConfigWebApplicationContext(){\n        //\u6ce8\u518c\u6838\u5fc3\u914d\u7f6e\u7c7b\n        super.register(SpringMVCConfig.class);\n    }\n}\n</code></pre> <pre><code>&lt;!--\u6307\u5b9aspringMVC\u7684applicationContext\u5168\u9650\u5b9a\u540d --&gt;\n &lt;init-param&gt;\n    &lt;param-name&gt;contextClass&lt;/param-name&gt;\n    &lt;param-value&gt;com.itheima.config.MyAnnotationConfigWebApplicationContext&lt;/param-value&gt;\n &lt;/init-param&gt;\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u6d88\u9664webxml","title":"\u6d88\u9664web.xml","text":"<ul> <li> <p>Servlet3.0\u73af\u5883\u4e2d\uff0cweb\u5bb9\u5668\u63d0\u4f9b\u4e86<code>javax.servlet.ServletContainerInitializer</code>\u63a5\u53e3\uff0c\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u540e\uff0c\u5728\u5bf9\u5e94\u7684\u7c7b\u52a0\u8f7d\u8def\u5f84\u7684<code>META-INF/services</code> \u76ee\u5f55\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a<code>javax.servlet.ServletContainerInitializer</code>\u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u6307\u5b9a\u5177\u4f53\u7684ServletContainerInitializer\u5b9e\u73b0\u7c7b\uff0c\u90a3\u4e48\uff0c\u5f53web\u5bb9\u5668\u542f\u52a8\u65f6\u5c31\u4f1a\u8fd0\u884c\u8fd9\u4e2a\u521d\u59cb\u5316\u5668\u505a\u4e00\u4e9b\u7ec4\u4ef6\u5185\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff1b</p> </li> <li> <p>\u57fa\u4e8e\u8fd9\u4e2a\u7279\u6027\uff0cSpring\u5c31\u5b9a\u4e49\u4e86\u4e00\u4e2a<code>SpringServletContainerInitializer</code>\u5b9e\u73b0\u4e86ServletContainerInitializer\u63a5\u53e3; </p> </li> <li> <p>\u800cSpringServletContainerInitializer\u4f1a\u67e5\u627e\u5b9e\u73b0\u4e86WebApplicationInitializer\u7684\u7c7b\uff0cSpring\u53c8\u63d0\u4f9b\u4e86\u4e00\u4e2aWebApplicationInitializer\u7684\u57fa\u7840\u5b9e\u73b0\u7c7bAbstractAnnotationConfigDispatcherServletInitializer\uff0c\u5f53\u6211\u4eec\u7f16\u5199\u7c7b\u7ee7\u627f\u5b83\u65f6\uff0c\u5bb9\u5668\u5c31\u4f1a\u81ea\u52a8\u53d1\u73b0\u6211\u4eec\u81ea\u5df1\u7684\u7c7b\uff0c\u5728\u8be5\u7c7b\u4e2d\u6211\u4eec\u5c31\u53ef\u4ee5\u914d\u7f6eSpring\u548cSpringMVC\u7684\u5165\u53e3\u4e86\u3002</p> </li> </ul> <p>\u7f16\u5199\u5982\u4e0b\u4ee3\u7801\u5373\u53ef <pre><code>public class MyAnnotationConfigDispatcherServletInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n    //\u8fd4\u56de\u7684\u5e26\u6709@Configuration\u6ce8\u89e3\u7684\u7c7b\u7528\u6765\u914d\u7f6eContextLoaderListener\n    protected Class&lt;?&gt;[] getRootConfigClasses() {\n        System.out.println(\"\u52a0\u8f7d\u6838\u5fc3\u914d\u7f6e\u7c7b\u521b\u5efaContextLoaderListener\");\n        return new Class[]{ApplicationContextConfig.class};\n    }\n    //\u8fd4\u56de\u7684\u5e26\u6709@Configuration\u6ce8\u89e3\u7684\u7c7b\u7528\u6765\u914d\u7f6eDispatcherServlet\n    protected Class&lt;?&gt;[] getServletConfigClasses() {\n        System.out.println(\"\u52a0\u8f7d\u6838\u5fc3\u914d\u7f6e\u7c7b\u521b\u5efaDispatcherServlet\");\n        return new Class[]{SpringMVCConfig.class};\n    }\n    //\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u8def\u5f84\u6620\u5c04\u5230DispatcherServlet\u4e0a\n    protected String[] getServletMappings() {\n        return new String[]{\"/\"};\n    }\n}\n</code></pre></p>"},{"location":"Spring/Spring-MVC/#springmvc\u7684\u7ec4\u4ef6\u539f\u7406\u5256\u6790","title":"SpringMVC\u7684\u7ec4\u4ef6\u539f\u7406\u5256\u6790","text":""},{"location":"Spring/Spring-MVC/#\u524d\u7aef\u63a7\u5236\u5668\u521d\u59cb\u5316","title":"\u524d\u7aef\u63a7\u5236\u5668\u521d\u59cb\u5316","text":"<p>\u524d\u7aef\u63a7\u5236\u5668DispatcherServlet\u662fSpringMVC\u7684\u5165\u53e3\uff0c\u4e5f\u662fSpringMVC\u7684\u5927\u8111\uff0c\u4e3b\u6d41\u7a0b\u7684\u5de5\u4f5c\u90fd\u662f\u5728\u6b64\u5b8c\u6210\u7684\u3002DispatcherServlet \u672c\u8d28\u662f\u4e2aServlet\uff0c\u5f53\u914d\u7f6e\u4e86 load-on-startup \u65f6\uff0c\u4f1a\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u5c31\u6267\u884c\u521b\u5efa\u548c\u6267\u884c\u521d\u59cb\u5316init\u65b9\u6cd5\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u6267\u884cservice\u65b9\u6cd5</p> <p>DispatcherServlet \u7684\u521d\u59cb\u5316\u4e3b\u8981\u505a\u4e86\u4e24\u4ef6\u4e8b</p> <ol> <li> <p>\u83b7\u5f97\u4e86 SpringMVC \u7684 ApplicationContext \u5bb9\u5668</p> </li> <li> <p>\u6ce8\u518c SpringMVC \u7684\u4e5d\u5927\u7ec4\u4ef6</p> </li> </ol> <p></p> <p>\u83b7\u5f97SpringMVC\u5bb9\u5668</p> <p>SpringMVC\u7684ApplicationContext\u5bb9\u5668\u521b\u5efa\u65f6\u673a\uff0cServlet \u89c4\u8303\u7684 init(ServletConfig config) \u65b9\u6cd5\u7ecf\u8fc7\u5b50\u7c7b\u91cd\u5199\uff0c\u6700\u7ec8\u4f1a\u8c03\u7528 FrameworkServlet \u62bd\u8c61\u7c7b\u7684initWebApplicationContext()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4e2d\u6700\u7ec8\u83b7\u5f97\u4e00\u4e2a\u6839Spring\u5bb9\u5668\uff08Spring\u4ea7\u751f\u7684\uff09\uff0c\u4e00\u4e2a\u5b50Spring\u5bb9\u5668\uff08SpringMVC\u4ea7\u751f\u7684\uff09</p> <p></p> <p>\u67e5\u770b HttpServletBean \u7684\u521d\u59cb\u5316\u65b9\u6cd5</p> <pre><code>public final void init() throws ServletException {\n this.initServletBean();\n }\n</code></pre> <p>Warning</p> <p>HttpServletBean\u7684initServletBean\u65b9\u6cd5\u5e76\u6ca1\u6709\u5177\u4f53\u5b9e\u73b0\uff0c\u7531\u5b50\u7c7b(FrameworkServlet)\u91cd\u5199\u6765\u5b9e\u73b0</p> <p>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u7684\u5e94\u7528</p> <p>\u6a21\u677f\u65b9\u6cd5</p> <p>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u64cd\u4f5c\u4e2d\u7684\u7b97\u6cd5\u7684\u9aa8\u67b6\uff0c\u800c\u5c06\u4e00\u4e9b\u6b65\u9aa4\u5ef6\u8fdf\u5230\u5b50\u7c7b\u4e2d\u3002\u6a21\u677f\u65b9\u6cd5\u4f7f\u5f97\u5b50\u7c7b\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8\u7b97\u6cd5\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u91cd\u65b0\u5b9a\u4e49\u7b97\u6cd5\u4e2d\u7684\u67d0\u4e9b\u7279\u5b9a\u6b65\u9aa4\u3002</p> <p>\u67e5\u770b FrameworkServlet\u7684initServletBean \u65b9\u6cd5</p> <pre><code>protected final void initServletBean() throws ServletException {\n this.webApplicationContext = this.initWebApplicationContext();//\u521d\u59cb\u5316ApplicationContext\n this.initFrameworkServlet();//\u6a21\u677f\u65b9\u6cd5\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f9b\u5b50\u7c7b\u8986\u76d6\u5b9e\u73b0\uff0c\u4f46\u662f\u5b50\u7c7bDispatcherServlet\u6ca1\u6709\u5b9e\u73b0\u5177\u4f53\u903b\u8f91\n}\n</code></pre> <p>initWebApplicationContext\u65b9\u6cd5\u4e2d\u83b7\u5f97Spring\u5bb9\u5668\u548cSpringMVC\u5bb9\u5668\uff0c\u5e76\u5c06Spring\u5bb9\u5668\u4f5c\u4e3aSpringMVC\u5bb9\u5668\u7684\u7236\u5bb9\u5668\uff0c\u5b50\u5bb9\u5668\u4e2d\u7684parent\u7ef4\u62a4\u7740\u7236\u5bb9\u5668\u7684\u5f15\u7528 <pre><code>//\u521d\u59cb\u5316ApplicationContext\u662f\u4e00\u4e2a\u53ca\u5176\u5173\u952e\u7684\u4ee3\u7801\nprotected WebApplicationContext initWebApplicationContext() {\n    //\u83b7\u5f97\u6839\u5bb9\u5668\uff0c\u5176\u5b9e\u5c31\u662f\u901a\u8fc7ContextLoaderListener\u521b\u5efa\u7684ApplicationContext\n    //\u5982\u679c\u914d\u7f6e\u4e86ContextLoaderListener\u5219\u83b7\u5f97\u6839\u5bb9\u5668\uff0c\u6ca1\u914d\u7f6e\u83b7\u5f97\u7684\u662fnull\n    WebApplicationContext rootContext = \nWebApplicationContextUtils.getWebApplicationContext(this.getServletContext());\n    //\u5b9a\u4e49SpringMVC\u4ea7\u751f\u7684ApplicationContext\u5b50\u5bb9\u5668\n    WebApplicationContext wac = null;\n    if (wac == null) {\n        //==&gt;\u521b\u5efaSpringMVC\u7684\u5b50\u5bb9\u5668\uff0c\u521b\u5efa\u540c\u65f6\u5c06Spring\u7684\u521b\u5efa\u7684rootContext\u4f20\u9012\u4e86\u8fc7\u53bb\n        wac = this.createWebApplicationContext(rootContext);\n    }\n    //\u5c06SpringMVC\u4ea7\u751f\u7684ApplicationContext\u5b50\u5bb9\u5668\u5b58\u50a8\u5230ServletContext\u57df\u4e2d\n    //key\u540d\u662f\uff1aorg.springframework.web.servlet.FrameworkServlet.CONTEXT.DispatcherServlet\n    if (this.publishContext) {\n        String attrName = this.getServletContextAttributeName();\n        this.getServletContext().setAttribute(attrName, wac);\n    }}\n</code></pre></p> <p>Note</p> <ul> <li> <p>\u7236\u5bb9\u5668\uff1aSpring \u901a\u8fc7ContextLoaderListener\u4e3a\u5165\u53e3\u4ea7\u751f\u7684applicationContext\u5bb9\u5668\uff0c\u5185\u90e8\u4e3b\u8981\u7ef4\u62a4\u7684\u662fapplicationContext.xml\uff08\u6216\u76f8\u5e94\u914d\u7f6e\u7c7b\uff09\u914d\u7f6e\u7684Bean\u4fe1\u606f\uff1b</p> </li> <li> <p>\u5b50\u5bb9\u5668\uff1aSpringMVC\u901a\u8fc7DispatcherServlet\u7684init() \u65b9\u6cd5\u4ea7\u751f\u7684applicationContext\u5bb9\u5668\uff0c\u5185\u90e8\u4e3b\u8981\u7ef4\u62a4\u7684\u662fspring-mvc.xml\uff08\u6216\u76f8\u5e94\u914d\u7f6e\u7c7b\uff09\u914d\u7f6e\u7684Bean\u4fe1\u606f\uff0c\u4e14\u5185\u90e8\u8fd8\u901a\u8fc7parent\u5c5e\u6027\u7ef4\u62a4\u8fd9\u7236\u5bb9\u5668\u7684\u5f15\u7528\u3002</p> </li> <li> <p>Bean\u7684\u68c0\u7d22\u987a\u5e8f\uff1a\u6839\u636e\u4e0a\u9762\u7236\u5b50\u5bb9\u5668\u7684\u6982\u5ff5\uff0c\u53ef\u4ee5\u77e5\u9053Controller\u5b58\u5728\u4e0e\u5b50\u5bb9\u5668\u4e2d\uff0c\u800cController\u4e2d\u8981\u6ce8\u5165Service\u65f6\uff0c\u4f1a\u5148\u4ece\u5b50\u5bb9\u5668\u672c\u8eab\u53bb\u5339\u914d\uff0c\u5339\u914d\u4e0d\u6210\u529f\u65f6\u5728\u53bb\u7236\u5bb9\u5668\u4e2d\u53bb\u5339\u914d\uff0c\u4e8e\u662f\u6700\u7ec8\u4ece\u7236\u5bb9\u5668\u4e2d\u5339\u914d\u5230\u7684UserService\uff0c\u8fd9\u6837\u5b50\u7236\u5bb9\u5668\u5c31\u53ef\u4ee5\u8fdb\u884c\u8054\u901a\u4e86\u3002\u4f46\u662f\u7236\u5bb9\u5668\u53ea\u80fd\u4ece\u81ea\u5df1\u5bb9\u5668\u4e2d\u8fdb\u884c\u5339\u914d\uff0c\u4e0d\u80fd\u4ece\u5b50\u5bb9\u5668\u4e2d\u8fdb\u884c\u5339\u914d\u3002</p> </li> </ul> <p></p> <p>\u6ce8\u518c\u7ec4\u4ef6</p> <p>\u5728\u521d\u59cb\u5316\u5bb9\u5668initWebApplicationContext\u65b9\u6cd5\u4e2d\u6267\u884c\u4e86onRefresh\u65b9\u6cd5\uff0c\u8fdb\u800c\u6267\u884c\u4e86\u521d\u59cb\u5316\u7b56\u7565initStrategies\u65b9\u6cd5\uff0c\u6ce8\u518c\u4e86\u4e5d\u4e2a\u89e3\u6790\u5668\u7ec4\u4ef6</p> <pre><code>//DispatcherServlet\u521d\u59cb\u5316SpringMVC\u4e5d\u5927\u7ec4\u4ef6\nprotected void initStrategies(ApplicationContext context) {\n    this.initMultipartResolver(context);//1\u3001\u521d\u59cb\u5316\u6587\u4ef6\u4e0a\u4f20\u89e3\u6790\u5668\n    this.initLocaleResolver(context);//2\u3001\u521d\u59cb\u5316\u56fd\u9645\u5316\u89e3\u6790\u5668\n    this.initThemeResolver(context);//3\u3001\u521d\u59cb\u5316\u6a21\u677f\u89e3\u6790\u5668\n    this.initHandlerMappings(context);//4\u3001\u521d\u59cb\u5316\u5904\u7406\u5668\u6620\u5c04\u5668\n    this.initHandlerAdapters(context);//5\u3001\u521d\u59cb\u5316\u5904\u7406\u5668\u9002\u914d\u5668\n    this.initHandlerExceptionResolvers(context);//6\u3001\u521d\u59cb\u5316\u5904\u7406\u5668\u5f02\u5e38\u89e3\u6790\u5668\n    this.initRequestToViewNameTranslator(context);//7\u3001\u521d\u59cb\u5316\u8bf7\u6c42\u89c6\u56fe\u8f6c\u6362\u5668\n    this.initViewResolvers(context);//8\u3001\u521d\u59cb\u5316\u89c6\u56fe\u89e3\u6790\u5668\n    this.initFlashMapManager(context);//9\u3001\u521d\u59cb\u5316lashMapManager\u7b56\u7565\u7ec4\u4ef6\n}\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u524d\u7aef\u63a7\u5236\u5668\u6267\u884c\u4e3b\u6d41\u7a0b","title":"\u524d\u7aef\u63a7\u5236\u5668\u6267\u884c\u4e3b\u6d41\u7a0b","text":""},{"location":"Spring/Spring-MVC/#\u5f02\u5e38\u5904\u7406\u673a\u5236","title":"\u5f02\u5e38\u5904\u7406\u673a\u5236","text":""},{"location":"Spring/Spring-MVC/#\u5904\u7406\u6d41\u7a0b","title":"\u5904\u7406\u6d41\u7a0b","text":"<p>\u5f02\u5e38\u5206\u4e3a\u7f16\u8bd1\u65f6\u5f02\u5e38\u548c\u8fd0\u884c\u65f6\u5f02\u5e38\uff0c\u7f16\u8bd1\u65f6\u5f02\u5e38\u4f7f\u7528 try-catch \u8fdb\u884c\u6355\u83b7\uff0c\u6355\u83b7\u540e\u81ea\u884c\u5904\u7406\uff0c\u800c\u8fd0\u884c\u65f6\u5f02\u5e38\u662f\u4e0d\u53ef\u9884\u671f\u7684\uff0c\u5c31\u9700\u8981\u89c4\u8303\u7f16\u7801\u6765\u907f\u514d\uff0c\u5728SpringMVC\u4e2d\uff0c\u4e0d\u7ba1\u662f\u7f16\u8bd1\u5f02\u5e38\u8fd8\u662f\u8fd0\u884c\u65f6\u5f02\u5e38\uff0c\u90fd\u53ef\u4ee5\u6700\u7ec8\u7531SpringMVC\u63d0\u4f9b\u7684\u5f02\u5e38\u5904\u7406\u5668\u8fdb\u884c\u7edf\u4e00\u5904\u7406\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u4e86\u6355\u83b7\u5f02\u5e38\u7684\u7e41\u7410\u6027\u3002</p> <p>SpringMVC \u5904\u7406\u5f02\u5e38\u7684\u601d\u8def\u662f\uff0c\u4e00\u8def\u5411\u5916\u629b\uff0c\u90fd\u629b\u7ed9\u524d\u7aef\u63a7\u5236\u5668 <code>DispatcherServlet</code> \uff0c\u7136\u540e <code>DispatcherServlet</code> \u8c03\u7528\u5f02\u5e38\u5904\u7406\u5668<code>ExceptionResolver</code>\u8fdb\u884c\u5904\u7406\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"Spring/Spring-MVC/#\u5904\u7406\u65b9\u5f0f","title":"\u5904\u7406\u65b9\u5f0f","text":"<p>SpringMVC \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u4e09\u79cd\u5904\u7406\u5f02\u5e38\u7684\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u7b80\u5355\u5f02\u5e38\u5904\u7406\u5668\uff1a\u4f7f\u7528SpringMVC\u5185\u7f6e\u7684\u5f02\u5e38\u5904\u7406\u5668\u5904\u7406 <code>SimpleMappingExceptionResolver</code>\uff1b</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u5668\uff1a\u5b9e\u73b0<code>HandlerExceptionResolver</code>\u63a5\u53e3\uff0c\u81ea\u5b9a\u4e49\u5f02\u5e38\u8fdb\u884c\u5904\u7406\uff1b</p> </li> <li> <p>\u6ce8\u89e3\u65b9\u5f0f\uff1a\u4f7f\u7528<code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> \u6765\u5904\u7406\u3002</p> </li> </ul> <p>\u4f7f\u7528SimpleMappingExceptionResolver\u5904\u7406\u4e00\u4e9b\u7b80\u5355\u5f02\u5e38\uff0c\u914d\u7f6e\u5f00\u542fSimpleMappingExceptionResolver\uff0c\u5e76\u6307\u5b9a\u5f02\u5e38\u6355\u83b7\u540e\u7684\u5904\u7406\u52a8\u4f5c\uff0c\u5f53\u53d1\u751f\u4e86\u5f02\u5e38\u540e\uff0c\u4f1a\u88ab SimpleMappingExceptionResolver \u5904\u7406\uff0c\u8df3\u8f6c\u5230\u6211\u4eec\u914d\u7f6e\u7684\u9519\u8bef\u9875\u9762error.html</p> <pre><code>&lt;!--\u914d\u7f6e\u7b80\u5355\u5f02\u5e38\u5904\u7406\u5668--&gt;\n&lt;bean class=\"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver\"&gt;\n&lt;!-- \u5f02\u5e38\u6355\u83b7\u540e\u52a8\u4f5c\uff1a\u5c55\u793a\u89c6\u56fe --&gt;\u00a0\u00a0\u00a0\u00a0\n&lt;property name=\"defaultErrorView\" value=\"/error.html\"/&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u53ef\u4ee5\u5728\u914d\u7f6eSimpleMappingExceptionResolver\u65f6\uff0c\u6307\u5b9a\u4e00\u4e9b\u53c2\u6570</p> <pre><code>&lt;bean class=\"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver\"&gt;\n    &lt;property name=\"defaultErrorView\" value=\"/error.html\"/&gt;\n    &lt;property name=\"exceptionMappings\"&gt;\n        &lt;props&gt;\n            &lt;!-- \u914d\u7f6e\u5f02\u5e38\u7c7b\u578b\u5bf9\u5e94\u7684\u5c55\u793a\u89c6\u56fe --&gt;\n            &lt;prop key=\"java.lang.RuntimeException\"&gt;/error.html&lt;/prop&gt;\n            &lt;prop key=\"java.io.FileNotFoundException\"&gt;/io.html&lt;/prop&gt;\n        &lt;/props&gt;\n    &lt;/property&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u6ce8\u89e3\u65b9\u5f0f\u914d\u7f6e\u7b80\u5355\u6620\u5c04\u5f02\u5e38\u5904\u7406\u5668</p> <pre><code>@Bean\npublic SimpleMappingExceptionResolver simpleMappingExceptionResolver(){\n    //\u521b\u5efaSimpleMappingExceptionResolver\n    SimpleMappingExceptionResolver resolver = new SimpleMappingExceptionResolver();\n    //\u8bbe\u7f6e\u9ed8\u8ba4\u9519\u8bef\u5c55\u793a\u89c6\u56fe\n    resolver.setDefaultErrorView(\"/error.html\");\n    //\u5b9a\u4e49Properties\u8bbe\u7f6e\u7279\u6b8a\u5f02\u5e38\u5bf9\u5e94\u7684\u6620\u5c04\u89c6\u56fe\n    Properties properties = new Properties();\n    properties.setProperty(\"java.lang.RuntimeException\",\"/error.html\");\n    properties.setProperty(\"java.io.FileNotFoundException\",\"/io.html\");\n    resolver.setExceptionMappings(properties);\n    return resolver;\n}\n</code></pre> <p></p> <p>\u5b9e\u73b0HandlerExceptionResolver\u63a5\u53e3\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u5668\uff0c\u53ef\u4ee5\u5b8c\u6210\u5f02\u5e38\u903b\u8f91\u7684\u5904\u7406</p> <pre><code>public class MyExceptionResolver implements HandlerExceptionResolver {\n    @Override\n    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {\n\n        ModelAndView modelAndView = new ModelAndView();\n        modelAndView.setViewName(\"/error.html\");\n\n        return modelAndView;\n    }\n}\n</code></pre> <p>Warning</p> <p>\u6ce8\uff1a\u8be5Bean\u9700\u8981\u7531Spring\u5bb9\u5668\u7ba1\u7406\u624d\u80fd\u751f\u6548</p> <p>Tip</p> <p>\u8fd4\u56deJson\u683c\u5f0f\u5b57\u7b26\u4e32\u4fe1\u606f\uff1a\u4f7f\u7528 response.getWriter()\uff0c\u5199\u56dejson\u6570\u636e</p> <p></p> <p>\u4f7f\u7528\u6ce8\u89e3 @ControllerAdvice + @ExceptionHandler \u914d\u7f6e\u5f02\u5e38\u5904\u7406\u5668</p> <pre><code>@ControllerAdvice\npublic class GlobalExceptionHandler {\n    @ExceptionHandler(RuntimeException.class)\n    public ModelAndView runtimeHandleException(RuntimeException e){\n        System.out.println(\"\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\u6267\u884c....\"+e);\n        ModelAndView modelAndView = new ModelAndView(\"/error.html\");\n        return modelAndView;\n    }\n    @ExceptionHandler(IOException.class)\n    @ResponseBody\n    public ResultInfo ioHandleException(IOException e){\n        //\u6a21\u62df\u4e00\u4e2aResultInfo\n        ResultInfo resultInfo = new ResultInfo(0,\"IOException\",null);\n        return resultInfo;\n    }\n}\n</code></pre> <p>Tip</p> <p>\u5982\u679c\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\u54cd\u5e94\u7684\u6570\u636e\u90fd\u662fJson\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528@RestControllerAdvice\u66ff\u4ee3</p>"},{"location":"Spring/Spring-MVC/#\u539f\u7406\u6d45\u6790","title":"\u539f\u7406\u6d45\u6790","text":"<p>SpringMVC\u7684\u524d\u7f6e\u63a7\u5236\u5668\u5728\u8fdb\u884c\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u4f1a\u521d\u59cb\u5316\u5904\u7406\u5668\u5f02\u5e38\u89e3\u6790\u5668HandlerExceptionResolver</p> <p>Tip</p> <p>\u914d\u7f6e\u4e86\u81ea\u5b9a\u4e49\u7684\u5f02\u5e38\u5904\u7406\u5668\u540e\uff0c\u9ed8\u8ba4\u7684\u5f02\u5e38\u5904\u7406\u5668\u5c31\u4e0d\u4f1a\u88ab\u52a0\u8f7d\uff0c\u5f53\u914d\u7f6e\u6216\u914d\u7f6e\u4e86\u6ce8\u89e3@EnableWebMvc\u540e\uff0c\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u548c\u81ea\u5b9a\u7684\u5904\u7406\u5668\u5f02\u5e38\u89e3\u6790\u5668\u90fd\u4f1a\u88ab\u6ce8\u518c</p> <p>\u5f02\u5e38\u5904\u7406\u5668\u52a0\u8f7d\u5b8c\u6bd5\u540e\uff0c\u5f53\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u5c31\u4f1a\u8fdb\u884c\u5904\u7406\uff0c\u8ddf\u8e2a DispatcherServlet \u7684 doDispatch() \u65b9\u6cd5</p> <pre><code>protected void doDispatch(HttpServletRequest request, HttpServletResponse response) {\n    Object dispatchException = null;//\u5b9a\u4e49\u5f02\u5e38\n    try {\n        // ... \u7701\u7565\u4ee3\u7801 ...\n    } catch (Exception e) {\n        dispatchException = e;\n    } catch (Throwable te) {\n        dispatchException = new NestedServletException(\"Handler dispatch failed\", te);\n    }\n    //\u89c6\u56fe\u5904\u7406\u3001\u62e6\u622a\u5668\u6700\u7ec8\u65b9\u6cd5\u8c03\u7528\u3001\u5f02\u5e38\u5904\u7406\u90fd\u5728\u8be5\u65b9\u6cd5\u5185\n    this.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);\n}\n</code></pre> <pre><code>private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,\n                                   @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv, @Nullable Exception exception) throws Exception {\n    boolean errorView = false;//\u5b9a\u4e49\u9519\u8bef\u89c6\u56fe\u6807\u8bc6\uff0c\u9ed8\u8ba4\u4e3afalse\n    if (exception != null) {\n        //\u5224\u65ad\u5f53\u524d\u6355\u83b7\u7684\u5f02\u5e38\u662f\u5426\u662fModelAndViewDefiningException\u7c7b\u578b\u7684\u5f02\u5e38\n        if (exception instanceof ModelAndViewDefiningException) {\n            //\u83b7\u5f97ModelAndViewDefiningException\u5f02\u5e38\u5bf9\u8c61\u4e2d\u7684ModelAndView\u5bf9\u8c61\n            mv = ((ModelAndViewDefiningException)exception).getModelAndView();\n        } else {\n            //\u6355\u83b7\u5230\u5176\u4ed6\u5f02\u5e38\uff0c\u83b7\u5f97\u5f53\u524d\u53d1\u751f\u5f02\u5e38\u7684Handler\u5bf9\u8c61\n            Object handler = mappedHandler != null ? mappedHandler.getHandler() : null;\n            //\u6267\u884cprocessHandlerException \u65b9\u6cd5\n            mv = this.processHandlerException(request, response, handler, exception);\n            //\u5982\u679c\u5f02\u5e38\u5904\u7406\u8fd4\u56de\u4e86ModelAndView \u5219\u4fee\u6539\u9519\u8bef\u89c6\u56fe\u7684\u6807\u8bc6\u4e3atrue\n            errorView = mv != null;\n        }}\n    // ... \u7701\u7565\u5176\u4ed6\u4ee3\u7801 ...\n    }\n</code></pre>"},{"location":"Spring/Spring-MVC/#\u5e38\u7528\u7684\u5f02\u5e38\u89e3\u6790\u5668","title":"\u5e38\u7528\u7684\u5f02\u5e38\u89e3\u6790\u5668","text":"\u63a5\u53e3\u6216\u7c7b \u8bf4\u660e <code>HandlerExceptionResolver</code> \u5f02\u5e38\u5904\u7406\u5668\u7c7b\u7684\u9876\u7ea7\u63a5\u53e3\uff0c\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u7684\u7c7b\u90fd\u4f1a\u4f5c\u4e3a\u5f02\u5e38\u5904\u7406\u5668\u7c7b <code>HandlerExceptionResolverComposite</code> \u5f02\u5e38\u89e3\u6790\u5668\u6df7\u5408\u5668\uff0c\u5185\u90e8\u5b58\u5728\u96c6\u5408\u5b58\u50a8\u591a\u79cd\u5f02\u5e38\u89e3\u6790\u5668 <code>SimpleMappingExceptionResolver</code> \u7b80\u5355\u6620\u5c04\u5f02\u5e38\u5904\u7406\u5668\uff0c\u53ef\u4ee5\u914d\u7f6e\u5f02\u5e38\u4e0e\u5bf9\u5e94\u7684\u9519\u8bef\u89c6\u56fe <code>ExceptionHandlerExceptionResolver</code> \u5f02\u5e38\u5904\u7406\u5668\u5f02\u5e38\u89e3\u6790\u5668\uff0c\u9ed8\u8ba4\u4f1a\u88ab\u6ce8\u518c\u5230Spring\u5bb9\u5668\u4e2d\uff0c@ExceptionHandler\u65b9\u5f0f\u5f02\u5e38\u5904\u7406\u5c31\u662f\u8be5\u89e3\u6790\u5668\u89e3\u6790\u7684 <code>DefaultHandlerExceptionResolver</code> \u9ed8\u8ba4\u5904\u7406\u5668\u5f02\u5e38\u89e3\u6790\u5668\uff0c\u6240\u6709\u5f02\u5e38\u5904\u7406\u5668\u90fd\u4e0d\u5339\u914d\u65f6\uff0c\u6700\u540e\u6267\u884c\u7684\u5f02\u5e38\u5904\u7406\u5668 <code>ResponseStatusExceptionResolver</code> \u54cd\u5e94\u72b6\u6001\u5f02\u5e38\u89e3\u6790\u5668\uff0c\u7ed3\u5408\u4f7f\u7528@ResponseStatus\u6807\u6ce8\u7684\u5f02\u5e38\u4f7f\u7528 <p>\u4e0a\u4e00\u8282\uff1aSpring Web</p> <p>(/\u2267\u25bd\u2266)/</p>"},{"location":"Spring/Spring-Overview/","title":"\u6982\u8ff0","text":"<p>Spring \u5b98\u65b9\u8d44\u6e90</p> <p>\u5b98\u65b9\u7f51\u7ad9\uff1a www.spring.io \u6587\u6863\u5730\u5740\uff1a Spring Framework Documentation</p>"},{"location":"Spring/Spring-Overview/#\u4f20\u7edfjavaweb\u5f00\u53d1\u7684\u95ee\u9898","title":"\u4f20\u7edfJavaWeb\u5f00\u53d1\u7684\u95ee\u9898","text":""},{"location":"Spring/Spring-Overview/#iocdi\u548caop\u601d\u60f3\u63d0\u51fa","title":"IoC\u3001DI\u548cAOP\u601d\u60f3\u63d0\u51fa","text":""},{"location":"Spring/Spring-Overview/#ioc","title":"IoC","text":"<p>IoC\u601d\u60f3\uff1a Inversion of Control\uff0c\u7ffb\u8bd1\u4e3a\u201c\u63a7\u5236\u53cd\u8f6c\u201d\uff0c\u5f3a\u8c03\u7684\u662f\u539f\u6765\u5728\u7a0b\u5e8f\u4e2d\u521b\u5efaBean\u7684\u6743\u5229\u53cd\u8f6c\u7ed9\u7b2c\u4e09\u65b9\u3002</p> <p>\u4e3e\u4f8b\u8bf4\u660e</p> <p>\u539f\u6765\u5728\u7a0b\u5e8f\u4e2d\u624b\u52a8new UserServiceImpl()\uff0c\u624b\u52a8new UserDaoImpl()\u3002</p> <p>\u800c\u6839\u636eIoC\u601d\u60f3\u7684\u6307\u5bfc\uff0c\u4f7f\u7528\u4e00\u4e2a\u7b2c\u4e09\u65b9\u53bb\u521b\u5efaUserServiceImpl\u5bf9\u8c61\u548cUserDaoImpl\u5bf9\u8c61\u3002</p> <p>\u8fd9\u6837\u7a0b\u5e8f\u4e0e\u5177\u4f53\u5bf9\u8c61\u5c31\u5931\u53bb\u7684\u76f4\u63a5\u8054\u7cfb\uff08\u89e3\u8026\uff09\u3002</p> <ol> <li> <p>\u8c01\u53bb\u5145\u5f53\u7b2c\u4e09\u65b9\u89d2\u8272\u5462\uff1f</p> <p>\u5de5\u5382\u8bbe\u8ba1\u6a21\u5f0f\uff0cBeanFactory\u6765\u5145\u5f53\u7b2c\u4e09\u65b9\u7684\u89d2\u8272\uff0c\u6765\u4ea7\u751fBean\u5b9e\u4f8b</p> </li> <li> <p>BeanFactory\u600e\u4e48\u77e5\u9053\u4ea7\u751f\u54ea\u4e9bBean\u5b9e\u4f8b\u5462\uff1f</p> <p>\u53ef\u4ee5\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u914d\u7f6eBean\u7684\u57fa\u672c\u4fe1\u606f\uff0cBeanFactory\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u6765\u751f\u4ea7Bean\u5b9e\u4f8b</p> </li> </ol> <p></p>"},{"location":"Spring/Spring-Overview/#di","title":"DI","text":"<p>DI\uff08Dependency Injection\uff0c\u4f9d\u8d56\u6ce8\u5165\uff09\u662f\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u5b9e\u73b0\u63a7\u5236\u53cd\u8f6c\uff08IoC\uff09\u3002\u5b83\u901a\u8fc7\u5c06\u5bf9\u8c61\u7684\u4f9d\u8d56\u5173\u7cfb\uff08\u5373\u6240\u9700\u7684\u5176\u4ed6\u5bf9\u8c61\uff09\u4ece\u5185\u90e8\u786c\u7f16\u7801\u5230\u5916\u90e8\u914d\u7f6e\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u89e3\u8026\u3002</p> <p>\u4e0a\u9762\u4f7f\u7528BeanFactory\u7684\u65b9\u5f0f\u5df2\u7ecf\u5b9e\u73b0\u7684\"\u63a7\u5236\u53cd\u8f6c\"\uff0c\u5c06Bean\u7684\u521b\u5efa\u6743\u4ea4\u7ed9\u4e86BeanFactory\uff0c\u5982\u679c\u6211\u4eec\u60f3\u5c06UserDao\u7684\u521b\u5efa\u6743\u4e5f\u53cd\u8f6c\u7ed9BeanFactory\uff0c\u4e0e\u6b64\u540c\u65f6UserService\u5185\u90e8\u8fd8\u9700\u8981\u7528\u5230UserDao\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u90a3\u5e94\u8be5\u600e\u6837\u64cd\u4f5c\u5462\uff1f</p> <ol> <li> <p>\u5728\u7a0b\u5e8f\u4e2d\uff0c\u901a\u8fc7BeanFactory\u83b7\u5f97UserService </p> </li> <li> <p>\u5728\u7a0b\u5e8f\u4e2d\uff0c\u901a\u8fc7BeanFactory\u83b7\u5f97UserDao </p> </li> <li> <p>\u5728\u7a0b\u5e8f\u4e2d\uff0c\u5c06UserDao\u8bbe\u7f6e\u7ed9UserService</p> </li> </ol> <p>\u5c06UserDao\u5728BeanFactory\u5185\u90e8\u8bbe\u7f6e\u7ed9UserService\u7684\u8fc7\u7a0b\u53eb\u505a\u201c\u6ce8\u5165\u201d\uff0c\u800cUserService\u9700\u8981\u4f9d\u8d56UserDao\u7684\u6ce8\u5165\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a\u201c\u4f9d\u8d56\u6ce8\u5165\u201d</p> <p></p> <p>IoC \u548cDI \u7684\u5173\u7cfb\uff1f</p> <p>\u9996\u5148\uff0cIoC\u548cDI\u662f\u4ec0\u4e48\uff1a</p> <ul> <li>IoC\uff1a Inversion of Control\uff0c\u63a7\u5236\u53cd\u8f6c\uff0c\u5c06Bean\u7684\u521b\u5efa\u6743\u7531\u539f\u6765\u7a0b\u5e8f\u53cd\u8f6c\u7ed9\u7b2c\u4e09\u65b9</li> <li>DI\uff1aDependency Injection\uff0c\u4f9d\u8d56\u6ce8\u5165\uff0c\u67d0\u4e2aBean\u7684\u5b8c\u6574\u521b\u5efa\u4f9d\u8d56\u4e8e\u5176\u4ed6Bean\uff08\u6216\u666e\u901a\u53c2\u6570\uff09\u7684\u6ce8\u5165</li> </ul> <p>\u5176\u6b21\uff0cIoC\u548cDI\u7684\u5173\u7cfb\uff1a</p> <ul> <li>\u7b2c\u4e00\u79cd\u89c2\u70b9\uff1aIoC\u5f3a\u8c03\u7684\u662fBean\u521b\u5efa\u6743\u7684\u53cd\u8f6c\uff0c\u800cDI\u5f3a\u8c03\u7684\u662fBean\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5e76\u4e0d\u76f8\u540c</li> <li>\u7b2c\u4e8c\u79cd\u89c2\u70b9\uff1aIoC\u5f3a\u8c03\u7684\u662fBean\u521b\u5efa\u6743\u7684\u53cd\u8f6c\uff0c\u800cDI\u5f3a\u8c03\u7684\u662f\u901a\u8fc7\u6ce8\u5165\u7684\u65b9\u5f0f\u53cd\u8f6cBean\u7684\u521b\u5efa\u6743\uff0c\u8ba4\u4e3aDI\u662fIoC\u7684\u5176\u4e2d\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f</li> </ul>"},{"location":"Spring/Spring-Overview/#aop","title":"AOP","text":"<p>AOP\uff0cAspect Oriented Programming\uff0c\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff0c\u662f\u5bf9\u9762\u5411\u5bf9\u8c61\u7f16\u7a0bOOP\u7684\u5347\u534e\u3002OOP\u662f\u7eb5\u5411\u5bf9\u4e00\u4e2a\u4e8b\u7269\u7684\u62bd\u8c61\uff0c\u4e00\u4e2a\u5bf9\u8c61\u5305\u62ec\u9759\u6001\u7684\u5c5e\u6027\u4fe1\u606f\uff0c\u5305\u62ec\u52a8\u6001\u7684\u65b9\u6cd5\u4fe1\u606f\u7b49\u3002\u800cAOP\u662f\u6a2a\u5411\u7684\u5bf9\u4e0d\u540c\u4e8b\u7269\u7684\u62bd\u8c61\uff0c\u5c5e\u6027\u4e0e\u5c5e\u6027\u3001\u65b9\u6cd5\u4e0e\u65b9\u6cd5\u3001\u5bf9\u8c61\u4e0e\u5bf9\u8c61\u90fd\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u5207\u9762\uff0c\u800c\u7528\u8fd9\u79cd\u601d\u7ef4\u53bb\u8bbe\u8ba1\u7f16\u7a0b\u7684\u65b9\u5f0f\u53eb\u505a\u9762\u5411\u5207\u9762\u7f16\u7a0b</p>"},{"location":"Spring/Spring-Overview/#beanfactory\u5feb\u901f\u5165\u95e8","title":"BeanFactory\u5feb\u901f\u5165\u95e8","text":"<ol> <li> <p>\u5bfc\u5165Spring\u7684jar\u5305\u6216Maven\u5750\u6807\uff1b</p> </li> <li> <p>\u5b9a\u4e49UserService\u63a5\u53e3\u53ca\u5176UserServiceImpl\u5b9e\u73b0\u7c7b\uff1b</p> </li> <li> <p>\u521b\u5efabeans.xml\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06UserServiceImpl\u7684\u4fe1\u606f\u914d\u7f6e\u5230\u8be5xml\u4e2d\uff1b</p> </li> <li> <p>\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801\uff0c\u521b\u5efaBeanFactory\uff0c\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u83b7\u53d6UserService\u5b9e\u4f8b\u5bf9\u8c61\u3002</p> </li> </ol> <p></p> <ul> <li>\u5bfc\u5165\u4f9d\u8d56</li> </ul> <pre><code>&lt;!--Spring\u6838\u5fc3--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n    &lt;version&gt;5.3.19&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <ul> <li>\u5b9a\u4e49\u63a5\u53e3</li> </ul> <pre><code>public interface UserService {}\npublic class UserServiceImpl implements UserService {}\n</code></pre> <ul> <li>\u521b\u5efabeans.xml\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06UserServiceImpl\u7684\u4fe1\u606f\u914d\u7f6e\u5230\u8be5xml\u4e2d\uff1b</li> </ul> <pre><code>&lt;!--\u914d\u7f6eUserServiceImpl--&gt;\n&lt;bean class=\"org.example.service.impl.UserServiceImpl\" id=\"userService\"/&gt;\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <pre><code>//\u521b\u5efaBeanFactory\n DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();\n //\u521b\u5efa\u8bfb\u53d6\u5668\nXmlBeanDefinitionReader reader = new XmlBeanDefinitionReader(beanFactory);\n //\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nreader.loadBeanDefinitions(\"beans.xml\");\n //\u83b7\u53d6Bean\u5b9e\u4f8b\u5bf9\u8c61\nUserDao userService = (UserService) beanFactory.getBean(\"userService\");\n</code></pre> <p></p> <p>\u4e0a\u9762\u4f7f\u7528BeanFactory\u5b8c\u6210\u4e86IoC\u601d\u60f3\u7684\u5b9e\u73b0\uff0c\u4e0b\u9762\u53bb\u5b9e\u73b0DI\u4f9d\u8d56\u6ce8\u5165\uff1a</p> <ol> <li> <p>\u5b9a\u4e49UserDao\u63a5\u53e3\u53ca\u5176UserDaoImpl\u5b9e\u73b0\u7c7b\uff1b</p> </li> <li> <p>\u4fee\u6539UserServiceImpl\u4ee3\u7801\uff0c\u6dfb\u52a0\u4e00\u4e2asetUserDao(UserDao userDao)\u7528\u4e8e\u63a5\u6536\u6ce8\u5165\u7684\u5bf9\u8c61\uff1b</p> </li> <li> <p>\u4fee\u6539beans.xml\u914d\u7f6e\u6587\u4ef6\uff0c\u5728UserDaoImpl\u7684\u4e2d\u5d4c\u5165\u914d\u7f6e\u6ce8\u5165\uff1b</p> </li> <li> <p>\u4fee\u6539\u6d4b\u8bd5\u4ee3\u7801\uff0c\u83b7\u5f97UserService\u65f6\uff0csetUserService\u65b9\u6cd5\u6267\u884c\u4e86\u6ce8\u5165\u64cd\u4f5c\u3002</p> </li> </ol> <p> </p> <ul> <li>\u5b9a\u4e49UserDao\u63a5\u53e3\u53ca\u5176UserDaoImpl\u5b9e\u73b0\u7c7b\uff1b</li> </ul> <pre><code>public interface UserDao {}\npublic class UserDaoImpl implements UserDao {}\n</code></pre> <ul> <li>\u4fee\u6539UserServiceImpl\u4ee3\u7801\uff0c\u6dfb\u52a0\u4e00\u4e2asetUserDao(UserDao userDao)\u7528\u4e8e\u63a5\u6536\u6ce8\u5165\u7684\u5bf9\u8c61\uff1b</li> </ul> <pre><code>public class UserServiceImpl implements UserService {\n    private UserDao userDao;\n    //Bean\u5de5\u5382\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\n    public void setUserDao(UserDao userDao){\n        System.out.println(\"\u8c03\u7528\u4e86setUserDao\u65b9\u6cd5\");\n        this.userDao = userDao;\n    }\n}\n</code></pre> <ul> <li>\u4fee\u6539beans.xml\u914d\u7f6e\u6587\u4ef6\uff0c\u5728UserDaoImpl\u7684\u4e2d\u5d4c\u5165\u914d\u7f6e\u6ce8\u5165\uff1b</li> </ul> <pre><code>&lt;!--\u914d\u7f6eUserServiceImpl--&gt;\n&lt;bean class=\"org.example.service.impl.UserServiceImpl\" id=\"userService\"&gt;\n    &lt;property name=\"userDao\" ref=\"userDao\"/&gt;\n&lt;/bean&gt;\n\n&lt;!--\u914d\u7f6eUserDaoImpl--&gt;\n&lt;bean class=\"org.example.dao.impl.UserDaoImpl\" id=\"userDao\"/&gt;\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <pre><code>//\u521b\u5efaBeanFactory\n DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();\n //\u521b\u5efa\u8bfb\u53d6\u5668\nXmlBeanDefinitionReader reader = new XmlBeanDefinitionReader(beanFactory);\n //\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nreader.loadBeanDefinitions(\"beans.xml\");\n //\u83b7\u53d6Bean\u5b9e\u4f8b\u5bf9\u8c61\nUserDao userService = (UserService) beanFactory.getBean(\"userService\");\n</code></pre>"},{"location":"Spring/Spring-Overview/#applicationcontext\u5feb\u901f\u5165\u95e8","title":"ApplicationContext\u5feb\u901f\u5165\u95e8","text":"<p>ApplicationContext \u79f0\u4e3aSpring\u5bb9\u5668\uff0c\u5185\u90e8\u5c01\u88c5\u4e86BeanFactory\uff0c\u6bd4BeanFactory\u529f\u80fd\u66f4\u4e30\u5bcc\u66f4\u5f3a\u5927\uff0c\u4f7f\u7528ApplicationContext \u8fdb\u884c\u5f00\u53d1\u65f6\uff0cxml\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u79f0\u4e60\u60ef\u5199\u6210applicationContext.xml</p> <pre><code>//\u521b\u5efaApplicationContext,\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u5b9e\u4f8b\u5316\u5bb9\u5668\nApplicationContext applicationContext = new ClassPathxmlApplicationContext(\"applicationContext.xml\");\n//\u6839\u636ebeanName\u83b7\u5f97\u5bb9\u5668\u4e2d\u7684Bean\u5b9e\u4f8b\nUserService userService = (UserService) applicationContext.getBean(\"userService\");\nSystem.out.println(userService);\n</code></pre>"},{"location":"Spring/Spring-Overview/#beanfactory\u4e0eapplicationcontext\u7684\u5173\u7cfb","title":"BeanFactory\u4e0eApplicationContext\u7684\u5173\u7cfb","text":"<ol> <li> <p>BeanFactory\u662fSpring\u7684\u65e9\u671f\u63a5\u53e3\uff0c\u79f0\u4e3aSpring\u7684Bean\u5de5\u5382\uff0cApplicationContext\u662f\u540e\u671f\u66f4\u9ad8\u7ea7\u63a5\u53e3\uff0c\u79f0\u4e4b\u4e3aSpring \u5bb9\u5668\uff1b</p> </li> <li> <p>ApplicationContext\u5728BeanFactory\u57fa\u7840\u4e0a\u5bf9\u529f\u80fd\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u4f8b\u5982\uff1a\u76d1\u542c\u529f\u80fd\u3001\u56fd\u9645\u5316\u529f\u80fd\u7b49\u3002BeanFactory\u7684API\u66f4\u504f\u5411\u5e95\u5c42\uff0cApplicationContext\u7684API\u5927\u591a\u6570\u662f\u5bf9\u8fd9\u4e9b\u5e95\u5c42API\u7684\u5c01\u88c5\uff1b</p> </li> <li> <p>Bean\u521b\u5efa\u7684\u4e3b\u8981\u903b\u8f91\u548c\u529f\u80fd\u90fd\u88ab\u5c01\u88c5\u5728BeanFactory\u4e2d\uff0cApplicationContext\u4e0d\u4ec5\u7ee7\u627f\u4e86BeanFactory\uff0c\u800c\u4e14ApplicationContext\u5185\u90e8\u8fd8\u7ef4\u62a4\u7740BeanFactory\u7684\u5f15\u7528\uff0c\u6240\u4ee5\uff0cApplicationContext\u4e0eBeanFactory\u65e2\u6709\u7ee7\u627f\u5173\u7cfb\uff0c\u53c8\u6709\u878d\u5408\u5173\u7cfb\u3002</p> </li> <li> <p>Bean\u7684\u521d\u59cb\u5316\u65f6\u673a\u4e0d\u540c\uff0c\u539f\u59cbBeanFactory\u662f\u5728\u9996\u6b21\u8c03\u7528getBean\u65f6\u624d\u8fdb\u884cBean\u7684\u521b\u5efa\uff0c\u800cApplicationContext\u5219\u662f\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\uff0c\u5bb9\u5668\u4e00\u521b\u5efa\u5c31\u5c06Bean\u90fd\u5b9e\u4f8b\u5316\u5e76\u521d\u59cb\u5316\u597d\u3002</p> </li> </ol> <p>\u53ea\u5728Spring\u57fa\u7840\u73af\u5883\u4e0b\uff0c\u5e38\u7528\u7684\u4e09\u4e2aApplicationContext\u4f5c\u7528\u5982\u4e0b\uff1a</p> \u5b9e\u73b0\u7c7b \u529f\u80fd\u63cf\u8ff0 <code>ClassPathXmlApplicationContext</code> \u52a0\u8f7d\u7c7b\u8def\u5f84\u4e0b\u7684xml\u914d\u7f6e\u7684ApplicationContext <code>FileSystemXmlApplicationContext</code> \u52a0\u8f7d\u78c1\u76d8\u8def\u5f84\u4e0b\u7684xml\u914d\u7f6e\u7684ApplicationContext <code>AnnotationConfigApplicationContext</code> \u52a0\u8f7d\u6ce8\u89e3\u914d\u7f6e\u7c7b\u7684ApplicationContext <p>\u4e0b\u4e00\u8282\uff1a \u57fa\u4e8eXML\u7684Spring\u5e94\u7528</p>"},{"location":"Spring/Spring-Web/","title":"Spring\u6574\u5408Web\u73af\u5883","text":""},{"location":"Spring/Spring-Web/#javaweb\u4e09\u5927\u7ec4\u4ef6","title":"Javaweb\u4e09\u5927\u7ec4\u4ef6","text":"\u7ec4\u4ef6 \u4f5c\u7528 \u7279\u70b9 <code>Servlet</code> \u670d\u52a1\u7aef\u5c0f\u7a0b\u5e8f\uff0c\u8d1f\u8d23\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u5e76\u4f5c\u51fa\u54cd\u5e94\u7684 \u5355\u4f8b\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u7b2c\u4e00\u6b21\u8bbf\u95ee\u521b\u5efa\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6307\u5b9a\u670d\u52a1\u5668\u542f\u52a8\u5c31\u521b\u5efa\uff0cServlet\u521b\u5efa\u5b8c\u6bd5\u4f1a\u6267\u884c\u521d\u59cb\u5316init\u65b9\u6cd5\u3002\u6bcf\u4e2aServlet\u6709\u4e00\u4e2aservice\u65b9\u6cd5\uff0c\u6bcf\u6b21\u8bbf\u95ee\u90fd\u4f1a\u00a0\u6267\u884cservice\u65b9\u6cd5\uff0c\u4f46\u662f\u7f3a\u70b9\u662f\u4e00\u4e2a\u4e1a\u52a1\u529f\u80fd\u5c31\u9700\u8981\u914d\u7f6e\u4e00\u4e2aServlet <code>Filter</code> \u8fc7\u6ee4\u5668\uff0c\u8d1f\u8d23\u5bf9\u5ba2\u6237\u7aef\u8bf7\u6c42\u8fdb\u884c\u8fc7\u6ee4\u64cd\u4f5c\u7684 \u5355\u4f8b\u5bf9\u8c61\uff0c\u670d\u52a1\u5668\u542f\u52a8\u65f6\u5c31\u521b\u5efa\uff0c\u5bf9\u8c61\u521b\u5efa\u5b8c\u6bd5\u6267\u884cinit\u65b9\u6cd5\uff0c\u5bf9\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8fdb\u884c\u8fc7\u6ee4\uff0c\u7b26\u5408\u8981\u6c42\u7684\u653e\u884c\uff0c\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u76f4\u63a5\u54cd\u5e94\u5ba2\u6237\u7aef\uff0c\u6267\u884c\u8fc7\u6ee4\u7684\u6838\u5fc3\u65b9\u6cd5doFilter <code>Listener</code> \u76d1\u542c\u5668\uff0c\u8d1f\u8d23\u5bf9\u57df\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u5c5e\u6027\u53d8\u5316\u8fdb\u884c\u76d1\u542c\u7684 \u6839\u636e\u7c7b\u578b\u548c\u4f5c\u7528\u4e0d\u540c\uff0c\u53c8\u53ef\u5206\u4e3a\u76d1\u542c\u57df\u5bf9\u8c61\u521b\u5efa\u9500\u6bc1\u548c\u57df\u5bf9\u8c61\u5c5e\u6027\u5185\u5bb9\u53d8\u5316\u7684\uff0c\u6839\u636e\u76d1\u542c\u7684\u57df\u4e0d\u540c\uff0c\u53c8\u53ef\u4ee5\u5206\u4e3a\u76d1\u542cRequest\u57df\u7684\uff0c\u76d1\u542cSession\u57df\u7684\uff0c\u76d1\u542cServletContext\u57df\u7684"},{"location":"Spring/Spring-Web/#\u6574\u5408web\u7684\u601d\u8def\u53ca\u5b9e\u73b0","title":"\u6574\u5408Web\u7684\u601d\u8def\u53ca\u5b9e\u73b0","text":"<p>\u5728\u8fdb\u884cJava\u5f00\u53d1\u65f6\u8981\u9075\u5faa\u4e09\u5c42\u67b6\u6784+MVC\uff0cSpring\u64cd\u4f5c\u6700\u6838\u5fc3\u7684\u5c31\u662fSpring\u5bb9\u5668\uff0cweb\u5c42\u9700\u8981\u6ce8\u5165Service\uff0cservice\u5c42\u9700\u8981\u6ce8\u5165Dao\uff08Mapper\uff09\uff0cweb\u5c42\u4f7f\u7528Servlet\u6280\u672f\u5145\u5f53\u7684\u8bdd\uff0c\u9700\u8981\u5728Servlet\u4e2d\u83b7\u5f97Spring\u5bb9\u5668</p> <pre><code>AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(ApplicationContextConfig.class);\nAccountService accountService = (AccountService)applicationContext.getBean(\"accountService\");\naccountService.transferMoney(\"tom\",\"lucy\",100);\n</code></pre> <p>web\u5c42\u4ee3\u7801\u5982\u679c\u90fd\u53bb\u52a0\u8f7dSpring\u5bb9\u5668\u90a3\u4e48\u5c31\u91cd\u590d\u4e86\uff0c\u4e0d\u80fd\u6bcf\u6b21\u60f3\u4ece\u5bb9\u5668\u4e2d\u83b7\u5f97\u4e00\u4e2aBean\u90fd\u5f97\u5148\u521b\u5efa\u4e00\u6b21\u5bb9\u5668\u3002</p> <p>\u9700\u8981\u5b9e\u73b0\u5982\u4e0b\u8981\u6c42\uff1a</p> <ul> <li> <p>ApplicationContext\u521b\u5efa\u4e00\u6b21\uff0c\u914d\u7f6e\u7c7b\u52a0\u8f7d\u4e00\u6b21;</p> </li> <li> <p>\u6700\u597dweb\u670d\u52a1\u5668\u542f\u52a8\u65f6\uff0c\u5c31\u6267\u884c\u7b2c1\u6b65\u64cd\u4f5c\uff0c\u540e\u7eed\u76f4\u63a5\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6Bean\u4f7f\u7528\u5373\u53ef;</p> </li> <li> <p>ApplicationContext\u7684\u5f15\u7528\u9700\u8981\u5728web\u5c42\u4efb\u4f55\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u3002</p> </li> </ul> <p>\u7ed9\u51fa\u89e3\u51b3\u601d\u8def\uff0c\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u5728ServletContextListener\u7684contextInitialized\u65b9\u6cd5\u4e2d\u6267\u884cApplicationContext\u7684\u521b\u5efa\u3002\u6216\u5728Servlet\u7684init\u65b9\u6cd5\u4e2d\u6267\u884cApplicationContext\u7684\u521b\u5efa\uff0c\u5e76\u7ed9Servlet\u7684load-on-startup\u5c5e\u6027\u4e00\u4e2a\u6570\u5b57\u503c\uff0c\u786e\u4fdd\u670d\u52a1\u5668\u542f\u52a8Servlet\u5c31\u521b\u5efa;</p> </li> <li> <p>\u5c06\u521b\u5efa\u597d\u7684ApplicationContext\u5b58\u50a8\u5230<code>ServletContext</code>\u57df\u4e2d\uff0c\u8fd9\u6837\u6574\u4e2aweb\u5c42\u4efb\u4f55\u4f4d\u7f6e\u5c31\u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u4e86</p> </li> </ul> <pre><code>public class SpringContextListener implements ServletContextListener {\n\n    @Override\n    public void contextInitialized(ServletContextEvent sce) {\n        // \u521b\u5efaSpring\u7684IoC\u5bb9\u5668\n        ApplicationContext context = new ClassPathXmlApplicationContext(\"applicationContext.xml\");\n        // \u5c06Spring\u7684IoC\u5bb9\u5668\u4fdd\u5b58\u5230ServletContext\u4e2d\n        sce.getServletContext().setAttribute(\"applicationContext\", context);\n\n        ServletContextListener.super.contextInitialized(sce);\n    }\n}\n</code></pre>"},{"location":"Spring/Spring-Web/#web\u5f00\u53d1\u7ec4\u4ef6spring-web","title":"web\u5f00\u53d1\u7ec4\u4ef6spring-web","text":"<p>\u5bfc\u5165\u4f9d\u8d56(<code>pom.xml</code>)\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-web&lt;/artifactId&gt;\n    &lt;version&gt;6.1.14&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u914d\u7f6e(<code>web.xml</code>)</p> <pre><code>&lt;!-- \u5b9a\u4e49\u5168\u5c40\u53c2\u6570 --&gt;\n&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;\n&lt;/context-param&gt;\n\n&lt;!-- \u5b9a\u4e49Spring\u76d1\u542c\u5668 --&gt;\n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n</code></pre> <p>\u4f7f\u7528spring\u5bb9\u5668</p> <pre><code>ServletContext servletContext = getServletContext();\nWebApplicationContext app = WebApplicationContextUtils.getWebApplicationContext(servletContext);\n</code></pre> <p>\u5982\u679c\u6838\u5fc3\u914d\u7f6e\u7c7b\u4f7f\u7528\u7684\u662f\u6ce8\u89e3\u5f62\u5f0f\u7684\uff0c\u90a3\u4e48Spring\u5bb9\u5668\u662fAnnotationConfigWebApplicationContext\uff0c\u5982\u4e0b\u914d\u7f6e\u65b9\u5f0f</p> <pre><code>public class MyAnnotationConfigWebApplicationContext extends AnnotationConfigWebApplicationContext {\n    public MyAnnotationConfigWebApplicationContext(){\n        super();\n        //\u6ce8\u518c\u6838\u5fc3\u914d\u7f6e\u7c7b\n        super.register(ApplicationContextConfig.class);\n    }\n}\n</code></pre> <p><code>web.xml</code></p> <pre><code>&lt;context-param&gt;\n    &lt;param-name&gt;contextClass&lt;/param-name&gt;\n    &lt;param-value&gt;com.ysh.web.MyAnnotationConfigWebApplicationContext&lt;/param-value&gt;\n&lt;/context-param&gt;\n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n</code></pre>"},{"location":"Spring/Spring-Web/#web\u5c42mvc\u6846\u67b6\u601d\u60f3\u4e0e\u8bbe\u8ba1\u601d\u8def","title":"web\u5c42MVC\u6846\u67b6\u601d\u60f3\u4e0e\u8bbe\u8ba1\u601d\u8def","text":"<p>\u539f\u59cbJavaweb\u5f00\u53d1\u4e2d\uff0cServlet\u5145\u5f53Controller\u7684\u89d2\u8272\uff0cJsp\u5145\u5f53View\u89d2\u8272\uff0cJavaBean\u5145\u5f53\u6a21\u578b\u89d2\u8272\uff0c\u540e\u671fAjax\u5f02\u6b65\u6d41\u884c\u540e\uff0c\u518d\u52a0\u4e0a\u73b0\u5728\u524d\u540e\u7aef\u5206\u79bb\u5f00\u53d1\u6a21\u5f0f\u6210\u719f\u540e\uff0cView\u5c31\u88ab\u539f\u59cbHtml+Vue\u66ff\u4ee3\u3002\u539f\u59cbJavaweb\u5f00\u53d1\u4e2d\uff0cServlet\u5145\u5f53Controller\u6709\u5f88\u591a\u5f0a\u7aef\uff0c\u663e\u800c\u6613\u89c1\u7684\u6709\u5982\u4e0b\u51e0\u4e2a\uff1a</p> Servlet\u4f5c\u4e3aController\u7684\u95ee\u9898 \u89e3\u51b3\u601d\u8def\u548c\u65b9\u6848 \u6bcf\u4e2a\u4e1a\u52a1\u529f\u80fd\u8bf7\u6c42\u90fd\u5bf9\u5e94\u4e00\u4e2aServlet \u6839\u636e\u4e1a\u52a1\u6a21\u5757\u53bb\u5212\u5206Controller \u6bcf\u4e2aServlet\u7684\u4e1a\u52a1\u64cd\u4f5c\u592a\u7e41\u7410 \u5c06\u901a\u7528\u7684\u884c\u4e3a\uff0c\u529f\u80fd\u8fdb\u884c\u62bd\u53d6\u5c01\u88c5 Servlet\u83b7\u5f97Spring\u5bb9\u5668\u7684\u7ec4\u4ef6\u53ea\u80fd\u901a\u8fc7\u5ba2\u6237\u7aef\u4ee3\u7801\u53bb\u83b7\u53d6\uff0c\u4e0d\u80fd\u65b9\u4fbf\u7684\u6574\u5408 \u901a\u8fc7Spring\u7684\u6269\u5c55\u70b9\uff0c\u5c01\u88c5\u4e00\u4e2a\u6846\u67b6\u589e\u5f3aServlet <p>\u8d1f\u8d23\u5171\u6709\u884c\u4e3a\u7684Servlet\u79f0\u4e4b\u4e3a\u524d\u7aef\u63a7\u5236\u5668\uff0c\u8d1f\u8d23\u4e1a\u52a1\u884c\u4e3a\u7684JavaBean\u79f0\u4e4b\u4e3a\u63a7\u5236\u5668Controller</p> <p></p> <p>\u5206\u6790\u524d\u7aef\u63a7\u5236\u5668\u57fa\u672c\u529f\u80fd\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5177\u5907\u53ef\u4ee5\u6620\u5c04\u5230\u4e1a\u52a1Bean\u7684\u80fd\u529b</p> </li> <li> <p>\u5177\u5907\u53ef\u4ee5\u89e3\u6790\u8bf7\u6c42\u53c2\u6570\u3001\u5c01\u88c5\u5b9e\u4f53\u7b49\u5171\u6709\u529f\u80fd</p> </li> <li> <p>\u5177\u5907\u54cd\u5e94\u89c6\u56fe\u53ca\u54cd\u5e94\u5176\u4ed6\u6570\u636e\u7684\u529f\u80fd</p> </li> </ol> <p>\u4e0a\u4e00\u8282\uff1a Spring AOP</p> <p>\u4e0b\u4e00\u8282\uff1a Spring MVC</p>"},{"location":"Spring/Spring-XML/","title":"\u57fa\u4e8eXML\u7684Spring\u5e94\u7528","text":""},{"location":"Spring/Spring-XML/#\u5e38\u7528\u914d\u7f6e","title":"\u5e38\u7528\u914d\u7f6e","text":"<p>Spring\u5f00\u53d1\u4e2d\u4e3b\u8981\u662f\u5bf9Bean\u7684\u914d\u7f6e\uff0cBean\u7684\u5e38\u7528\u914d\u7f6e\u4e00\u89c8\u5982\u4e0b\uff1a</p> Xml\u914d\u7f6e\u65b9\u5f0f \u529f\u80fd\u63cf\u8ff0 <code>&lt;bean id=\"\" class=\"\" /&gt;</code> Bean\u7684id\u548c\u5168\u9650\u5b9a\u540d\u914d\u7f6e <code>&lt;bean name=\"\" /&gt;</code> \u901a\u8fc7name\u8bbe\u7f6eBean\u7684\u522b\u540d\uff0c\u901a\u8fc7\u522b\u540d\u4e5f\u80fd\u76f4\u63a5\u83b7\u53d6\u5230Bean\u5b9e\u4f8b <code>&lt;bean scope=\"\" /&gt;</code> Bean\u7684\u4f5c\u7528\u8303\u56f4\uff0cBeanFactory\u4f5c\u4e3a\u5bb9\u5668\u65f6\u53d6\u503csingleton\u548cprototype <code>&lt;bean lazy-init=\"\" /&gt;</code> Bean\u7684\u5b9e\u4f8b\u5316\u65f6\u673a\uff0c\u662f\u5426\u5ef6\u8fdf\u52a0\u8f7d\u3002BeanFactory\u4f5c\u4e3a\u5bb9\u5668\u65f6\u65e0\u6548 <code>&lt;bean init-method=\"\" /&gt;</code> Bean\u5b9e\u4f8b\u5316\u540e\u81ea\u52a8\u6267\u884c\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0cmethod\u6307\u5b9a\u65b9\u6cd5\u540d <code>&lt;bean destroy-method=\"\" /&gt;</code> Bean\u5b9e\u4f8b\u9500\u6bc1\u524d\u7684\u65b9\u6cd5\uff0cmethod\u6307\u5b9a\u65b9\u6cd5\u540d <code>&lt;bean autowire=\"byType\" /&gt;</code> \u8bbe\u7f6e\u81ea\u52a8\u6ce8\u5165\u6a21\u5f0f\uff0c\u5e38\u7528\u7684\u6709\u6309\u7167\u7c7b\u578bbyType\uff0c\u6309\u7167\u540d\u5b57byName <code>&lt;bean factory-bean=\"\" factory-method=\"\" /&gt;</code> \u6307\u5b9a\u54ea\u4e2a\u5de5\u5382Bean\u7684\u54ea\u4e2a\u65b9\u6cd5\u5b8c\u6210Bean\u7684\u521b\u5efa <p>\u6ce8\u610f</p> <p>\u5982\u679c\u4e0d\u914d\u7f6eid\uff0c\u5219Spring\u4f1a\u628a\u5f53\u524dBean\u5b9e\u4f8b\u7684\u5168\u9650\u5b9a\u540d\u4f5c\u4e3abeanName</p> <p></p>"},{"location":"Spring/Spring-XML/#bean\u7684\u522b\u540d\u914d\u7f6e","title":"Bean\u7684\u522b\u540d\u914d\u7f6e","text":"<p>\u53ef\u4ee5\u4e3a\u5f53\u524dBean\u6307\u5b9a\u591a\u4e2a\u522b\u540d\uff0c\u6839\u636e\u522b\u540d\u4e5f\u53ef\u4ee5\u83b7\u5f97Bean\u5bf9\u8c61\u6b64\u65f6\u591a\u4e2a\u540d\u79f0\u90fd\u53ef\u4ee5\u83b7\u5f97UserDaoImpl\u5b9e\u4f8b\u5bf9\u8c61</p> <pre><code>&lt;bean id=\"userDao\" name=\"aaa,bbb\" class=\"com.itheima.dao.impl.UserDaoImpl\"/&gt;\n</code></pre> <p><pre><code>applicationContext.getBean(\"userDao\");\napplicationContext.getBean(\"aaa\");\napplicationContext.getBean(\"bbb\");\n</code></pre> </p>"},{"location":"Spring/Spring-XML/#bean\u7684\u8303\u56f4\u914d\u7f6e","title":"Bean\u7684\u8303\u56f4\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5355\u7eaf\u7684Spring\u73af\u5883Bean\u7684\u4f5c\u7528\u8303\u56f4\u6709\u4e24\u4e2a\uff1asingleton\u548cprototype</p> <ul> <li> <p>singleton\uff1a\u5355\u4f8b\uff0c\u9ed8\u8ba4\u503c\uff0cSpring\u5bb9\u5668\u521b\u5efa\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fdb\u884cBean\u7684\u5b9e\u4f8b\u5316\uff0c\u5e76\u5b58\u50a8\u5230\u5bb9\u5668\u5185\u90e8\u7684\u5355\u4f8b\u6c60\u4e2d\uff0c\u6bcf\u6b21getBean\u65f6\u90fd\u662f\u4ece\u5355\u4f8b\u6c60\u4e2d\u83b7\u53d6\u76f8\u540c\u7684Bean\u5b9e\u4f8b\uff1b</p> </li> <li> <p>prototype\uff1a\u539f\u578b\uff0cSpring\u5bb9\u5668\u521d\u59cb\u5316\u65f6\u4e0d\u4f1a\u521b\u5efaBean\u5b9e\u4f8b\uff0c\u5f53\u8c03\u7528getBean\u65f6\u624d\u4f1a\u5b9e\u4f8b\u5316Bean\uff0c\u6bcf\u6b21getBean\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Bean\u5b9e\u4f8b\u3002</p> </li> </ul> <p></p>"},{"location":"Spring/Spring-XML/#bean\u7684\u5ef6\u8fdf\u52a0\u8f7d","title":"Bean\u7684\u5ef6\u8fdf\u52a0\u8f7d","text":"<p>\u5f53lazy-init\u8bbe\u7f6e\u4e3atrue\u65f6\u4e3a\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u4e5f\u5c31\u662f\u5f53Spring\u5bb9\u5668\u521b\u5efa\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u7acb\u5373\u521b\u5efaBean\u5b9e\u4f8b\uff0c\u7b49\u5f85\u7528\u5230\u65f6\u518d\u521b\u5efaBean\u5b9e\u4f8b\u5e76\u5b58\u50a8\u5230\u5355\u4f8b\u6c60\u4e2d\u53bb\uff0c\u540e\u7eed\u5728\u4f7f\u7528\u8be5Bean\u76f4\u63a5\u4ece\u5355\u4f8b\u6c60\u83b7\u53d6\u5373\u53ef\uff0c\u672c\u8d28\u4e0a\u8be5Bean\u8fd8\u662f\u5355\u4f8b\u7684</p> <pre><code>&lt;bean id=\"userDao\" class=\"com.itheima.dao.impl.UserDaoImpl\" lazy-init=\"true\"/&gt;\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#bean\u7684\u521d\u59cb\u5316\u548c\u9500\u6bc1\u65b9\u6cd5\u914d\u7f6e","title":"Bean\u7684\u521d\u59cb\u5316\u548c\u9500\u6bc1\u65b9\u6cd5\u914d\u7f6e","text":"<p>Bean\u5728\u88ab\u5b9e\u4f8b\u5316\u540e\uff0c\u53ef\u4ee5\u6267\u884c\u6307\u5b9a\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u5b8c\u6210\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u64cd\u4f5c\uff0cBean\u5728\u9500\u6bc1\u4e4b\u524d\u4e5f\u53ef\u4ee5\u6267\u884c\u6307\u5b9a\u7684\u9500\u6bc1\u65b9\u6cd5\u5b8c\u6210\u4e00\u4e9b\u64cd\u4f5c\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\u540d\u79f0\u548c\u9500\u6bc1\u65b9\u6cd5\u540d\u79f0\u901a\u8fc7init-method\u548cdestroy-method\u5c5e\u6027\u6307\u5b9a</p> <pre><code>&lt;bean id=\"userDao\" class=\"com.itheima.dao.impl.UserDaoImpl\" init-method=\"init\" destroy-method=\"destroy\"/&gt;\n</code></pre> <pre><code> public class UserDaoImpl implements UserDao {\n \u00a0\u00a0\u00a0\u00a0public UserDaoImpl() { \n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"UserDaoImpl\u521b\u5efa\u4e86...\"); \n \u00a0\u00a0\u00a0\u00a0}\n\n \u00a0\u00a0\u00a0\u00a0public void init(){ \n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u521d\u59cb\u5316\u65b9\u6cd5...\"); \n \u00a0\u00a0\u00a0\u00a0}\n\n \u00a0\u00a0\u00a0\u00a0public void destroy(){ \n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u9500\u6bc1\u65b9\u6cd5...\"); \n \u00a0\u00a0\u00a0\u00a0}\n }\n</code></pre> <p>\u6269\u5c55</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0InitializingBean\u63a5\u53e3\uff0c\u5b8c\u6210\u4e00\u4e9bBean\u7684\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5982\u4e0b\uff1a</p> <pre><code>public class UserDaoImpl implements UserDao, InitializingBean {\n    public UserDaoImpl() {\n        System.out.println(\"UserDaoImpl\u521b\u5efa\u4e86...\");\n    }\n\n    public void init() {\n        System.out.println(\"\u521d\u59cb\u5316\u65b9\u6cd5...\");\n    }\n\n    public void destroy() {\n        System.out.println(\"\u9500\u6bc1\u65b9\u6cd5...\");\n    }\n\n    //\u6267\u884c\u65f6\u673a\u65e9\u4e8einit-method\u914d\u7f6e\u7684\u65b9\u6cd5\n    @Override\n    public void afterPropertiesSet() throws Exception {\n        System.out.println(\"InitializingBean...\");\n    }\n}\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#bean\u7684\u5b9e\u4f8b\u5316\u914d\u7f6e","title":"Bean\u7684\u5b9e\u4f8b\u5316\u914d\u7f6e","text":"<p>Spring\u7684\u5b9e\u4f8b\u5316\u65b9\u5f0f\u4e3b\u8981\u5982\u4e0b\u4e24\u79cd\uff1a</p> <ul> <li> <p>\u6784\u9020\u65b9\u6cd5\u5b9e\u4f8b\u5316\uff1a\u5e95\u5c42\u901a\u8fc7\u6784\u9020\u65b9\u6cd5\u5bf9Bean\u8fdb\u884c\u5b9e\u4f8b\u5316</p> </li> <li> <p>\u5de5\u5382\u65b9\u5f0f\u5b9e\u4f8b\u5316\uff1a\u5e95\u5c42\u901a\u8fc7\u8c03\u7528\u81ea\u5b9a\u4e49\u7684\u5de5\u5382\u65b9\u6cd5\u5bf9Bean\u8fdb\u884c\u5b9e\u4f8b\u5316</p> </li> </ul> <p>\u6784\u9020\u65b9\u5f0f\u5b9e\u4f8b\u5316Bean\u53c8\u5206\u4e3a\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\u5b9e\u4f8b\u5316\u548c\u6709\u53c2\u6784\u9020\u65b9\u6cd5\u5b9e\u4f8b\u5316\uff0cSpring\u4e2d\u914d\u7f6e\u7684\u51e0\u4e4e\u90fd\u662f\u65e0\u53c2\u6784\u9020\u65b9\u5f0f</p> <p>\u6709\u53c2\u6784\u9020\u5728\u5b9e\u4f8b\u5316Bean\u65f6\uff0c\u9700\u8981\u53c2\u6570\u7684\u6ce8\u5165\uff0c\u901a\u8fc7\u6807\u7b7e<code>&lt;constructor-arg&gt;</code>\u5d4c\u5165\u5728\u6807\u7b7e\u5185\u90e8\u63d0\u4f9b\u6784\u9020\u53c2\u6570\uff0c\u5982\u4e0b:</p> <pre><code>//\u6709\u53c2\u6784\u9020\u65b9\u6cd5\npublic UserDaoImpl(String name){\n }\n</code></pre> <pre><code>&lt;bean id=\"userDao\" class=\"com.itheima.dao.impl.UserDaoImpl\"&gt;\n &lt;constructor-arg name=\"name\" value=\"\u5f20\u4e09\"/&gt;\n&lt;/bean&gt;\n</code></pre> <p>\u5de5\u5382\u65b9\u5f0f\u5b9e\u4f8b\u5316Bean\uff0c\u53c8\u5206\u4e3a\u5982\u4e0b\u4e09\u79cd\uff1a</p> <ul> <li> <p>\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u5b9e\u4f8b\u5316Bean </p> </li> <li> <p>\u5b9e\u4f8b\u5de5\u5382\u65b9\u6cd5\u5b9e\u4f8b\u5316Bean </p> </li> <li> <p>\u5b9e\u73b0FactoryBean\u89c4\u8303\u5ef6\u8fdf\u5b9e\u4f8b\u5316Bean</p> </li> </ul> <p>\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u5b9e\u4f8b\u5316Bean\uff0c\u5176\u5b9e\u5c31\u662f\u5b9a\u4e49\u4e00\u4e2a\u5de5\u5382\u7c7b\uff0c\u63d0\u4f9b\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5\u7528\u4e8e\u751f\u4ea7Bean\u5b9e\u4f8b\uff0c\u518d\u5c06\u8be5\u5de5\u5382\u7c7b\u53ca\u5176\u9759\u6001\u65b9\u6cd5\u914d\u7f6e\u7ed9Spring\u5373\u53ef:</p> <pre><code>//\u5de5\u5382\u7c7b\npublic class UserDaoFactoryBean {\n    //\u9759\u6001\u5de5\u5382\u65b9\u6cd5\n    public static UserDao getUserDao(String name){\n        //\u53ef\u4ee5\u5728\u6b64\u7f16\u5199\u4e00\u4e9b\u5176\u4ed6\u903b\u8f91\u4ee3\u7801\n        return new UserDaoImpl();\n    }\n}\n</code></pre> <pre><code>&lt;bean id=\"userDao\" class=\"com.itheima.factory.UserDaoFactoryBean\" factory-method=\"getUserDao\"&gt;\n &lt;constructor-arg name=\"name\" value=\"\u5f20\u4e09\"/&gt;\n&lt;/bean&gt;\n</code></pre> <p>Tip</p> <p><code>&lt;constructor-arg&gt;</code>\u6807\u7b7e\u4e0d\u4ec5\u4ec5\u662f\u4e3a\u6784\u9020\u65b9\u6cd5\u4f20\u9012\u53c2\u6570\uff0c\u53ea\u8981\u662f\u4e3a\u4e86\u5b9e\u4f8b\u5316\u5bf9\u8c61\u800c\u4f20\u9012\u7684\u53c2\u6570\u90fd\u53ef\u4ee5\u901a\u8fc7\u6807\u7b7e\u5b8c\u6210\uff0c\u4f8b\u5982\u4e0a\u9762\u901a\u8fc7\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u5b9e\u4f8b\u5316Bean\u6240\u4f20\u9012\u7684\u53c2\u6570\u4e5f\u662f\u8981\u901a\u8fc7\u5176\u8fdb\u884c\u4f20\u9012\u7684</p> <p></p> <p>\u5b9e\u4f8b\u5de5\u5382\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u975e\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u4ea7\u751fBean\u5b9e\u4f8b\uff0c\u4e0e\u9759\u6001\u5de5\u5382\u65b9\u5f0f\u6bd4\u8f83\uff0c\u8be5\u65b9\u5f0f\u9700\u8981\u5148\u6709\u5de5\u5382\u5bf9\u8c61\uff0c\u5728\u7528\u5de5\u5382\u5bf9\u8c61\u53bb\u8c03\u7528\u975e\u9759\u6001\u65b9\u6cd5\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u914d\u7f6e\u65f6\uff0c\u8981\u5148\u914d\u7f6e\u5de5\u5382Bean\uff0c\u518d\u914d\u7f6e\u76ee\u6807Bean</p> <pre><code>//\u5de5\u5382\u7c7b\npublic class UserDaoFactoryBean2 {\n    //\u975e\u9759\u6001\u5de5\u5382\u65b9\u6cd5\n    public UserDao getUserDao(String name){\n        //\u53ef\u4ee5\u5728\u6b64\u7f16\u5199\u4e00\u4e9b\u5176\u4ed6\u903b\u8f91\u4ee3\u7801\n        return new UserDaoImpl();\n    }\n}\n</code></pre> <pre><code>&lt;!-- \u914d\u7f6e\u5b9e\u4f8b\u5de5\u5382Bean --&gt;\n&lt;bean id=\"userDaoFactoryBean2\" class=\"com.itheima.factory.UserDaoFactoryBean2\"/&gt;\n&lt;bean id=\"userDao\" factory-bean=\"userDaoFactoryBean2\" factory-method=\"getUserDao\"&gt;\n    &lt;!-- \u914d\u7f6e\u5b9e\u4f8b\u5de5\u5382Bean\u7684\u54ea\u4e2a\u65b9\u6cd5\u4f5c\u4e3a\u5de5\u5382\u65b9\u6cd5--&gt;\n    &lt;constructor-arg name=\"name\" value=\"haohao\"/&gt;\n&lt;/bean&gt;\n</code></pre> <p></p> <p>Spring\u63d0\u4f9b\u4e86FactoryBean\u7684\u63a5\u53e3\u89c4\u8303\uff0cFactoryBean\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>public interface FactoryBean&lt;T&gt; {\n    String OBJECT_TYPE_ATTRIBUTE = \u201cfactoryBeanObjectType\u201d;\n    T getObject() throws Exception; //\u83b7\u5f97\u5b9e\u4f8b\u5bf9\u8c61\u65b9\u6cd5\n    Class&lt;?&gt; getObjectType(); //\u83b7\u5f97\u5b9e\u4f8b\u5bf9\u8c61\u7c7b\u578b\u65b9\u6cd5\n    default boolean isSingleton() {\n        return true;\n    }\n}\n</code></pre> <p>\u5b9e\u73b0\u81ea\u5b9a\u4e49\u5de5\u5382\u540e\uff0c\u914d\u7f6eFactoryBean\u4ea4\u7531Spring\u7ba1\u7406\u5373\u53ef</p> <pre><code>&lt;!--\u914d\u7f6e\u81ea\u5b9a\u4e49\u5de5\u5382--&gt;\n&lt;bean class=\"org.example.factory.MyBeanFactory\" id=\"userDao3\"/&gt;\n</code></pre> <p>Info</p> <p>\u901a\u8fc7\u65ad\u70b9\u89c2\u5bdf\u53d1\u73b0Spring\u5bb9\u5668\u521b\u5efa\u65f6\uff0cFactoryBean\u88ab\u5b9e\u4f8b\u5316\u4e86\uff0c\u5e76\u5b58\u50a8\u5230\u4e86\u5355\u4f8b\u6c60singletonObjects\u4e2d\uff0c\u4f46\u662fgetObject() \u65b9\u6cd5\u5c1a\u672a\u88ab\u6267\u884c\uff0cUserDaoImpl\u4e5f\u6ca1\u88ab\u5b9e\u4f8b\u5316\uff0c\u5f53\u9996\u6b21\u7528\u5230UserDaoImpl\u65f6\uff0c\u624d\u8c03\u7528getObject() \uff0c\u6b64\u5de5\u5382\u65b9\u5f0f\u4ea7\u751f\u7684Bean\u5b9e\u4f8b\u4e0d\u4f1a\u5b58\u50a8\u5230\u5355\u4f8b\u6c60singletonObjects\u4e2d\uff0c\u4f1a\u5b58\u50a8\u5230 factoryBeanObjectCache  \u7f13\u5b58\u6c60 \u4e2d\uff0c\u5e76\u4e14\u540e\u671f\u6bcf\u6b21\u4f7f\u7528\u5230userDao\u90fd\u4ece\u8be5\u7f13\u5b58\u6c60\u4e2d\u8fd4\u56de\u7684\u662f\u540c\u4e00\u4e2auserDao\u5b9e\u4f8b\u3002</p> <p></p>"},{"location":"Spring/Spring-XML/#bean\u7684\u4f9d\u8d56\u6ce8\u5165\u914d\u7f6e","title":"Bean\u7684\u4f9d\u8d56\u6ce8\u5165\u914d\u7f6e","text":"<p>Bean\u7684\u4f9d\u8d56\u6ce8\u5165\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> \u6ce8\u5165\u65b9\u5f0f \u914d\u7f6e\u65b9\u5f0f \u901a\u8fc7Bean\u7684set\u65b9\u6cd5\u6ce8\u5165 <code>&lt;property name=\"userDao\" ref=\"userDao\"/&gt;</code><code>&lt;property name=\"user\" value=\"haohao\"/&gt;</code> \u901a\u8fc7\u6784\u9020Bean\u7684\u65b9\u6cd5\u8fdb\u884c\u6ce8\u5165 <code>&lt;constructor-arg name=\"userDao\" ref=\"userDao\"/&gt;</code><code>&lt;constructor-arg name=\"user\" value=\"haohao\"/&gt;</code> <p>Info</p> <p>\u5176\u4e2d\uff0cref \u662f reference \u7684\u7f29\u5199\u5f62\u5f0f\uff0c\u7ffb\u8bd1\u4e3a\uff1a\u6d89\u53ca\uff0c\u53c2\u8003\u7684\u610f\u601d\uff0c\u7528\u4e8e\u5f15\u7528\u5176\u4ed6Bean\u7684id\u3002value \u7528\u4e8e\u6ce8\u5165\u666e\u901a\u5c5e\u6027\u503c\u3002</p> <p>\u4f9d\u8d56\u6ce8\u5165\u7684\u6570\u636e\u7c7b\u578b\u6709\u5982\u4e0b\u4e09\u79cd\uff1a</p> <ul> <li> <p>\u666e\u901a\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\uff1a<code>String\u3001int\u3001boolean</code>\u7b49\uff0c\u901a\u8fc7<code>value</code>\u5c5e\u6027\u6307\u5b9a\u3002</p> </li> <li> <p>\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\uff1a<code>UserDaoImpl\u3001DataSource</code>\u7b49\uff0c\u901a\u8fc7<code>ref</code>\u5c5e\u6027\u6307\u5b9a\u3002</p> </li> <li> <p>\u96c6\u5408\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\uff1a<code>List\u3001Map\u3001Properties</code>\u7b49\u3002</p> </li> </ul> <p></p> <p>\u6ce8\u5165<code>List&lt;T&gt;</code>\u96c6\u5408\u2013 \u666e\u901a\u6570\u636e</p> <pre><code>void setStrList(List&lt;String&gt; strList){\n    strList.forEach(str-&gt;{\n        System.out.println(str);\n    });\n}\n</code></pre> <p><pre><code>&lt;property name=\"strList\"&gt;\n    &lt;list&gt;\n        &lt;value&gt;haohao&lt;/value&gt;\n        &lt;value&gt;miaomiao&lt;/value&gt;\n    &lt;/list&gt;\n&lt;/property&gt;\n</code></pre>  \u6ce8\u5165<code>List &lt;T&gt;</code>\u96c6\u5408\u2013\u5f15\u7528\u6570\u636e</p> <pre><code>public void setObjList(List&lt;UserDao&gt; objList){\n    objList.forEach(obj-&gt;{\n        System.out.println(obj);\n    });\n}\n</code></pre> <pre><code>&lt;property name=\"objList\"&gt;\n    &lt;list&gt;\n        &lt;bean class=\"com.itheima.dao.impl.UserDaoImpl\"&gt;&lt;/bean&gt;\n        &lt;bean class=\"com.itheima.dao.impl.UserDaoImpl\"&gt;&lt;/bean&gt;\n        &lt;bean class=\"com.itheima.dao.impl.UserDaoImpl\"&gt;&lt;/bean&gt;\n    &lt;/list&gt;\n&lt;/property&gt;\n</code></pre> <p>Tip</p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u5bb9\u5668\u4e2d\u5b58\u5728\u7684Bean\uff0cclass\u7684\u503c\u4e3abean\u7684id</p> <p></p> <p>\u6ce8\u5165<code>Set&lt;T&gt;</code>\u96c6\u5408</p> <p>\u53ea\u9700\u5c06<code>&lt;list&gt;</code>\u6807\u7b7e\u6539\u4e3a<code>&lt;set&gt;</code>\u5373\u53ef</p> <p></p> <p>\u6ce8\u5165<code>Map&lt;K,V&gt;</code>\u96c6\u5408</p> <pre><code>&lt;!--\u6ce8\u5165\u503c\u4e3a\u5b57\u7b26\u4e32\u7684Map\u96c6\u5408--&gt;\n&lt;property name=\"valueMap\"&gt;\n&lt;map&gt;\n    &lt;entry key=\"aaa\" value=\"AAA\" /&gt;\n    &lt;entry key=\"bbb\" value=\"BBB\" /&gt;\n    &lt;entry key=\"ccc\" value=\"CCC\" /&gt;\n&lt;/map&gt;\n&lt;/property&gt;\n\n&lt;!--\u6ce8\u5165\u503c\u4e3a\u5bf9\u8c61\u7684Map\u96c6\u5408--&gt;\n&lt;property name=\"objMap\"&gt;\n&lt;map&gt;\n    &lt;entry key=\"ud\" value-ref=\"userDao\"/&gt;\n    &lt;entry key=\"ud2\" value-ref=\"userDao2\"/&gt;\n    &lt;entry key=\"ud3\" value-ref=\"userDao3\"/&gt;\n&lt;/map&gt;\n&lt;/property&gt;\n</code></pre> <p></p> <p>\u6ce8\u5165Properties \u952e\u503c\u5bf9</p> <pre><code>&lt;property name=\"properties\"&gt;\n    &lt;props&gt;\n        &lt;prop key=\"xxx\"&gt;XXX&lt;/prop&gt;\n        &lt;prop key=\"yyy\"&gt;YYY&lt;/prop&gt;\n    &lt;/props&gt;\n&lt;/property&gt;\n</code></pre> <p></p> <p>\u6269\u5c55\uff1a\u81ea\u52a8\u88c5\u914d\u65b9\u5f0f</p> <p>\u5982\u679c\u88ab\u6ce8\u5165\u7684\u5c5e\u6027\u7c7b\u578b\u662fBean\u5f15\u7528\u7684\u8bdd\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728 \u6807\u7b7e\u4e2d\u4f7f\u7528<code>autowire</code>\u5c5e\u6027\u53bb\u914d\u7f6e\u81ea\u52a8\u6ce8\u5165\u65b9\u5f0f\uff0c\u5c5e\u6027\u503c\u6709\u4e24\u4e2a\uff1a</p> <ul> <li> <p><code>byName</code>\uff1a\u901a\u8fc7\u5c5e\u6027\u540d\u81ea\u52a8\u88c5\u914d\uff0c\u5373\u53bb\u5339\u914d<code>setXxx</code>\u4e0e<code>id=\"xxx\"\uff08name=\"xxx\"\uff09</code>\u662f\u5426\u4e00\u81f4\uff1b</p> </li> <li> <p><code>byType</code>\uff1a\u901a\u8fc7Bean\u7684\u7c7b\u578b\u4ece\u5bb9\u5668\u4e2d\u5339\u914d\uff0c\u5339\u914d\u51fa\u591a\u4e2a\u76f8\u540cBean\u7c7b\u578b\u65f6\uff0c\u62a5\u9519\u3002</p> </li> </ul>"},{"location":"Spring/Spring-XML/#spring\u7684\u5176\u4ed6\u914d\u7f6e\u6807\u7b7e","title":"Spring\u7684\u5176\u4ed6\u914d\u7f6e\u6807\u7b7e","text":"<p>Spring \u7684 xml \u6807\u7b7e\u5927\u4f53\u4e0a\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u79cd\u662f\u9ed8\u8ba4\u6807\u7b7e\uff0c\u4e00\u79cd\u662f\u81ea\u5b9a\u4e49\u6807\u7b7e</p> <ul> <li> <p>\u9ed8\u8ba4\u6807\u7b7e\uff1a\u5c31\u662f\u4e0d\u7528\u989d\u5916\u5bfc\u5165\u5176\u4ed6\u547d\u540d\u7a7a\u95f4\u7ea6\u675f\u7684\u6807\u7b7e\uff0c\u4f8b\u5982<code>&lt;bean&gt;</code>\u6807\u7b7e</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u6807\u7b7e\uff1a\u5c31\u662f\u9700\u8981\u989d\u5916\u5f15\u5165\u5176\u4ed6\u547d\u540d\u7a7a\u95f4\u7ea6\u675f\uff0c\u5e76\u901a\u8fc7\u524d\u7f00\u5f15\u7528\u7684\u6807\u7b7e\uff0c\u4f8b\u5982<code>&lt;context:propertyplaceholder&gt;</code>\u6807\u7b7e</p> </li> </ul> <p><code>&lt;beans&gt;</code>\u6807\u7b7e\uff0c\u9664\u4e86\u7ecf\u5e38\u7528\u7684\u505a\u4e3a\u6839\u6807\u7b7e\u5916\uff0c\u8fd8\u53ef\u4ee5\u5d4c\u5957\u5728\u6839\u6807\u7b7e\u5185\uff0c\u4f7f\u7528profile\u5c5e\u6027\u5207\u6362\u5f00\u53d1\u73af\u5883</p> <pre><code>&lt;!-- \u914d\u7f6e\u6d4b\u8bd5\u73af\u5883\u4e0b\uff0c\u9700\u8981\u52a0\u8f7d\u7684Bean\u5b9e\u4f8b--&gt;\n&lt;beans profile=\"test\"&gt;\n&lt;/beans&gt;\n\n &lt;!-- \u914d\u7f6e\u5f00\u53d1\u73af\u5883\u4e0b\uff0c\u9700\u8981\u52a0\u8f7d\u7684Bean\u5b9e\u4f8b--&gt;\n&lt;beans profile=\"dev\"&gt;\n&lt;/beans&gt;\n</code></pre> <p>Note</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u6307\u5b9a\u88ab\u6fc0\u6d3b\u7684\u73af\u5883\uff1a</p> <ul> <li> <p>\u4f7f\u7528\u547d\u4ee4\u884c\u52a8\u6001\u53c2\u6570\uff0c\u865a\u62df\u673a\u53c2\u6570\u4f4d\u7f6e\u52a0\u8f7d<code>-Dspring.profiles.active=test</code> </p> </li> <li> <p>\u4f7f\u7528\u4ee3\u7801\u7684\u65b9\u5f0f\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf<code>System.setProperty(\"spring.profiles.active\",\"test\")</code></p> </li> </ul> <p><code>&lt;import&gt;</code>\u6807\u7b7e\uff0c\u7528\u4e8e\u5bfc\u5165\u5176\u4ed6\u914d\u7f6e\u6587\u4ef6\uff0c\u9879\u76ee\u53d8\u5927\u540e\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u8fc7\u591a\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u6839\u636e\u4e1a\u52a1\u67d0\u5757\u8fdb\u884c\u62c6\u5206\uff0c\u62c6\u5206\u540e\uff0c\u6700\u7ec8\u901a\u8fc7\u6807\u7b7e\u5bfc\u5165\u5230\u4e00\u4e2a\u4e3b\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u9879\u76ee\u52a0\u8f7d\u4e3b\u914d\u7f6e\u6587\u4ef6\u5c31\u8fde\u540c\u5bfc\u5165\u7684\u6587\u4ef6\u4e00\u5e76\u52a0\u8f7d\u4e86</p> <pre><code> &lt;!--\u5bfc\u5165\u7528\u6237\u6a21\u5757\u914d\u7f6e\u6587\u4ef6--&gt;\n &lt;import resource=\"classpath:UserModuleApplicationContext.xml\"/&gt;\n &lt;!--\u5bfc\u5165\u5546\u54c1\u6a21\u5757\u914d\u7f6e\u6587\u4ef6--&gt;\n &lt;import resource=\"classpath:ProductModuleApplicationContext.xml\"/&gt;\n</code></pre> <p><code>&lt;alias&gt;</code>\u6807\u7b7e\u662f\u4e3a\u67d0\u4e2aBean\u6dfb\u52a0\u522b\u540d\uff0c\u4e0e\u5728\u6807\u7b7e\u4e0a\u4f7f\u7528name\u5c5e\u6027\u6dfb\u52a0\u522b\u540d\u7684\u65b9\u5f0f\u4e00\u6837\uff0c\u6211\u4eec\u4e3aUserServiceImpl\u6307\u5b9a\u56db\u4e2a\u522b\u540d\uff1aaaa\u3001bbb\u3001xxx\u3001yyy</p> <pre><code>&lt;!--\u914d\u7f6eUserService--&gt;\n&lt;bean id=\"userService\" name=\"aaa,bbb\" class=\"com.itheima.service.impl.UserServiceImpl\"&gt;\n&lt;property name=\"userDao\" ref=\"userDao\"/&gt;\n&lt;/bean&gt;\n&lt;!--\u6307\u5b9a\u522b\u540d--&gt;\n&lt;alias name=\"userService\" alias=\"xxx\"/&gt;\n&lt;alias name=\"userService\" alias=\"yyy\"/&gt;\n</code></pre> <p>Spring\u7684\u81ea\u5b9a\u4e49\u6807\u7b7e\u9700\u8981\u5f15\u5165\u5916\u90e8\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u5e76\u4e3a\u5916\u90e8\u7684\u547d\u540d\u7a7a\u95f4\u6307\u5b9a\u524d\u7f00\uff0c\u4f7f\u7528&lt;\u524d\u7f00:\u6807\u7b7e&gt; \u5f62\u5f0f\u7684\u6807\u7b7e\uff0c\u79f0\u4e4b\u4e3a\u81ea\u5b9a\u4e49\u6807\u7b7e\uff0c\u81ea\u5b9a\u4e49\u6807\u7b7e\u7684\u89e3\u6790\u6d41\u7a0b\u4e5f\u662fSpring xml\u6269\u5c55\u70b9\u65b9\u5f0f\u4e4b\u4e00</p> <pre><code>&lt;!--\u9ed8\u8ba4\u6807\u7b7e--&gt;\n&lt;bean id=\"userDao\" class=\"com.itheima.dao.impl.UserDaoImpl\"/&gt;\n&lt;!--\u81ea\u5b9a\u4e49\u6807\u7b7e--&gt;\n&lt;context:property-placeholder/&gt;\n&lt;mvc:annotation-driven/&gt;\n&lt;dubbo:application name=\"application\"/&gt;\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#spring-\u7684get\u65b9\u6cd5","title":"Spring \u7684get\u65b9\u6cd5","text":"\u65b9\u6cd5\u5b9a\u4e49 \u8fd4\u56de\u503c\u548c\u53c2\u6570 <code>Object getBean(String beanName)</code> \u6839\u636ebeanName\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6Bean\u5b9e\u4f8b\uff0c\u8981\u6c42\u5bb9\u5668\u4e2dBean\u552f\u4e00\uff0c\u8fd4\u56de\u503c\u4e3aObject\uff0c\u9700\u8981\u5f3a\u8f6c <code>T getBean (Class type)</code> \u6839\u636eClass\u7c7b\u578b\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6Bean\u5b9e\u4f8b\uff0c\u8981\u6c42\u5bb9\u5668\u4e2dBean\u7c7b\u578b\u552f\u4e00\uff0c\u8fd4\u56de\u503c\u4e3aClass\u7c7b\u578b\u5b9e\u4f8b\uff0c\u65e0\u9700\u5f3a\u8f6c <code>T getBean (String beanName\uff0cClass type)</code> \u6839\u636ebeanName\u4ece\u5bb9\u5668\u4e2d\u83b7\u5f97Bean\u5b9e\u4f8b\uff0c\u8fd4\u56de\u503c\u4e3aClass\u7c7b\u578b\u5b9e\u4f8b\uff0c\u65e0\u9700\u5f3a\u8f6c <pre><code>//\u6839\u636ebeanName\u83b7\u53d6\u5bb9\u5668\u4e2d\u7684Bean\u5b9e\u4f8b\uff0c\u9700\u8981\u624b\u52a8\u5f3a\u8f6c\nUserService userService = (UserService) applicationContext.getBean(\"userService\");\n\n//\u6839\u636eBean\u7c7b\u578b\u53bb\u5bb9\u5668\u4e2d\u5339\u914d\u5bf9\u5e94\u7684Bean\u5b9e\u4f8b\uff0c\u5982\u5b58\u5728\u591a\u4e2a\u5339\u914dBean\u5219\u62a5\u9519\nUserService userService2 = applicationContext.getBean(UserService.class);\n\n//\u6839\u636ebeanName\u83b7\u53d6\u5bb9\u5668\u4e2d\u7684Bean\u5b9e\u4f8b\uff0c\u6307\u5b9aBean\u7684Type\u7c7b\u578b\nUserService userService3 = applicationContext.getBean(\"userService\", UserService.class);\n</code></pre>"},{"location":"Spring/Spring-XML/#spring-\u914d\u7f6e\u975e\u81ea\u5b9a\u4e49bean","title":"Spring \u914d\u7f6e\u975e\u81ea\u5b9a\u4e49Bean","text":"<p>\u4ee5\u4e0a\u5728xml \u4e2d\u914d\u7f6e\u7684Bean\u90fd\u662f\u81ea\u5df1\u5b9a\u4e49\u7684\uff0c\u4f8b\u5982\uff1aUserDaoImpl\uff0cUserServiceImpl\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u6709\u4e9b\u529f\u80fd\u7c7b\u5e76\u4e0d\u662f\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\uff0c\u800c\u662f\u4f7f\u7528\u7684\u7b2c\u4e09\u65b9jar\u5305\u4e2d\u7684\uff0c\u8fd9\u4e9bBean\u8981\u60f3\u8ba9Spring\u8fdb\u884c\u7ba1\u7406\uff0c\u4e5f\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u914d\u7f6e</p> <p>\u914d\u7f6e\u975e\u81ea\u5b9a\u4e49\u7684Bean\u9700\u8981\u8003\u8651\u5982\u4e0b\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li> <p>\u88ab\u914d\u7f6e\u7684Bean\u7684\u5b9e\u4f8b\u5316\u65b9\u5f0f\u662f\u4ec0\u4e48\uff1f\u65e0\u53c2\u6784\u9020\u3001\u6709\u53c2\u6784\u9020\u3001\u9759\u6001\u5de5\u5382\u65b9\u5f0f\u8fd8\u662f\u5b9e\u4f8b\u5de5\u5382\u65b9\u5f0f\uff1b</p> </li> <li> <p>\u88ab\u914d\u7f6e\u7684Bean\u662f\u5426\u9700\u8981\u6ce8\u5165\u5fc5\u8981\u5c5e\u6027\u3002</p> </li> </ul> <p>Example</p> <p>\u914d\u7f6eDruid \u6570\u636e\u6e90\u4ea4\u7531Spring\u7ba1\u7406</p> <pre><code>- \u5bfc\u5165Druid\u5750\u6807\uff08Maven\uff09\n\n- \u914d\u7f6e\u6570\u636e\u6e90\n</code></pre> <pre><code> &lt;!--\u914d\u7f6e DruidDataSource\u6570\u636e\u6e90--&gt;\n &lt;bean class=\"com.alibaba.druid.pool.DruidDataSource\"&gt;\n     &lt;!--\u914d\u7f6e\u5fc5\u8981\u5c5e\u6027--&gt;\n \u00a0\u00a0\u00a0\u00a0&lt;property name=\"driverClassName\" value=\"com.mysql.cj.jdbc.Driver\"/&gt;\n \u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\" value=\"jdbc://localhost:3306/mybatis\"/&gt;\n\u00a0\u00a0\u00a0\u00a0 &lt;property name=\"username\" value=\"root\"/&gt;\n\u00a0\u00a0\u00a0\u00a0 &lt;property name=\"password\" value=\"root\"/&gt;\n &lt;/bean&gt;\n</code></pre> <p>\u914d\u7f6eConnection\u4ea4\u7531Spring\u7ba1\u7406</p> <pre><code>- Connection\u7684\u4ea7\u751f\u662f\u901a\u8fc7DriverManager\u7684\u9759\u6001\u65b9\u6cd5getConnection\u83b7\u53d6\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7528\u9759\u6001\u5de5\u5382\u65b9\u5f0f\u914d\u7f6e\n</code></pre> <pre><code>    &lt;bean id=\"clazz\" class=\"java.lang.Class\" factory-method=\"forName\"&gt;\n        &lt;constructor-arg name=\"className\" value=\"com.mysql.cj.jdbc.Driver\"/&gt;\n    &lt;/bean&gt;\n    &lt;bean id=\"connection\" class=\"java.sql.DriverManager\" factory-method=\"getConnection\" scope=\"prototype\"&gt;\n        &lt;constructor-arg name=\"url\" value=\"jdbc:mysql://localhost:3306/blog\"/&gt;\n        &lt;constructor-arg name=\"user\" value=\"root\"/&gt;\n        &lt;constructor-arg name=\"password\" value=\"123\"/&gt;\n    &lt;/bean&gt;\n</code></pre> <p>\u914d\u7f6e\u65e5\u671f\u5bf9\u8c61\u4ea4\u7531Spring\u7ba1\u7406</p> <pre><code>    &lt;bean id=\"simpleDateFormat\" class=\"java.text.SimpleDateFormat\"&gt;\n        &lt;constructor-arg name=\"pattern\" value=\"yyyy-MM-dd HH:mm:ss\"/&gt;\n    &lt;/bean&gt;\n    &lt;bean id=\"date\" class=\"java.util.Date\" factory-bean=\"simpleDateFormat\" factory-method=\"parse\"&gt;\n        &lt;constructor-arg value=\"2021-01-01 12:00:00\"/&gt;\n    &lt;/bean&gt;\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#bean-\u5b9e\u4f8b\u5316\u7684\u57fa\u672c\u6d41\u7a0b","title":"Bean \u5b9e\u4f8b\u5316\u7684\u57fa\u672c\u6d41\u7a0b","text":"<p>Spring\u5bb9\u5668\u5728\u8fdb\u884c\u521d\u59cb\u5316\u65f6\uff0c\u4f1a\u5c06xml\u914d\u7f6e\u7684\u7684\u4fe1\u606f\u5c01\u88c5\u6210\u4e00\u4e2a<code>BeanDefinition</code>\u5bf9\u8c61</p> <p>\u6240\u6709\u7684BeanDefinition\u5b58\u50a8\u5230\u4e00\u4e2a\u540d\u4e3a<code>beanDefinitionMap</code>\u7684Map\u96c6\u5408\u4e2d\u53bb</p> <p>Spring\u6846\u67b6\u518d\u5bf9\u8be5Map\u8fdb\u884c\u904d\u5386\uff0c\u4f7f\u7528\u53cd\u5c04\u521b\u5efaBean\u5b9e\u4f8b\u5bf9\u8c61\u5b58\u50a8\u5728\u4e00\u4e2a\u540d\u4e3a<code>singletonObjects</code>\u7684Map\u96c6\u5408\u4e2d</p> <p>\u5f53\u8c03\u7528getBean\u65b9\u6cd5\u65f6\u5219\u6700\u7ec8\u4ece\u8be5Map\u96c6\u5408\u4e2d\u53d6\u51faBean\u5b9e\u4f8b\u5bf9\u8c61\u8fd4\u56de\u3002</p> <p></p> <p></p>"},{"location":"Spring/Spring-XML/#spring\u7684\u540e\u5904\u7406\u5668","title":"Spring\u7684\u540e\u5904\u7406\u5668","text":"<p>Spring\u7684\u540e\u5904\u7406\u5668\u662fSpring\u5bf9\u5916\u5f00\u53d1\u7684\u91cd\u8981\u6269\u5c55\u70b9\uff0c\u5141\u8bb8\u6211\u4eec\u4ecb\u5165\u5230Bean\u7684\u6574\u4e2a\u5b9e\u4f8b\u5316\u6d41\u7a0b\u4e2d\u6765\uff0c\u4ee5\u8fbe\u5230\u52a8\u6001\u6ce8\u518cBeanDefinition\uff0c\u52a8\u6001\u4fee\u6539BeanDefinition\uff0c\u4ee5\u53ca\u52a8\u6001\u4fee\u6539Bean\u7684\u4f5c\u7528\u3002</p> <p>Spring\u4e3b\u8981\u6709\u4e24\u79cd\u540e\u5904\u7406\u5668\uff1a</p> <ul> <li> <p><code>BeanFactoryPostProcessor</code>\uff1aBean\u5de5\u5382\u540e\u5904\u7406\u5668\uff0c\u5728BeanDefinitionMap\u586b\u5145\u5b8c\u6bd5\uff0cBean\u5b9e\u4f8b\u5316\u4e4b\u524d\u6267\u884c\uff1b</p> </li> <li> <p><code>BeanPostProcessor</code>\uff1aBean\u540e\u5904\u7406\u5668\uff0c\u4e00\u822c\u5728Bean\u5b9e\u4f8b\u5316\u4e4b\u540e\uff0c\u586b\u5145\u5230\u5355\u4f8b\u6c60singletonObjects\u4e4b\u524d\u6267\u884c\u3002</p> </li> </ul> <p>Bean\u5de5\u5382\u540e\u5904\u7406\u5668\u2013BeanFactoryPostProcessor </p> <p><code>BeanFactoryPostProcessor</code>\u662f\u4e00\u4e2a\u63a5\u53e3\u89c4\u8303\uff0c\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u7684\u7c7b\u53ea\u8981\u4ea4\u7531Spring\u5bb9\u5668\u7ba1\u7406\u7684\u8bdd\uff0c\u90a3\u4e48Spring\u5c31\u4f1a\u56de\u8c03\u8be5\u63a5\u53e3\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u5bf9<code>BeanDefinition</code>\u6ce8\u518c\u548c\u4fee\u6539\u7684\u529f\u80fd\u3002</p> <pre><code>@FunctionalInterface\npublic interface BeanFactoryPostProcessor {\n    void postProcessBeanFactory(ConfigurableListableBeanFactory var1) throws BeansException;\n}\n</code></pre> <p><code>postProcessBeanFactory</code> \u53c2\u6570\u672c\u8d28\u5c31\u662f <code>DefaultListableBeanFactory</code></p> <p>\u62ff\u5230<code>BeanFactory</code>\u7684\u5f15\u7528\uff0c\u81ea\u7136\u5c31\u53ef\u4ee5\u5bf9<code>beanDefinitionMap</code>\u4e2d\u7684<code>BeanDefinition</code>\u8fdb\u884c\u64cd\u4f5c</p> <pre><code>&lt;bean class=\"org.example.processor.MyBeanFactoryProcessor\"/&gt;\n</code></pre> <pre><code>public class MyBeanFactoryProcessor implements BeanFactoryPostProcessor {\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {\n        System.out.println(\"MyBeanFactoryProcessor \u88ab\u8c03\u7528!\");\n\n        // \u8fd9\u91cc\u53ef\u4ee5\u5bf9BeanFactory\u505a\u4e00\u4e9b\u64cd\u4f5c\uff0c\u6bd4\u5982\u6dfb\u52a0Bean\u3001\u4fee\u6539Bean\u7b49\n        BeanDefinition beanDefinition = configurableListableBeanFactory.getBeanDefinition(\"userService2\");\n        beanDefinition.setBeanClassName(\"org.example.dao.impl.UserDaoImpl\");\n    }\n}\n</code></pre> <p>Note</p> <p>Spring \u63d0\u4f9b\u4e86\u4e00\u4e2aBeanFactoryPostProcessor\u7684\u5b50\u63a5\u53e3BeanDefinitionRegistryPostProcessor\u4e13\u95e8\u7528\u4e8e\u6ce8\u518cBeanDefinition\u64cd\u4f5c</p> <pre><code>public class MyBeanFactoryPostProcessor2 implements BeanDefinitionRegistryPostProcessor {\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {}\n    @Override\n    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanDefinitionRegistry) throws BeansException {\n        BeanDefinition beanDefinition = new RootBeanDefinition();\n        beanDefinition.setBeanClassName(\"com.itheima.dao.UserDaoImpl2\");\n        beanDefinitionRegistry.registerBeanDefinition(\"userDao2\",beanDefinition);\n    }\n}\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#\u6848\u4f8b\u4f7f\u7528spring\u7684beanfactorypostprocessor\u6269\u5c55\u70b9\u5b8c\u6210\u81ea\u5b9a\u4e49\u6ce8\u89e3\u626b\u63cf","title":"\u6848\u4f8b\uff1a\u4f7f\u7528Spring\u7684BeanFactoryPostProcessor\u6269\u5c55\u70b9\u5b8c\u6210\u81ea\u5b9a\u4e49\u6ce8\u89e3\u626b\u63cf","text":"<p>\u8981\u6c42\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u81ea\u5b9a\u4e49@MyComponent\u6ce8\u89e3\uff0c\u4f7f\u7528\u5728\u7c7b\u4e0a\uff1b</p> </li> <li> <p>\u4f7f\u7528\u5305\u626b\u63cf\u5668\u5de5\u5177 BaseClassScanUtils \u5b8c\u6210\u6307\u5b9a\u5305\u7684\u7c7b\u626b\u63cf\uff1b</p> </li> <li> <p>\u81ea\u5b9a\u4e49BeanFactoryPostProcessor\u5b8c\u6210\u6ce8\u89e3@MyComponent\u7684\u89e3\u6790\uff0c\u89e3\u6790\u540e\u6700\u7ec8\u88abSpring\u7ba1\u7406\u3002</p> </li> </ul> <p>\u81ea\u5b9a\u4e49@MyComponent\u6ce8\u89e3\uff0c\u4f7f\u7528\u5728\u7c7b\u4e0a</p> <pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface MyComponent {\n    String value() default \"\";\n}\n</code></pre> <p>\u5728\u7c7b\u4e0a\u4f7f\u7528@MyComponent</p> <pre><code>@MyComponent(\"myBean\")\npublic class TestBean {\n}\n</code></pre> <p>\u81ea\u5b9a\u4e49<code>BeanFactoryPostProcessor</code>\u5b8c\u6210\u6ce8\u89e3\u89e3\u6790</p> <pre><code>public class MyComponentFactory implements BeanDefinitionRegistryPostProcessor {\n    @Override\n    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanDefinitionRegistry) throws BeansException {\n        // \u626b\u63cf\u5e76\u6ce8\u518c\u7ec4\u4ef6\n        // \u6ce8\u518c\u7ec4\u4ef6\u7684BeanDefinition\n        Map&lt;String, Class&gt; myComponents = BeanScanUtil.scanMyComponentAnnotation(\"org.example\");\n        myComponents.forEach((beanName,clazz)-&gt;{\n            String className = clazz.getName();\n            BeanDefinition beanDefinition = new RootBeanDefinition();\n            beanDefinition.setBeanClassName(className);\n            beanDefinitionRegistry.registerBeanDefinition(beanName, beanDefinition);\n        });\n    }\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {\n\n    }\n}\n\npublic class BeanScanUtil {\n    //\u8bbe\u7f6e\u8d44\u6e90\u89c4\u5219\n    private static final String RESOURCE_PATTERN = \"/**/*.class\";\n\n    public static Map&lt;String, Class&gt; scanMyComponentAnnotation(String basePackage) {\n\n        //\u521b\u5efa\u5bb9\u5668\u5b58\u50a8\u4f7f\u7528\u4e86\u6307\u5b9a\u6ce8\u89e3\u7684Bean\u5b57\u8282\u7801\u5bf9\u8c61\n        Map&lt;String, Class&gt; annotationClassMap = new HashMap&lt;String, Class&gt;();\n\n        //spring\u5de5\u5177\u7c7b\uff0c\u53ef\u4ee5\u83b7\u53d6\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u5168\u90e8\u7c7b\n        ResourcePatternResolver resourcePatternResolver = new PathMatchingResourcePatternResolver();\n        try {\n            String pattern = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +\n                    ClassUtils.convertClassNameToResourcePath(basePackage) + RESOURCE_PATTERN;\n            Resource[] resources = resourcePatternResolver.getResources(pattern);\n            //MetadataReader \u7684\u5de5\u5382\u7c7b\n            MetadataReaderFactory refractory = new CachingMetadataReaderFactory(resourcePatternResolver);\n            for (Resource resource : resources) {\n                //\u7528\u4e8e\u8bfb\u53d6\u7c7b\u4fe1\u606f\n                MetadataReader reader = refractory.getMetadataReader(resource);\n                //\u626b\u63cf\u5230\u7684class\n                String classname = reader.getClassMetadata().getClassName();\n                Class&lt;?&gt; clazz = Class.forName(classname);\n                //\u5224\u65ad\u662f\u5426\u5c5e\u4e8e\u6307\u5b9a\u7684\u6ce8\u89e3\u7c7b\u578b\n                if (clazz.isAnnotationPresent(MyComponent.class)) {\n                    //\u83b7\u5f97\u6ce8\u89e3\u5bf9\u8c61\n                    MyComponent annotation = clazz.getAnnotation(MyComponent.class);\n                    //\u83b7\u5f97\u5c5evalue\u5c5e\u6027\u503c\n                    String beanName = annotation.value();\n                    //\u5224\u65ad\u662f\u5426\u4e3a\"\"\n                    if (beanName != null &amp;&amp; !beanName.equals(\"\")) {\n                        //\u5b58\u50a8\u5230Map\u4e2d\u53bb\n                        annotationClassMap.put(beanName, clazz);\n                        continue;\n                    }\n                    //\u5982\u679c\u6ca1\u6709\u4e3a\"\",\u90a3\u5c31\u628a\u5f53\u524d\u7c7b\u7684\u7c7b\u540d\u4f5c\u4e3abeanName\n                    annotationClassMap.put(clazz.getSimpleName(), clazz);\n                }\n            }\n        } catch (Exception exception) {\n        }\n\n        return annotationClassMap;\n    }\n}\n</code></pre> <p>Bean\u540e\u5904\u7406\u5668\u2013BeanPostProcessor</p> <p>Bean\u88ab\u5b9e\u4f8b\u5316\u540e\uff0c\u5230\u6700\u7ec8\u7f13\u5b58\u5230\u540d\u4e3asingletonObjects\u5355\u4f8b\u6c60\u4e4b\u524d\uff0c\u4e2d\u95f4\u4f1a\u7ecf\u8fc7Bean\u7684\u521d\u59cb\u5316\u8fc7\u7a0b</p> <p>\u4f8b\u5982\uff1a\u5c5e\u6027\u7684\u586b\u5145\u3001\u521d\u59cb\u65b9\u6cd5init\u7684\u6267\u884c\u7b49\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u5bf9\u5916\u8fdb\u884c\u6269\u5c55\u7684\u70b9BeanPostProcessor\uff0c\u6211\u4eec\u79f0\u4e3aBean\u540e\u5904\u7406\u3002</p> <p>\u8ddf\u4e0a\u9762\u7684Bean\u5de5\u5382\u540e\u5904\u7406\u5668\u76f8\u4f3c\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u5e76\u88ab\u5bb9\u5668\u7ba1\u7406\u7684BeanPostProcessor\uff0c\u4f1a\u5728\u6d41\u7a0b\u8282\u70b9\u4e0a\u88abSpring\u81ea\u52a8\u8c03\u7528\u3002</p> <pre><code>public interface BeanPostProcessor {\n    //\u5728\u5c5e\u6027\u6ce8\u5165\u5b8c\u6bd5\uff0cinit\u521d\u59cb\u5316\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u88ab\u56de\u8c03\n    @Nullable\n    default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        return bean;\n    }\n    //\u5728\u521d\u59cb\u5316\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\uff0c\u88ab\u6dfb\u52a0\u5230\u5355\u4f8b\u6c60singletonObjects\u4e4b\u524d\u88ab\u56de\u8c03\n    @Nullable\n    default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        return bean;\n    }\n}\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#\u6848\u4f8b\u5bf9bean\u65b9\u6cd5\u8fdb\u884c\u6267\u884c\u65f6\u95f4\u65e5\u5fd7\u589e\u5f3a","title":"\u6848\u4f8b\uff1a\u5bf9Bean\u65b9\u6cd5\u8fdb\u884c\u6267\u884c\u65f6\u95f4\u65e5\u5fd7\u589e\u5f3a","text":"<p>\u8981\u6c42\u5982\u4e0b\uff1a</p> <ul> <li> <p>Bean\u7684\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u63a7\u5236\u53f0\u6253\u5370\u5f53\u524d\u65f6\u95f4\uff1b</p> </li> <li> <p>Bean\u7684\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u63a7\u5236\u53f0\u6253\u5370\u5f53\u524d\u65f6\u95f4\u3002</p> </li> </ul> <p>\u5206\u6790\uff1a</p> <ul> <li> <p>\u5bf9\u65b9\u6cd5\u8fdb\u884c\u589e\u5f3a\u4e3b\u8981\u5c31\u662f\u4ee3\u7406\u6a21\u5f0f\u548c\u5305\u88c5\u6a21\u5f0f\uff1b</p> </li> <li> <p>\u7531\u4e8eBean\u65b9\u6cd5\u4e0d\u786e\u5b9a\uff0c\u6240\u4ee5\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u5728\u8fd0\u884c\u671f\u95f4\u6267\u884c\u589e\u5f3a\u64cd\u4f5c\uff1b</p> </li> <li> <p>\u5728Bean\u5b9e\u4f8b\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u8fdb\u5165\u5230\u5355\u4f8b\u6c60\u4e4b\u524d\uff0c\u4f7f\u7528Proxy\u4ee3\u66ff\u771f\u5b9e\u7684\u76ee\u6807Bean</p> </li> </ul> <p>\u7f16\u5199BeanPostProcessor\uff0c\u589e\u5f3a\u903b\u8f91\u7f16\u5199\u5728after\u65b9\u6cd5\u4e2d\uff1a</p> <pre><code>public class TImeLogBeanPostProcessor implements BeanPostProcessor {\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        // \u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u5bf9\u76ee\u6807BEan\u8fdb\u884c\u589e\u5f3a\uff0c\u8fd4\u56deproxy\u5bf9\u8c61\n        return Proxy.newProxyInstance(\n                bean.getClass().getClassLoader(),\n                bean.getClass().getInterfaces(),\n                (proxy, method, args) -&gt; {\n                    // \u8f93\u51fa\u5f00\u59cb\u65f6\u95f4\n                    System.out.println(\"\u6267\u884c\u65b9\u6cd5\uff1a\" + method.getName() + \"--\u5f00\u59cb\u65f6\u95f4\uff1a\" + new Date());\n                    // \u6267\u884c\u76ee\u6807\u65b9\u6cd5\n                    Object result = method.invoke(bean, args);\n                    // \u8f93\u51fa\u7ed3\u675f\u65f6\u95f4\n                    System.out.println(\"\u65b9\u6cd5\u7ed3\u675f\uff1a\" + method.getName() + \"--\u7ed3\u675f\u65f6\u95f4\uff1a\" + new Date());\n                    return result;\n                }\n        );\n    }\n}\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#spring-bean\u7684\u751f\u547d\u5468\u671f","title":"Spring Bean\u7684\u751f\u547d\u5468\u671f","text":"<p>Spring Bean\u7684\u751f\u547d\u5468\u671f\u662f\u4ece Bean \u5b9e\u4f8b\u5316\u4e4b\u540e\uff0c\u5373\u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u51fa\u5bf9\u8c61\u4e4b\u540e\uff0c\u5230Bean\u6210\u4e3a\u4e00\u4e2a\u5b8c\u6574\u5bf9\u8c61\uff0c\u6700\u7ec8\u5b58\u50a8\u5230\u5355\u4f8b\u6c60\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3aSpring Bean\u7684\u751f\u547d\u5468\u671f\u3002</p> <p>Spring Bean\u7684\u751f\u547d\u5468\u671f\u5927\u4f53\u4e0a\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li> <p>Bean\u7684\u5b9e\u4f8b\u5316\u9636\u6bb5\uff1aSpring\u6846\u67b6\u4f1a\u53d6\u51faBeanDefinition\u7684\u4fe1\u606f\u8fdb\u884c\u5224\u65ad\u5f53\u524dBean\u7684\u8303\u56f4\u662f\u5426\u662fsingleton\u7684\uff0c\u662f\u5426\u5ef6\u8fdf\u52a0\u8f7d\u7684\uff0c\u662f\u5426FactoryBean\u7b49\uff0c\u6700\u7ec8\u5c06\u4e00\u4e2a\u666e\u901a\u7684singleton\u7684Bean\u901a\u8fc7\u53cd\u5c04\u8fdb\u884c\u5b9e\u4f8b\u5316\uff1b</p> </li> <li> <p>Bean\u7684\u521d\u59cb\u5316\u9636\u6bb5\uff1aBean\u521b\u5efa\u4e4b\u540e\u8fd8\u4ec5\u4ec5\u662f\u4e2a\"\u534a\u6210\u54c1\"\uff0c\u8fd8\u9700\u8981\u5bf9Bean\u5b9e\u4f8b\u7684\u5c5e\u6027\u8fdb\u884c\u586b\u5145\u3001\u6267\u884c\u4e00\u4e9bAware\u63a5\u53e3\u65b9\u6cd5\u3001\u6267\u884cBeanPostProcessor\u65b9\u6cd5\u3001\u6267\u884cInitializingBean\u63a5\u53e3\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u3001\u6267\u884c\u81ea\u5b9a\u4e49\u521d\u59cb\u5316init\u65b9\u6cd5\u7b49\u3002\u8be5\u9636\u6bb5\u662fSpring\u6700\u5177\u6280\u672f\u542b\u91cf\u548c\u590d\u6742\u5ea6\u7684\u9636\u6bb5\uff0cAop\u589e\u5f3a\u529f\u80fd\uff0c\u540e\u9762\u8981\u5b66\u4e60\u7684Spring\u7684\u6ce8\u89e3\u529f\u80fd\u7b49\u3001spring\u9ad8\u9891\u9762\u8bd5\u9898Bean\u7684\u5faa\u73af\u5f15\u7528\u95ee\u9898\u90fd\u662f\u5728\u8fd9\u4e2a\u9636\u6bb5\u4f53\u73b0\u7684\uff1b</p> </li> <li> <p>Bean\u7684\u5b8c\u6210\u9636\u6bb5\uff1a\u7ecf\u8fc7\u521d\u59cb\u5316\u9636\u6bb5\uff0cBean\u5c31\u6210\u4e3a\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684Spring Bean\uff0c\u88ab\u5b58\u50a8\u5230\u5355\u4f8b\u6c60singletonObjects\u4e2d\u53bb\u4e86\uff0c\u5373\u5b8c\u6210\u4e86Spring Bean\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u3002</p> </li> </ul> <p>Spring Bean\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u6d89\u53ca\u5982\u4e0b\u51e0\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li> <p>Bean\u5b9e\u4f8b\u7684\u5c5e\u6027\u586b\u5145</p> </li> <li> <p>Aware\u63a5\u53e3\u5c5e\u6027\u6ce8\u5165</p> </li> <li> <p>BeanPostProcessor\u7684before()\u65b9\u6cd5\u56de\u8c03</p> </li> <li> <p>InitializingBean\u63a5\u53e3\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u56de\u8c03</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u521d\u59cb\u5316\u65b9\u6cd5init\u56de\u8c03</p> </li> <li> <p>BeanPostProcessor\u7684after()\u65b9\u6cd5\u56de\u8c03</p> </li> </ul> <p></p>"},{"location":"Spring/Spring-XML/#bean\u5b9e\u4f8b\u5c5e\u6027\u586b\u5145","title":"Bean\u5b9e\u4f8b\u5c5e\u6027\u586b\u5145","text":"<p>BeanDefinition \u4e2d\u6709\u5bf9\u5f53\u524dBean\u5b9e\u4f53\u7684\u6ce8\u5165\u4fe1\u606f\u901a\u8fc7\u5c5e\u6027<code>propertyValues</code>\u8fdb\u884c\u4e86\u5b58\u50a8</p> <p>Spring\u5728\u8fdb\u884c\u5c5e\u6027\u6ce8\u5165\u65f6\uff0c\u4f1a\u5206\u4e3a\u5982\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u6ce8\u5165\u666e\u901a\u5c5e\u6027\uff0cString\u3001int\u6216\u5b58\u50a8\u57fa\u672c\u7c7b\u578b\u7684\u96c6\u5408\u65f6\uff0c\u76f4\u63a5\u901a\u8fc7set\u65b9\u6cd5\u7684\u53cd\u5c04\u8bbe\u7f6e\u8fdb\u53bb\uff1b</p> </li> <li> <p>\u6ce8\u5165\u5355\u5411\u5bf9\u8c61\u5f15\u7528\u5c5e\u6027\u65f6\uff0c\u4ece\u5bb9\u5668\u4e2dgetBean\u83b7\u53d6\u540e\u901a\u8fc7set\u65b9\u6cd5\u53cd\u5c04\u8bbe\u7f6e\u8fdb\u53bb\uff0c\u5982\u679c\u5bb9\u5668\u4e2d\u6ca1\u6709\uff0c\u5219\u5148\u521b\u5efa\u88ab\u6ce8\u5165\u5bf9\u8c61Bean\u5b9e\u4f8b\uff08\u5b8c\u6210\u6574\u4e2a\u751f\u547d\u5468\u671f\uff09\u540e\uff0c\u518d\u8fdb\u884c\u6ce8\u5165\u64cd\u4f5c\uff1b</p> </li> <li> <p>\u6ce8\u5165\u53cc\u5411\u5bf9\u8c61\u5f15\u7528\u5c5e\u6027\u65f6\uff0c\u5c31\u6bd4\u8f83\u590d\u6742\u4e86\uff0c\u6d89\u53ca\u4e86\u5faa\u73af\u5f15\u7528\uff08\u5faa\u73af\u4f9d\u8d56\uff09\u95ee\u9898\uff0c\u4e0b\u9762\u4f1a\u8be6\u7ec6\u9610\u8ff0\u89e3\u51b3\u65b9\u6848\u3002</p> </li> </ul> <p>\u591a\u4e2a\u5b9e\u4f53\u4e4b\u95f4\u76f8\u4e92\u4f9d\u8d56\u5e76\u5f62\u6210\u95ed\u73af\u7684\u60c5\u51b5\u5c31\u53eb\u505a\"\u5faa\u73af\u4f9d\u8d56\"\uff0c\u4e5f\u53eb\u505a\"\u5faa\u73af\u5f15\u7528\":</p> <p></p>"},{"location":"Spring/Spring-XML/#\u89e3\u51b3\u5faa\u73af\u5f15\u7528","title":"\u89e3\u51b3\u5faa\u73af\u5f15\u7528","text":"<p>Spring\u63d0\u4f9b\u4e86\u4e09\u7ea7\u7f13\u5b58\u5b58\u50a8\u5b8c\u6574Bean\u5b9e\u4f8b\u548c\u534a\u6210\u54c1Bean\u5b9e\u4f8b\uff0c\u7528\u4e8e\u89e3\u51b3\u5faa\u73af\u5f15\u7528\u95ee\u9898</p> <p>\u5728<code>DefaultListableBeanFactory</code>\u7684\u4e0a\u56db\u7ea7\u7236\u7c7b<code>DefaultSingletonBeanRegistry</code>\u4e2d\u63d0\u4f9b\u5982\u4e0b\u4e09\u4e2aMap\uff1a</p> <pre><code>public class DefaultSingletonBeanRegistry ... {\n \u00a0\u00a0\u00a0\u00a0//1\u3001\u6700\u7ec8\u5b58\u50a8\u5355\u4f8bBean\u6210\u54c1\u7684\u5bb9\u5668\uff0c\u5373\u5b9e\u4f8b\u5316\u548c\u521d\u59cb\u5316\u90fd\u5b8c\u6210\u7684Bean\uff0c\u79f0\u4e4b\u4e3a\"\u4e00\u7ea7\u7f13\u5b58\"\n \u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap(256);\n\n \u00a0\u00a0\u00a0\u00a0//2\u3001\u65e9\u671fBean\u5355\u4f8b\u6c60\uff0c\u7f13\u5b58\u534a\u6210\u54c1\u5bf9\u8c61\uff0c\u4e14\u5f53\u524d\u5bf9\u8c61\u5df2\u7ecf\u88ab\u5176\u4ed6\u5bf9\u8c61\u5f15\u7528\u4e86\uff0c\u79f0\u4e4b\u4e3a\"\u4e8c\u7ea7\u7f13\u5b58\"\n \u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; earlySingletonObjects = new ConcurrentHashMap(16);\n\n \u00a0\u00a0\u00a0\u00a0//3\u3001\u5355\u4f8bBean\u7684\u5de5\u5382\u6c60\uff0c\u7f13\u5b58\u534a\u6210\u54c1\u5bf9\u8c61\uff0c\u5bf9\u8c61\u672a\u88ab\u5f15\u7528\uff0c\u4f7f\u7528\u65f6\u518d\u901a\u8fc7\u5de5\u5382\u521b\u5efaBean\uff0c\u79f0\u4e4b\u4e3a\"\u4e09\u7ea7\u7f13\u5b58\"\n \u00a0\u00a0\u00a0\u00a0Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap(16);\n }\n</code></pre> <p>UserService\u548cUserDao\u5faa\u73af\u4f9d\u8d56\u7684\u8fc7\u7a0b\u7ed3\u5408\u4e0a\u8ff0\u4e09\u7ea7\u7f13\u5b58\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <ul> <li> <p>UserService \u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u4f46\u5c1a\u672a\u521d\u59cb\u5316\uff0c\u5c06UserService\u5b58\u50a8\u5230\u4e09\u7ea7\u7f13\u5b58\uff1b</p> </li> <li> <p>UserService \u5c5e\u6027\u6ce8\u5165\uff0c\u9700\u8981UserDao\uff0c\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\uff0c\u6ca1\u6709UserDao\uff1b</p> </li> <li> <p>UserDao\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u4f46\u5c1a\u672a\u521d\u59cb\u5316\uff0c\u5c06UserDao\u5b58\u50a8\u5230\u5230\u4e09\u7ea7\u7f13\u5b58\uff1b</p> </li> <li> <p>UserDao\u5c5e\u6027\u6ce8\u5165\uff0c\u9700\u8981UserService\uff0c\u4ece\u4e09\u7ea7\u7f13\u5b58\u83b7\u53d6UserService\uff0cUserService\u4ece\u4e09\u7ea7\u7f13\u5b58\u79fb\u5165\u4e8c\u7ea7\u7f13\u5b58\uff1b</p> </li> <li> <p>UserDao\u6267\u884c\u5176\u4ed6\u751f\u547d\u5468\u671f\u8fc7\u7a0b\uff0c\u6700\u7ec8\u6210\u4e3a\u4e00\u4e2a\u5b8c\u6210Bean\uff0c\u5b58\u50a8\u5230\u4e00\u7ea7\u7f13\u5b58\uff0c\u5220\u9664\u4e8c\u4e09\u7ea7\u7f13\u5b58\uff1b</p> </li> <li> <p>UserService \u6ce8\u5165UserDao\uff1b</p> </li> <li> <p>UserService\u6267\u884c\u5176\u4ed6\u751f\u547d\u5468\u671f\u8fc7\u7a0b\uff0c\u6700\u7ec8\u6210\u4e3a\u4e00\u4e2a\u5b8c\u6210Bean\uff0c\u5b58\u50a8\u5230\u4e00\u7ea7\u7f13\u5b58\uff0c\u5220\u9664\u4e8c\u4e09\u7ea7\u7f13\u5b58\u3002</p> </li> </ul> <p></p>"},{"location":"Spring/Spring-XML/#\u5e38\u7528\u7684aware\u63a5\u53e3","title":"\u5e38\u7528\u7684Aware\u63a5\u53e3","text":"<p>Aware\u63a5\u53e3\u662f\u4e00\u79cd\u6846\u67b6\u8f85\u52a9\u5c5e\u6027\u6ce8\u5165\u7684\u4e00\u79cd\u601d\u60f3\uff0c\u5176\u4ed6\u6846\u67b6\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u7c7b\u4f3c\u7684\u63a5\u53e3\u3002\u6846\u67b6\u5177\u5907\u9ad8\u5ea6\u5c01\u88c5\u6027\uff0c\u6211\u4eec\u63a5\u89e6\u5230\u7684\u4e00\u822c\u90fd\u662f\u4e1a\u52a1\u4ee3\u7801\uff0c\u4e00\u4e2a\u5e95\u5c42\u529f\u80fdAPI\u4e0d\u80fd\u8f7b\u6613\u7684\u83b7\u53d6\u5230\uff0c\u4f46\u662f\u8fd9\u4e0d\u610f\u5473\u7740\u6c38\u8fdc\u7528\u4e0d\u5230\u8fd9\u4e9b\u5bf9\u8c61\uff0c\u5982\u679c\u7528\u5230\u4e86\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u6846\u67b6\u63d0\u4f9b\u7684\u7c7b\u4f3cAware\u7684\u63a5\u53e3\uff0c\u8ba9\u6846\u67b6\u4e3a\u6211\u4eec\u6ce8\u5165\u8be5\u5bf9\u8c61\u3002</p> Aware\u63a5\u53e3 \u56de\u8c03\u63a5\u53e3 \u4f5c\u7528 <code>ServletContextAware</code> <code>setServletContext(ServletContext context)</code> Spring\u6846\u67b6\u56de\u8c03\u65b9\u6cd5\u6ce8\u5165ServletContext\u5bf9\u8c61\uff0cweb\u73af\u5883\u4e0b\u624d\u751f\u6548 <code>BeanFactoryAware</code> <code>setBeanFactory(BeanFactory factory)</code> Spring\u6846\u67b6\u56de\u8c03\u65b9\u6cd5\u6ce8\u5165beanFactory\u5bf9\u8c61 <code>BeanNameAware</code> <code>setBeanName(String beanName)</code> Spring\u6846\u67b6\u56de\u8c03\u65b9\u6cd5\u6ce8\u5165\u5f53\u524dBean\u5728\u5bb9\u5668\u4e2d\u7684beanName <code>ApplicationContextAware</code> <code>setApplicationContext(ApplicationContext applicationContext)</code> Spring\u6846\u67b6\u56de\u8c03\u65b9\u6cd5\u6ce8\u5165applicationContext\u5bf9\u8c61"},{"location":"Spring/Spring-XML/#\u4e00\u56fe\u603b\u7ed3","title":"\u4e00\u56fe\u603b\u7ed3","text":""},{"location":"Spring/Spring-XML/#\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6","title":"\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6","text":"<p>xml\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6\u6709\u4e24\u79cd\u6574\u5408\u65b9\u6848\uff1a</p> <ol> <li> <p>\u4e0d\u9700\u8981\u81ea\u5b9a\u4e49\u540d\u7a7a\u95f4\uff0c\u4e0d\u9700\u8981\u4f7f\u7528Spring\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7b2c\u4e09\u65b9\u6846\u67b6\u672c\u8eab\u5185\u5bb9\uff0c\u4f8b\u5982\uff1aMyBatis\uff1b</p> </li> <li> <p>\u9700\u8981\u5f15\u5165\u7b2c\u4e09\u65b9\u6846\u67b6\u547d\u540d\u7a7a\u95f4\uff0c\u9700\u8981\u4f7f\u7528Spring\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7b2c\u4e09\u65b9\u6846\u67b6\u672c\u8eab\u5185\u5bb9\uff0c\u4f8b\u5982\uff1aDubbo\u3002</p> </li> </ol>"},{"location":"Spring/Spring-XML/#\u6574\u5408mybatis","title":"\u6574\u5408MyBatis","text":"<p>MyBatis\u63d0\u4f9b\u4e86mybatis-spring.jar\u4e13\u95e8\u7528\u4e8e\u4e24\u5927\u6846\u67b6\u7684\u6574\u5408\u3002</p> <p>Spring\u6574\u5408MyBatis\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u5bfc\u5165MyBatis\u6574\u5408Spring\u7684\u76f8\u5173\u5750\u6807\uff1b</p> </li> <li> <p>\u7f16\u5199Mapper\u548cMapper.xml\uff1b</p> </li> <li> <p>\u914d\u7f6eSqlSessionFactoryBean\u548cMapperScannerConfigurer\uff1b</p> </li> <li> <p>\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801</p> </li> </ul> <pre><code>    &lt;!--\u914d\u7f6e\u6570\u636e\u6e90--&gt;\n    &lt;bean id=\"dataSource\" class=\"com.alibaba.druid.pool.DruidDataSource\"&gt;\n        &lt;property name=\"url\" value=\"jdbc:mysql://localhost:3306/mybatis\"&gt;&lt;/property&gt;\n        &lt;property name=\"username\" value=\"root\"&gt;&lt;/property&gt;\n        &lt;property name=\"password\" value=\"root\"&gt;&lt;/property&gt;\n    &lt;/bean&gt;\n    &lt;!--\u914d\u7f6eSqlSessionFactoryBean--&gt;\n    &lt;bean class=\"org.mybatis.spring.SqlSessionFactoryBean\"&gt;\n        &lt;property name=\"dataSource\" ref=\"dataSource\"&gt;&lt;/property&gt;\n    &lt;/bean&gt;\n    &lt;!--\u914d\u7f6eMapper\u5305\u626b\u63cf,\u4f1a\u81ea\u52a8\u5c06mapper\u6ce8\u518c\u4e3aBeanDefinition--&gt;\n    &lt;bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\"&gt;\n        &lt;property name=\"basePackage\" value=\"com.itheima.dao\"&gt;&lt;/property&gt;\n    &lt;/bean&gt;\n</code></pre> <p></p> <p>Spring\u6574\u5408MyBatis\u7684\u539f\u7406\u5256\u6790</p> <p>\u6574\u5408\u5305\u91cc\u63d0\u4f9b\u4e86\u4e00\u4e2aSqlSessionFactoryBean\u548c\u4e00\u4e2a\u626b\u63cfMapper\u7684\u914d\u7f6e\u5bf9\u8c61\uff0cSqlSessionFactoryBean\u4e00\u65e6\u88ab\u5b9e\u4f8b\u5316\uff0c\u5c31\u5f00\u59cb\u626b\u63cfMapper\u5e76\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u4ea7\u751fMapper\u7684\u5b9e\u73b0\u7c7b\u5b58\u50a8\u5230Spring\u5bb9\u5668\u4e2d\u3002\u76f8\u5173\u7684\u6709\u5982\u4e0b\u56db\u4e2a\u7c7b\uff1a</p> <ul> <li> <p>SqlSessionFactoryBean\uff1a\u9700\u8981\u8fdb\u884c\u914d\u7f6e\uff0c\u7528\u4e8e\u63d0\u4f9bSqlSessionFactory\uff1b</p> </li> <li> <p>MapperScannerConfigurer\uff1a\u9700\u8981\u8fdb\u884c\u914d\u7f6e\uff0c\u7528\u4e8e\u626b\u63cf\u6307\u5b9amapper\u6ce8\u518cBeanDefinition\uff1b</p> </li> <li> <p>MapperFactoryBean\uff1aMapper\u7684FactoryBean\uff0c\u83b7\u5f97\u6307\u5b9aMapper\u65f6\u8c03\u7528getObject\u65b9\u6cd5\uff1b</p> </li> <li> <p>ClassPathMapperScanner\uff1adefinition.setAutowireMode(2) \u4fee\u6539\u4e86\u81ea\u52a8\u6ce8\u5165\u72b6\u6001\uff0c\u6240\u4ee5MapperFactoryBean\u4e2d\u7684setSqlSessionFactory\u4f1a\u81ea\u52a8\u6ce8\u5165\u8fdb\u53bb\u3002</p> </li> </ul> <p>PS\uff1aautowireMode\u53d6\u503c\uff1a1\u662f\u6839\u636e\u540d\u79f0\u81ea\u52a8\u88c5\u914d\uff0c2\u662f\u6839\u636e\u7c7b\u578b\u81ea\u52a8\u88c5\u914d</p> <p>\u914d\u7f6eSqlSessionFactoryBean\u4f5c\u7528\u662f\u5411\u5bb9\u5668\u4e2d\u63d0\u4f9bSqlSessionFactory\uff0cSqlSessionFactoryBean\u5b9e\u73b0\u4e86FactoryBean\u548cInitializingBean\u4e24\u4e2a\u63a5\u53e3\uff0c\u6240\u4ee5\u4f1a\u81ea\u52a8\u6267\u884cgetObject() \u548cafterPropertiesSet()\u65b9\u6cd5</p> <pre><code>SqlSessionFactoryBean implements FactoryBean&lt;SqlSessionFactory&gt;, InitializingBean{\n    public void afterPropertiesSet() throws Exception {\n        //\u521b\u5efaSqlSessionFactory\u5bf9\u8c61\n        this.sqlSessionFactory = this.buildSqlSessionFactory();\n    }\n    public SqlSessionFactory getObject() throws Exception {\n        return this.sqlSessionFactory;\n    }\n}\n</code></pre> <p>\u914d\u7f6eMapperScannerConfigurer\u4f5c\u7528\u662f\u626b\u63cfMapper\uff0c\u5411\u5bb9\u5668\u4e2d\u6ce8\u518cMapper\u5bf9\u5e94\u7684MapperFactoryBean\uff0cMapperScannerConfigurer\u5b9e\u73b0\u4e86BeanDefinitionRegistryPostProcessor\u548cInitializingBean\u4e24\u4e2a\u63a5\u53e3\uff0c\u4f1a\u5728postProcessBeanDefinitionRegistry\u65b9\u6cd5\u4e2d\u5411\u5bb9\u5668\u4e2d\u6ce8\u518cMapperFactoryBean</p> <pre><code>class MapperScannerConfigurer implements BeanDefinitionRegistryPostProcessor, InitializingBean{\n    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) {\n        ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry);\n    }\n}\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#\u5176\u4ed6\u6846\u67b6","title":"\u5176\u4ed6\u6846\u67b6","text":"<p>\u4ee5Spring\u7684context \u547d\u540d\u7a7a\u95f4\u4e3a\u4f8b\uff0c\u8be5\u65b9\u5f0f\u662f\u547d\u540d\u7a7a\u95f4\u6269\u5c55\u65b9\u5f0f\u3002</p> <p>\u9700\u6c42\uff1a\u52a0\u8f7d\u5916\u90e8properties\u6587\u4ef6\uff0c\u5c06\u952e\u503c\u5bf9\u5b58\u50a8\u5728Spring\u5bb9\u5668\u4e2d</p> <pre><code>jdbc.url=jdbc:mysql://localhost:3306/mybatis\njdbc.username=root\njdbc.password=root\n</code></pre> <p>\u5f15\u5165context\u547d\u540d\u7a7a\u95f4\uff0c\u5728\u4f7f\u7528context\u547d\u540d\u7a7a\u95f4\u7684\u6807\u7b7e\uff0c\u4f7f\u7528SpEL\u8868\u8fbe\u5f0f\u5728xml\u6216\u6ce8\u89e3\u4e2d\u6839\u636ekey\u83b7\u5f97value</p> <pre><code>&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n    http://www.springframework.org/schema/beans/spring-beans.xsd\n    http://www.springframework.org/schema/context\n    http://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\n    &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt;\n    &lt;bean id=\"dataSource\" class=\"com.alibaba.druid.pool.DruidDataSource\"&gt;\n        &lt;property name=\"url\" value=\"${jdbc.url}\"&gt;&lt;/property&gt;\n        &lt;property name=\"username\" value=\"${jdbc.username}\"&gt;&lt;/property&gt;\n        &lt;property name=\"password\" value=\"${jdbc.password}\"&gt;&lt;/property&gt;\n    &lt;/bean&gt;\n&lt;/beans&gt;\n</code></pre> <p></p>"},{"location":"Spring/Spring-XML/#\u67d0\u4e00\u4e2a\u6846\u67b6\u4e0espring\u7684\u96c6\u6210\u5f00\u53d1","title":"\u67d0\u4e00\u4e2a\u6846\u67b6\u4e0eSpring\u7684\u96c6\u6210\u5f00\u53d1","text":"<p>\u6b65\u9aa4\u5206\u6790\uff1a</p> <ol> <li>\u786e\u5b9a\u547d\u540d\u7a7a\u95f4\u540d\u79f0\u3001schema\u865a\u62df\u8def\u5f84\u3001\u6807\u7b7e\u540d\u79f0\uff1b</li> <li>\u7f16\u5199schema\u7ea6\u675f\u6587\u4ef6<code>xxx-annotation.xsd</code></li> <li>\u5728\u7c7b\u52a0\u8f7d\u8def\u5f84\u4e0b\u521b\u5efaMETA\u76ee\u5f55\uff0c\u7f16\u5199\u7ea6\u675f\u6620\u5c04\u6587\u4ef6<code>spring.schemas</code>\u548c\u5904\u7406\u5668\u6620\u5c04\u6587\u4ef6<code>spring.handlers</code> </li> <li>\u7f16\u5199\u547d\u540d\u7a7a\u95f4\u5904\u7406\u5668<code>XXXNamespaceHandler</code>\uff0c\u5728<code>init</code>\u65b9\u6cd5\u4e2d\u6ce8\u518c<code>XXXBeanDefinitionParser</code></li> <li>\u7f16\u5199\u6807\u7b7e\u7684\u89e3\u6790\u5668<code>XXXBeanDefinitionParser</code>\uff0c\u5728parse\u65b9\u6cd5\u4e2d\u6ce8\u518c<code>XXXBeanPostProcessor</code> </li> <li>\u7f16\u5199<code>XXXBeanPostProcessor</code> </li> </ol> <p>\u200b   ==========\u4ee5\u4e0a\u4e94\u6b65\u662f\u6846\u67b6\u5f00\u53d1\u8005\u8981\u505a\u7684\uff0c\u4e0b\u9762\u662f\u6846\u67b6\u4f7f\u7528\u8005\u8981\u505a\u7684=========== </p> <ol> <li> <p>\u5728<code>applicationContext.xml</code>\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f15\u5165\u547d\u540d\u7a7a\u95f4</p> </li> <li> <p>\u5728<code>applicationContext.xml</code>\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6807\u7b7e</p> </li> </ol> <p>\u4e0a\u4e00\u8282\uff1a \u6982\u8ff0</p> <p>\u4e0b\u4e00\u8282\uff1a \u57fa\u4e8e\u6ce8\u89e3\u7684Spring\u5e94\u7528</p>"},{"location":"SpringBoot/SpringBoot/","title":"SpringBoot","text":""},{"location":"SpringBoot/SpringBoot/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<ul> <li>\u5b98\u7f51: https://spring.io</li> <li>\u6838\u5fc3\u7406\u5ff5: \"Spring makes Java simple\"</li> <li>Spring Boot \u5b9a\u4f4d: \u7b80\u5316 Spring \u5e94\u7528\u521d\u59cb\u642d\u5efa\u548c\u5f00\u53d1\u6d41\u7a0b\uff0c\u63d0\u4f9b\u5feb\u901f\u5f00\u53d1\u548c\u7b80\u5316\u914d\u7f6e\u7684\u80fd\u529b\u3002</li> </ul> <p>Spring \u751f\u6001\u7cfb\u7edf\u4e2d\u6700\u6838\u5fc3\u7684\u662f Spring Framework\uff0c\u63d0\u4f9b\u4f9d\u8d56\u6ce8\u5165\u3001\u4e8b\u52a1\u7ba1\u7406\u3001Web \u5f00\u53d1\u652f\u6301\u7b49\u57fa\u7840\u529f\u80fd\u3002\u7531\u4e8e\u76f4\u63a5\u4f7f\u7528 Spring Framework \u5b58\u5728\u914d\u7f6e\u7e41\u7410\u7684\u95ee\u9898\uff0cSpring Boot \u901a\u8fc7\u81ea\u52a8\u5316\u914d\u7f6e\u548c\u8d77\u6b65\u4f9d\u8d56\u663e\u8457\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002</p> <p></p>"},{"location":"SpringBoot/SpringBoot/#\u57fa\u7840\u7bc7","title":"\u57fa\u7840\u7bc7","text":""},{"location":"SpringBoot/SpringBoot/#\u6838\u5fc3\u7279\u6027","title":"\u6838\u5fc3\u7279\u6027","text":"<ol> <li>\u8d77\u6b65\u4f9d\u8d56\uff08Starter Dependencies\uff09 </li> </ol> <p>\u901a\u8fc7 Maven \u5750\u6807\u6574\u5408\u529f\u80fd\u6240\u9700\u4f9d\u8d56\uff0c\u5982 <code>spring-boot-starter-web</code> \u5305\u542b Spring MVC \u548c Tomcat\u3002</p> <ol> <li>\u81ea\u52a8\u914d\u7f6e\uff08Auto-Configuration\uff09 </li> </ol> <p>\u57fa\u4e8e\u7ea6\u5b9a\u5927\u4e8e\u914d\u7f6e\u539f\u5219\uff0c\u81ea\u52a8\u6ce8\u5165\u5e38\u7528 Bean\uff0c\u901a\u8fc7 <code>@Conditional</code> \u7cfb\u5217\u6ce8\u89e3\u63a7\u5236\u6761\u4ef6\u52a0\u8f7d\u3002</p> <ol> <li> <p>\u5176\u4ed6\u7279\u6027 </p> </li> <li> <p>\u5185\u5d4c Web \u670d\u52a1\u5668\uff08\u9ed8\u8ba4 Tomcat\uff0c\u652f\u6301 Jetty/Undertow\uff09\u3002</p> </li> <li>\u5916\u90e8\u5316\u914d\u7f6e\uff08YAML/Properties \u591a\u73af\u5883\u652f\u6301\uff09\u3002</li> <li>\u65e0 XML \u914d\u7f6e\uff08\u63a8\u8350 Java Config\uff0c\u652f\u6301 <code>@ImportResource</code> \u5bfc\u5165 XML\uff09\u3002</li> </ol>"},{"location":"SpringBoot/SpringBoot/#\u5165\u95e8\u793a\u4f8b","title":"\u5165\u95e8\u793a\u4f8b","text":"<ol> <li> <p>\u521b\u5efa Maven \u9879\u76ee\u5e76\u6dfb\u52a0\u4f9d\u8d56 <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> </li> <li> <p>\u7f16\u5199 Controller <pre><code>@RestController\npublic class HelloController {\n    @GetMapping(\"/hello\")\n    public String hello() {\n        return \"Hello World ~\";\n    }\n}\n</code></pre></p> </li> <li> <p>\u542f\u52a8\u7c7b <pre><code>@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n</code></pre></p> <p>\u6ce8\u610f\uff1aSpring Boot 3.x \u9700 JDK 17+\u3002</p> </li> </ol>"},{"location":"SpringBoot/SpringBoot/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p>Properties \u6587\u4ef6\uff08<code>application.properties</code>\uff09 <pre><code>server.port=8080\nserver.servlet.context-path=/start\n</code></pre></p> </li> <li> <p>YAML \u6587\u4ef6\uff08<code>application.yml</code>\uff0c\u7f29\u8fdb\u7528\u7a7a\u683c\uff0c\u63a8\u8350 2 \u7a7a\u683c\uff09  </p> </li> </ul> <pre><code>server:\n  port: 8080\n  servlet:\n    context-path: /start\n</code></pre> <p>\u914d\u7f6e\u6ce8\u5165\u65b9\u5f0f\uff1a - <code>@Value(\"${key}\")</code>\uff1a\u6ce8\u5165\u5355\u4e2a\u5c5e\u6027\u3002 - <code>@ConfigurationProperties(prefix=\"prefix\")</code>\uff1a\u7ed1\u5b9a\u5230 Bean\uff08\u9700\u914d\u5408 <code>@EnableConfigurationProperties</code>\uff09\u3002</p>"},{"location":"SpringBoot/SpringBoot/#\u6574\u5408-mybatis","title":"\u6574\u5408 MyBatis","text":"<ol> <li> <p>\u6dfb\u52a0\u4f9d\u8d56\uff08\u65e0\u9700\u6307\u5b9a\u7248\u672c\uff0c\u7ee7\u627f Spring Boot \u7236 Pom\uff09 <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> </li> <li> <p>\u914d\u7f6e\u6570\u636e\u6e90 <pre><code>spring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springboot\n    username: root\n    password: 123456\n</code></pre></p> </li> <li> <p>Mapper \u626b\u63cf </p> </li> <li>\u63a5\u53e3\u6dfb\u52a0 <code>@Mapper</code> \u6ce8\u89e3\u3002</li> <li>\u6216\u542f\u52a8\u7c7b\u6dfb\u52a0 <code>@MapperScan(\"com.example.mapper\")</code>\u3002</li> </ol>"},{"location":"SpringBoot/SpringBoot/#bean-\u7ba1\u7406","title":"Bean \u7ba1\u7406","text":"<ul> <li> <p>\u7ec4\u4ef6\u626b\u63cf   Spring Boot \u9ed8\u8ba4\u626b\u63cf\u542f\u52a8\u7c7b\u6240\u5728\u5305\u53ca\u5176\u5b50\u5305\u3002\u53ef\u901a\u8fc7 <code>@ComponentScan</code> \u81ea\u5b9a\u4e49\u626b\u63cf\u8def\u5f84\u3002</p> </li> <li> <p>\u6ce8\u518c Bean \u7684\u6ce8\u89e3 </p> </li> </ul> \u6ce8\u89e3 \u4f7f\u7528\u573a\u666f <code>@Component</code> \u901a\u7528\u7ec4\u4ef6 <code>@Controller</code> Web \u5c42\u63a7\u5236\u5668 <code>@Service</code> \u4e1a\u52a1\u903b\u8f91\u5c42 <code>@Repository</code> \u6570\u636e\u8bbf\u95ee\u5c42\uff08JPA \u5e38\u7528\uff09 <ul> <li> <p>\u7b2c\u4e09\u65b9 Bean \u6ce8\u518c   \u4f7f\u7528 <code>@Bean</code>\uff08\u5728\u914d\u7f6e\u7c7b\u4e2d\uff09\u6216 <code>@Import</code>\uff08\u5bfc\u5165\u914d\u7f6e\u7c7b\u6216 <code>ImportSelector</code> \u5b9e\u73b0\u7c7b\uff09\u3002 \u793a\u4f8b\uff1a <pre><code>@Configuration\npublic class ThirdPartyConfig {\n    @Bean\n    public ThirdPartyService thirdPartyService() {\n        return new ThirdPartyService();\n    }\n}\n</code></pre></p> </li> <li> <p>\u6761\u4ef6\u6ce8\u89e3   | \u6ce8\u89e3                        | \u8bf4\u660e                       |   | --------------------------- | -------------------------- |   | <code>@ConditionalOnProperty</code>    | \u5b58\u5728\u6307\u5b9a\u914d\u7f6e\u5c5e\u6027\u65f6\u751f\u6548     |   | <code>@ConditionalOnMissingBean</code> | \u5bb9\u5668\u4e2d\u65e0\u8be5\u7c7b\u578b Bean \u65f6\u751f\u6548 |   | <code>@ConditionalOnClass</code>       | \u7c7b\u8def\u5f84\u5b58\u5728\u6307\u5b9a\u7c7b\u65f6\u751f\u6548     |</p> </li> </ul>"},{"location":"SpringBoot/SpringBoot/#\u81ea\u52a8\u914d\u7f6e\u539f\u7406","title":"\u81ea\u52a8\u914d\u7f6e\u539f\u7406","text":"<ol> <li> <p>\u542f\u52a8\u6d41\u7a0b </p> </li> <li> <p><code>@SpringBootApplication</code> \u7ec4\u5408\u4e86 <code>@EnableAutoConfiguration</code>\u3002</p> </li> <li><code>@EnableAutoConfiguration</code> \u901a\u8fc7 <code>@Import</code> \u5bfc\u5165 <code>AutoConfigurationImportSelector</code>\u3002</li> <li>\u52a0\u8f7d <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>\uff08Spring Boot 3.x\uff09\u6216 <code>spring.factories</code>\uff08\u65e7\u7248\uff09\u4e2d\u7684\u914d\u7f6e\u7c7b\u3002</li> <li> <p>\u6839\u636e <code>@Conditional</code> \u6761\u4ef6\u51b3\u5b9a\u662f\u5426\u6ce8\u518c Bean\u3002</p> </li> <li> <p>\u793a\u4f8b </p> </li> </ol> <pre><code>@Configuration\n@ConditionalOnClass(DataSource.class)\npublic class DataSourceAutoConfiguration {\n    // \u5f53\u7c7b\u8def\u5f84\u5b58\u5728 DataSource \u65f6\u81ea\u52a8\u914d\u7f6e\n}\n</code></pre>"},{"location":"SpringBoot/SpringBoot/#\u81ea\u5b9a\u4e49-starter","title":"\u81ea\u5b9a\u4e49 Starter","text":""},{"location":"SpringBoot/SpringBoot/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<ol> <li>\u521b\u5efa\u4e24\u4e2a\u6a21\u5757 </li> <li><code>autoconfigure</code>\uff1a\u5305\u542b\u81ea\u52a8\u914d\u7f6e\u4ee3\u7801\u3002</li> <li> <p><code>starter</code>\uff1a\u7a7a\u6a21\u5757,\u8d1f\u8d23\u4f9d\u8d56\u7ba1\u7406\uff0c\u4f9d\u8d56\u4e8e <code>autoconfigure</code>\u3002</p> </li> <li> <p>\u7f16\u5199\u81ea\u52a8\u914d\u7f6e\u7c7b </p> </li> </ol> <pre><code>@Configuration\n@ConditionalOnClass(MyService.class)\n@EnableConfigurationProperties(MyServiceProperties.class)\npublic class MyServiceAutoConfiguration {\n    @Bean\n    @ConditionalOnMissingBean\n    public MyService myService(MyServiceProperties properties) {\n        return new MyService(properties);\n    }\n}\n</code></pre> <ol> <li> <p>\u5b9a\u4e49\u914d\u7f6e\u5c5e\u6027\u7c7b <pre><code>@ConfigurationProperties(prefix = \"my.service\")\npublic class MyServiceProperties {\n    private String message = \"Hello, World!\";\n    // Getter/Setter\n}\n</code></pre></p> <p>\u9700\u5728\u542f\u52a8\u7c7b\u6dfb\u52a0 <code>@EnableConfigurationProperties(MyServiceProperties.class)</code>\u3002</p> </li> <li> <p>\u6ce8\u518c\u914d\u7f6e\u7c7b    \u5728 <code>autoconfigure/src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> \u4e2d\u6dfb\u52a0\uff1a <pre><code>com.example.autoconfigure.MyServiceAutoConfiguration\n</code></pre></p> </li> <li> <p>\u53d1\u5e03\u5e76\u4f7f\u7528 Starter <pre><code>&lt;!-- \u5728\u9879\u76ee\u4e2d\u5f15\u5165 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;my-service-starter&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> </li> </ol>"},{"location":"SpringBoot/SpringBoot/#\u8865\u5145\u5185\u5bb9","title":"\u8865\u5145\u5185\u5bb9","text":""},{"location":"SpringBoot/SpringBoot/#\u591a\u73af\u5883\u914d\u7f6e","title":"\u591a\u73af\u5883\u914d\u7f6e","text":"<ul> <li>\u914d\u7f6e\u6587\u4ef6\u547d\u540d\uff1a<code>application-{profile}.yml</code>\u3002</li> <li>\u6fc0\u6d3b Profile\uff1a <pre><code>spring:\n  profiles:\n    active: dev\n</code></pre></li> </ul>"},{"location":"SpringBoot/SpringBoot/#\u5185\u5d4c\u670d\u52a1\u5668\u5207\u6362","title":"\u5185\u5d4c\u670d\u52a1\u5668\u5207\u6362","text":"<pre><code>&lt;!-- \u6392\u9664 Tomcat --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;exclusions&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n    &lt;/exclusions&gt;\n&lt;/dependency&gt;\n&lt;!-- \u6dfb\u52a0 Jetty --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"SpringBoot/SpringBoot/#\u751f\u4ea7\u5c31\u7eea\u7279\u6027actuator","title":"\u751f\u4ea7\u5c31\u7eea\u7279\u6027\uff08Actuator\uff09","text":"<p><pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> \u901a\u8fc7\u7aef\u70b9 <code>/actuator/health</code> \u76d1\u63a7\u5e94\u7528\u72b6\u6001\u3002</p>"},{"location":"SpringBoot/SpringBoot/#\u5e38\u89c1\u95ee\u9898","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li> <p>\u7248\u672c\u517c\u5bb9\u6027    Spring Boot 3.x \u9700 Jakarta EE 9+\uff08\u5305\u540d\u4ece <code>javax</code> \u6539\u4e3a <code>jakarta</code>\uff09\u3002</p> </li> <li> <p>\u65e5\u5fd7\u914d\u7f6e    \u9ed8\u8ba4\u4f7f\u7528 Logback\uff0c\u914d\u7f6e <code>application.yml</code>\uff1a <pre><code>logging:\n  level:\n    root: INFO\n    com.example: DEBUG\n</code></pre></p> </li> <li> <p>\u6253\u5305\u90e8\u7f72 </p> </li> <li>\u6253\u5305\u4e3a\u53ef\u6267\u884c JAR\uff1a<code>mvn clean package</code>\u3002</li> <li>WAR \u90e8\u7f72\u9700\u7ee7\u627f <code>SpringBootServletInitializer</code>\u3002</li> </ol>"},{"location":"SpringCloud/","title":"Spring Cloud \u5fae\u670d\u52a1\u6280\u672f\u6808","text":"<p>Spring Cloud \u5b8c\u6574\u6280\u672f\u6808\u5b66\u4e60\u7b14\u8bb0\uff0c\u4ece\u57fa\u7840\u6982\u5ff5\u5230\u5b9e\u9645\u9879\u76ee\u5e94\u7528</p>"},{"location":"SpringCloud/#-\u5b66\u4e60\u8def\u5f84","title":"\ud83d\udcda \u5b66\u4e60\u8def\u5f84","text":""},{"location":"SpringCloud/#\u57fa\u7840\u7bc7","title":"\u57fa\u7840\u7bc7","text":"<ul> <li>Spring Cloud \u6982\u8ff0\u4e0e\u5fae\u670d\u52a1\u67b6\u6784</li> <li>MyBatis-Plus \u6570\u636e\u8bbf\u95ee\u5c42</li> </ul>"},{"location":"SpringCloud/#\u6838\u5fc3\u7ec4\u4ef6\u7bc7","title":"\u6838\u5fc3\u7ec4\u4ef6\u7bc7","text":"<ul> <li>\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0</li> <li>\u8d1f\u8f7d\u5747\u8861\u4e0e\u670d\u52a1\u8c03\u7528</li> <li>\u670d\u52a1\u4fdd\u62a4\u4e0e\u7194\u65ad\u964d\u7ea7</li> <li>API \u7f51\u5173</li> </ul>"},{"location":"SpringCloud/#\u57fa\u7840\u8bbe\u65bd\u7bc7","title":"\u57fa\u7840\u8bbe\u65bd\u7bc7","text":"<ul> <li>Docker \u5bb9\u5668\u5316\u90e8\u7f72</li> <li>\u6d88\u606f\u961f\u5217 MQ</li> <li>\u5206\u5e03\u5f0f\u641c\u7d22 Elasticsearch</li> </ul>"},{"location":"SpringCloud/#-\u5b66\u4e60\u5efa\u8bae","title":"\ud83c\udfaf \u5b66\u4e60\u5efa\u8bae","text":"<ol> <li>\u6309\u987a\u5e8f\u5b66\u4e60\uff1a\u5efa\u8bae\u6309\u7167\u4e0a\u8ff0\u8def\u5f84\u987a\u5e8f\u5b66\u4e60</li> <li>\u7406\u8bba\u7ed3\u5408\u5b9e\u8df5\uff1a\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u6709\u5b8c\u6574\u7684\u4ee3\u7801\u793a\u4f8b</li> <li>\u52a8\u624b\u5b9e\u9a8c\uff1a\u5efa\u8bae\u642d\u5efa\u672c\u5730\u73af\u5883\u8fdb\u884c\u5b9e\u8df5</li> <li>\u9879\u76ee\u6574\u5408\uff1a\u6700\u540e\u901a\u8fc7\u5b9e\u6218\u9879\u76ee\u6574\u5408\u6240\u6709\u7ec4\u4ef6</li> </ol>"},{"location":"SpringCloud/#-\u6280\u672f\u6808\u8986\u76d6","title":"\ud83d\udcd6 \u6280\u672f\u6808\u8986\u76d6","text":"<ul> <li>Spring Cloud\uff1a\u5fae\u670d\u52a1\u6838\u5fc3\u6846\u67b6</li> <li>MyBatis-Plus\uff1a\u6570\u636e\u8bbf\u95ee\u589e\u5f3a</li> <li>Docker\uff1a\u5bb9\u5668\u5316\u90e8\u7f72</li> <li>RabbitMQ\uff1a\u6d88\u606f\u961f\u5217</li> <li>Elasticsearch\uff1a\u5206\u5e03\u5f0f\u641c\u7d22</li> <li>Redis\uff1a\u7f13\u5b58\u4e0e\u96c6\u7fa4</li> <li>Nacos\uff1a\u670d\u52a1\u6ce8\u518c\u53d1\u73b0</li> <li>Sentinel\uff1a\u670d\u52a1\u4fdd\u62a4</li> <li>Gateway\uff1aAPI \u7f51\u5173</li> </ul> <p>\u6301\u7eed\u66f4\u65b0\u4e2d\uff0c\u8bb0\u5f55\u5fae\u670d\u52a1\u67b6\u6784\u5b66\u4e60\u7684\u6bcf\u4e00\u6b65...</p>"},{"location":"SpringCloud/Docker/","title":"Docker","text":"<p>\u53c2\u8003\uff1aDocker</p>"},{"location":"SpringCloud/Elasticsearch/","title":"Elasticsearch","text":"<p>Elasticsearch\uff1a\u5b98\u65b9\u5206\u5e03\u5f0f\u641c\u7d22\u548c\u5206\u6790\u5f15\u64ce | Elastic</p> <p>\u6570\u636e\u5e93\u7684\u6a21\u7cca\u641c\u7d22\u529f\u80fd\u5355\u4e00\uff0c\u5339\u914d\u6761\u4ef6\u975e\u5e38\u82db\u523b\uff0c\u5fc5\u987b\u6070\u597d\u5305\u542b\u7528\u6237\u641c\u7d22\u7684\u5173\u952e\u5b57\u3002</p> <p>\u800c\u5728\u641c\u7d22\u5f15\u64ce\u4e2d\uff0c\u7528\u6237\u8f93\u5165\u51fa\u73b0\u4e2a\u522b\u9519\u5b57\uff0c\u6216\u8005\u7528\u62fc\u97f3\u641c\u7d22\u3001\u540c\u4e49\u8bcd\u641c\u7d22\u90fd\u80fd\u6b63\u786e\u5339\u914d\u5230\u6570\u636e\u3002\u5728\u9762\u4e34\u6d77\u91cf\u6570\u636e\u7684\u641c\u7d22\uff0c\u6216\u8005\u6709\u4e00\u4e9b\u590d\u6742\u641c\u7d22\u9700\u6c42\u7684\u65f6\u5019\uff0c\u63a8\u8350\u4f7f\u7528\u4e13\u95e8\u7684\u641c\u7d22\u5f15\u64ce\u6765\u5b9e\u73b0\u641c\u7d22\u529f\u80fd\u3002</p> <p>Elasticsearch\u662f\u7531elastic\u516c\u53f8\u5f00\u53d1\u7684\u4e00\u5957\u641c\u7d22\u5f15\u64ce\u6280\u672f\uff0c\u5b83\u662felastic\u6280\u672f\u6808\u4e2d\u7684\u4e00\u90e8\u5206\u3002\u5b8c\u6574\u7684\u6280\u672f\u6808\u5305\u62ec\uff1a</p> <ul> <li>Elasticsearch\uff1a\u7528\u4e8e\u6570\u636e\u5b58\u50a8\u3001\u8ba1\u7b97\u548c\u641c\u7d22</li> <li>Logstash/Beats\uff1a\u7528\u4e8e\u6570\u636e\u6536\u96c6</li> <li>Kibana\uff1a\u7528\u4e8e\u6570\u636e\u53ef\u89c6\u5316</li> </ul> <p>\u6574\u5957\u6280\u672f\u6808\u88ab\u79f0\u4e3aELK\uff0c\u7ecf\u5e38\u7528\u6765\u505a\u65e5\u5fd7\u6536\u96c6\u3001\u7cfb\u7edf\u76d1\u63a7\u548c\u72b6\u6001\u5206\u6790\u7b49\u7b49</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>1.docker\u5b89\u88c5elasticsearch</p> <pre><code>docker run -d \\\n  --name es \\\n  -e \"ES_JAVA_OPTS=-Xms512m -Xmx512m\" \\\n  -e \"discovery.type=single-node\" \\\n  -v es-data:/usr/share/elasticsearch/data \\\n  -v es-plugins:/usr/share/elasticsearch/plugins \\\n  --privileged \\\n  --network work \\\n  -p 9200:9200 \\\n  -p 9300:9300 \\\n  elasticsearch:7.12.1\n</code></pre> <p>Note</p> <p>-e \"ES_JAVA_OPTS=-Xms512m -Xmx512m\" \u8bbe\u7f6eJava\u865a\u62df\u673a\u5185\u5b58</p> <p>-e \"discovery.type=single-node\" \u8bbe\u7f6e\u5355\u673a\u6a21\u5f0f</p> <p>2.docker\u5b89\u88c5Kibana</p> <pre><code>docker run -d \\\n--name kibana \\\n-e ELASTICSEARCH_HOSTS=http://es:9200 \\\n--network=work \\\n-p 5601:5601  \\\nkibana:7.12.1\n</code></pre> <p>Tip</p> <p>-e ELASTICSEARCH_HOSTS=http://es:9200 \u8bbe\u7f6eelasticsearch\u5730\u5740\uff0c\u540c\u4e00docker\u7f51\u7edc\u4e2d\u53ef\u4f7f\u7528\u5bb9\u5668\u540d</p> <p>\u8bbf\u95ee5601\u7aef\u53e3\u5373\u53ef\u8fdb\u5165\u56fe\u5f62\u5316\u754c\u9762</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u521d\u8bc6es","title":"\u521d\u8bc6ES","text":""},{"location":"SpringCloud/Elasticsearch/#\u5012\u6392\u7d22\u5f15","title":"\u5012\u6392\u7d22\u5f15","text":"<p>elasticsearch\u4e4b\u6240\u4ee5\u6709\u5982\u6b64\u9ad8\u6027\u80fd\u7684\u641c\u7d22\u8868\u73b0\uff0c\u6b63\u662f\u56e0\u4e3a\u5e95\u5c42\u7684\u5012\u6392\u7d22\u5f15\u6280\u672f\u3002</p> <p>\u5012\u6392\u7d22\u5f15\u7684\u6982\u5ff5\u662f\u57fa\u4e8eMySQL\u8fd9\u6837\u7684\u6b63\u5411\u7d22\u5f15\u800c\u8a00\u7684\u3002</p> <p>Info</p> <p>\u6839\u636eid\u7cbe\u786e\u5339\u914d\u65f6\uff0c\u53ef\u4ee5\u8d70\u7d22\u5f15\uff0c\u67e5\u8be2\u6548\u7387\u8f83\u9ad8\u3002\u800c\u5f53\u641c\u7d22\u6761\u4ef6\u4e3a\u6a21\u7cca\u5339\u914d\u65f6\uff0c\u7531\u4e8e\u7d22\u5f15\u65e0\u6cd5\u751f\u6548\uff0c\u5bfc\u81f4\u4ece\u7d22\u5f15\u67e5\u8be2\u9000\u5316\u4e3a\u5168\u8868\u626b\u63cf\uff0c\u6548\u7387\u5f88\u5dee\u3002 \u56e0\u6b64\uff0c\u6b63\u5411\u7d22\u5f15\u9002\u5408\u4e8e\u6839\u636e\u7d22\u5f15\u5b57\u6bb5\u7684\u7cbe\u786e\u641c\u7d22\uff0c\u4e0d\u9002\u5408\u57fa\u4e8e\u90e8\u5206\u8bcd\u6761\u7684\u6a21\u7cca\u5339\u914d\u3002</p> <p>\u5012\u6392\u7d22\u5f15\u4e2d\u6709\u4e24\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u6587\u6863\uff08<code>Document</code>\uff09\uff1a\u7528\u6765\u641c\u7d22\u7684\u6570\u636e\uff0c\u5176\u4e2d\u7684\u6bcf\u4e00\u6761\u6570\u636e\u5c31\u662f\u4e00\u4e2a\u6587\u6863\u3002\u4f8b\u5982\u4e00\u4e2a\u7f51\u9875\u3001\u4e00\u4e2a\u5546\u54c1\u4fe1\u606f</li> <li>\u8bcd\u6761\uff08<code>Term</code>\uff09\uff1a\u5bf9\u6587\u6863\u6570\u636e\u6216\u7528\u6237\u641c\u7d22\u6570\u636e\uff0c\u5229\u7528\u67d0\u79cd\u7b97\u6cd5\u5206\u8bcd\uff0c\u5f97\u5230\u7684\u5177\u5907\u542b\u4e49\u7684\u8bcd\u8bed\u5c31\u662f\u8bcd\u6761\u3002\u4f8b\u5982\uff1a\u6211\u662f\u4e2d\u56fd\u4eba\uff0c\u5c31\u53ef\u4ee5\u5206\u4e3a\uff1a\u6211\u3001\u662f\u3001\u4e2d\u56fd\u4eba\u3001\u4e2d\u56fd\u3001\u56fd\u4eba\u8fd9\u6837\u7684\u51e0\u4e2a\u8bcd\u6761</li> </ul> <p>\u521b\u5efa\u5012\u6392\u7d22\u5f15\u662f\u5bf9\u6b63\u5411\u7d22\u5f15\u7684\u4e00\u79cd\u7279\u6b8a\u5904\u7406\u548c\u5e94\u7528\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5c06\u6bcf\u4e00\u4e2a\u6587\u6863\u7684\u6570\u636e\u5229\u7528\u5206\u8bcd\u7b97\u6cd5\u6839\u636e\u8bed\u4e49\u62c6\u5206\uff0c\u5f97\u5230\u4e00\u4e2a\u4e2a\u8bcd\u6761</li> <li>\u521b\u5efa\u8868\uff0c\u6bcf\u884c\u6570\u636e\u5305\u62ec\u8bcd\u6761\u3001\u8bcd\u6761\u6240\u5728\u6587\u6863id\u3001\u4f4d\u7f6e\u7b49\u4fe1\u606f</li> <li>\u56e0\u4e3a\u8bcd\u6761\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u7ed9\u8bcd\u6761\u521b\u5efa\u6b63\u5411\u7d22\u5f15</li> </ul> <p>\u6b64\u65f6\u5f62\u6210\u7684\u8fd9\u5f20\u4ee5\u8bcd\u6761\u4e3a\u7d22\u5f15\u7684\u8868\uff0c\u5c31\u662f\u5012\u6392\u7d22\u5f15\u8868\uff0c\u4e24\u8005\u5bf9\u6bd4\u5982\u4e0b\uff1a</p> <p>\u6b63\u5411\u7d22\u5f15</p> id\uff08\u7d22\u5f15\uff09 title price 1 \u5c0f\u7c73\u624b\u673a 3499 2 \u534e\u4e3a\u624b\u673a 4999 3 \u534e\u4e3a\u5c0f\u7c73\u5145\u7535\u5668 49 4 \u5c0f\u7c73\u624b\u73af 49 ... ... ... <p>\u5012\u6392\u7d22\u5f15</p> \u8bcd\u6761\uff08\u7d22\u5f15\uff09 \u6587\u6863id \u5c0f\u7c73 1\uff0c3\uff0c4 \u624b\u673a 1\uff0c2 \u534e\u4e3a 2\uff0c3 \u5145\u7535\u5668 3 \u624b\u73af 4 <p></p> <p></p> <p>\u6b63\u5411\u7d22\u5f15\uff1a</p> <ul> <li>\u4f18\u70b9\uff1a <ul> <li>\u53ef\u4ee5\u7ed9\u591a\u4e2a\u5b57\u6bb5\u521b\u5efa\u7d22\u5f15</li> <li>\u6839\u636e\u7d22\u5f15\u5b57\u6bb5\u641c\u7d22\u3001\u6392\u5e8f\u901f\u5ea6\u975e\u5e38\u5feb</li> </ul> </li> <li>\u7f3a\u70b9\uff1a <ul> <li>\u6839\u636e\u975e\u7d22\u5f15\u5b57\u6bb5\uff0c\u6216\u8005\u7d22\u5f15\u5b57\u6bb5\u4e2d\u7684\u90e8\u5206\u8bcd\u6761\u67e5\u627e\u65f6\uff0c\u53ea\u80fd\u5168\u8868\u626b\u63cf\u3002</li> </ul> </li> </ul> <p></p> <p>\u5012\u6392\u7d22\u5f15\uff1a</p> <ul> <li>\u4f18\u70b9\uff1a <ul> <li>\u6839\u636e\u8bcd\u6761\u641c\u7d22\u3001\u6a21\u7cca\u641c\u7d22\u65f6\uff0c\u901f\u5ea6\u975e\u5e38\u5feb</li> </ul> </li> <li>\u7f3a\u70b9\uff1a <ul> <li>\u53ea\u80fd\u7ed9\u8bcd\u6761\u521b\u5efa\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u5b57\u6bb5</li> <li>\u65e0\u6cd5\u6839\u636e\u5b57\u6bb5\u505a\u6392\u5e8f</li> </ul> </li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#ik\u5206\u8bcd\u5668","title":"IK\u5206\u8bcd\u5668","text":"<p>Elasticsearch\u7684\u5173\u952e\u5c31\u662f\u5012\u6392\u7d22\u5f15\uff0c\u800c\u5012\u6392\u7d22\u5f15\u4f9d\u8d56\u4e8e\u5bf9\u6587\u6863\u5185\u5bb9\u7684\u5206\u8bcd\uff0c\u800c\u5206\u8bcd\u5219\u9700\u8981\u9ad8\u6548\u3001\u7cbe\u51c6\u7684\u5206\u8bcd\u7b97\u6cd5\uff0cIK\u5206\u8bcd\u5668\u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u4e2d\u6587\u5206\u8bcd\u7b97\u6cd5\u3002</p>"},{"location":"SpringCloud/Elasticsearch/#\u5b89\u88c5_1","title":"\u5b89\u88c5","text":"<p>\u65b9\u6848\u4e00\uff1a\u5728\u7ebf\u5b89\u88c5</p> <p>\u8fd0\u884c\u4e00\u4e2a\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>docker exec -it es\u5bb9\u5668\u540d ./bin/elasticsearch-plugin  install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-7.12.1.zip\n</code></pre> <p>GitHub - infinilabs/analysis-ik: \ud83d\ude8c The IK Analysis plugin integrates Lucene IK analyzer into Elasticsearch and OpenSearch, support customized dictionary.</p> <p>\u7136\u540e\u91cd\u542fes\u5bb9\u5668\uff1a</p> <pre><code>docker restart es\u5bb9\u5668\u540d\n</code></pre> <p></p> <p>\u65b9\u6848\u4e8c\uff1a\u79bb\u7ebf\u5b89\u88c5</p> <p>\u67e5\u770b\u4e4b\u524d\u5b89\u88c5\u7684Elasticsearch\u5bb9\u5668\u7684plugins\u6570\u636e\u5377\u76ee\u5f55\uff1a</p> <pre><code>docker volume inspect es-plugins\n</code></pre> <p>\u5c06\u63d2\u4ef6\u590d\u5236\u5230\u5bb9\u5668\u6302\u8f7d\u7684\u76ee\u5f55\uff0c\u91cd\u542f\u5bb9\u5668\u5373\u53ef</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>IK\u5206\u8bcd\u5668\u5305\u542b\u4e24\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li><code>ik_smart</code>\uff1a\u667a\u80fd\u8bed\u4e49\u5207\u5206 </li> <li><code>ik_max_word</code>\uff1a\u6700\u7ec6\u7c92\u5ea6\u5207\u5206 </li> </ul> <p></p> <p>\u6211\u4eec\u5728Kibana\u7684DevTools\u4e0a\u6d4b\u8bd5\u5206\u8bcd\u5668\uff0c\u9996\u5148\u6d4b\u8bd5Elasticsearch\u5b98\u65b9\u63d0\u4f9b\u7684\u6807\u51c6\u5206\u8bcd\u5668\uff1a</p> <pre><code>POST /_analyze\n{\n  \"analyzer\": \"standard\",\n  \"text\": \"Elasticsearch\u662f\u4e00\u4e2a\u57fa\u4e8eLucene\u7684\u641c\u7d22\u670d\u52a1\u5668\"\n}\n</code></pre> <p>Note</p> <p>\u6807\u51c6\u5206\u8bcd\u5668\u9002\u7528\u4e8e\u82f1\u6587\u5206\u8bcd\uff0c\u4e2d\u6587\u5206\u8bcd\u6548\u679c\u4e0d\u597d</p> <p>\u4e2d\u6587\u5efa\u8bae\u4f7f\u7528<code>ik_smart</code>\u6a21\u5f0f</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u62d3\u5c55\u8bcd\u5178","title":"\u62d3\u5c55\u8bcd\u5178","text":"<p>\u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u201c\u9020\u8bcd\u8fd0\u52a8\u201d\u4e5f\u8d8a\u53d1\u7684\u9891\u7e41\u3002\u51fa\u73b0\u4e86\u5f88\u591a\u65b0\u7684\u8bcd\u8bed\uff0c\u5728\u539f\u6709\u7684\u8bcd\u6c47\u5217\u8868\u4e2d\u5e76\u4e0d\u5b58\u5728\u3002</p> <p>\u6240\u4ee5\u8981\u60f3\u6b63\u786e\u5206\u8bcd\uff0cIK\u5206\u8bcd\u5668\u7684\u8bcd\u5e93\u4e5f\u9700\u8981\u4e0d\u65ad\u7684\u66f4\u65b0\uff0cIK\u5206\u8bcd\u5668\u63d0\u4f9b\u4e86\u6269\u5c55\u8bcd\u6c47\u7684\u529f\u80fd\u3002</p> <p>1.\u6253\u5f00IK\u5206\u8bcd\u5668config\u76ee\u5f55\uff1a</p> <p></p> <p>Tip</p> <p>\u6ce8\u610f\uff0c\u5982\u679c\u91c7\u7528\u5728\u7ebf\u5b89\u88c5\u7684\u901a\u8fc7\uff0c\u9ed8\u8ba4\u662f\u6ca1\u6709config\u76ee\u5f55\u7684\uff0c\u9700\u8981\u81ea\u5df1\u521b\u5efa</p> <p>2.\u5728IKAnalyzer.cfg.xml\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u6dfb\u52a0\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE properties SYSTEM \"http://java.sun.com/dtd/properties.dtd\"&gt;\n&lt;properties&gt;\n        &lt;comment&gt;IK Analyzer \u6269\u5c55\u914d\u7f6e&lt;/comment&gt;\n        &lt;!--\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u81ea\u5df1\u7684\u6269\u5c55\u5b57\u5178 *** \u6dfb\u52a0\u6269\u5c55\u8bcd\u5178--&gt;\n        &lt;entry key=\"ext_dict\"&gt;ext.dic&lt;/entry&gt;\n        &lt;entry key=\"ext_stopwords\"&gt;&lt;/entry&gt;     &lt;!-- \u505c\u7528\u8bcd\u914d\u7f6e --&gt;\n        &lt;entry key=\"remote_ext_dict\"&gt;&lt;/entry&gt;    &lt;!-- \u8fdc\u7a0b\u8bcd\u5178 --&gt;\n&lt;/properties&gt;\n</code></pre> <p>3.\u5728IK\u5206\u8bcd\u5668\u7684config\u76ee\u5f55\u65b0\u5efa\u4e00\u4e2a <code>ext.dic</code>\uff0c\u53ef\u4ee5\u53c2\u8003config\u76ee\u5f55\u4e0b\u590d\u5236\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u4fee\u6539</p> <pre><code>\u4e00\u5764\u5e74\n\u6cf0\u88e4\u8fa3\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u57fa\u7840\u6982\u5ff5","title":"\u57fa\u7840\u6982\u5ff5","text":""},{"location":"SpringCloud/Elasticsearch/#\u6587\u6863\u548c\u5b57\u6bb5","title":"\u6587\u6863\u548c\u5b57\u6bb5","text":"<p>Elasticsearch\u662f\u9762\u5411\u6587\u6863\uff08Document\uff09\u5b58\u50a8\u7684\uff0c\u53ef\u4ee5\u662f\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u6761\u5546\u54c1\u6570\u636e\uff0c\u4e00\u4e2a\u8ba2\u5355\u4fe1\u606f\u3002</p> <p>\u6587\u6863\u6570\u636e\u4f1a\u88ab\u5e8f\u5217\u5316\u4e3a<code>json</code>\u683c\u5f0f\u540e\u5b58\u50a8\u5728<code>elasticsearch</code>\uff0c\u56e0\u6b64\uff0c\u539f\u672c\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u884c\u6570\u636e\u5c31\u662fES\u4e2d\u7684\u4e00\u4e2aJSON\u6587\u6863</p> <p>\u800c\u6570\u636e\u5e93\u4e2d\u6bcf\u884c\u6570\u636e\u90fd\u5305\u542b\u5f88\u591a\u5217\uff0c\u8fd9\u4e9b\u5217\u5c31\u8f6c\u6362\u4e3aJSON\u6587\u6863\u4e2d\u7684\u5b57\u6bb5\uff08Field\uff09\u3002</p> <pre><code>{\n    \"id\": 1,\n    \"title\": \"\u5c0f\u7c73\u624b\u673a\",\n    \"price\": 3499\n}\n{\n    \"id\": 2,\n    \"title\": \"\u534e\u4e3a\u624b\u673a\",\n    \"price\": 4999\n}\n{\n    \"id\": 3,\n    \"title\": \"\u534e\u4e3a\u5c0f\u7c73\u5145\u7535\u5668\",\n    \"price\": 49\n}\n...\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u7d22\u5f15\u548c\u6620\u5c04","title":"\u7d22\u5f15\u548c\u6620\u5c04","text":"<p>\u968f\u7740\u4e1a\u52a1\u53d1\u5c55\uff0c\u9700\u8981\u5728es\u4e2d\u5b58\u50a8\u7684\u6587\u6863\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u6bd4\u5982\u6709\u5546\u54c1\u7684\u6587\u6863\u3001\u7528\u6237\u7684\u6587\u6863\u3001\u8ba2\u5355\u6587\u6863\u7b49\u7b49\uff0c\u6240\u6709\u6587\u6863\u90fd\u6563\u4e71\u5b58\u653e\u663e\u7136\u975e\u5e38\u6df7\u4e71\uff0c\u4e5f\u4e0d\u65b9\u4fbf\u7ba1\u7406\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u5c06\u7c7b\u578b\u76f8\u540c\u7684\u6587\u6863\u96c6\u4e2d\u5728\u4e00\u8d77\u7ba1\u7406\uff0c\u79f0\u4e3a\u7d22\u5f15\uff08Index\uff09\uff08\u7d22\u5f15\u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u4e2d\u201c\u8868\u201d\u7684\u6982\u5ff5\uff09</p> <p>\u6570\u636e\u5e93\u7684\u8868\u4f1a\u6709\u7ea6\u675f\u4fe1\u606f\uff0c\u7528\u6765\u5b9a\u4e49\u8868\u7684\u7ed3\u6784\u3001\u5b57\u6bb5\u7684\u540d\u79f0\u3001\u7c7b\u578b\u7b49\u4fe1\u606f\u3002\u56e0\u6b64\uff0c\u7d22\u5f15\u5e93\u4e2d\u5c31\u6709\u6620\u5c04\uff08mapping\uff09\uff0c\u662f\u7d22\u5f15\u4e2d\u6587\u6863\u7684\u5b57\u6bb5\u7ea6\u675f\u4fe1\u606f\uff0c\u7c7b\u4f3c\u8868\u7684\u7ed3\u6784\u7ea6\u675f\u3002</p> <p>MySQL \u4e0e Elasticsearch</p> MySQL Elasticsearch \u8bf4\u660e Table Index \u7d22\u5f15(index)\uff0c\u5c31\u662f\u6587\u6863\u7684\u96c6\u5408\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\u7684\u8868(table) Row Document \u6587\u6863\uff08Document\uff09\uff0c\u5c31\u662f\u4e00\u6761\u6761\u7684\u6570\u636e\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\u4e2d\u7684\u884c\uff08Row\uff09\uff0c\u6587\u6863\u90fd\u662fJSON\u683c\u5f0f Column Field \u5b57\u6bb5\uff08Field\uff09\uff0c\u5c31\u662fJSON\u6587\u6863\u4e2d\u7684\u5b57\u6bb5\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\u4e2d\u7684\u5217\uff08Column\uff09 Schema Mapping Mapping\uff08\u6620\u5c04\uff09\u662f\u7d22\u5f15\u4e2d\u6587\u6863\u7684\u7ea6\u675f\uff0c\u4f8b\u5982\u5b57\u6bb5\u7c7b\u578b\u7ea6\u675f\u3002\u7c7b\u4f3c\u6570\u636e\u5e93\u7684\u8868\u7ed3\u6784\uff08Schema\uff09 SQL DSL DSL\u662felasticsearch\u63d0\u4f9b\u7684JSON\u98ce\u683c\u7684\u8bf7\u6c42\u8bed\u53e5\uff0c\u7528\u6765\u64cd\u4f5celasticsearch\uff0c\u5b9e\u73b0CRUD <p>\u5728\u4f01\u4e1a\u4e2d\uff0c\u5f80\u5f80\u662f\u4e24\u8005\u7ed3\u5408\u4f7f\u7528\uff1a</p> <ul> <li>\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u5199\u64cd\u4f5c\uff0c\u4f7f\u7528mysql\u5b9e\u73b0</li> <li>\u5bf9\u67e5\u8be2\u6027\u80fd\u8981\u6c42\u8f83\u9ad8\u7684\u641c\u7d22\u9700\u6c42\uff0c\u4f7f\u7528elasticsearch\u5b9e\u73b0</li> <li>\u4e24\u8005\u518d\u57fa\u4e8e\u67d0\u79cd\u65b9\u5f0f\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u540c\u6b65\uff0c\u4fdd\u8bc1\u4e00\u81f4\u6027</li> </ul> <p></p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u7d22\u5f15\u5e93\u64cd\u4f5c","title":"\u7d22\u5f15\u5e93\u64cd\u4f5c","text":""},{"location":"SpringCloud/Elasticsearch/#mapping\u6620\u5c04\u5c5e\u6027","title":"Mapping\u6620\u5c04\u5c5e\u6027","text":"<p>Mapping\u662f\u5bf9\u7d22\u5f15\u5e93\u4e2d\u6587\u6863\u7684\u7ea6\u675f\uff0c\u5e38\u89c1\u7684Mapping\u5c5e\u6027\u5305\u62ec\uff1a</p> <ul> <li><code>type</code>\uff1a\u5b57\u6bb5\u6570\u636e\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u7b80\u5355\u7c7b\u578b\u6709\uff1a <ul> <li>\u5b57\u7b26\u4e32\uff1a<code>text</code>\uff08\u53ef\u5206\u8bcd\u7684\u6587\u672c\uff09\u3001<code>keyword</code>\uff08\u7cbe\u786e\u503c\uff0c\u4e0d\u5e94\u5206\u8bcd\uff0c\u4f8b\u5982\uff1a\u54c1\u724c\u3001\u56fd\u5bb6\u3001ip\u5730\u5740\uff09</li> <li>\u6570\u503c\uff1a<code>long</code>\u3001<code>integer</code>\u3001<code>short</code>\u3001<code>byte</code>\u3001<code>double</code>\u3001<code>float</code>\u3001</li> <li>\u5e03\u5c14\uff1a<code>boolean</code></li> <li>\u65e5\u671f\uff1a<code>date</code></li> <li>\u5bf9\u8c61\uff1a<code>object</code></li> </ul> </li> <li><code>index</code>\uff1a\u662f\u5426\u521b\u5efa\u7d22\u5f15\uff08\u662f\u5426\u53c2\u4e0e\u641c\u7d22\uff09\uff0c\u9ed8\u8ba4\u4e3a<code>true</code></li> <li><code>analyzer</code>\uff1a\u4f7f\u7528\u54ea\u79cd\u5206\u8bcd\u5668</li> <li><code>properties</code>\uff1a\u8be5\u5b57\u6bb5\u7684\u5b50\u5b57\u6bb5</li> </ul> <p></p> <p>\u4f8b\u5982\u4e0b\u9762\u7684json\u6587\u6863\uff1a</p> <pre><code>{\n    \"age\": 21,\n    \"weight\": 52.1,\n    \"isMarried\": false,\n    \"info\": \"\u9ed1\u9a6c\u7a0b\u5e8f\u5458Java\u8bb2\u5e08\",\n    \"email\": \"zy@itcast.cn\",\n    \"score\": [99.1, 99.5, 98.9],\n    \"name\": {\n        \"firstName\": \"\u4e91\",\n        \"lastName\": \"\u8d75\"\n    }\n}\n</code></pre> <p>\u5bf9\u5e94\u7684\u6bcf\u4e2a\u5b57\u6bb5\u6620\u5c04\uff08Mapping\uff09\uff1a</p> \u5b57\u6bb5\u540d \u5b57\u6bb5\u7c7b\u578b \u7c7b\u578b\u8bf4\u660e \u662f\u5426\u53c2\u4e0e\u641c\u7d22 \u662f\u5426\u53c2\u4e0e\u5206\u8bcd \u5206\u8bcd\u5668 age <code>integer</code> \u6574\u6570 \u2714 \u274c \u2014\u2014 weight <code>float</code> \u6d6e\u70b9\u6570 \u2714 \u274c \u2014\u2014 isMarried <code>boolean</code> \u5e03\u5c14 \u2714 \u274c \u2014\u2014 info <code>text</code> \u5b57\u7b26\u4e32\uff0c\u4f46\u9700\u8981\u5206\u8bcd \u2714 \u2714 IK email <code>keyword</code> \u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u4e0d\u5206\u8bcd \u274c \u274c \u2014\u2014 score <code>float</code> \u53ea\u770b\u6570\u7ec4\u4e2d\u5143\u7d20\u7c7b\u578b \u2714 \u274c \u2014\u2014 name <code>keyword</code> \u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u4e0d\u5206\u8bcd \u2714 \u274c \u2014\u2014 <p></p>"},{"location":"SpringCloud/Elasticsearch/#crud","title":"CRUD","text":"<ul> <li>\u521b\u5efa\u7d22\u5f15\u5e93\u548cmapping</li> </ul> <pre><code>PUT /&lt;\u7d22\u5f15\u5e93\u540d\u79f0&gt;\n\n{\n  \"mappings\": {\n    \"properties\": {\n      \"&lt;\u5b57\u6bb5\u540d&gt;\":{\n        \"type\": \"text\",\n        \"analyzer\": \"ik_smart\"\n      },\n      \"&lt;\u5b57\u6bb5\u540d2&gt;\":{\n        \"type\": \"keyword\",\n        \"index\": \"false\"\n      },\n      \"&lt;\u5b57\u6bb5\u540d3&gt;\":{\n        \"properties\": {\n          \"&lt;\u5b50\u5b57\u6bb5&gt;\": {\n            \"type\": \"keyword\"\n          }\n        }\n      },\n      // ...\u7565\n    }\n  }\n}\n</code></pre> <ul> <li>\u67e5\u8be2\u7d22\u5f15\u5e93</li> </ul> <pre><code>GET /\u7d22\u5f15\u5e93\u540d\n</code></pre> <ul> <li>\u5220\u9664\u7d22\u5f15\u5e93</li> </ul> <pre><code>DELETE /\u7d22\u5f15\u5e93\u540d\n</code></pre> <ul> <li>\u4fee\u6539\u7d22\u5f15\u5e93</li> </ul> <p>\u5012\u6392\u7d22\u5f15\u7ed3\u6784\u867d\u7136\u4e0d\u590d\u6742\uff0c\u4f46\u662f\u4e00\u65e6\u6570\u636e\u7ed3\u6784\u6539\u53d8\uff08\u6bd4\u5982\u6539\u53d8\u4e86\u5206\u8bcd\u5668\uff09\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u521b\u5efa\u5012\u6392\u7d22\u5f15\uff0c\u8fd9\u7b80\u76f4\u662f\u707e\u96be\u3002\u56e0\u6b64\u7d22\u5f15\u5e93\u4e00\u65e6\u521b\u5efa\uff0c\u5c31\u65e0\u6cd5\u518d\u4fee\u6539mapping\u4e2d\u539f\u6709\u5b57\u6bb5\u7684\u5c5e\u6027\u3002</p> <p>\u867d\u7136\u65e0\u6cd5\u4fee\u6539mapping\u4e2d\u5df2\u6709\u7684\u5b57\u6bb5\uff0c\u4f46\u662f\u5374\u5141\u8bb8\u6dfb\u52a0\u65b0\u7684\u5b57\u6bb5\u5230mapping\u4e2d\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u5bf9\u5012\u6392\u7d22\u5f15\u4ea7\u751f\u5f71\u54cd\u3002\u56e0\u6b64\u4fee\u6539\u7d22\u5f15\u5e93\u80fd\u505a\u7684\u5c31\u662f\u5411\u7d22\u5f15\u5e93\u4e2d\u6dfb\u52a0\u65b0\u5b57\u6bb5\uff0c\u6216\u8005\u66f4\u65b0\u7d22\u5f15\u5e93\u7684\u57fa\u7840\u5c5e\u6027\u3002</p> <pre><code>PUT /\u7d22\u5f15\u5e93\u540d/_mapping\n{\n  \"properties\": {\n    \"&lt;\u65b0\u5b57\u6bb5\u540d&gt;\":{\n      \"type\": \"integer\"\n    }\n  }\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6587\u6863\u64cd\u4f5c","title":"\u6587\u6863\u64cd\u4f5c","text":""},{"location":"SpringCloud/Elasticsearch/#crud_1","title":"CRUD","text":"<ul> <li>\u65b0\u589e\u6587\u6863</li> </ul> <pre><code>POST /\u7d22\u5f15\u5e93\u540d/_doc/\u6587\u6863id\n\n{\n    \"\u5b57\u6bb51\": \"\u503c1\",\n    \"\u5b57\u6bb52\": \"\u503c2\",\n    \"\u5b57\u6bb53\": {\n        \"\u5b50\u5c5e\u60271\": \"\u503c3\",\n        \"\u5b50\u5c5e\u60272\": \"\u503c4\"\n    }\n}\n</code></pre> <p>eg.</p> <pre><code>POST /heima/_doc/1\n{\n    \"info\": \"Elasticsearch\u662f\u4e00\u4e2a\u57fa\u4e8eLucene\u7684\u641c\u7d22\u670d\u52a1\u5668\",\n    \"email\": \"example@example.com\",\n    \"name\": {\n        \"firstName\": \"\u4e91\",\n        \"lastName\": \"\u8d75\"\n    }\n}\n</code></pre> <ul> <li>\u67e5\u8be2\u6587\u6863</li> </ul> <pre><code>GET /\u7d22\u5f15\u5e93\u540d/_doc/\u6587\u6863id\n</code></pre> <ul> <li>\u5220\u9664\u6587\u6863</li> </ul> <pre><code>DELETE /\u7d22\u5f15\u5e93\u540d/_doc/\u6587\u6863id\n</code></pre> <ul> <li>\u4fee\u6539\u6587\u6863</li> </ul> <p>\u4fee\u6539\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <p>\u200b\u5168\u91cf\u4fee\u6539\uff1a\u76f4\u63a5\u8986\u76d6\u539f\u6765\u7684\u6587\u6863</p> <p>\u5c40\u90e8\u4fee\u6539\uff1a\u4fee\u6539\u6587\u6863\u4e2d\u7684\u90e8\u5206\u5b57\u6bb5</p> <p></p> <p>1.\u5168\u91cf\u4fee\u6539</p> <p>\u5168\u91cf\u4fee\u6539\u662f\u8986\u76d6\u539f\u6765\u7684\u6587\u6863\uff0c\u5176\u672c\u8d28\u662f\u4e24\u6b65\u64cd\u4f5c\uff1a</p> <ul> <li>\u6839\u636e\u6307\u5b9a\u7684id\u5220\u9664\u6587\u6863</li> <li>\u65b0\u589e\u4e00\u4e2a\u76f8\u540cid\u7684\u6587\u6863</li> </ul> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u6839\u636eid\u5220\u9664\u65f6\uff0cid\u4e0d\u5b58\u5728\uff0c\u7b2c\u4e8c\u6b65\u7684\u65b0\u589e\u4e5f\u4f1a\u6267\u884c\uff0c\u4f46\u64cd\u4f5c\u4ece\u4fee\u6539\u53d8\u6210\u4e86\u65b0\u589e\u3002</p> <pre><code>PUT /{\u7d22\u5f15\u5e93\u540d}/_doc/\u6587\u6863id\n\n{\n    \"\u5b57\u6bb51\": \"\u503c1\",\n    \"\u5b57\u6bb52\": \"\u503c2\",\n    // ... \u7565\n}\n</code></pre> <p>2.\u5c40\u90e8\u4fee\u6539</p> <p>\u5c40\u90e8\u4fee\u6539\u662f\u53ea\u4fee\u6539\u6307\u5b9aid\u5339\u914d\u7684\u6587\u6863\u4e2d\u7684\u90e8\u5206\u5b57\u6bb5\u3002</p> <pre><code>POST /{\u7d22\u5f15\u5e93\u540d}/_update/\u6587\u6863id\n\n{\n    \"doc\": {\n         \"\u5b57\u6bb5\u540d\": \"\u65b0\u7684\u503c\",\n    }\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6279\u5904\u7406","title":"\u6279\u5904\u7406","text":"<p>\u6279\u5904\u7406\u91c7\u7528POST\u8bf7\u6c42\uff0c\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>POST _bulk\n\n{ \"index\" : { \"_index\" : \"test\", \"_id\" : \"1\" } }\n{ \"field1\" : \"value1\" }\n{ \"delete\" : { \"_index\" : \"test\", \"_id\" : \"2\" } }\n{ \"create\" : { \"_index\" : \"test\", \"_id\" : \"3\" } }\n{ \"field1\" : \"value3\" }\n{ \"update\" : {\"_id\" : \"1\", \"_index\" : \"test\"} }\n{ \"doc\" : {\"field2\" : \"value2\"} }\n</code></pre> <ul> <li><code>index</code>\u4ee3\u8868\u65b0\u589e\u64cd\u4f5c<ul> <li><code>_index</code>\uff1a\u6307\u5b9a\u7d22\u5f15\u5e93\u540d</li> <li><code>_id</code>\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u6587\u6863id</li> <li><code>{ \"field1\" : \"value1\" }</code>\uff1a\u5219\u662f\u8981\u65b0\u589e\u7684\u6587\u6863\u5185\u5bb9</li> </ul> </li> <li><code>delete</code>\u4ee3\u8868\u5220\u9664\u64cd\u4f5c<ul> <li><code>_index</code>\uff1a\u6307\u5b9a\u7d22\u5f15\u5e93\u540d</li> <li><code>_id</code>\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u6587\u6863id</li> </ul> </li> <li><code>update</code>\u4ee3\u8868\u66f4\u65b0\u64cd\u4f5c<ul> <li><code>_index</code>\uff1a\u6307\u5b9a\u7d22\u5f15\u5e93\u540d</li> <li><code>_id</code>\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u6587\u6863id</li> <li><code>{ \"doc\" : {\"field2\" : \"value2\"} }</code>\uff1a\u8981\u66f4\u65b0\u7684\u6587\u6863\u5b57\u6bb5</li> </ul> </li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#javarestclient","title":"JavaRestClient","text":""},{"location":"SpringCloud/Elasticsearch/#restapi","title":"RestAPI","text":"<p>ES\u5b98\u65b9\u63d0\u4f9b\u4e86\u5404\u79cd\u4e0d\u540c\u8bed\u8a00\u7684\u5ba2\u6237\u7aef\uff0c\u7528\u6765\u64cd\u4f5cES\u3002\u8fd9\u4e9b\u5ba2\u6237\u7aef\u7684\u672c\u8d28\u5c31\u662f\u7ec4\u88c5DSL\u8bed\u53e5\uff0c\u901a\u8fc7http\u8bf7\u6c42\u53d1\u9001\u7ed9ES\u3002</p> <p>\u5b98\u65b9\u6587\u6863\u5730\u5740</p> <p>\u7531\u4e8eES\u76ee\u524d\u63d0\u4f9b\u4e86\u5168\u65b0\u7248\u672c\u7684\u5ba2\u6237\u7aef\uff0c\u8001\u7248\u672c\u7684\u5ba2\u6237\u7aef\u5df2\u7ecf\u88ab\u6807\u8bb0\u4e3a\u8fc7\u65f6\u3002\u6b64\u5904\u91c7\u7528\u8001\u7248\u672c\u5ba2\u6237\u7aef\u4f5c\u4e3a\u793a\u4f8bimage-20250220170629116</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u521d\u59cb\u5316restclient","title":"\u521d\u59cb\u5316RestClient","text":"<p>\u5728elasticsearch\u63d0\u4f9b\u7684API\u4e2d\uff0c\u4e0eelasticsearch\u4e00\u5207\u4ea4\u4e92\u90fd\u5c01\u88c5\u5728\u4e00\u4e2a\u540d\u4e3a<code>RestHighLevelClient</code>\u7684\u7c7b\u4e2d\uff0c\u5fc5\u987b\u5148\u5b8c\u6210\u8fd9\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\uff0c\u5efa\u7acb\u4e0eelasticsearch\u7684\u8fde\u63a5\u3002</p> <ol> <li> <p>\u5f15\u5165<code>es</code>\u7684<code>RestHighLevelClient</code>\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;\n    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u56e0\u4e3aSpringBoot\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684ES\u7248\u672c\uff0c\u6211\u4eec\u9700\u8981\u8986\u76d6\u9ed8\u8ba4\u7684ES\u7248\u672c\uff1a</p> <pre><code>&lt;properties&gt;\n    &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;\n    &lt;elasticsearch.version&gt;7.12.1&lt;/elasticsearch.version&gt;\n&lt;/properties&gt;\n</code></pre> </li> <li> <p>\u521d\u59cb\u5316RestHighLevelClient\uff1a</p> <pre><code>RestHighLevelClient client = new RestHighLevelClient(RestClient.builder(\n        HttpHost.create(\"Localhost:9200\")\n));\n</code></pre> </li> </ol> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u7d22\u5f15\u5e93\u64cd\u4f5c_1","title":"\u7d22\u5f15\u5e93\u64cd\u4f5c","text":"<ul> <li> <p>\u521b\u5efa\u7d22\u5f15\u5e93 <pre><code>void testCreateIndex() throws IOException {\n    CreateIndexRequest request = new CreateIndexRequest(\"items\");\n    // MAPPING_TEMPLATE\u662f\u4e00\u4e2ajson\u5b57\u7b26\u4e32\uff0c\u5b9a\u4e49\u4e86\u7d22\u5f15\u5e93\u7684\u6620\u5c04\n    request.source(MAPPING_TEMPLATE, XContentType.JSON);\n    client.indices().create(request, RequestOptions.DEFAULT);\n}\n</code></pre></p> </li> <li> <p>\u5220\u9664\u7d22\u5f15\u5e93</p> </li> </ul> <pre><code>@Test\nvoid testDeleteIndex() throws IOException {\n    // 1.\u521b\u5efaRequest\u5bf9\u8c61\n    DeleteIndexRequest request = new DeleteIndexRequest(\"items\");\n    // 2.\u53d1\u9001\u8bf7\u6c42\n    client.indices().delete(request, RequestOptions.DEFAULT);\n}\n</code></pre> <ul> <li>\u67e5\u8be2\u7d22\u5f15\u5e93</li> </ul> <pre><code>@Test\nvoid testGetIndex() throws IOException {\n    GetIndexRequest request = new GetIndexRequest(\"items\");\n    boolean exists = client.indices().exists(request, RequestOptions.DEFAULT);\n    System.out.println(\"exists = \" + exists);\n}\n</code></pre> <p>JavaRestClient\u64cd\u4f5celasticsearch\u7684\u6d41\u7a0b\u57fa\u672c\u7c7b\u4f3c\u3002\u6838\u5fc3\u662f<code>client.indices()</code>\u65b9\u6cd5\u6765\u83b7\u53d6\u7d22\u5f15\u5e93\u7684\u64cd\u4f5c\u5bf9\u8c61\u3002</p> <p>\u7d22\u5f15\u5e93\u64cd\u4f5c\u7684\u57fa\u672c\u6b65\u9aa4\uff1a</p> <ul> <li>\u521d\u59cb\u5316<code>RestHighLevelClient</code></li> <li>\u521b\u5efaXxxIndexRequest\u3002XXX\u662f<code>Create</code>\u3001<code>Get</code>\u3001<code>Delete</code></li> <li>\u51c6\u5907\u8bf7\u6c42\u53c2\u6570\uff08 <code>Create</code>\u65f6\u9700\u8981\uff0c\u5176\u5b83\u662f\u65e0\u53c2\uff0c\u53ef\u4ee5\u7701\u7565\uff09</li> <li>\u53d1\u9001\u8bf7\u6c42\u3002\u8c03\u7528<code>RestHighLevelClient#indices().xxx()</code>\u65b9\u6cd5\uff0cxxx\u662f<code>create</code>\u3001<code>exists</code>\u3001<code>delete</code></li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6587\u6863\u64cd\u4f5c_1","title":"\u6587\u6863\u64cd\u4f5c","text":"<ul> <li>\u65b0\u589e\u6587\u6863</li> </ul> <pre><code>@Test\nvoid testAddDocument() throws IOException {\n    // 1.\u6839\u636eid\u67e5\u8be2\u5546\u54c1\u6570\u636e\n    Item item = itemService.getById(100002644680L);\n    // 2.\u8f6c\u6362\u4e3a\u6587\u6863\u7c7b\u578b\n    ItemDoc itemDoc = BeanUtil.copyProperties(item, ItemDoc.class);\n    // 3.\u5c06ItemDTO\u8f6cjson\n    String doc = JSONUtil.toJsonStr(itemDoc);\n\n    // 1.\u51c6\u5907Request\u5bf9\u8c61\n    IndexRequest request = new IndexRequest(\"items\").id(itemDoc.getId());\n    // 2.\u51c6\u5907Json\u6587\u6863\n    request.source(doc, XContentType.JSON);\n    // 3.\u53d1\u9001\u8bf7\u6c42\n    client.index(request, RequestOptions.DEFAULT);\n}\n</code></pre> <ul> <li>\u5220\u9664\u6587\u6863</li> </ul> <pre><code>@Test\nvoid testDeleteDocument() throws IOException {\n    // 1.\u51c6\u5907Request\uff0c\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u7d22\u5f15\u5e93\u540d\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6587\u6863id\n    DeleteRequest request = new DeleteRequest(\"item\", \"100002644680\");\n    // 2.\u53d1\u9001\u8bf7\u6c42\n    client.delete(request, RequestOptions.DEFAULT);\n}\n</code></pre> <ul> <li>\u67e5\u8be2\u6587\u6863</li> </ul> <pre><code>@Test\nvoid testGetDocumentById() throws IOException {\n    // 1.\u51c6\u5907Request\u5bf9\u8c61\n    GetRequest request = new GetRequest(\"items\").id(\"100002644680\");\n    // 2.\u53d1\u9001\u8bf7\u6c42\n    GetResponse response = client.get(request, RequestOptions.DEFAULT);\n    // 3.\u83b7\u53d6\u54cd\u5e94\u7ed3\u679c\u4e2d\u7684source \n    String json = response.getSourceAsString();\n\n    ItemDoc itemDoc = JSONUtil.toBean(json, ItemDoc.class);\n    System.out.println(\"itemDoc= \" + ItemDoc);\n}\n</code></pre> <ul> <li>\u66f4\u65b0\u6587\u6863</li> </ul> <p>\u5728RestClient\u7684API\u4e2d\uff0c\u5168\u91cf\u4fee\u6539\u4e0e\u65b0\u589e\u7684API\u5b8c\u5168\u4e00\u81f4\uff0c\u5224\u65ad\u4f9d\u636e\u662fID\uff1a</p> <p>\u200b   \u5982\u679c\u65b0\u589e\u65f6\uff0cID\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u4fee\u6539</p> <p>\u200b   \u5982\u679c\u65b0\u589e\u65f6\uff0cID\u4e0d\u5b58\u5728\uff0c\u5219\u65b0\u589e</p> <p>\u5c40\u90e8\u66f4\u65b0</p> <p></p> <ul> <li>\u6279\u91cf\u64cd\u4f5c</li> </ul> <p>\u6279\u5904\u7406\u4e0e\u524d\u9762\u8bb2\u7684\u6587\u6863\u7684CRUD\u6b65\u9aa4\u57fa\u672c\u4e00\u81f4\uff1a</p> <ul> <li>\u521b\u5efaRequest\uff0c\u4f46\u8fd9\u6b21\u7528\u7684\u662f<code>BulkRequest</code></li> <li>\u51c6\u5907\u8bf7\u6c42\u53c2\u6570</li> <li>\u53d1\u9001\u8bf7\u6c42\uff0c\u8fd9\u6b21\u8981\u7528\u5230<code>client.bulk()</code>\u65b9\u6cd5</li> </ul> <p><code>BulkRequest</code>\u672c\u8eab\u5176\u5b9e\u5e76\u6ca1\u6709\u8bf7\u6c42\u53c2\u6570\uff0c\u5176\u672c\u8d28\u5c31\u662f\u5c06\u591a\u4e2a\u666e\u901a\u7684CRUD\u8bf7\u6c42\u7ec4\u5408\u5728\u4e00\u8d77\u53d1\u9001\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u6279\u91cf\u65b0\u589e\u6587\u6863\uff0c\u5c31\u662f\u7ed9\u6bcf\u4e2a\u6587\u6863\u521b\u5efa\u4e00\u4e2a<code>IndexRequest</code>\u8bf7\u6c42\uff0c\u7136\u540e\u5c01\u88c5\u5230<code>BulkRequest</code>\u4e2d\uff0c\u4e00\u8d77\u53d1\u51fa\u3002</li> <li>\u6279\u91cf\u5220\u9664\uff0c\u5c31\u662f\u521b\u5efaN\u4e2a<code>DeleteRequest</code>\u8bf7\u6c42\uff0c\u7136\u540e\u5c01\u88c5\u5230<code>BulkRequest</code>\uff0c\u4e00\u8d77\u53d1\u51fa</li> </ul> <pre><code>@Test\nvoid testBulk() throws IOException {\n    // 1.\u521b\u5efaRequest\n    BulkRequest request = new BulkRequest();\n    // 2.\u51c6\u5907\u8bf7\u6c42\u53c2\u6570\n    request.add(new IndexRequest(\"items\").id(\"1\").source(\"json doc1\", XContentType.JSON));\n    request.add(new IndexRequest(\"items\").id(\"2\").source(\"json doc2\", XContentType.JSON));\n    // 3.\u53d1\u9001\u8bf7\u6c42\n    client.bulk(request, RequestOptions.DEFAULT);\n}\n</code></pre> <p>\u4e1a\u52a1\u793a\u4f8b\uff1a\u5c06\u6570\u636e\u5e93\u8bb0\u5f55\u6279\u91cf\u5bfc\u5165ES</p> <pre><code>    @Test\n    void testBulkDoc() throws IOException {\n        int pageNum = 1;\n        int pageSize = 500;\n        while (true) {\n            Page&lt;Item&gt; page = itemService.lambdaQuery()\n                    .eq(Item::getStatus, 1)\n                    .page(Page.of(pageNum, pageSize));\n            List&lt;Item&gt; records = page.getRecords();\n            if (records == null || records.isEmpty()) {\n                return;\n            }\n            BulkRequest request = new BulkRequest();\n            for (Item item : records) {\n                request.add(new IndexRequest(\"items\")\n                        .id(item.getId().toString())\n                        .source(JSONUtil.toJsonStr(BeanUtil.copyProperties(item, ItemDoc.class)), XContentType.JSON));\n            }\n            client.bulk(request, RequestOptions.DEFAULT);\n            pageNum++;\n        }\n    }\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#dsl\u67e5\u8be2","title":"DSL\u67e5\u8be2","text":"<p>Elasticsearch\u63d0\u4f9b\u4e86\u57fa\u4e8eJSON\u7684DSL\uff08Domain Specific Language\uff09\u8bed\u53e5\u6765\u5b9a\u4e49\u67e5\u8be2\u6761\u4ef6\uff0c\u5176JavaAPI\u5c31\u662f\u5728\u7ec4\u7ec7DSL\u6761\u4ef6\u3002</p> <p>Elasticsearch\u7684\u67e5\u8be2\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>\u53f6\u5b50\u67e5\u8be2\uff08Leaf query clauses\uff09\uff1a\u4e00\u822c\u662f\u5728\u7279\u5b9a\u7684\u5b57\u6bb5\u91cc\u67e5\u8be2\u7279\u5b9a\u503c\uff0c\u5c5e\u4e8e\u7b80\u5355\u67e5\u8be2\uff0c\u5f88\u5c11\u5355\u72ec\u4f7f\u7528\u3002</li> <li>\u590d\u5408\u67e5\u8be2\uff08Compound query clauses\uff09\uff1a\u4ee5\u903b\u8f91\u65b9\u5f0f\u7ec4\u5408\u591a\u4e2a\u53f6\u5b50\u67e5\u8be2\u6216\u8005\u66f4\u6539\u53f6\u5b50\u67e5\u8be2\u7684\u884c\u4e3a\u65b9\u5f0f\u3002</li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5165\u95e8","title":"\u5165\u95e8","text":"<p>\u8bed\u6cd5\u7ed3\u6784</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n\n{\n  \"query\": {\n    \"\u67e5\u8be2\u7c7b\u578b\": {\n      // .. \u67e5\u8be2\u6761\u4ef6\n    }\n  }\n}\n</code></pre> <p>eg\u67e5\u8be2\u6240\u6709</p> <pre><code>GET /items/_search\n{\n  \"query\": {\n    \"match_all\": {\n\n    }\n  }\n}\n</code></pre> <p>Tip</p> <p>\u867d\u7136\u662fmatch_all\uff0c\u4f46\u662f\u54cd\u5e94\u7ed3\u679c\u4e2d\u5e76\u4e0d\u4f1a\u5305\u542b\u7d22\u5f15\u5e93\u4e2d\u7684\u6240\u6709\u6587\u6863\uff0c\u800c\u662f\u4ec5\u670910\u6761\u3002 \u8fd9\u662f\u56e0\u4e3a\u5904\u4e8e\u5b89\u5168\u8003\u8651\uff0celasticsearch\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u7684\u67e5\u8be2\u9875\u6570\u3002</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u53f6\u5b50\u67e5\u8be2","title":"\u53f6\u5b50\u67e5\u8be2","text":"<p>\u53f6\u5b50\u67e5\u8be2\u7684\u7c7b\u578b\u4e5f\u53ef\u4ee5\u505a\u8fdb\u4e00\u6b65\u7ec6\u5206\uff0c\u8be6\u60c5\u53ef\u4ee5\u67e5\u770b\u5b98\u65b9\u6587\u6863</p> <p>\u4f8b\u5982\uff1a</p> <ul> <li>\u5168\u6587\u68c0\u7d22\u67e5\u8be2\uff08Full Text Queries\uff09\uff1a\u5229\u7528\u5206\u8bcd\u5668\u5bf9\u7528\u6237\u8f93\u5165\u641c\u7d22\u6761\u4ef6\u5148\u5206\u8bcd\uff0c\u5f97\u5230\u8bcd\u6761\uff0c\u7136\u540e\u518d\u5229\u7528\u5012\u6392\u7d22\u5f15\u641c\u7d22\u8bcd\u6761\u3002\u4f8b\u5982\uff1a<ul> <li><code>match</code>\uff1a</li> <li><code>multi_match</code></li> </ul> </li> <li>\u7cbe\u786e\u67e5\u8be2\uff08Term-level queries\uff09\uff1a\u4e0d\u5bf9\u7528\u6237\u8f93\u5165\u641c\u7d22\u6761\u4ef6\u5206\u8bcd\uff0c\u6839\u636e\u5b57\u6bb5\u5185\u5bb9\u7cbe\u786e\u503c\u5339\u914d\u3002\u4f46\u53ea\u80fd\u67e5\u627ekeyword\u3001\u6570\u503c\u3001\u65e5\u671f\u3001boolean\u7c7b\u578b\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff1a<ul> <li><code>ids</code></li> <li><code>term</code></li> <li><code>range</code></li> </ul> </li> <li>\u5730\u7406\u5750\u6807\u67e5\u8be2\uff1a\u7528\u4e8e\u641c\u7d22\u5730\u7406\u4f4d\u7f6e\uff0c\u641c\u7d22\u65b9\u5f0f\u5f88\u591a\uff0c\u4f8b\u5982\uff1a<ul> <li><code>geo_bounding_box</code>\uff1a\u6309\u77e9\u5f62\u641c\u7d22</li> <li><code>geo_distance</code>\uff1a\u6309\u70b9\u548c\u534a\u5f84\u641c\u7d22</li> </ul> </li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5168\u6587\u68c0\u7d22\u67e5\u8be2","title":"\u5168\u6587\u68c0\u7d22\u67e5\u8be2","text":"<p>\u5168\u6587\u68c0\u7d22\u7684\u79cd\u7c7b\u4e5f\u5f88\u591a\uff0c\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863</p> <p>\u4ee5\u5168\u6587\u68c0\u7d22\u4e2d\u7684<code>match</code>\u4e3a\u4f8b\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n{\n  \"query\": {\n    \"match\": {\n      \"\u5b57\u6bb5\u540d\": \"\u641c\u7d22\u6761\u4ef6\"\n    }\n  }\n}\n</code></pre> <p></p> <p><code>match</code>\u7c7b\u4f3c\u7684\u8fd8\u6709<code>multi_match</code>\uff0c\u533a\u522b\u5728\u4e8e\u53ef\u4ee5\u540c\u65f6\u5bf9\u591a\u4e2a\u5b57\u6bb5\u641c\u7d22\uff0c\u800c\u4e14\u591a\u4e2a\u5b57\u6bb5\u90fd\u8981\u6ee1\u8db3\uff0c\u8bed\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n{\n  \"query\": {\n    \"multi_match\": {\n      \"query\": \"\u641c\u7d22\u6761\u4ef6\",\n      \"fields\": [\"\u5b57\u6bb51\", \"\u5b57\u6bb52\"]\n    }\n  }\n}\n</code></pre> <p></p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u7cbe\u786e\u67e5\u8be2","title":"\u7cbe\u786e\u67e5\u8be2","text":"<p>\u7cbe\u786e\u67e5\u8be2\uff0c\u82f1\u6587\u662f<code>Term-level query</code>\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8bcd\u6761\u7ea7\u522b\u7684\u67e5\u8be2\u3002\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u5bf9\u7528\u6237\u8f93\u5165\u7684\u641c\u7d22\u6761\u4ef6\u518d\u5206\u8bcd\uff0c\u800c\u662f\u4f5c\u4e3a\u4e00\u4e2a\u8bcd\u6761\uff0c\u4e0e\u641c\u7d22\u7684\u5b57\u6bb5\u5185\u5bb9\u7cbe\u786e\u503c\u5339\u914d\u3002\u56e0\u6b64\u63a8\u8350\u67e5\u627e<code>keyword</code>\u3001\u6570\u503c\u3001\u65e5\u671f\u3001<code>boolean</code>\u7c7b\u578b\u7684\u5b57\u6bb5\u3002</p> <p>\u4ee5<code>term</code>\u67e5\u8be2\u4e3a\u4f8b\uff0c\u5176\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n{\n  \"query\": {\n    \"term\": {\n      \"\u5b57\u6bb5\u540d\": {\n        \"value\": \"\u641c\u7d22\u6761\u4ef6\"\n      }\n    }\n  }\n}\n</code></pre> <p><code>range</code>\u67e5\u8be2\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n{\n  \"query\": {\n    \"range\": {\n      \"\u5b57\u6bb5\u540d\": {\n        \"gte\": {\u6700\u5c0f\u503c},\n        \"lte\": {\u6700\u5927\u503c}\n      }\n    }\n  }\n}\n</code></pre> <p><code>range</code>\u662f\u8303\u56f4\u67e5\u8be2\uff0c\u5bf9\u4e8e\u8303\u56f4\u7b5b\u9009\u7684\u5173\u952e\u5b57\u6709\uff1a</p> <ul> <li><code>gte</code>\uff1a\u5927\u4e8e\u7b49\u4e8e</li> <li><code>gt</code>\uff1a\u5927\u4e8e</li> <li><code>lte</code>\uff1a\u5c0f\u4e8e\u7b49\u4e8e</li> <li><code>lt</code>\uff1a\u5c0f\u4e8e</li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u590d\u5408\u67e5\u8be2","title":"\u590d\u5408\u67e5\u8be2","text":"<p>\u590d\u5408\u67e5\u8be2\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a</p> <ul> <li>\u7b2c\u4e00\u7c7b\uff1a\u57fa\u4e8e\u903b\u8f91\u8fd0\u7b97\u7ec4\u5408\u53f6\u5b50\u67e5\u8be2\uff0c\u5b9e\u73b0\u7ec4\u5408\u6761\u4ef6\uff0c\u4f8b\u5982<ul> <li>bool</li> </ul> </li> <li>\u7b2c\u4e8c\u7c7b\uff1a\u57fa\u4e8e\u67d0\u79cd\u7b97\u6cd5\u4fee\u6539\u67e5\u8be2\u65f6\u7684\u6587\u6863\u76f8\u5173\u6027\u7b97\u5206\uff0c\u4ece\u800c\u6539\u53d8\u6587\u6863\u6392\u540d\u3002\u4f8b\u5982\uff1a<ul> <li>function_score</li> <li>dis_max</li> </ul> </li> </ul> <p>\u5176\u5b83\u590d\u5408\u67e5\u8be2\u53ca\u76f8\u5173\u8bed\u6cd5\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#bool\u67e5\u8be2","title":"bool\u67e5\u8be2","text":"<p>bool\u67e5\u8be2\uff0c\u5373\u5e03\u5c14\u67e5\u8be2\u3002\u5c31\u662f\u5229\u7528\u903b\u8f91\u8fd0\u7b97\u6765\u7ec4\u5408\u4e00\u4e2a\u6216\u591a\u4e2a\u67e5\u8be2\u5b50\u53e5\u7684\u7ec4\u5408\u3002</p> <p>bool\u67e5\u8be2\u652f\u6301\u7684\u903b\u8f91\u8fd0\u7b97\u6709\uff1a</p> <ul> <li>must\uff1a\u5fc5\u987b\u5339\u914d\u6bcf\u4e2a\u5b50\u67e5\u8be2\uff0c\u7c7b\u4f3c\u201c\u4e0e\u201d</li> <li>should\uff1a\u9009\u62e9\u6027\u5339\u914d\u5b50\u67e5\u8be2\uff0c\u7c7b\u4f3c\u201c\u6216\u201d</li> <li>must_not\uff1a\u5fc5\u987b\u4e0d\u5339\u914d\uff0c\u4e0d\u53c2\u4e0e\u7b97\u5206\uff0c\u7c7b\u4f3c\u201c\u975e\u201d</li> <li>filter\uff1a\u5fc5\u987b\u5339\u914d\uff0c\u4e0d\u53c2\u4e0e\u7b97\u5206</li> </ul> <p>\u51fa\u4e8e\u6027\u80fd\u8003\u8651\uff0c\u4e0e\u641c\u7d22\u5173\u952e\u5b57\u65e0\u5173\u7684\u67e5\u8be2\u5c3d\u91cf\u91c7\u7528must_not\u6216filter\u903b\u8f91\u8fd0\u7b97\uff0c\u907f\u514d\u53c2\u4e0e\u76f8\u5173\u6027\u7b97\u5206\u3002</p> <p>\u4f8b\u5982\u641c\u7d22\u9875\u9762\uff1a</p> <p></p> <p>\u5176\u4e2d\u8f93\u5165\u6846\u7684\u641c\u7d22\u6761\u4ef6\u80af\u5b9a\u8981\u53c2\u4e0e\u76f8\u5173\u6027\u7b97\u5206\uff0c\u53ef\u4ee5\u91c7\u7528match\u3002\u4f46\u662f\u4ef7\u683c\u8303\u56f4\u8fc7\u6ee4\u3001\u54c1\u724c\u8fc7\u6ee4\u3001\u5206\u7c7b\u8fc7\u6ee4\u7b49\u5c3d\u91cf\u91c7\u7528filter\uff0c\u4e0d\u8981\u53c2\u4e0e\u76f8\u5173\u6027\u7b97\u5206\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u4eec\u8981\u641c\u7d22<code>\u624b\u673a</code>\uff0c\u4f46\u54c1\u724c\u5fc5\u987b\u662f<code>\u534e\u4e3a</code>\uff0c\u4ef7\u683c\u5fc5\u987b\u662f<code>900~1599</code>\uff0c\u90a3\u4e48\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>GET /items/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\"match\": {\"name\": \"\u624b\u673a\"}}\n      ],\n      \"filter\": [\n        {\"term\": {\"brand\": { \"value\": \"\u534e\u4e3a\" }}},\n        {\"range\": {\"price\": {\"gte\": 90000, \"lt\": 159900}}}\n      ]\n    }\n  }\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6392\u5e8f\u548c\u5206\u9875","title":"\u6392\u5e8f\u548c\u5206\u9875","text":""},{"location":"SpringCloud/Elasticsearch/#\u6392\u5e8f","title":"\u6392\u5e8f","text":"<p>elasticsearch\u9ed8\u8ba4\u662f\u6839\u636e\u76f8\u5173\u5ea6\u7b97\u5206\uff08<code>_score</code>\uff09\u6765\u6392\u5e8f\uff0c\u4f46\u662f\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u65b9\u5f0f\u5bf9\u641c\u7d22\u7ed3\u679c\u6392\u5e8f\u3002\u4e0d\u8fc7\u5206\u8bcd\u5b57\u6bb5\u65e0\u6cd5\u6392\u5e8f\uff0c\u80fd\u53c2\u4e0e\u6392\u5e8f\u5b57\u6bb5\u7c7b\u578b\u6709\uff1a<code>keyword</code>\u7c7b\u578b\u3001\u6570\u503c\u7c7b\u578b\u3001\u5730\u7406\u5750\u6807\u7c7b\u578b\u3001\u65e5\u671f\u7c7b\u578b\u7b49\u3002</p> <pre><code>GET /indexName/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"sort\": [\n    {\n      \"\u6392\u5e8f\u5b57\u6bb5\": {\n        \"order\": \"\u6392\u5e8f\u65b9\u5f0fasc\u548cdesc\"\n      }\n    }\n  ]\n}\n</code></pre> <p>\u793a\u4f8b\uff0c\u6211\u4eec\u6309\u7167\u5546\u54c1\u4ef7\u683c\u6392\u5e8f\uff1a</p> <pre><code>GET /items/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"sort\": [\n    {\n      \"price\": {\n        \"order\": \"desc\"\n      }\n    }\n  ]\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5206\u9875","title":"\u5206\u9875","text":"<p>lasticsearch\u4e2d\u901a\u8fc7\u4fee\u6539<code>from</code>\u3001<code>size</code>\u53c2\u6570\u6765\u63a7\u5236\u8981\u8fd4\u56de\u7684\u5206\u9875\u7ed3\u679c\uff1a</p> <ul> <li><code>from</code>\uff1a\u4ece\u7b2c\u51e0\u4e2a\u6587\u6863\u5f00\u59cb</li> <li><code>size</code>\uff1a\u603b\u5171\u67e5\u8be2\u51e0\u4e2a\u6587\u6863</li> </ul> <p>\u7c7b\u4f3c\u4e8emysql\u4e2d\u7684<code>limit ?, ?</code></p> <pre><code>GET /items/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"from\": 0, // \u5206\u9875\u5f00\u59cb\u7684\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a0\n  \"size\": 10,  // \u6bcf\u9875\u6587\u6863\u6570\u91cf\uff0c\u9ed8\u8ba410\n  \"sort\": [\n    {\n      \"price\": {\n        \"order\": \"desc\"\n      }\n    }\n  ]\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6df1\u5ea6\u5206\u9875","title":"\u6df1\u5ea6\u5206\u9875","text":"<p>elasticsearch\u7684\u6570\u636e\u4e00\u822c\u4f1a\u91c7\u7528\u5206\u7247\u5b58\u50a8\uff0c\u4e5f\u5c31\u662f\u628a\u4e00\u4e2a\u7d22\u5f15\u4e2d\u7684\u6570\u636e\u5206\u6210N\u4efd\uff0c\u5b58\u50a8\u5230\u4e0d\u540c\u8282\u70b9\u4e0a\u3002\u8fd9\u79cd\u5b58\u50a8\u65b9\u5f0f\u6bd4\u8f83\u6709\u5229\u4e8e\u6570\u636e\u6269\u5c55\uff0c\u4f46\u7ed9\u5206\u9875\u5e26\u6765\u4e86\u4e00\u4e9b\u9ebb\u70e6\u3002 </p> <p>\u6bd4\u5982\u4e00\u4e2a\u7d22\u5f15\u5e93\u4e2d\u6709100000\u6761\u6570\u636e\uff0c\u5206\u522b\u5b58\u50a8\u52304\u4e2a\u5206\u7247\uff0c\u6bcf\u4e2a\u5206\u724725000\u6761\u6570\u636e\u3002\u73b0\u5728\u6bcf\u9875\u67e5\u8be210\u6761\uff0c\u67e5\u8be2\u7b2c99\u9875\u3002\u90a3\u4e48\u5206\u9875\u67e5\u8be2\u7684\u6761\u4ef6\u5982\u4e0b\uff1a</p> <pre><code>GET /items/_search\n{\n  \"from\": 990, // \u4ece\u7b2c990\u6761\u5f00\u59cb\u67e5\u8be2\n  \"size\": 10, // \u6bcf\u9875\u67e5\u8be210\u6761\n  \"sort\": [\n    {\n      \"price\": \"asc\"\n    }\n  ]\n}\n</code></pre> <p>\u4ece\u8bed\u53e5\u6765\u5206\u6790\uff0c\u8981\u67e5\u8be2\u7b2c990~1000\u540d\u7684\u6570\u636e\u3002</p> <p>\u4ece\u5b9e\u73b0\u601d\u8def\u6765\u5206\u6790\uff0c\u80af\u5b9a\u662f\u5c06\u6240\u6709\u6570\u636e\u6392\u5e8f\uff0c\u627e\u51fa\u524d1000\u540d\uff0c\u622a\u53d6\u5176\u4e2d\u7684990~1000\u7684\u90e8\u5206\u3002\u4f46\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u5982\u4f55\u624d\u80fd\u627e\u5230\u6240\u6709\u6570\u636e\u4e2d\u7684\u524d1000\u540d\u5462\uff1f</p> <p>\u8981\u77e5\u9053\u6bcf\u4e00\u7247\u7684\u6570\u636e\u90fd\u4e0d\u4e00\u6837\uff0c\u7b2c1\u7247\u4e0a\u7684\u7b2c900~1000\uff0c\u5728\u53e61\u4e2a\u8282\u70b9\u4e0a\u5e76\u4e0d\u4e00\u5b9a\u4f9d\u7136\u662f900~1000\u540d\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u5728\u6bcf\u4e00\u4e2a\u5206\u7247\u4e0a\u90fd\u627e\u51fa\u6392\u540d\u524d1000\u7684\u6570\u636e\uff0c\u7136\u540e\u6c47\u603b\u5230\u4e00\u8d77\uff0c\u91cd\u65b0\u6392\u5e8f\uff0c\u624d\u80fd\u627e\u51fa\u6574\u4e2a\u7d22\u5f15\u5e93\u4e2d\u771f\u6b63\u7684\u524d1000\u540d\uff0c\u6b64\u65f6\u622a\u53d6990~1000\u7684\u6570\u636e\u5373\u53ef\u3002</p> <p>\u5982\u56fe\uff1a</p> <p></p> <p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5047\u5982\u6211\u4eec\u73b0\u5728\u8981\u67e5\u8be2\u7684\u662f\u7b2c999\u9875\u6570\u636e\u5462\uff0c\u662f\u4e0d\u662f\u8981\u627e\u7b2c9990~10000\u7684\u6570\u636e\uff0c\u90a3\u5c82\u4e0d\u662f\u9700\u8981\u628a\u6bcf\u4e2a\u5206\u7247\u4e2d\u7684\u524d10000\u540d\u6570\u636e\u90fd\u67e5\u8be2\u51fa\u6765\uff0c\u6c47\u603b\u5728\u4e00\u8d77\uff0c\u5728\u5185\u5b58\u4e2d\u6392\u5e8f\uff1f\u5982\u679c\u67e5\u8be2\u7684\u5206\u9875\u6df1\u5ea6\u66f4\u6df1\u5462\uff0c\u9700\u8981\u4e00\u6b21\u68c0\u7d22\u7684\u6570\u636e\u5c82\u4e0d\u662f\u66f4\u591a\uff1f</p> <p></p> <p>\u7531\u6b64\u53ef\u77e5\uff0c\u5f53\u67e5\u8be2\u5206\u9875\u6df1\u5ea6\u8f83\u5927\u65f6\uff0c\u6c47\u603b\u6570\u636e\u8fc7\u591a\uff0c\u5bf9\u5185\u5b58\u548cCPU\u4f1a\u4ea7\u751f\u975e\u5e38\u5927\u7684\u538b\u529b\u3002</p> <p>\u56e0\u6b64elasticsearch\u4f1a\u7981\u6b62<code>from + size</code>\u8d85\u8fc710000\u7684\u8bf7\u6c42\u3002</p> <p>\u9488\u5bf9\u6df1\u5ea6\u5206\u9875\uff0celasticsearch\u63d0\u4f9b\u4e86\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li><code>search after</code>\uff1a\u5206\u9875\u65f6\u9700\u8981\u6392\u5e8f\uff0c\u539f\u7406\u662f\u4ece\u4e0a\u4e00\u6b21\u7684\u6392\u5e8f\u503c\u5f00\u59cb\uff0c\u67e5\u8be2\u4e0b\u4e00\u9875\u6570\u636e\u3002\u5b98\u65b9\u63a8\u8350\u4f7f\u7528\u7684\u65b9\u5f0f\u3002</li> <li><code>scroll</code>\uff1a\u539f\u7406\u5c06\u6392\u5e8f\u540e\u7684\u6587\u6863id\u5f62\u6210\u5feb\u7167\uff0c\u4fdd\u5b58\u4e0b\u6765\uff0c\u57fa\u4e8e\u5feb\u7167\u505a\u5206\u9875\u3002\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</li> </ul> <p>\u8be6\u60c5\u89c1\u6587\u6863</p> <p>Note</p> <p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u91c7\u7528\u666e\u901a\u5206\u9875\u5c31\u53ef\u4ee5\u4e86\u3002\u67e5\u770b\u767e\u5ea6\u3001\u4eac\u4e1c\u7b49\u7f51\u7ad9\uff0c\u4f1a\u53d1\u73b0\u5176\u5206\u9875\u90fd\u6709\u9650\u5236\u3002\u4f8b\u5982\u767e\u5ea6\u6700\u591a\u652f\u630177\u9875\uff0c\u6bcf\u9875\u4e0d\u8db320\u6761\u3002\u4eac\u4e1c\u6700\u591a100\u9875\uff0c\u6bcf\u9875\u6700\u591a60\u6761\u3002 \u56e0\u6b64\uff0c\u4e00\u822c\u6211\u4eec\u91c7\u7528\u9650\u5236\u5206\u9875\u6df1\u5ea6\u7684\u65b9\u5f0f\u5373\u53ef\uff0c\u65e0\u9700\u5b9e\u73b0\u6df1\u5ea6\u5206\u9875\u3002</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u9ad8\u4eae\u663e\u793a","title":"\u9ad8\u4eae\u663e\u793a","text":"<p>\u6211\u4eec\u5728\u767e\u5ea6\uff0c\u4eac\u4e1c\u641c\u7d22\u65f6\uff0c\u5173\u952e\u5b57\u4f1a\u53d8\u6210\u7ea2\u8272\uff0c\u6bd4\u8f83\u9192\u76ee\uff0c\u8fd9\u53eb\u505a\u9ad8\u4eae\u663e\u793a</p> <p>\u5b9e\u73b0\u9ad8\u4eae\u7684\u601d\u8def\u5c31\u662f\uff1a</p> <ul> <li>\u7528\u6237\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57\u641c\u7d22\u6570\u636e</li> <li>\u670d\u52a1\u7aef\u6839\u636e\u641c\u7d22\u5173\u952e\u5b57\u5230elasticsearch\u641c\u7d22\uff0c\u5e76\u7ed9\u641c\u7d22\u7ed3\u679c\u4e2d\u7684\u5173\u952e\u5b57\u8bcd\u6761\u6dfb\u52a0<code>html</code>\u6807\u7b7e</li> <li>\u524d\u7aef\u63d0\u524d\u7ed9\u7ea6\u5b9a\u597d\u7684<code>html</code>\u6807\u7b7e\u6dfb\u52a0<code>CSS</code>\u6837\u5f0f</li> </ul> <p>\u4e8b\u5b9e\u4e0aelasticsearch\u5df2\u7ecf\u63d0\u4f9b\u4e86\u7ed9\u641c\u7d22\u5173\u952e\u5b57\u52a0\u6807\u7b7e\u7684\u8bed\u6cd5\uff0c\u65e0\u9700\u6211\u4eec\u81ea\u5df1\u7f16\u7801\u3002</p> <p>\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /{\u7d22\u5f15\u5e93\u540d}/_search\n{\n  \"query\": {\n    \"match\": {\n      \"\u641c\u7d22\u5b57\u6bb5\": \"\u641c\u7d22\u5173\u952e\u5b57\"\n    }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"\u9ad8\u4eae\u5b57\u6bb5\u540d\u79f0\": {\n        \"pre_tags\": \"&lt;em&gt;\",\n        \"post_tags\": \"&lt;/em&gt;\"\n      }\n    }\n  }\n}\n</code></pre> <p>\u6ce8\u610f</p> <ul> <li>\u641c\u7d22\u5fc5\u987b\u6709\u67e5\u8be2\u6761\u4ef6\uff0c\u800c\u4e14\u662f\u5168\u6587\u68c0\u7d22\u7c7b\u578b\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u4f8b\u5982<code>match</code></li> <li>\u53c2\u4e0e\u9ad8\u4eae\u7684\u5b57\u6bb5\u5fc5\u987b\u662f<code>text</code>\u7c7b\u578b\u7684\u5b57\u6bb5</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53c2\u4e0e\u9ad8\u4eae\u7684\u5b57\u6bb5\u8981\u4e0e\u641c\u7d22\u5b57\u6bb5\u4e00\u81f4\uff0c\u9664\u975e\u6dfb\u52a0\uff1a<code>required_field_match=false</code></li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u67e5\u8be2\u7684DSL\u662f\u4e00\u4e2a\u5927\u7684JSON\u5bf9\u8c61\uff0c\u5305\u542b\u4e0b\u5217\u5c5e\u6027\uff1a</p> <ul> <li><code>query</code>\uff1a\u67e5\u8be2\u6761\u4ef6</li> <li><code>from</code>\u548c<code>size</code>\uff1a\u5206\u9875\u6761\u4ef6</li> <li><code>sort</code>\uff1a\u6392\u5e8f\u6761\u4ef6</li> <li><code>highlight</code>\uff1a\u9ad8\u4eae\u6761\u4ef6</li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#restclient\u67e5\u8be2","title":"RestClient\u67e5\u8be2","text":"<p>\u6587\u6863\u7684\u67e5\u8be2\u4f9d\u7136\u4f7f\u7528 <code>RestHighLevelClient</code>\u5bf9\u8c61\uff0c\u67e5\u8be2\u7684\u57fa\u672c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u521b\u5efa<code>request</code>\u5bf9\u8c61\uff0c\u8fd9\u6b21\u662f\u641c\u7d22\uff0c\u6240\u4ee5\u662f<code>SearchRequest</code></li> <li>\u51c6\u5907\u8bf7\u6c42\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u67e5\u8be2DSL\u5bf9\u5e94\u7684JSON\u53c2\u6570</li> <li>\u53d1\u8d77\u8bf7\u6c42</li> <li>\u89e3\u6790\u54cd\u5e94\uff0c\u54cd\u5e94\u7ed3\u679c\u76f8\u5bf9\u590d\u6742\uff0c\u9700\u8981\u9010\u5c42\u89e3\u6790</li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5165\u95e8_1","title":"\u5165\u95e8","text":"<ol> <li>\u521b\u5efa<code>SearchRequest</code>\u5bf9\u8c61</li> <li>\u51c6\u5907<code>request.source()</code>\uff0c\u4e5f\u5c31\u662fDSL\u3002<ul> <li><code>QueryBuilders</code>\u6765\u6784\u5efa\u67e5\u8be2\u6761\u4ef6</li> <li>\u4f20\u5165<code>request.source()</code> \u7684<code>query()</code>\u65b9\u6cd5</li> </ul> </li> <li>\u53d1\u9001\u8bf7\u6c42\uff0c\u5f97\u5230\u7ed3\u679c</li> <li>\u89e3\u6790\u7ed3\u679c\uff08\u53c2\u8003JSON\u7ed3\u679c\uff0c\u4ece\u5916\u5230\u5185\uff0c\u9010\u5c42\u89e3\u6790\uff09</li> </ol> <pre><code>@Test\nvoid testMatchAll() throws IOException {\n    //\u521b\u5efarequest\u5bf9\u8c61\n    SearchRequest searchRequest = new SearchRequest(\"items\");\n    //\u914d\u7f6erequest\u53c2\u6570\n    searchRequest.source()\n            .query(QueryBuilders.matchAllQuery());\n    //\u6267\u884c\u67e5\u8be2\n    SearchResponse response = client.search(searchRequest, RequestOptions.DEFAULT);\n\n    //\u5904\u7406\u7ed3\u679c\n    SearchHits searchHits = response.getHits();\n    long total = searchHits.getTotalHits().value;\n\n    SearchHit[] hits = searchHits.getHits();\n    for (SearchHit hit : hits) {\n        String json = hit.getSourceAsString();\n        ItemDoc bean = JSONUtil.toBean(json, ItemDoc.class);\n        System.out.println(\"bean = \" + bean);\n    }\n}\n</code></pre> <ul> <li><code>hits</code>\uff1a\u547d\u4e2d\u7684\u7ed3\u679c </li> <li><code>total</code>\uff1a\u603b\u6761\u6570\uff0c\u5176\u4e2d\u7684value\u662f\u5177\u4f53\u7684\u603b\u6761\u6570\u503c</li> <li><code>max_score</code>\uff1a\u6240\u6709\u7ed3\u679c\u4e2d\u5f97\u5206\u6700\u9ad8\u7684\u6587\u6863\u7684\u76f8\u5173\u6027\u7b97\u5206</li> <li><code>hits</code>\uff1a\u641c\u7d22\u7ed3\u679c\u7684\u6587\u6863\u6570\u7ec4\uff0c\u5176\u4e2d\u7684\u6bcf\u4e2a\u6587\u6863\u90fd\u662f\u4e00\u4e2ajson\u5bf9\u8c61 <ul> <li><code>_source</code>\uff1a\u6587\u6863\u4e2d\u7684\u539f\u59cb\u6570\u636e\uff0c\u4e5f\u662fjson\u5bf9\u8c61</li> </ul> </li> </ul>"},{"location":"SpringCloud/Elasticsearch/#\u6784\u5efa\u67e5\u8be2\u6761\u4ef6","title":"\u6784\u5efa\u67e5\u8be2\u6761\u4ef6","text":"<p>\u6240\u6709\u7684\u67e5\u8be2\u6761\u4ef6\u90fd\u662f\u4f7f\u7528QueryBuilders\u6765\u6784\u5efa\u7684</p> <pre><code>@Test\nvoid testSearch() throws IOException {\n    SearchRequest request = new SearchRequest(\"items\");\n    request.source().query(\n            QueryBuilders.boolQuery()\n                    .must(QueryBuilders.matchQuery(\"name\", \"\u8131\u8102\u725b\u5976\"))\n                    .filter(QueryBuilders.termQuery(\"brand.keyword\",\"\u5fb7\u4e9a\"))\n                    .filter(QueryBuilders.rangeQuery(\"price\").lt(30000))\n    );\n    SearchResponse response = client.search(request, RequestOptions.DEFAULT);\n    parseResult(response);\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u5206\u9875\u548c\u6392\u5e8f","title":"\u5206\u9875\u548c\u6392\u5e8f","text":"<p><code>requeset.source()</code>\u5c31\u662f\u6574\u4e2a\u8bf7\u6c42JSON\u53c2\u6570\uff0c\u6240\u4ee5\u6392\u5e8f\u3001\u5206\u9875\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u6765\u8bbe\u7f6e</p> <p></p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u9ad8\u4eae\u663e\u793a_1","title":"\u9ad8\u4eae\u663e\u793a","text":"<p>\u9ad8\u4eae\u67e5\u8be2\u4e0e\u524d\u9762\u7684\u67e5\u8be2\u6709\u4e24\u70b9\u4e0d\u540c\uff1a</p> <ul> <li>\u6761\u4ef6\u540c\u6837\u662f\u5728<code>request.source()</code>\u4e2d\u6307\u5b9a\uff0c\u53ea\u4e0d\u8fc7\u9ad8\u4eae\u6761\u4ef6\u8981\u57fa\u4e8e<code>HighlightBuilder</code>\u6765\u6784\u9020</li> <li>\u9ad8\u4eae\u54cd\u5e94\u7ed3\u679c\u4e0e\u641c\u7d22\u7684\u6587\u6863\u7ed3\u679c\u4e0d\u5728\u4e00\u8d77\uff0c\u9700\u8981\u5355\u72ec\u89e3\u6790</li> </ul> <p></p> <p>\u89e3\u6790\u9ad8\u4eae\u7ed3\u679c</p> <ul> <li> <p>\u83b7\u53d6\u9ad8\u4eae\u7ed3\u679c\u3002<code>hit.getHighlightFields()</code>\uff0c\u8fd4\u56de\u503c\u662f\u4e00\u4e2a<code>Map</code>\uff0ckey\u662f\u9ad8\u4eae\u5b57\u6bb5\u540d\u79f0\uff0c\u503c\u662f<code>HighlightField</code>\u5bf9\u8c61\uff0c\u4ee3\u8868\u9ad8\u4eae\u503c</p> </li> <li> <p>\u4ece<code>Map</code>\u4e2d\u6839\u636e\u9ad8\u4eae\u5b57\u6bb5\u540d\u79f0\uff0c\u83b7\u53d6\u9ad8\u4eae\u5b57\u6bb5\u503c\u5bf9\u8c61<code>HighlightField</code></p> </li> <li> <p>\u4ece<code>HighlightField</code>\u4e2d\u83b7\u53d6<code>Fragments</code>\uff0c\u5e76\u4e14\u8f6c\u4e3a\u5b57\u7b26\u4e32\u3002\u8fd9\u90e8\u5206\u5c31\u662f\u771f\u6b63\u7684\u9ad8\u4eae\u5b57\u7b26\u4e32\u4e86</p> <p>\u6ce8\u610fFragments\u5b9e\u9645\u4e0a\u8fd4\u56de\u6570\u7ec4\uff0c\u9700\u8981\u5c06\u6570\u7ec4\u62fc\u63a5\u5f97\u5230\u9ad8\u4eae\u5b57\u7b26\u4e32(ES\u4f1a\u5c06\u8fc7\u957f\u7684\u5b57\u7b26\u4e32\u62c6\u5206\u6210\u591a\u4e2a\u7247\u6bb5)</p> </li> <li> <p>\u6700\u540e\u7528\u9ad8\u4eae\u7684\u7ed3\u679c\u66ff\u6362Bean\u4e2d\u975e\u9ad8\u4eae\u7ed3\u679c</p> </li> </ul> <p>eg</p> <pre><code>private void handleResponse(SearchResponse response) {\n    SearchHits searchHits = response.getHits();\n    // 1.\u83b7\u53d6\u603b\u6761\u6570\n    long total = searchHits.getTotalHits().value;\n    System.out.println(\"\u5171\u641c\u7d22\u5230\" + total + \"\u6761\u6570\u636e\");\n    // 2.\u904d\u5386\u7ed3\u679c\u6570\u7ec4\n    SearchHit[] hits = searchHits.getHits();\n    for (SearchHit hit : hits) {\n        // 3.\u5f97\u5230_source\uff0c\u4e5f\u5c31\u662f\u539f\u59cbjson\u6587\u6863\n        String source = hit.getSourceAsString();\n        // 4.\u53cd\u5e8f\u5217\u5316\n        ItemDoc item = JSONUtil.toBean(source, ItemDoc.class);\n        // 5.\u83b7\u53d6\u9ad8\u4eae\u7ed3\u679c\n        Map&lt;String, HighlightField&gt; hfs = hit.getHighlightFields();\n        if (CollUtils.isNotEmpty(hfs)) {\n            // 5.1.\u6709\u9ad8\u4eae\u7ed3\u679c\uff0c\u83b7\u53d6name\u7684\u9ad8\u4eae\u7ed3\u679c\n            HighlightField hf = hfs.get(\"name\");\n            if (hf != null) {\n                // 5.2.\u83b7\u53d6\u7b2c\u4e00\u4e2a\u9ad8\u4eae\u7ed3\u679c\u7247\u6bb5\uff0c\u5c31\u662f\u5546\u54c1\u540d\u79f0\u7684\u9ad8\u4eae\u503c\n                String hfName = hf.getFragments()[0].string();\n                item.setName(hfName);\n            }\n        }\n        System.out.println(item);\n    }\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/Elasticsearch/#\u6570\u636e\u805a\u5408","title":"\u6570\u636e\u805a\u5408","text":"<p>\u805a\u5408\uff08<code>aggregations</code>\uff09\u53ef\u4ee5\u8ba9\u6211\u4eec\u6781\u5176\u65b9\u4fbf\u7684\u5b9e\u73b0\u5bf9\u6570\u636e\u7684\u7edf\u8ba1\u3001\u5206\u6790\u3001\u8fd0\u7b97\u3002</p> <p>\u4f8b\u5982\uff1a</p> <ul> <li>\u4ec0\u4e48\u54c1\u724c\u7684\u624b\u673a\u6700\u53d7\u6b22\u8fce\uff1f</li> <li>\u8fd9\u4e9b\u624b\u673a\u7684\u5e73\u5747\u4ef7\u683c\u3001\u6700\u9ad8\u4ef7\u683c\u3001\u6700\u4f4e\u4ef7\u683c\uff1f</li> <li>\u8fd9\u4e9b\u624b\u673a\u6bcf\u6708\u7684\u9500\u552e\u60c5\u51b5\u5982\u4f55\uff1f</li> </ul> <p>\u5b9e\u73b0\u8fd9\u4e9b\u7edf\u8ba1\u529f\u80fd\u7684\u6bd4\u6570\u636e\u5e93\u7684sql\u8981\u65b9\u4fbf\u7684\u591a\uff0c\u800c\u4e14\u67e5\u8be2\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8fd1\u5b9e\u65f6\u641c\u7d22\u6548\u679c\u3002</p> <p>\u5b98\u65b9\u6587\u6863</p> <p>\u805a\u5408\u5e38\u89c1\u7684\u6709\u4e09\u7c7b\uff1a</p> <ul> <li>\u6876\uff08<code>Bucket</code>\uff09\u805a\u5408\uff1a\u7528\u6765\u5bf9\u6587\u6863\u505a\u5206\u7ec4 <ul> <li><code>TermAggregation</code>\uff1a\u6309\u7167\u6587\u6863\u5b57\u6bb5\u503c\u5206\u7ec4\uff0c\u4f8b\u5982\u6309\u7167\u54c1\u724c\u503c\u5206\u7ec4\u3001\u6309\u7167\u56fd\u5bb6\u5206\u7ec4</li> <li><code>Date Histogram</code>\uff1a\u6309\u7167\u65e5\u671f\u9636\u68af\u5206\u7ec4\uff0c\u4f8b\u5982\u4e00\u5468\u4e3a\u4e00\u7ec4\uff0c\u6216\u8005\u4e00\u6708\u4e3a\u4e00\u7ec4</li> </ul> </li> <li>\u5ea6\u91cf\uff08<code>Metric</code>\uff09\u805a\u5408\uff1a\u7528\u4ee5\u8ba1\u7b97\u4e00\u4e9b\u503c\uff0c\u6bd4\u5982\uff1a\u6700\u5927\u503c\u3001\u6700\u5c0f\u503c\u3001\u5e73\u5747\u503c\u7b49 <ul> <li><code>Avg</code>\uff1a\u6c42\u5e73\u5747\u503c</li> <li><code>Max</code>\uff1a\u6c42\u6700\u5927\u503c</li> <li><code>Min</code>\uff1a\u6c42\u6700\u5c0f\u503c</li> <li><code>Stats</code>\uff1a\u540c\u65f6\u6c42<code>max</code>\u3001<code>min</code>\u3001<code>avg</code>\u3001<code>sum</code>\u7b49</li> </ul> </li> <li>\u7ba1\u9053\uff08<code>pipeline</code>\uff09\u805a\u5408\uff1a\u4ee5\u5176\u5b83\u805a\u5408\u7684\u7ed3\u679c\u4e3a\u57fa\u7840\u505a\u8fdb\u4e00\u6b65\u8fd0\u7b97 </li> </ul> <p>\u6ce8\u610f</p> <p>\u53c2\u52a0\u805a\u5408\u7684\u5b57\u6bb5\u5fc5\u987b\u662fkeyword\u3001\u65e5\u671f\u3001\u6570\u503c\u3001\u5e03\u5c14\u7c7b\u578b</p> <p></p>"},{"location":"SpringCloud/Elasticsearch/#dsl\u8bed\u6cd5","title":"DSL\u8bed\u6cd5","text":"<ul> <li>\u6876\u805a\u5408</li> </ul> <p>\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /items/_search\n{\n  \"size\": 0, \n  \"aggs\": {\n    \"category_agg\": {\n      \"terms\": {\n        \"field\": \"category\",\n        \"size\": 20\n      }\n    }\n  }\n}\n</code></pre> <p>\u8bed\u6cd5\u8bf4\u660e\uff1a</p> <ul> <li><code>size</code>\uff1a\u8bbe\u7f6e<code>size</code>\u4e3a0\uff0c\u5c31\u662f\u6bcf\u9875\u67e50\u6761\uff0c\u5219\u7ed3\u679c\u4e2d\u5c31\u4e0d\u5305\u542b\u6587\u6863\uff0c\u53ea\u5305\u542b\u805a\u5408\u7ed3\u679c</li> <li> <p><code>aggs</code>\uff1a\u5b9a\u4e49\u805a\u5408</p> <ul> <li><code>category_agg</code>\uff1a\u805a\u5408\u540d\u79f0\uff0c\u81ea\u5b9a\u4e49\uff0c\u4f46\u4e0d\u80fd\u91cd\u590d<ul> <li><code>terms</code>\uff1a\u805a\u5408\u7684\u7c7b\u578b\uff0c\u6309\u5206\u7c7b\u805a\u5408\uff0c\u6240\u4ee5\u7528<code>term</code><ul> <li><code>field</code>\uff1a\u53c2\u4e0e\u805a\u5408\u7684\u5b57\u6bb5\u540d\u79f0</li> <li><code>size</code>\uff1a\u5e0c\u671b\u8fd4\u56de\u7684\u805a\u5408\u7ed3\u679c\u7684\u6700\u5927\u6570\u91cf</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>\u5e26\u6761\u4ef6\u7684\u805a\u5408\u53ea\u9700\u8981\u6dfb\u52a0<code>query</code>\u8bbe\u7f6e\u6761\u4ef6\u5373\u53ef</p> </li> <li> <p>Metric\u805a\u5408</p> </li> </ul> <p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u5bf9\u6876\u5185\u7684\u5546\u54c1\u505a\u8fd0\u7b97\uff0c\u83b7\u53d6\u6bcf\u4e2a\u54c1\u724c\u4ef7\u683c\u7684\u6700\u5c0f\u503c\u3001\u6700\u5927\u503c\u3001\u5e73\u5747\u503c\u3002</p> <p>\u8fd9\u5c31\u8981\u7528\u5230<code>Metric</code>\u805a\u5408\u4e86\uff0c\u4f8b\u5982<code>stat</code>\u805a\u5408\uff0c\u5c31\u53ef\u4ee5\u540c\u65f6\u83b7\u53d6<code>min</code>\u3001<code>max</code>\u3001<code>avg</code>\u7b49\u7ed3\u679c\u3002</p> <p>\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>GET /items/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"filter\": [\n        {\n          \"term\": {\n            \"category\": \"\u624b\u673a\"\n          }\n        },\n        {\n          \"range\": {\n            \"price\": {\n              \"gte\": 300000\n            }\n          }\n        }\n      ]\n    }\n  }, \n  \"size\": 0, \n  \"aggs\": {\n    \"brand_agg\": {\n      \"terms\": {\n        \"field\": \"brand\",\n        \"size\": 20\n      },\n      \"aggs\": {\n        \"stats_meric\": {\n          \"stats\": {\n            \"field\": \"price\"\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>\u5d4c\u5957\u4e86metric\u805a\u5408</p> <p></p> <p>\u805a\u5408\u5fc5\u987b\u7684\u4e09\u8981\u7d20\uff1a</p> <ul> <li>\u805a\u5408\u540d\u79f0</li> <li>\u805a\u5408\u7c7b\u578b</li> <li>\u805a\u5408\u5b57\u6bb5</li> </ul> <p>\u805a\u5408\u53ef\u914d\u7f6e\u5c5e\u6027\u6709\uff1a</p> <ul> <li>size\uff1a\u6307\u5b9a\u805a\u5408\u7ed3\u679c\u6570\u91cf</li> <li>order\uff1a\u6307\u5b9a\u805a\u5408\u7ed3\u679c\u6392\u5e8f\u65b9\u5f0f</li> <li>field\uff1a\u6307\u5b9a\u805a\u5408\u5b57\u6bb5</li> </ul> <p></p>"},{"location":"SpringCloud/Elasticsearch/#restclient\u5b9e\u73b0","title":"RestClient\u5b9e\u73b0","text":"<p>\u5229\u7528<code>request.source()</code>\u65b9\u6cd5\u6765\u8bbe\u7f6e\u805a\u5408</p> <p>\u805a\u5408\u6761\u4ef6\u7684\u8981\u5229\u7528<code>AggregationBuilders</code>\u8fd9\u4e2a\u5de5\u5177\u7c7b\u6765\u6784\u9020</p> <p></p> <p>\u9700\u8981\u5355\u72ec\u89e3\u6790\u805a\u5408\u7ed3\u679c</p> <p></p> <p>\u4f7f\u7528aggregations.get()\u8fd4\u56de\u805a\u5408\u7ed3\u679c\u65f6\uff0c\u5e94\u8be5\u6839\u636e\u805a\u5408\u7c7b\u578b\u4f7f\u7528\u5177\u4f53\u7684\u5b50\u63a5\u53e3\u63a5\u6536\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u9876\u7ea7\u63a5\u53e3<code>Aggregation</code></p>"},{"location":"SpringCloud/MQ/","title":"MQ","text":"<p>\u670d\u52a1\u4e00\u65e6\u62c6\u5206\uff0c\u5fc5\u7136\u6d89\u53ca\u5230\u670d\u52a1\u4e4b\u95f4\u7684\u76f8\u4e92\u8c03\u7528\uff0c\u76ee\u524d\u6211\u4eec\u670d\u52a1\u4e4b\u95f4\u8c03\u7528\u91c7\u7528\u7684\u90fd\u662f\u57fa\u4e8eOpenFeign\u7684\u8c03\u7528\u3002</p> <p>\u8fd9\u79cd\u8c03\u7528\u4e2d\uff0c\u8c03\u7528\u8005\u53d1\u8d77\u8bf7\u6c42\u540e\u9700\u8981\u7b49\u5f85\u670d\u52a1\u63d0\u4f9b\u8005\u6267\u884c\u4e1a\u52a1\u8fd4\u56de\u7ed3\u679c\u540e\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4e1a\u52a1\u3002\u4e5f\u5c31\u662f\u8bf4\u8c03\u7528\u8005\u5728\u8c03\u7528\u8fc7\u7a0b\u4e2d\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u79f0\u8fd9\u79cd\u8c03\u7528\u65b9\u5f0f\u4e3a\u540c\u6b65\u8c03\u7528\u3002</p> <p>\u5982\u679c\u4e1a\u52a1\u9700\u8981\u5b9e\u65f6\u5f97\u5230\u670d\u52a1\u63d0\u4f9b\u65b9\u7684\u54cd\u5e94\uff0c\u5219\u5e94\u8be5\u9009\u62e9\u540c\u6b65\u8c03\u7528\u3002\u800c\u5982\u679c\u6211\u4eec\u8ffd\u6c42\u66f4\u9ad8\u7684\u6548\u7387\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u5b9e\u65f6\u54cd\u5e94\uff0c\u5219\u5e94\u8be5\u9009\u62e9\u5f02\u6b65\u8c03\u7528\u3002</p>"},{"location":"SpringCloud/MQ/#\u521d\u8bc6mq","title":"\u521d\u8bc6MQ","text":""},{"location":"SpringCloud/MQ/#\u540c\u6b65\u8c03\u7528","title":"\u540c\u6b65\u8c03\u7528","text":"<p>\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u62d3\u5c55\u6027\u5dee\uff1a\u6bcf\u6b21\u6709\u65b0\u7684\u9700\u6c42\uff0c\u73b0\u6709\u652f\u4ed8\u903b\u8f91\u90fd\u8981\u8ddf\u7740\u53d8\u5316\uff0c\u4ee3\u7801\u7ecf\u5e38\u53d8\u52a8\uff0c\u4e0d\u7b26\u5408\u5f00\u95ed\u539f\u5219</li> <li>\u6027\u80fd\u4e0b\u964d\uff1a\u8c03\u7528\u8005\u9700\u8981\u7b49\u5f85\u670d\u52a1\u63d0\u4f9b\u8005\u6267\u884c\u5b8c\u8fd4\u56de\u7ed3\u679c\u540e\uff0c\u624d\u80fd\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\uff0c\u8c03\u7528\u8005\u5904\u4e8e\u963b\u585e\u7b49\u5f85\u72b6\u6001</li> <li>\u7ea7\u8054\u5931\u8d25\uff1a\u5f53\u67d0\u4e2a\u670d\u52a1\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u6574\u4e2a\u4e8b\u52a1\u90fd\u4f1a\u56de\u6eda</li> </ol> <p></p>"},{"location":"SpringCloud/MQ/#\u5f02\u6b65\u8c03\u7528","title":"\u5f02\u6b65\u8c03\u7528","text":"<p>\u5f02\u6b65\u8c03\u7528\u65b9\u5f0f\u5176\u5b9e\u5c31\u662f\u57fa\u4e8e\u6d88\u606f\u901a\u77e5\u7684\u65b9\u5f0f\uff0c\u4e00\u822c\u5305\u542b\u4e09\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>\u6d88\u606f\u53d1\u9001\u8005\uff1a\u6295\u9012\u6d88\u606f\u7684\u4eba\uff0c\u5c31\u662f\u539f\u6765\u7684\u8c03\u7528\u65b9</li> <li>\u6d88\u606fBroker\uff1a\u7ba1\u7406\u3001\u6682\u5b58\u3001\u8f6c\u53d1\u6d88\u606f</li> <li>\u6d88\u606f\u63a5\u6536\u8005\uff1a\u63a5\u6536\u548c\u5904\u7406\u6d88\u606f\u7684\u4eba\uff0c\u5c31\u662f\u539f\u6765\u7684\u670d\u52a1\u63d0\u4f9b\u65b9</li> </ul> <p></p> <p>\u5728\u5f02\u6b65\u8c03\u7528\u4e2d\uff0c\u53d1\u9001\u8005\u4e0d\u518d\u76f4\u63a5\u540c\u6b65\u8c03\u7528\u63a5\u6536\u8005\u7684\u4e1a\u52a1\u63a5\u53e3\uff0c\u800c\u662f\u53d1\u9001\u4e00\u6761\u6d88\u606f\u6295\u9012\u7ed9\u6d88\u606fBroker\u3002</p> <p>\u7136\u540e\u63a5\u6536\u8005\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u4ece\u6d88\u606fBroker\u90a3\u91cc\u8ba2\u9605\u6d88\u606f\u3002\u6bcf\u5f53\u53d1\u9001\u65b9\u53d1\u9001\u6d88\u606f\u540e\uff0c\u63a5\u53d7\u8005\u90fd\u80fd\u83b7\u53d6\u6d88\u606f\u5e76\u5904\u7406\u3002</p> <p>Example</p> <p>\u5047\u5982\u4ea7\u54c1\u7ecf\u7406\u63d0\u51fa\u4e86\u65b0\u7684\u9700\u6c42\u3002\u4ee3\u7801\u5b8c\u5168\u4e0d\u7528\u53d8\u66f4\uff0c\u800c\u4ec5\u4ec5\u662f\u8ba9\u65b0\u7684\u670d\u52a1\u4e5f\u8ba2\u9605\u6d88\u606f\u5373\u53ef</p> <p>\u5f02\u6b65\u8c03\u7528\u7684\u4f18\u52bf\u5305\u62ec\uff1a</p> <ul> <li>\u8026\u5408\u5ea6\u66f4\u4f4e</li> <li>\u6027\u80fd\u66f4\u597d</li> <li>\u4e1a\u52a1\u62d3\u5c55\u6027\u5f3a</li> <li>\u6545\u969c\u9694\u79bb\uff0c\u907f\u514d\u7ea7\u8054\u5931\u8d25</li> </ul> <p>\u5f53\u7136\uff0c\u5f02\u6b65\u901a\u4fe1\u4e5f\u5e76\u975e\u5b8c\u7f8e\u65e0\u7f3a\uff0c\u5b83\u5b58\u5728\u4e0b\u5217\u7f3a\u70b9\uff1a</p> <ul> <li>\u5b8c\u5168\u4f9d\u8d56\u4e8eBroker\u7684\u53ef\u9760\u6027\u3001\u5b89\u5168\u6027\u548c\u6027\u80fd</li> <li>\u67b6\u6784\u590d\u6742\uff0c\u540e\u671f\u7ef4\u62a4\u548c\u8c03\u8bd5\u9ebb\u70e6</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#mq\u6280\u672f\u9009\u578b","title":"MQ\u6280\u672f\u9009\u578b","text":"<p>\u51e0\u79cd\u5e38\u89c1MQ\u7684\u5bf9\u6bd4\uff1a</p> RabbitMQ ActiveMQ RocketMQ Kafka \u516c\u53f8/\u793e\u533a Rabbit Apache \u963f\u91cc Apache \u5f00\u53d1\u8bed\u8a00 Erlang Java Java Scala&amp;Java \u534f\u8bae\u652f\u6301 AMQP\uff0cXMPP\uff0cSMTP\uff0cSTOMP OpenWire,STOMP\uff0cREST,XMPP,AMQP \u81ea\u5b9a\u4e49\u534f\u8bae \u81ea\u5b9a\u4e49\u534f\u8bae \u53ef\u7528\u6027 \u9ad8 \u4e00\u822c \u9ad8 \u9ad8 \u5355\u673a\u541e\u5410\u91cf \u4e00\u822c \u5dee \u9ad8 \u975e\u5e38\u9ad8 \u6d88\u606f\u5ef6\u8fdf \u5fae\u79d2\u7ea7 \u6beb\u79d2\u7ea7 \u6beb\u79d2\u7ea7 \u6beb\u79d2\u4ee5\u5185 \u6d88\u606f\u53ef\u9760\u6027 \u9ad8 \u4e00\u822c \u9ad8 \u4e00\u822c <p>\u8ffd\u6c42\u53ef\u7528\u6027\uff1aKafka\u3001 RocketMQ \u3001RabbitMQ</p> <p>\u8ffd\u6c42\u53ef\u9760\u6027\uff1aRabbitMQ\u3001RocketMQ</p> <p>\u8ffd\u6c42\u541e\u5410\u80fd\u529b\uff1aRocketMQ\u3001Kafka</p> <p>\u8ffd\u6c42\u6d88\u606f\u4f4e\u5ef6\u8fdf\uff1aRabbitMQ\u3001Kafka</p> <p></p>"},{"location":"SpringCloud/MQ/#rabbitmq","title":"RabbitMQ","text":""},{"location":"SpringCloud/MQ/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u4f7f\u7528docker\u90e8\u7f72RabbitMQ</p> <pre><code>docker run \\\n -e RABBITMQ_DEFAULT_USER=admin \\\n -e RABBITMQ_DEFAULT_PASS=admin \\\n -v mq-plugins:/plugins \\\n --name mq \\\n --hostname mq \\\n -p 15672:15672 \\\n -p 5672:5672 \\\n --network work\\\n -d \\\n rabbitmq:3.8-management\n</code></pre> <ul> <li>15672\uff1aRabbitMQ\u63d0\u4f9b\u7684\u7ba1\u7406\u63a7\u5236\u53f0\u7684\u7aef\u53e3</li> <li>5672\uff1aRabbitMQ\u7684\u6d88\u606f\u53d1\u9001\u5904\u7406\u63a5\u53e3</li> </ul> <p>\u6d4f\u89c8\u5668\u8bbf\u95ee http://localhost:15672 \u5373\u53ef\u8fdb\u5165RabbitMQ\u63a7\u5236\u53f0</p> <p></p> <p>RabbitMQ\u5bf9\u5e94\u7684\u67b6\u6784\u5982\u56fe\uff1a</p> <p></p> <p>\u5176\u4e2d\u5305\u542b\u51e0\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li><code>publisher</code>\uff1a\u751f\u4ea7\u8005\uff0c\u4e5f\u5c31\u662f\u53d1\u9001\u6d88\u606f\u7684\u4e00\u65b9</li> <li><code>consumer</code>\uff1a\u6d88\u8d39\u8005\uff0c\u4e5f\u5c31\u662f\u6d88\u8d39\u6d88\u606f\u7684\u4e00\u65b9</li> <li><code>queue</code>\uff1a\u961f\u5217\uff0c\u5b58\u50a8\u6d88\u606f\u3002\u751f\u4ea7\u8005\u6295\u9012\u7684\u6d88\u606f\u4f1a\u6682\u5b58\u5728\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u7b49\u5f85\u6d88\u8d39\u8005\u5904\u7406</li> <li><code>exchange</code>\uff1a\u4ea4\u6362\u673a\uff0c\u8d1f\u8d23\u6d88\u606f\u8def\u7531\u3002\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u7531\u4ea4\u6362\u673a\u51b3\u5b9a\u6295\u9012\u5230\u54ea\u4e2a\u961f\u5217\u3002</li> <li><code>virtual host</code>\uff1a\u865a\u62df\u4e3b\u673a\uff0c\u8d77\u5230\u6570\u636e\u9694\u79bb\u7684\u4f5c\u7528\u3002\u6bcf\u4e2a\u865a\u62df\u4e3b\u673a\u76f8\u4e92\u72ec\u7acb\uff0c\u6709\u5404\u81ea\u7684exchange\u3001queue</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u6536\u53d1\u6d88\u606f","title":"\u6536\u53d1\u6d88\u606f","text":"<ul> <li>\u4ea4\u6362\u673a</li> </ul> <p>\u6253\u5f00Exchanges\u9009\u9879\u5361\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u5b58\u5728\u5f88\u591a\u4ea4\u6362\u673a</p> <p>\u70b9\u51fb\u4efb\u610f\u4ea4\u6362\u673a\uff0c\u5373\u53ef\u8fdb\u5165\u4ea4\u6362\u673a\u8be6\u60c5\u9875\u9762\u3002\u7528\u63a7\u5236\u53f0\u4e2d\u7684publish message \u53d1\u9001\u4e00\u6761\u6d88\u606f</p> <p>\u7531\u4e8e\u6ca1\u6709\u6d88\u8d39\u8005\u5b58\u5728\uff0c\u6700\u7ec8\u6d88\u606f\u4e22\u5931\u4e86\uff0c\u8fd9\u8bf4\u660e\u4ea4\u6362\u673a\u6ca1\u6709\u5b58\u50a8\u6d88\u606f\u7684\u80fd\u529b\u3002</p> <p></p> <ul> <li>\u961f\u5217</li> </ul> <p>\u6253\u5f00<code>Queues</code>\u9009\u9879\u5361\uff0c\u65b0\u5efa\u4e00\u4e2a\u961f\u5217</p> <p>\u6b64\u65f6\uff0c\u518d\u6b21\u5411\u4ea4\u6362\u673a\u53d1\u9001\u4e00\u6761\u6d88\u606f\u3002\u4f1a\u53d1\u73b0\u6d88\u606f\u4f9d\u7136\u6ca1\u6709\u5230\u8fbe\u961f\u5217</p> <p>\u53d1\u9001\u5230\u4ea4\u6362\u673a\u7684\u6d88\u606f\uff0c\u53ea\u4f1a\u8def\u7531\u5230\u4e0e\u5176\u7ed1\u5b9a\u7684\u961f\u5217\uff0c\u56e0\u6b64\u4ec5\u4ec5\u521b\u5efa\u961f\u5217\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u9700\u8981\u5c06\u5176\u4e0e\u4ea4\u6362\u673a\u7ed1\u5b9a\u3002</p> <p></p> <ul> <li>\u7ed1\u5b9a\u5173\u7cfb</li> </ul> <p>\u70b9\u51fb<code>Exchanges</code>\u9009\u9879\u5361\uff0c\u70b9\u51fb\u4e00\u4e2a\u4ea4\u6362\u673a\uff0c\u8fdb\u5165\u4ea4\u6362\u673a\u8be6\u60c5\u9875\uff0c\u7136\u540e\u70b9\u51fb<code>Bindings</code>\u83dc\u5355\uff0c\u5728\u8868\u5355\u4e2d\u586b\u5199\u8981\u7ed1\u5b9a\u7684\u961f\u5217\u540d\u79f0</p> <p>\u7ed1\u5b9a\u6210\u529f\u540e\u53d1\u9001\u6d88\u606f\uff0c\u518d\u6b21\u70b9\u51fb\u961f\u5217\u5373\u53ef\u67e5\u770b\u6536\u5230\u7684\u6d88\u606f</p> <p></p>"},{"location":"SpringCloud/MQ/#\u6570\u636e\u9694\u79bb","title":"\u6570\u636e\u9694\u79bb","text":"<p>\u70b9\u51fb<code>Admin</code>\u9009\u9879\u5361\uff0c\u4f1a\u770b\u5230RabbitMQ\u63a7\u5236\u53f0\u7684\u7528\u6237\u7ba1\u7406\u754c\u9762</p> <p>\u5bf9\u4e8e\u5c0f\u578b\u4f01\u4e1a\u800c\u8a00\uff0c\u51fa\u4e8e\u6210\u672c\u8003\u8651\uff0c\u901a\u5e38\u53ea\u4f1a\u642d\u5efa\u4e00\u5957MQ\u96c6\u7fa4\uff0c\u516c\u53f8\u5185\u7684\u591a\u4e2a\u4e0d\u540c\u9879\u76ee\u540c\u65f6\u4f7f\u7528\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u4e92\u76f8\u5e72\u6270\uff0c \u6211\u4eec\u4f1a\u5229\u7528<code>virtual host</code>\u7684\u9694\u79bb\u7279\u6027\uff0c\u5c06\u4e0d\u540c\u9879\u76ee\u9694\u79bb\u3002</p> <p>\u4e00\u822c\u4f1a\u505a\u4e24\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u7ed9\u6bcf\u4e2a\u9879\u76ee\u521b\u5efa\u72ec\u7acb\u7684\u8fd0\u7ef4\u8d26\u53f7\uff0c\u5c06\u7ba1\u7406\u6743\u9650\u5206\u79bb\u3002</li> <li>\u7ed9\u6bcf\u4e2a\u9879\u76ee\u521b\u5efa\u4e0d\u540c\u7684<code>virtual host</code>\uff0c\u5c06\u6bcf\u4e2a\u9879\u76ee\u7684\u6570\u636e\u9694\u79bb\u3002</li> </ul> <p>\u65b0\u589e\u7528\u6237\u6ca1\u6709\u4efb\u4f55<code>virtual host</code>\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u9700\u8981\u767b\u5f55\u8be5\u8d26\u53f7\u521b\u5efa\u65b0\u7684<code>virtual host</code></p> <p></p>"},{"location":"SpringCloud/MQ/#fanout\u4ea4\u6362\u673a","title":"Fanout\u4ea4\u6362\u673a","text":"<p>\u4e00\u65e6\u5f15\u5165\u4ea4\u6362\u673a\uff0c\u6d88\u606f\u53d1\u9001\u7684\u6a21\u5f0f\u4f1a\u6709\u5f88\u5927\u53d8\u5316\uff1a</p> <p></p> <ul> <li>Exchange\uff1a\u4ea4\u6362\u673a\uff0c\u4e00\u65b9\u9762\uff0c\u63a5\u6536\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u77e5\u9053\u5982\u4f55\u5904\u7406\u6d88\u606f\uff0c\u4f8b\u5982\u9012\u4ea4\u7ed9\u67d0\u4e2a\u7279\u522b\u961f\u5217\u3001\u9012\u4ea4\u7ed9\u6240\u6709\u961f\u5217\u3001\u6216\u662f\u5c06\u6d88\u606f\u4e22\u5f03\u3002\u5230\u5e95\u5982\u4f55\u64cd\u4f5c\uff0c\u53d6\u51b3\u4e8eExchange\u7684\u7c7b\u578b\u3002</li> </ul> <p>Warning</p> <p>Exchange\u53ea\u8d1f\u8d23\u8f6c\u53d1\u6d88\u606f\uff0c\u4e0d\u5177\u5907\u5b58\u50a8\u6d88\u606f\u7684\u80fd\u529b\uff0c\u56e0\u6b64\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u961f\u5217\u4e0eExchange\u7ed1\u5b9a\uff0c\u6216\u8005\u6ca1\u6709\u7b26\u5408\u8def\u7531\u89c4\u5219\u7684\u961f\u5217\uff0c\u90a3\u4e48\u6d88\u606f\u4f1a\u4e22\u5931\uff01</p> <p>\u4ea4\u6362\u673a\u7684\u7c7b\u578b\u6709\u56db\u79cd\uff1a</p> <ul> <li>Fanout\uff1a\u5e7f\u64ad\uff0c\u5c06\u6d88\u606f\u4ea4\u7ed9\u6240\u6709\u7ed1\u5b9a\u5230\u4ea4\u6362\u673a\u7684\u961f\u5217\u3002</li> <li>Direct\uff1a\u8ba2\u9605\uff0c\u57fa\u4e8eRoutingKey\uff08\u8def\u7531key\uff09\u53d1\u9001\u7ed9\u8ba2\u9605\u4e86\u6d88\u606f\u7684\u961f\u5217</li> <li>Topic\uff1a\u901a\u914d\u7b26\u8ba2\u9605\uff0c\u4e0eDirect\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7RoutingKey\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26</li> <li>Headers\uff1a\u5934\u5339\u914d\uff0c\u57fa\u4e8eMQ\u7684\u6d88\u606f\u5934\u5339\u914d\uff0c\u8f83\u5c11\u4f7f\u7528\u3002</li> </ul> <p></p> <p>\u5e94\u7528\u573a\u666f: \u5f53\u591a\u4e2a\u6d88\u8d39\u8005\u9700\u8981\u5904\u7406\u76f8\u540c\u7684\u6d88\u606f\u65f6\uff0c\u5c31\u9700\u8981\u4e3a\u6bcf\u4e2a\u6d88\u8d39\u8005\u521b\u5efa\u961f\u5217\uff0c\u7136\u540e\u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u4ea4\u6362\u673a\uff0c\u901a\u8fc7\u4ea4\u6362\u673a\u89c4\u5219\u8f6c\u53d1\u6d88\u606f</p> <p></p>"},{"location":"SpringCloud/MQ/#direct\u4ea4\u6362\u673a","title":"Direct\u4ea4\u6362\u673a","text":"<p>\u5728Fanout\u6a21\u5f0f\u4e2d\uff0c\u4e00\u6761\u6d88\u606f\uff0c\u4f1a\u88ab\u6240\u6709\u8ba2\u9605\u7684\u961f\u5217\u90fd\u6d88\u8d39\u3002\u4f46\u662f\uff0c\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e0c\u671b\u4e0d\u540c\u7684\u6d88\u606f\u88ab\u4e0d\u540c\u7684\u961f\u5217\u6d88\u8d39\u3002\u8fd9\u65f6\u5c31\u8981\u7528\u5230Direct\u7c7b\u578b\u7684Exchange\u3002</p> <p>\u5728Direct\u6a21\u578b\u4e0b\uff1a</p> <ul> <li>\u961f\u5217\u4e0e\u4ea4\u6362\u673a\u7684\u7ed1\u5b9a\uff0c\u4e0d\u518d\u662f\u4efb\u610f\u7ed1\u5b9a\u4e86\uff0c\u800c\u662f\u8981\u6307\u5b9a\u4e00\u4e2a<code>RoutingKey</code>\uff08\u8def\u7531key\uff09</li> <li>\u6d88\u606f\u7684\u53d1\u9001\u65b9\u5728\u5411Exchange\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u4e5f\u5fc5\u987b\u6307\u5b9a\u6d88\u606f\u7684 <code>RoutingKey</code>\u3002</li> <li>Exchange\u4e0d\u518d\u628a\u6d88\u606f\u4ea4\u7ed9\u6bcf\u4e00\u4e2a\u7ed1\u5b9a\u7684\u961f\u5217\uff0c\u800c\u662f\u6839\u636e\u6d88\u606f\u7684<code>Routing Key</code>\u8fdb\u884c\u5224\u65ad\uff0c\u53ea\u6709\u961f\u5217\u7684<code>Routingkey</code>\u4e0e\u6d88\u606f\u7684<code>Routing key</code>\u5b8c\u5168\u4e00\u81f4\uff0c\u624d\u4f1a\u63a5\u6536\u5230\u6d88\u606f</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#topic\u4ea4\u6362\u673a","title":"Topic\u4ea4\u6362\u673a","text":"<p><code>Topic</code>\u7c7b\u578b\u7684<code>Exchange</code>\u4e0e<code>Direct</code>\u76f8\u6bd4\uff0c\u90fd\u662f\u53ef\u4ee5\u6839\u636e<code>RoutingKey</code>\u628a\u6d88\u606f\u8def\u7531\u5230\u4e0d\u540c\u7684\u961f\u5217\u3002</p> <p>\u53ea\u4e0d\u8fc7<code>Topic</code>\u7c7b\u578b<code>Exchange</code>\u53ef\u4ee5\u8ba9\u961f\u5217\u5728\u7ed1\u5b9a<code>BindingKey</code> \u7684\u65f6\u5019\u4f7f\u7528\u901a\u914d\u7b26\uff01</p> <p><code>BindingKey</code> \u4e00\u822c\u90fd\u662f\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u5355\u8bcd\u7ec4\u6210\uff0c\u591a\u4e2a\u5355\u8bcd\u4e4b\u95f4\u4ee5<code>.</code>\u5206\u5272\uff0c\u4f8b\u5982\uff1a <code>item.insert</code></p> <p>\u901a\u914d\u7b26\u89c4\u5219\uff1a</p> <ul> <li><code>#</code>\uff1a\u5339\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u8bcd</li> <li><code>*</code>\uff1a\u5339\u914d\u4e0d\u591a\u4e0d\u5c11\u6070\u597d1\u4e2a\u8bcd</li> </ul> <p>\u4e3e\u4f8b\uff1a</p> <ul> <li><code>item.#</code>\uff1a\u80fd\u591f\u5339\u914d<code>item.spu.insert</code> \u6216\u8005 <code>item.spu</code></li> <li><code>item.*</code>\uff1a\u53ea\u80fd\u5339\u914d<code>item.spu</code></li> </ul> <p></p> <p>Direct\u4ea4\u6362\u673a\u4e0eTopic\u4ea4\u6362\u673a\u7684\u5dee\u5f02</p> <ul> <li>Topic\u4ea4\u6362\u673a\u63a5\u6536\u7684\u6d88\u606fRoutingKey\u5fc5\u987b\u662f\u591a\u4e2a\u5355\u8bcd\uff0c\u4ee5 <code>.</code> \u5206\u5272</li> <li>Topic\u4ea4\u6362\u673a\u4e0e\u961f\u5217\u7ed1\u5b9a\u65f6\u7684bindingKey\u53ef\u4ee5\u6307\u5b9a\u901a\u914d\u7b26</li> <li><code>#</code>\uff1a\u4ee3\u88680\u4e2a\u6216\u591a\u4e2a\u8bcd</li> <li><code>*</code>\uff1a\u4ee3\u88681\u4e2a\u8bcd</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#springamqp","title":"SpringAMQP","text":"<p>\u7531\u4e8e<code>RabbitMQ</code>\u91c7\u7528\u4e86AMQP\u534f\u8bae\uff0c\u56e0\u6b64\u5b83\u5177\u5907\u8de8\u8bed\u8a00\u7684\u7279\u6027\u3002\u4efb\u4f55\u8bed\u8a00\u53ea\u8981\u9075\u5faaAMQP\u534f\u8bae\u6536\u53d1\u6d88\u606f\uff0c\u90fd\u53ef\u4ee5\u4e0e<code>RabbitMQ</code>\u4ea4\u4e92\u3002\u5e76\u4e14<code>RabbitMQ</code>\u5b98\u65b9\u4e5f\u63d0\u4f9b\u4e86\u5404\u79cd\u4e0d\u540c\u8bed\u8a00\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\u4f46\u662f\uff0cRabbitMQ\u5b98\u65b9\u63d0\u4f9b\u7684Java\u5ba2\u6237\u7aef\u7f16\u7801\u76f8\u5bf9\u590d\u6742\uff0c\u4e00\u822c\u751f\u4ea7\u73af\u5883\u4e0b\u6211\u4eec\u66f4\u591a\u4f1a\u7ed3\u5408Spring\u6765\u4f7f\u7528\u3002</p> <p>\u800cSpring\u7684\u5b98\u65b9\u521a\u597d\u57fa\u4e8eRabbitMQ\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u5957\u6d88\u606f\u6536\u53d1\u7684\u6a21\u677f\u5de5\u5177\uff1aSpringAMQP\u3002\u5e76\u4e14\u8fd8\u57fa\u4e8eSpringBoot\u5bf9\u5176\u5b9e\u73b0\u4e86\u81ea\u52a8\u88c5\u914d\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u65b9\u4fbf</p> <p>SpringAmqp\u7684\u5b98\u65b9\u5730\u5740</p> <p>SpringAMQP\u63d0\u4f9b\u4e86\u4e09\u4e2a\u529f\u80fd\uff1a</p> <ul> <li>\u81ea\u52a8\u58f0\u660e\u961f\u5217\u3001\u4ea4\u6362\u673a\u53ca\u5176\u7ed1\u5b9a\u5173\u7cfb</li> <li>\u57fa\u4e8e\u6ce8\u89e3\u7684\u76d1\u542c\u5668\u6a21\u5f0f\uff0c\u5f02\u6b65\u63a5\u6536\u6d88\u606f</li> <li>\u5c01\u88c5\u4e86RabbitTemplate\u5de5\u5177\uff0c\u7528\u4e8e\u53d1\u9001\u6d88\u606f</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<p>1.\u5f15\u5165AMQP\u4f9d\u8d56</p> <pre><code>&lt;!--AMQP\u4f9d\u8d56\uff0c\u5305\u542bRabbitMQ--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>2.\u914d\u7f6eMQ\u5730\u5740\uff0c\u5728<code>application.yml</code>\u4e2d\u6dfb\u52a0\u914d\u7f6e\uff1a</p> <pre><code>spring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: ysh\n    password: 123\n    virtual-host: ysh\n</code></pre> <p>3.\u53d1\u9001\u6d88\u606f</p> <pre><code>    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @Test\n    public void testSimpleQueue(){\n\n        String queueName = \"test\";\n\n        String message = \"Hello, RabbitMQ!\";\n\n        rabbitTemplate.convertAndSend(queueName, message);\n    }\n</code></pre> <p>4.\u63a5\u6536\u6d88\u606f</p> <pre><code>    @RabbitListener(queues = \"test\")\n    public void listen(String message){\n        log.info(\"\u76d1\u542c\u5230\u6d88\u606f\uff1a{}\",message);\n    }\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#work-queues","title":"Work Queues","text":"<p>Work queues\uff0c\u4efb\u52a1\u6a21\u578b\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u8ba9\u591a\u4e2a\u6d88\u8d39\u8005\u7ed1\u5b9a\u5230\u4e00\u4e2a\u961f\u5217\uff0c\u5171\u540c\u6d88\u8d39\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002</p> <p></p> <p>\u5f53\u6d88\u606f\u5904\u7406\u6bd4\u8f83\u8017\u65f6\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u751f\u4ea7\u6d88\u606f\u7684\u901f\u5ea6\u4f1a\u8fdc\u8fdc\u5927\u4e8e\u6d88\u606f\u7684\u6d88\u8d39\u901f\u5ea6\u3002\u957f\u6b64\u4ee5\u5f80\uff0c\u6d88\u606f\u5c31\u4f1a\u5806\u79ef\u8d8a\u6765\u8d8a\u591a\uff0c\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u3002</p> <p>\u6b64\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528work\u6a21\u578b\uff0c\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5904\u7406\u6d88\u606f\u5904\u7406\uff0c\u6d88\u606f\u5904\u7406\u7684\u901f\u5ea6\u5c31\u80fd\u5927\u5927\u63d0\u9ad8\u4e86\u3002</p> <p>Info</p> <p>\u6d88\u606f\u9ed8\u8ba4\u662f\u5e73\u5747\u5206\u914d\u7ed9\u6bcf\u4e2a\u6d88\u8d39\u8005\uff0c\u5e76\u6ca1\u6709\u8003\u8651\u5230\u6d88\u8d39\u8005\u7684\u5904\u7406\u80fd\u529b\u3002\u5bfc\u81f41\u4e2a\u6d88\u8d39\u8005\u7a7a\u95f2\uff0c\u53e6\u4e00\u4e2a\u6d88\u8d39\u8005\u5fd9\u7684\u4e0d\u53ef\u5f00\u4ea4\u3002\u6ca1\u6709\u5145\u5206\u5229\u7528\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u7684\u80fd\u529b\uff0c\u8fd9\u6837\u663e\u7136\u662f\u6709\u95ee\u9898\u7684\u3002</p> <p>\u5728spring\u4e2d\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u6211\u4eec\u4fee\u6539consumer\u670d\u52a1\u7684application.yml\u6587\u4ef6\uff0c\u6dfb\u52a0\u914d\u7f6e\uff1a</p> <pre><code>spring:\nrabbitmq:\n    listener:\n    simple:\n        prefetch: 1 # \u6bcf\u6b21\u53ea\u80fd\u83b7\u53d6\u4e00\u6761\u6d88\u606f\uff0c\u5904\u7406\u5b8c\u6210\u624d\u80fd\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6d88\u606f\n</code></pre> <p>Work\u6a21\u578b\u7684\u4f7f\u7528\uff1a</p> <ul> <li>\u591a\u4e2a\u6d88\u8d39\u8005\u7ed1\u5b9a\u5230\u4e00\u4e2a\u961f\u5217\uff0c\u540c\u4e00\u6761\u6d88\u606f\u53ea\u4f1a\u88ab\u4e00\u4e2a\u6d88\u8d39\u8005\u5904\u7406</li> <li>\u901a\u8fc7\u8bbe\u7f6eprefetch\u6765\u63a7\u5236\u6d88\u8d39\u8005\u9884\u53d6\u7684\u6d88\u606f\u6570\u91cf</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u58f0\u660e\u961f\u5217\u548c\u4ea4\u6362\u673a","title":"\u58f0\u660e\u961f\u5217\u548c\u4ea4\u6362\u673a","text":"<p>\u4e4b\u524d\u90fd\u662f\u57fa\u4e8eRabbitMQ\u63a7\u5236\u53f0\u6765\u521b\u5efa\u961f\u5217\u3001\u4ea4\u6362\u673a\u3002\u4f46\u662f\u5728\u5b9e\u9645\u5f00\u53d1\u65f6\uff0c\u961f\u5217\u548c\u4ea4\u6362\u673a\u662f\u7a0b\u5e8f\u5458\u5b9a\u4e49\u7684\uff0c\u5c06\u6765\u9879\u76ee\u4e0a\u7ebf\uff0c\u53c8\u8981\u4ea4\u7ed9\u8fd0\u7ef4\u53bb\u521b\u5efa\u3002\u90a3\u4e48\u7a0b\u5e8f\u5458\u5c31\u9700\u8981\u628a\u7a0b\u5e8f\u4e2d\u8fd0\u884c\u7684\u6240\u6709\u961f\u5217\u548c\u4ea4\u6362\u673a\u90fd\u5199\u4e0b\u6765\uff0c\u4ea4\u7ed9\u8fd0\u7ef4\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u662f\u5f88\u5bb9\u6613\u51fa\u73b0\u9519\u8bef\u7684\u3002</p> <p>\u56e0\u6b64\u63a8\u8350\u7684\u505a\u6cd5\u662f\u7531\u7a0b\u5e8f\u542f\u52a8\u65f6\u68c0\u67e5\u961f\u5217\u548c\u4ea4\u6362\u673a\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u81ea\u52a8\u521b\u5efa\u3002</p> <p>SpringAMQP\u63d0\u4f9b\u4e86\u4e00\u4e2aQueue\u7c7b\uff0c\u7528\u6765\u521b\u5efa\u961f\u5217</p> <p>SpringAMQP\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2aExchange\u63a5\u53e3\uff0c\u6765\u8868\u793a\u6240\u6709\u4e0d\u540c\u7c7b\u578b\u7684\u4ea4\u6362\u673a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\u961f\u5217\u548c\u4ea4\u6362\u673a\uff0c\u4e0d\u8fc7SpringAMQP\u8fd8\u63d0\u4f9b\u4e86ExchangeBuilder\u6765\u7b80\u5316\u8fd9\u4e2a\u8fc7\u7a0b</p> <p>\u800c\u5728\u7ed1\u5b9a\u961f\u5217\u548c\u4ea4\u6362\u673a\u65f6\uff0c\u5219\u9700\u8981\u4f7f\u7528BindingBuilder\u6765\u521b\u5efaBinding\u5bf9\u8c61</p> <p>\u57fa\u4e8eJavaBean\u58f0\u660e\u793a\u4f8b\u4ee3\u7801</p> <pre><code>@Configuration\npublic class FanoutConfiguration {\n\n    @Bean\n    public FanoutExchange fanoutExchange() {\n        // \u521b\u5efa\u4e00\u4e2a fanout \u7c7b\u578b\u7684\u4ea4\u6362\u673a\n        return new FanoutExchange(\"ysh.fanout\");\n    }\n\n    @Bean\n    public Queue fanoutQueue1() {\n        // \u521b\u5efa\u4e00\u4e2a\u961f\u5217\n        return new Queue(\"fanout.queue1\");\n    }\n\n    @Bean\n    public Binding fanoutQueueBinding(Queue fanoutQueue1, FanoutExchange fanoutExchange) {\n        // \u5c06\u961f\u5217\u548c\u4ea4\u6362\u673a\u7ed1\u5b9a\u8d77\u6765\n        return BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);\n    }\n\n}\n</code></pre> <p>\u57fa\u4e8e\u6ce8\u89e3\u58f0\u660e</p> <pre><code>    @RabbitListener(bindings = @QueueBinding(\n            value = @Queue(name = \"direct.queue1\", durable = \"true\"),\n            exchange = @Exchange(name = \"ysh.direct\", type = ExchangeTypes.DIRECT),\n            key = {\"red\", \"blue\"}\n    ))\n    public void listenWorkQueue3(String message){}  \n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u6d88\u606f\u8f6c\u6362\u5668","title":"\u6d88\u606f\u8f6c\u6362\u5668","text":"<p>Spring\u7684\u6d88\u606f\u53d1\u9001\u4ee3\u7801\u63a5\u6536\u7684\u6d88\u606f\u4f53\u662f\u4e00\u4e2aObject</p> <pre><code>public void convertAndSend(String routingKey, Object object){}\n</code></pre> <p>\u800c\u5728\u6570\u636e\u4f20\u8f93\u65f6\uff0c\u5b83\u4f1a\u628a\u53d1\u9001\u7684\u6d88\u606f\u5e8f\u5217\u5316\u4e3a\u5b57\u8282\u53d1\u9001\u7ed9MQ\uff0c\u63a5\u6536\u6d88\u606f\u7684\u65f6\u5019\uff0c\u8fd8\u4f1a\u628a\u5b57\u8282\u53cd\u5e8f\u5217\u5316\u4e3aJava\u5bf9\u8c61\u3002</p> <p>\u53ea\u4e0d\u8fc7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bSpring\u91c7\u7528\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\u662fJDK\u5e8f\u5217\u5316\u3002JDK\u5e8f\u5217\u5316\u5b58\u5728\u4e0b\u5217\u95ee\u9898\uff1a</p> <ul> <li>\u6570\u636e\u4f53\u79ef\u8fc7\u5927</li> <li>\u6709\u5b89\u5168\u6f0f\u6d1e</li> <li>\u53ef\u8bfb\u6027\u5dee</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528JSON\u65b9\u5f0f\u6765\u4f18\u5316</p> <p>\u5728<code>publisher</code>\u548c<code>consumer</code>\u4e24\u4e2a\u670d\u52a1\u4e2d\u90fd\u5f15\u5165\u4f9d\u8d56\uff1a</p> <pre><code>        &lt;!--Jackson\u4f9d\u8d56\uff0c\u7528\u4e8e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;\n            &lt;version&gt;2.9.10&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre> <p>Note</p> <p>\u6ce8\u610f\uff0c\u5982\u679c\u9879\u76ee\u4e2d\u5f15\u5165\u4e86<code>spring-boot-starter-web</code>\u4f9d\u8d56\uff0c\u5219\u65e0\u9700\u518d\u6b21\u5f15\u5165<code>Jackson</code>\u4f9d\u8d56\u3002</p> <p>\u914d\u7f6e\u6d88\u606f\u8f6c\u6362\u5668\uff0c\u5728<code>publisher</code>\u548c<code>consumer</code>\u4e24\u4e2a\u670d\u52a1\u7684\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0\u4e00\u4e2aBean\u5373\u53ef\uff1a</p> <pre><code>@Bean\npublic MessageConverter messageConverter(){\n    // 1.\u5b9a\u4e49\u6d88\u606f\u8f6c\u6362\u5668\n    Jackson2JsonMessageConverter jackson2JsonMessageConverter = new Jackson2JsonMessageConverter();\n    // 2.\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\u6d88\u606fid\uff0c\u7528\u4e8e\u8bc6\u522b\u4e0d\u540c\u6d88\u606f\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e1a\u52a1\u4e2d\u57fa\u4e8eID\u5224\u65ad\u662f\u5426\u662f\u91cd\u590d\u6d88\u606f\n    jackson2JsonMessageConverter.setCreateMessageIds(true);\n    return jackson2JsonMessageConverter;\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#mq\u9ad8\u7ea7","title":"MQ\u9ad8\u7ea7","text":"<p>\u6d88\u606f\u4ece\u53d1\u9001\u8005\u53d1\u9001\u6d88\u606f\uff0c\u5230\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\uff0c\u9700\u8981\u7ecf\u8fc7\u7684\u6d41\u7a0b\u662f\u8fd9\u6837\u7684</p> <p></p> <p>\u6d88\u606f\u4ece\u751f\u4ea7\u8005\u5230\u6d88\u8d39\u8005\u7684\u6bcf\u4e00\u6b65\u90fd\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u4e22\u5931</p> <p>\u6211\u4eec\u8981\u89e3\u51b3\u6d88\u606f\u4e22\u5931\u95ee\u9898\uff0c\u4fdd\u8bc1MQ\u7684\u53ef\u9760\u6027\uff0c\u5c31\u5fc5\u987b\u4ece3\u4e2a\u65b9\u9762\u5165\u624b\uff1a</p> <ul> <li>\u786e\u4fdd\u751f\u4ea7\u8005\u4e00\u5b9a\u628a\u6d88\u606f\u53d1\u9001\u5230MQ</li> <li>\u786e\u4fddMQ\u4e0d\u4f1a\u5c06\u6d88\u606f\u5f04\u4e22</li> <li>\u786e\u4fdd\u6d88\u8d39\u8005\u4e00\u5b9a\u8981\u5904\u7406\u6d88\u606f</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u751f\u4ea7\u8005\u53ef\u9760\u6027","title":"\u751f\u4ea7\u8005\u53ef\u9760\u6027","text":""},{"location":"SpringCloud/MQ/#\u751f\u4ea7\u8005\u91cd\u8bd5\u673a\u5236","title":"\u751f\u4ea7\u8005\u91cd\u8bd5\u673a\u5236","text":"<p>\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u51fa\u73b0\u4e86\u7f51\u7edc\u6545\u969c\uff0c\u5bfc\u81f4\u4e0eMQ\u7684\u8fde\u63a5\u4e2d\u65ad\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cSpringAMQP\u63d0\u4f9b\u7684\u6d88\u606f\u53d1\u9001\u65f6\u7684\u91cd\u8bd5\u673a\u5236\u3002\u5373\uff1a\u5f53<code>RabbitTemplate</code>\u4e0eMQ\u8fde\u63a5\u8d85\u65f6\u540e\uff0c\u591a\u6b21\u91cd\u8bd5\u3002</p> <p>\u4fee\u6539<code>publisher</code>\u6a21\u5757\u7684<code>application.yaml</code>\u6587\u4ef6\uff0c\u6dfb\u52a0\u4e0b\u9762\u7684\u5185\u5bb9\uff1a</p> <pre><code>spring:\n  rabbitmq:\n    connection-timeout: 1s # \u8bbe\u7f6eMQ\u7684\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n    template:\n      retry:\n        enabled: true # \u5f00\u542f\u8d85\u65f6\u91cd\u8bd5\u673a\u5236\n        initial-interval: 1000ms # \u5931\u8d25\u540e\u7684\u521d\u59cb\u7b49\u5f85\u65f6\u95f4\n        multiplier: 1 # \u5931\u8d25\u540e\u4e0b\u6b21\u7684\u7b49\u5f85\u65f6\u957f\u500d\u6570\uff0c\u4e0b\u6b21\u7b49\u5f85\u65f6\u957f = initial-interval * multiplier\n        max-attempts: 3 # \u6700\u5927\u91cd\u8bd5\u6b21\u6570\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <p>\u5f53\u7f51\u7edc\u4e0d\u7a33\u5b9a\u7684\u65f6\u5019\uff0c\u5229\u7528\u91cd\u8bd5\u673a\u5236\u53ef\u4ee5\u6709\u6548\u63d0\u9ad8\u6d88\u606f\u53d1\u9001\u7684\u6210\u529f\u7387\u3002\u4e0d\u8fc7SpringAMQP\u63d0\u4f9b\u7684\u91cd\u8bd5\u673a\u5236\u662f\u963b\u585e\u5f0f\u7684\u91cd\u8bd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u591a\u6b21\u91cd\u8bd5\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u524d\u7ebf\u7a0b\u662f\u88ab\u963b\u585e\u7684\u3002</p> <p>\u5982\u679c\u5bf9\u4e8e\u4e1a\u52a1\u6027\u80fd\u6709\u8981\u6c42\uff0c\u5efa\u8bae\u7981\u7528\u91cd\u8bd5\u673a\u5236\u3002\u5982\u679c\u4e00\u5b9a\u8981\u4f7f\u7528\uff0c\u8bf7\u5408\u7406\u914d\u7f6e\u7b49\u5f85\u65f6\u957f\u548c\u91cd\u8bd5\u6b21\u6570\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5f02\u6b65\u7ebf\u7a0b\u6765\u6267\u884c\u53d1\u9001\u6d88\u606f\u7684\u4ee3\u7801\u3002</p> <p></p>"},{"location":"SpringCloud/MQ/#\u751f\u4ea7\u8005\u786e\u8ba4\u673a\u5236","title":"\u751f\u4ea7\u8005\u786e\u8ba4\u673a\u5236","text":"<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u751f\u4ea7\u8005\u4e0eMQ\u4e4b\u95f4\u7684\u7f51\u8def\u8fde\u63a5\u987a\u7545\uff0c\u57fa\u672c\u4e0d\u4f1a\u51fa\u73b0\u53d1\u9001\u6d88\u606f\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u65e0\u9700\u8003\u8651\u8fd9\u79cd\u95ee\u9898\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5728\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u4e5f\u4f1a\u51fa\u73b0\u6d88\u606f\u53d1\u9001\u5230MQ\u4e4b\u540e\u4e22\u5931\u7684\u73b0\u8c61\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>MQ\u5185\u90e8\u5904\u7406\u6d88\u606f\u7684\u8fdb\u7a0b\u53d1\u751f\u4e86\u5f02\u5e38</li> <li>\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u5230\u8fbeMQ\u540e\u672a\u627e\u5230<code>Exchange</code></li> <li>\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u5230\u8fbeMQ\u7684<code>Exchange</code>\u540e\uff0c\u672a\u627e\u5230\u5408\u9002\u7684<code>Queue</code>\uff0c\u56e0\u6b64\u65e0\u6cd5\u8def\u7531</li> </ul> <p>\u9488\u5bf9\u4e0a\u8ff0\u60c5\u51b5\uff0cRabbitMQ\u63d0\u4f9b\u4e86\u751f\u4ea7\u8005\u6d88\u606f\u786e\u8ba4\u673a\u5236\uff0c\u5305\u62ec<code>Publisher Confirm</code>\u548c<code>Publisher Return</code>\u4e24\u79cd\u3002</p> <p>\u5728\u5f00\u542f\u786e\u8ba4\u673a\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u5f53\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7ed9MQ\u540e\uff0cMQ\u4f1a\u6839\u636e\u6d88\u606f\u5904\u7406\u7684\u60c5\u51b5\u8fd4\u56de\u4e0d\u540c\u7684\u56de\u6267\u3002</p> <p></p> <ul> <li>\u5f53\u6d88\u606f\u6295\u9012\u5230MQ\uff0c\u4f46\u662f\u8def\u7531\u5931\u8d25\u65f6\uff0c\u901a\u8fc7Publisher Return\u8fd4\u56de\u5f02\u5e38\u4fe1\u606f\uff0c\u540c\u65f6\u8fd4\u56deack\u7684\u786e\u8ba4\u4fe1\u606f\uff0c\u4ee3\u8868\u6295\u9012\u6210\u529f</li> <li>\u4e34\u65f6\u6d88\u606f\u6295\u9012\u5230\u4e86MQ\uff0c\u5e76\u4e14\u5165\u961f\u6210\u529f\uff0c\u8fd4\u56deACK\uff0c\u544a\u77e5\u6295\u9012\u6210\u529f</li> <li>\u6301\u4e45\u6d88\u606f\u6295\u9012\u5230\u4e86MQ\uff0c\u5e76\u4e14\u5165\u961f\u5b8c\u6210\u6301\u4e45\u5316\uff0c\u8fd4\u56deACK \uff0c\u544a\u77e5\u6295\u9012\u6210\u529f</li> <li>\u5176\u5b83\u60c5\u51b5\u90fd\u4f1a\u8fd4\u56deNACK\uff0c\u544a\u77e5\u6295\u9012\u5931\u8d25</li> </ul> <p>\u5f00\u542f\u751f\u4ea7\u8005\u786e\u8ba4\u673a\u5236\uff1a</p> <p>\u5728publisher\u6a21\u5757\u7684<code>application.yaml</code>\u4e2d\u6dfb\u52a0\u914d\u7f6e\uff1a</p> <pre><code>spring:\n  rabbitmq:\n    publisher-confirm-type: correlated # \u5f00\u542fpublisher confirm\u673a\u5236\uff0c\u5e76\u8bbe\u7f6econfirm\u7c7b\u578b\n    publisher-returns: true # \u5f00\u542fpublisher return\u673a\u5236\n</code></pre> <p>\u8fd9\u91cc<code>publisher-confirm-type</code>\u6709\u4e09\u79cd\u6a21\u5f0f\u53ef\u9009\uff1a</p> <ul> <li><code>none</code>\uff1a\u5173\u95edconfirm\u673a\u5236</li> <li><code>simple</code>\uff1a\u540c\u6b65\u963b\u585e\u7b49\u5f85MQ\u7684\u56de\u6267</li> <li><code>correlated</code>\uff1aMQ\u5f02\u6b65\u56de\u8c03\u8fd4\u56de\u56de\u6267</li> </ul> <p>Tip</p> <p>\u4e00\u822c\u63a8\u8350\u4f7f\u7528<code>correlated</code>\uff0c\u56de\u8c03\u673a\u5236\u3002</p> <p>\u5b9a\u4e49ReturnCallback</p> <p>\u6bcf\u4e2a<code>RabbitTemplate</code>\u53ea\u80fd\u914d\u7f6e\u4e00\u4e2a<code>ReturnCallback</code>\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5728\u914d\u7f6e\u7c7b\u4e2d\u7edf\u4e00\u8bbe\u7f6e</p> <pre><code>@Slf4j\n@AllArgsConstructor\n@Configuration\npublic class MqConfig {\n    private final RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init(){\n        rabbitTemplate.setReturnsCallback(new RabbitTemplate.ReturnsCallback() {\n            @Override\n            public void returnedMessage(ReturnedMessage returned) {\n                log.error(\"\u89e6\u53d1return callback,\");\n                log.debug(\"exchange: {}\", returned.getExchange());\n                log.debug(\"routingKey: {}\", returned.getRoutingKey());\n                log.debug(\"message: {}\", returned.getMessage());\n                log.debug(\"replyCode: {}\", returned.getReplyCode());\n                log.debug(\"replyText: {}\", returned.getReplyText());\n            }\n        });\n    }\n}\n</code></pre> <p>\u5b9a\u4e49ConfirmCallback</p> <p>\u7531\u4e8e\u6bcf\u4e2a\u6d88\u606f\u53d1\u9001\u65f6\u7684\u5904\u7406\u903b\u8f91\u4e0d\u4e00\u5b9a\u76f8\u540c\uff0c\u56e0\u6b64ConfirmCallback\u9700\u8981\u5728\u6bcf\u6b21\u53d1\u6d88\u606f\u65f6\u5b9a\u4e49\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u662f\u5728\u8c03\u7528RabbitTemplate\u4e2d\u7684convertAndSend\u65b9\u6cd5\u65f6\uff0c\u591a\u4f20\u9012\u4e00\u4e2a\u53c2\u6570\uff1a</p> <pre><code>    public void convertAndSend(String exchange, String routingKey, Object object, @Nullable CorrelationData correlationData){}\n</code></pre> <p>\u8fd9\u91cc\u7684CorrelationData\u4e2d\u5305\u542b\u4e24\u4e2a\u6838\u5fc3\u7684\u4e1c\u897f\uff1a</p> <ul> <li><code>id</code>\uff1a\u6d88\u606f\u7684\u552f\u4e00\u6807\u793a\uff0cMQ\u5bf9\u4e0d\u540c\u7684\u6d88\u606f\u7684\u56de\u6267\u4ee5\u6b64\u505a\u5224\u65ad\uff0c\u907f\u514d\u6df7\u6dc6</li> <li><code>SettableListenableFuture</code>\uff1a\u56de\u6267\u7ed3\u679c\u7684Future\u5bf9\u8c61</li> </ul> <p>\u5c06\u6765MQ\u7684\u56de\u6267\u5c31\u4f1a\u901a\u8fc7\u8fd9\u4e2a<code>Future</code>\u6765\u8fd4\u56de\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u7ed9<code>CorrelationData</code>\u4e2d\u7684<code>Future</code>\u6dfb\u52a0\u56de\u8c03\u51fd\u6570\u6765\u5904\u7406\u6d88\u606f\u56de\u6267</p> <pre><code>    // 1.\u521b\u5efaCorrelationData\n    CorrelationData cd = new CorrelationData();\n    // 2.\u7ed9Future\u6dfb\u52a0ConfirmCallback\n    cd.getFuture().addCallback(new ListenableFutureCallback&lt;CorrelationData.Confirm&gt;() {\n        @Override\n        public void onFailure(Throwable ex) {\n            // 2.1.Future\u53d1\u751f\u5f02\u5e38\u65f6\u7684\u5904\u7406\u903b\u8f91\uff0c\u57fa\u672c\u4e0d\u4f1a\u89e6\u53d1\n            log.error(\"send message fail\", ex);\n        }\n        @Override\n        public void onSuccess(CorrelationData.Confirm result) {\n            // 2.2.Future\u63a5\u6536\u5230\u56de\u6267\u7684\u5904\u7406\u903b\u8f91\uff0c\u53c2\u6570\u4e2d\u7684result\u5c31\u662f\u56de\u6267\u5185\u5bb9\n            if(result.isAck()){ // result.isAck()\uff0cboolean\u7c7b\u578b\uff0ctrue\u4ee3\u8868ack\u56de\u6267\uff0cfalse \u4ee3\u8868 nack\u56de\u6267\n                log.debug(\"\u53d1\u9001\u6d88\u606f\u6210\u529f\uff0c\u6536\u5230 ack!\");\n            }else{ // result.getReason()\uff0cString\u7c7b\u578b\uff0c\u8fd4\u56denack\u65f6\u7684\u5f02\u5e38\u63cf\u8ff0\n                log.error(\"\u53d1\u9001\u6d88\u606f\u5931\u8d25\uff0c\u6536\u5230 nack, reason : {}\", result.getReason());\n            }\n        }\n    });\n    // 3.\u53d1\u9001\u6d88\u606f\n    rabbitTemplate.convertAndSend(\"hmall.direct\", \"q\", \"hello\", cd);\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5f00\u542f\u751f\u4ea7\u8005\u786e\u8ba4\u6bd4\u8f83\u6d88\u8017MQ\u6027\u80fd\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5f00\u542f\u3002\u800c\u4e14\u5927\u5bb6\u601d\u8003\u4e00\u4e0b\u89e6\u53d1\u786e\u8ba4\u7684\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u8def\u7531\u5931\u8d25\uff1a\u4e00\u822c\u662f\u56e0\u4e3aRoutingKey\u9519\u8bef\u5bfc\u81f4\uff0c\u5f80\u5f80\u662f\u7f16\u7a0b\u5bfc\u81f4</li> <li>\u4ea4\u6362\u673a\u540d\u79f0\u9519\u8bef\uff1a\u540c\u6837\u662f\u7f16\u7a0b\u9519\u8bef\u5bfc\u81f4</li> <li>MQ\u5185\u90e8\u6545\u969c\uff1a\u8fd9\u79cd\u9700\u8981\u5904\u7406\uff0c\u4f46\u6982\u7387\u5f80\u5f80\u8f83\u4f4e\u3002\u56e0\u6b64\u53ea\u6709\u5bf9\u6d88\u606f\u53ef\u9760\u6027\u8981\u6c42\u975e\u5e38\u9ad8\u7684\u4e1a\u52a1\u624d\u9700\u8981\u5f00\u542f\uff0c\u800c\u4e14\u4ec5\u4ec5\u9700\u8981\u5f00\u542fConfirmCallback\u5904\u7406nack\u5c31\u53ef\u4ee5\u4e86\u3002</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#mq\u7684\u53ef\u9760\u6027","title":"MQ\u7684\u53ef\u9760\u6027","text":"<p>\u6d88\u606f\u5230\u8fbeMQ\u4ee5\u540e\uff0c\u5982\u679cMQ\u4e0d\u80fd\u53ca\u65f6\u4fdd\u5b58\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\uff0c\u6240\u4ee5MQ\u7684\u53ef\u9760\u6027\u4e5f\u975e\u5e38\u91cd\u8981\u3002</p>"},{"location":"SpringCloud/MQ/#\u6570\u636e\u6301\u4e45\u5316","title":"\u6570\u636e\u6301\u4e45\u5316","text":"<p>\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bMQ\u7684\u6570\u636e\u90fd\u662f\u5728\u5185\u5b58\u5b58\u50a8\u7684\u4e34\u65f6\u6570\u636e\uff0c\u91cd\u542f\u540e\u5c31\u4f1a\u6d88\u5931\u3002\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\uff0c\u5fc5\u987b\u914d\u7f6e\u6570\u636e\u6301\u4e45\u5316\uff0c\u5305\u62ec\uff1a</p> <ul> <li>\u4ea4\u6362\u673a\u6301\u4e45\u5316</li> <li>\u961f\u5217\u6301\u4e45\u5316</li> <li>\u6d88\u606f\u6301\u4e45\u5316</li> </ul> <p>Tip</p> <p>\u5728\u63a7\u5236\u53f0\u6dfb\u52a0\u4ea4\u6362\u673a\u3001\u961f\u5217\u3001\u6d88\u606f\u65f6\uff0c\u53ef\u4ee5\u914d\u7f6e<code>Durability</code>\u53c2\u6570\u5b9e\u73b0\u6301\u4e45\u5316</p> <p>\u5728\u4ee3\u7801\u4e2d\u9700\u8981\u81ea\u5b9a\u4e49\u6d88\u606f\u6765\u5b9e\u73b0\u6d88\u606f\u6301\u4e45\u5316</p> <pre><code>        Message message = MessageBuilder\n                .withBody(\"\u6d88\u606f\".getBytes(StandardCharsets.UTF_8))\n                .setDeliveryMode(MessageDeliveryMode.PERSISTENT)\n                .build();\n</code></pre> <p>\u8bf4\u660e\uff1a</p> <p>\u5728\u5f00\u542f\u6301\u4e45\u5316\u673a\u5236\u4ee5\u540e\uff0c\u5982\u679c\u540c\u65f6\u8fd8\u5f00\u542f\u4e86\u751f\u4ea7\u8005\u786e\u8ba4\uff0c\u90a3\u4e48MQ\u4f1a\u5728\u6d88\u606f\u6301\u4e45\u5316\u4ee5\u540e\u624d\u53d1\u9001ACK\u56de\u6267\uff0c\u8fdb\u4e00\u6b65\u786e\u4fdd\u6d88\u606f\u7684\u53ef\u9760\u6027\u3002</p> <p>\u4e0d\u8fc7\u51fa\u4e8e\u6027\u80fd\u8003\u8651\uff0c\u4e3a\u4e86\u51cf\u5c11IO\u6b21\u6570\uff0c\u53d1\u9001\u5230MQ\u7684\u6d88\u606f\u5e76\u4e0d\u662f\u9010\u6761\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\u7684\uff0c\u800c\u662f\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6279\u91cf\u6301\u4e45\u5316\u3002\u4e00\u822c\u95f4\u9694\u5728100\u6beb\u79d2\u5de6\u53f3\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4ACK\u6709\u4e00\u5b9a\u7684\u5ef6\u8fdf\uff0c\u56e0\u6b64\u5efa\u8bae\u751f\u4ea7\u8005\u786e\u8ba4\u5168\u90e8\u91c7\u7528\u5f02\u6b65\u65b9\u5f0f\u3002</p> <p></p>"},{"location":"SpringCloud/MQ/#lazyqueue","title":"LazyQueue","text":"<p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRabbitMQ\u4f1a\u5c06\u63a5\u6536\u5230\u7684\u4fe1\u606f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u4ee5\u964d\u4f4e\u6d88\u606f\u6536\u53d1\u7684\u5ef6\u8fdf\u3002\u4f46\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u6d88\u606f\u79ef\u538b\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u6d88\u8d39\u8005\u5b95\u673a\u6216\u51fa\u73b0\u7f51\u7edc\u6545\u969c</li> <li>\u6d88\u606f\u53d1\u9001\u91cf\u6fc0\u589e\uff0c\u8d85\u8fc7\u4e86\u6d88\u8d39\u8005\u5904\u7406\u901f\u5ea6</li> <li>\u6d88\u8d39\u8005\u5904\u7406\u4e1a\u52a1\u53d1\u751f\u963b\u585e</li> </ul> <p>\u4e00\u65e6\u51fa\u73b0\u6d88\u606f\u5806\u79ef\u95ee\u9898\uff0cRabbitMQ\u7684\u5185\u5b58\u5360\u7528\u5c31\u4f1a\u8d8a\u6765\u8d8a\u9ad8\uff0c\u76f4\u5230\u89e6\u53d1\u5185\u5b58\u9884\u8b66\u4e0a\u9650\u3002\u6b64\u65f6RabbitMQ\u4f1a\u5c06\u5185\u5b58\u6d88\u606f\u5237\u5230\u78c1\u76d8\u4e0a\uff0c\u8fd9\u4e2a\u884c\u4e3a\u6210\u4e3a<code>PageOut</code>. <code>PageOut</code>\u4f1a\u8017\u8d39\u4e00\u6bb5\u65f6\u95f4\uff0c\u5e76\u4e14\u4f1a\u963b\u585e\u961f\u5217\u8fdb\u7a0b\u3002\u56e0\u6b64\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2dRabbitMQ\u4e0d\u4f1a\u518d\u5904\u7406\u65b0\u7684\u6d88\u606f\uff0c\u751f\u4ea7\u8005\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4eceRabbitMQ\u76843.6.0\u7248\u672c\u5f00\u59cb\uff0c\u5c31\u589e\u52a0\u4e86<code>Lazy Queue</code>\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u60f0\u6027\u961f\u5217\u3002</p> <p>\u60f0\u6027\u961f\u5217\u7684\u7279\u5f81\u5982\u4e0b\uff1a</p> <ul> <li>\u63a5\u6536\u5230\u6d88\u606f\u540e\u76f4\u63a5\u5b58\u5165\u78c1\u76d8\u800c\u975e\u5185\u5b58</li> <li>\u6d88\u8d39\u8005\u8981\u6d88\u8d39\u6d88\u606f\u65f6\u624d\u4f1a\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\uff08\u4e5f\u5c31\u662f\u61d2\u52a0\u8f7d\uff09</li> <li>\u652f\u6301\u6570\u767e\u4e07\u6761\u7684\u6d88\u606f\u5b58\u50a8</li> </ul> <p>Info</p> <p>\u57283.12\u7248\u672c\u4e4b\u540e\uff0cLazyQueue\u5df2\u7ecf\u6210\u4e3a\u6240\u6709\u961f\u5217\u7684\u9ed8\u8ba4\u683c\u5f0f\u3002\u56e0\u6b64\u5b98\u65b9\u63a8\u8350\u5347\u7ea7MQ\u4e3a3.12\u7248\u672c\u6216\u8005\u6240\u6709\u961f\u5217\u90fd\u8bbe\u7f6e\u4e3aLazyQueue\u6a21\u5f0f\u3002</p> <p>\u63a7\u5236\u53f0\u914d\u7f6eLazy\u6a21\u5f0f</p> <p>\u5728\u6dfb\u52a0\u961f\u5217\u7684\u65f6\u5019\uff0c\u6dfb\u52a0<code>x-queue-mod=lazy</code>\u53c2\u6570\u5373\u53ef\u8bbe\u7f6e\u961f\u5217\u4e3aLazy\u6a21\u5f0f</p> <p>\u4ee3\u7801\u914d\u7f6eLazy\u6a21\u5f0f</p> <pre><code>// \u57fa\u4e8eJavaBean\n@Bean\npublic Queue lazyQueue(){\n    return QueueBuilder\n            .durable(\"lazy.queue\")\n            .lazy() // \u5f00\u542fLazy\u6a21\u5f0f\n            .build();\n}\n\n// \u57fa\u4e8e\u6ce8\u89e3\n@RabbitListener(queuesToDeclare = @Queue(\n        name = \"lazy.queue\",\n        durable = \"true\",\n        arguments = @Argument(name = \"x-queue-mode\", value = \"lazy\")\n))\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u6d88\u8d39\u8005\u53ef\u9760\u6027","title":"\u6d88\u8d39\u8005\u53ef\u9760\u6027","text":"<p>\u5f53RabbitMQ\u5411\u6d88\u8d39\u8005\u6295\u9012\u6d88\u606f\u4ee5\u540e\uff0c\u9700\u8981\u77e5\u9053\u6d88\u8d39\u8005\u7684\u5904\u7406\u72b6\u6001\u5982\u4f55\u3002\u56e0\u4e3a\u6d88\u606f\u6295\u9012\u7ed9\u6d88\u8d39\u8005\u5e76\u4e0d\u4ee3\u8868\u5c31\u4e00\u5b9a\u88ab\u6b63\u786e\u6d88\u8d39\u4e86\uff0c\u53ef\u80fd\u51fa\u73b0\u7684\u6545\u969c\u6709\u5f88\u591a\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u6d88\u606f\u6295\u9012\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u7f51\u7edc\u6545\u969c</li> <li>\u6d88\u8d39\u8005\u63a5\u6536\u5230\u6d88\u606f\u540e\u7a81\u7136\u5b95\u673a</li> <li>\u6d88\u8d39\u8005\u63a5\u6536\u5230\u6d88\u606f\u540e\uff0c\u56e0\u5904\u7406\u4e0d\u5f53\u5bfc\u81f4\u5f02\u5e38</li> <li>...</li> </ul> <p>\u4e00\u65e6\u53d1\u751f\u4e0a\u8ff0\u60c5\u51b5\uff0c\u6d88\u606f\u4e5f\u4f1a\u4e22\u5931\u3002\u56e0\u6b64\uff0cRabbitMQ\u5fc5\u987b\u77e5\u9053\u6d88\u8d39\u8005\u7684\u5904\u7406\u72b6\u6001\uff0c\u4e00\u65e6\u6d88\u606f\u5904\u7406\u5931\u8d25\u624d\u80fd\u91cd\u65b0\u6295\u9012\u6d88\u606f\u3002</p>"},{"location":"SpringCloud/MQ/#\u6d88\u8d39\u8005\u786e\u8ba4\u673a\u5236","title":"\u6d88\u8d39\u8005\u786e\u8ba4\u673a\u5236","text":"<p>\u4e3a\u4e86\u786e\u8ba4\u6d88\u8d39\u8005\u662f\u5426\u6210\u529f\u5904\u7406\u6d88\u606f\uff0cRabbitMQ\u63d0\u4f9b\u4e86\u6d88\u8d39\u8005\u786e\u8ba4\u673a\u5236\uff08Consumer Acknowledgement\uff09\u3002</p> <p>\u5373\uff1a\u5f53\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7ed3\u675f\u540e\uff0c\u5e94\u8be5\u5411RabbitMQ\u53d1\u9001\u4e00\u4e2a\u56de\u6267\uff0c\u544a\u77e5RabbitMQ\u81ea\u5df1\u7684\u6d88\u606f\u5904\u7406\u72b6\u6001\u3002</p> <p>\u56de\u6267\u6709\u4e09\u79cd\u53ef\u9009\u503c\uff1a</p> <ul> <li>ack\uff1a\u6210\u529f\u5904\u7406\u6d88\u606f\uff0cRabbitMQ\u4ece\u961f\u5217\u4e2d\u5220\u9664\u8be5\u6d88\u606f</li> <li>nack\uff1a\u6d88\u606f\u5904\u7406\u5931\u8d25\uff0cRabbitMQ\u9700\u8981\u518d\u6b21\u6295\u9012\u6d88\u606f</li> <li>reject\uff1a\u6d88\u606f\u5904\u7406\u5931\u8d25\u5e76\u62d2\u7edd\u8be5\u6d88\u606f\uff0cRabbitMQ\u4ece\u961f\u5217\u4e2d\u5220\u9664\u8be5\u6d88\u606f</li> </ul> <p></p> <p>\u7531\u4e8e\u6d88\u606f\u56de\u6267\u7684\u5904\u7406\u4ee3\u7801\u6bd4\u8f83\u7edf\u4e00\uff0c\u56e0\u6b64SpringAMQP\u5e2e\u6211\u4eec\u5b9e\u73b0\u4e86\u6d88\u606f\u786e\u8ba4\u3002\u5e76\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6eACK\u5904\u7406\u65b9\u5f0f\uff0c\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li><code>none</code>\uff1a\u4e0d\u5904\u7406\u3002\u5373\u6d88\u606f\u6295\u9012\u7ed9\u6d88\u8d39\u8005\u540e\u7acb\u523back\uff0c\u6d88\u606f\u4f1a\u7acb\u523b\u4eceMQ\u5220\u9664\u3002\u975e\u5e38\u4e0d\u5b89\u5168\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528</li> <li><code>manual</code>\uff1a\u624b\u52a8\u6a21\u5f0f\u3002\u9700\u8981\u81ea\u5df1\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u8c03\u7528api\uff0c\u53d1\u9001<code>ack</code>\u6216<code>reject</code>\uff0c\u5b58\u5728\u4e1a\u52a1\u5165\u4fb5\uff0c\u4f46\u66f4\u7075\u6d3b</li> <li><code>auto</code>\uff1a(\u63a8\u8350)\u81ea\u52a8\u6a21\u5f0f\u3002SpringAMQP\u5229\u7528AOP\u5bf9\u6211\u4eec\u7684\u6d88\u606f\u5904\u7406\u903b\u8f91\u505a\u4e86\u73af\u7ed5\u589e\u5f3a\uff0c\u5f53\u4e1a\u52a1\u6b63\u5e38\u6267\u884c\u65f6\u5219\u81ea\u52a8\u8fd4\u56de<code>ack</code>.  \u5f53\u4e1a\u52a1\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u6839\u636e\u5f02\u5e38\u5224\u65ad\u8fd4\u56de\u4e0d\u540c\u7ed3\u679c\uff1a<ul> <li>\u5982\u679c\u662f\u4e1a\u52a1\u5f02\u5e38\uff0c\u4f1a\u81ea\u52a8\u8fd4\u56de<code>nack</code>\uff1b</li> <li>\u5982\u679c\u662f\u6d88\u606f\u5904\u7406\u6216\u6821\u9a8c\u5f02\u5e38\uff0c\u81ea\u52a8\u8fd4\u56de<code>reject</code>;</li> </ul> </li> </ul> <pre><code>spring:\n  rabbitmq:\n    listener:\n      simple:\n        acknowledge-mode: auto # \u4e0d\u505a\u5904\u7406\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u5931\u8d25\u91cd\u8bd5\u673a\u5236","title":"\u5931\u8d25\u91cd\u8bd5\u673a\u5236","text":"<p>\u5f53\u6d88\u8d39\u8005\u51fa\u73b0\u5f02\u5e38\u540e\uff0c\u6d88\u606f\u4f1a\u4e0d\u65adrequeue\uff08\u91cd\u5165\u961f\uff09\u5230\u961f\u5217\uff0c\u518d\u91cd\u65b0\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\u3002\u5982\u679c\u6d88\u8d39\u8005\u518d\u6b21\u6267\u884c\u4f9d\u7136\u51fa\u9519\uff0c\u6d88\u606f\u4f1a\u518d\u6b21requeue\u5230\u961f\u5217\uff0c\u518d\u6b21\u6295\u9012\uff0c\u76f4\u5230\u6d88\u606f\u5904\u7406\u6210\u529f\u4e3a\u6b62\u3002</p> <p>\u6781\u7aef\u60c5\u51b5\u5c31\u662f\u6d88\u8d39\u8005\u4e00\u76f4\u65e0\u6cd5\u6267\u884c\u6210\u529f\uff0c\u90a3\u4e48\u6d88\u606frequeue\u5c31\u4f1a\u65e0\u9650\u5faa\u73af\uff0c\u5bfc\u81f4mq\u7684\u6d88\u606f\u5904\u7406\u98d9\u5347\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u538b\u529b\u3002</p> <p>\u4e3a\u4e86\u5e94\u5bf9\u4e0a\u8ff0\u60c5\u51b5RabbitMQ\u53c8\u63d0\u4f9b\u4e86\u6d88\u8d39\u8005\u5931\u8d25\u91cd\u8bd5\u673a\u5236\uff1a\u5728\u6d88\u8d39\u8005\u51fa\u73b0\u5f02\u5e38\u65f6\u5229\u7528\u672c\u5730\u91cd\u8bd5\uff0c\u800c\u4e0d\u662f\u65e0\u9650\u5236\u7684requeue\u5230mq\u961f\u5217\u3002</p> <p>\u4fee\u6539\u914d\u7f6e\u5f00\u542f\u8be5\u673a\u5236:</p> <pre><code>spring:\n  rabbitmq:\n    listener:\n      simple:\n        retry:\n          enabled: true # \u5f00\u542f\u6d88\u8d39\u8005\u5931\u8d25\u91cd\u8bd5\n          initial-interval: 1000ms # \u521d\u59cb\u7684\u5931\u8d25\u7b49\u5f85\u65f6\u957f\u4e3a1\u79d2\n          multiplier: 1 # \u5931\u8d25\u7684\u7b49\u5f85\u65f6\u957f\u500d\u6570\uff0c\u4e0b\u6b21\u7b49\u5f85\u65f6\u957f = multiplier * last-interval\n          max-attempts: 3 # \u6700\u5927\u91cd\u8bd5\u6b21\u6570\n          stateless: true # true\u65e0\u72b6\u6001\uff1bfalse\u6709\u72b6\u6001\u3002\u5982\u679c\u4e1a\u52a1\u4e2d\u5305\u542b\u4e8b\u52a1\uff0c\u8fd9\u91cc\u6539\u4e3afalse\n</code></pre> <p>\u7ed3\u8bba\uff1a</p> <ul> <li>\u5f00\u542f\u672c\u5730\u91cd\u8bd5\u65f6\uff0c\u6d88\u606f\u5904\u7406\u8fc7\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\uff0c\u4e0d\u4f1arequeue\u5230\u961f\u5217\uff0c\u800c\u662f\u5728\u6d88\u8d39\u8005\u672c\u5730\u91cd\u8bd5</li> <li>\u91cd\u8bd5\u8fbe\u5230\u6700\u5927\u6b21\u6570\u540e\uff0cSpring\u4f1a\u8fd4\u56dereject\uff0c\u6d88\u606f\u4f1a\u88ab\u4e22\u5f03</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u5931\u8d25\u6d88\u606f\u5904\u7406\u7b56\u7565","title":"\u5931\u8d25\u6d88\u606f\u5904\u7406\u7b56\u7565","text":"<p>\u5728\u4e4b\u524d\u7684\u673a\u5236\u4e2d\uff0c\u672c\u5730\u6d4b\u8bd5\u8fbe\u5230\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u540e\uff0c\u6d88\u606f\u4f1a\u88ab\u4e22\u5f03\u3002\u8fd9\u5728\u67d0\u4e9b\u5bf9\u4e8e\u6d88\u606f\u53ef\u9760\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u663e\u7136\u4e0d\u592a\u5408\u9002\u3002</p> <p>\u56e0\u6b64Spring\u5141\u8bb8\u6211\u4eec\u81ea\u5b9a\u4e49\u91cd\u8bd5\u6b21\u6570\u8017\u5c3d\u540e\u7684\u6d88\u606f\u5904\u7406\u7b56\u7565\uff0c\u8fd9\u4e2a\u7b56\u7565\u662f\u7531<code>MessageRecovery</code>\u63a5\u53e3\u6765\u5b9a\u4e49\u7684\uff0c\u5b83\u67093\u4e2a\u4e0d\u540c\u5b9e\u73b0\uff1a</p> <ul> <li><code>RejectAndDontRequeueRecoverer</code>\uff1a\u91cd\u8bd5\u8017\u5c3d\u540e\uff0c\u76f4\u63a5<code>reject</code>\uff0c\u4e22\u5f03\u6d88\u606f\u3002\u9ed8\u8ba4\u5c31\u662f\u8fd9\u79cd\u65b9\u5f0f </li> <li><code>ImmediateRequeueMessageRecoverer</code>\uff1a\u91cd\u8bd5\u8017\u5c3d\u540e\uff0c\u8fd4\u56de<code>nack</code>\uff0c\u6d88\u606f\u91cd\u65b0\u5165\u961f </li> <li><code>RepublishMessageRecoverer</code>\uff1a\u91cd\u8bd5\u8017\u5c3d\u540e\uff0c\u5c06\u5931\u8d25\u6d88\u606f\u6295\u9012\u5230**\u6307\u5b9a\u7684\u4ea4\u6362\u673a **</li> </ul> <p>\u6bd4\u8f83\u5408\u7406\u7684\u4e00\u79cd\u5904\u7406\u65b9\u6848\u662f<code>RepublishMessageRecoverer</code>\uff0c\u5931\u8d25\u540e\u5c06\u6d88\u606f\u6295\u9012\u5230\u4e00\u4e2a\u6307\u5b9a\u7684\uff0c\u4e13\u95e8\u5b58\u653e\u5f02\u5e38\u6d88\u606f\u7684\u961f\u5217\uff0c\u540e\u7eed\u7531\u4eba\u5de5\u96c6\u4e2d\u5904\u7406\u3002</p> <p>1.\u9996\u5148\u5728consumer\u670d\u52a1\u4e2d\u5b9a\u4e49\u5904\u7406\u5931\u8d25\u6d88\u606f\u7684\u4ea4\u6362\u673a\u548c\u961f\u5217</p> <pre><code>@Bean\npublic DirectExchange errorMessageExchange(){\n    return new DirectExchange(\"error.direct\");\n}\n@Bean\npublic Queue errorQueue(){\n    return new Queue(\"error.queue\", true);\n}\n@Bean\npublic Binding errorBinding(Queue errorQueue, DirectExchange errorMessageExchange){\n    return BindingBuilder.bind(errorQueue).to(errorMessageExchange).with(\"error\");\n}\n</code></pre> <p>2.\u5b9a\u4e49\u4e00\u4e2aRepublishMessageRecoverer\uff0c\u5173\u8054\u961f\u5217\u548c\u4ea4\u6362\u673a</p> <pre><code>@Bean\npublic MessageRecoverer republishMessageRecoverer(RabbitTemplate rabbitTemplate){\n    return new RepublishMessageRecoverer(rabbitTemplate, \"error.direct\", \"error\");\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u4e1a\u52a1\u5e42\u7b49\u6027","title":"\u4e1a\u52a1\u5e42\u7b49\u6027","text":"<p>\u5e42\u7b49\u662f\u4e00\u4e2a\u6570\u5b66\u6982\u5ff5\uff0c\u7528\u51fd\u6570\u8868\u8fbe\u5f0f\u6765\u63cf\u8ff0\u662f\u8fd9\u6837\u7684\uff1a<code>f(x) = f(f(x))</code>\uff0c\u4f8b\u5982\u6c42\u7edd\u5bf9\u503c\u51fd\u6570\u3002</p> <p>\u5728\u7a0b\u5e8f\u5f00\u53d1\u4e2d\uff0c\u5219\u662f\u6307\u540c\u4e00\u4e2a\u4e1a\u52a1\uff0c\u6267\u884c\u4e00\u6b21\u6216\u591a\u6b21\u5bf9\u4e1a\u52a1\u72b6\u6001\u7684\u5f71\u54cd\u662f\u4e00\u81f4\u7684\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u6839\u636eid\u5220\u9664\u6570\u636e</li> <li>\u67e5\u8be2\u6570\u636e</li> <li>\u65b0\u589e\u6570\u636e</li> </ul> <p></p> <p>\u4f46\u6570\u636e\u7684\u66f4\u65b0\u5f80\u5f80\u4e0d\u662f\u5e42\u7b49\u7684\uff0c\u5982\u679c\u91cd\u590d\u6267\u884c\u53ef\u80fd\u9020\u6210\u4e0d\u4e00\u6837\u7684\u540e\u679c\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u53d6\u6d88\u8ba2\u5355\uff0c\u6062\u590d\u5e93\u5b58\u7684\u4e1a\u52a1\u3002\u5982\u679c\u591a\u6b21\u6062\u590d\u5c31\u4f1a\u51fa\u73b0\u5e93\u5b58\u91cd\u590d\u589e\u52a0\u7684\u60c5\u51b5</li> <li>\u9000\u6b3e\u4e1a\u52a1\u3002\u91cd\u590d\u9000\u6b3e\u5bf9\u5546\u5bb6\u800c\u8a00\u4f1a\u6709\u7ecf\u6d4e\u635f\u5931\u3002</li> </ul> <p></p> <p>\u7136\u800c\u5728\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u7531\u4e8e\u610f\u5916\u7ecf\u5e38\u4f1a\u51fa\u73b0\u4e1a\u52a1\u88ab\u91cd\u590d\u6267\u884c\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u9875\u9762\u5361\u987f\u65f6\u9891\u7e41\u5237\u65b0\u5bfc\u81f4\u8868\u5355\u91cd\u590d\u63d0\u4ea4</li> <li>\u670d\u52a1\u95f4\u8c03\u7528\u7684\u91cd\u8bd5</li> <li>MQ\u6d88\u606f\u7684\u91cd\u590d\u6295\u9012</li> </ul> <p></p> <p>\u5fc5\u987b\u4fdd\u8bc1\u6d88\u606f\u5904\u7406\u7684\u5e42\u7b49\u6027\u3002\u8fd9\u91cc\u7ed9\u51fa\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u552f\u4e00\u6d88\u606fID</li> <li>\u4e1a\u52a1\u72b6\u6001\u5224\u65ad</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u552f\u4e00\u6d88\u606fid","title":"\u552f\u4e00\u6d88\u606fID","text":"<ol> <li>\u6bcf\u4e00\u6761\u6d88\u606f\u90fd\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684id\uff0c\u4e0e\u6d88\u606f\u4e00\u8d77\u6295\u9012\u7ed9\u6d88\u8d39\u8005\u3002</li> <li>\u6d88\u8d39\u8005\u63a5\u6536\u5230\u6d88\u606f\u540e\u5904\u7406\u81ea\u5df1\u7684\u4e1a\u52a1\uff0c\u4e1a\u52a1\u5904\u7406\u6210\u529f\u540e\u5c06\u6d88\u606fID\u4fdd\u5b58\u5230\u6570\u636e\u5e93</li> <li>\u5982\u679c\u4e0b\u6b21\u53c8\u6536\u5230\u76f8\u540c\u6d88\u606f\uff0c\u5148\u53bb\u6570\u636e\u5e93\u67e5\u8be2\u5224\u65ad\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u5219\u4e3a\u91cd\u590d\u6d88\u606f\u653e\u5f03\u5904\u7406\u3002</li> </ol> <p>SpringAMQP\u7684MessageConverter\u81ea\u5e26\u4e86MessageID\u7684\u529f\u80fd\uff0c\u53ea\u8981\u5f00\u542f\u8fd9\u4e2a\u529f\u80fd\u5373\u53ef\u3002</p> <p>\u4ee5Jackson\u7684\u6d88\u606f\u8f6c\u6362\u5668\u4e3a\u4f8b\uff08\u751f\u4ea7\u8005\uff09\uff1a</p> <pre><code>@Bean\npublic MessageConverter messageConverter(){\n    // 1.\u5b9a\u4e49\u6d88\u606f\u8f6c\u6362\u5668\n    Jackson2JsonMessageConverter jjmc = new Jackson2JsonMessageConverter();\n    // 2.\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\u6d88\u606fid\uff0c\u7528\u4e8e\u8bc6\u522b\u4e0d\u540c\u6d88\u606f\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e1a\u52a1\u4e2d\u57fa\u4e8eID\u5224\u65ad\u662f\u5426\u662f\u91cd\u590d\u6d88\u606f\n    jjmc.setCreateMessageIds(true);\n    return jjmc;\n}\n</code></pre> <p>\u6d88\u8d39\u8005\u5f97\u5230\u6d88\u606fID</p> <pre><code>    public void listen(Message message){\n        String messageId = message.getMessageProperties().getMessageId();\n    }\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u4e1a\u52a1\u72b6\u6001\u5224\u65ad","title":"\u4e1a\u52a1\u72b6\u6001\u5224\u65ad","text":"<p>\u4e1a\u52a1\u5224\u65ad\u5c31\u662f\u57fa\u4e8e\u4e1a\u52a1\u672c\u8eab\u7684\u903b\u8f91\u6216\u72b6\u6001\u6765\u5224\u65ad\u662f\u5426\u662f\u91cd\u590d\u7684\u8bf7\u6c42\u6216\u6d88\u606f\uff0c\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\u5224\u65ad\u7684\u601d\u8def\u4e5f\u4e0d\u4e00\u6837\u3002</p> <p>\u4f8b\u5982\u5f53\u524d\u6848\u4f8b\u4e2d\uff0c\u5904\u7406\u6d88\u606f\u7684\u4e1a\u52a1\u903b\u8f91\u662f\u628a\u8ba2\u5355\u72b6\u6001\u4ece\u672a\u652f\u4ed8\u4fee\u6539\u4e3a\u5df2\u652f\u4ed8\u3002\u56e0\u6b64\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u6267\u884c\u4e1a\u52a1\u65f6\u5224\u65ad\u8ba2\u5355\u72b6\u6001\u662f\u5426\u662f\u672a\u652f\u4ed8\uff0c\u5982\u679c\u4e0d\u662f\u5219\u8bc1\u660e\u8ba2\u5355\u5df2\u7ecf\u88ab\u5904\u7406\u8fc7\uff0c\u65e0\u9700\u91cd\u590d\u5904\u7406\u3002</p> <p></p>"},{"location":"SpringCloud/MQ/#\u5ef6\u8fdf\u6d88\u606f","title":"\u5ef6\u8fdf\u6d88\u606f","text":"<p>\u5728\u7535\u5546\u7684\u652f\u4ed8\u4e1a\u52a1\u4e2d\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5e93\u5b58\u6709\u9650\u7684\u5546\u54c1\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u901a\u5e38\u90fd\u4f1a\u5728\u7528\u6237\u4e0b\u5355\u65f6\u7acb\u523b\u6263\u51cf\u5546\u54c1\u5e93\u5b58\u3002\u4f8b\u5982\u7535\u5f71\u9662\u8d2d\u7968\u3001\u9ad8\u94c1\u8d2d\u7968\uff0c\u4e0b\u5355\u540e\u5c31\u4f1a\u9501\u5b9a\u5ea7\u4f4d\u8d44\u6e90\uff0c\u5176\u4ed6\u4eba\u65e0\u6cd5\u91cd\u590d\u8d2d\u4e70\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u5c31\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5047\u5982\u7528\u6237\u4e0b\u5355\u540e\u4e00\u76f4\u4e0d\u4ed8\u6b3e\uff0c\u5c31\u4f1a\u4e00\u76f4\u5360\u6709\u5e93\u5b58\u8d44\u6e90\uff0c\u5bfc\u81f4\u5176\u4ed6\u5ba2\u6237\u65e0\u6cd5\u6b63\u5e38\u4ea4\u6613\uff0c\u6700\u7ec8\u5bfc\u81f4\u5546\u6237\u5229\u76ca\u53d7\u635f\uff01</p> <p></p> <p>\u56e0\u6b64\uff0c\u7535\u5546\u4e2d\u901a\u5e38\u7684\u505a\u6cd5\u5c31\u662f\uff1a\u5bf9\u4e8e\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4\u672a\u652f\u4ed8\u7684\u8ba2\u5355\uff0c\u5e94\u8be5\u7acb\u523b\u53d6\u6d88\u8ba2\u5355\u5e76\u91ca\u653e\u5360\u7528\u7684\u5e93\u5b58\u3002</p> <p>\u50cf\u8fd9\u79cd\u5728\u4e00\u6bb5\u65f6\u95f4\u4ee5\u540e\u624d\u6267\u884c\u7684\u4efb\u52a1\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5ef6\u8fdf\u4efb\u52a1\uff0c\u800c\u8981\u5b9e\u73b0\u5ef6\u8fdf\u4efb\u52a1\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6848\u5c31\u662f\u5229\u7528MQ\u7684\u5ef6\u8fdf\u6d88\u606f\u4e86\u3002</p> <p></p> <p>\u5728RabbitMQ\u4e2d\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u606f\u4e5f\u6709\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u6b7b\u4fe1\u4ea4\u6362\u673a+TTL</li> <li>\u5ef6\u8fdf\u6d88\u606f\u63d2\u4ef6</li> </ul> <p></p>"},{"location":"SpringCloud/MQ/#\u6b7b\u4fe1\u4ea4\u6362\u673a","title":"\u6b7b\u4fe1\u4ea4\u6362\u673a","text":"<p>\u5f53\u4e00\u4e2a\u961f\u5217\u4e2d\u7684\u6d88\u606f\u6ee1\u8db3\u4e0b\u5217\u60c5\u51b5\u4e4b\u4e00\u65f6\uff0c\u53ef\u4ee5\u6210\u4e3a\u6b7b\u4fe1\uff08dead letter\uff09\uff1a</p> <ul> <li>\u6d88\u8d39\u8005\u4f7f\u7528<code>basic.reject</code>\u6216 <code>basic.nack</code>\u58f0\u660e\u6d88\u8d39\u5931\u8d25\uff0c\u5e76\u4e14\u6d88\u606f\u7684<code>requeue</code>\u53c2\u6570\u8bbe\u7f6e\u4e3afalse</li> <li>\u6d88\u606f\u662f\u4e00\u4e2a\u8fc7\u671f\u6d88\u606f\uff0c\u8d85\u65f6\u65e0\u4eba\u6d88\u8d39</li> <li>\u8981\u6295\u9012\u7684\u961f\u5217\u6d88\u606f\u6ee1\u4e86\uff0c\u65e0\u6cd5\u6295\u9012</li> </ul> <p>\u5982\u679c\u4e00\u4e2a\u961f\u5217\u4e2d\u7684\u6d88\u606f\u5df2\u7ecf\u6210\u4e3a\u6b7b\u4fe1\uff0c\u5e76\u4e14\u8fd9\u4e2a\u961f\u5217\u901a\u8fc7<code>dead-letter-exchange</code>\u5c5e\u6027\u6307\u5b9a\u4e86\u4e00\u4e2a\u4ea4\u6362\u673a\uff0c\u90a3\u4e48\u961f\u5217\u4e2d\u7684\u6b7b\u4fe1\u5c31\u4f1a\u6295\u9012\u5230\u8fd9\u4e2a\u4ea4\u6362\u673a\u4e2d\uff0c\u800c\u8fd9\u4e2a\u4ea4\u6362\u673a\u5c31\u79f0\u4e3a\u6b7b\u4fe1\u4ea4\u6362\u673a\uff08Dead Letter Exchange\uff09\u3002</p> <p></p> <p>\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f</p> <pre><code>rabbitTemplate.convertAndSend(\"normal.direct\", \"dlx.key\", \"\u6d88\u606f\", new MessagePostProcessor() {\n            // \u6d88\u606f\u540e\u5904\u7406\u5668\uff0c\u8bbe\u7f6e\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\u4e3a10\u79d2\n            @Override\n            public Message postProcessMessage(Message message) throws AmqpException {\n                message.getMessageProperties()\n                        .setExpiration(\"10000\");\n                return message;\n            }\n        });\n</code></pre> <p></p>"},{"location":"SpringCloud/MQ/#\u5ef6\u8fdf\u6d88\u606f\u63d2\u4ef6","title":"\u5ef6\u8fdf\u6d88\u606f\u63d2\u4ef6","text":"<p>\u57fa\u4e8e\u6b7b\u4fe1\u961f\u5217\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u606f\uff0c\u4f46\u662f\u592a\u9ebb\u70e6\u4e86\u3002\u56e0\u6b64RabbitMQ\u793e\u533a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5ef6\u8fdf\u6d88\u606f\u63d2\u4ef6\u6765\u5b9e\u73b0\u76f8\u540c\u7684\u6548\u679c\u3002</p> <p>Scheduling Messages with RabbitMQ | RabbitMQ</p> <p>\u56e0\u4e3aRabbitMQ\u662f\u57fa\u4e8eDocker\u5b89\u88c5\uff0c\u6240\u4ee5\u9700\u8981\u5148\u67e5\u770bRabbitMQ\u7684\u63d2\u4ef6\u76ee\u5f55\u5bf9\u5e94\u7684\u6570\u636e\u5377\u3002\u627e\u5230\u6570\u636e\u5377\u6302\u8f7d\u4f4d\u7f6e\uff0c\u5e76\u5c06\u63d2\u4ef6\u590d\u5236\u5230\u8be5\u4f4d\u7f6e\u3002</p> <pre><code>docker volume inspect mq-plugins\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u4f7f\u63d2\u4ef6\u751f\u6548</p> <pre><code>docker exec -it mq rabbitmq-plugins enable rabbitmq_delayed_message_exchange\n</code></pre> <p>1.\u58f0\u660e\u5ef6\u8fdf\u4ea4\u6362\u673a\uff0c\u6dfb\u52a0<code>delay</code>\u53c2\u6570</p> <pre><code>    @RabbitListener(bindings = @QueueBinding(\n            value = @Queue(name = \"delay.queue\", durable = \"true\"),\n            exchange = @Exchange(name = \"delay.direct\", delayed = \"true\"),\n            key = \"delay.key\"\n    ))\n</code></pre> <p>2.\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\uff0c\u5728Message\u7684\u540e\u5904\u7406\u5668\u4e2d\u4f7f\u7528<code>setDelay</code>\u65b9\u6cd5</p> <pre><code>        rabbitTemplate.convertAndSend(\"delay.direct\", \"delay.key\", \"\u6d88\u606f\", new MessagePostProcessor() {\n            // \u6d88\u606f\u540e\u5904\u7406\u5668\uff0c\u8bbe\u7f6e\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\u4e3a10\u79d2\n            @Override\n            public Message postProcessMessage(Message message) throws AmqpException {\n                message.getMessageProperties()\n                        .setDelay(5000);\n                return message;\n            }\n        });\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <p>\u5ef6\u8fdf\u6d88\u606f\u63d2\u4ef6\u5185\u90e8\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u672c\u5730\u6570\u636e\u5e93\u8868\uff0c\u540c\u65f6\u4f7f\u7528Elang Timers\u529f\u80fd\u5b9e\u73b0\u8ba1\u65f6\u3002\u5982\u679c\u6d88\u606f\u7684\u5ef6\u8fdf\u65f6\u95f4\u8bbe\u7f6e\u8f83\u957f\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5806\u79ef\u7684\u5ef6\u8fdf\u6d88\u606f\u975e\u5e38\u591a\uff0c\u4f1a\u5e26\u6765\u8f83\u5927\u7684CPU\u5f00\u9500\uff0c\u540c\u65f6\u5ef6\u8fdf\u6d88\u606f\u7684\u65f6\u95f4\u4f1a\u5b58\u5728\u8bef\u5dee\u3002</p> <p>\u56e0\u6b64\uff0c\u4e0d\u5efa\u8bae\u8bbe\u7f6e\u5ef6\u8fdf\u65f6\u95f4\u8fc7\u957f\u7684\u5ef6\u8fdf\u6d88\u606f\u3002</p>"},{"location":"SpringCloud/MyBatisPlus/","title":"MyBatis-Plus \u6570\u636e\u8bbf\u95ee\u589e\u5f3a","text":"<p>MyBatis-Plus \u662f MyBatis \u7684\u589e\u5f3a\u5de5\u5177\uff0c\u5728 MyBatis \u7684\u57fa\u7840\u4e0a\u53ea\u505a\u589e\u5f3a\u4e0d\u505a\u6539\u53d8</p>"},{"location":"SpringCloud/MyBatisPlus/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":""},{"location":"SpringCloud/MyBatisPlus/#\u4f9d\u8d56\u5f15\u5165","title":"\u4f9d\u8d56\u5f15\u5165","text":"<p>Maven \u4f9d\u8d56\u914d\u7f6e\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt;\n    &lt;version&gt;3.5.9&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!-- springBoot3\u4f9d\u8d56 --&gt;\n</code></pre> <p>\u7248\u672c\u8bf4\u660e</p> <p>\u4ee5\u4e0a\u4e3aSpring Boot 3.x.x\u7248\u672c\u4f9d\u8d56\uff0c3.x.x\u4ee5\u4e0b\u7248\u672c\u7565\u6709\u4e0d\u540c</p>"},{"location":"SpringCloud/MyBatisPlus/#\u57fa\u672c\u4f7f\u7528","title":"\u57fa\u672c\u4f7f\u7528","text":"<p>\u81ea\u5b9a\u4e49\u7684 Mapper \u7ee7\u627f MyBatis-Plus \u63d0\u4f9b\u7684 BaseMapper \u63a5\u53e3\uff1a</p> <pre><code>public interface UserMapper extends BaseMapper&lt;User&gt; {}\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#\u6838\u5fc3\u6ce8\u89e3","title":"\u6838\u5fc3\u6ce8\u89e3","text":"<p>\u7ea6\u5b9a\u5927\u4e8e\u914d\u7f6e</p> <p>MyBatis-Plus \u901a\u8fc7\u626b\u63cf\u5b9e\u4f53\u7c7b\uff0c\u5e76\u57fa\u4e8e\u53cd\u5c04\u83b7\u53d6\u5b9e\u4f53\u7c7b\u4fe1\u606f\u4f5c\u4e3a\u6570\u636e\u5e93\u8868\u4fe1\u606f\u3002</p>"},{"location":"SpringCloud/MyBatisPlus/#\u9ed8\u8ba4\u7ea6\u5b9a","title":"\u9ed8\u8ba4\u7ea6\u5b9a","text":"<ul> <li>\u7c7b\u540d\u9a7c\u5cf0\u8f6c\u4e0b\u5212\u7ebf\u4f5c\u4e3a\u8868\u540d</li> <li>\u540d\u4e3aid\u7684\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e</li> <li>\u53d8\u91cf\u540d\u9a7c\u5cf0\u8f6c\u4e0b\u5212\u7ebf\u4f5c\u4e3a\u8868\u7684\u5b57\u6bb5\u540d</li> </ul>"},{"location":"SpringCloud/MyBatisPlus/#\u5e38\u7528\u6ce8\u89e3","title":"\u5e38\u7528\u6ce8\u89e3","text":"<p>MyBatis-Plus \u4e2d\u6bd4\u8f83\u5e38\u7528\u7684\u51e0\u4e2a\u6ce8\u89e3\uff08\u4e3b\u8981\u7528\u4e8e\u4e0d\u6ee1\u8db3\u7ea6\u5b9a\u7684\u60c5\u51b5\uff09\uff1a</p> <ul> <li><code>@TableName</code>\uff1a\u7528\u6765\u6307\u5b9a\u8868\u540d</li> <li><code>@TableId</code>\uff1a\u7528\u6765\u6307\u5b9a\u8868\u4e2d\u7684\u4e3b\u952e\u5b57\u6bb5\u4fe1\u606f</li> <li><code>@TableField</code>\uff1a\u7528\u6765\u6307\u5b9a\u8868\u4e2d\u7684\u666e\u901a\u5b57\u6bb5\u4fe1\u606f</li> </ul> <pre><code>@TableName(\"user\")\npublic class User {\n    /**\n     * \u7528\u6237id\n     */\n    @TableId(value = \"id\", type = IdType.AUTO)\n    private Long id;\n\n    /**\n     * \u7528\u6237\u540d\n     */\n    @TableField(\"username\")\n    private String username;\n}\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#idtype-\u679a\u4e3e","title":"IdType \u679a\u4e3e","text":"<ul> <li><code>AUTO</code>\uff1a\u6570\u636e\u5e93\u81ea\u589e\u957f</li> <li><code>INPUT</code>\uff1a\u901a\u8fc7set\u65b9\u6cd5\u81ea\u884c\u8f93\u5165</li> <li><code>ASSIGN_ID</code>\uff1a\u5206\u914d ID\uff0c\u4f7f\u7528\u96ea\u82b1\u7b97\u6cd5</li> </ul>"},{"location":"SpringCloud/MyBatisPlus/#tablefield-\u5e38\u89c1\u573a\u666f","title":"@TableField \u5e38\u89c1\u573a\u666f","text":"<ul> <li>\u6210\u5458\u53d8\u91cf\u540d\u4e0e\u6570\u636e\u5e93\u5b57\u6bb5\u540d\u4e0d\u4e00\u81f4</li> <li>\u6210\u5458\u53d8\u91cf\u540d\u4ee5is\u5f00\u5934\uff0c\u4e14\u662f\u5e03\u5c14\u503c</li> <li>\u6210\u5458\u53d8\u91cf\u540d\u4e0e\u6570\u636e\u5e93\u5173\u952e\u5b57\u51b2\u7a81\uff0c\u5982\uff1a<code>@TableField(\"</code>order<code>\")</code></li> <li>\u6210\u5458\u53d8\u91cf\u4e0d\u662f\u6570\u636e\u5e93\u5b57\u6bb5</li> </ul>"},{"location":"SpringCloud/MyBatisPlus/#\u5e38\u7528\u914d\u7f6e","title":"\u5e38\u7528\u914d\u7f6e","text":"<pre><code>mybatis-plus:\n  type-aliases-package: com.ysh.entity # \u522b\u540d\u626b\u63cf\u5305\n  mapper-locations: classpath:mapper/**/*.xml # mapper\u626b\u63cf\u8def\u5f84\n  configuration:\n    map-underscore-to-camel-case: true # \u5f00\u542f\u9a7c\u5cf0\u547d\u540d\u89c4\u5219\n    cache-enabled: false # \u5173\u95edMybatis\u4e8c\u7ea7\u7f13\u5b58\n  global-config:\n    db-config:\n      id-type: assign_id # \u4e3b\u952e\u7c7b\u578b\u4e3a\u96ea\u82b1\u7b97\u6cd5\n      update-strategy: not_null # \u66f4\u65b0\u7b56\u7565:\u53ea\u66f4\u65b0\u4e0d\u4e3anull\u7684\u503c\n</code></pre> <p>\u5177\u4f53\u53ef\u53c2\u8003\u5b98\u65b9\u6587\u6863\uff1a\u4f7f\u7528\u914d\u7f6e</p>"},{"location":"SpringCloud/MyBatisPlus/#\u6761\u4ef6\u6784\u9020\u5668","title":"\u6761\u4ef6\u6784\u9020\u5668","text":""},{"location":"SpringCloud/MyBatisPlus/#querywrapper-\u57fa\u672c\u7528\u6cd5","title":"QueryWrapper \u57fa\u672c\u7528\u6cd5","text":"<p>\u9700\u6c42\uff1a\u67e5\u8be2\u51fa\u540d\u5b57\u4e2d\u5e26o\u7684\uff0c\u5b58\u6b3e\u5927\u4e8e\u7b49\u4e8e1000\u5143\u7684\u4eba\u7684\u4fe1\u606f</p> <pre><code>// \u6784\u5efa\u67e5\u8be2\u6761\u4ef6\nQueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;()\n    .select(\"id\", \"username\", \"info\", \"balance\")\n    .like(\"username\", \"o\")\n    .ge(\"balance\", 1000);\n\n// \u6267\u884c\u67e5\u8be2\nuserMapper.selectList(wrapper);\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#updatewrapper-\u7528\u6cd5","title":"UpdateWrapper \u7528\u6cd5","text":"<p>\u9700\u6c42\uff1a\u66f4\u65b0id\u4e3a1,2,4\u7684\u7528\u6237\u7684\u4f59\u989d\uff0c\u6263200</p> <pre><code>List&lt;Long&gt; ids = List.of(1L, 2L, 4L);\nUpdateWrapper&lt;User&gt; wrapper = new UpdateWrapper&lt;User&gt;()\n    .setSql(\"balance = balance - 200\")\n    .in(\"id\", ids);\nuserMapper.update(null, wrapper);\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#lambdawrapper-\u7528\u6cd5\u63a8\u8350","title":"LambdaWrapper \u7528\u6cd5\uff08\u63a8\u8350\uff09","text":"<pre><code>LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;User&gt;()\n    .select(User::getId, User::getUsername, User::getInfo, User::getBalance)\n    .like(User::getUsername, \"o\")\n    .ge(User::getBalance, 1000);\nuserMapper.selectList(wrapper);\n</code></pre> <p>\u6700\u4f73\u5b9e\u8df5</p> <ul> <li>\u5c3d\u91cf\u4f7f\u7528 LambdaQueryWrapper \u548c LambdaUpdateWrapper\uff0c\u907f\u514d\u786c\u7f16\u7801</li> <li>QueryWrapper \u901a\u5e38\u7528\u6765\u6784\u5efa select\u3001delete\u3001update \u7684 where \u6761\u4ef6\u90e8\u5206</li> <li>UpdateWrapper \u901a\u5e38\u53ea\u6709\u5728 set \u8bed\u53e5\u6bd4\u8f83\u7279\u6b8a\u624d\u4f7f\u7528</li> </ul>"},{"location":"SpringCloud/MyBatisPlus/#\u81ea\u5b9a\u4e49sql","title":"\u81ea\u5b9a\u4e49SQL","text":"<p>\u7ed3\u5408 Wrapper \u6784\u5efa\u590d\u6742\u67e5\u8be2\u6761\u4ef6\uff0c\u540c\u65f6\u81ea\u5b9a\u4e49SQL\u8bed\u53e5\u7684\u5176\u4ed6\u90e8\u5206\u3002</p>"},{"location":"SpringCloud/MyBatisPlus/#\u4f7f\u7528\u6b65\u9aa4","title":"\u4f7f\u7528\u6b65\u9aa4","text":"<ol> <li> <p>\u6784\u5efa\u6761\u4ef6\uff1a <pre><code>List&lt;Long&gt; ids = List.of(1L, 2L, 4L);\nint amount = 200;\nLambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;User&gt;()\n    .in(User::getId, ids);\nuserMapper.updateBalanceByIds(wrapper, amount);\n</code></pre></p> </li> <li> <p>Mapper \u65b9\u6cd5\u58f0\u660e\uff1a <pre><code>void updateBalanceByIds(@Param(\"ew\") LambdaQueryWrapper&lt;User&gt; wrapper, \n                       @Param(\"amount\") int amount);\n</code></pre></p> </li> </ol> <p>\u6ce8\u610f</p> <p>Wrapper \u53c2\u6570\u5fc5\u987b\u6307\u5b9a\u4e3a \"ew\"</p> <ol> <li>\u81ea\u5b9a\u4e49SQL\uff1a <pre><code>&lt;update id=\"updateBalanceByIds\"&gt;\n    UPDATE tb_user SET balance = balance - #{amount} ${ew.customSqlSegment}\n&lt;/update&gt;\n</code></pre></li> </ol>"},{"location":"SpringCloud/MyBatisPlus/#service\u63a5\u53e3","title":"Service\u63a5\u53e3","text":""},{"location":"SpringCloud/MyBatisPlus/#\u57fa\u672c\u4f7f\u7528_1","title":"\u57fa\u672c\u4f7f\u7528","text":"<ol> <li> <p>\u81ea\u5b9a\u4e49Service\u63a5\u53e3\u7ee7\u627fIService\u63a5\u53e3\uff1a <pre><code>public interface IUserService extends IService&lt;User&gt; {\n}\n</code></pre></p> </li> <li> <p>\u81ea\u5b9a\u4e49Service\u5b9e\u73b0\u7c7b\uff1a <pre><code>@Service\npublic class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; \n    implements IUserService {\n}\n</code></pre></p> </li> </ol>"},{"location":"SpringCloud/MyBatisPlus/#lambda\u67e5\u8be2","title":"Lambda\u67e5\u8be2","text":"<p>\u5b9e\u73b0\u590d\u6742\u6761\u4ef6\u67e5\u8be2\uff1a</p> <pre><code>List&lt;User&gt; users = userService.lambdaQuery()\n    .like(username != null, User::getUsername, username)\n    .eq(status != null, User::getStatus, status)\n    .ge(minBalance != null, User::getBalance, minBalance)\n    .le(maxBalance != null, User::getBalance, maxBalance)\n    .list();\n</code></pre> <p>\u94fe\u5f0f\u7f16\u7a0b\u7ed3\u5c3e\u65b9\u6cd5\uff1a - <code>.one()</code>\uff1a\u6700\u591a1\u4e2a\u7ed3\u679c - <code>.list()</code>\uff1a\u8fd4\u56de\u96c6\u5408\u7ed3\u679c - <code>.count()</code>\uff1a\u8fd4\u56de\u8ba1\u6570\u7ed3\u679c</p>"},{"location":"SpringCloud/MyBatisPlus/#lambda\u66f4\u65b0","title":"Lambda\u66f4\u65b0","text":"<p>\u6839\u636eid\u4fee\u6539\u7528\u6237\u4f59\u989d\uff1a</p> <pre><code>lambdaUpdate()\n    .set(User::getBalance, remainBalance) // \u66f4\u65b0\u4f59\u989d\n    .set(remainBalance == 0, User::getStatus, 2) // \u52a8\u6001\u5224\u65ad\n    .eq(User::getId, id)\n    .eq(User::getBalance, user.getBalance()) // \u4e50\u89c2\u9501\n    .update();\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#\u6279\u91cf\u65b0\u589e","title":"\u6279\u91cf\u65b0\u589e","text":"<p>\u9ad8\u6548\u6279\u91cf\u63d2\u5165\uff1a</p> <pre><code>@Test\nvoid testSaveBatch() {\n    List&lt;User&gt; list = new ArrayList&lt;&gt;(1000);\n    for (int i = 1; i &lt;= 100000; i++) {\n        list.add(buildUser(i));\n        // \u6bcf1000\u6761\u6279\u91cf\u63d2\u5165\u4e00\u6b21\n        if (i % 1000 == 0) {\n            userService.saveBatch(list);\n            list.clear();\n        }\n    }\n}\n</code></pre> <p>\u6027\u80fd\u4f18\u5316</p> <p>\u5728 MySQL \u8fde\u63a5\u53c2\u6570\u4e2d\u6dfb\u52a0 <code>rewriteBatchedStatements=true</code> \u53ef\u4ee5\u5c06\u591a\u6761\u63d2\u5165\u8bed\u53e5\u5408\u5e76\u4e3a\u4e00\u6761\uff0c\u5927\u5e45\u63d0\u5347\u6027\u80fd\u3002</p> <pre><code>spring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/mp?rewriteBatchedStatements=true&amp;useUnicode=true&amp;characterEncoding=UTF-8\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#\u6269\u5c55\u529f\u80fd","title":"\u6269\u5c55\u529f\u80fd","text":""},{"location":"SpringCloud/MyBatisPlus/#\u4ee3\u7801\u751f\u6210\u5668","title":"\u4ee3\u7801\u751f\u6210\u5668","text":"<p>\u63a8\u8350\u4f7f\u7528 IDEA \u63d2\u4ef6 \"MyBatisX\" \u8fdb\u884c\u56fe\u5f62\u5316\u4ee3\u7801\u751f\u6210\u3002</p>"},{"location":"SpringCloud/MyBatisPlus/#\u9759\u6001\u5de5\u5177\u7c7b","title":"\u9759\u6001\u5de5\u5177\u7c7b","text":"<p>\u4f7f\u7528 <code>Db</code> \u9759\u6001\u5de5\u5177\u7c7b\u907f\u514dService\u5faa\u73af\u4f9d\u8d56\uff1a</p> <pre><code>@Test\nvoid testDbOperations() {\n    // \u6839\u636eID\u67e5\u8be2\n    User user = Db.getById(1L, User.class);\n\n    // \u590d\u6742\u6761\u4ef6\u67e5\u8be2\n    List&lt;User&gt; list = Db.lambdaQuery(User.class)\n        .like(User::getUsername, \"o\")\n        .ge(User::getBalance, 1000)\n        .list();\n\n    // \u66f4\u65b0\u64cd\u4f5c\n    Db.lambdaUpdate(User.class)\n        .set(User::getBalance, 2000)\n        .eq(User::getUsername, \"Rose\");\n}\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#\u903b\u8f91\u5220\u9664","title":"\u903b\u8f91\u5220\u9664","text":"<ol> <li> <p>\u6dfb\u52a0\u903b\u8f91\u5220\u9664\u5b57\u6bb5\uff1a <pre><code>alter table address add deleted bit default b'0' null comment '\u903b\u8f91\u5220\u9664';\n</code></pre></p> </li> <li> <p>\u914d\u7f6e\u903b\u8f91\u5220\u9664\uff1a <pre><code>mybatis-plus:\n  global-config:\n    db-config:\n      logic-delete-field: deleted # \u903b\u8f91\u5220\u9664\u5b57\u6bb5\u540d\n      logic-delete-value: 1 # \u5df2\u5220\u9664\u503c\n      logic-not-delete-value: 0 # \u672a\u5220\u9664\u503c\n</code></pre></p> </li> </ol> <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u903b\u8f91\u5220\u9664\u4f1a\u5bfc\u81f4\u5783\u573e\u6570\u636e\u589e\u591a\uff0c\u5f71\u54cd\u67e5\u8be2\u6548\u7387</li> <li>\u81ea\u5b9a\u4e49SQL\u9700\u8981\u624b\u52a8\u5904\u7406\u903b\u8f91\u5220\u9664\u903b\u8f91</li> <li>\u5efa\u8bae\u91c7\u7528\u6570\u636e\u8fc1\u79fb\u65b9\u6848\u66ff\u4ee3\u903b\u8f91\u5220\u9664</li> </ul>"},{"location":"SpringCloud/MyBatisPlus/#\u901a\u7528\u679a\u4e3e","title":"\u901a\u7528\u679a\u4e3e","text":"<p>\u901a\u7528\u679a\u4e3e\u53ef\u4ee5\u7b80\u5316\u679a\u4e3e\u5b57\u6bb5\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <ol> <li> <p>\u5b9a\u4e49\u679a\u4e3e\u7c7b\uff1a <pre><code>@Getter\npublic enum UserStatus {\n    NORMAL(1, \"\u6b63\u5e38\"),\n    FREEZE(2, \"\u51bb\u7ed3\");\n\n    @EnumValue\n    private final int value;\n    private final String desc;\n\n    UserStatus(int value, String desc) {\n        this.value = value;\n        this.desc = desc;\n    }\n}\n</code></pre></p> </li> <li> <p>\u914d\u7f6e\u679a\u4e3e\u5904\u7406\u5668\uff1a <pre><code>mybatis-plus:\n  configuration:\n    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler\n</code></pre></p> </li> </ol>"},{"location":"SpringCloud/MyBatisPlus/#json\u7c7b\u578b\u5904\u7406\u5668","title":"JSON\u7c7b\u578b\u5904\u7406\u5668","text":"<p>\u5904\u7406JSON\u5b57\u6bb5\u7684\u81ea\u52a8\u8f6c\u6362\uff1a</p> <pre><code>@TableField(typeHandler = JacksonTypeHandler.class)\nprivate UserInfo info;\n</code></pre>"},{"location":"SpringCloud/MyBatisPlus/#\u63d2\u4ef6\u529f\u80fd","title":"\u63d2\u4ef6\u529f\u80fd","text":""},{"location":"SpringCloud/MyBatisPlus/#\u5206\u9875\u63d2\u4ef6","title":"\u5206\u9875\u63d2\u4ef6","text":"<ol> <li> <p>\u914d\u7f6e\u5206\u9875\u63d2\u4ef6\uff1a <pre><code>@Configuration\npublic class MybatisConfig {\n    @Bean\n    public MybatisPlusInterceptor mybatisPlusInterceptor() {\n        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\n        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MySQL));\n        return interceptor;\n    }\n}\n</code></pre></p> </li> <li> <p>\u4f7f\u7528\u5206\u9875\u67e5\u8be2\uff1a <pre><code>@Test\nvoid testPageQuery() {\n    // \u5206\u9875\u67e5\u8be2\uff0c\u53c2\u6570\uff1a\u9875\u7801\u3001\u6bcf\u9875\u5927\u5c0f\n    Page&lt;User&gt; p = userService.page(new Page&lt;&gt;(2, 2));\n    System.out.println(\"total = \" + p.getTotal());\n    System.out.println(\"pages = \" + p.getPages());\n    List&lt;User&gt; records = p.getRecords();\n}\n</code></pre></p> </li> </ol>"},{"location":"SpringCloud/MyBatisPlus/#\u901a\u7528\u5206\u9875\u5b9e\u4f53","title":"\u901a\u7528\u5206\u9875\u5b9e\u4f53","text":"<p>\u521b\u5efa\u901a\u7528\u7684\u5206\u9875\u67e5\u8be2\u548c\u8fd4\u56de\u5b9e\u4f53\uff0c\u7b80\u5316\u5206\u9875\u5f00\u53d1\uff1a</p> <p>\u5206\u9875\u5b9e\u4f53\u5c01\u88c5</p> <p>PageQuery.java <pre><code>@Data\npublic class PageQuery {\n    private Integer pageNo;\n    private Integer pageSize;\n    private String sortBy;\n    private Boolean isAsc;\n\n    public &lt;T&gt; Page&lt;T&gt; toMpPage(OrderItem... orders) {\n        Page&lt;T&gt; p = Page.of(pageNo, pageSize);\n        if (sortBy != null) {\n            p.addOrder(new OrderItem(sortBy, isAsc));\n            return p;\n        }\n        if (orders != null) {\n            p.addOrder(orders);\n        }\n        return p;\n    }\n\n    public &lt;T&gt; Page&lt;T&gt; toMpPageDefaultSortByUpdateTimeDesc() {\n        return toMpPage(\"update_time\", false);\n    }\n}\n</code></pre></p> <p>PageDTO.java <pre><code>@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class PageDTO&lt;V&gt; {\n    private Long total;\n    private Long pages;\n    private List&lt;V&gt; list;\n\n    public static &lt;V, P&gt; PageDTO&lt;V&gt; of(Page&lt;P&gt; p, Class&lt;V&gt; voClass) {\n        List&lt;P&gt; records = p.getRecords();\n        if (records == null || records.size() &lt;= 0) {\n            return new PageDTO&lt;&gt;(p.getTotal(), p.getPages(), Collections.emptyList());\n        }\n        List&lt;V&gt; vos = BeanUtil.copyToList(records, voClass);\n        return new PageDTO&lt;&gt;(p.getTotal(), p.getPages(), vos);\n    }\n}\n</code></pre></p>"},{"location":"SpringCloud/OpenFeign/","title":"OpenFeign","text":"<p>OpenFeign\u5ba2\u6237\u7aef\u662f\u4e00\u4e2aweb\u58f0\u660e\u5f0fhttp\u8fdc\u7a0b\u8c03\u7528\u5de5\u5177\uff0c\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u670d\u52a1\u540d\u79f0\u53bb\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u6307\u5b9a\u7684\u670d\u52a1IP\u96c6\u5408\uff0c\u63d0\u4f9b\u4e86\u63a5\u53e3\u548c\u6ce8\u89e3\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\uff0c\u5185\u5d4c\u96c6\u6210\u4e86Ribbon\u672c\u5730\u8d1f\u8f7d\u5747\u8861\u5668\uff08\u73b0\u5728\u6d41\u884c\u4f7f\u7528loadbalancer\uff09</p> <p></p>"},{"location":"SpringCloud/OpenFeign/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<p>\u4e0a\u4e00\u8282\u8fdc\u7a0b\u8c03\u7528\u4ee3\u7801\u4ecd\u7136\u6bd4\u8f83\u590d\u6742</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5fc5\u987b\u60f3\u529e\u6cd5\u6539\u53d8\u8fdc\u7a0b\u8c03\u7528\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u8ba9\u8fdc\u7a0b\u8c03\u7528\u50cf\u672c\u5730\u65b9\u6cd5\u8c03\u7528\u4e00\u6837\u7b80\u5355\u3002\u800c\u8fd9\u5c31\u8981\u7528\u5230OpenFeign\u7ec4\u4ef6\u4e86\u3002</p> <p>\u5176\u5b9e\u8fdc\u7a0b\u8c03\u7528\u7684\u5173\u952e\u70b9\u5c31\u5728\u4e8e\u56db\u4e2a\uff1a</p> <ul> <li> <p>\u8bf7\u6c42\u65b9\u5f0f</p> </li> <li> <p>\u8bf7\u6c42\u8def\u5f84</p> </li> <li> <p>\u8bf7\u6c42\u53c2\u6570</p> </li> <li> <p>\u8fd4\u56de\u503c\u7c7b\u578b</p> </li> </ul> <p>\u6240\u4ee5\uff0cOpenFeign\u5c31\u5229\u7528SpringMVC\u7684\u76f8\u5173\u6ce8\u89e3\u6765\u58f0\u660e\u4e0a\u8ff04\u4e2a\u53c2\u6570\uff0c\u7136\u540e\u57fa\u4e8e\u52a8\u6001\u4ee3\u7406\u5e2e\u6211\u4eec\u751f\u6210\u8fdc\u7a0b\u8c03\u7528\u7684\u4ee3\u7801\uff0c\u800c\u65e0\u9700\u6211\u4eec\u624b\u52a8\u518d\u7f16\u5199\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p> <p>1.\u5f15\u5165\u4f9d\u8d56</p> <pre><code>  &lt;!--openFeign--&gt;\n  &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\n  &lt;/dependency&gt;\n\n  &lt;!--\u8d1f\u8f7d\u5747\u8861\u5668--&gt;\n  &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;\n  &lt;/dependency&gt;\n</code></pre> <p>2.\u542f\u7528OpenFeign</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5728\u542f\u52a8\u7c7b\u4e0a\u6dfb\u52a0\u6ce8\u89e3\uff0c\u542f\u52a8OpenFeign\u529f\u80fd</p> <pre><code>@EnableFeignClients\n</code></pre> <p>3.\u7f16\u5199OpenFeign\u5ba2\u6237\u7aef</p> <pre><code>@FeignClient(\"item-service\")\npublic interface ItemClient {\n\n    // \u6ce8\u89e3\u6307\u5b9a\u8bf7\u6c42\u65b9\u5f0f\u3001\u8bf7\u6c42\u8def\u5f84\u3001\u53c2\u6570\u7c7b\u578b\u3001\u8fd4\u56de\u7c7b\u578b\n    @GetMapping(\"/items\")\n    List&lt;ItemDTO&gt; queryItemsByIds(@RequestParam(\"ids\") List&lt;Long&gt; ids);\n}\n</code></pre> <p>Note</p> <p>\u8fd9\u91cc\u53ea\u9700\u8981\u58f0\u660e\u63a5\u53e3\uff0c\u65e0\u9700\u5b9e\u73b0\u65b9\u6cd5\u3002\u63a5\u53e3\u4e2d\u7684\u51e0\u4e2a\u5173\u952e\u4fe1\u606f\uff1a</p> <ul> <li> <p><code>@FeignClient(\"item-service\")</code> \uff1a\u58f0\u660e\u670d\u52a1\u540d\u79f0</p> </li> <li> <p><code>@GetMapping</code> \uff1a\u58f0\u660e\u8bf7\u6c42\u65b9\u5f0f</p> </li> <li> <p><code>@GetMapping(\"/items\")</code> \uff1a\u58f0\u660e\u8bf7\u6c42\u8def\u5f84</p> </li> <li> <p><code>@RequestParam(\"ids\") Collection&lt;Long&gt; ids</code> \uff1a\u58f0\u660e\u8bf7\u6c42\u53c2\u6570</p> </li> <li> <p><code>List&lt;ItemDTO&gt;</code> \uff1a\u8fd4\u56de\u503c\u7c7b\u578b</p> </li> </ul> <p>4.\u4f7f\u7528FeignClient</p> <p>\u6ce8\u5165Bean\u5e76\u8c03\u7528\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u5373\u53ef</p> <pre><code>@Autowired\nprivate ItemClient itemClient;\npublic List&lt;ItemDTO&gt; queryItemsByIds(List&lt;Long&gt; ids) {\n    return itemClient.queryItemsByIds(ids);\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/OpenFeign/#\u8fde\u63a5\u6c60","title":"\u8fde\u63a5\u6c60","text":"<p>Info</p> <p>OpenFeign\u9ed8\u8ba4\u4f7f\u7528JDK\u63d0\u4f9b\u7684<code>HttpURLConnection</code>, \u6548\u7387\u8f83\u4f4e</p> <p>Feign\u5e95\u5c42\u53d1\u8d77http\u8bf7\u6c42\uff0c\u4f9d\u8d56\u4e8e\u5176\u5b83\u7684\u6846\u67b6\u3002\u5176\u5e95\u5c42\u652f\u6301\u7684http\u5ba2\u6237\u7aef\u5b9e\u73b0\u5305\u62ec\uff1a</p> <ul> <li> <p>HttpURLConnection\uff1a\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u4e0d\u652f\u6301\u8fde\u63a5\u6c60</p> </li> <li> <p>Apache HttpClient \uff1a\u652f\u6301\u8fde\u63a5\u6c60</p> </li> <li> <p>OKHttp\uff1a\u652f\u6301\u8fde\u63a5\u6c60</p> </li> </ul> <p>\u56e0\u6b64\u6211\u4eec\u901a\u5e38\u4f1a\u4f7f\u7528\u5e26\u6709\u8fde\u63a5\u6c60\u7684\u5ba2\u6237\u7aef\u6765\u4ee3\u66ff\u9ed8\u8ba4\u7684HttpURLConnection\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u4eec\u4f7f\u7528OK Http</p> <p>1.\u5f15\u5165\u4f9d\u8d56</p> <pre><code>&lt;!--OK http \u7684\u4f9d\u8d56 --&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;\n  &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>2.\u5f00\u542f\u8fde\u63a5\u6c60</p> <p>\u5728<code>application.yml</code>\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542fFeign\u7684\u8fde\u63a5\u6c60\u529f\u80fd\uff1a</p> <pre><code>feign:\n  okhttp:\n    enabled: true # \u5f00\u542fOKHttp\u529f\u80fd\n</code></pre> <p>3.\u91cd\u542f\u751f\u6548</p> <p></p>"},{"location":"SpringCloud/OpenFeign/#\u6700\u4f73\u4f7f\u7528\u65b9\u6848","title":"\u6700\u4f73\u4f7f\u7528\u65b9\u6848","text":"<p>\u5982\u679c\u5728\u5176\u4ed6\u5fae\u670d\u52a1\u4e2d\u4e5f\u9700\u8981\u8c03\u7528\u8be5\u63a5\u53e3\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u5199\u76f8\u540c\u7684<code>Client</code>\uff0c\u5bfc\u81f4\u4ee3\u7801\u91cd\u590d</p> <p>\u907f\u514d\u91cd\u590d\u7f16\u7801\u7684\u529e\u6cd5\u5c31\u662f\u62bd\u53d6\u3002\u4e0d\u8fc7\u8fd9\u91cc\u6709\u4e24\u79cd\u62bd\u53d6\u601d\u8def\uff1a</p> <ul> <li> <p>\u601d\u8def1\uff1a\u62bd\u53d6\u5230\u5fae\u670d\u52a1\u4e4b\u5916\u7684\u516c\u5171module</p> </li> <li> <p>\u601d\u8def2\uff1a\u6bcf\u4e2a\u5fae\u670d\u52a1\u81ea\u5df1\u62bd\u53d6\u4e00\u4e2amodule\uff08\u63a8\u8350\uff09</p> </li> </ul> <p>\u5982\u56fe\uff1a</p> <p></p> <p>Tip</p> <p>\u65b9\u68481\u62bd\u53d6\u66f4\u52a0\u7b80\u5355\uff0c\u5de5\u7a0b\u7ed3\u6784\u4e5f\u6bd4\u8f83\u6e05\u6670\uff0c\u4f46\u7f3a\u70b9\u662f\u6574\u4e2a\u9879\u76ee\u8026\u5408\u5ea6\u504f\u9ad8\u3002</p> <p>\u65b9\u68482\u62bd\u53d6\u76f8\u5bf9\u9ebb\u70e6\uff0c\u5de5\u7a0b\u7ed3\u6784\u76f8\u5bf9\u66f4\u590d\u6742\uff0c\u4f46\u670d\u52a1\u4e4b\u95f4\u8026\u5408\u5ea6\u964d\u4f4e\u3002</p> <p>\u9700\u8981\u8c03\u7528\u63a5\u53e3\u7684\u670d\u52a1\u5f15\u5165\u76f8\u5173API\u6a21\u5757\u7684\u4f9d\u8d56\uff0c\u5e76\u4e14\u5728\u542f\u52a8\u7c7b\u7684\u6ce8\u89e3<code>@EnableFeignClients</code>\u4e2d\u6307\u5b9a\u626b\u63cf\u7684Client\u5373\u53ef</p> <p></p>"},{"location":"SpringCloud/OpenFeign/#\u65e5\u5fd7\u914d\u7f6e","title":"\u65e5\u5fd7\u914d\u7f6e","text":"<p>OpenFeign\u53ea\u4f1a\u5728FeignClient\u6240\u5728\u5305\u7684\u65e5\u5fd7\u7ea7\u522b\u4e3aDEBUG\u65f6\uff0c\u624d\u4f1a\u8f93\u51fa\u65e5\u5fd7\u3002\u800c\u4e14\u5176\u65e5\u5fd7\u7ea7\u522b\u67094\u7ea7\uff1a</p> <ul> <li> <p>NONE\uff1a\u4e0d\u8bb0\u5f55\u4efb\u4f55\u65e5\u5fd7\u4fe1\u606f\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\u3002</p> </li> <li> <p>BASIC\uff1a\u4ec5\u8bb0\u5f55\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0cURL\u4ee5\u53ca\u54cd\u5e94\u72b6\u6001\u7801\u548c\u6267\u884c\u65f6\u95f4</p> </li> <li> <p>HEADERS\uff1a\u5728BASIC\u7684\u57fa\u7840\u4e0a\uff0c\u989d\u5916\u8bb0\u5f55\u4e86\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5934\u4fe1\u606f</p> </li> <li> <p>FULL\uff1a\u8bb0\u5f55\u6240\u6709\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u660e\u7ec6\uff0c\u5305\u62ec\u5934\u4fe1\u606f\u3001\u8bf7\u6c42\u4f53\u3001\u5143\u6570\u636e\u3002</p> </li> </ul> <p></p> <p>Feign\u9ed8\u8ba4\u7684\u65e5\u5fd7\u7ea7\u522b\u5c31\u662fNONE\uff0c\u6240\u4ee5\u770b\u4e0d\u5230\u8bf7\u6c42\u65e5\u5fd7\u3002</p> <p>\u5728api\u6a21\u5757\u4e0b\u65b0\u5efa\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u5b9a\u4e49Feign\u7684\u65e5\u5fd7\u7ea7\u522b\uff1a</p> <pre><code>public class DefaultFeignConfig {\n    @Bean\n    public Logger.Level feignLoggerLevel() {\n        return Logger.Level.FULL;\n    }\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u8981\u8ba9\u65e5\u5fd7\u7ea7\u522b\u751f\u6548\uff0c\u8fd8\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u7c7b\u3002\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u5c40\u90e8\u751f\u6548\uff1a\u5728\u67d0\u4e2a<code>FeignClient</code>\u4e2d\u914d\u7f6e\uff0c\u53ea\u5bf9\u5f53\u524d<code>FeignClient</code>\u751f\u6548</li> </ul> <pre><code>@FeignClient(value = \"item-service\", configuration = DefaultFeignConfig.class)\n</code></pre> <ul> <li>\u5168\u5c40\u751f\u6548\uff1a\u5728<code>@EnableFeignClients</code>\u4e2d\u914d\u7f6e\uff0c\u9488\u5bf9\u6240\u6709<code>FeignClient</code>\u751f\u6548\u3002</li> </ul> <pre><code>@EnableFeignClients(defaultConfiguration = DefaultFeignConfig.class)\n</code></pre> <p>Tip</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u65e0\u9700\u5f00\u542f\u65e5\u5fd7\uff0c\u8c03\u8bd5\u65f6\u624d\u9700\u5f00\u542f</p> <p>\u4e0a\u4e00\u8282\uff1a\u670d\u52a1\u6cbb\u7406</p> <p>\u4e0b\u4e00\u8282\uff1a\u7f51\u5173</p>"},{"location":"SpringCloud/Overview/","title":"Spring Cloud \u6982\u8ff0\u4e0e\u5fae\u670d\u52a1\u67b6\u6784","text":""},{"location":"SpringCloud/Overview/#spring-cloud-\u7b80\u4ecb","title":"Spring Cloud \u7b80\u4ecb","text":"<p>Spring Cloud \u662f\u4e00\u7cfb\u5217\u6846\u67b6\u7684\u6709\u5e8f\u96c6\u5408\uff0c\u5b83\u5229\u7528 Spring Boot \u7684\u5f00\u53d1\u4fbf\u5229\u6027\u7b80\u5316\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5f00\u53d1\uff0c\u6bd4\u5982\u670d\u52a1\u53d1\u73b0\u3001\u670d\u52a1\u7f51\u5173\u3001\u670d\u52a1\u8def\u7531\u3001\u94fe\u8def\u8ffd\u8e2a\u7b49\u3002Spring Cloud \u5e76\u4e0d\u91cd\u590d\u9020\u8f6e\u5b50\uff0c\u800c\u662f\u5c06\u5e02\u9762\u4e0a\u5f00\u53d1\u5f97\u6bd4\u8f83\u597d\u7684\u6a21\u5757\u96c6\u6210\u8fdb\u53bb\uff0c\u8fdb\u884c\u5c01\u88c5\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5404\u6a21\u5757\u7684\u5f00\u53d1\u6210\u672c\u3002\u6362\u53e5\u8bdd\u8bf4\uff1aSpring Cloud \u63d0\u4f9b\u4e86\u6784\u5efa\u5206\u5e03\u5f0f\u7cfb\u7edf\u6240\u9700\u7684\"\u5168\u5bb6\u6876\"\u3002</p>"},{"location":"SpringCloud/Overview/#\u5fae\u670d\u52a1\u67b6\u6784","title":"\u5fae\u670d\u52a1\u67b6\u6784","text":""},{"location":"SpringCloud/Overview/#\u6982\u5ff5","title":"\u6982\u5ff5","text":"<p>\u5fae\u670d\u52a1\u67b6\u6784\uff08Microservice Architecture\uff09\u662f\u4e00\u79cd\u67b6\u6784\u6982\u5ff5\uff0c\u65e8\u5728\u901a\u8fc7\u5c06\u529f\u80fd\u5206\u89e3\u5230\u5404\u4e2a\u79bb\u6563\u7684\u670d\u52a1\u4e2d\u4ee5\u5b9e\u73b0\u5bf9\u89e3\u51b3\u65b9\u6848\u7684\u89e3\u8026\u3002\u4f60\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u662f\u5728\u67b6\u6784\u5c42\u6b21\u800c\u975e\u83b7\u53d6\u670d\u52a1\u7684\u7c7b\u4e0a\u5e94\u7528\u5f88\u591aSOLID\u539f\u5219\u3002\u5fae\u670d\u52a1\u67b6\u6784\u662f\u4e2a\u5f88\u6709\u8da3\u7684\u6982\u5ff5\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5c06\u529f\u80fd\u5206\u89e3\u5230\u79bb\u6563\u7684\u5404\u4e2a\u670d\u52a1\u5f53\u4e2d\uff0c\u4ece\u800c\u964d\u4f4e\u7cfb\u7edf\u7684\u8026\u5408\u6027\uff0c\u5e76\u63d0\u4f9b\u66f4\u52a0\u7075\u6d3b\u7684\u670d\u52a1\u652f\u6301\u3002</p> <p>\u6838\u5fc3\u6982\u5ff5\uff1a \u628a\u4e00\u4e2a\u5927\u578b\u7684\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u62c6\u5206\u4e3a\u6570\u4e2a\u751a\u81f3\u6570\u5341\u4e2a\u7684\u652f\u6301\u5fae\u670d\u52a1\uff0c\u5b83\u53ef\u6269\u5c55\u5355\u4e2a\u7ec4\u4ef6\u800c\u4e0d\u662f\u6574\u4e2a\u7684\u5e94\u7528\u7a0b\u5e8f\u5806\u6808\uff0c\u4ece\u800c\u6ee1\u8db3\u670d\u52a1\u7b49\u7ea7\u534f\u8bae\u3002</p>"},{"location":"SpringCloud/Overview/#\u5fae\u670d\u52a1\u7684\u4f18\u52bf","title":"\u5fae\u670d\u52a1\u7684\u4f18\u52bf","text":"<ul> <li>\u6280\u672f\u6808\u7075\u6d3b\uff1a\u6bcf\u4e2a\u670d\u52a1\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u6280\u672f\u6808</li> <li>\u72ec\u7acb\u90e8\u7f72\uff1a\u670d\u52a1\u53ef\u4ee5\u72ec\u7acb\u90e8\u7f72\u548c\u5347\u7ea7</li> <li>\u6545\u969c\u9694\u79bb\uff1a\u5355\u4e2a\u670d\u52a1\u6545\u969c\u4e0d\u4f1a\u5f71\u54cd\u6574\u4e2a\u7cfb\u7edf</li> <li>\u56e2\u961f\u72ec\u7acb\uff1a\u4e0d\u540c\u56e2\u961f\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u7ef4\u62a4\u670d\u52a1</li> <li>\u53ef\u6269\u5c55\u6027\u5f3a\uff1a\u53ef\u4ee5\u9488\u5bf9\u6027\u5730\u6269\u5c55\u9ad8\u8d1f\u8f7d\u670d\u52a1</li> </ul>"},{"location":"SpringCloud/Overview/#\u5fae\u670d\u52a1\u7684\u6311\u6218","title":"\u5fae\u670d\u52a1\u7684\u6311\u6218","text":"<ul> <li>\u590d\u6742\u6027\u589e\u52a0\uff1a\u5206\u5e03\u5f0f\u7cfb\u7edf\u56fa\u6709\u7684\u590d\u6742\u6027</li> <li>\u7f51\u7edc\u5ef6\u8fdf\uff1a\u670d\u52a1\u95f4\u8c03\u7528\u6d89\u53ca\u7f51\u7edc\u5f00\u9500</li> <li>\u6570\u636e\u4e00\u81f4\u6027\uff1a\u5206\u5e03\u5f0f\u4e8b\u52a1\u5904\u7406\u590d\u6742</li> <li>\u8fd0\u7ef4\u590d\u6742\uff1a\u9700\u8981\u66f4\u590d\u6742\u7684\u76d1\u63a7\u548c\u8fd0\u7ef4\u4f53\u7cfb</li> </ul>"},{"location":"SpringCloud/Overview/#spring-cloud-\u6838\u5fc3\u7ec4\u4ef6","title":"Spring Cloud \u6838\u5fc3\u7ec4\u4ef6","text":""},{"location":"SpringCloud/Overview/#\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0","title":"\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0","text":"<ul> <li>Eureka\uff1aNetflix \u5f00\u6e90\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3</li> <li>Nacos\uff1a\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u670d\u52a1\u6ce8\u518c\u548c\u914d\u7f6e\u7ba1\u7406</li> <li>Consul\uff1aHashiCorp \u5f00\u6e90\u7684\u670d\u52a1\u53d1\u73b0\u5de5\u5177</li> </ul>"},{"location":"SpringCloud/Overview/#\u670d\u52a1\u8c03\u7528","title":"\u670d\u52a1\u8c03\u7528","text":"<ul> <li>Ribbon\uff1a\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861\u5668</li> <li>Feign/OpenFeign\uff1a\u58f0\u660e\u5f0f\u670d\u52a1\u8c03\u7528\u5ba2\u6237\u7aef</li> <li>LoadBalancer\uff1aSpring Cloud \u65b0\u7684\u8d1f\u8f7d\u5747\u8861\u5668</li> </ul>"},{"location":"SpringCloud/Overview/#\u670d\u52a1\u4fdd\u62a4","title":"\u670d\u52a1\u4fdd\u62a4","text":"<ul> <li>Hystrix\uff1aNetflix \u5f00\u6e90\u7684\u7194\u65ad\u5668\uff08\u5df2\u505c\u6b62\u7ef4\u62a4\uff09</li> <li>Sentinel\uff1a\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u6d41\u91cf\u9632\u62a4\u7ec4\u4ef6</li> </ul>"},{"location":"SpringCloud/Overview/#api-\u7f51\u5173","title":"API \u7f51\u5173","text":"<ul> <li>Zuul\uff1aNetflix \u5f00\u6e90\u7684 API \u7f51\u5173\uff08\u5df2\u505c\u6b62\u7ef4\u62a4\uff09</li> <li>Gateway\uff1aSpring Cloud \u5b98\u65b9\u7f51\u5173</li> </ul>"},{"location":"SpringCloud/Overview/#\u914d\u7f6e\u7ba1\u7406","title":"\u914d\u7f6e\u7ba1\u7406","text":"<ul> <li>Config\uff1aSpring Cloud \u914d\u7f6e\u4e2d\u5fc3</li> <li>Nacos Config\uff1aNacos \u7684\u914d\u7f6e\u7ba1\u7406\u529f\u80fd</li> </ul>"},{"location":"SpringCloud/Overview/#\u94fe\u8def\u8ffd\u8e2a","title":"\u94fe\u8def\u8ffd\u8e2a","text":"<ul> <li>Sleuth\uff1a\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a</li> <li>Zipkin\uff1a\u94fe\u8def\u8ffd\u8e2a\u6570\u636e\u6536\u96c6\u548c\u5c55\u793a</li> </ul>"},{"location":"SpringCloud/Overview/#\u6280\u672f\u9009\u578b\u5efa\u8bae","title":"\u6280\u672f\u9009\u578b\u5efa\u8bae","text":""},{"location":"SpringCloud/Overview/#\u963f\u91cc\u5df4\u5df4\u6280\u672f\u6808\u63a8\u8350","title":"\u963f\u91cc\u5df4\u5df4\u6280\u672f\u6808\uff08\u63a8\u8350\uff09","text":"<ul> <li>\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\uff1aNacos</li> <li>\u670d\u52a1\u4fdd\u62a4\uff1aSentinel  </li> <li>API \u7f51\u5173\uff1aSpring Cloud Gateway</li> <li>\u670d\u52a1\u8c03\u7528\uff1aOpenFeign + LoadBalancer</li> </ul>"},{"location":"SpringCloud/Overview/#netflix-\u6280\u672f\u6808\u7ecf\u5178","title":"Netflix \u6280\u672f\u6808\uff08\u7ecf\u5178\uff09","text":"<ul> <li>\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\uff1aEureka</li> <li>\u670d\u52a1\u4fdd\u62a4\uff1aHystrix\uff08\u4e0d\u63a8\u8350\u65b0\u9879\u76ee\u4f7f\u7528\uff09</li> <li>API \u7f51\u5173\uff1aZuul\uff08\u4e0d\u63a8\u8350\u65b0\u9879\u76ee\u4f7f\u7528\uff09</li> <li>\u670d\u52a1\u8c03\u7528\uff1aRibbon + Feign</li> </ul>"},{"location":"SpringCloud/%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1/","title":"\u5355\u4f53\u67b6\u6784\u4e0e\u5fae\u670d\u52a1","text":""},{"location":"SpringCloud/%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u5355\u4f53\u67b6\u6784","title":"\u5355\u4f53\u67b6\u6784","text":"<p>\u5355\u4f53\u67b6\u6784\uff08monolithic structure\uff09\uff1a\u987e\u540d\u601d\u4e49\uff0c\u6574\u4e2a\u9879\u76ee\u4e2d\u6240\u6709\u529f\u80fd\u6a21\u5757\u90fd\u5728\u4e00\u4e2a\u5de5\u7a0b\u4e2d\u5f00\u53d1\uff1b\u9879\u76ee\u90e8\u7f72\u65f6\u9700\u8981\u5bf9\u6240\u6709\u6a21\u5757\u4e00\u8d77\u7f16\u8bd1\u3001\u6253\u5305\uff1b\u9879\u76ee\u7684\u67b6\u6784\u8bbe\u8ba1\u3001\u5f00\u53d1\u6a21\u5f0f\u90fd\u975e\u5e38\u7b80\u5355\u3002</p> <p>\u5f53\u9879\u76ee\u89c4\u6a21\u8f83\u5c0f\u65f6\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e0a\u624b\u5feb\uff0c\u90e8\u7f72\u3001\u8fd0\u7ef4\u4e5f\u90fd\u5f88\u65b9\u4fbf\uff0c\u56e0\u6b64\u65e9\u671f\u5f88\u591a\u5c0f\u578b\u9879\u76ee\u90fd\u91c7\u7528\u8fd9\u79cd\u6a21\u5f0f\u3002</p> <p></p> <p>\u4f46\u968f\u7740\u9879\u76ee\u7684\u4e1a\u52a1\u89c4\u6a21\u8d8a\u6765\u8d8a\u5927\uff0c\u56e2\u961f\u5f00\u53d1\u4eba\u5458\u4e5f\u4e0d\u65ad\u589e\u52a0\uff0c\u5355\u4f53\u67b6\u6784\u5c31\u5448\u73b0\u51fa\u8d8a\u6765\u8d8a\u591a\u7684\u95ee\u9898\uff1a</p> <ul> <li> <p>\u56e2\u961f\u534f\u4f5c\u6210\u672c\u9ad8\uff1a\u8bd5\u60f3\u4e00\u4e0b\uff0c\u56e2\u961f\u6570\u5341\u4e2a\u4eba\u540c\u65f6\u534f\u4f5c\u5f00\u53d1\u540c\u4e00\u4e2a\u9879\u76ee\uff0c\u7531\u4e8e\u6240\u6709\u6a21\u5757\u90fd\u5728\u4e00\u4e2a\u9879\u76ee\u4e2d\uff0c\u4e0d\u540c\u6a21\u5757\u7684\u4ee3\u7801\u4e4b\u95f4\u7269\u7406\u8fb9\u754c\u8d8a\u6765\u8d8a\u6a21\u7cca\u3002\u6700\u7ec8\u8981\u628a\u529f\u80fd\u5408\u5e76\u5230\u4e00\u4e2a\u5206\u652f\uff0c\u4f60\u7edd\u5bf9\u4f1a\u9677\u5165\u5230\u89e3\u51b3\u51b2\u7a81\u7684\u6ce5\u6f6d\u4e4b\u4e2d\u3002</p> </li> <li> <p>\u7cfb\u7edf\u53d1\u5e03\u6548\u7387\u4f4e\uff1a\u4efb\u4f55\u6a21\u5757\u53d8\u66f4\u90fd\u9700\u8981\u53d1\u5e03\u6574\u4e2a\u7cfb\u7edf\uff0c\u800c\u7cfb\u7edf\u53d1\u5e03\u8fc7\u7a0b\u4e2d\u9700\u8981\u591a\u4e2a\u6a21\u5757\u4e4b\u95f4\u5236\u7ea6\u8f83\u591a\uff0c\u9700\u8981\u5bf9\u6bd4\u5404\u79cd\u6587\u4ef6\uff0c\u4efb\u4f55\u4e00\u5904\u51fa\u73b0\u95ee\u9898\u90fd\u4f1a\u5bfc\u81f4\u53d1\u5e03\u5931\u8d25\uff0c\u5f80\u5f80\u4e00\u6b21\u53d1\u5e03\u9700\u8981\u6570\u5341\u5206\u949f\u751a\u81f3\u6570\u5c0f\u65f6\u3002</p> </li> <li> <p>\u7cfb\u7edf\u53ef\u7528\u6027\u5dee\uff1a\u5355\u4f53\u67b6\u6784\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u662f\u4f5c\u4e3a\u4e00\u4e2a\u670d\u52a1\u90e8\u7f72\uff0c\u76f8\u4e92\u4e4b\u95f4\u4f1a\u4e92\u76f8\u5f71\u54cd\uff0c\u4e00\u4e9b\u70ed\u70b9\u529f\u80fd\u4f1a\u8017\u5c3d\u7cfb\u7edf\u8d44\u6e90\uff0c\u5bfc\u81f4\u5176\u5b83\u670d\u52a1\u4f4e\u53ef\u7528\u3002</p> </li> </ul> <p></p>"},{"location":"SpringCloud/%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1/#\u5fae\u670d\u52a1\u67b6\u6784","title":"\u5fae\u670d\u52a1\u67b6\u6784","text":"<p>\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u9996\u5148\u662f\u670d\u52a1\u5316\uff0c\u5c31\u662f\u5c06\u5355\u4f53\u67b6\u6784\u4e2d\u7684\u529f\u80fd\u6a21\u5757\u4ece\u5355\u4f53\u5e94\u7528\u4e2d\u62c6\u5206\u51fa\u6765\uff0c\u72ec\u7acb\u90e8\u7f72\u4e3a\u591a\u4e2a\u670d\u52a1\u3002\u540c\u65f6\u8981\u6ee1\u8db3\u4e0b\u9762\u7684\u4e00\u4e9b\u7279\u70b9\uff1a</p> <ul> <li> <p>\u5355\u4e00\u804c\u8d23\uff1a\u4e00\u4e2a\u5fae\u670d\u52a1\u8d1f\u8d23\u4e00\u90e8\u5206\u4e1a\u52a1\u529f\u80fd\uff0c\u5e76\u4e14\u5176\u6838\u5fc3\u6570\u636e\u4e0d\u4f9d\u8d56\u4e8e\u5176\u5b83\u6a21\u5757\u3002</p> </li> <li> <p>\u56e2\u961f\u81ea\u6cbb\uff1a\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u53d1\u5e03\u3001\u8fd0\u7ef4\u4eba\u5458\uff0c\u56e2\u961f\u4eba\u5458\u89c4\u6a21\u4e0d\u8d85\u8fc710\u4eba\u3002</p> </li> <li> <p>\u670d\u52a1\u81ea\u6cbb\uff1a\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u72ec\u7acb\u6253\u5305\u90e8\u7f72\uff0c\u8bbf\u95ee\u81ea\u5df1\u72ec\u7acb\u7684\u6570\u636e\u5e93\u3002\u5e76\u4e14\u8981\u505a\u597d\u670d\u52a1\u9694\u79bb\uff0c\u907f\u514d\u5bf9\u5176\u5b83\u670d\u52a1\u4ea7\u751f\u5f71\u54cd\u3002</p> </li> </ul> <p></p> <p>\u90a3\u4e48\uff0c\u5355\u4f53\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898\u6709\u6ca1\u6709\u89e3\u51b3\u5462\uff1f</p> <ul> <li> <p>\u56e2\u961f\u534f\u4f5c\u6210\u672c\u9ad8\uff1f</p> <ul> <li>\u7531\u4e8e\u670d\u52a1\u62c6\u5206\uff0c\u6bcf\u4e2a\u670d\u52a1\u4ee3\u7801\u91cf\u5927\u5927\u51cf\u5c11\uff0c\u53c2\u4e0e\u5f00\u53d1\u7684\u540e\u53f0\u4eba\u5458\u57281~3\u540d\uff0c\u534f\u4f5c\u6210\u672c\u5927\u5927\u964d\u4f4e</li> </ul> </li> <li> <p>\u7cfb\u7edf\u53d1\u5e03\u6548\u7387\u4f4e\uff1f</p> <ul> <li>\u6bcf\u4e2a\u670d\u52a1\u90fd\u662f\u72ec\u7acb\u90e8\u7f72\uff0c\u5f53\u6709\u67d0\u4e2a\u670d\u52a1\u6709\u4ee3\u7801\u53d8\u66f4\u65f6\uff0c\u53ea\u9700\u8981\u6253\u5305\u90e8\u7f72\u8be5\u670d\u52a1\u5373\u53ef</li> </ul> </li> <li> <p>\u7cfb\u7edf\u53ef\u7528\u6027\u5dee\uff1f</p> <ul> <li>\u6bcf\u4e2a\u670d\u52a1\u72ec\u7acb\u90e8\u7f72\uff0c\u5e76\u4e14\u505a\u597d\u670d\u52a1\u9694\u79bb\uff0c\u4f7f\u7528\u81ea\u5df1\u7684\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u5b83\u670d\u52a1\u3002</li> </ul> </li> </ul> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u89e3\u51b3\u4e86\u5355\u4f53\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898\uff0c\u7279\u522b\u9002\u5408\u5927\u578b\u4e92\u8054\u7f51\u9879\u76ee\u7684\u5f00\u53d1\uff0c\u56e0\u6b64\u88ab\u5404\u5927\u4e92\u8054\u7f51\u516c\u53f8\u666e\u904d\u91c7\u7528\u3002</p> <p>\u5927\u5bb6\u4ee5\u524d\u53ef\u80fd\u542c\u8bf4\u8fc7\u5206\u5e03\u5f0f\u67b6\u6784\uff0c\u5206\u5e03\u5f0f\u5c31\u662f\u670d\u52a1\u62c6\u5206\u7684\u8fc7\u7a0b\uff0c\u5176\u5b9e\u5fae\u670d\u52a1\u67b6\u6784\u6b63\u662f\u5206\u5e03\u5f0f\u67b6\u6784\u7684\u4e00\u79cd\u6700\u4f73\u5b9e\u8df5\u7684\u65b9\u6848\u3002</p> <p>\u5f53\u7136\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u867d\u7136\u80fd\u89e3\u51b3\u5355\u4f53\u67b6\u6784\u7684\u5404\u79cd\u95ee\u9898\uff0c\u4f46\u5728\u62c6\u5206\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u4f1a\u9762\u4e34\u5f88\u591a\u5176\u5b83\u95ee\u9898\u3002\u6bd4\u5982\uff1a</p> <ul> <li> <p>\u5982\u679c\u51fa\u73b0\u8de8\u670d\u52a1\u7684\u4e1a\u52a1\u8be5\u5982\u4f55\u5904\u7406\uff1f</p> </li> <li> <p>\u9875\u9762\u8bf7\u6c42\u5230\u5e95\u8be5\u8bbf\u95ee\u54ea\u4e2a\u670d\u52a1\uff1f</p> </li> <li> <p>\u5982\u4f55\u5b9e\u73b0\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u670d\u52a1\u9694\u79bb\uff1f</p> </li> </ul> <p>\u63a5\u4e0b\u6765\u5c06\u9010\u6b65\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u7684\u3002</p>"},{"location":"SpringCloud/%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1/#spring-cloud","title":"Spring Cloud","text":"<p>\u5fae\u670d\u52a1\u62c6\u5206\u4ee5\u540e\u78b0\u5230\u7684\u5404\u79cd\u95ee\u9898\u90fd\u6709\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\u548c\u5fae\u670d\u52a1\u7ec4\u4ef6\uff0c\u800cSpringCloud\u6846\u67b6\u53ef\u4ee5\u8bf4\u662f\u76ee\u524dJava\u9886\u57df\u6700\u5168\u9762\u7684\u5fae\u670d\u52a1\u7ec4\u4ef6\u7684\u96c6\u5408\u4e86\u3002</p> <p></p> <p>\u800c\u4e14SpringCloud\u4f9d\u6258\u4e8eSpringBoot\u7684\u81ea\u52a8\u88c5\u914d\u80fd\u529b\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u5176\u9879\u76ee\u642d\u5efa\u3001\u7ec4\u4ef6\u4f7f\u7528\u7684\u6210\u672c\u3002\u5bf9\u4e8e\u6ca1\u6709\u81ea\u7814\u5fae\u670d\u52a1\u7ec4\u4ef6\u80fd\u529b\u7684\u4e2d\u5c0f\u578b\u4f01\u4e1a\uff0c\u4f7f\u7528SpringCloud\u5168\u5bb6\u6876\u6765\u5b9e\u73b0\u5fae\u670d\u52a1\u5f00\u53d1\u53ef\u4ee5\u8bf4\u662f\u6700\u5408\u9002\u7684\u9009\u62e9\u4e86\uff01</p> <p>\u4e0b\u4e00\u8282\uff1a\u670d\u52a1\u62c6\u5206</p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/","title":"\u670d\u52a1\u4fdd\u62a4","text":""},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5b58\u5728\u7684\u95ee\u9898","title":"\u5b58\u5728\u7684\u95ee\u9898","text":"<p>\u5728\u5fae\u670d\u52a1\u8fdc\u7a0b\u8c03\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u5b58\u5728\u51e0\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\u3002</p> <ul> <li>\u4e1a\u52a1\u5065\u58ee\u6027</li> </ul> <p>\u67d0\u670d\u52a1\u6545\u969c\uff0c\u8c03\u7528\u8be5\u670d\u52a1\u7684\u670d\u52a1\u4e5f\u5e94\u8be5\u5f97\u5230\u6570\u636e</p> <ul> <li>\u7ea7\u8054\u5931\u8d25(\u96ea\u5d29\u95ee\u9898)</li> </ul> <p>\u5982\u670d\u52a1\u4e1a\u52a1\u5e76\u53d1\u8f83\u9ad8\uff0c\u5360\u7528\u8fc7\u591aTomcat\u8fde\u63a5\u3002\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u7684\u6240\u6709\u63a5\u53e3\u54cd\u5e94\u65f6\u95f4\u589e\u52a0\uff0c\u5ef6\u8fdf\u53d8\u9ad8\uff0c\u751a\u81f3\u662f\u957f\u65f6\u95f4\u963b\u585e\u76f4\u81f3\u67e5\u8be2\u5931\u8d25\u3002</p> <p></p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u96ea\u5d29\u95ee\u9898\u89e3\u51b3\u65b9\u6848","title":"\u96ea\u5d29\u95ee\u9898\u89e3\u51b3\u65b9\u6848","text":""},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u8bf7\u6c42\u9650\u6d41","title":"\u8bf7\u6c42\u9650\u6d41","text":"<p>\u670d\u52a1\u6545\u969c\u6700\u91cd\u8981\u539f\u56e0\uff0c\u5c31\u662f\u5e76\u53d1\u592a\u9ad8\uff01\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u80fd\u907f\u514d\u5927\u90e8\u5206\u6545\u969c\u3002\u56e0\u6b64\u9700\u8981\u5bf9\u8bf7\u6c42\u9650\u6d41\uff0c\u9650\u5236\u6216\u63a7\u5236\u63a5\u53e3\u8bbf\u95ee\u7684\u5e76\u53d1\u6d41\u91cf\uff0c\u907f\u514d\u670d\u52a1\u56e0\u6d41\u91cf\u6fc0\u589e\u800c\u51fa\u73b0\u6545\u969c\u3002</p> <p>\u8bf7\u6c42\u9650\u6d41\u5f80\u5f80\u4f1a\u6709\u4e00\u4e2a\u9650\u6d41\u5668\uff0c\u6570\u91cf\u9ad8\u4f4e\u8d77\u4f0f\u7684\u5e76\u53d1\u8bf7\u6c42\u66f2\u7ebf\uff0c\u7ecf\u8fc7\u9650\u6d41\u5668\u5c31\u53d8\u7684\u975e\u5e38\u5e73\u7a33\u3002\u8fd9\u5c31\u50cf\u662f\u6c34\u7535\u7ad9\u7684\u5927\u575d\uff0c\u8d77\u5230\u84c4\u6c34\u7684\u4f5c\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u5f00\u5173\u63a7\u5236\u6c34\u6d41\u51fa\u7684\u5927\u5c0f\uff0c\u8ba9\u4e0b\u6e38\u6c34\u6d41\u59cb\u7ec8\u7ef4\u6301\u5728\u4e00\u4e2a\u5e73\u7a33\u7684\u91cf\u3002</p> <p></p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u7ebf\u7a0b\u9694\u79bb","title":"\u7ebf\u7a0b\u9694\u79bb","text":"<p>\u5f53\u4e00\u4e2a\u4e1a\u52a1\u63a5\u53e3\u54cd\u5e94\u65f6\u95f4\u957f\uff0c\u800c\u4e14\u5e76\u53d1\u9ad8\u65f6\uff0c\u5c31\u53ef\u80fd\u8017\u5c3d\u670d\u52a1\u5668\u7684\u7ebf\u7a0b\u8d44\u6e90\uff0c\u5bfc\u81f4\u670d\u52a1\u5185\u7684\u5176\u5b83\u63a5\u53e3\u53d7\u5230\u5f71\u54cd\u3002\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u628a\u8fd9\u79cd\u5f71\u54cd\u964d\u4f4e\uff0c\u6216\u8005\u7f29\u51cf\u5f71\u54cd\u7684\u8303\u56f4\u3002\u7ebf\u7a0b\u9694\u79bb\u6b63\u662f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u597d\u529e\u6cd5\u3002</p> <p></p> <p>\u7ebf\u7a0b\u9694\u79bb\u7684\u601d\u60f3\u6765\u81ea\u8f6e\u8239\u7684\u8231\u58c1\u6a21\u5f0f\uff1a</p> <p>\u8f6e\u8239\u7684\u8239\u8231\u4f1a\u88ab\u9694\u677f\u5206\u5272\u4e3aN\u4e2a\u76f8\u4e92\u9694\u79bb\u7684\u5bc6\u95ed\u8231\uff0c\u5047\u5982\u8f6e\u8239\u89e6\u7901\u8fdb\u6c34\uff0c\u53ea\u6709\u635f\u574f\u7684\u90e8\u5206\u5bc6\u95ed\u8231\u4f1a\u8fdb\u6c34\uff0c\u800c\u5176\u4ed6\u8231\u7531\u4e8e\u76f8\u4e92\u9694\u79bb\uff0c\u5e76\u4e0d\u4f1a\u8fdb\u6c34\u3002\u8fd9\u6837\u5c31\u628a\u8fdb\u6c34\u63a7\u5236\u5728\u90e8\u5206\u8239\u4f53\uff0c\u907f\u514d\u4e86\u6574\u4e2a\u8239\u8231\u8fdb\u6c34\u800c\u6c89\u6ca1\u3002</p> <p></p> <p>\u4e3a\u4e86\u907f\u514d\u67d0\u4e2a\u63a5\u53e3\u6545\u969c\u6216\u538b\u529b\u8fc7\u5927\u5bfc\u81f4\u6574\u4e2a\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u9650\u5b9a\u6bcf\u4e2a\u63a5\u53e3\u53ef\u4ee5\u4f7f\u7528\u7684\u8d44\u6e90\u8303\u56f4\uff0c\u4e5f\u5c31\u662f\u5c06\u5176\u201c\u9694\u79bb\u201d\u8d77\u6765\u3002</p> <p></p> <p>Note</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6211\u4eec\u7ed9\u67e5\u8be2\u8d2d\u7269\u8f66\u4e1a\u52a1\u9650\u5b9a\u53ef\u7528\u7ebf\u7a0b\u6570\u91cf\u4e0a\u9650\u4e3a20\uff0c\u8fd9\u6837\u5373\u4fbf\u67e5\u8be2\u8d2d\u7269\u8f66\u7684\u8bf7\u6c42\u56e0\u4e3a\u67e5\u8be2\u5546\u54c1\u670d\u52a1\u800c\u51fa\u73b0\u6545\u969c\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u7684\u7ebf\u7a0b\u8d44\u6e90\u88ab\u8017\u5c3d\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u5b83\u63a5\u53e3\u3002</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u670d\u52a1\u7194\u65ad","title":"\u670d\u52a1\u7194\u65ad","text":"<p>\u7ebf\u7a0b\u9694\u79bb\u867d\u7136\u907f\u514d\u4e86\u96ea\u5d29\u95ee\u9898\uff0c\u4f46\u6545\u969c\u670d\u52a1\uff08\u5546\u54c1\u670d\u52a1\uff09\u4f9d\u7136\u4f1a\u62d6\u6162\u8d2d\u7269\u8f66\u670d\u52a1\uff08\u670d\u52a1\u8c03\u7528\u65b9\uff09\u7684\u63a5\u53e3\u54cd\u5e94\u901f\u5ea6\u3002\u800c\u4e14\u5546\u54c1\u67e5\u8be2\u7684\u6545\u969c\u4e5f\u4f1a\u5bfc\u81f4\u67e5\u8be2\u8d2d\u7269\u8f66\u529f\u80fd\u51fa\u73b0\u6545\u969c\uff0c\u8d2d\u7269\u8f66\u4e1a\u52a1\u4e5f\u53d8\u7684\u4e0d\u53ef\u7528\u4e86\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u7f16\u5199\u670d\u52a1\u964d\u7ea7\u903b\u8f91\uff1a\u5c31\u662f\u670d\u52a1\u8c03\u7528\u5931\u8d25\u540e\u7684\u5904\u7406\u903b\u8f91\uff0c\u6839\u636e\u4e1a\u52a1\u573a\u666f\uff0c\u53ef\u4ee5\u629b\u51fa\u5f02\u5e38\uff0c\u4e5f\u53ef\u4ee5\u8fd4\u56de\u53cb\u597d\u63d0\u793a\u6216\u9ed8\u8ba4\u6570\u636e\u3002</p> </li> <li> <p>\u5f02\u5e38\u7edf\u8ba1\u548c\u7194\u65ad\uff1a\u7edf\u8ba1\u670d\u52a1\u63d0\u4f9b\u65b9\u7684\u5f02\u5e38\u6bd4\u4f8b\uff0c\u5f53\u6bd4\u4f8b\u8fc7\u9ad8\u8868\u660e\u8be5\u63a5\u53e3\u4f1a\u5f71\u54cd\u5230\u5176\u5b83\u670d\u52a1\uff0c\u5e94\u8be5\u62d2\u7edd\u8c03\u7528\u8be5\u63a5\u53e3\uff0c\u800c\u662f\u76f4\u63a5\u8d70\u964d\u7ea7\u903b\u8f91\u3002</p> </li> </ul> <p></p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#sentinel","title":"Sentinel","text":"<p>\u53c2\u8003\u8d44\u6599</p> <p>\u5fae\u670d\u52a1\u4fdd\u62a4\u7684\u6280\u672f\u6709\u5f88\u591a\uff0c\u4f46\u5728\u76ee\u524d\u56fd\u5185\u4f7f\u7528\u8f83\u591a\u7684\u8fd8\u662fSentinel</p> <p>Sentinel\u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e00\u6b3e\u670d\u52a1\u4fdd\u62a4\u6846\u67b6\uff0c\u76ee\u524d\u5df2\u7ecf\u52a0\u5165SpringCloudAlibaba\u4e2d\u3002\u5b98\u65b9\u7f51\u7ad9</p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u4ecb\u7ecd\u5b89\u88c5","title":"\u4ecb\u7ecd&amp;\u5b89\u88c5","text":"<p>Sentinel \u7684\u4f7f\u7528\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206:</p> <ul> <li> <p>\u6838\u5fc3\u5e93\uff08Jar\u5305\uff09\uff1a\u4e0d\u4f9d\u8d56\u4efb\u4f55\u6846\u67b6/\u5e93\uff0c\u80fd\u591f\u8fd0\u884c\u4e8e Java 8 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u540c\u65f6\u5bf9 Dubbo / Spring Cloud \u7b49\u6846\u67b6\u4e5f\u6709\u8f83\u597d\u7684\u652f\u6301\u3002\u5728\u9879\u76ee\u4e2d\u5f15\u5165\u4f9d\u8d56\u5373\u53ef\u5b9e\u73b0\u670d\u52a1\u9650\u6d41\u3001\u9694\u79bb\u3001\u7194\u65ad\u7b49\u529f\u80fd\u3002</p> </li> <li> <p>\u63a7\u5236\u53f0\uff08Dashboard\uff09\uff1aDashboard \u4e3b\u8981\u8d1f\u8d23\u7ba1\u7406\u63a8\u9001\u89c4\u5219\u3001\u76d1\u63a7\u3001\u7ba1\u7406\u673a\u5668\u4fe1\u606f\u7b49\u3002</p> </li> </ul> <p>\u63a7\u5236\u53f0jar\u5305\u4e0b\u8f7d\u5730\u5740</p> <p>\u8fd0\u884c</p> <pre><code>java -Dserver.port=8090 -Dcsp.sentinel.dashboard.server=localhost:8090 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar\n</code></pre> <p>\u8bbf\u95eehttp://localhost:8090\u9875\u9762\uff0c\u5c31\u53ef\u4ee5\u770b\u5230sentinel\u7684\u63a7\u5236\u53f0\u4e86\uff1a</p> <p>Tip</p> <p>\u8f93\u5165\u8d26\u53f7\u548c\u5bc6\u7801\uff0c\u9ed8\u8ba4\u90fd\u662f\uff1asentinel</p> <p>docker\u5b89\u88c5</p> <pre><code>docker run -d \\\n --name sentinel \\\n -p 8858:8858 \\\n --network work \\\n -d bladex/sentinel-dashboard\n</code></pre> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5fae\u670d\u52a1\u6574\u5408","title":"\u5fae\u670d\u52a1\u6574\u5408","text":"<p>1.\u670d\u52a1\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4f9d\u8d56</p> <pre><code>&lt;!--sentinel--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; \n    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>2.\u914d\u7f6e\u63a7\u5236\u53f0\u8fde\u63a5</p> <pre><code>spring:\n  cloud: \n    sentinel:\n      transport:\n        dashboard: localhost:8090\n</code></pre> <p>3.\u91cd\u542f\u670d\u52a1\uff0c\u7136\u540e\u8bbf\u95ee\u63a5\u53e3\uff0csentinel\u7684\u5ba2\u6237\u7aef\u5c31\u4f1a\u5c06\u670d\u52a1\u8bbf\u95ee\u7684\u4fe1\u606f\u63d0\u4ea4\u5230<code>sentinel-dashboard</code>\u63a7\u5236\u53f0\u3002\u5e76\u5c55\u793a\u51fa\u7edf\u8ba1\u4fe1\u606f</p> <p>\u70b9\u51fb\u7c07\u70b9\u94fe\u8def\u83dc\u5355\uff0c\u53ef\u4ee5\u770b\u5230\u63a5\u53e3\u8bf7\u6c42\u4fe1\u606f\uff08\u6240\u8c13\u7c07\u70b9\u94fe\u8def\uff0c\u5c31\u662f\u5355\u673a\u8c03\u7528\u94fe\u8def\uff0c\u662f\u4e00\u6b21\u8bf7\u6c42\u8fdb\u5165\u670d\u52a1\u540e\u7ecf\u8fc7\u7684\u6bcf\u4e00\u4e2a\u88ab<code>Sentinel</code>\u76d1\u63a7\u7684\u8d44\u6e90\uff09</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSpringMVC\u63a5\u53e3\u5982\u679c\u662f\u6309\u7167Restful\u98ce\u683c\u8bbe\u8ba1\uff0c\u53ef\u80fd\u5bfc\u81f4\u591a\u4e2a\u7c07\u70b9\u540d\u79f0\u76f8\u540c\uff0c\u53ef\u4ee5\u505a\u5982\u4e0b\u914d\u7f6e\u89e3\u51b3</p> <pre><code>spring:\n  cloud:\n    sentinel:\n      transport:\n        dashboard: localhost:8090\n      http-method-specify: true # \u5f00\u542f\u8bf7\u6c42\u65b9\u5f0f\u524d\u7f00\n</code></pre> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u8bf7\u6c42\u9650\u6d41_1","title":"\u8bf7\u6c42\u9650\u6d41","text":"<p>\u5728\u7c07\u70b9\u94fe\u8def\u540e\u9762\u70b9\u51fb\u6d41\u63a7\u6309\u94ae\uff0c\u5373\u53ef\u5bf9\u5176\u505a\u9650\u6d41\u914d\u7f6e</p> <p></p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u7ebf\u7a0b\u9694\u79bb_1","title":"\u7ebf\u7a0b\u9694\u79bb","text":"<p>\u9650\u6d41\u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u538b\u529b\uff0c\u5c3d\u91cf\u51cf\u5c11\u56e0\u5e76\u53d1\u6d41\u91cf\u5f15\u8d77\u7684\u670d\u52a1\u6545\u969c\u7684\u6982\u7387\uff0c\u4f46\u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u670d\u52a1\u6545\u969c\u3002\u4e00\u65e6\u67d0\u4e2a\u670d\u52a1\u51fa\u73b0\u6545\u969c\uff0c\u6211\u4eec\u5fc5\u987b\u9694\u79bb\u5bf9\u8fd9\u4e2a\u670d\u52a1\u7684\u8c03\u7528\uff0c\u907f\u514d\u53d1\u751f\u96ea\u5d29\u3002</p> <p>\u914d\u7f6e\u65b9\u5f0f\u540c\u8bf7\u6c42\u9650\u6d41\uff0c\u53ea\u9700\u5c06\u201c\u9608\u503c\u7c7b\u578b\u201d\u4fee\u6539\u4e3a\u201c\u5e76\u53d1\u7ebf\u7a0b\u6570\u201d</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#fallback","title":"Fallback","text":"<p>\u89e6\u53d1\u9650\u6d41\u6216\u7194\u65ad\u540e\u7684\u8bf7\u6c42\u4e0d\u4e00\u5b9a\u8981\u76f4\u63a5\u62a5\u9519\uff0c\u4e5f\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e9b\u9ed8\u8ba4\u6570\u636e\u6216\u8005\u53cb\u597d\u63d0\u793a\uff0c\u7528\u6237\u4f53\u9a8c\u4f1a\u66f4\u597d\u3002</p> <p>\u7ed9FeignClient\u7f16\u5199\u5931\u8d25\u540e\u7684\u964d\u7ea7\u903b\u8f91\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u65b9\u5f0f\u4e00\uff1aFallbackClass\uff0c\u65e0\u6cd5\u5bf9\u8fdc\u7a0b\u8c03\u7528\u7684\u5f02\u5e38\u505a\u5904\u7406</li> <li>\u65b9\u5f0f\u4e8c\uff1aFallbackFactory\uff0c\u53ef\u4ee5\u5bf9\u8fdc\u7a0b\u8c03\u7528\u7684\u5f02\u5e38\u505a\u5904\u7406\uff0c\u6211\u4eec\u4e00\u822c\u9009\u62e9\u8fd9\u79cd\u65b9\u5f0f\u3002</li> </ul> <p>\u6b65\u9aa4\u4e00\uff1a\u5b9a\u4e49\u964d\u7ea7\u5904\u7406\u7c7b\uff0c\u5b9e\u73b0<code>FallbackFactory</code>\uff1a</p> <pre><code>@Slf4j\npublic class ItemClientFallback implements FallbackFactory&lt;ItemClient&gt; {\n    @Override\n    public ItemClient create(Throwable cause) {\n        return new ItemClient() {\n            @Override\n            public List&lt;ItemDTO&gt; queryItemByIds(Collection&lt;Long&gt; ids) {\n                log.error(\"\u8fdc\u7a0b\u8c03\u7528ItemClient#queryItemByIds\u65b9\u6cd5\u51fa\u73b0\u5f02\u5e38\uff0c\u53c2\u6570\uff1a{}\", ids, cause);\n                // \u67e5\u8be2\u8d2d\u7269\u8f66\u5141\u8bb8\u5931\u8d25\uff0c\u67e5\u8be2\u5931\u8d25\uff0c\u8fd4\u56de\u7a7a\u96c6\u5408\n                return CollUtils.emptyList();\n            }\n\n            @Override\n            public void deductStock(List&lt;OrderDetailDTO&gt; items) {\n                // \u5e93\u5b58\u6263\u51cf\u4e1a\u52a1\u9700\u8981\u89e6\u53d1\u4e8b\u52a1\u56de\u6eda\uff0c\u67e5\u8be2\u5931\u8d25\uff0c\u629b\u51fa\u5f02\u5e38\n                throw new BizIllegalException(cause);\n            }\n        };\n    }\n}\n</code></pre> <p>\u6b65\u9aa4\u4e8c\uff1a\u5c06\u964d\u7ea7\u5904\u7406\u7c7b\u6ce8\u518c\u4e3a\u4e00\u4e2a<code>Bean</code>\uff1a</p> <pre><code>@Bean\npublic ItemClientFallback itemClientFallback(){\n    return new ItemClientFallback();\n}\n</code></pre> <p>\u6b65\u9aa4\u4e09\uff1a\u5728<code>ItemClient</code>\u63a5\u53e3\u4e2d\u4f7f\u7528<code>ItemClientFallbackFactory</code>\uff1a</p> <pre><code>@FeignClient(value = \"item-service\",\n        fallbackFactory = ItemClientFallback.class)\n</code></pre> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u670d\u52a1\u7194\u65ad_1","title":"\u670d\u52a1\u7194\u65ad","text":"<p>\u5bf9\u4e8e\u4e0d\u592a\u5065\u5eb7\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u5e94\u8be5\u505c\u6b62\u8c03\u7528\uff0c\u76f4\u63a5\u8d70\u964d\u7ea7\u903b\u8f91\uff0c\u907f\u514d\u5f71\u54cd\u5230\u5f53\u524d\u670d\u52a1\u3002\u4e5f\u5c31\u662f\u5c06\u5546\u54c1\u67e5\u8be2\u63a5\u53e3\u7194\u65ad\u3002\u5f53\u5546\u54c1\u670d\u52a1\u63a5\u53e3\u6062\u590d\u6b63\u5e38\u540e\uff0c\u518d\u5141\u8bb8\u8c03\u7528\u3002\u8fd9\u5176\u5b9e\u5c31\u662f\u65ad\u8def\u5668\u7684\u5de5\u4f5c\u6a21\u5f0f\u4e86\u3002</p> <p>Sentinel\u4e2d\u7684\u65ad\u8def\u5668\u4e0d\u4ec5\u53ef\u4ee5\u7edf\u8ba1\u67d0\u4e2a\u63a5\u53e3\u7684\u6162\u8bf7\u6c42\u6bd4\u4f8b\uff0c\u8fd8\u53ef\u4ee5\u7edf\u8ba1\u5f02\u5e38\u8bf7\u6c42\u6bd4\u4f8b\u3002\u5f53\u8fd9\u4e9b\u6bd4\u4f8b\u8d85\u51fa\u9608\u503c\u65f6\uff0c\u5c31\u4f1a\u7194\u65ad\u8be5\u63a5\u53e3\uff0c\u5373\u62e6\u622a\u8bbf\u95ee\u8be5\u63a5\u53e3\u7684\u4e00\u5207\u8bf7\u6c42\uff0c\u964d\u7ea7\u5904\u7406\uff1b\u5f53\u8be5\u63a5\u53e3\u6062\u590d\u6b63\u5e38\u65f6\uff0c\u518d\u653e\u884c\u5bf9\u4e8e\u8be5\u63a5\u53e3\u7684\u8bf7\u6c42\u3002</p> <p>\u65ad\u8def\u5668\u7684\u5de5\u4f5c\u72b6\u6001\u5207\u6362\u6709\u4e00\u4e2a\u72b6\u6001\u673a\u6765\u63a7\u5236\uff1a</p> <p></p> <p>\u72b6\u6001\u673a\u5305\u62ec\u4e09\u4e2a\u72b6\u6001\uff1a</p> <ul> <li>closed\uff1a\u5173\u95ed\u72b6\u6001\uff0c\u65ad\u8def\u5668\u653e\u884c\u6240\u6709\u8bf7\u6c42\uff0c\u5e76\u5f00\u59cb\u7edf\u8ba1\u5f02\u5e38\u6bd4\u4f8b\u3001\u6162\u8bf7\u6c42\u6bd4\u4f8b\u3002\u8d85\u8fc7\u9608\u503c\u5219\u5207\u6362\u5230open\u72b6\u6001</li> <li>open\uff1a\u6253\u5f00\u72b6\u6001\uff0c\u670d\u52a1\u8c03\u7528\u88ab\u7194\u65ad\uff0c\u8bbf\u95ee\u88ab\u7194\u65ad\u670d\u52a1\u7684\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\uff0c\u5feb\u901f\u5931\u8d25\uff0c\u76f4\u63a5\u8d70\u964d\u7ea7\u903b\u8f91\u3002Open\u72b6\u6001\u6301\u7eed\u4e00\u6bb5\u65f6\u95f4\u540e\u4f1a\u8fdb\u5165half-open\u72b6\u6001</li> <li>half-open\uff1a\u534a\u5f00\u72b6\u6001\uff0c\u653e\u884c\u4e00\u6b21\u8bf7\u6c42\uff0c\u6839\u636e\u6267\u884c\u7ed3\u679c\u6765\u5224\u65ad\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u3002 <ul> <li>\u8bf7\u6c42\u6210\u529f\uff1a\u5219\u5207\u6362\u5230closed\u72b6\u6001</li> <li>\u8bf7\u6c42\u5931\u8d25\uff1a\u5219\u5207\u6362\u5230open\u72b6\u6001</li> </ul> </li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u63a7\u5236\u53f0\u901a\u8fc7\u70b9\u51fb\u7c07\u70b9\u540e\u7684<code>\u7194\u65ad</code>\u6309\u94ae\u6765\u914d\u7f6e\u7194\u65ad\u7b56\u7565\uff1a</p> <p></p> <p>Tip</p> <p>\u8fd9\u79cd\u662f\u6309\u7167\u6162\u8c03\u7528\u6bd4\u4f8b\u6765\u505a\u7194\u65ad\uff0c\u4e0a\u8ff0\u914d\u7f6e\u7684\u542b\u4e49\u662f\uff1a</p> <ul> <li>RT\u8d85\u8fc7200\u6beb\u79d2\u7684\u8bf7\u6c42\u8c03\u7528\u5c31\u662f\u6162\u8c03\u7528</li> <li>\u7edf\u8ba1\u6700\u8fd11000ms\u5185\u7684\u6700\u5c115\u6b21\u8bf7\u6c42\uff0c\u5982\u679c\u6162\u8c03\u7528\u6bd4\u4f8b\u8d85\u8fc70.5\uff0c\u5219\u89e6\u53d1\u7194\u65ad</li> <li>\u7194\u65ad\u6301\u7eed\u65f6\u957f5s</li> </ul> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5206\u5e03\u5f0f\u4e8b\u52a1","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1","text":"<p>\u6574\u4e2a\u4e1a\u52a1\u4e2d\uff0c\u5404\u4e2a\u672c\u5730\u4e8b\u52a1\u662f\u6709\u5173\u8054\u7684\u3002\u56e0\u6b64\u6bcf\u4e2a\u5fae\u670d\u52a1\u7684\u672c\u5730\u4e8b\u52a1\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u5206\u652f\u4e8b\u52a1\u3002\u591a\u4e2a\u6709\u5173\u8054\u7684\u5206\u652f\u4e8b\u52a1\u4e00\u8d77\u5c31\u7ec4\u6210\u4e86\u5168\u5c40\u4e8b\u52a1\u3002\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6574\u4e2a\u5168\u5c40\u4e8b\u52a1\u540c\u65f6\u6210\u529f\u6216\u5931\u8d25\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u6bcf\u4e00\u4e2a\u5206\u652f\u4e8b\u52a1\u5c31\u662f\u4f20\u7edf\u7684\u5355\u4f53\u4e8b\u52a1\uff0c\u90fd\u53ef\u4ee5\u6ee1\u8db3ACID\u7279\u6027\uff0c\u4f46\u5168\u5c40\u4e8b\u52a1\u8de8\u8d8a\u591a\u4e2a\u670d\u52a1\u3001\u591a\u4e2a\u6570\u636e\u5e93\uff0c\u662f\u5426\u8fd8\u80fd\u6ee1\u8db3\u5462\uff1f</p> <p>\u4e8b\u52a1\u5e76\u672a\u9075\u5faaACID\u7684\u539f\u5219\uff0c\u5f52\u5176\u539f\u56e0\u5c31\u662f\u53c2\u4e0e\u4e8b\u52a1\u7684\u591a\u4e2a\u5b50\u4e1a\u52a1\u5728\u4e0d\u540c\u7684\u5fae\u670d\u52a1\uff0c\u8de8\u8d8a\u4e86\u4e0d\u540c\u7684\u6570\u636e\u5e93\u3002\u867d\u7136\u6bcf\u4e2a\u5355\u72ec\u7684\u4e1a\u52a1\u90fd\u80fd\u5728\u672c\u5730\u9075\u5faaACID\uff0c\u4f46\u662f\u5b83\u4eec\u4e92\u76f8\u4e4b\u95f4\u6ca1\u6709\u611f\u77e5\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u6700\u7ec8\u7ed3\u679c\u7684\u7edf\u4e00</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#seata","title":"Seata","text":"<p>Seata \u662f\u4ec0\u4e48\uff1f | Apache Seata</p> <p>\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u65b9\u6848\u6709\u5f88\u591a\uff0c\u4f46\u5b9e\u73b0\u8d77\u6765\u90fd\u6bd4\u8f83\u590d\u6742\uff0c\u56e0\u6b64\u6211\u4eec\u4e00\u822c\u4f1a\u4f7f\u7528\u5f00\u6e90\u7684\u6846\u67b6\u6765\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\u3002\u5728\u4f17\u591a\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6\u4e2d\uff0c\u529f\u80fd\u6700\u5b8c\u5584\u3001\u4f7f\u7528\u6700\u591a\u7684\u5c31\u662f\u963f\u91cc\u5df4\u5df4\u57282019\u5e74\u5f00\u6e90\u7684Seata\u4e86\u3002</p> <p></p> <p>\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u601d\u60f3\u975e\u5e38\u7b80\u5355\uff1a</p> <p>\u5c31\u662f\u627e\u4e00\u4e2a\u7edf\u4e00\u7684\u4e8b\u52a1\u534f\u8c03\u8005\uff0c\u4e0e\u591a\u4e2a\u5206\u652f\u4e8b\u52a1\u901a\u4fe1\uff0c\u68c0\u6d4b\u6bcf\u4e2a\u5206\u652f\u4e8b\u52a1\u7684\u6267\u884c\u72b6\u6001\uff0c\u4fdd\u8bc1\u5168\u5c40\u4e8b\u52a1\u4e0b\u7684\u6bcf\u4e00\u4e2a\u5206\u652f\u4e8b\u52a1\u540c\u65f6\u6210\u529f\u6216\u5931\u8d25\u5373\u53ef\u3002\u5927\u591a\u6570\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u7406\u8bba\u6765\u5b9e\u73b0\u7684\u3002</p> <p></p> <p>Seata\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5728Seata\u7684\u4e8b\u52a1\u7ba1\u7406\u4e2d\u6709\u4e09\u4e2a\u91cd\u8981\u7684\u89d2\u8272\uff1a</p> <ul> <li>TC (Transaction Coordinator) - \u4e8b\u52a1\u534f\u8c03\u8005\uff1a\u7ef4\u62a4\u5168\u5c40\u548c\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u534f\u8c03\u5168\u5c40\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002 </li> <li>TM (Transaction Manager) - \u4e8b\u52a1\u7ba1\u7406\u5668\uff1a\u5b9a\u4e49\u5168\u5c40\u4e8b\u52a1\u7684\u8303\u56f4\u3001\u5f00\u59cb\u5168\u5c40\u4e8b\u52a1\u3001\u63d0\u4ea4\u6216\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u3002 </li> <li>RM (Resource Manager) - \u8d44\u6e90\u7ba1\u7406\u5668\uff1a\u7ba1\u7406\u5206\u652f\u4e8b\u52a1\uff0c\u4e0eTC\u901a\u8baf\u4ee5\u6ce8\u518c\u5206\u652f\u4e8b\u52a1\u548c\u62a5\u544a\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u5e76\u9a71\u52a8\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002 </li> </ul> <p>Seata\u7684\u5de5\u4f5c\u67b6\u6784\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u90e8\u7f72tc\u670d\u52a1","title":"\u90e8\u7f72TC\u670d\u52a1","text":"<p>Seata\u652f\u6301\u591a\u79cd\u5b58\u50a8\u6a21\u5f0f\uff0c\u4f46\u8003\u8651\u5230\u6301\u4e45\u5316\u7684\u9700\u8981\uff0c\u6211\u4eec\u4e00\u822c\u9009\u62e9\u57fa\u4e8e\u6570\u636e\u5e93\u5b58\u50a8\u3002</p> <p>\u51c6\u5907\u4e00\u4e2aseata\u76ee\u5f55\uff0c\u5176\u4e2d\u5305\u542b\u4e86seata\u8fd0\u884c\u65f6\u6240\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>docker\u90e8\u7f72\uff1a</p> <pre><code>docker run --name seata \\\n-p 8099:8099 \\\n-p 7099:7099 \\\n-e SEATA_IP=&lt;\u670d\u52a1IP&gt; \\\n-v ./seata:/seata-server/resources \\\n--privileged=true \\\n--network &lt;\u7f51\u7edc\u540d&gt; \\\n-d \\\nseataio/seata-server:1.5.2\n</code></pre> <p>-e SETA_IP \u6307\u5b9a\u7684IP\u5730\u5740\u4e3a\u670d\u52a1\u5668IP\uff0c\u8be5IP\u4f1a\u88ab\u63a8\u9001\u5230nacos(\u6ce8\u518c\u4e2d\u5fc3)\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\uff08\u6216\u6307\u5b9a\u4e3alocalhost\uff09\u5219\u4f1a\u63a8\u9001docker\u4e3a\u5176\u5206\u914d\u7684IP\uff0c\u5916\u90e8\u8bbe\u5907\u65e0\u6cd5\u901a\u8fc7\u8be5IP\u8bbf\u95eeseata</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5fae\u670d\u52a1\u96c6\u6210seata","title":"\u5fae\u670d\u52a1\u96c6\u6210Seata","text":"<p>\u5f15\u5165\u4f9d\u8d56</p> <pre><code>  &lt;!--seata--&gt;\n  &lt;dependency&gt;\n      &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt;\n  &lt;/dependency&gt;\n</code></pre> <p>\u5728\u670d\u52a1\u4e2d\u914d\u7f6eseata\u4fe1\u606f</p> <pre><code>seata:\n  registry: # TC\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e\uff0c\u5fae\u670d\u52a1\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u53bb\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6tc\u670d\u52a1\u5730\u5740\n    type: nacos # \u6ce8\u518c\u4e2d\u5fc3\u7c7b\u578b nacos\n    nacos:\n      server-addr: localhost:8848 # nacos\u5730\u5740\n      namespace: \"\" # namespace\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\n      group: DEFAULT_GROUP # \u5206\u7ec4\uff0c\u9ed8\u8ba4\u662fDEFAULT_GROUP\n      application: seata-server # seata\u670d\u52a1\u540d\u79f0\n      username: nacos\n      password: nacos\n  tx-service-group: work # \u4e8b\u52a1\u7ec4\u540d\u79f0\n  service:\n    vgroup-mapping: # \u4e8b\u52a1\u7ec4\u4e0etc\u96c6\u7fa4\u7684\u6620\u5c04\u5173\u7cfb\n      work: \"default\"\n</code></pre> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#xa\u6a21\u5f0f","title":"XA\u6a21\u5f0f","text":"<p><code>XA</code> \u89c4\u8303 \u662f<code>X/Open</code> \u7ec4\u7ec7\u5b9a\u4e49\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5904\u7406\uff08DTP\uff0cDistributed Transaction Processing\uff09\u6807\u51c6\uff0cXA \u89c4\u8303 \u63cf\u8ff0\u4e86\u5168\u5c40\u7684<code>TM</code>\u4e0e\u5c40\u90e8\u7684<code>RM</code>\u4e4b\u95f4\u7684\u63a5\u53e3\uff0c\u51e0\u4e4e\u6240\u6709\u4e3b\u6d41\u7684\u6570\u636e\u5e93\u90fd\u5bf9 XA \u89c4\u8303 \u63d0\u4f9b\u4e86\u652f\u6301\u3002</p> <p>Seata\u5bf9\u539f\u59cb\u7684XA\u6a21\u5f0f\u505a\u4e86\u7b80\u5355\u7684\u5c01\u88c5\u548c\u6539\u9020\uff0c\u4ee5\u9002\u5e94\u81ea\u5df1\u7684\u4e8b\u52a1\u6a21\u578b\uff0c\u57fa\u672c\u67b6\u6784\u5982\u56fe\uff1a</p> <p></p> <p><code>RM</code>\u4e00\u9636\u6bb5\u7684\u5de5\u4f5c\uff1a</p> <ol> <li>\u6ce8\u518c\u5206\u652f\u4e8b\u52a1\u5230<code>TC</code></li> <li>\u6267\u884c\u5206\u652f\u4e1a\u52a1sql\u4f46\u4e0d\u63d0\u4ea4</li> <li>\u62a5\u544a\u6267\u884c\u72b6\u6001\u5230<code>TC</code></li> </ol> <p><code>TC</code>\u4e8c\u9636\u6bb5\u7684\u5de5\u4f5c\uff1a</p> <ol> <li><code>TC</code>\u68c0\u6d4b\u5404\u5206\u652f\u4e8b\u52a1\u6267\u884c\u72b6\u6001<ol> <li>\u5982\u679c\u90fd\u6210\u529f\uff0c\u901a\u77e5\u6240\u6709RM\u63d0\u4ea4\u4e8b\u52a1</li> <li>\u5982\u679c\u6709\u5931\u8d25\uff0c\u901a\u77e5\u6240\u6709RM\u56de\u6eda\u4e8b\u52a1 </li> </ol> </li> </ol> <p><code>RM</code>\u4e8c\u9636\u6bb5\u7684\u5de5\u4f5c\uff1a</p> <ul> <li>\u63a5\u6536<code>TC</code>\u6307\u4ee4\uff0c\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1</li> </ul> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u4f18\u7f3a\u70b9","title":"\u4f18\u7f3a\u70b9","text":"<p><code>XA</code>\u6a21\u5f0f\u7684\u4f18\u70b9\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u4e8b\u52a1\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u6ee1\u8db3ACID\u539f\u5219</li> <li>\u5e38\u7528\u6570\u636e\u5e93\u90fd\u652f\u6301\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u5e76\u4e14\u6ca1\u6709\u4ee3\u7801\u4fb5\u5165</li> </ul> <p><code>XA</code>\u6a21\u5f0f\u7684\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u56e0\u4e3a\u4e00\u9636\u6bb5\u9700\u8981\u9501\u5b9a\u6570\u636e\u5e93\u8d44\u6e90\uff0c\u7b49\u5f85\u4e8c\u9636\u6bb5\u7ed3\u675f\u624d\u91ca\u653e\uff0c\u6027\u80fd\u8f83\u5dee</li> <li>\u4f9d\u8d56\u5173\u7cfb\u578b\u6570\u636e\u5e93\u5b9e\u73b0\u4e8b\u52a1</li> </ul>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5b9e\u73b0\u6b65\u9aa4","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<p>\u6dfb\u52a0\u914d\u7f6e</p> <pre><code>seata:\n  data-source-proxy-mode: XA\n</code></pre> <p>\u5176\u6b21\uff0c\u6211\u4eec\u8981\u5229\u7528<code>@GlobalTransactional</code>\u6807\u8bb0\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5165\u53e3\u65b9\u6cd5\uff1a</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#at\u6a21\u5f0f","title":"AT\u6a21\u5f0f","text":"<p><code>AT</code>\u6a21\u5f0f\u540c\u6837\u662f\u5206\u9636\u6bb5\u63d0\u4ea4\u7684\u4e8b\u52a1\u6a21\u578b\uff0c\u4e0d\u8fc7\u5f25\u8865\u4e86<code>XA</code>\u6a21\u578b\u4e2d\u8d44\u6e90\u9501\u5b9a\u5468\u671f\u8fc7\u957f\u7684\u7f3a\u9677\u3002</p> <p></p> <p>\u9636\u6bb5\u4e00<code>RM</code>\u7684\u5de5\u4f5c\uff1a</p> <ul> <li>\u6ce8\u518c\u5206\u652f\u4e8b\u52a1</li> <li>\u8bb0\u5f55undo-log\uff08\u6570\u636e\u5feb\u7167\uff09</li> <li>\u6267\u884c\u4e1a\u52a1sql\u5e76\u63d0\u4ea4</li> <li>\u62a5\u544a\u4e8b\u52a1\u72b6\u6001</li> </ul> <p>\u9636\u6bb5\u4e8c\u63d0\u4ea4\u65f6<code>RM</code>\u7684\u5de5\u4f5c\uff1a</p> <ul> <li>\u5220\u9664undo-log\u5373\u53ef</li> </ul> <p>\u9636\u6bb5\u4e8c\u56de\u6eda\u65f6<code>RM</code>\u7684\u5de5\u4f5c\uff1a</p> <ul> <li>\u6839\u636eundo-log\u6062\u590d\u6570\u636e\u5230\u66f4\u65b0\u524d</li> </ul> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#at\u6a21\u5f0f\u4e0exa\u6a21\u5f0f\u7684\u533a\u522b","title":"AT\u6a21\u5f0f\u4e0eXA\u6a21\u5f0f\u7684\u533a\u522b","text":"<ul> <li><code>XA</code>\u6a21\u5f0f\u4e00\u9636\u6bb5\u4e0d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u9501\u5b9a\u8d44\u6e90\uff1b<code>AT</code>\u6a21\u5f0f\u4e00\u9636\u6bb5\u76f4\u63a5\u63d0\u4ea4\uff0c\u4e0d\u9501\u5b9a\u8d44\u6e90\u3002</li> <li><code>XA</code>\u6a21\u5f0f\u4f9d\u8d56\u6570\u636e\u5e93\u673a\u5236\u5b9e\u73b0\u56de\u6eda\uff1b<code>AT</code>\u6a21\u5f0f\u5229\u7528\u6570\u636e\u5feb\u7167\u5b9e\u73b0\u6570\u636e\u56de\u6eda\u3002</li> <li><code>XA</code>\u6a21\u5f0f\u5f3a\u4e00\u81f4\uff1b<code>AT</code>\u6a21\u5f0f\u6700\u7ec8\u4e00\u81f4</li> </ul> <p>\u53ef\u89c1\uff0cAT\u6a21\u5f0f\u4f7f\u7528\u8d77\u6765\u66f4\u52a0\u7b80\u5355\uff0c\u65e0\u4e1a\u52a1\u4fb5\u5165\uff0c\u6027\u80fd\u66f4\u597d\u3002\u56e0\u6b64\u4f01\u4e1a90%\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u90fd\u53ef\u4ee5\u7528AT\u6a21\u5f0f\u6765\u89e3\u51b3\u3002</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/#\u5b9e\u73b0\u6b65\u9aa4_1","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<p>\u521b\u5efa\u6570\u636e\u5feb\u7167\u8868</p> <pre><code>CREATE TABLE IF NOT EXISTS `undo_log`\n(\n    `branch_id`     BIGINT       NOT NULL COMMENT 'branch transaction id',\n    `xid`           VARCHAR(128) NOT NULL COMMENT 'global transaction id',\n    `context`       VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization',\n    `rollback_info` LONGBLOB     NOT NULL COMMENT 'rollback info',\n    `log_status`    INT(11)      NOT NULL COMMENT '0:normal status,1:defense status',\n    `log_created`   DATETIME(6)  NOT NULL COMMENT 'create datetime',\n    `log_modified`  DATETIME(6)  NOT NULL COMMENT 'modify datetime',\n    UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`)\n) ENGINE = InnoDB\n  AUTO_INCREMENT = 1\n  DEFAULT CHARSET = utf8mb4 COMMENT ='AT transaction mode undo table';\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e3aAT\u6a21\u5f0f\uff08\u9ed8\u8ba4\u4e3aAT\u6a21\u5f0f\uff09</p> <pre><code>seata:\n  data-source-proxy-mode: AT\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u914d\u7f6e\u4e2d\u5fc3</p> <p>\u4e0b\u4e00\u8282\uff1a\u9762\u8bd5</p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/","title":"\u670d\u52a1\u62c6\u5206","text":""},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/#\u62c6\u5206\u539f\u5219","title":"\u62c6\u5206\u539f\u5219","text":"<p>\u4ec0\u4e48\u65f6\u5019\u62c6\uff1f</p> <p>\u5bf9\u4e8e\u5927\u591a\u6570\u5c0f\u578b\u9879\u76ee\u6765\u8bf4\uff0c\u4e00\u822c\u662f\u5148\u91c7\u7528\u5355\u4f53\u67b6\u6784\uff0c\u968f\u7740\u7528\u6237\u89c4\u6a21\u6269\u5927\u3001\u4e1a\u52a1\u590d\u6742\u540e\u518d\u9010\u6e10\u62c6\u5206\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u3002</p> <p>\u8fd9\u6837\u521d\u671f\u6210\u672c\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u53ef\u4ee5\u5feb\u901f\u8bd5\u9519\u3002\u4f46\u662f\uff0c\u8fd9\u4e48\u505a\u7684\u95ee\u9898\u5c31\u5728\u4e8e\u540e\u671f\u505a\u670d\u52a1\u62c6\u5206\u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u5f88\u591a\u4ee3\u7801\u8026\u5408\u5e26\u6765\u7684\u95ee\u9898\uff0c\u62c6\u5206\u6bd4\u8f83\u56f0\u96be\uff08\u524d\u6613\u540e\u96be\uff09\u3002</p> <p>\u800c\u5bf9\u4e8e\u4e00\u4e9b\u5927\u578b\u9879\u76ee\uff0c\u5728\u7acb\u9879\u4e4b\u521d\u76ee\u7684\u5c31\u5f88\u660e\u786e\uff0c\u4e3a\u4e86\u957f\u8fdc\u8003\u8651\uff0c\u5728\u67b6\u6784\u8bbe\u8ba1\u65f6\u5c31\u76f4\u63a5\u9009\u62e9\u5fae\u670d\u52a1\u67b6\u6784\u3002\u867d\u7136\u524d\u671f\u6295\u5165\u8f83\u591a\uff0c\u4f46\u540e\u671f\u5c31\u5c11\u4e86\u62c6\u5206\u670d\u52a1\u7684\u70e6\u607c\uff08\u524d\u96be\u540e\u6613\uff09\u3002</p> <p></p> <p>\u600e\u4e48\u62c6\uff1f</p> <ul> <li> <p>\u9ad8\u5185\u805a\uff1a\u6bcf\u4e2a\u5fae\u670d\u52a1\u7684\u804c\u8d23\u8981\u5c3d\u91cf\u5355\u4e00\uff0c\u5305\u542b\u7684\u4e1a\u52a1\u76f8\u4e92\u5173\u8054\u5ea6\u9ad8\u3001\u5b8c\u6574\u5ea6\u9ad8\u3002</p> </li> <li> <p>\u4f4e\u8026\u5408\uff1a\u6bcf\u4e2a\u5fae\u670d\u52a1\u7684\u529f\u80fd\u8981\u76f8\u5bf9\u72ec\u7acb\uff0c\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5176\u5b83\u5fae\u670d\u52a1\u7684\u4f9d\u8d56\uff0c\u6216\u8005\u4f9d\u8d56\u63a5\u53e3\u7684\u7a33\u5b9a\u6027\u8981\u5f3a\u3002</p> </li> </ul> <p></p> <p>\u660e\u786e\u4e86\u62c6\u5206\u76ee\u6807\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u62c6\u5206\u65b9\u5f0f\u4e86\u3002\u6211\u4eec\u5728\u505a\u670d\u52a1\u62c6\u5206\u65f6\u4e00\u822c\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u7eb5\u5411\u62c6\u5206</p> </li> <li> <p>\u6a2a\u5411\u62c6\u5206</p> </li> </ul> <p></p> <ol> <li> <p>\u7eb5\u5411\u62c6\u5206\uff0c\u5c31\u662f\u6309\u7167\u9879\u76ee\u7684\u529f\u80fd\u6a21\u5757\u6765\u62c6\u5206\u3002\u4f8b\u5982\u5546\u57ce\u7cfb\u7edf\u4e2d\uff0c\u5c31\u6709\u7528\u6237\u7ba1\u7406\u529f\u80fd\u3001\u8ba2\u5355\u7ba1\u7406\u529f\u80fd\u3001\u8d2d\u7269\u8f66\u529f\u80fd\u3001\u5546\u54c1\u7ba1\u7406\u529f\u80fd\u3001\u652f\u4ed8\u529f\u80fd\u7b49\u3002\u90a3\u4e48\u6309\u7167\u529f\u80fd\u6a21\u5757\u5c06\u4ed6\u4eec\u62c6\u5206\u4e3a\u4e00\u4e2a\u4e2a\u670d\u52a1\uff0c\u5c31\u5c5e\u4e8e\u7eb5\u5411\u62c6\u5206\u3002\u8fd9\u79cd\u62c6\u5206\u6a21\u5f0f\u53ef\u4ee5\u5c3d\u53ef\u80fd\u63d0\u9ad8\u670d\u52a1\u7684\u5185\u805a\u6027\u3002</p> </li> <li> <p>\u6a2a\u5411\u62c6\u5206\uff0c\u662f\u770b\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u4e4b\u95f4\u6709\u6ca1\u6709\u516c\u5171\u7684\u4e1a\u52a1\u90e8\u5206\uff0c\u5982\u679c\u6709\u5c06\u5176\u62bd\u53d6\u51fa\u6765\u4f5c\u4e3a\u901a\u7528\u670d\u52a1\u3002\u4f8b\u5982\u7528\u6237\u767b\u5f55\u662f\u9700\u8981\u53d1\u9001\u6d88\u606f\u901a\u77e5\uff0c\u8bb0\u5f55\u98ce\u63a7\u6570\u636e\uff0c\u4e0b\u5355\u65f6\u4e5f\u8981\u53d1\u9001\u77ed\u4fe1\uff0c\u8bb0\u5f55\u98ce\u63a7\u6570\u636e\u3002\u56e0\u6b64\u6d88\u606f\u53d1\u9001\u3001\u98ce\u63a7\u6570\u636e\u8bb0\u5f55\u5c31\u662f\u901a\u7528\u7684\u4e1a\u52a1\u529f\u80fd\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u4ed6\u4eec\u5206\u522b\u62bd\u53d6\u4e3a\u516c\u5171\u670d\u52a1\uff1a\u6d88\u606f\u4e2d\u5fc3\u670d\u52a1\u3001\u98ce\u63a7\u7ba1\u7406\u670d\u52a1\u3002\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u4e1a\u52a1\u7684\u590d\u7528\u6027\uff0c\u907f\u514d\u91cd\u590d\u5f00\u53d1\u3002\u540c\u65f6\u901a\u7528\u4e1a\u52a1\u4e00\u822c\u63a5\u53e3\u7a33\u5b9a\u6027\u8f83\u5f3a\uff0c\u4e5f\u4e0d\u4f1a\u4f7f\u670d\u52a1\u4e4b\u95f4\u8fc7\u5206\u8026\u5408\u3002</p> </li> </ol> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/#\u670d\u52a1\u8c03\u7528","title":"\u670d\u52a1\u8c03\u7528","text":"<p>\u670d\u52a1\u62c6\u5206\u524d\uff0c\u591a\u4e2a\u670d\u52a1\u95f4\u53ef\u4ee5\u76f8\u4e92\u8fdb\u884c\u672c\u5730\u8c03\u7528\uff0c\u4f46\u662f\u62c6\u5206\u540e\u5c31\u884c\u4e0d\u901a\u4e86</p> <p>\u56e0\u6b64\u8981\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u6539\u9020\u5176\u4e2d\u7684\u4ee3\u7801\uff0c\u628a\u539f\u672c\u672c\u5730\u65b9\u6cd5\u8c03\u7528\uff0c\u6539\u9020\u6210\u8de8\u5fae\u670d\u52a1\u7684\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff08RPC\uff0c\u5373Remote Produce Call\uff09\uff0c\u5177\u4f53\u5b9e\u73b0\u6709 Dubbo\u3001gRPC\u7b49\u3002</p> <p>Note</p> <p>\u4f20\u7edf\u610f\u4e49\u7684 RPC \u6846\u67b6\uff0c\u90fd\u662f\u57fa\u4e8e\u4e8c\u8fdb\u5236\u534f\u8bae\u7684\uff08\u975ehttp\u534f\u8bae\uff0c\u800c\u662fTCP/UDP\uff09\uff0c\u6027\u80fd\u8f83\u597d\uff0c\u4f46\u662f\u4f7f\u7528\u8d77\u6765\u6bd4\u8f83\u590d\u6742\uff0c\u4e14\u4e0d\u6613\u4e8e\u8c03\u8bd5\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u901a\u8fc7\u7f51\u7edc\u8c03\u7528\u63a5\u53e3</p> <p>Spring\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>RestTemplate</code>\u7684API\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u5b9e\u73b0Http\u8bf7\u6c42\u7684\u53d1\u9001\u3002</p> <p>\u9996\u5148\u5c06<code>Restemplate</code>\u4ea4\u7ed9spring\u7ba1\u7406</p> <pre><code>@Configuration\npublic class RemoteCallConfig {\n\n    @Bean\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n}\n</code></pre> <p>\u4f7f\u7528<code>Restemplate</code></p> <pre><code>    // \u53d1\u8d77\u8bf7\u6c42\n    ResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(\n            \"http://localhost:8081/items?ids={ids}\",\n            HttpMethod.GET,\n            null,\n            new ParameterizedTypeReference&lt;List&lt;ItemDTO&gt;&gt;() {\n            },\n            Map.of(\"ids\", CollUtil.join(itemIds, \",\"))\n    );\n    // \u89e3\u6790\u54cd\u5e94\n    if(!response.getStatusCode().is2xxSuccessful()){\n        // \u67e5\u8be2\u5931\u8d25\uff0c\u76f4\u63a5\u7ed3\u675f\n        return;\n    }\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u5355\u4f53\u67b6\u6784\u4e0e\u5fae\u670d\u52a1</p> <p>\u4e0b\u4e00\u8282\uff1a\u670d\u52a1\u6cbb\u7406</p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/","title":"\u670d\u52a1\u6cbb\u7406","text":""},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/#\u6ce8\u518c\u4e2d\u5fc3\u539f\u7406","title":"\u6ce8\u518c\u4e2d\u5fc3\u539f\u7406","text":"<p>\u5728\u4e0a\u4e00\u8282\u5b9e\u73b0\u4e86\u5fae\u670d\u52a1\u62c6\u5206\uff0c\u5e76\u4e14\u901a\u8fc7Http\u8bf7\u6c42\u5b9e\u73b0\u4e86\u8de8\u5fae\u670d\u52a1\u7684\u8fdc\u7a0b\u8c03\u7528\u3002\u4e0d\u8fc7\u8fd9\u79cd\u624b\u52a8\u53d1\u9001Http\u8bf7\u6c42\u7684\u65b9\u5f0f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\u3002</p> <p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5047\u5982\u5546\u54c1\u5fae\u670d\u52a1\u88ab\u8c03\u7528\u8f83\u591a\uff0c\u4e3a\u4e86\u5e94\u5bf9\u66f4\u9ad8\u7684\u5e76\u53d1\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u591a\u5b9e\u4f8b\u90e8\u7f72\u670d\u52a1\u7684\u4e3b\u673a\u548c\u7aef\u53e3\u90fd\u4e0d\u56fa\u5b9a\uff0c\u5982\u4f55\u89e3\u51b3\uff1f</p> <p>\u5728\u5fae\u670d\u52a1\u8fdc\u7a0b\u8c03\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5305\u62ec\u4e24\u4e2a\u89d2\u8272\uff1a</p> <ul> <li> <p>\u670d\u52a1\u63d0\u4f9b\u8005\uff1a\u63d0\u4f9b\u63a5\u53e3\u4f9b\u5176\u5b83\u5fae\u670d\u52a1\u8bbf\u95ee</p> </li> <li> <p>\u670d\u52a1\u6d88\u8d39\u8005\uff1a\u8c03\u7528\u5176\u5b83\u5fae\u670d\u52a1\u63d0\u4f9b\u7684\u63a5\u53e3</p> </li> </ul> <p>\u5728\u5927\u578b\u5fae\u670d\u52a1\u9879\u76ee\u4e2d\uff0c\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u6570\u91cf\u4f1a\u975e\u5e38\u591a\uff0c\u4e3a\u4e86\u7ba1\u7406\u8fd9\u4e9b\u670d\u52a1\u5c31\u5f15\u5165\u4e86\u6ce8\u518c\u4e2d\u5fc3\u7684\u6982\u5ff5\u3002\u6ce8\u518c\u4e2d\u5fc3\u3001\u670d\u52a1\u63d0\u4f9b\u8005\u3001\u670d\u52a1\u6d88\u8d39\u8005\u4e09\u8005\u95f4\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p></p> <p>\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u670d\u52a1\u542f\u52a8\u65f6\u5c31\u4f1a\u6ce8\u518c\u81ea\u5df1\u7684\u670d\u52a1\u4fe1\u606f\uff08\u670d\u52a1\u540d\u3001IP\u3001\u7aef\u53e3\uff09\u5230\u6ce8\u518c\u4e2d\u5fc3</p> </li> <li> <p>\u8c03\u7528\u8005\u53ef\u4ee5\u4ece\u6ce8\u518c\u4e2d\u5fc3\u8ba2\u9605\u60f3\u8981\u7684\u670d\u52a1\uff0c\u83b7\u53d6\u670d\u52a1\u5bf9\u5e94\u7684\u5b9e\u4f8b\u5217\u8868\uff081\u4e2a\u670d\u52a1\u53ef\u80fd\u591a\u5b9e\u4f8b\u90e8\u7f72\uff09</p> </li> <li> <p>\u8c03\u7528\u8005\u81ea\u5df1\u5bf9\u5b9e\u4f8b\u5217\u8868\u8d1f\u8f7d\u5747\u8861\uff0c\u6311\u9009\u4e00\u4e2a\u5b9e\u4f8b</p> </li> <li> <p>\u8c03\u7528\u8005\u5411\u8be5\u5b9e\u4f8b\u53d1\u8d77\u8fdc\u7a0b\u8c03\u7528</p> </li> </ul> <p></p> <p>\u5f53\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u5b9e\u4f8b\u5b95\u673a\u6216\u8005\u542f\u52a8\u65b0\u5b9e\u4f8b\u65f6\uff0c\u8c03\u7528\u8005\u5982\u4f55\u5f97\u77e5\u5462\uff1f</p> <ul> <li> <p>\u670d\u52a1\u63d0\u4f9b\u8005\u4f1a\u5b9a\u671f\u5411\u6ce8\u518c\u4e2d\u5fc3\u53d1\u9001\u8bf7\u6c42\uff0c\u62a5\u544a\u81ea\u5df1\u7684\u5065\u5eb7\u72b6\u6001\uff08\u5fc3\u8df3\u68c0\u6d4b\uff09</p> </li> <li> <p>\u5f53\u6ce8\u518c\u4e2d\u5fc3\u957f\u65f6\u95f4\u6536\u4e0d\u5230\u63d0\u4f9b\u8005\u7684\u5fc3\u8df3\u8bf7\u6c42\u65f6\uff0c\u4f1a\u8ba4\u4e3a\u8be5\u5b9e\u4f8b\u5b95\u673a\uff0c\u5c06\u5176\u4ece\u670d\u52a1\u7684\u5b9e\u4f8b\u5217\u8868\u4e2d\u5254\u9664</p> </li> <li> <p>\u5f53\u670d\u52a1\u6709\u65b0\u5b9e\u4f8b\u542f\u52a8\u65f6\uff0c\u4f1a\u53d1\u9001\u6ce8\u518c\u670d\u52a1\u8bf7\u6c42\uff0c\u5176\u4fe1\u606f\u4f1a\u88ab\u8bb0\u5f55\u5728\u6ce8\u518c\u4e2d\u5fc3\u7684\u670d\u52a1\u5b9e\u4f8b\u5217\u8868</p> </li> <li> <p>\u5f53\u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1\u5217\u8868\u53d8\u66f4\u65f6\uff0c\u4f1a\u4e3b\u52a8\u901a\u77e5\u5fae\u670d\u52a1\uff0c\u66f4\u65b0\u672c\u5730\u670d\u52a1\u5217\u8868</p> </li> </ul> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/#nacos\u6ce8\u518c\u4e2d\u5fc3","title":"Nacos\u6ce8\u518c\u4e2d\u5fc3","text":"<p>Nacos\u5b98\u7f51| Nacos \u914d\u7f6e\u4e2d\u5fc3 | Nacos \u4e0b\u8f7d| Nacos \u5b98\u65b9\u793e\u533a | Nacos \u5b98\u7f51</p> <p>\u76ee\u524d\u5f00\u6e90\u7684\u6ce8\u518c\u4e2d\u5fc3\u6846\u67b6\u6709\u5f88\u591a\uff0c\u56fd\u5185\u6bd4\u8f83\u5e38\u89c1\u7684\u6709\uff1a</p> <ul> <li> <p>Eureka\uff1aNetflix\u516c\u53f8\u51fa\u54c1\uff0c\u76ee\u524d\u88ab\u96c6\u6210\u5728SpringCloud\u5f53\u4e2d\uff0c\u4e00\u822c\u7528\u4e8eJava\u5e94\u7528</p> </li> <li> <p>Nacos\uff1aAlibaba\u516c\u53f8\u51fa\u54c1\uff0c\u76ee\u524d\u88ab\u96c6\u6210\u5728SpringCloudAlibaba\u4e2d\uff0c\u4e00\u822c\u7528\u4e8eJava\u5e94\u7528</p> </li> <li> <p>Consul\uff1aHashiCorp\u516c\u53f8\u51fa\u54c1\uff0c\u76ee\u524d\u96c6\u6210\u5728SpringCloud\u4e2d\uff0c\u4e0d\u9650\u5236\u5fae\u670d\u52a1\u8bed\u8a00</p> </li> </ul> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u4ee5Nacos\u4e3a\u4f8b\uff0c\u6765\u4ecb\u7ecd\u5982\u4f55\u642d\u5efa\u6ce8\u518c\u4e2d\u5fc3\uff0c\u5e76\u5b9e\u73b0\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u3002</p> <p>\u9996\u5148\u90e8\u7f72Nacos\u670d\u52a1\uff0c\u8fd9\u91cc\u91c7\u7528Docker\u65b9\u5f0f\u90e8\u7f72\u3002</p> <pre><code>docker run --name nacos-standalone-derby \\\n    -e MODE=standalone \\\n    -e NACOS_AUTH_TOKEN=${your_nacos_auth_secret_token} \\\n    -e NACOS_AUTH_IDENTITY_KEY=${your_nacos_server_identity_key} \\\n    -e NACOS_AUTH_IDENTITY_VALUE=${your_nacos_server_identity_value} \\\n    -p 8080:8080 \\\n    -p 8848:8848 \\\n    -p 9848:9848 \\\n    -d nacos/nacos-server:latest\n</code></pre> <p>Note</p> <p>NACOS_AUTH_TOKEN: Nacos \u7528\u4e8e\u751f\u6210JWT Token\u7684\u5bc6\u94a5\uff0c\u4f7f\u7528\u957f\u5ea6\u5927\u4e8e32\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\uff0c\u518d\u7ecf\u8fc7Base64\u7f16\u7801\u3002 NACOS_AUTH_IDENTITY_KEY: Nacos Server\u7aef\u4e4b\u95f4 Inner API\u7684\u8eab\u4efd\u6807\u8bc6\u7684Key\uff0c\u5fc5\u586b\u3002 NACOS_AUTH_IDENTITY_VALUE: Nacos Server\u7aef\u4e4b\u95f4 Inner API\u7684\u8eab\u4efd\u6807\u8bc6\u7684Value\uff0c\u5fc5\u586b\u3002</p> <p>\u8bbf\u95ee\u9875\u9762\u67e5\u770b\u662f\u5426\u542f\u52a8\u6210\u529f</p> <pre><code>http://localhost:8080/index.html\n</code></pre> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/#\u670d\u52a1\u6ce8\u518c","title":"\u670d\u52a1\u6ce8\u518c","text":"<p>\u670d\u52a1\u53d1\u73b0\u9664\u4e86\u8981\u5f15\u5165nacos\u4f9d\u8d56\u4ee5\u5916\uff0c\u7531\u4e8e\u8fd8\u9700\u8981\u8d1f\u8f7d\u5747\u8861\uff0c\u56e0\u6b64\u8981\u5f15\u5165SpringCloud\u63d0\u4f9b\u7684LoadBalancer\u4f9d\u8d56\u3002</p> <p>\u6211\u4eec\u5728<code>pom.xml</code>\u4e2d\u6dfb\u52a0\u4e0b\u9762\u7684\u4f9d\u8d56\uff1a</p> <pre><code>&lt;!--nacos \u670d\u52a1\u6ce8\u518c\u53d1\u73b0--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5728application.yml`\u4e2d\u6dfb\u52a0nacos\u5730\u5740\u914d\u7f6e\uff1a</p> <pre><code>spring:\n  cloud:\n    nacos:\n      server-addr: localhost:8848\n</code></pre> <p>\u542f\u52a8\u670d\u52a1\u5373\u53ef\u81ea\u52a8\u6ce8\u518c</p> <p></p>"},{"location":"SpringCloud/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/#\u670d\u52a1\u53d1\u73b0","title":"\u670d\u52a1\u53d1\u73b0","text":"<p>\u63a5\u4e0b\u6765\uff0c\u670d\u52a1\u8c03\u7528\u8005\u5c31\u53ef\u4ee5\u53bb\u8ba2\u9605\u670d\u52a1\u4e86\u3002\u4e0d\u8fc7\u670d\u52a1\u53ef\u80fd\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c\u800c\u771f\u6b63\u53d1\u8d77\u8c03\u7528\u65f6\u53ea\u9700\u8981\u77e5\u9053\u4e00\u4e2a\u5b9e\u4f8b\u7684\u5730\u5740\u3002</p> <p>\u56e0\u6b64\uff0c\u670d\u52a1\u8c03\u7528\u8005\u5fc5\u987b\u5229\u7528\u8d1f\u8f7d\u5747\u8861\u7684\u7b97\u6cd5\uff0c\u4ece\u591a\u4e2a\u5b9e\u4f8b\u4e2d\u6311\u9009\u4e00\u4e2a\u53bb\u8bbf\u95ee\u3002\u5e38\u89c1\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u6709\uff1a</p> <ul> <li> <p>\u968f\u673a</p> </li> <li> <p>\u8f6e\u8be2</p> </li> <li> <p>IP\u7684hash</p> </li> <li> <p>\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee</p> </li> <li> <p>...</p> </li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u6700\u7b80\u5355\u7684\u968f\u673a\u8d1f\u8f7d\u5747\u8861\u3002</p> <ol> <li> <p>\u5f15\u5165\u4f9d\u8d56\u5e76\u914d\u7f6enacos\u670d\u52a1\u5730\u5740\uff08\u540c\u4e0a\u4e00\u5c0f\u8282\uff09</p> </li> <li> <p>\u670d\u52a1\u53d1\u73b0\u9700\u8981\u7528\u5230\u4e00\u4e2a\u5de5\u5177\uff0cDiscoveryClient\uff0cSpringCloud\u5df2\u7ecf\u5e2e\u6211\u4eec\u81ea\u52a8\u88c5\u914d\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6ce8\u5165\u4f7f\u7528\uff1a</p> <pre><code>    @Autowired\n    private final DiscoveryClient discoveryClient;\n</code></pre> </li> </ol> <p>= 3. \u4f7f\u7528\u670d\u52a1</p> <pre><code>// \u6839\u636e\u670d\u52a1\u540d\u79f0\u83b7\u53d6\u670d\u52a1\u5b9e\u4f8b\u5217\u8868\nList&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(\"item-service\");\nif (CollUtils.isEmpty(instances)) {\n    return;\n}\n// \u6839\u636e\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\nServiceInstance instance = instances.get(RandomUtil.randomInt(instances.size()));\n// \u5f97\u5230\u670d\u52a1\u5b9e\u4f8b\u7684URI\nURI uri = instance.getUri();\nResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(\n        uri + \"/items?ids={ids}\",\n        HttpMethod.GET,\n        null,\n        new ParameterizedTypeReference&lt;List&lt;ItemDTO&gt;&gt;() {\n        },\n        Map.of(\"ids\", CollUtil.join(itemIds, \",\"))\n);\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u670d\u52a1\u62c6\u5206</p> <p>\u4e0b\u4e00\u8282\uff1aOpenFeign</p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/","title":"\u7f51\u5173","text":"<p>\u7531\u4e8e\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u6709\u4e0d\u540c\u7684\u5730\u5740\u6216\u7aef\u53e3\uff0c\u5165\u53e3\u4e0d\u540c\uff0c\u5728\u4e0e\u524d\u7aef\u8054\u8c03\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u73b0\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li> <p>\u8bf7\u6c42\u4e0d\u540c\u6570\u636e\u65f6\u8981\u8bbf\u95ee\u4e0d\u540c\u7684\u5165\u53e3\uff0c\u9700\u8981\u7ef4\u62a4\u591a\u4e2a\u5165\u53e3\u5730\u5740</p> </li> <li> <p>\u524d\u7aef\u65e0\u6cd5\u8c03\u7528nacos\uff0c\u65e0\u6cd5\u5b9e\u65f6\u66f4\u65b0\u670d\u52a1\u5217\u8868</p> </li> </ul> <p>\u5355\u4f53\u67b6\u6784\u65f6\u6211\u4eec\u53ea\u9700\u8981\u5b8c\u6210\u4e00\u6b21\u7528\u6237\u767b\u5f55\u3001\u8eab\u4efd\u6821\u9a8c\uff0c\u5c31\u53ef\u4ee5\u5728\u6240\u6709\u4e1a\u52a1\u4e2d\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u3002\u800c\u5fae\u670d\u52a1\u62c6\u5206\u540e\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u72ec\u7acb\u90e8\u7f72\uff0c\u8fd9\u5c31\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li> <p>\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u9700\u8981\u7f16\u5199\u767b\u5f55\u6821\u9a8c\u3001\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u7684\u529f\u80fd\u5417\uff1f</p> </li> <li> <p>\u5f53\u5fae\u670d\u52a1\u4e4b\u95f4\u8c03\u7528\u65f6\uff0c\u8be5\u5982\u4f55\u4f20\u9012\u7528\u6237\u4fe1\u606f\uff1f</p> </li> </ul>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u8ba4\u8bc6\u7f51\u5173","title":"\u8ba4\u8bc6\u7f51\u5173","text":"<p>\u987e\u660e\u601d\u8bae\uff0c\u7f51\u5173\u5c31\u662f\u7f51\u7edc\u7684\u5173\u53e3\u3002\u6570\u636e\u5728\u7f51\u7edc\u95f4\u4f20\u8f93\uff0c\u4ece\u4e00\u4e2a\u7f51\u7edc\u4f20\u8f93\u5230\u53e6\u4e00\u7f51\u7edc\u65f6\u5c31\u9700\u8981\u7ecf\u8fc7\u7f51\u5173\u6765\u505a\u6570\u636e\u7684\u8def\u7531\u548c\u8f6c\u53d1\u4ee5\u53ca\u6570\u636e\u5b89\u5168\u7684\u6821\u9a8c</p> <p>\u73b0\u5728\uff0c\u5fae\u670d\u52a1\u7f51\u5173\u5c31\u8d77\u5230\u540c\u6837\u7684\u4f5c\u7528\u3002\u524d\u7aef\u8bf7\u6c42\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u5fae\u670d\u52a1\uff0c\u800c\u662f\u8bf7\u6c42\u7f51\u5173\uff1a</p> <ul> <li> <p>\u7f51\u5173\u53ef\u4ee5\u505a\u5b89\u5168\u63a7\u5236\uff0c\u4e5f\u5c31\u662f\u767b\u5f55\u8eab\u4efd\u6821\u9a8c\uff0c\u6821\u9a8c\u901a\u8fc7\u624d\u653e\u884c</p> </li> <li> <p>\u901a\u8fc7\u8ba4\u8bc1\u540e\uff0c\u7f51\u5173\u518d\u6839\u636e\u8bf7\u6c42\u5224\u65ad\u5e94\u8be5\u8bbf\u95ee\u54ea\u4e2a\u5fae\u670d\u52a1\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u8fc7\u53bb</p> </li> </ul> <p></p> <p>\u5728SpringCloud\u5f53\u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e24\u79cd\u7f51\u5173\u5b9e\u73b0\u65b9\u6848\uff1a</p> <ul> <li> <p>Netflix Zuul\uff1a\u65e9\u671f\u5b9e\u73b0\uff0c\u76ee\u524d\u5df2\u7ecf\u6dd8\u6c70</p> </li> <li> <p>Spring Cloud Gateway\uff1a\u57fa\u4e8eSpring\u7684WebFlux\u6280\u672f\uff0c\u5b8c\u5168\u652f\u6301\u54cd\u5e94\u5f0f\u7f16\u7a0b\uff0c\u541e\u5410\u80fd\u529b\u66f4\u5f3a</p> </li> </ul> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u5feb\u901f\u5165\u95e8","title":"\u5feb\u901f\u5165\u95e8","text":"<p>\u63a5\u4e0b\u6765\uff0c\u5148\u5229\u7528\u7f51\u5173\u5b9e\u73b0\u8bf7\u6c42\u8def\u7531\u3002\u7531\u4e8e\u7f51\u5173\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5fae\u670d\u52a1\uff0c\u56e0\u6b64\u4e5f\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6a21\u5757\u5f00\u53d1\u529f\u80fd\u3002\u5927\u6982\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u521b\u5efa\u7f51\u5173\u5fae\u670d\u52a1</p> </li> <li> <p>\u5f15\u5165SpringCloudGateway\u3001NacosDiscovery\u4f9d\u8d56</p> </li> <li> <p>\u7f16\u5199\u542f\u52a8\u7c7b</p> </li> <li> <p>\u914d\u7f6e\u7f51\u5173\u8def\u7531</p> </li> </ul> <p>\u76f8\u5173\u4f9d\u8d56</p> <pre><code>&lt;!--\u7f51\u5173--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;!--nacos discovery--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;!--\u8d1f\u8f7d\u5747\u8861--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6</p> <pre><code>server:\n  port: 8080\n\nspring:\n  # spring\u670d\u52a1\u914d\u7f6e\n  application:\n    name: gateway\n\n  # SpringCloud\u914d\u7f6e\n  cloud:\n    # Nacos\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e\n    nacos:\n      server-addr: localhost:8848\n\n    # \u7f51\u5173\u914d\u7f6e\n    gateway:\n      routes:\n        - id: item-service\n          uri: lb://item-service\n          predicates:\n            - Path=/items/**,/search/**\n        - id: user-service\n          uri: lb://user-service\n          predicates:\n            - Path=/users/**,/addresses/**\n</code></pre> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u8def\u7531\u5c5e\u6027","title":"\u8def\u7531\u5c5e\u6027","text":"<ul> <li> <p><code>id</code>\uff1a\u8def\u7531\u7684\u552f\u4e00\u6807\u793a</p> </li> <li> <p><code>predicates</code>\uff1a\u8def\u7531\u65ad\u8a00\uff0c\u5176\u5b9e\u5c31\u662f\u5339\u914d\u6761\u4ef6</p> </li> <li> <p><code>filters</code>\uff1a\u8def\u7531\u8fc7\u6ee4\u6761\u4ef6</p> </li> <li> <p><code>uri</code>\uff1a\u8def\u7531\u76ee\u6807\u5730\u5740\uff0c<code>lb://</code>\u4ee3\u8868\u8d1f\u8f7d\u5747\u8861\uff0c\u4ece\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u76ee\u6807\u5fae\u670d\u52a1\u7684\u5b9e\u4f8b\u5217\u8868\uff0c\u5e76\u4e14\u8d1f\u8f7d\u5747\u8861\u9009\u62e9\u4e00\u4e2a\u8bbf\u95ee\u3002</p> </li> </ul> <p>\u8fd9\u91cc\u91cd\u70b9\u5173\u6ce8<code>predicates</code>\uff0c\u4e5f\u5c31\u662f\u8def\u7531\u65ad\u8a00\u3002<code>SpringCloudGateway</code>\u4e2d\u652f\u6301\u7684\u65ad\u8a00\u7c7b\u578b\u6709\u5f88\u591a\uff1a</p> \u540d\u79f0 \u8bf4\u660e \u793a\u4f8b After \u662f\u67d0\u4e2a\u65f6\u95f4\u70b9\u540e\u7684\u8bf7\u6c42 - After=2037-01-20T17:42:47.789-07:00[America/Denver] Before \u662f\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e4b\u524d\u7684\u8bf7\u6c42 - Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai] Between \u662f\u67d0\u4e24\u4e2a\u65f6\u95f4\u70b9\u4e4b\u524d\u7684\u8bf7\u6c42 - Between=2037-01-20T17:42:47.789-07:00[America/Denver], 2037-01-21T17:42:47.789-07:00[America/Denver] Cookie \u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u67d0\u4e9bcookie - Cookie=chocolate, ch.p Header \u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u67d0\u4e9bheader - Header=X-Request-Id, \\d+ Host \u8bf7\u6c42\u5fc5\u987b\u662f\u8bbf\u95ee\u67d0\u4e2ahost\uff08\u57df\u540d\uff09 - Host=.somehost.org,.anotherhost.org Method \u8bf7\u6c42\u65b9\u5f0f\u5fc5\u987b\u662f\u6307\u5b9a\u65b9\u5f0f - Method=GET,POST Path \u8bf7\u6c42\u8def\u5f84\u5fc5\u987b\u7b26\u5408\u6307\u5b9a\u89c4\u5219 - Path=/red/{segment},/blue/** Query \u8bf7\u6c42\u53c2\u6570\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u53c2\u6570 - Query=name, Jack\u6216\u8005- Query=name RemoteAddr \u8bf7\u6c42\u8005\u7684ip\u5fc5\u987b\u662f\u6307\u5b9a\u8303\u56f4 - RemoteAddr=192.168.1.1/24 weight \u6743\u91cd\u5904\u7406 <p></p> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u7f51\u5173\u767b\u5f55\u6821\u9a8c","title":"\u7f51\u5173\u767b\u5f55\u6821\u9a8c","text":""},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u601d\u8def\u5206\u6790","title":"\u601d\u8def\u5206\u6790","text":"<p>\u767b\u5f55\u4e00\u822c\u662f\u57fa\u4e8eJWT\u6765\u5b9e\u73b0\u7684\uff0c\u6821\u9a8cJWT\u7684\u7b97\u6cd5\u590d\u6742\uff0c\u800c\u4e14\u9700\u8981\u7528\u5230\u79d8\u94a5\u3002\u5982\u679c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u53bb\u505a\u767b\u5f55\u6821\u9a8c\uff0c\u8fd9\u5c31\u5b58\u5728\u7740\u4e24\u5927\u95ee\u9898\uff1a</p> <ul> <li> <p>\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u9700\u8981\u77e5\u9053JWT\u7684\u79d8\u94a5\uff0c\u4e0d\u5b89\u5168</p> </li> <li> <p>\u6bcf\u4e2a\u5fae\u670d\u52a1\u91cd\u590d\u7f16\u5199\u767b\u5f55\u6821\u9a8c\u4ee3\u7801\u3001\u6743\u9650\u6821\u9a8c\u4ee3\u7801</p> </li> </ul> <p>\u65e2\u7136\u7f51\u5173\u662f\u6240\u6709\u5fae\u670d\u52a1\u7684\u5165\u53e3\uff0c\u4e00\u5207\u8bf7\u6c42\u90fd\u9700\u8981\u5148\u7ecf\u8fc7\u7f51\u5173\u3002\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a\u767b\u5f55\u6821\u9a8c\u7684\u5de5\u4f5c\u653e\u5230\u7f51\u5173\u53bb\u505a\uff0c\u8fd9\u6837\u4e4b\u524d\u7684\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\uff1a</p> <ul> <li> <p>\u53ea\u9700\u8981\u5728\u7f51\u5173\u548c\u7528\u6237\u670d\u52a1\u4fdd\u5b58\u79d8\u94a5</p> </li> <li> <p>\u53ea\u9700\u8981\u5728\u7f51\u5173\u5f00\u53d1\u767b\u5f55\u6821\u9a8c\u529f\u80fd</p> </li> </ul> <p></p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u5b58\u5728\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li> <p>\u7f51\u5173\u8def\u7531\u662f\u914d\u7f6e\u7684\uff0c\u8bf7\u6c42\u8f6c\u53d1\u662fGateway\u5185\u90e8\u4ee3\u7801\uff0c\u6211\u4eec\u5982\u4f55\u5728\u8f6c\u53d1\u4e4b\u524d\u505a\u767b\u5f55\u6821\u9a8c\uff1f</p> </li> <li> <p>\u7f51\u5173\u6821\u9a8cJWT\u4e4b\u540e\uff0c\u5982\u4f55\u5c06\u7528\u6237\u4fe1\u606f\u4f20\u9012\u7ed9\u5fae\u670d\u52a1\uff1f</p> </li> <li> <p>\u5fae\u670d\u52a1\u4e4b\u95f4\u4e5f\u4f1a\u76f8\u4e92\u8c03\u7528\uff0c\u8fd9\u79cd\u8c03\u7528\u4e0d\u7ecf\u8fc7\u7f51\u5173\uff0c\u53c8\u8be5\u5982\u4f55\u4f20\u9012\u7528\u6237\u4fe1\u606f\uff1f</p> </li> </ul> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u7f51\u5173\u8fc7\u6ee4\u5668","title":"\u7f51\u5173\u8fc7\u6ee4\u5668","text":"<p>\u767b\u5f55\u6821\u9a8c\u5fc5\u987b\u5728\u8bf7\u6c42\u8f6c\u53d1\u5230\u5fae\u670d\u52a1\u4e4b\u524d\u505a\uff0c\u5426\u5219\u5c31\u5931\u53bb\u4e86\u610f\u4e49\u3002\u800c\u7f51\u5173\u7684\u8bf7\u6c42\u8f6c\u53d1\u662f<code>Gateway</code>\u5185\u90e8\u4ee3\u7801\u5b9e\u73b0\u7684\uff0c\u8981\u60f3\u5728\u8bf7\u6c42\u8f6c\u53d1\u4e4b\u524d\u505a\u767b\u5f55\u6821\u9a8c\uff0c\u5c31\u5fc5\u987b\u4e86\u89e3<code>Gateway</code>\u5185\u90e8\u5de5\u4f5c\u7684\u57fa\u672c\u539f\u7406</p> <p></p> <p>\u7f51\u5173\u8fc7\u6ee4\u5668\u94fe\u4e2d\u7684\u8fc7\u6ee4\u5668\u6709\u4e24\u79cd\uff1a</p> <ul> <li> <p><code>GatewayFilter</code>\uff1a\u8def\u7531\u8fc7\u6ee4\u5668\uff0c\u4f5c\u7528\u8303\u56f4\u6bd4\u8f83\u7075\u6d3b\uff0c\u53ef\u4ee5\u662f\u4efb\u610f\u6307\u5b9a\u7684\u8def\u7531<code>Route</code>.</p> </li> <li> <p><code>GlobalFilter</code>\uff1a\u5168\u5c40\u8fc7\u6ee4\u5668\uff0c\u4f5c\u7528\u8303\u56f4\u662f\u6240\u6709\u8def\u7531\uff0c\u4e0d\u53ef\u914d\u7f6e\u3002</p> </li> </ul> <p><code>GatewayFilter</code>\u548c<code>GlobalFilter</code>\u8fd9\u4e24\u79cd\u8fc7\u6ee4\u5668\u7684\u65b9\u6cd5\u7b7e\u540d\u5b8c\u5168\u4e00\u81f4\uff1a</p> <pre><code>/**\n * \u5904\u7406\u8bf7\u6c42\u5e76\u5c06\u5176\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u8fc7\u6ee4\u5668\n * @param exchange \u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\uff0c\u5176\u4e2d\u5305\u542brequest\u3001response\u7b49\u5404\u79cd\u6570\u636e\n * @param chain \u8fc7\u6ee4\u5668\u94fe\uff0c\u57fa\u4e8e\u5b83\u5411\u4e0b\u4f20\u9012\u8bf7\u6c42\n * @return \u6839\u636e\u8fd4\u56de\u503c\u6807\u8bb0\u5f53\u524d\u8bf7\u6c42\u662f\u5426\u88ab\u5b8c\u6210\u6216\u62e6\u622a\uff0cchain.filter(exchange)\u5c31\u653e\u884c\u4e86\u3002\n */\nMono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain);\n</code></pre> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668","title":"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668","text":"<p>1.GlobalFilter</p> <pre><code>@Component\npublic class PrintAnyGlobalFilter implements GlobalFilter, Ordered {\n    @Override\n    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        // \u7f16\u5199\u8fc7\u6ee4\u5668\u903b\u8f91\n        System.out.println(\"\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u8bbf\u95ee\");\n        // \u653e\u884c\n        // return chain.filter(exchange);\n\n        // \u62e6\u622a\n        ServerHttpResponse response = exchange.getResponse();\n        response.setRawStatusCode(401);\n        return response.setComplete();\n    }\n\n    @Override\n    public int getOrder() {\n        // \u8fc7\u6ee4\u5668\u6267\u884c\u987a\u5e8f\uff0c\u503c\u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\n        return 0;\n    }\n}\n</code></pre> <p>2.GatewayFilter</p> <p>\u81ea\u5b9a\u4e49<code>GatewayFilter</code>\u4e0d\u662f\u76f4\u63a5\u5b9e\u73b0<code>GatewayFilter</code>\uff0c\u800c\u662f\u7ee7\u627f<code>AbstractGatewayFilterFactory</code>\u3002</p> <pre><code>@Component\npublic class PrintAnyGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;Object&gt; {\n    @Override\n    public GatewayFilter apply(Object config) {\n        return new GatewayFilter() {\n            @Override\n            public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n                // \u83b7\u53d6\u8bf7\u6c42\n                ServerHttpRequest request = exchange.getRequest();\n                // \u7f16\u5199\u8fc7\u6ee4\u5668\u903b\u8f91\n                System.out.println(\"\u8fc7\u6ee4\u5668\u6267\u884c\u4e86\");\n                // \u653e\u884c\n                return chain.filter(exchange);\n            }\n        };\n    }\n}\n</code></pre> <p>3.\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528</p> <pre><code>spring:\n  cloud:\n    gateway:\n      default-filters:\n            - PrintAny # \u6b64\u5904\u76f4\u63a5\u4ee5\u81ea\u5b9a\u4e49\u7684GatewayFilterFactory\u7c7b\u540d\u79f0\u524d\u7f00\u7c7b\u58f0\u660e\u8fc7\u6ee4\u5668\n</code></pre> <p>\u53e6\u5916\uff0c\u8fd9\u79cd\u8fc7\u6ee4\u5668\u8fd8\u53ef\u4ee5\u652f\u6301\u52a8\u6001\u914d\u7f6e\u53c2\u6570\uff0c\u4e0d\u8fc7\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u590d\u6742\uff0c\u793a\u4f8b</p> <pre><code>@Component\npublic class PrintAnyGatewayFilterFactory // \u7236\u7c7b\u6cdb\u578b\u662f\u5185\u90e8\u7c7b\u7684Config\u7c7b\u578b\n                extends AbstractGatewayFilterFactory&lt;PrintAnyGatewayFilterFactory.Config&gt; {\n\n    @Override\n    public GatewayFilter apply(Config config) {\n        // OrderedGatewayFilter\u662fGatewayFilter\u7684\u5b50\u7c7b\uff0c\u5305\u542b\u4e24\u4e2a\u53c2\u6570\uff1a\n        // - GatewayFilter\uff1a\u8fc7\u6ee4\u5668\n        // - int order\u503c\uff1a\u503c\u8d8a\u5c0f\uff0c\u8fc7\u6ee4\u5668\u6267\u884c\u4f18\u5148\u7ea7\u8d8a\u9ad8\n        return new OrderedGatewayFilter(new GatewayFilter() {\n            @Override\n            public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n                // \u83b7\u53d6config\u503c\n                String a = config.getA();\n                String b = config.getB();\n                String c = config.getC();\n                // \u7f16\u5199\u8fc7\u6ee4\u5668\u903b\u8f91\n                System.out.println(\"a = \" + a);\n                System.out.println(\"b = \" + b);\n                System.out.println(\"c = \" + c);\n                // \u653e\u884c\n                return chain.filter(exchange);\n            }\n        }, 100);\n    }\n\n    // \u81ea\u5b9a\u4e49\u914d\u7f6e\u5c5e\u6027\uff0c\u6210\u5458\u53d8\u91cf\u540d\u79f0\u5f88\u91cd\u8981\uff0c\u4e0b\u9762\u4f1a\u7528\u5230\n    @Data\n    static class Config{\n        private String a;\n        private String b;\n        private String c;\n    }\n    // \u5c06\u53d8\u91cf\u540d\u79f0\u4f9d\u6b21\u8fd4\u56de\uff0c\u987a\u5e8f\u5f88\u91cd\u8981\uff0c\u5c06\u6765\u8bfb\u53d6\u53c2\u6570\u65f6\u9700\u8981\u6309\u987a\u5e8f\u83b7\u53d6\n    @Override\n    public List&lt;String&gt; shortcutFieldOrder() {\n        return List.of(\"a\", \"b\", \"c\");\n    }\n        // \u8fd4\u56de\u5f53\u524d\u914d\u7f6e\u7c7b\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u5185\u90e8\u7684Config\n    @Override\n    public Class&lt;Config&gt; getConfigClass() {\n        return Config.class;\n    }\n\n}\n</code></pre> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528</p> <pre><code>spring:\n  cloud:\n    gateway:\n      default-filters:\n            - PrintAny=1,2,3 # \u6ce8\u610f\uff0c\u8fd9\u91cc\u591a\u4e2a\u53c2\u6570\u4ee5\",\"\u9694\u5f00\uff0c\u5c06\u6765\u4f1a\u6309\u7167shortcutFieldOrder()\u65b9\u6cd5\u8fd4\u56de\u7684\u53c2\u6570\u987a\u5e8f\u4f9d\u6b21\u590d\u5236\n</code></pre> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u767b\u5f55\u6821\u9a8c\u8fc7\u6ee4\u5668","title":"\u767b\u5f55\u6821\u9a8c\u8fc7\u6ee4\u5668","text":"<p>\u81ea\u5b9a\u4e49<code>GlobalFilter</code>\u4ee5\u5b9e\u73b0\u767b\u5f55\u6821\u9a8c</p> <pre><code>@Component\n@RequiredArgsConstructor\n@EnableConfigurationProperties(AuthProperties.class)\npublic class AuthGlobalFilter implements GlobalFilter, Ordered {\n\n    private final JwtTool jwtTool;\n\n    private final AuthProperties authProperties;\n\n    // \u5305\u542b\u901a\u914d\u7b26\u7684\u8def\u5f84\u5339\u914d\u5668\uff0c\u7531Spring\u63d0\u4f9b\n    private final AntPathMatcher antPathMatcher = new AntPathMatcher();\n\n    @Override\n    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        // 1.\u83b7\u53d6Request\n        ServerHttpRequest request = exchange.getRequest();\n        // 2.\u5224\u65ad\u662f\u5426\u4e0d\u9700\u8981\u62e6\u622a\n        if(isExclude(request.getPath().toString())){\n            // \u65e0\u9700\u62e6\u622a\uff0c\u76f4\u63a5\u653e\u884c\n            return chain.filter(exchange);\n        }\n        // 3.\u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u7684token\n        String token = null;\n        List&lt;String&gt; headers = request.getHeaders().get(\"Authorization\");\n        if (!CollUtils.isEmpty(headers)) {\n            token = headers.get(0);\n        }\n        // 4.\u6821\u9a8c\u5e76\u89e3\u6790token\n        Long userId = null;\n        try {\n            userId = jwtTool.parseToken(token);\n        } catch (UnauthorizedException e) {\n            // \u5982\u679c\u65e0\u6548\uff0c\u62e6\u622a\n            ServerHttpResponse response = exchange.getResponse();\n            response.setRawStatusCode(401);\n            return response.setComplete();\n        }\n\n        // TODO 5.\u5982\u679c\u6709\u6548\uff0c\u4f20\u9012\u7528\u6237\u4fe1\u606f\n        System.out.println(\"userId = \" + userId);\n        // 6.\u653e\u884c\n        return chain.filter(exchange);\n    }\n\n    private boolean isExclude(String antPath) {\n        for (String pathPattern : authProperties.getExcludePaths()) {\n            if(antPathMatcher.match(pathPattern, antPath)){\n                return true;\n            }\n        }\n        return false;\n    }\n\n    @Override\n    public int getOrder() {\n        return 0;\n    }\n}\n</code></pre> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#\u7528\u6237\u4fe1\u606f\u5411\u4e0b\u6e38\u4f20\u9012","title":"\u7528\u6237\u4fe1\u606f\u5411\u4e0b\u6e38\u4f20\u9012","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u4fee\u6539\u767b\u5f55\u6821\u9a8c\u62e6\u622a\u5668\u7684\u5904\u7406\u903b\u8f91\uff0c\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230\u8bf7\u6c42\u5934\u4e2d\uff1a</p> <pre><code>// TODO: \u4f20\u9012\u7528\u6237\u4fe1\u606f\nServerWebExchange build = exchange.mutate()\n        .request(builder -&gt; builder.header(\"user-info\", userInfo))\n        .build();\n\n// \u653e\u884c\nreturn chain.filter(build);\n</code></pre> <p>\u5728\u901a\u7528\u6a21\u5757<code>common</code>\u4e2d\u7f16\u5199\u62e6\u622a\u5668\u83b7\u53d6\u7528\u6237\u4fe1\u606f</p> <pre><code>public class UserInfoInterceptor implements HandlerInterceptor {\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        // 1.\u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u7684\u7528\u6237\u4fe1\u606f\n        String userInfo = request.getHeader(\"user-info\");\n        // 2.\u5224\u65ad\u662f\u5426\u4e3a\u7a7a\n        if (StrUtil.isNotBlank(userInfo)) {\n            // \u4e0d\u4e3a\u7a7a\uff0c\u4fdd\u5b58\u5230ThreadLocal\n            UserContext.setUser(Long.valueOf(userInfo));\n        }\n        // 3.\u653e\u884c\n        return true;\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        // \u79fb\u9664\u7528\u6237\n        UserContext.removeUser();\n    }\n}\n</code></pre> <p>\u7531\u4e8e\u62e6\u622a\u5668\u9700\u8981\u914d\u7f6e\u624d\u80fd\u751f\u6548\uff0c\u9700\u7f16\u5199\u914d\u7f6e\u7c7b\u6765\u914d\u7f6e\u767b\u5f55\u62e6\u622a\u5668</p> <pre><code>@Configuration\n@ConditionalOnClass(DispatcherServlet.class)\npublic class MvcConfig implements WebMvcConfigurer {\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // \u6dfb\u52a0\u81ea\u5b9a\u4e49\u62e6\u622a\u5668\n        registry.addInterceptor(new UserInfoInterceptor());\n    }\n}\n</code></pre> <p>Note</p> <p>\u8bb8\u591a\u670d\u52a1\u6a21\u5757\u90fd\u5f15\u7528\u4e86\u8be5\u901a\u7528\u6a21\u5757\uff0c<code>@ConditionalOnClass(DispatcherServlet.class</code>\u6ce8\u89e3\u4fdd\u8bc1\u4e86\u53ea\u6709\u4f7f\u7528\u4e86SpringMVC\u7684\u5fae\u670d\u52a1\u624d\u4f1a\u81ea\u52a8\u914d\u7f6e\uff0c\u4f8b\u5982\u7f51\u5173\u6a21\u5757\u5e76\u6ca1\u6709\u57fa\u4e8eSpringMVC,\u4e0d\u52a0\u8be5\u6ce8\u89e3\u4f1a\u542f\u52a8\u5931\u8d25</p> <p>\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u914d\u7f6e\u7c7b\u9ed8\u8ba4\u662f\u4e0d\u4f1a\u751f\u6548\u7684\uff0c\u56e0\u4e3a\u5b83\u6240\u5728\u7684\u5305\u4e0e\u5176\u5b83\u5fae\u670d\u52a1\u7684\u626b\u63cf\u5305\u4e0d\u4e00\u81f4\uff0c\u65e0\u6cd5\u88ab\u626b\u63cf\u5230\uff0c\u56e0\u6b64\u65e0\u6cd5\u751f\u6548\u3002</p> <p>\u57fa\u4e8eSpringBoot\u7684\u81ea\u52a8\u88c5\u914d\u539f\u7406\uff0c\u6211\u4eec\u8981\u5c06\u5176\u6dfb\u52a0\u5230<code>resources</code>\u76ee\u5f55\u4e0b\u7684<code>META-INF/spring.factories</code>\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\n  com.xxx.config.MvcConfig\n</code></pre> <p></p>"},{"location":"SpringCloud/%E7%BD%91%E5%85%B3/#openfeign\u4f20\u9012\u7528\u6237","title":"OpenFeign\u4f20\u9012\u7528\u6237","text":"<p>\u524d\u7aef\u53d1\u8d77\u7684\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7\u7f51\u5173\u518d\u5230\u5fae\u670d\u52a1\uff0c\u7531\u4e8e\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684\u8fc7\u6ee4\u5668\u548c\u62e6\u622a\u5668\u529f\u80fd\uff0c\u5fae\u670d\u52a1\u53ef\u4ee5\u8f7b\u677e\u83b7\u53d6\u767b\u5f55\u7528\u6237\u4fe1\u606f\u3002</p> <p>\u4f46\u6709\u4e9b\u4e1a\u52a1\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u8bf7\u6c42\u5230\u8fbe\u5fae\u670d\u52a1\u540e\u8fd8\u9700\u8981\u8c03\u7528\u5176\u5b83\u591a\u4e2a\u5fae\u670d\u52a1\u3002\u6bd4\u5982\u4e0b\u5355\u4e1a\u52a1\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0b\u5355\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8c03\u7528\u5546\u54c1\u670d\u52a1\u6263\u51cf\u5e93\u5b58\uff0c\u8c03\u7528\u8d2d\u7269\u8f66\u670d\u52a1\u6e05\u7406\u7528\u6237\u8d2d\u7269\u8f66\u3002\u800c\u6e05\u7406\u8d2d\u7269\u8f66\u65f6\u5fc5\u987b\u77e5\u9053\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u8eab\u4efd\u3002\u4f46\u662f\uff0c\u8ba2\u5355\u670d\u52a1\u8c03\u7528\u8d2d\u7269\u8f66\u65f6\u5e76\u6ca1\u6709\u4f20\u9012\u7528\u6237\u4fe1\u606f\uff0c\u8d2d\u7269\u8f66\u670d\u52a1\u65e0\u6cd5\u77e5\u9053\u5f53\u524d\u7528\u6237\u662f\u8c01\uff01</p> <p>\u7531\u4e8e\u5fae\u670d\u52a1\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u662f\u901a\u8fc7\u62e6\u622a\u5668\u5728\u8bf7\u6c42\u5934\u4e2d\u8bfb\u53d6\uff0c\u56e0\u6b64\u8981\u60f3\u5b9e\u73b0\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u7528\u6237\u4fe1\u606f\u4f20\u9012\uff0c\u5c31\u5fc5\u987b\u5728\u5fae\u670d\u52a1\u53d1\u8d77\u8c03\u7528\u65f6\u628a\u7528\u6237\u4fe1\u606f\u5b58\u5165\u8bf7\u6c42\u5934</p> <p>\u5fae\u670d\u52a1\u4e4b\u95f4\u8c03\u7528\u662f\u57fa\u4e8eOpenFeign\u6765\u5b9e\u73b0\u7684\uff0c\u5e76\u4e0d\u662f\u6211\u4eec\u81ea\u5df1\u53d1\u9001\u7684\u8bf7\u6c42\u3002\u6211\u4eec\u5982\u4f55\u624d\u80fd\u8ba9\u6bcf\u4e00\u4e2a\u7531OpenFeign\u53d1\u8d77\u7684\u8bf7\u6c42\u81ea\u52a8\u643a\u5e26\u767b\u5f55\u7528\u6237\u4fe1\u606f\u5462\uff1f</p> <p>\u8fd9\u91cc\u8981\u501f\u52a9Feign\u4e2d\u63d0\u4f9b\u7684\u4e00\u4e2a\u62e6\u622a\u5668\u63a5\u53e3\uff1a<code>feign.RequestInterceptor</code></p> <pre><code>public interface RequestInterceptor {\n\n  /**\n   * Called for every request. \n   * Add data using methods on the supplied {@link RequestTemplate}.\n   */\n  void apply(RequestTemplate template);\n}\n</code></pre> <p>\u5728\u901a\u7528\u6a21\u5757\u4e2d\u914d\u7f6e\u62e6\u622a\u5668</p> <pre><code>public class DefaultFeignConfig {\n    @Bean\n    public Logger.Level feignLoggerLevel() {\n        return Logger.Level.FULL;\n    }\n\n    @Bean\n    public RequestInterceptor feignRequestInterceptor() {\n        return new RequestInterceptor() {\n            @Override\n            public void apply(RequestTemplate requestTemplate) {\n                Long userId = UserContext.getUser();\n                if (userId != null) {\n                    requestTemplate.header(\"user-info\", userId.toString());\n                }\n            }\n        };\n    }\n}\n</code></pre> <p>Note</p> <p>\u4e3a\u4f7f\u914d\u7f6e\u751f\u6548\u9700\u8981\u5728\u670d\u52a1\u542f\u52a8\u7c7b\u4e0a\u6dfb\u52a0<code>@EnableFeignClients(basePackages = \"com.xxx.api.client\",defaultConfiguration = DefaultFeignConfig.class)</code></p> <p>\u4e0a\u4e00\u8282\uff1aOpenFeign</p> <p>\u4e0b\u4e00\u8282\uff1a\u914d\u7f6e\u4e2d\u5fc3</p>"},{"location":"SpringCloud/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/","title":"\u914d\u7f6e\u4e2d\u5fc3","text":"<p>\u73b0\u5728\u4f9d\u7136\u8fd8\u6709\u51e0\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\uff1a</p> <ul> <li> <p>\u7f51\u5173\u8def\u7531\u914d\u7f6e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u53d8\u66f4\u5fc5\u987b\u91cd\u542f\u5fae\u670d\u52a1</p> </li> <li> <p>\u67d0\u4e9b\u4e1a\u52a1\u914d\u7f6e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6bcf\u6b21\u4fee\u6539\u90fd\u8981\u91cd\u542f\u670d\u52a1</p> </li> <li> <p>\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u6709\u5f88\u591a\u91cd\u590d\u7684\u914d\u7f6e\uff0c\u7ef4\u62a4\u6210\u672c\u9ad8</p> </li> </ul> <p></p> <p>\u8fd9\u4e9b\u95ee\u9898\u90fd\u53ef\u4ee5\u901a\u8fc7\u7edf\u4e00\u7684\u914d\u7f6e\u7ba1\u7406\u5668\u670d\u52a1\u89e3\u51b3\u3002\u800cNacos\u4e0d\u4ec5\u4ec5\u5177\u5907\u6ce8\u518c\u4e2d\u5fc3\u529f\u80fd\uff0c\u4e5f\u5177\u5907\u914d\u7f6e\u7ba1\u7406\u7684\u529f\u80fd\uff1a</p> <p></p> <p></p>"},{"location":"SpringCloud/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/#\u914d\u7f6e\u5171\u4eab","title":"\u914d\u7f6e\u5171\u4eab","text":"<p>1.\u6dfb\u52a0\u5171\u4eab\u914d\u7f6e</p> <p>\u9996\u5148\u662fjdbc\u76f8\u5173\u914d\u7f6e\uff0c\u5728<code>\u914d\u7f6e\u7ba1\u7406</code>-&gt;<code>\u914d\u7f6e\u5217\u8868</code>\u4e2d\u70b9\u51fb<code>+</code>\u65b0\u5efa\u4e00\u4e2a\u914d\u7f6e</p> <p></p> <p>2.\u62c9\u53d6\u5171\u4eab\u914d\u7f6e</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u5728\u5fae\u670d\u52a1\u62c9\u53d6\u5171\u4eab\u914d\u7f6e\u3002\u5c06\u62c9\u53d6\u5230\u7684\u5171\u4eab\u914d\u7f6e\u4e0e\u672c\u5730\u7684<code>application.yaml</code>\u914d\u7f6e\u5408\u5e76\uff0c\u5b8c\u6210\u9879\u76ee\u4e0a\u4e0b\u6587\u7684\u521d\u59cb\u5316\u3002</p> <p>\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8bfb\u53d6Nacos\u914d\u7f6e\u7684\u662fSpringCloud\u4e0a\u4e0b\u6587\uff08<code>ApplicationContext</code>\uff09\u521d\u59cb\u5316\u65f6\u5904\u7406\u7684\uff0c\u53d1\u751f\u5728\u9879\u76ee\u7684\u5f15\u5bfc\u9636\u6bb5\u3002\u7136\u540e\u624d\u4f1a\u521d\u59cb\u5316SpringBoot\u4e0a\u4e0b\u6587\uff0c\u53bb\u8bfb\u53d6<code>application.yaml</code>\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\u5f15\u5bfc\u9636\u6bb5\uff0c<code>application.yaml</code>\u6587\u4ef6\u5c1a\u672a\u8bfb\u53d6\uff0c\u6839\u672c\u4e0d\u77e5\u9053nacos \u5730\u5740\uff0c\u8be5\u5982\u4f55\u53bb\u52a0\u8f7dnacos\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u5462\uff1f</p> <p>SpringCloud\u5728\u521d\u59cb\u5316\u4e0a\u4e0b\u6587\u7684\u65f6\u5019\u4f1a\u5148\u8bfb\u53d6\u4e00\u4e2a\u540d\u4e3a<code>bootstrap.yaml</code>(\u6216\u8005<code>bootstrap.properties</code>)\u7684\u6587\u4ef6\uff0c\u5982\u679c\u6211\u4eec\u5c06nacos\u5730\u5740\u914d\u7f6e\u5230<code>bootstrap.yaml</code>\u4e2d\uff0c\u90a3\u4e48\u5728\u9879\u76ee\u5f15\u5bfc\u9636\u6bb5\u5c31\u53ef\u4ee5\u8bfb\u53d6nacos\u4e2d\u7684\u914d\u7f6e\u4e86\u3002</p> <p></p> <p>\u8be6\u7ec6\u6b65\u9aa4\uff1a</p> <ul> <li>\u5f15\u5165\u4f9d\u8d56</li> </ul> <pre><code>  &lt;!--nacos\u914d\u7f6e\u7ba1\u7406--&gt;\n  &lt;dependency&gt;\n      &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;\n  &lt;/dependency&gt;\n\n  &lt;!--\u8bfb\u53d6bootstrap\u6587\u4ef6--&gt;\n  &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;\n  &lt;/dependency&gt;\n</code></pre> <ul> <li>\u65b0\u5efabootstrap.yaml</li> </ul> <pre><code>spring:\n  application:\n    name: xxx-service # \u670d\u52a1\u540d\u79f0\n  profiles:\n    active: dev\n  cloud:\n    nacos:\n      server-addr: localhost:8848 # nacos\u5730\u5740\n      config:\n        file-extension: yaml # \u6587\u4ef6\u540e\u7f00\u540d\n        shared-configs: # \u5171\u4eab\u914d\u7f6e\n          - dataId: shared-jdbc.yaml # \u5171\u4eabmybatis\u914d\u7f6e\n          - dataId: shared-log.yaml # \u5171\u4eab\u65e5\u5fd7\u914d\u7f6e\n          - dataId: shared-swagger.yaml # \u5171\u4eabswagger\u914d\u7f6e\n</code></pre> <ul> <li>\u4fee\u6539application.yaml</li> </ul> <pre><code>server:\n  port: 8082\nfeign:\n  okhttp:\n    enabled: true # \u5f00\u542fOKHttp\u8fde\u63a5\u6c60\u652f\u6301\nhm:\n  swagger:\n    title: \u8d2d\u7269\u8f66\u670d\u52a1\u63a5\u53e3\u6587\u6863\n    package: com.xxx.cart.controller\n  db:\n    database: xxx-cart\n</code></pre> <ul> <li>\u91cd\u542f\u751f\u6548</li> </ul> <p></p>"},{"location":"SpringCloud/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/#\u914d\u7f6e\u70ed\u66f4\u65b0","title":"\u914d\u7f6e\u70ed\u66f4\u65b0","text":"<p>\u6709\u5f88\u591a\u7684\u4e1a\u52a1\u76f8\u5173\u53c2\u6570\uff0c\u5c06\u6765\u53ef\u80fd\u4f1a\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4e34\u65f6\u8c03\u6574\uff0c\u53ef\u4ee5\u5c06\u53c2\u6570\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u4f46\u662f\u4fee\u6539\u4e86\u914d\u7f6e\u8fd8\u662f\u9700\u8981\u91cd\u65b0\u6253\u5305\u3001\u91cd\u542f\u670d\u52a1\u624d\u80fd\u751f\u6548\u3002</p> <p>\u8fd9\u5c31\u8981\u7528\u5230Nacos\u7684\u914d\u7f6e\u70ed\u66f4\u65b0\u80fd\u529b\u4e86\uff0c\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ul> <li> <p>\u5728Nacos\u4e2d\u6dfb\u52a0\u914d\u7f6e</p> </li> <li> <p>\u5728\u5fae\u670d\u52a1\u8bfb\u53d6\u914d\u7f6e</p> </li> </ul> <p></p> <p>1.\u9996\u5148\uff0c\u6211\u4eec\u5728nacos\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6</p> <p>\u6ce8\u610f\u6587\u4ef6\u7684dataId\u683c\u5f0f</p> <pre><code>[\u670d\u52a1\u540d]-[spring.active.profile].[\u540e\u7f00\u540d]\n</code></pre> <p>\u6587\u4ef6\u540d\u79f0\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a</p> <ul> <li> <p><code>\u670d\u52a1\u540d</code>\uff1a\u6211\u4eec\u662f\u8d2d\u7269\u8f66\u670d\u52a1\uff0c\u6240\u4ee5\u662f<code>cart-service</code></p> </li> <li> <p><code>spring.active.profile</code>\uff1a\u5c31\u662fspring boot\u4e2d\u7684<code>spring.active.profile</code>\uff0c\u53ef\u4ee5\u7701\u7565\uff0c\u5219\u6240\u6709profile\u5171\u4eab\u8be5\u914d\u7f6e</p> </li> <li> <p><code>\u540e\u7f00\u540d</code>\uff1a\u4f8b\u5982yaml</p> </li> </ul> <p>2.\u63a5\u7740\uff0c\u6211\u4eec\u5728\u5fae\u670d\u52a1\u4e2d\u8bfb\u53d6\u914d\u7f6e\uff0c\u5b9e\u73b0\u914d\u7f6e\u70ed\u66f4\u65b0</p> <p>\u7f16\u5199\u5c5e\u6027\u7c7b\u8bfb\u53d6\u914d\u7f6e</p> <pre><code>@Data\n@Component\n@ConfigurationProperties(prefix = \"xxx.cart\")\npublic class CartProperties {\n    private Integer maxAmount;\n}\n</code></pre> <p>3.\u5728\u4e1a\u52a1\u4e2d\u6ce8\u5165\u5c5e\u6027\u7c7b\u5e76\u4f7f\u7528\u5373\u53ef</p> <p></p>"},{"location":"SpringCloud/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/#\u52a8\u6001\u8def\u7531","title":"\u52a8\u6001\u8def\u7531","text":"<p>\u7f51\u5173\u7684\u8def\u7531\u914d\u7f6e\u5168\u90e8\u662f\u5728\u9879\u76ee\u542f\u52a8\u65f6\u7531<code>org.springframework.cloud.gateway.route.CompositeRouteDefinitionLocator</code>\u5728\u9879\u76ee\u542f\u52a8\u7684\u65f6\u5019\u52a0\u8f7d\uff0c\u5e76\u4e14\u4e00\u7ecf\u52a0\u8f7d\u5c31\u4f1a\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\u7684\u8def\u7531\u8868\u5185\uff08\u4e00\u4e2aMap\uff09\uff0c\u4e0d\u4f1a\u6539\u53d8\u3002\u4e5f\u4e0d\u4f1a\u76d1\u542c\u8def\u7531\u53d8\u66f4\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u65e0\u6cd5\u5229\u7528\u4e0a\u5c0f\u8282\u5b66\u4e60\u7684\u914d\u7f6e\u70ed\u66f4\u65b0\u6765\u5b9e\u73b0\u8def\u7531\u66f4\u65b0\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5fc5\u987b\u76d1\u542cNacos\u7684\u914d\u7f6e\u53d8\u66f4\uff0c\u7136\u540e\u624b\u52a8\u628a\u6700\u65b0\u7684\u8def\u7531\u66f4\u65b0\u5230\u8def\u7531\u8868\u4e2d\u3002\u8fd9\u91cc\u6709\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li> <p>\u5982\u4f55\u76d1\u542cNacos\u914d\u7f6e\u53d8\u66f4\uff1f</p> </li> <li> <p>\u5982\u4f55\u628a\u8def\u7531\u4fe1\u606f\u66f4\u65b0\u5230\u8def\u7531\u8868\uff1f</p> </li> </ul> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a</p> <p>1.\u5f15\u5165\u4f9d\u8d56</p> <pre><code>&lt;!--\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;!--\u52a0\u8f7dbootstrap--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>2.\u914d\u7f6e<code>bootstrap.yaml</code></p> <pre><code>spring:\n  application:\n    name: gateway\n\n  profiles:\n    active: dev\n\n  cloud:\n    nacos:\n      server-addr: localhost:8848\n      config:\n        file-extension: yaml\n        shared-configs:\n          - data-id: shared-log.yaml\n</code></pre> <p>3.\u76d1\u542c\u914d\u7f6e\u53d8\u66f4</p> <p>\u53c2\u8003\u8d44\u6599</p> <p>\u5b98\u65b9\u6587\u6863\u76d1\u542c\u914d\u7f6e\u53d8\u66f4 Java SDK</p> <p>\u5982\u679c\u5e0c\u671b Nacos \u63a8\u9001\u914d\u7f6e\u53d8\u66f4\uff0c\u53ef\u4ee5\u4f7f\u7528 Nacos \u52a8\u6001\u76d1\u542c\u914d\u7f6e\u63a5\u53e3\u6765\u5b9e\u73b0\u3002</p> <pre><code>public void addListener(String dataId, String group, Listener listener)\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>@Slf4j\n@Component\n@RequiredArgsConstructor\npublic class DynamicRouterLoader {\n\n    private final NacosConfigManager nacosConfigManager;\n\n    private final RouteDefinitionWriter writer;\n\n    private static final String dataId = \"gateway-routes.json\";\n\n    private static final String group = \"DEFAULT_GROUP\";\n\n    private final Set&lt;String&gt; roueIds = new HashSet&lt;&gt;();\n\n    @PostConstruct\n    public void initRouterConfigListener() throws NacosException {\n        String configInfo = nacosConfigManager.getConfigService()\n                .getConfigAndSignListener(dataId, group, 5000, new Listener() {\n                    @Override\n                    public Executor getExecutor() {\n                        return null;\n                    }\n\n                    @Override\n                    public void receiveConfigInfo(String s) {\n                        // TODO: \u76d1\u542c\u914d\u7f6e\u53d8\u66f4\uff0c\u91cd\u65b0\u52a0\u8f7d\u8def\u7531\u914d\u7f6e\n                        updateConfigInfo(s);\n                    }\n                });\n        // \u521d\u59cb\u52a0\u8f7d\u8def\u7531\u914d\u7f6e\n        updateConfigInfo(configInfo);\n    }\n}\n</code></pre> <p>\u8fd9\u91cc\u6838\u5fc3\u7684\u6b65\u9aa4\u67092\u6b65\uff1a</p> <ul> <li> <p>\u521b\u5efaConfigService\uff0c\u76ee\u7684\u662f\u8fde\u63a5\u5230Nacos(SpringBoot\u5df2\u81ea\u52a8\u88c5\u914d)</p> </li> <li> <p>\u6dfb\u52a0\u914d\u7f6e\u76d1\u542c\u5668\uff0c\u7f16\u5199\u914d\u7f6e\u53d8\u66f4\u7684\u901a\u77e5\u5904\u7406\u903b\u8f91</p> </li> </ul> <p>Warning</p> <p>\u6ce8\u610f\uff1a\u9879\u76ee\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6\u4e0d\u4ec5\u4ec5\u9700\u8981\u6dfb\u52a0\u76d1\u542c\u5668\uff0c\u4e5f\u9700\u8981\u624b\u52a8\u8bfb\u53d6\u914d\u7f6e</p> <p>4.\u66f4\u65b0\u8def\u7531</p> <p>\u66f4\u65b0\u8def\u7531\u8981\u7528\u5230<code>org.springframework.cloud.gateway.route.RouteDefinitionWriter</code>\u8fd9\u4e2a\u63a5\u53e3\uff1a</p> <pre><code>public interface RouteDefinitionWriter {\n    /**\n     * \u66f4\u65b0\u8def\u7531\u5230\u8def\u7531\u8868\uff0c\u5982\u679c\u8def\u7531id\u91cd\u590d\uff0c\u5219\u4f1a\u8986\u76d6\u65e7\u7684\u8def\u7531\n     */\n        Mono&lt;Void&gt; save(Mono&lt;RouteDefinition&gt; route);\n    /**\n     * \u6839\u636e\u8def\u7531id\u5220\u9664\u67d0\u4e2a\u8def\u7531\n     */\n        Mono&lt;Void&gt; delete(Mono&lt;String&gt; routeId);\n\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>    public void updateConfigInfo(String configInfo){\n        // TODO: \u66f4\u65b0\u8def\u7531\u914d\u7f6e\n\n        log.debug(\"\u76d1\u542c\u5230\u8def\u7531\u914d\u7f6e\u53d8\u66f4\uff0c\u91cd\u65b0\u52a0\u8f7d\u8def\u7531\u914d\u7f6e:{}\",configInfo);\n\n        // \u89e3\u6790\u914d\u7f6e\u4fe1\u606f\uff0c\u5c01\u88c5\u6210RouteDefinition\u5bf9\u8c61\n        List&lt;RouteDefinition&gt; routeDefinitions = JSONUtil.toList(configInfo, RouteDefinition.class);\n\n        // \u6e05\u7a7a\u65e7\u7684\u8def\u7531\u4fe1\u606f\n        for (String routeId : roueIds){\n            writer.delete(Mono.just(routeId)).subscribe();\n        }\n\n        // \u6e05\u7a7a\u8def\u7531ID\u96c6\u5408\n        roueIds.clear();\n\n        // \u66f4\u65b0\u8def\u7531\u8868\n        for (RouteDefinition routeDefinition : routeDefinitions) {\n            writer.save(Mono.just(routeDefinition)).subscribe();\n            // \u8bb0\u5f55\u8def\u7531ID\n            roueIds.add(routeDefinition.getId());\n        }\n    }\n</code></pre> <p>nacos\u8def\u7531\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\u793a\u4f8b\uff1a</p> <pre><code>[\n    {\n        \"id\": \"item\",\n        \"predicates\": [{\n            \"name\": \"Path\",\n            \"args\":{\"_genkey_0\":\"/items/**\", \"_genkey_1\":\"/search/**\"}\n        }],\n        \"filters\": [],\n        \"uri\": \"lb://item-service\"\n    },\n    {\n        \"id\": \"cart\",\n        \"predicates\": [{\n            \"name\": \"Path\",\n            \"args\": {\"_genkey_0\":\"/carts/**\"}\n        }],\n        \"filters\": [],\n        \"uri\": \"lb://cart-service\"\n    }\n]\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u7f51\u5173</p> <p>\u4e0b\u4e00\u8282\uff1a\u670d\u52a1\u4fdd\u62a4</p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/","title":"\u9762\u8bd5","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u95ee\u9898","title":"\u7f13\u5b58\u95ee\u9898","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u4e00\u81f4\u6027\u53cc\u5199\u4e00\u81f4\u6027","title":"\u7f13\u5b58\u4e00\u81f4\u6027\uff08\u53cc\u5199\u4e00\u81f4\u6027\uff09","text":"<p>\u7f13\u5b58\u7684\u901a\u7528\u6a21\u578b\u6709\u4e09\u79cd\uff1a</p> <ul> <li><code>Cache Aside</code>\uff08\u5e38\u7528\uff09\uff1a\u7531\u7f13\u5b58\u8c03\u7528\u8005\u81ea\u5df1\u7ef4\u62a4\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u7684\u4e00\u81f4\u6027\u3002<ul> <li>\u67e5\u8be2\u65f6\uff1a\u547d\u4e2d\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u672a\u547d\u4e2d\u5219\u67e5\u8be2\u6570\u636e\u5e93\u5e76\u5199\u5165\u7f13\u5b58</li> <li>\u66f4\u65b0\u65f6\uff1a\u66f4\u65b0\u6570\u636e\u5e93\u5e76\u5220\u9664\u7f13\u5b58</li> </ul> </li> <li><code>Read/Write Through</code>\uff1a\u6570\u636e\u5e93\u81ea\u5df1\u7ef4\u62a4\u4e00\u4efd\u7f13\u5b58\uff0c\u5e95\u5c42\u5b9e\u73b0\u5bf9\u8c03\u7528\u8005\u900f\u660e\u3002<ul> <li>\u67e5\u8be2\u65f6\uff1a\u547d\u4e2d\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u672a\u547d\u4e2d\u5219\u67e5\u8be2\u6570\u636e\u5e93\u5e76\u5199\u5165\u7f13\u5b58</li> <li>\u66f4\u65b0\u65f6\uff1a\u5224\u65ad\u7f13\u5b58\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u76f4\u63a5\u66f4\u65b0\u6570\u636e\u5e93\u3002\u5b58\u5728\u5219\u66f4\u65b0\u7f13\u5b58\uff0c\u540c\u6b65\u66f4\u65b0\u6570\u636e\u5e93</li> </ul> </li> <li><code>Write Behind Cahing</code>\uff1a\u8bfb\u5199\u64cd\u4f5c\u90fd\u76f4\u63a5\u64cd\u4f5c\u7f13\u5b58\uff0c\u7531\u7ebf\u7a0b\u5f02\u6b65\u5730\u5c06\u7f13\u5b58\u6570\u636e\u540c\u6b65\u5230\u6570\u636e\u5e93</li> </ul> <p></p> <p><code>Cache Aside</code>\u7684\u5199\u64cd\u4f5c\u662f\u8981\u5728\u66f4\u65b0\u6570\u636e\u5e93\u7684\u540c\u65f6\u5220\u9664\u7f13\u5b58</p> <p>\u90a3\u5230\u5e95\u662f\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\uff0c\u8fd8\u662f\u5148\u5220\u9664\u7f13\u5b58\u518d\u66f4\u65b0\u6570\u636e\u5e93\u5462\uff1f</p> <p>\u5047\u8bbe\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u66f4\u65b0\u6570\u636e\uff0c\u4e00\u4e2a\u67e5\u8be2\u6570\u636e</p> <ul> <li>\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58</li> </ul> <p>\u6b63\u5e38\u60c5\u51b5</p> <p></p> <p>\u5f02\u5e38\u60c5\u51b5</p> <p></p> <p>\u7531\u4e8e\u66f4\u65b0\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u672c\u8eab\u6bd4\u8f83\u8017\u65f6\uff0c\u5728\u671f\u95f4\u6709\u7ebf\u7a0b\u6765\u67e5\u8be2\u6570\u636e\u5e93\u5e76\u66f4\u65b0\u7f13\u5b58\u7684\u6982\u7387\u975e\u5e38\u9ad8\u3002\u56e0\u6b64\u4e0d\u63a8\u8350\u8fd9\u79cd\u65b9\u6848\u3002</p> <p></p> <ul> <li>\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58</li> </ul> <p>\u6b63\u5e38\u60c5\u51b5</p> <p></p> <p>\u5f02\u5e38\u60c5\u51b5</p> <p></p> <p>\u5f02\u5e38\u6982\u7387\u8f83\u4f4e\uff0c\u7ebf\u7a0b1\u5fc5\u987b\u662f\u67e5\u8be2\u6570\u636e\u5e93\u5df2\u7ecf\u5b8c\u6210\uff0c\u4f46\u662f\u7f13\u5b58\u5c1a\u672a\u5199\u5165\u4e4b\u524d\u3002\u7ebf\u7a0b2\u8981\u5b8c\u6210\u66f4\u65b0\u6570\u636e\u5e93\u540c\u65f6\u5220\u9664\u7f13\u5b58\u7684\u4e24\u4e2a\u64cd\u4f5c\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u65b9\u5f0f\u662f\u5ef6\u65f6\u53cc\u5220\uff0c\u5373\u5728\u66f4\u65b0\u6570\u636e\u5e93\u540e\uff0c\u5148\u5220\u9664\u7f13\u5b58\uff0c\u7136\u540e\u518d\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u5220\u9664\u4e00\u6b21\u7f13\u5b58\u3002\u8fd9\u6837\u53ef\u4ee5\u964d\u4f4e\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u6982\u7387\u3002</p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u7a7f\u900f","title":"\u7f13\u5b58\u7a7f\u900f","text":"<p>\u5982\u679c\u8bbf\u95ee\u4e00\u4e2a\u6570\u636e\u5e93\u4e2d\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u90a3\u4e48\u7f13\u5b58\u4e2d\u80af\u5b9a\u4e5f\u4e0d\u5b58\u5728\u3002\u56e0\u6b64\u4e0d\u7ba1\u8bf7\u6c42\u8be5\u6570\u636e\u591a\u5c11\u6b21\uff0c\u7f13\u5b58\u6c38\u8fdc\u4e0d\u53ef\u80fd\u5efa\u7acb\uff0c\u8bf7\u6c42\u6c38\u8fdc\u4f1a\u76f4\u8fbe\u6570\u636e\u5e93\u3002</p> <p>\u5047\u5982\u6709\u4e0d\u6000\u597d\u610f\u7684\u4eba\uff0c\u5f00\u542f\u5f88\u591a\u7ebf\u7a0b\u9891\u7e41\u7684\u8bbf\u95ee\u4e00\u4e2a\u6570\u636e\u5e93\u4e2d\u4e5f\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\u7531\u4e8e\u7f13\u5b58\u4e0d\u53ef\u80fd\u751f\u6548\uff0c\u90a3\u4e48\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u53ef\u80fd\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u56e0\u8fc7\u9ad8\u7684\u538b\u529b\u800c\u5b95\u673a\u3002</p> <p>\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u6709\u4e24\u79cd\u601d\u8def\uff1a</p> <ul> <li> <p>\u7f13\u5b58\u7a7a\u5bf9\u8c61</p> <ul> <li>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u7ef4\u62a4\u65b9\u4fbf</li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u989d\u5916\u7684\u5185\u5b58\u6d88\u8017</li> <li>\u53ef\u80fd\u9020\u6210\u77ed\u671f\u7684\u4e0d\u4e00\u81f4</li> </ul> </li> </ul> </li> <li> <p>\u5e03\u9686\u8fc7\u6ee4</p> <ul> <li>\u4f18\u70b9\uff1a\u5185\u5b58\u5360\u7528\u8f83\u5c11\uff0c\u6ca1\u6709\u591a\u4f59key</li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u5b9e\u73b0\u590d\u6742</li> <li>\u5b58\u5728\u8bef\u5224\u53ef\u80fd</li> </ul> </li> </ul> </li> </ul> <p></p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u96ea\u5d29","title":"\u7f13\u5b58\u96ea\u5d29","text":"<p>\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5728\u540c\u4e00\u65f6\u6bb5\u5927\u91cf\u7684\u7f13\u5b58key\u540c\u65f6\u5931\u6548\u6216\u8005Redis\u670d\u52a1\u5b95\u673a\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u5230\u8fbe\u6570\u636e\u5e93\uff0c\u5e26\u6765\u5de8\u5927\u538b\u529b\u3002</p> <p>\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\uff1a</p> <ul> <li>\u7ed9\u4e0d\u540c\u7684Key\u7684TTL\u6dfb\u52a0\u968f\u673a\u503c\uff0c\u8fd9\u6837KEY\u7684\u8fc7\u671f\u65f6\u95f4\u4e0d\u540c\uff0c\u4e0d\u4f1a\u5927\u91cfKEY\u540c\u65f6\u8fc7\u671f</li> <li>\u5229\u7528Redis\u96c6\u7fa4\u63d0\u9ad8\u670d\u52a1\u7684\u53ef\u7528\u6027\uff0c\u907f\u514d\u7f13\u5b58\u670d\u52a1\u5b95\u673a</li> <li>\u7ed9\u7f13\u5b58\u4e1a\u52a1\u6dfb\u52a0\u964d\u7ea7\u9650\u6d41\u7b56\u7565</li> <li>\u7ed9\u4e1a\u52a1\u6dfb\u52a0\u591a\u7ea7\u7f13\u5b58\uff0c\u6bd4\u5982\u5148\u67e5\u8be2\u672c\u5730\u7f13\u5b58\uff0c\u672c\u5730\u7f13\u5b58\u672a\u547d\u4e2d\u518d\u67e5\u8be2Redis\uff0cRedis\u672a\u547d\u4e2d\u518d\u67e5\u8be2\u6570\u636e\u5e93\u3002\u5373\u4fbfRedis\u5b95\u673a\uff0c\u4e5f\u8fd8\u6709\u672c\u5730\u7f13\u5b58\u53ef\u4ee5\u6297\u538b\u529b</li> </ul> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7f13\u5b58\u51fb\u7a7f","title":"\u7f13\u5b58\u51fb\u7a7f","text":"<p>\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u4e5f\u53eb\u70ed\u70b9Key\u95ee\u9898\uff0c\u5c31\u662f\u4e00\u4e2a\u88ab\u9ad8\u5e76\u53d1\u8bbf\u95ee\u5e76\u4e14\u7f13\u5b58\u91cd\u5efa\u4e1a\u52a1\u8f83\u590d\u6742\u7684key\u7a81\u7136\u5931\u6548\u4e86\uff0c\u65e0\u6570\u7684\u8bf7\u6c42\u8bbf\u95ee\u4f1a\u5728\u77ac\u95f4\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u51b2\u51fb\u3002</p> <p>\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u4e92\u65a5\u9501\uff1a\u7ed9\u91cd\u5efa\u7f13\u5b58\u903b\u8f91\u52a0\u9501\uff0c\u907f\u514d\u591a\u7ebf\u7a0b\u540c\u65f6\u6307\u5411</li> <li>\u903b\u8f91\u8fc7\u671f\uff1a\u70ed\u70b9key\u4e0d\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5728\u6d3b\u52a8\u7ed3\u675f\u540e\u624b\u52a8\u5220\u9664\u3002</li> </ul> <p>\u57fa\u4e8e\u4e92\u65a5\u9501\u7684\u65b9\u6848\u5982\u56fe\uff1a</p> <p></p> <p>\u903b\u8f91\u8fc7\u671f\u7684\u601d\u8def\u5982\u56fe\uff1a</p> <p></p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u5fae\u670d\u52a1","title":"\u5fae\u670d\u52a1","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u5206\u5e03\u5f0f\u4e8b\u52a1","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#cap\u5b9a\u7406\u548cbase\u7406\u8bba","title":"CAP\u5b9a\u7406\u548cBASE\u7406\u8bba","text":"<p>1.CAP\u5b9a\u7406</p> <p>1998\u5e74\uff0c\u52a0\u5dde\u5927\u5b66\u7684\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6 Eric Brewer \u63d0\u51fa\uff0c\u5206\u5e03\u5f0f\u7cfb\u7edf\u6709\u4e09\u4e2a\u6307\u6807\uff1a</p> <ul> <li>Consistency\uff08\u4e00\u81f4\u6027\uff09</li> <li>Availability\uff08\u53ef\u7528\u6027\uff09</li> <li>Partition tolerance \uff08\u5206\u533a\u5bb9\u9519\u6027\uff09</li> </ul> <p>Tip</p> <p>\u5b83\u4eec\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u5206\u522b\u662f <code>C</code>\u3001<code>A</code>\u3001<code>P</code>\u3002Eric Brewer\u8ba4\u4e3a\u4efb\u4f55\u5206\u5e03\u5f0f\u7cfb\u7edf\u67b6\u6784\u65b9\u6848\u90fd\u4e0d\u53ef\u80fd\u540c\u65f6\u6ee1\u8db3\u8fd93\u4e2a\u76ee\u6807\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5c31\u53eb\u505a CAP \u5b9a\u7406\u3002</p> <p>Info</p> <p><code>Consistency</code>\uff08\u4e00\u81f4\u6027\uff09\uff1a\u7528\u6237\u8bbf\u95ee\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u4efb\u610f\u8282\u70b9\uff0c\u5f97\u5230\u7684\u6570\u636e\u5fc5\u987b\u4e00\u81f4\u3002</p> <p><code>Availability</code>\uff08\u53ef\u7528\u6027\uff09\uff1a\u7528\u6237\u8bbf\u95ee\u5206\u5e03\u5f0f\u7cfb\u7edf\u65f6\uff0c\u8bfb\u6216\u5199\u64cd\u4f5c\u603b\u80fd\u6210\u529f\u3002</p> <p><code>Partition</code>\uff08\u5206\u533a\uff09\uff1a\u5f53\u5206\u5e03\u5f0f\u7cfb\u7edf\u8282\u70b9\u4e4b\u95f4\u51fa\u73b0\u7f51\u7edc\u6545\u969c\u5bfc\u81f4\u8282\u70b9\u4e4b\u95f4\u65e0\u6cd5\u901a\u4fe1\u7684\u60c5\u51b5\u3002</p> <p><code>Tolerance</code>\uff08\u5bb9\u9519\uff09\uff1a\u5373\u4fbf\u662f\u7cfb\u7edf\u51fa\u73b0\u7f51\u7edc\u5206\u533a\uff0c\u6574\u4e2a\u7cfb\u7edf\u4e5f\u8981\u6301\u7eed\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002</p> <p></p> <p>2.BASE\u7406\u8bba</p> <ul> <li>Basically Available \uff08\u57fa\u672c\u53ef\u7528\uff09\uff1a\u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u5141\u8bb8\u635f\u5931\u90e8\u5206\u53ef\u7528\u6027\uff0c\u5373\u4fdd\u8bc1\u6838\u5fc3\u53ef\u7528\u3002</li> <li>Soft State\uff08\u8f6f\u72b6\u6001\uff09\uff1a\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\uff0c\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\uff0c\u6bd4\u5982\u4e34\u65f6\u7684\u4e0d\u4e00\u81f4\u72b6\u6001\u3002</li> <li>Eventually Consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09\uff1a\u867d\u7136\u65e0\u6cd5\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u5728\u8f6f\u72b6\u6001\u7ed3\u675f\u540e\uff0c\u6700\u7ec8\u8fbe\u5230\u6570\u636e\u4e00\u81f4\u3002</li> </ul> <p>\u4ee5\u4e0a\u5c31\u662fBASE\u7406\u8bba\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cBASE\u7406\u8bba\u5c31\u662f\u4e00\u79cd\u53d6\u820d\u7684\u65b9\u6848\uff0c\u4e0d\u518d\u8ffd\u6c42\u5b8c\u7f8e\uff0c\u800c\u662f\u6700\u7ec8\u8fbe\u6210\u76ee\u6807\u3002\u56e0\u6b64\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u601d\u60f3\u4e5f\u662f\u8fd9\u6837\uff0c\u6709\u4e24\u4e2a\u65b9\u5411\uff1a</p> <ul> <li>AP\u601d\u60f3\uff1a\u5404\u4e2a\u5b50\u4e8b\u52a1\u5206\u522b\u6267\u884c\u548c\u63d0\u4ea4\uff0c\u65e0\u9700\u9501\u5b9a\u6570\u636e\u3002\u5141\u8bb8\u51fa\u73b0\u7ed3\u679c\u4e0d\u4e00\u81f4\uff0c\u7136\u540e\u91c7\u7528\u5f25\u8865\u63aa\u65bd\u6062\u590d\uff0c\u5b9e\u73b0\u6700\u7ec8\u4e00\u81f4\u5373\u53ef\u3002\u4f8b\u5982<code>AT</code>\u6a21\u5f0f\u5c31\u662f\u5982\u6b64</li> <li>CP\u601d\u60f3\uff1a\u5404\u4e2a\u5b50\u4e8b\u52a1\u6267\u884c\u540e\u4e0d\u8981\u63d0\u4ea4\uff0c\u800c\u662f\u7b49\u5f85\u5f7c\u6b64\u7ed3\u679c\uff0c\u7136\u540e\u540c\u65f6\u63d0\u4ea4\u6216\u56de\u6eda\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9501\u5b9a\u8d44\u6e90\uff0c\u4e0d\u5141\u8bb8\u5176\u5b83\u4eba\u8bbf\u95ee\uff0c\u6570\u636e\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\uff0c\u4f46\u80fd\u4fdd\u8bc1\u4e00\u81f4\u6027\u3002\u4f8b\u5982<code>XA</code>\u6a21\u5f0f</li> </ul> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#at\u6a21\u5f0f\u7684\u810f\u5199\u95ee\u9898","title":"AT\u6a21\u5f0f\u7684\u810f\u5199\u95ee\u9898","text":"<p>\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95eeAT\u6a21\u5f0f\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u65f6\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u810f\u5199\u95ee\u9898\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u89e3\u51b3\u601d\u8def\u5c31\u662f\u5f15\u5165\u4e86\u5168\u5c40\u9501\u7684\u6982\u5ff5\u3002\u5728\u91ca\u653eDB\u9501\u4e4b\u524d\uff0c\u5148\u62ff\u5230\u5168\u5c40\u9501\u3002\u907f\u514d\u540c\u4e00\u65f6\u523b\u6709\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u6765\u64cd\u4f5c\u5f53\u524d\u6570\u636e\u3002</p> <p></p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#tcc\u6a21\u5f0f","title":"TCC\u6a21\u5f0f","text":"<p>TCC\u6a21\u5f0f\u4e0eAT\u6a21\u5f0f\u975e\u5e38\u76f8\u4f3c\uff0c\u6bcf\u9636\u6bb5\u90fd\u662f\u72ec\u7acb\u4e8b\u52a1\uff0c\u4e0d\u540c\u7684\u662fTCC\u901a\u8fc7\u4eba\u5de5\u7f16\u7801\u6765\u5b9e\u73b0\u6570\u636e\u6062\u590d\u3002\u9700\u8981\u5b9e\u73b0\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li><code>try</code>\uff1a\u8d44\u6e90\u7684\u68c0\u6d4b\u548c\u9884\u7559\uff1b </li> <li><code>confirm</code>\uff1a\u5b8c\u6210\u8d44\u6e90\u64cd\u4f5c\u4e1a\u52a1\uff1b\u8981\u6c42 <code>try</code> \u6210\u529f <code>confirm</code> \u4e00\u5b9a\u8981\u80fd\u6210\u529f\u3002 </li> <li><code>cancel</code>\uff1a\u9884\u7559\u8d44\u6e90\u91ca\u653e\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3atry\u7684\u53cd\u5411\u64cd\u4f5c\u3002</li> </ul> <p>\u4e3e\u4f8b\uff0c\u4e00\u4e2a\u6263\u51cf\u7528\u6237\u4f59\u989d\u7684\u4e1a\u52a1\u3002\u5047\u8bbe\u8d26\u6237A\u539f\u6765\u4f59\u989d\u662f100\uff0c\u9700\u8981\u4f59\u989d\u6263\u51cf30\u5143\u3002</p> <p>\u9636\u6bb5\u4e00\uff08 Try \uff09\uff1a\u68c0\u67e5\u4f59\u989d\u662f\u5426\u5145\u8db3\uff0c\u5982\u679c\u5145\u8db3\u5219\u51bb\u7ed3\u91d1\u989d\u589e\u52a030\u5143\uff0c\u53ef\u7528\u4f59\u989d\u6263\u966430</p> <p>\u521d\u59cb\u4f59\u989d\uff1a</p> <p></p> <p>\u4f59\u989d\u5145\u8db3\uff0c\u53ef\u4ee5\u51bb\u7ed3\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u603b\u91d1\u989d = \u51bb\u7ed3\u91d1\u989d + \u53ef\u7528\u91d1\u989d\uff0c\u6570\u91cf\u4f9d\u7136\u662f100\u4e0d\u53d8\u3002\u4e8b\u52a1\u76f4\u63a5\u63d0\u4ea4\u65e0\u9700\u7b49\u5f85\u5176\u5b83\u4e8b\u52a1\u3002</p> <p>\u9636\u6bb5\u4e8c\uff08Confirm)\uff1a\u5047\u5982\u8981\u63d0\u4ea4\uff08Confirm\uff09\uff0c\u4e4b\u524d\u53ef\u7528\u91d1\u989d\u5df2\u7ecf\u6263\u51cf\uff0c\u5e76\u8f6c\u79fb\u5230\u51bb\u7ed3\u91d1\u989d\u3002\u56e0\u6b64\u53ef\u7528\u91d1\u989d\u4e0d\u53d8\uff0c\u76f4\u63a5\u51bb\u7ed3\u91d1\u989d\u6263\u51cf30\u5373\u53ef\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u603b\u91d1\u989d = \u51bb\u7ed3\u91d1\u989d + \u53ef\u7528\u91d1\u989d = 0 + 70  = 70\u5143</p> <p>\u9636\u6bb5\u4e8c(Canncel)\uff1a\u5982\u679c\u8981\u56de\u6eda\uff08Cancel\uff09\uff0c\u5219\u91ca\u653e\u4e4b\u524d\u51bb\u7ed3\u7684\u91d1\u989d\uff0c\u4e5f\u5c31\u662f\u51bb\u7ed3\u91d1\u989d\u6263\u51cf30\uff0c\u53ef\u7528\u4f59\u989d\u589e\u52a030</p> <p></p> <p>TCC\u7684\u4f18\u70b9\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u4e00\u9636\u6bb5\u5b8c\u6210\u76f4\u63a5\u63d0\u4ea4\u4e8b\u52a1\uff0c\u91ca\u653e\u6570\u636e\u5e93\u8d44\u6e90\uff0c\u6027\u80fd\u597d</li> <li>\u76f8\u6bd4AT\u6a21\u578b\uff0c\u65e0\u9700\u751f\u6210\u5feb\u7167\uff0c\u65e0\u9700\u4f7f\u7528\u5168\u5c40\u9501\uff0c\u6027\u80fd\u6700\u5f3a</li> <li>\u4e0d\u4f9d\u8d56\u6570\u636e\u5e93\u4e8b\u52a1\uff0c\u800c\u662f\u4f9d\u8d56\u8865\u507f\u64cd\u4f5c\uff0c\u53ef\u4ee5\u7528\u4e8e\u975e\u4e8b\u52a1\u578b\u6570\u636e\u5e93</li> </ul> <p>TCC\u7684\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u6709\u4ee3\u7801\u4fb5\u5165\uff0c\u9700\u8981\u4eba\u4e3a\u7f16\u5199try\u3001Confirm\u548cCancel\u63a5\u53e3\uff0c\u592a\u9ebb\u70e6</li> <li>\u8f6f\u72b6\u6001\uff0c\u4e8b\u52a1\u662f\u6700\u7ec8\u4e00\u81f4</li> <li>\u9700\u8981\u8003\u8651Confirm\u548cCancel\u7684\u5931\u8d25\u60c5\u51b5\uff0c\u505a\u597d\u5e42\u7b49\u5904\u7406\u3001\u4e8b\u52a1\u60ac\u6302\u548c\u7a7a\u56de\u6eda\u5904\u7406</li> </ul> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u6700\u5927\u52aa\u529b\u901a\u77e5","title":"\u6700\u5927\u52aa\u529b\u901a\u77e5","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u6ce8\u518c\u4e2d\u5fc3","title":"\u6ce8\u518c\u4e2d\u5fc3","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u73af\u5883\u9694\u79bb","title":"\u73af\u5883\u9694\u79bb","text":"<p>\u4f01\u4e1a\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u642d\u5efa\u591a\u4e2a\u8fd0\u884c\u73af\u5883\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u5f00\u53d1\u73af\u5883</li> <li>\u6d4b\u8bd5\u73af\u5883</li> <li>\u9884\u53d1\u5e03\u73af\u5883</li> <li>\u751f\u4ea7\u73af\u5883</li> </ul> <p>\u8fd9\u4e9b\u4e0d\u540c\u73af\u5883\u4e4b\u95f4\u7684\u670d\u52a1\u548c\u6570\u636e\u4e4b\u95f4\u9700\u8981\u9694\u79bb\u3002</p> <p>\u8fd8\u6709\u7684\u4f01\u4e1a\u4e2d\uff0c\u4f1a\u5f00\u53d1\u591a\u4e2a\u9879\u76ee\uff0c\u5171\u4eabnacos\u96c6\u7fa4\u3002\u6b64\u65f6\uff0c\u8fd9\u4e9b\u9879\u76ee\u4e4b\u95f4\u4e5f\u9700\u8981\u628a\u670d\u52a1\u548c\u6570\u636e\u9694\u79bb\u3002</p> <p>\u56e0\u6b64\uff0cNacos\u63d0\u4f9b\u4e86\u57fa\u4e8e<code>namespace</code>\u7684\u73af\u5883\u9694\u79bb\u529f\u80fd\u3002\u5177\u4f53\u7684\u9694\u79bb\u5c42\u6b21\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8bf4\u660e\uff1a</p> <ul> <li>Nacos\u4e2d\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a<code>namespace</code>\uff0c\u76f8\u4e92\u4e4b\u95f4\u5b8c\u5168\u9694\u79bb\u3002\u9ed8\u8ba4\u7684<code>namespace</code>\u540d\u4e3a<code>public</code></li> <li><code>namespace</code>\u4e0b\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u5206\u7ec4\uff0c\u4e5f\u5c31\u662fgroup \uff0c\u76f8\u4e92\u9694\u79bb\u3002 \u9ed8\u8ba4\u7684group\u662f<code>DEFAULT_GROUP</code></li> <li><code>group</code>\u4e4b\u4e0b\u5c31\u662f\u670d\u52a1\u548c\u914d\u7f6e\u4e86</li> </ul> <p>\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff1a</p> <pre><code>spring:\n  application:\n    name: item-service # \u670d\u52a1\u540d\u79f0\n  profiles:\n    active: dev\n  cloud:\n    nacos:\n      server-addr: localhost # nacos\u5730\u5740\n      discovery: # \u670d\u52a1\u53d1\u73b0\u914d\u7f6e\n        namespace: 8c468c63-b650-48da-a632-311c75e6d235 # \u8bbe\u7f6enamespace\uff0c\u5fc5\u987b\u7528id\n</code></pre> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u5206\u7ea7\u6a21\u578b","title":"\u5206\u7ea7\u6a21\u578b","text":"<p>\u5728\u4e00\u4e9b\u5927\u578b\u5e94\u7528\u4e2d\uff0c\u540c\u4e00\u4e2a\u670d\u52a1\u53ef\u4ee5\u90e8\u7f72\u5f88\u591a\u5b9e\u4f8b\u3002\u800c\u8fd9\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u5206\u5e03\u5728\u5168\u56fd\u5404\u5730\u7684\u4e0d\u540c\u673a\u623f\u3002\u7531\u4e8e\u5b58\u5728\u5730\u57df\u5dee\u5f02\uff0c\u7f51\u7edc\u4f20\u8f93\u7684\u901f\u5ea6\u4f1a\u6709\u5f88\u5927\u4e0d\u540c\uff0c\u56e0\u6b64\u5728\u505a\u670d\u52a1\u6cbb\u7406\u65f6\u9700\u8981\u533a\u5206\u4e0d\u540c\u673a\u623f\u7684\u5b9e\u4f8b\u3002</p> <p>Nacos\u4e2d\u63d0\u4f9b\u4e86\u96c6\u7fa4\uff08<code>cluster</code>\uff09\u7684\u6982\u5ff5\uff0c\u6765\u5bf9\u5e94\u4e0d\u540c\u673a\u623f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u670d\u52a1\uff08<code>service</code>\uff09\u4e0b\u53ef\u4ee5\u6709\u5f88\u591a\u96c6\u7fa4\uff08<code>cluster</code>\uff09\uff0c\u800c\u4e00\u4e2a\u96c6\u7fa4\uff08<code>cluster</code>\uff09\u4e2d\u4e0b\u53c8\u53ef\u4ee5\u5305\u542b\u5f88\u591a\u5b9e\u4f8b\uff08<code>instance</code>\uff09\u3002</p> <p></p> <p>\u4efb\u4f55\u4e00\u4e2a\u5fae\u670d\u52a1\u7684\u5b9e\u4f8b\u5728\u6ce8\u518c\u5230Nacos\u65f6\uff0c\u90fd\u4f1a\u751f\u6210\u4ee5\u4e0b\u51e0\u4e2a\u4fe1\u606f\uff0c\u7528\u6765\u786e\u8ba4\u5f53\u524d\u5b9e\u4f8b\u7684\u8eab\u4efd\uff0c\u4ece\u5916\u5230\u5185\u4f9d\u6b21\u662f\uff1a</p> <ul> <li>namespace\uff1a\u547d\u540d\u7a7a\u95f4</li> <li>group\uff1a\u5206\u7ec4</li> <li>service\uff1a\u670d\u52a1\u540d</li> <li>cluster\uff1a\u96c6\u7fa4</li> <li>instance\uff1a\u5b9e\u4f8b\uff0c\u5305\u542bip\u548c\u7aef\u53e3</li> </ul> <p>\u8fd9\u5c31\u662fnacos\u4e2d\u7684\u670d\u52a1\u5206\u7ea7\u6a21\u578b\u3002</p> <p>\u5982\u679c\u6211\u4eec\u8981\u4fee\u6539\u670d\u52a1\u6240\u5728\u96c6\u7fa4\uff0c\u53ea\u9700\u8981\u4fee\u6539<code>bootstrap.yml</code>\u5373\u53ef\uff1a</p> <pre><code>spring:\n  cloud:\n    nacos:\n      discovery:\n        cluster-name: BJ # \u96c6\u7fa4\u540d\u79f0\uff0c\u81ea\u5b9a\u4e49\n</code></pre> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#eureka\u4e0enacos","title":"Eureka\u4e0eNacos","text":"<p>Eureka\u662fNetflix\u516c\u53f8\u5f00\u6e90\u7684\u4e00\u4e2a\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7ec4\u4ef6\uff0c\u65e9\u671f\u7248\u672c\u7684SpringCloud\u90fd\u662f\u4f7f\u7528Eureka\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\u3002\u7531\u4e8eEureka\u548cNacos\u7684starter\u4e2d\u63d0\u4f9b\u7684\u529f\u80fd\u90fd\u662f\u57fa\u4e8eSpringCloudCommon\u89c4\u8303\uff0c\u56e0\u6b64\u4e24\u8005\u4f7f\u7528\u8d77\u6765\u5dee\u522b\u4e0d\u5927\u3002</p> <p>Eureka\u548cNacos\u7684\u76f8\u4f3c\u70b9\u6709\uff1a</p> <ul> <li>\u90fd\u652f\u6301\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u529f\u80fd</li> <li>\u90fd\u6709\u57fa\u4e8e\u5fc3\u8df3\u7684\u5065\u5eb7\u76d1\u6d4b\u529f\u80fd</li> <li>\u90fd\u652f\u6301\u96c6\u7fa4\uff0c\u96c6\u7fa4\u95f4\u6570\u636e\u540c\u6b65\u9ed8\u8ba4\u662fAP\u6a21\u5f0f\uff0c\u5373\u6700\u5168\u9ad8\u53ef\u7528\u6027</li> </ul> <p>Eureka\u548cNacos\u7684\u533a\u522b\u6709\uff1a</p> <ul> <li>Eureka\u53ea\u80fd\u7b49\u5fae\u670d\u52a1\u81ea\u5df1\u6bcf\u969430\u79d2\u66f4\u65b0\u4e00\u6b21\u670d\u52a1\u5217\u8868\uff1bNacos\u65e2\u6709\u5b9a\u65f6\u66f4\u65b0\uff0c\u4e5f\u6709\u5728\u670d\u52a1\u53d8\u66f4\u65f6\u7684\u5e7f\u64ad\u63a8\u9001</li> <li>Eureka\u4ec5\u6709\u6ce8\u518c\u4e2d\u5fc3\u529f\u80fd\uff0c\u800cNacos\u540c\u65f6\u652f\u6301\u6ce8\u518c\u4e2d\u5fc3\u3001\u914d\u7f6e\u7ba1\u7406</li> </ul> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u8fdc\u7a0b\u8c03\u7528","title":"\u8fdc\u7a0b\u8c03\u7528","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u8d1f\u8f7d\u5747\u8861\u539f\u7406","title":"\u8d1f\u8f7d\u5747\u8861\u539f\u7406","text":"<p>\u5728SpringCloud\u7684\u65e9\u671f\u7248\u672c\u4e2d\uff0c\u8d1f\u8f7d\u5747\u8861\u90fd\u662f\u7531Netflix\u516c\u53f8\u5f00\u6e90\u7684Ribbon\u7ec4\u4ef6\u6765\u5b9e\u73b0\u7684\uff0cRibbon\u751a\u81f3\u88ab\u76f4\u63a5\u96c6\u6210\u5230\u4e86Eureka-client\u548cNacos-Discovery\u4e2d\u3002</p> <p>\u4f46\u662f\u81eaSpringCloud2020\u7248\u672c\u5f00\u59cb\uff0c\u5df2\u7ecf\u5f03\u7528Ribbon\uff0c\u6539\u7528Spring\u81ea\u5df1\u5f00\u6e90\u7684Spring Cloud LoadBalancer\u4e86\uff0c\u6211\u4eec\u4f7f\u7528\u7684OpenFeign\u7684\u4e5f\u5df2\u7ecf\u4e0e\u5176\u6574\u5408\u3002</p> <p></p> <p>OpenFeign\u8bf7\u6c42\u6d41\u7a0b\uff1a</p> <ul> <li>\u4ece\u8bf7\u6c42\u7684<code>URI</code>\u4e2d\u627e\u51fa<code>serviceId</code></li> <li>\u5229\u7528<code>loadBalancerClient</code>\uff0c\u6839\u636e<code>serviceId</code>\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u9009\u51fa\u4e00\u4e2a\u5b9e\u4f8b<code>ServiceInstance</code></li> <li>\u7528\u9009\u4e2d\u7684<code>ServiceInstance</code>\u7684<code>ip</code>\u548c<code>port</code>\u66ff\u4ee3<code>serviceId</code>\uff0c\u91cd\u6784<code>URI</code></li> <li>\u5411\u771f\u6b63\u7684URI\u53d1\u9001\u8bf7\u6c42</li> </ul> <p></p> <p>\u5177\u4f53\u7684\u8d1f\u8f7d\u5747\u8861\u5219\u662f\u4e0d\u662f\u7531<code>OpenFeign</code>\u7ec4\u4ef6\u8d1f\u8d23\u3002\u800c\u662f\u5206\u6210\u4e86\u8d1f\u8f7d\u5747\u8861\u7684\u63a5\u53e3\u89c4\u8303\uff0c\u4ee5\u53ca\u8d1f\u8f7d\u5747\u8861\u7684\u5177\u4f53\u5b9e\u73b0\u4e24\u90e8\u5206\u3002</p> <p>\u8d1f\u8f7d\u5747\u8861\u7684\u63a5\u53e3\u89c4\u8303\u662f\u5b9a\u4e49\u5728<code>Spring-Cloud-Common</code>\u6a21\u5757\u4e2d\uff0c\u5305\u542b\u4e0b\u9762\u7684\u63a5\u53e3\uff1a</p> <ul> <li><code>LoadBalancerClient</code>\uff1a\u8d1f\u8f7d\u5747\u8861\u5ba2\u6237\u7aef\uff0c\u804c\u8d23\u662f\u6839\u636eserviceId\u6700\u7ec8\u8d1f\u8f7d\u5747\u8861\uff0c\u9009\u51fa\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b</li> <li><code>ReactiveLoadBalancer</code>\uff1a\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u8d1f\u8d23\u5177\u4f53\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5</li> </ul> <p>OpenFeign\u7684\u8d1f\u8f7d\u5747\u8861\u662f\u57fa\u4e8e<code>Spring-Cloud-Common</code>\u6a21\u5757\u4e2d\u7684\u8d1f\u8f7d\u5747\u8861\u89c4\u5219\u63a5\u53e3\uff0c\u5e76\u6ca1\u6709\u5177\u4f53\u5b9e\u73b0\u3002\u8fd9\u5c31\u610f\u5473\u7740\u4ee5\u540e\u8fd8\u53ef\u4ee5\u62d3\u5c55\u5176\u5b83\u5404\u79cd\u8d1f\u8f7d\u5747\u8861\u7684\u5b9e\u73b0\u3002</p> <p>\u4e0d\u8fc7\u76ee\u524d<code>SpringCloud</code>\u4e2d\u53ea\u6709<code>Spring-Cloud-Loadbalancer</code>\u8fd9\u4e00\u79cd\u5b9e\u73b0\u3002</p> <p><code>Spring-Cloud-Loadbalancer</code>\u6a21\u5757\u4e2d\uff0c\u5b9e\u73b0\u4e86<code>Spring-Cloud-Common</code>\u6a21\u5757\u7684\u76f8\u5173\u63a5\u53e3\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li><code>BlockingLoadBalancerClient</code>\uff1a\u5b9e\u73b0\u4e86<code>LoadBalancerClient</code>\uff0c\u4f1a\u6839\u636eserviceId\u9009\u51fa\u8d1f\u8f7d\u5747\u8861\u5668\u5e76\u8c03\u7528\u5176\u7b97\u6cd5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u3002</li> <li><code>RoundRobinLoadBalancer</code>\uff1a\u57fa\u4e8e\u8f6e\u8be2\u7b97\u6cd5\u5b9e\u73b0\u4e86<code>ReactiveLoadBalancer</code></li> <li><code>RandomLoadBalancer</code>\uff1a\u57fa\u4e8e\u968f\u673a\u7b97\u6cd5\u5b9e\u73b0\u4e86<code>ReactiveLoadBalancer</code>\uff0c</li> </ul> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u6574\u4f53\u601d\u8def\u5c31\u975e\u5e38\u6e05\u695a\u4e86\uff0c\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u66f4\u6362\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5","title":"\u66f4\u6362\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5","text":"<p>SpringCloud\u9ed8\u8ba4\u91c7\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u662f<code>RoundRobinLoadBalancer</code>(\u5373\u8f6e\u8be2\u7b97\u6cd5)</p> <p><code>Spring-Cloud-Loadbalancer</code>\u6a21\u5757\u4e2d\u6709\u4e00\u4e2a\u81ea\u52a8\u914d\u7f6e\u7c7b<code>LoadBalancerClientConfiguration</code>\uff0c\u5176\u4e2d\u5b9a\u4e49\u4e86\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff1a</p> <pre><code>    @Bean\n    @ConditionalOnMissingBean //Bean\u4e0d\u5b58\u5728\u624d\u521b\u5efa\u8be5Bean\n    public ReactorLoadBalancer&lt;ServiceInstance&gt; reactorServiceInstanceLoadBalancer(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory) {\n        String name = environment.getProperty(\"loadbalancer.client.name\");\n        return new RoundRobinLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);\n    }\n</code></pre> <p>\u81ea\u5b9a\u4e49\u4e86\u8fd9\u4e2a\u7c7b\u578b\u7684bean\uff0c\u5219\u8d1f\u8f7d\u5747\u8861\u7684\u7b56\u7565\u5c31\u4f1a\u88ab\u6539\u53d8</p> <pre><code>public class OpenFeignConfig {\n\n    @Bean\n    public ReactorLoadBalancer&lt;ServiceInstance&gt; reactorServiceInstanceLoadBalancer(\n            Environment environment, NacosDiscoveryProperties properties,\n            LoadBalancerClientFactory loadBalancerClientFactory) {\n        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);\n        return new NacosLoadBalancer(\n                loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name, properties);\n    }\n\n}\n</code></pre> <p>Warning</p> <p>\u8fd9\u4e2a\u914d\u7f6e\u7c7b\u4e0d\u80fd\u52a0<code>@Configuration</code>\u6ce8\u89e3\uff0c\u4e5f\u4e0d\u8981\u88abSpringBootApplication\u626b\u63cf\u5230\u3002</p> <p><code>NacosLoadBalancer</code>\u91c7\u7528\u96c6\u7fa4\u4f18\u5148\uff0c\u4ee5\u53ca\u52a0\u6743\u7b97\u6cd5\uff0c\u53ef\u4ee5\u5728Nacos\u4e2d\u4e3a\u670d\u52a1\u5b9e\u4f8b\u914d\u7f6e\u4e0d\u540c\u7684\u6743\u91cd</p> <p>\u7531\u4e8e\u8fd9\u4e2aOpenFeignConfig\u6ca1\u6709\u52a0<code>@Configuration</code>\u6ce8\u89e3\uff0c\u4e5f\u5c31\u6ca1\u6709\u88abSpring\u52a0\u8f7d\uff0c\u56e0\u6b64\u662f\u4e0d\u4f1a\u751f\u6548\u7684\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u5728\u542f\u52a8\u7c7b\u4e0a\u901a\u8fc7\u6ce8\u89e3\u6765\u58f0\u660e\u8fd9\u4e2a\u914d\u7f6e\u3002</p> <p>\u6709\u4e24\u79cd\u505a\u6cd5\uff1a</p> <ul> <li>\u5168\u5c40\u914d\u7f6e\uff1a\u5bf9\u6240\u6709\u670d\u52a1\u751f\u6548</li> </ul> <pre><code>@LoadBalancerClients(defaultConfiguration = OpenFeignConfig.class)\n</code></pre> <ul> <li>\u5c40\u90e8\u914d\u7f6e\uff1a\u53ea\u5bf9\u67d0\u4e2a\u670d\u52a1\u751f\u6548</li> </ul> <pre><code>@LoadBalancerClients({\n        @LoadBalancerClient(value = \"item-service\", configuration = OpenFeignConfig.class)\n})\n</code></pre> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u670d\u52a1\u4fdd\u62a4","title":"\u670d\u52a1\u4fdd\u62a4","text":""},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u7ebf\u7a0b\u9694\u79bb","title":"\u7ebf\u7a0b\u9694\u79bb","text":"<p>\u65e0\u8bba\u662fHystix\u8fd8\u662fSentinel\u90fd\u652f\u6301\u7ebf\u7a0b\u9694\u79bb\u3002\u4e0d\u8fc7\u5176\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\u3002</p> <p>\u7ebf\u7a0b\u9694\u79bb\u6709\u4e24\u79cd\u65b9\u5f0f\u5b9e\u73b0\uff1a</p> <ul> <li>\u7ebf\u7a0b\u6c60\u9694\u79bb\uff1a\u7ed9\u6bcf\u4e2a\u670d\u52a1\u8c03\u7528\u4e1a\u52a1\u5206\u914d\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u5229\u7528\u7ebf\u7a0b\u6c60\u672c\u8eab\u5b9e\u73b0\u9694\u79bb\u6548\u679c<ul> <li>\u652f\u6301\u4e3b\u52a8\u8d85\u65f6\u548c\u5f02\u6b65\u8c03\u7528</li> <li>\u7ebf\u7a0b\u6c60\u989d\u5916\u5f00\u9500\u8f83\u5927</li> <li>\u9002\u7528\u4e8e\u4f4e\u9891\u8c03\u7528\u7684\u573a\u666f</li> </ul> </li> <li>\u4fe1\u53f7\u91cf\u9694\u79bb\uff1a\u4e0d\u521b\u5efa\u7ebf\u7a0b\u6c60\uff0c\u800c\u662f\u8ba1\u6570\u5668\u6a21\u5f0f\uff0c\u8bb0\u5f55\u4e1a\u52a1\u4f7f\u7528\u7684\u7ebf\u7a0b\u6570\u91cf\uff0c\u8fbe\u5230\u4fe1\u53f7\u91cf\u4e0a\u9650\u65f6\uff0c\u7981\u6b62\u65b0\u7684\u8bf7\u6c42<ul> <li>\u8f7b\u91cf\u7ea7\uff0c\u65e0\u989d\u5916\u5f00\u9500</li> <li>\u4e0d\u652f\u6301\u4e3b\u52a8\u8d85\u65f6\u4e0e\u5f02\u6b65\u8c03\u7528</li> <li>\u9002\u7528\u4e8e\u9ad8\u9891\u8c03\u7528\u7684\u573a\u666f </li> </ul> </li> </ul> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u6ed1\u52a8\u7a97\u53e3\u8ba1\u6570\u6cd5","title":"\u6ed1\u52a8\u7a97\u53e3\u8ba1\u6570\u6cd5","text":"<p>\u5728\u7194\u65ad\u529f\u80fd\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u5f02\u5e38\u8bf7\u6c42\u6216\u6162\u8bf7\u6c42\u6bd4\u4f8b\uff0c\u4e5f\u5c31\u662f\u8ba1\u6570\u3002\u5728\u9650\u6d41\u7684\u65f6\u5019\uff0c\u8981\u7edf\u8ba1\u6bcf\u79d2\u949f\u7684QPS\uff0c\u540c\u6837\u662f\u8ba1\u6570\u3002\u53ef\u89c1\u8ba1\u6570\u7b97\u6cd5\u5728\u7194\u65ad\u9650\u6d41\u4e2d\u7684\u5e94\u7528\u975e\u5e38\u591a\u3002sentinel\u4e2d\u91c7\u7528\u7684\u8ba1\u6570\u5668\u7b97\u6cd5\u5c31\u662f\u6ed1\u52a8\u7a97\u53e3\u8ba1\u6570\u7b97\u6cd5\u3002</p> <p>\u56fa\u5b9a\u7a97\u53e3\u8ba1\u6570\u7b97\u6cd5</p> <p>\u57fa\u672c\u539f\u7406\u5982\u56fe\uff1a</p> <p></p> <p>\u8bf4\u660e\uff1a</p> <ul> <li>\u5c06\u65f6\u95f4\u5212\u5206\u4e3a\u591a\u4e2a\u7a97\u53e3\uff0c\u7a97\u53e3\u65f6\u95f4\u8de8\u5ea6\u79f0\u4e3a<code>Interval</code>\uff0c\u672c\u4f8b\u4e2d\u4e3a1000ms\uff1b</li> <li>\u6bcf\u4e2a\u7a97\u53e3\u7ef4\u62a41\u4e2a\u8ba1\u6570\u5668\uff0c\u6bcf\u67091\u6b21\u8bf7\u6c42\u5c31\u5c06\u8ba1\u6570\u5668<code>+1</code>\u3002\u9650\u6d41\u5c31\u662f\u8bbe\u7f6e\u8ba1\u6570\u5668\u9608\u503c\uff0c\u672c\u4f8b\u4e3a3\uff0c\u56fe\u4e2d\u7ea2\u7ebf\u6807\u8bb0</li> <li>\u5982\u679c\u8ba1\u6570\u5668\u8d85\u8fc7\u4e86\u9650\u6d41\u9608\u503c\uff0c\u5219\u8d85\u51fa\u9608\u503c\u7684\u8bf7\u6c42\u90fd\u88ab\u4e22\u5f03\u3002</li> </ul> <p>\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <p>\u5982\u679c\u7b2c5\u79d2\u7684\u4e09\u6b21\u8bf7\u6c42\u90fd\u662f\u57284.5~5\u79d2\u4e4b\u95f4\u5230\u8fbe\uff1b\u7b2c6\u79d2\u7684\u8bf7\u6c42\u662f\u57285~5.5\u4e4b\u95f4\u5230\u8fbe\u3002\u90a3\u4e48\u4ece\u7b2c4.5~5.\u4e4b\u95f4\u5c31\u67096\u6b21\u8bf7\u6c42\uff01\u4e5f\u5c31\u662f\u8bf4\u6bcf\u79d2\u7684QPS\u8fbe\u5230\u4e866\uff0c\u8fdc\u8d85\u9608\u503c\u3002</p> <p>\u8fd9\u5c31\u662f\u56fa\u5b9a\u7a97\u53e3\u8ba1\u6570\u7b97\u6cd5\u7684\u95ee\u9898\uff0c\u5b83\u53ea\u80fd\u7edf\u8ba1\u5f53\u524d\u67d01\u4e2a\u65f6\u95f4\u7a97\u7684\u8bf7\u6c42\u6570\u91cf\u662f\u5426\u5230\u8fbe\u9608\u503c\uff0c\u65e0\u6cd5\u7ed3\u5408\u524d\u540e\u7684\u65f6\u95f4\u7a97\u7684\u6570\u636e\u505a\u7efc\u5408\u7edf\u8ba1\u3002</p> <p>\u6ed1\u52a8\u7a97\u53e3\u8ba1\u6570\u6cd5</p> <p>\u56fa\u5b9a\u65f6\u95f4\u7a97\u53e3\u7b97\u6cd5\u4e2d\u7a97\u53e3\u6709\u5f88\u591a\uff0c\u5176\u8de8\u5ea6\u548c\u4f4d\u7f6e\u662f\u4e0e\u65f6\u95f4\u533a\u95f4\u7ed1\u5b9a\uff0c\u56e0\u6b64\u662f\u5f88\u591a\u56fa\u5b9a\u4e0d\u52a8\u7684\u7a97\u53e3\u3002\u800c\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u7b97\u6cd5\u4e2d\u53ea\u5305\u542b1\u4e2a\u56fa\u5b9a\u8de8\u5ea6\u7684\u7a97\u53e3\uff0c\u4f46\u7a97\u53e3\u662f\u53ef\u79fb\u52a8\u52a8\u7684\uff0c\u4e0e\u65f6\u95f4\u533a\u95f4\u65e0\u5173\u3002</p> <p>\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li>\u7a97\u53e3\u65f6\u95f4\u8de8\u5ea6<code>Interval</code>\u5927\u5c0f\u56fa\u5b9a\uff0c\u4f8b\u59821\u79d2</li> <li>\u65f6\u95f4\u533a\u95f4\u8de8\u5ea6\u4e3a<code>Interval / n</code> \uff0c\u4f8b\u5982n=2\uff0c\u5219\u65f6\u95f4\u533a\u95f4\u8de8\u5ea6\u4e3a500ms</li> <li>\u7a97\u53e3\u4f1a\u968f\u7740\u5f53\u524d\u8bf7\u6c42\u6240\u5728\u65f6\u95f4<code>currentTime</code>\u79fb\u52a8\uff0c\u7a97\u53e3\u8303\u56f4\u4ece<code>currentTime-Interval</code>\u65f6\u523b\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u65f6\u533a\u5f00\u59cb\uff0c\u5230<code>currentTime</code>\u6240\u5728\u65f6\u533a\u7ed3\u675f\u3002</li> </ul> <p></p> <p>\u6ed1\u52a8\u7a97\u53e3\u5185\u5212\u5206\u7684\u65f6\u533a\u8d8a\u591a\uff0c\u8fd9\u79cd\u7edf\u8ba1\u5c31\u8d8a\u51c6\u786e\u3002</p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u4ee4\u724c\u6876\u7b97\u6cd5","title":"\u4ee4\u724c\u6876\u7b97\u6cd5","text":"<p>\u9650\u6d41\u7684\u53e6\u4e00\u79cd\u5e38\u89c1\u7b97\u6cd5\u662f\u4ee4\u724c\u6876\u7b97\u6cd5\u3002Sentinel\u4e2d\u7684\u70ed\u70b9\u53c2\u6570\u9650\u6d41\u6b63\u662f\u57fa\u4e8e\u4ee4\u724c\u6876\u7b97\u6cd5\u5b9e\u73b0\u7684\u3002\u5176\u57fa\u672c\u601d\u8def\u5982\u56fe\uff1a</p> <p></p> <p>\u8bf4\u660e\uff1a</p> <ul> <li>\u4ee5\u56fa\u5b9a\u7684\u901f\u7387\u751f\u6210\u4ee4\u724c\uff0c\u5b58\u5165\u4ee4\u724c\u6876\u4e2d\uff0c\u5982\u679c\u4ee4\u724c\u6876\u6ee1\u4e86\u4ee5\u540e\uff0c\u591a\u4f59\u4ee4\u724c\u4e22\u5f03</li> <li>\u8bf7\u6c42\u8fdb\u5165\u540e\uff0c\u5fc5\u987b\u5148\u5c1d\u8bd5\u4ece\u6876\u4e2d\u83b7\u53d6\u4ee4\u724c\uff0c\u83b7\u53d6\u5230\u4ee4\u724c\u540e\u624d\u53ef\u4ee5\u88ab\u5904\u7406</li> <li>\u5982\u679c\u4ee4\u724c\u6876\u4e2d\u6ca1\u6709\u4ee4\u724c\uff0c\u5219\u8bf7\u6c42\u7b49\u5f85\u6216\u4e22\u5f03</li> </ul> <p>\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u67d0\u4e00\u79d2\u4ee4\u724c\u6876\u4e2d\u4ea7\u751f\u4e86\u5f88\u591a\u4ee4\u724c\uff0c\u8fbe\u5230\u4ee4\u724c\u6876\u4e0a\u9650N\uff0c\u7f13\u5b58\u5728\u4ee4\u724c\u6876\u4e2d\uff0c\u4f46\u662f\u8fd9\u4e00\u79d2\u6ca1\u6709\u8bf7\u6c42\u8fdb\u5165\u3002</li> <li>\u4e0b\u4e00\u79d2\u7684\u524d\u534a\u79d2\u6d8c\u5165\u4e86\u8d85\u8fc72N\u4e2a\u8bf7\u6c42\uff0c\u4e4b\u524d\u7f13\u5b58\u7684\u4ee4\u724c\u6876\u7684\u4ee4\u724c\u8017\u5c3d\uff0c\u540c\u65f6\u8fd9\u4e00\u79d2\u53c8\u751f\u6210\u4e86N\u4e2a\u4ee4\u724c\uff0c\u4e8e\u662f\u603b\u5171\u653e\u884c\u4e862N\u4e2a\u8bf7\u6c42\u3002\u8d85\u51fa\u4e86\u6211\u4eec\u8bbe\u5b9a\u7684QPS\u9608\u503c\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u4ee4\u724c\u6876\u7b97\u6cd5\u65f6\uff0c\u5c3d\u91cf\u4e0d\u8981\u5c06\u4ee4\u724c\u4e0a\u9650\u8bbe\u5b9a\u5230\u670d\u52a1\u80fd\u627f\u53d7\u7684QPS\u4e0a\u9650\u3002\u800c\u662f\u9884\u7559\u4e00\u5b9a\u7684\u6ce2\u52a8\u7a7a\u95f4\uff0c\u8fd9\u6837\u6211\u4eec\u624d\u80fd\u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf\u3002</p> <p></p>"},{"location":"SpringCloud/%E9%9D%A2%E8%AF%95/#\u6f0f\u6876\u7b97\u6cd5","title":"\u6f0f\u6876\u7b97\u6cd5","text":"<p>\u6f0f\u6876\u7b97\u6cd5\u4e0e\u4ee4\u724c\u6876\u76f8\u4f3c\uff0c\u4f46\u5728\u8bbe\u8ba1\u4e0a\u66f4\u9002\u5408\u5e94\u5bf9\u5e76\u53d1\u6ce2\u52a8\u8f83\u5927\u7684\u573a\u666f\uff0c\u4ee5\u89e3\u51b3\u4ee4\u724c\u6876\u4e2d\u7684\u95ee\u9898\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u8bf7\u6c42\u5230\u8fbe\u540e\u4e0d\u662f\u76f4\u63a5\u5904\u7406\uff0c\u800c\u662f\u5148\u653e\u5165\u4e00\u4e2a\u961f\u5217\u3002\u800c\u540e\u4ee5\u56fa\u5b9a\u7684\u901f\u7387\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u5e76\u5904\u7406\u8bf7\u6c42\u3002</p> <p>\u8bf4\u660e\uff1a</p> <ul> <li>\u5c06\u6bcf\u4e2a\u8bf7\u6c42\u89c6\u4f5c\"\u6c34\u6ef4\"\u653e\u5165\"\u6f0f\u6876\"\u8fdb\u884c\u5b58\u50a8\uff1b</li> <li>\"\u6f0f\u6876\"\u4ee5\u56fa\u5b9a\u901f\u7387\u5411\u5916\"\u6f0f\"\u51fa\u8bf7\u6c42\u6765\u6267\u884c\uff0c\u5982\u679c\"\u6f0f\u6876\"\u7a7a\u4e86\u5219\u505c\u6b62\"\u6f0f\u6c34\u201d\uff1b</li> <li>\u5982\u679c\"\u6f0f\u6876\"\u6ee1\u4e86\u5219\u591a\u4f59\u7684\"\u6c34\u6ef4\"\u4f1a\u88ab\u76f4\u63a5\u4e22\u5f03\u3002</li> </ul> <p>\u6f0f\u6876\u7684\u4f18\u52bf\u5c31\u662f\u6d41\u91cf\u6574\u578b\uff0c\u6876\u5c31\u50cf\u662f\u4e00\u4e2a\u5927\u575d\uff0c\u8bf7\u6c42\u5c31\u662f\u6c34\u3002\u5e76\u53d1\u91cf\u4e0d\u65ad\u6ce2\u52a8\uff0c\u5c31\u5982\u56fe\u6c34\u6d41\u65f6\u5927\u65f6\u5c0f\uff0c\u4f46\u90fd\u4f1a\u88ab\u5927\u575d\u62e6\u4f4f\u3002\u800c\u540e\u5927\u575d\u6309\u7167\u56fa\u5b9a\u7684\u901f\u5ea6\u653e\u6c34\uff0c\u907f\u514d\u4e0b\u6e38\u88ab\u6d2a\u6c34\u6df9\u6ca1\u3002</p> <p>\u56e0\u6b64\uff0c\u4e0d\u7ba1\u5e76\u53d1\u91cf\u5982\u4f55\u6ce2\u52a8\uff0c\u7ecf\u8fc7\u6f0f\u6876\u5904\u7406\u540e\u7684\u8bf7\u6c42\u4e00\u5b9a\u662f\u76f8\u5bf9\u5e73\u6ed1\u7684\u66f2\u7ebf\uff1a</p> <p></p> <p>sentinel\u4e2d\u7684\u9650\u6d41\u4e2d\u7684\u6392\u961f\u7b49\u5f85\u529f\u80fd\u6b63\u662f\u57fa\u4e8e\u6f0f\u6876\u7b97\u6cd5\u5b9e\u73b0\u7684\u3002</p> <ul> <li> \u5b8c</li> </ul>"},{"location":"blog/","title":"\u968f\u7b14","text":"<p>\u6b22\u8fce\u6765\u5230\u6211\u7684\u968f\u7b14\uff01\u8fd9\u91cc\u8bb0\u5f55\u4e86\u6211\u5728\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u5fc3\u5f97\u4f53\u4f1a\u3001\u6280\u672f\u5b9e\u8df5\u548c\u9879\u76ee\u7ecf\u9a8c\u3002</p>"},{"location":"blog/#-\u5206\u7c7b\u5bfc\u822a","title":"\ud83d\udcda \u5206\u7c7b\u5bfc\u822a","text":"<p>\ud83e\udd16AI</p> <p>\u2699\ufe0f\u540e\u7aef\u5f00\u53d1</p> <p>\ud83d\udcbe\u6570\u636e\u5e93</p> <p>\ud83c\udfa8\u524d\u7aef\u6280\u672f</p>"},{"location":"blog/#-\u6700\u65b0\u6587\u7ae0","title":"\ud83d\udcc3 \u6700\u65b0\u6587\u7ae0","text":""},{"location":"blog/2025/09/05/hello-world/","title":"\u6b22\u8fce\u6765\u5230\u6211\u7684\u968f\u8bb0","text":"","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/05/hello-world/#\u5173\u4e8e\u6211","title":"\u5173\u4e8e\u6211","text":"<p>\u6211\u662f\u4e00\u540dJava\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u4e13\u6ce8\u4e8e\uff1a</p> <ul> <li>\ud83d\ude80 Spring Boot / Spring Cloud \u5fae\u670d\u52a1\u5f00\u53d1</li> <li>\ud83d\udcbe MySQL / Redis \u6570\u636e\u5e93\u4f18\u5316</li> <li>\ud83d\udd27 JVM \u6027\u80fd\u8c03\u4f18</li> <li>\ud83d\udc33 Docker \u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/05/hello-world/#\u5b66\u4e60\u8ba1\u5212","title":"\u5b66\u4e60\u8ba1\u5212","text":"","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/05/hello-world/#2025\u5e74\u76ee\u6807","title":"2025\u5e74\u76ee\u6807","text":"<ul> <li>\u6df1\u5165\u5b66\u4e60JVM\u539f\u7406</li> <li>\u638c\u63e1Spring\u6e90\u7801</li> <li>\u5b66\u4e60\u5206\u5e03\u5f0f\u7cfb\u7edf\u8bbe\u8ba1</li> <li>\u63d0\u5347\u7b97\u6cd5\u548c\u6570\u636e\u7ed3\u6784</li> </ul>","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/05/hello-world/#\u6280\u672f\u6808","title":"\u6280\u672f\u6808","text":"\u540e\u7aef\u6280\u672f\u8fd0\u7ef4\u6280\u672f <ul> <li>\u6846\u67b6: Spring Boot, Spring Cloud</li> <li>\u6570\u636e\u5e93: MySQL, Redis</li> <li>\u6d88\u606f\u961f\u5217: Kafka, RabbitMQ</li> <li>\u641c\u7d22\u5f15\u64ce: Elasticsearch</li> </ul> <ul> <li>\u5bb9\u5668: Docker, Kubernetes</li> <li>\u76d1\u63a7: Prometheus, Grafana</li> <li>CI/CD: Jenkins, GitLab CI</li> </ul> <p>\u6b22\u8fce\u4ea4\u6d41</p> <p>\u5982\u679c\u60a8\u5bf9\u8fd9\u4e9b\u6280\u672f\u4e5f\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u4e00\u8d77\u8ba8\u8bba\u5b66\u4e60\uff01</p>","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/05/hello-world/#\u8054\u7cfb\u65b9\u5f0f","title":"\u8054\u7cfb\u65b9\u5f0f","text":"<ul> <li>GitHub: @yayahonghong</li> </ul>","tags":["\u535a\u5ba2"]},{"location":"blog/2025/09/06/rag/","title":"RAG","text":"<p>RAG\uff08Retrieval-Augmented Generation\uff09\u662f\u4e00\u79cd\u7ed3\u5408\u68c0\u7d22\u548c\u751f\u6210\u7684\u6280\u672f\uff0c\u7528\u4e8e\u63d0\u5347\u8bed\u8a00\u6a21\u578b\u7684\u56de\u7b54\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002</p> <p>\u8be5\u6280\u672f\u901a\u8fc7\u4ece\u5916\u90e8\u77e5\u8bc6\u5e93\u4e2d\u68c0\u7d22\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u63d0\u793a\uff08Prompt\uff09\u8f93\u5165\u7ed9\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\uff0c\u4ece\u800c\u63d0\u5347\u751f\u6210\u5185\u5bb9\u7684\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50 \uff08\u5047\u8bbe\u7528\u4e8e\u8bad\u7ec3AI\u7684\u6570\u636e\u622a\u81f3\u4e8e2023\u5e74\uff09</p> <p>\u4f5c\u4e3a\u7528\u6237\uff0c\u6211\u95eeAI\uff1a</p> <pre><code>\u201c2024\u5e74\u7f8e\u56fd\u5927\u9009\u4e2d\u5f53\u9009\u7f8e\u56fd\u603b\u7edf\u7684\u5019\u9009\u4eba\u662f\u8c01\uff1f\u201d\n</code></pre> <p>\u7531\u4e8eAI\u7684\u8bad\u7ec3\u6570\u636e\u622a\u6b62\u52302023\u5e74\uff0cAI\u65e0\u6cd5\u76f4\u63a5\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u6216\u8005AI\u4f1a\u634f\u9020\u4e00\u4e2a\u7b54\u6848\u3002</p> <p>\u4f46\u662f\u901a\u8fc7RAG\u6280\u672f\uff0cAI\u53ef\u4ee5\u5148\u4ece\u5916\u90e8\u77e5\u8bc6\u5e93\u4e2d\u68c0\u7d22\u5230\u76f8\u5173\u7684\u6700\u65b0\u4fe1\u606f\u5e76\u51c6\u786e\u5730\u7ed9\u51fa\u7b54\u6848\uff1a</p> <pre><code>\u201c2024\u5e74\u7f8e\u56fd\u5927\u9009\u4e2d\u5f53\u9009\u7f8e\u56fd\u603b\u7edf\u7684\u662f\u7279\u6717\u666e\u3002\u201d\n</code></pre>"},{"location":"blog/2025/09/06/rag/#rag\u7684\u5de5\u4f5c\u539f\u7406","title":"RAG\u7684\u5de5\u4f5c\u539f\u7406","text":"<p>RAG\u7684\u5de5\u4f5c\u6d41\u7a0b\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u77e5\u8bc6\u5e93\u51c6\u5907\uff1a\u6784\u5efa\u4e00\u4e2a\u5305\u542b\u5927\u91cf\u6587\u672c\u6570\u636e\u7684\u77e5\u8bc6\u5e93\uff0c\u8fd9\u4e9b\u6570\u636e\u53ef\u4ee5\u662f\u6587\u6863\u3001\u7f51\u9875\u3001\u4e66\u7c4d\u7b49\u3002</p> </li> <li> <p>\u5d4c\u5165\u4e8e\u7d22\u5f15\uff1a \u5c06\u77e5\u8bc6\u5e93\u4e2d\u7684\u6587\u672c\u6570\u636e\u8f6c\u6362\u4e3a\u5411\u91cf\u8868\u793a\uff0c\u5e76\u5b58\u50a8\u5728\u9ad8\u6548\u7684\u5411\u91cf\u6570\u636e\u5e93\u4e2d\uff0c\u4ee5\u4fbf\u5feb\u901f\u68c0\u7d22\u3002</p> </li> <li> <p>\u67e5\u8be2\u68c0\u7d22\uff1a \u5f53\u7528\u6237\u63d0\u51fa\u95ee\u9898\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5c06\u95ee\u9898\u8f6c\u6362\u4e3a\u5411\u91cf\uff0c\u5e76\u5728\u5411\u91cf\u6570\u636e\u5e93\u4e2d\u68c0\u7d22\u4e0e\u95ee\u9898\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002</p> </li> <li> <p>\u4e0a\u4e0b\u6587\u6784\u5efa\uff1a\u5c06\u68c0\u7d22\u5230\u7684\u76f8\u5173\u4fe1\u606f\u4e0e\u7528\u6237\u7684\u8f93\u5165\u95ee\u9898\u7ed3\u5408\uff0c\u6784\u5efa\u4e00\u4e2a\u66f4\u4e30\u5bcc\u7684\u4e0a\u4e0b\u6587\u3002</p> </li> <li> <p>\u751f\u6210\u56de\u7b54\uff1a\u5c06\u6784\u5efa\u7684\u4e0a\u4e0b\u6587\u4f5c\u4e3a\u63d0\u793a\uff0c\u8f93\u5165\u5230\u5927\u578b\u8bed\u8a00\u6a21\u578b\u4e2d\uff0c\u751f\u6210\u6700\u7ec8\u7684\u56de\u7b54\u3002</p> </li> </ol> <p>\u4e09\u79cdRAG\u67b6\u6784\uff1a</p> <p></p>"},{"location":"blog/2025/09/06/rag/#\u57fa\u4e8elanchain4j\u7684rag\u5b9e\u73b0","title":"\u57fa\u4e8eLanchain4j\u7684RAG\u5b9e\u73b0","text":"<p>Lanchain4j\u662f\u4e00\u4e2aJava\u5e93\uff0c\u7b80\u5316\u4e86\u6784\u5efa\u57fa\u4e8eLLM\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u3002\u5b83\u63d0\u4f9b\u4e86\u4e0e\u5404\u79cdLLM\u548c\u5411\u91cf\u6570\u636e\u5e93\u7684\u96c6\u6210\uff0c\u652f\u6301RAG\u7b49\u9ad8\u7ea7\u529f\u80fd\u3002</p>"},{"location":"blog/2025/09/06/rag/#\u6dfb\u52a0\u4f9d\u8d56","title":"\u6dfb\u52a0\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;\n    &lt;artifactId&gt;langchain4j&lt;/artifactId&gt;\n    &lt;version&gt;1.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;\n    &lt;artifactId&gt;langchain4j-easy-rag&lt;/artifactId&gt;\n    &lt;version&gt;1.4.0-beta10&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"blog/2025/09/06/rag/#\u52a0\u8f7d\u77e5\u8bc6\u5e93","title":"\u52a0\u8f7d\u77e5\u8bc6\u5e93","text":"<pre><code>List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(\"your-documents-path\");\n</code></pre>"},{"location":"blog/2025/09/06/rag/#\u521b\u5efa\u5411\u91cf\u6570\u636e\u5e93","title":"\u521b\u5efa\u5411\u91cf\u6570\u636e\u5e93","text":"<p>Lanchain4j\u652f\u6301\u591a\u79cd\u5411\u91cf\u6570\u636e\u5e93\uff0c\u5982Elasticsearch\u3001MongoDB Atlas\u7b49\u3002\u8fd9\u91cc\u4ee5InMemoryEmbeddingStore\u4e3a\u4f8b\uff1a <pre><code>InMemoryEmbeddingStore&lt;TextSegment&gt; embeddingStore = new InMemoryEmbeddingStore&lt;&gt;();\nEmbeddingStoreIngestor.ingest(documents, embeddingStore);\n</code></pre></p> <p>\u5d4c\u5165\u6a21\u578b</p> <p>\u5d4c\u5165\u6a21\u578b\u662f\u4e00\u79cdAI\u6a21\u578b\uff0c\u7528\u4e8e\u5c06\u6587\u672c\u8f6c\u6362\u4e3a\u5411\u91cf\u8868\u793a\u3002</p> <p>Lanchain4j\u7684easy-rag\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u5d4c\u5165\u6a21\u578b\uff0c\u5982\u679c\u9700\u8981\u66f4\u5f3a\u5927\u7684\u5d4c\u5165\u6a21\u578b\uff0c\u53ef\u4ee5\u81ea\u884c\u914d\u7f6e</p> <p>\u6ce8\u610f</p> <p>InMemoryEmbeddingStore\u9002\u5408\u5c0f\u89c4\u6a21\u6570\u636e\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528\u6301\u4e45\u5316\u5411\u91cf\u6570\u636e\u5e93\u3002</p>"},{"location":"blog/2025/09/06/rag/#\u914d\u7f6e\u4f7f\u7528rag","title":"\u914d\u7f6e\u4f7f\u7528RAG","text":"<pre><code>interface Assistant {\n\n    String chat(String userMessage);\n}\n\nChatModel chatModel = OpenAiChatModel.builder()\n    .apiKey(System.getenv(\"OPENAI_API_KEY\"))\n    .modelName(GPT_4_O_MINI)\n    .build();\n\nAssistant assistant = AiServices.builder(Assistant.class)\n    .chatModel(chatModel)\n    .chatMemory(MessageWindowChatMemory.withMaxMessages(10))\n    .contentRetriever(EmbeddingStoreContentRetriever.from(embeddingStore))\n    .build();\n\nassistant.chat(\"your question\");\n</code></pre>"},{"location":"blog/2025/09/11/mcp/","title":"MCP","text":"<p>MCP\uff08Model Context Protocol\uff0c\u6a21\u578b\u4e0a\u4e0b\u6587\u534f\u8bae\uff09\u662f\u4e00\u79cd\u5f00\u653e\u534f\u8bae\uff0c\u65e8\u5728\u5b9e\u73b0\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u5e94\u7528\u4e0e\u5916\u90e8\u6570\u636e\u6e90\u3001\u5de5\u5177\u548c\u670d\u52a1\u4e4b\u95f4\u7684\u65e0\u7f1d\u96c6\u6210\u3002\u901a\u8fc7\u6807\u51c6\u5316\u6a21\u578b\u4e0e\u5916\u90e8\u8d44\u6e90\u7684\u4ea4\u4e92\u65b9\u5f0f\uff0cMCP \u63d0\u5347\u4e86 LLM \u5e94\u7528\u7684\u529f\u80fd\u6027\u3001\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002</p> <p>Tip</p> <p>\u53ef\u5c06 MCP \u534f\u8bae\u60f3\u8c61\u6210\u5927\u6a21\u578b\u4e16\u754c\u7684 USB \u534f\u8bae \u6216 \u5e94\u7528\u5546\u5e97\u3002</p>"},{"location":"blog/2025/09/11/mcp/#\u4e3a\u5565\u9700\u8981mcp","title":"\u4e3a\u5565\u9700\u8981MCP","text":"<p>\u5728\u6ca1\u6709 MCP \u4e4b\u524d\uff0cAI \u52a9\u624b\u7684\u80fd\u529b\u5b58\u5728\u4e00\u4e9b\u660e\u663e\u7684\u5c40\u9650\u6027\uff1a</p> <ol> <li> <p>\u77e5\u8bc6\u622a\u6b62\u95ee\u9898\uff1a\u6a21\u578b\u7684\u77e5\u8bc6\u4ec5\u9650\u4e8e\u5176\u8bad\u7ec3\u6570\u636e\u622a\u6b62\u7684\u65e5\u671f\uff0c\u65e0\u6cd5\u83b7\u53d6\u6700\u65b0\u7684\u4fe1\u606f\uff08\u5982\u4eca\u5929\u7684\u65b0\u95fb\u3001\u80a1\u4ef7\uff09\u3002\uff08\u8be5\u95ee\u9898\u4e5f\u53ef\u4f7f\u7528RAG\u89e3\u51b3\uff09</p> </li> <li> <p>\u65e0\u6cd5\u6267\u884c\u64cd\u4f5c\uff1a\u6a21\u578b\u672c\u8eab\u65e0\u6cd5\u76f4\u63a5\u64cd\u4f5c\u4f60\u7684\u7535\u8111\uff0c\u6bd4\u5982\u5e2e\u4f60\u8bfb\u53d6\u4e00\u4e2a\u672c\u5730\u6587\u4ef6\u3001\u8fd0\u884c\u4e00\u4e2a\u811a\u672c\u6216\u53d1\u9001\u90ae\u4ef6\u3002</p> </li> <li> <p>\u7f3a\u4e4f\u4e2a\u6027\u5316\u4e0a\u4e0b\u6587\uff1a\u6a21\u578b\u65e0\u6cd5\u8bbf\u95ee\u4f60\u7684\u79c1\u4eba\u6216\u5de5\u4f5c\u6570\u636e\uff0c\u6bd4\u5982\u4f60\u7684\u4ee3\u7801\u5e93\u3001\u7b14\u8bb0\u3001\u516c\u53f8\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u63d0\u4f9b\u7684\u5efa\u8bae\u53ef\u80fd\u4e0d\u591f\u7cbe\u51c6\u3002</p> </li> <li> <p>\u96c6\u6210\u56f0\u96be\u4e14\u4e0d\u5b89\u5168\uff1a\u6bcf\u4e2aAI\u5e94\u7528\uff08\u5982Claude\u3001Cursor\uff09\u90fd\u9700\u8981\u81ea\u5df1\u5355\u72ec\u5b9e\u73b0\u5404\u79cd\u63d2\u4ef6\u548c\u96c6\u6210\uff0c\u8fc7\u7a0b\u590d\u6742\uff0c\u4e14\u5b89\u5168\u96be\u4ee5\u4fdd\u969c\u3002\u7528\u6237\u53ef\u80fd\u9700\u8981\u628a\u81ea\u5df1\u7684API\u5bc6\u94a5\u66b4\u9732\u7ed9AI\u5e94\u7528\u3002</p> </li> </ol> <p>MCP \u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u800c\u8bde\u751f\u7684\u3002\u5b83\u901a\u8fc7\u4e00\u79cd\u6807\u51c6\u5316\u7684\u65b9\u5f0f\uff0c\u8ba9\u6a21\u578b\u7684\u80fd\u529b\u53d8\u5f97\u53ef\u6269\u5c55\u548c\u52a8\u6001\u5316\u3002</p>"},{"location":"blog/2025/09/11/mcp/#mcp\u7684\u6838\u5fc3\u67b6\u6784","title":"MCP\u7684\u6838\u5fc3\u67b6\u6784","text":"<p>MCP \u534f\u8bae\u5b9a\u4e49\u4e86\u51e0\u4e2a\u5173\u952e\u7ec4\u4ef6\uff1a</p> <ol> <li> <p>MCP\u5ba2\u6237\u7aef\uff1a\u8fd9\u662f\u96c6\u6210\u4e86 MCP \u534f\u8bae\u7684 LLM \u5e94\u7528\u6216\u5e73\u53f0\uff08\u5982Cursor\u3001VScode\u3001Claude\u684c\u9762\u5e94\u7528\uff09\u3002MCP \u5ba2\u6237\u7aef\u8d1f\u8d23\u4e0e MCP \u670d\u52a1\u5668\u901a\u4fe1\uff0c\u53d1\u9001\u8bf7\u6c42\u5e76\u5904\u7406\u54cd\u5e94\u3002</p> </li> <li> <p>MCP\u670d\u52a1\u5668\uff1a\u8fd9\u662f\u5b9e\u73b0\u4e86 MCP \u534f\u8bae\u7684\u670d\u52a1\u7aef\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u7ba1\u7406\u548c\u63d0\u4f9b\u5404\u79cd\u63d2\u4ef6\u548c\u96c6\u6210\u3002MCP \u670d\u52a1\u5668\u63a5\u6536\u6765\u81ea MCP \u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u5176\u8def\u7531\u5230\u76f8\u5e94\u7684\u63d2\u4ef6\u6216\u670d\u52a1\u3002</p> </li> <li> <p>\u4f20\u8f93\u5c42\uff1a\u901a\u4fe1\u7684\u4f20\u8f93\u5c42\u662f stdio\uff08\u6807\u51c6\u8f93\u5165/\u8f93\u51fa\uff09\u3002\u5ba2\u6237\u7aef\u901a\u8fc7\u547d\u4ee4\u884c\u542f\u52a8\u670d\u52a1\u5668\u8fdb\u7a0b\uff0c\u5e76\u901a\u8fc7\u7ba1\u9053\uff08pipe\uff09\u4e0e\u670d\u52a1\u5668\u7684 stdin \u548c stdout \u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002\u8fd9\u79cd\u8bbe\u8ba1\u610f\u5473\u7740\u670d\u52a1\u5668\u662f\u5728\u7528\u6237\u672c\u5730\u673a\u5668\u4e0a\u8fd0\u884c\u7684\u72ec\u7acb\u8fdb\u7a0b\uff0c\u800c\u4e0d\u662f\u7531 AI \u516c\u53f8\u63a7\u5236\u7684\u8fdc\u7a0b\u670d\u52a1\u3002\u4f60\u7684\u6570\u636e\u548c\u51ed\u8bc1\u6c38\u8fdc\u4e0d\u4f1a\u79bb\u5f00\u4f60\u7684\u673a\u5668\uff0c\u9664\u975e\u670d\u52a1\u5668\u660e\u786e\u8bbe\u8ba1\u4e3a\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u3002</p> </li> </ol> <p>\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0cMCP \u63d0\u4f9b\u4e86\u4e00\u5957\u6807\u51c6\u7684 API \u548c\u6570\u636e\u683c\u5f0f\uff0c\u4f7f\u5f97\u521b\u5efa\u65b0\u7684\u63d2\u4ef6\u548c\u96c6\u6210\u53d8\u5f97\u7b80\u5355\u4e14\u4e00\u81f4\u3002\u5f00\u53d1\u8005\u53ea\u9700\u5b9e\u73b0 MCP \u670d\u52a1\u5668\u63a5\u53e3\uff0c\u5373\u53ef\u8ba9\u4ed6\u4eec\u7684\u670d\u52a1\u88ab\u4efb\u4f55\u652f\u6301 MCP \u7684\u5ba2\u6237\u7aef\u6240\u4f7f\u7528\u3002</p>"},{"location":"blog/2025/09/11/mcp/#\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684mcp\u670d\u52a1\u5668","title":"\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684MCP\u670d\u52a1\u5668","text":"<p>\u76ee\u524d\u6d41\u884c\u4f7f\u7528Python\u6216Node.js\u6765\u5b9e\u73b0MCP\u670d\u52a1\u5668\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528Node.js\u5b9e\u73b0\u7684\u7b80\u5355MCP\u670d\u52a1\u5668\u793a\u4f8b\uff1a</p> <p>1.\u9996\u5148\u521b\u5efa\u9879\u76ee\u76ee\u5f55\u5e76\u521d\u59cb\u5316\uff1a</p> <pre><code>npm init -y\nnpm install @modelcontextprotocol/sdk zod@3\n</code></pre> <p></p> <p>2.\u5728src\u76ee\u5f55\u4e0b\u521b\u5efaindex.js\uff1a</p> <pre><code>import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport { z } from 'zod';\n\nconst version = '1.0.0';\n\n// \u521b\u5efaMCP\u670d\u52a1\u5668\u5b9e\u4f8b\nconst server = new McpServer({\n    name: 'Example MCP Server',\n    version: version,\n    capabilities: {\n        tools: {}\n    }\n})\n\n\n// \u6ce8\u518c\u4e00\u4e2a\u7b80\u5355\u7684\u5de5\u5177\nserver.tool(\n    'sayHello', // \u5de5\u5177\u540d\u79f0\n    'Says hello to the given name', // \u5de5\u5177\u63cf\u8ff0\n    {\n        state: z.string().min(1).max(100) // \u8f93\u5165\u53c2\u6570\u7684Zod\u6a21\u5f0f\n    },\n\n    // \u5de5\u5177\u7684\u5b9e\u73b0\u903b\u8f91\n    async ({ state }) =&gt; {\n\n        // \u8fd4\u56de\u7ed3\u679c\n        return {\n            content: [\n                {\n                    type: \"text\",\n                    text: `Hello, ${state}! (from version ${version})`\n                }\n            ]\n        };\n    }\n)\n\n// \u542f\u52a8\u670d\u52a1\u5668\u5e76\u76d1\u542c\u6765\u81eaMCP\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\nasync function main() {\n    const transport = new StdioServerTransport();\n    await server.connect(transport);\n    console.log('Server is running...');\n}\n\n// \u542f\u52a8\u4e3b\u51fd\u6570\nmain().catch((err) =&gt; {\n    console.error('Error starting server:', err);\n    process.exit(1);\n});\n</code></pre> <p></p> <p>3.\u5728MCP\u5ba2\u6237\u7aef\u5982Vscode\u4e2d\u914d\u7f6eMCP\u670d\u52a1\u5668\uff1a</p> <pre><code>{\n    \"modelcontextprotocol.mcpServers\": [\n        {\n            \"name\": \"Example MCP Server\",\n            \"command\": \"node\",\n            \"args\": [\"path/to/your/src/index.js\"]\n        }\n    ]\n}\n</code></pre> <p></p> <p>4.\u542f\u52a8MCP\u670d\u52a1\uff0c\u5e76\u53d1\u9001\u6d88\u606f\u7ed9LLM\uff1a \u201c\u8bf7\u4f7f\u7528MCP\u5de5\u5177sayHello\uff0c\u53c2\u6570state\u4e3a\u201cWorld\u201d\u3002\u201d</p> <p>\u8fd0\u884c\u7ed3\u679c\uff1a  <pre><code>Hello, World! (from version 1.0.0)\n</code></pre></p> <p>\u53c2\u8003\u6587\u6863</p> <p>MCP\u5b98\u65b9\u6587\u6863</p>"},{"location":"blog/2025/12/12/bakend/","title":"Spring Validation\u4f7f\u7528\u6307\u5357","text":"<p>Spring Validation \u662f Spring \u6846\u67b6\u4e2d\u7528\u4e8e\u6570\u636e\u9a8c\u8bc1\u7684\u5f3a\u5927\u5de5\u5177\u3002\u5b83\u5141\u8bb8\u4f60\u901a\u8fc7\u6ce8\u89e3\u6765\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\uff0c\u4ece\u800c\u7b80\u5316\u4e86\u6570\u636e\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u3002\u672c\u6587\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u5728 Spring \u9879\u76ee\u4e2d\u4f7f\u7528 Spring Validation\u3002</p>"},{"location":"blog/2025/12/12/bakend/#\u5f15\u5165\u4f9d\u8d56","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u5f15\u5165 Spring Validation \u7684\u4f9d\u8d56\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f Maven \u6216 Gradle\uff0c\u53ef\u4ee5\u5728 <code>pom.xml</code> \u6216 <code>build.gradle</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4f9d\u8d56\uff1a</p> MavenGradle (Groovy DSL)Gradle (Kotlin DSL) <pre><code>&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <pre><code>dependencies {\nimplementation 'org.springframework.boot:spring-boot-starter-web'\nimplementation 'org.springframework.boot:spring-boot-starter-validation'\n}\n</code></pre> <pre><code>dependencies {\nimplementation(\"org.springframework.boot:spring-boot-starter-web\")\nimplementation(\"org.springframework.boot:spring-boot-starter-validation\")\n}\n</code></pre>"},{"location":"blog/2025/12/12/bakend/#dto\u4e2d\u4f7f\u7528\u6ce8\u89e3","title":"DTO\u4e2d\u4f7f\u7528\u6ce8\u89e3","text":"<p>\u5728 DTO\uff08Data Transfer Object\uff09\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Spring Validation \u63d0\u4f9b\u7684\u6ce8\u89e3\u6765\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219,\u5176<code>message</code>\u5c5e\u6027\u7528\u4e8e\u81ea\u5b9a\u4e49\u9519\u8bef\u63d0\u793a\u4fe1\u606f\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684\u6ce8\u89e3\uff1a</p> <pre><code>@Data\n@Schema(description = \"\u7528\u6237DTO\")\npublic class UserDTO {\n\n    // \u975e\u7a7a\u6821\u9a8c\n    @NotNull(message = \"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\")\n    @NotBlank(message = \"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\u5b57\u7b26\u4e32\") // \u4e0d\u5141\u8bb8\u7a7a\u683c\n    private String username;\n\n    // \u957f\u5ea6\u6821\u9a8c\n    @Size(min = 6, max = 128, message = \"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286-128\u4e4b\u95f4\")\n    private String password;\n\n    // \u624b\u673a\u53f7\u6821\u9a8c\n    @Pattern(regexp = \"^1[3-9]\\\\d{9}$\", message = \"\u624b\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    private String phone;\n\n    // \u90ae\u7bb1\u6821\u9a8c\n    @Email(message = \"\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    private String email;\n\n    // \u6570\u503c\u8303\u56f4\n    @Min(value = 0, message = \"\u5e74\u9f84\u4e0d\u80fd\u5c0f\u4e8e0\")\n    @Max(value = 150, message = \"\u5e74\u9f84\u4e0d\u80fd\u5927\u4e8e150\")\n    private Integer age;\n\n    // \u6b63\u6570\u6821\u9a8c\n    @Positive(message = \"\u91d1\u989d\u5fc5\u987b\u5927\u4e8e0\")\n    private BigDecimal amount;\n\n    // \u65e5\u671f\u6821\u9a8c\n    @Past(message = \"\u51fa\u751f\u65e5\u671f\u5fc5\u987b\u662f\u8fc7\u53bb\u7684\u65f6\u95f4\")\n    private Date birth;\n\n    @Future(message = \"\u9884\u7ea6\u65f6\u95f4\u5fc5\u987b\u662f\u672a\u6765\u7684\u65f6\u95f4\")\n    private LocalDateTime appointmentTime;\n\n    // \u96c6\u5408\u6821\u9a8c\n    @NotEmpty(message = \"\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a\")\n    @Size(min = 1, max = 10, message = \"\u6700\u591a\u9009\u62e910\u9879\")\n    private List&lt;String&gt; items;\n}\n</code></pre>"},{"location":"blog/2025/12/12/bakend/#controller\u4e2d\u4f7f\u7528\u542f\u7528\u6821\u9a8c","title":"Controller\u4e2d\u4f7f\u7528\u542f\u7528\u6821\u9a8c","text":"<p>\u5728Controller\u4e2d\uff0c\u53ef\u4ee5\u5728\u7c7b\u4e0a\u4f7f\u7528@Validated \u6ce8\u89e3\u542f\u7528\u65b9\u6cd5\u53c2\u6570\u7684\u6821\u9a8c\u3002</p> <p>@Valid \u7528\u4e8e\u5d4c\u5957\u5bf9\u8c61\u7684\u6821\u9a8c\u3002</p> <pre><code>@Validated \n@RestController\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    // @RequestBody \u53c2\u6570\u6821\u9a8c\n    @PostMapping(\"/login\")\n    public Result&lt;String&gt; login(@Valid @RequestBody LoginDTO dto) {\n        // \u6821\u9a8c\u5931\u8d25\u4f1a\u81ea\u52a8\u629b\u51fa MethodArgumentNotValidException\n        return Result.success(userService.login(dto));\n    }\n\n    // @RequestParam \u53c2\u6570\u6821\u9a8c\uff08\u9700\u8981\u5728\u7c7b\u4e0a\u52a0 @Validated\uff09\n    @GetMapping(\"/info\")\n    public Result&lt;UserVO&gt; getUser(\n        @NotNull(message = \"\u7528\u6237ID\u4e0d\u80fd\u4e3a\u7a7a\") \n        @RequestParam Long userId) {\n        return Result.success(userService.getById(userId));\n    }\n\n    // \u5d4c\u5957\u5bf9\u8c61\u6821\u9a8c\n    @PostMapping(\"/complex\")\n    public Result&lt;Void&gt; complexValidation(@Valid @RequestBody ComplexDTO dto) {\n        // \u9700\u8981\u5728\u5d4c\u5957\u5bf9\u8c61\u5b57\u6bb5\u4e0a\u52a0 @Valid\n        return Result.success();\n    }\n}\n</code></pre>"},{"location":"blog/2025/12/12/bakend/#\u5f02\u5e38\u5904\u7406","title":"\u5f02\u5e38\u5904\u7406","text":"<p>\u4e3a\u4e86\u66f4\u597d\u5730\u5904\u7406\u9a8c\u8bc1\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7edf\u4e00\u7684\u5f02\u5e38\u5904\u7406\u7c7b\uff0c\u4f7f\u7528 <code>@ExceptionHandler</code> \u6ce8\u89e3\u6765\u6355\u83b7\u5e76\u5904\u7406 <code>MethodArgumentNotValidException</code> \u5f02\u5e38\u3002</p> <pre><code>@RestControllerAdvice\npublic class GlobalExceptionHandler {\n    @ExceptionHandler(MethodArgumentNotNotException.class)\n    public Result&lt;String&gt; handleValidationException(MethodArgumentNotValidException e) {\n        // \u83b7\u53d6\u6240\u6709\u9a8c\u8bc1\u9519\u8bef\u4fe1\u606f\n        List&lt;String&gt; errorMessages = e.getBindingResult().getAllErrors().stream()\n            .map(DefaultMessageSourceResolvable::getDefaultMessage)\n            .collect(Collectors.toList());\n\n        // \u5c06\u9519\u8bef\u4fe1\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\n        return Result.fail(String.join(\", \", errorMessages));\n    }\n}\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/","title":"Java\u7ebf\u7a0b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u521b\u5efa\u548c\u542f\u52a8\u7ebf\u7a0b","title":"\u521b\u5efa\u548c\u542f\u52a8\u7ebf\u7a0b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#thread\u533f\u540d\u7c7b","title":"Thread\u533f\u540d\u7c7b","text":"<pre><code>// \u521b\u5efa\u7ebf\u7a0b\u5bf9\u8c61\nThread t = new Thread(){\n    @Override\n    public void run() {\n        // \u7ebf\u7a0b\u6267\u884c\u7684\u4ee3\u7801\n        log.info(\"Running...\");\n    }\n};\n// \u542f\u52a8\u7ebf\u7a0b\nt.start();\n</code></pre> <p>Note</p> <p>\u5efa\u8bae\u4e3a\u7ebf\u7a0b\u6307\u5b9a\u540d\u5b57</p> <p>\u53ef\u4ee5\u901a\u8fc7\u7ebf\u7a0b\u5bf9\u8c61\u7684 <code>setName(String name)</code> \u65b9\u6cd5\u4e3a\u7ebf\u7a0b\u6307\u5b9a\u540d\u5b57</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#runnable\u63a8\u8350","title":"Runnable\uff08\u63a8\u8350\uff09","text":"<pre><code>Runnable r = new Runnable() {\n    @Override\n    public void run() {\n        // \u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\n        log.info(\"Running...\");\n    }\n};\n\nThread t2 = new Thread(r, \"Test2\");\nt2.start();\n</code></pre> <p>Tip</p> <p>\u53ef\u4f7f\u7528lambda\u8868\u8fbe\u5f0f\u7b80\u5316 <pre><code>Runnable r = () -&gt; log.info(\"Running...\");\n</code></pre></p> <p>\u539f\u7406\u89e3\u6790</p> <p>Thread\u4e2d\u7684run \u65b9\u6cd5\uff1a</p> <pre><code>@Override\npublic void run() {\n    if (target != null) {\n        target.run();\n    }\n}\n</code></pre> <ul> <li>Thread\u533f\u540d\u7c7b\u91cd\u5199\u4e86\u8be5\u65b9\u6cd5\uff0c\u5b9e\u73b0\u4efb\u52a1\u6267\u884c</li> <li>Runnable\u4f1a\u88ab\u8d4b\u503c\u7ed9target\u53d8\u91cf\uff0c\u7136\u540e\u6267\u884c\u5176\u4e2d\u7684\u4efb\u52a1</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#futuretask","title":"FutureTask","text":"<p>FutureTask \u80fd\u591f\u63a5\u6536 Callable \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u7528\u6765\u5904\u7406\u6709\u8fd4\u56de\u7ed3\u679c\u7684\u60c5\u51b5</p> <pre><code>// \u521b\u5efa\u4efb\u52a1\u5bf9\u8c61\nFutureTask&lt;Integer&gt; task = new FutureTask&lt;&gt;(() -&gt; {\n    log.info(\"Running...\");\n    Thread.sleep(2000);\n    return 200;\n});\n\n// \u521b\u5efa\u7ebf\u7a0b\u5bf9\u8c61\nThread t = new Thread(task);\nt.start();\nlog.info(\"Waiting...\");\nlog.debug(\"Result: {}\", task.get());\n</code></pre> <p>\u8f93\u51fa</p> <pre><code>03-29 13:51:18 [main] INFO  com.ysh.Test - Start \n03-29 13:51:18 [main] INFO  com.ysh.Test - Waiting... \n03-29 13:51:18 [Thread-0] INFO  com.ysh.Test - Running... \n03-29 13:51:20 [main] DEBUG com.ysh.Test - Result: 200 \n03-29 13:51:20 [main] INFO  com.ysh.Test - End\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u67e5\u770b\u8fdb\u7a0b\u7ebf\u7a0b","title":"\u67e5\u770b\u8fdb\u7a0b\u7ebf\u7a0b","text":"<p>windows </p> <ul> <li> <p>\u4efb\u52a1\u7ba1\u7406\u5668\u53ef\u4ee5\u67e5\u770b\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u6570\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u6740\u6b7b\u8fdb\u7a0b </p> </li> <li> <p><code>tasklist</code> \u67e5\u770b\u8fdb\u7a0b</p> </li> <li> <p><code>taskkill</code> \u6740\u6b7b\u8fdb\u7a0b </p> </li> </ul> <p>linux </p> <ul> <li> <p><code>ps -fe</code> \u67e5\u770b\u6240\u6709\u8fdb\u7a0b </p> </li> <li> <p><code>ps -fT -p</code>  \u67e5\u770b\u67d0\u4e2a\u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b </p> </li> <li> <p><code>kill</code> \u6740\u6b7b\u8fdb\u7a0b </p> </li> <li> <p><code>top</code> \u6309\u5927\u5199 H \u5207\u6362\u662f\u5426\u663e\u793a\u7ebf\u7a0b </p> </li> <li> <p><code>top -H -p</code>  \u67e5\u770b\u67d0\u4e2a\u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b </p> </li> </ul> <p>Java </p> <ul> <li><code>jps</code> \u547d\u4ee4\u67e5\u770b\u6240\u6709 Java \u8fdb\u7a0b </li> <li><code>jstack</code>  \u67e5\u770b\u67d0\u4e2a Java \u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b\u72b6\u6001  </li> <li><code>jconsole</code> \u6765\u67e5\u770b\u67d0\u4e2a Java \u8fdb\u7a0b\u4e2d\u7ebf\u7a0b\u7684\u8fd0\u884c\u60c5\u51b5\uff08\u56fe\u5f62\u754c\u9762\uff09</li> </ul> <p>jconsole \u8fdc\u7a0b\u76d1\u63a7\u914d\u7f6e </p> <p>\u9700\u8981\u4ee5\u5982\u4e0b\u65b9\u5f0f\u8fd0\u884c\u4f60\u7684 java \u7c7b </p> <pre><code>java -Djava.rmi.server.hostname=`ip\u5730\u5740` -Dcom.sun.management.jmxremote  Dcom.sun.management.jmxremote.port=`\u8fde\u63a5\u7aef\u53e3` -Dcom.sun.management.jmxremote.ssl=\u662f\u5426\u5b89\u5168\u8fde\u63a5  Dcom.sun.management.jmxremote.authenticate=\u662f\u5426\u8ba4\u8bc1  java\u7c7b\n</code></pre> <ul> <li>\u4fee\u6539 /etc/hosts \u6587\u4ef6\u5c06 127.0.0.1 \u6620\u5c04\u81f3\u4e3b\u673a\u540d </li> <li>\u5982\u679c\u8981\u8ba4\u8bc1\u8bbf\u95ee\uff0c\u8fd8\u9700\u8981\u505a\u5982\u4e0b\u6b65\u9aa4 <ul> <li>\u590d\u5236 jmxremote.password \u6587\u4ef6 </li> <li>\u4fee\u6539 jmxremote.password \u548c jmxremote.access \u6587\u4ef6\u7684\u6743\u9650\u4e3a 600 \u5373\u6587\u4ef6\u6240\u6709\u8005\u53ef\u8bfb\u5199 </li> <li>\u8fde\u63a5\u65f6\u586b\u5165 controlRole\uff08\u7528\u6237\u540d\uff09\uff0cR&amp;D\uff08\u5bc6\u7801\uff09</li> </ul> </li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b\u539f\u7406","title":"\u7ebf\u7a0b\u539f\u7406","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u6808\u4e0e\u6808\u5e27","title":"\u6808\u4e0e\u6808\u5e27","text":"<p>Java Virtual Machine Stacks \uff08Java \u865a\u62df\u673a\u6808\uff09</p> <p>JVM \u5185\u5b58\u6709\u5806\u3001\u6808\u3001\u65b9\u6cd5\u533a\uff0c\u6808\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u5206\u914d\u4e00\u5757\u6808\u5185\u5b58\u3002</p> <ul> <li>\u6bcf\u4e2a\u6808\u7531\u591a\u4e2a\u6808\u5e27\u7ec4\u6210\uff0c\u5bf9\u5e94\u6bcf\u6b21\u65b9\u6cd5\u8c03\u7528</li> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u6709\u4e00\u4e2a\u6d3b\u52a8\u6808\u5e27\uff0c\u5bf9\u5e94\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u65b9\u6cd5</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362thread-context-switch","title":"\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362(Thread Context Switch)","text":"<p>\u5f15\u8d77\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u7ebf\u7a0b\u7684CPU\u65f6\u95f4\u7247\u4f7f\u7528\u5b8c</li> <li>JVM\u8fdb\u884c\u5783\u573e\u56de\u6536</li> <li>\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u7ebf\u7a0b\u9700\u8981\u8fd0\u884c</li> <li>\u7ebf\u7a0b\u8c03\u7528\u4e86 <code>sleep\u3001yield\u3001wait\u3001join\u3001park\u3001synchronized\u3001lock</code> \u7b49\u65b9\u6cd5</li> </ul> <p>\u5f53 <code>Context Switch</code> \u53d1\u751f\u65f6\uff0c\u9700\u8981\u7531\u64cd\u4f5c\u7cfb\u7edf\u4fdd\u5b58\u5f53\u524d\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5e76\u6062\u590d\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u72b6\u6001\uff0cJava \u4e2d\u5bf9\u5e94\u7684\u6982\u5ff5\u5c31\u662f\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08Program Counter Register\uff09\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u8bb0\u4f4f\u4e0b\u4e00\u6761 jvm \u6307\u4ee4\u7684\u6267\u884c\u5730\u5740\uff0c\u662f\u7ebf\u7a0b\u79c1\u6709\u7684</p> <ul> <li>\u72b6\u6001\u5305\u62ec\u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u865a\u62df\u673a\u6808\u4e2d\u6bcf\u4e2a\u6808\u5e27\u7684\u4fe1\u606f\uff0c\u5982\u5c40\u90e8\u53d8\u91cf\u3001\u64cd\u4f5c\u6570\u6808\u3001\u8fd4\u56de\u5730\u5740\u7b49 </li> <li>Context Switch \u9891\u7e41\u53d1\u751f\u4f1a\u5f71\u54cd\u6027\u80fd</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#_1","title":"Java\u7ebf\u7a0b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b\u5e38\u89c1\u65b9\u6cd5","title":"\u7ebf\u7a0b\u5e38\u89c1\u65b9\u6cd5","text":"\u65b9\u6cd5\u540d \u529f\u80fd \u6ce8\u610f start() \u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b start \u65b9\u6cd5\u53ea\u662f\u8ba9\u7ebf\u7a0b\u8fdb\u5165\u5c31\u7eea\uff0c\u91cc\u9762\u4ee3\u7801\u4e0d\u4e00\u5b9a\u7acb\u523b\u8fd0\u884c\uff0c\u53ea\u80fd\u8c03\u7528\u4e00\u6b21 run() \u7ebf\u7a0b\u542f\u52a8\u540e\u4f1a\u6267\u884c\u7684\u65b9\u6cd5 \u624b\u52a8\u8c03\u7528\u8be5\u65b9\u6cd5\u4e0d\u4f1a\u542f\u52a8\u7ebf\u7a0b join() \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\u7ed3\u675f join(long n) \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\u7ed3\u675f,\u6700\u591a\u7b49\u5f85 n  \u6beb\u79d2 getId() \u83b7\u53d6\u7ebf\u7a0bID ID\u552f\u4e00 getName() \u83b7\u53d6\u7ebf\u7a0b\u540d setName() \u4fee\u6539\u7ebf\u7a0b\u540d setPriority() \u4fee\u6539\u7ebf\u7a0b\u4f18\u5148\u7ea7 java\u4e2d\u89c4\u5b9a\u7ebf\u7a0b\u4f18\u5148\u7ea7\u662f1~10 \u7684\u6574\u6570\uff0c\u8f83\u5927\u7684\u4f18\u5148\u7ea7 \u80fd\u63d0\u9ad8\u8be5\u7ebf\u7a0b\u88ab CPU \u8c03\u5ea6\u7684\u673a\u7387 getPriority() \u83b7\u53d6\u7ebf\u7a0b\u4f18\u5148\u7ea7 getState() \u83b7\u53d6\u7ebf\u7a0b\u72b6\u6001 Java \u4e2d\u7ebf\u7a0b\u72b6\u6001\u662f\u7528 6 \u4e2a enum \u8868\u793a\uff0c\u5206\u522b\u4e3a\uff1a NEW, RUNNABLE, BLOCKED, WAITING,  TIMED_WAITING, TERMINATED isAlive() \u7ebf\u7a0b\u662f\u5426\u5b58\u6d3b\uff08\u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\uff09 isInterrupted() \u5224\u65ad\u7ebf\u7a0b\u662f\u5426\u88ab\u6253\u65ad \u4e0d\u4f1a\u6e05\u9664 \u6253\u65ad\u6807\u8bb0 interrupt() \u6253\u65ad\u7ebf\u7a0b \u5982\u679c\u88ab\u6253\u65ad\u7ebf\u7a0b\u6b63\u5728 sleep\uff0cwait\uff0cjoin \u4f1a\u5bfc\u81f4\u88ab\u6253\u65ad \u7684\u7ebf\u7a0b\u629b\u51fa <code>InterruptedException</code>\uff0c\u5e76\u6e05\u9664\u6253\u65ad\u6807\u8bb0\uff0c\u5982\u679c\u6253\u65ad\u7684\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\uff0c\u5219\u4f1a\u8bbe\u7f6e \u6253\u65ad\u6807\u8bb0\uff0cpark \u7684\u7ebf\u7a0b\u88ab\u6253\u65ad\uff0c\u4e5f\u4f1a\u8bbe\u7f6e\u6253\u65ad\u6807\u8bb0 interrupted() \u6253\u65ad\u7ebf\u7a0b \u9759\u6001\u65b9\u6cd5\uff0c\u4f1a\u6e05\u9664 \u6253\u65ad\u6807\u8bb0 currentThread() \u83b7\u53d6\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b \u9759\u6001\u65b9\u6cd5 sleep(long n) \u4f7f\u7ebf\u7a0b\u4f11\u7720 \u9759\u6001\u65b9\u6cd5 yield() \u63d0\u793a\u7ebf\u7a0b\u8c03\u5ea6\u5668 \u8ba9\u51fa\u5f53\u524d\u7ebf\u7a0b\u5bf9 CPU\u7684\u4f7f\u7528 \u9759\u6001\u65b9\u6cd5"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#run-\u548c-start","title":"run() \u548c start()","text":"<ul> <li>\u76f4\u63a5\u8c03\u7528<code>run()</code>\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u4ecd\u7136\u7531main\u7ebf\u7a0b\u6267\u884c\uff0c\u5e76\u4e0d\u4f1a\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002</li> <li>\u8c03\u7528<code>start()</code>\u65b9\u6cd5\uff0c\u4f1a\u65b0\u5efa\u7ebf\u7a0b\uff0c\u5e76\u7531\u65b0\u7ebf\u7a0b\u6267\u884c<code>run()</code>\u65b9\u6cd5\u3002</li> </ul> <p>Caution</p> <p><code>start()</code>\u65b9\u6cd5\u6bcf\u4e2a\u7ebf\u7a0b\u5bf9\u8c61\u53ea\u80fd\u8c03\u7528\u4e00\u6b21\uff0c\u518d\u6b21\u8c03\u7528\u4f1a\u629b\u51fa\u5f02\u5e38</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#sleep-\u548c-yield","title":"sleep() \u548c yield()","text":"<p>sleep</p> <ul> <li> <p>\u8c03\u7528 sleep \u4f1a\u8ba9\u5f53\u524d\u7ebf\u7a0b\u4ece Running  \u8fdb\u5165 Timed Waiting \u72b6\u6001\uff08\u963b\u585e\uff09</p> </li> <li> <p>\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u4f7f\u7528  interrupt \u65b9\u6cd5\u6253\u65ad\u6b63\u5728\u7761\u7720\u7684\u7ebf\u7a0b\uff0c\u8fd9\u65f6 sleep \u65b9\u6cd5\u4f1a\u629b\u51fa <code>InterruptedException</code></p> </li> <li> <p>\u7761\u7720\u7ed3\u675f\u540e\u7684\u7ebf\u7a0b\u672a\u5fc5\u4f1a\u7acb\u523b\u5f97\u5230\u6267\u884c</p> </li> <li> <p>\u5efa\u8bae\u7528 <code>TimeUnit</code> \u7684 sleep \u4ee3\u66ff Thread \u7684 sleep \u6765\u83b7\u5f97\u66f4\u597d\u7684\u53ef\u8bfb\u6027</p> </li> </ul> <pre><code>try {\n    // \u5f53\u524d\u7ebf\u7a0b\u4f11\u77201\u79d2\n    TimeUnit.SECONDS.sleep(1);\n} catch (InterruptedException e) {\n    e.printStackTrace();\n}\n</code></pre> <p>yield</p> <ul> <li>\u8c03\u7528 yield \u4f1a\u8ba9\u5f53\u524d\u7ebf\u7a0b\u4ece Running \u8fdb\u5165 Runnable  \u5c31\u7eea\u72b6\u6001\uff0c\u7136\u540e\u8c03\u5ea6\u6267\u884c\u5176\u5b83\u7ebf\u7a0b</li> <li>\u5177\u4f53\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u4efb\u52a1\u8c03\u5ea6\u5668</li> </ul> <p>\u6848\u4f8b</p> <p>\u200b\u9632\u6b62 CPU 100%\u5360\u7528\uff1a</p> <p>\u7ebf\u7a0b\u4e0d\u9700\u8981\u6267\u884c\u4efb\u52a1\u65f6\uff0c\u4e0d\u8981\u8ba9<code>while(true)</code>\u7a7a\u8f6c\u5360\u7528 CPU \uff0c\u5e94\u8be5\u4f7f\u7528<code>yield</code>\u6216\u8005<code>sleep</code>\u8ba9\u51fa CPU \u8d44\u6e90</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b\u4f18\u5148\u7ea7","title":"\u7ebf\u7a0b\u4f18\u5148\u7ea7","text":"<ul> <li>\u7ebf\u7a0b\u4f18\u5148\u7ea7\u4f1a\u63d0\u793a\uff08hint\uff09\u8c03\u5ea6\u5668\u4f18\u5148\u8c03\u5ea6\u8be5\u7ebf\u7a0b\uff0c\u4f46\u5b83\u4ec5\u4ec5\u662f\u4e00\u4e2a\u63d0\u793a\uff0c\u8c03\u5ea6\u5668\u53ef\u4ee5\u5ffd\u7565\u5b83</li> <li>\u5982\u679c cpu \u6bd4\u8f83\u5fd9\uff0c\u90a3\u4e48\u4f18\u5148\u7ea7\u9ad8\u7684\u7ebf\u7a0b\u4f1a\u83b7\u5f97\u66f4\u591a\u7684\u65f6\u95f4\u7247\uff0c\u4f46 cpu \u7a7a\u95f2\u65f6\uff0c\u4f18\u5148\u7ea7\u51e0\u4e4e\u6ca1\u4f5c\u7528</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#join","title":"join()","text":"<p>\u5bf9\u4e8e\u5982\u4e0b\u4ee3\u7801\uff0c\u4e3b\u7ebf\u7a0b\u6253\u5370\u51fa r \u7684\u503c\u4e3a 0\uff0c\u56e0\u4e3a\u4e3b\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u7b49\u5f85t1\u7ebf\u7a0b\u8fd0\u884c\u5b8c\u540e\u624d\u6253\u5370</p> <pre><code>static int r = 0;\n\npublic static void main(String[] args) throws InterruptedException {\n    test1();\n}\n\nprivate static void test1() throws InterruptedException {\n    log.debug(\"\u5f00\u59cb\");\n    Thread t1 = new Thread(() -&gt; {\n        log.debug(\"\u5f00\u59cb\");\n        sleep(1);\n        log.debug(\"\u7ed3\u675f\");\n        r = 10;\n    });\n    t1.start();\n    log.debug(\"\u7ed3\u679c\u4e3a:{}\", r);\n    log.debug(\"\u7ed3\u675f\");\n}\n</code></pre> <p>\u5728 <code>t1.start()</code> \u4e4b\u540e\u8c03\u7528 <code>t1.join()</code>\uff0c\u4e3b\u7ebf\u7a0b\u5219\u4f1a\u7b49\u5f85 t1 \u6267\u884c\u7ed3\u675f\uff08\u7ebf\u7a0b\u540c\u6b65\uff09</p> <p>Tip</p> <p>\u5e26\u53c2\u6570\u7684<code>join</code>\u65b9\u6cd5\u4f1a\u7b49\u5f85\u6307\u5b9a\u65f6\u95f4\uff0c\u5982\u679c\u7ebf\u7a0b\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e\u7b49\u5f85\u65f6\u95f4\uff0c<code>join</code>\u4f1a\u63d0\u524d\u7ed3\u675f\uff0c\u5982\u679c\u7b49\u5f85\u65f6\u95f4\u5c0f\u4e8e\u7ebf\u7a0b\u6267\u884c\u65f6\u95f4\uff0c\u4f1a\u5728\u5230\u8fbe\u7b49\u5f85\u65f6\u95f4\u540e\u7ed3\u675f\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#interrupt","title":"interrupt()","text":"<p>\u6253\u65ad sleep\uff0cwait\uff0cjoin \u7684\u7ebf\u7a0b</p> <p>\u8fd9\u51e0\u4e2a\u65b9\u6cd5\u90fd\u4f1a\u8ba9\u7ebf\u7a0b\u8fdb\u5165\u963b\u585e\u72b6\u6001</p> <p>\u6253\u65ad sleep \u7684\u7ebf\u7a0b, \u4f1a\u6e05\u7a7a\u6253\u65ad\u72b6\u6001\uff08\u8c03\u7528isInterrupted()\u8fd4\u56de\u7684boolean\u503c\uff09</p> <p>\u6253\u65ad\u6b63\u5e38\u8fd0\u884c\u7684\u7ebf\u7a0b</p> <pre><code>Thread t1 = new Thread(() -&gt; {\n    while (true) {\n        boolean interrupted = Thread.currentThread().isInterrupted();\n        if (interrupted) {\n            log.info(\"Thread1 interrupted\");\n            break;\n        }\n        log.info(\"Thread1 running\");\n    }\n});\n\nt1.start();\n\nTimeUnit.SECONDS.sleep(1);\n\nt1.interrupt();\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u8bbe\u8ba1\u6a21\u5f0f-\u4e24\u9636\u6bb5\u7ec8\u6b62","title":"\u8bbe\u8ba1\u6a21\u5f0f-\u4e24\u9636\u6bb5\u7ec8\u6b62","text":"<pre><code>private Thread monitor;\n\npublic void start() {\n    monitor = new Thread(() -&gt; {\n        while (true) {\n            Thread current = Thread.currentThread();\n            if (current.isInterrupted()) {\n                log.info(\"\u88ab\u6253\u65ad\uff0c\u5904\u7406\u4e2d...\");\n                // ...\n                break;\n            }\n\n            try {\n                Thread.sleep(1000);\n                log.info(\"\u76d1\u63a7\u4e2d...\");\n            } catch (InterruptedException e) {\n                // \u91cd\u65b0\u8bbe\u7f6e\u4e2d\u65ad\u72b6\u6001\n                current.interrupt();\n            }\n        }\n        log.info(\"\u76d1\u63a7\u7ed3\u675f\");\n    });\n    monitor.start();\n}\n\npublic void stop() {\n    monitor.interrupt();\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>\u7531\u4e8e\u7ebf\u7a0b\u53ef\u80fd\u5728sleep\u65f6\u88ab\u6253\u65ad\uff0c\u800c\u6b64\u65f6\u6253\u65ad\u6807\u8bb0\u4f1a\u88ab\u7f6e\u4e3afalse\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u6253\u65ad\u6807\u8bb0</p> <p>Tip</p> <p>\u5efa\u8bae\u4f7f\u7528<code>volatile</code>\u5173\u952e\u5b57\u4fee\u9970\u7684boolean\u53d8\u91cf\u4f5c\u4e3a\u7ebf\u7a0b\u505c\u6b62\u6807\u5fd7</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u6253\u65adpark\u7ebf\u7a0b","title":"\u6253\u65adpark\u7ebf\u7a0b","text":"<p>\u6253\u65adpark\u7ebf\u7a0b\uff0c\u4e0d\u4f1a\u6e05\u7a7a\u6253\u65ad\u72b6\u6001</p> <pre><code>Thread t1 = new Thread(() -&gt; {\n    log.debug(\"park...\");\n    LockSupport.park();\n    log.debug(\"unpark...\");\n    log.debug(\"\u6253\u65ad\u72b6\u6001\uff1a{}\", Thread.currentThread().isInterrupted());\n},\"t1\");\nt1.start();\nsleep(0.5);\nt1.interrupt();\n</code></pre> <p>\u8f93\u51fa\u6253\u65ad\u72b6\u6001\u4e3a true</p> <p>Note</p> <p>\u5982\u679c\u5728park\u4e4b\u524d\u6253\u65ad\u6807\u8bb0\u5df2\u7ecf\u662ftrue\uff0c\u90a3\u4e48park\u65f6\u4f1a\u5931\u6548</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#_2","title":"Java\u7ebf\u7a0b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u4e0d\u63a8\u8350\u7684\u65b9\u6cd5","title":"\u4e0d\u63a8\u8350\u7684\u65b9\u6cd5","text":"<p>\u5982\u4e0b\u65b9\u6cd5\u5bb9\u6613\u7834\u574f\u540c\u6b65\u4ee3\u7801\u5757\uff0c\u9020\u6210\u6b7b\u9501\uff0cJDK\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528</p> \u65b9\u6cd5 \u529f\u80fd stop() \u505c\u6b62\u7ebf\u7a0b suspend() \u6302\u8d77\uff08\u6682\u505c\uff09\u7ebf\u7a0b resume() \u6062\u590d\u7ebf\u7a0b\u8fd0\u884c <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u5b88\u62a4\u7ebf\u7a0b","title":"\u5b88\u62a4\u7ebf\u7a0b","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cJava \u8fdb\u7a0b\u9700\u8981\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u90fd\u8fd0\u884c\u7ed3\u675f\uff0c\u624d\u4f1a\u7ed3\u675f\u3002</p> <p>\u4f46\u662f\u6709\u4e00\u79cd\u7279\u6b8a\u7684\u7ebf\u7a0b\u53eb\u505a\u5b88\u62a4\u7ebf\u7a0b\uff0c\u53ea\u8981\u5176\u5b83\u975e\u5b88\u62a4\u7ebf\u7a0b\u8fd0\u884c\u7ed3\u675f\u4e86\uff0c\u5373\u4f7f\u5b88\u62a4\u7ebf\u7a0b\u7684\u4ee3\u7801\u6ca1\u6709\u6267\u884c\u5b8c\uff0c\u4e5f\u4f1a\u5f3a\u5236\u7ed3\u675f\u3002</p> <p>\u5982\u4e0b\u65b9\u6cd5\u53ef\u5c06\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u5b88\u62a4\u7ebf\u7a0b</p> <pre><code>public final void setDaemon(boolean on)\n</code></pre> <p>Example</p> <ul> <li>\u5783\u573e\u56de\u6536\u5668\u7ebf\u7a0b\u5c31\u662f\u4e00\u79cd\u5b88\u62a4\u7ebf\u7a0b </li> <li>Tomcat \u4e2d\u7684 Acceptor \u548c Poller \u7ebf\u7a0b\u90fd\u662f\u5b88\u62a4\u7ebf\u7a0b\uff0c\u6240\u4ee5 Tomcat \u63a5\u6536\u5230 shutdown \u547d\u4ee4\u540e\uff0c\u4e0d\u4f1a\u7b49\u5f85\u5b83\u4eec\u5904\u7406\u5b8c\u5f53\u524d\u8bf7\u6c42</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b\u72b6\u6001","title":"\u7ebf\u7a0b\u72b6\u6001","text":"<p>\u4ece \u64cd\u4f5c\u7cfb\u7edf \u5c42\u9762\u6765\u63cf\u8ff0\u7ebf\u7a0b\u72b6\u6001\uff1a</p> <p></p> <ul> <li>\u3010\u521d\u59cb\u72b6\u6001\u3011\u4ec5\u662f\u5728\u8bed\u8a00\u5c42\u9762\u521b\u5efa\u4e86\u7ebf\u7a0b\u5bf9\u8c61\uff0c\u8fd8\u672a\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u5173\u8054 </li> <li>\u3010\u53ef\u8fd0\u884c\u72b6\u6001\u3011\uff08\u5c31\u7eea\u72b6\u6001\uff09\u6307\u8be5\u7ebf\u7a0b\u5df2\u7ecf\u88ab\u521b\u5efa\uff08\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u5173\u8054\uff09\uff0c\u53ef\u4ee5\u7531 CPU \u8c03\u5ea6\u6267\u884c </li> <li>\u3010\u8fd0\u884c\u72b6\u6001\u3011\u6307\u83b7\u53d6\u4e86 CPU \u65f6\u95f4\u7247\u8fd0\u884c\u4e2d\u7684\u72b6\u6001 <ul> <li>\u5f53 CPU \u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u4f1a\u4ece\u3010\u8fd0\u884c\u72b6\u6001\u3011\u8f6c\u6362\u81f3\u3010\u53ef\u8fd0\u884c\u72b6\u6001\u3011\uff0c\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362 </li> </ul> </li> <li>\u3010\u963b\u585e\u72b6\u6001\u3011 <ul> <li>\u5982\u679c\u8c03\u7528\u4e86\u963b\u585e API\uff0c\u5982 BIO \u8bfb\u5199\u6587\u4ef6\uff0c\u8fd9\u65f6\u8be5\u7ebf\u7a0b\u5b9e\u9645\u4e0d\u4f1a\u7528\u5230 CPU\uff0c\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fdb\u5165 \u3010\u963b\u585e\u72b6\u6001\u3011 </li> <li>\u7b49 BIO \u64cd\u4f5c\u5b8c\u6bd5\uff0c\u4f1a\u7531\u64cd\u4f5c\u7cfb\u7edf\u5524\u9192\u963b\u585e\u7684\u7ebf\u7a0b\uff0c\u8f6c\u6362\u81f3\u3010\u53ef\u8fd0\u884c\u72b6\u6001\u3011 </li> <li>\u4e0e\u3010\u53ef\u8fd0\u884c\u72b6\u6001\u3011\u7684\u533a\u522b\u662f\uff0c\u5bf9\u3010\u963b\u585e\u72b6\u6001\u3011\u7684\u7ebf\u7a0b\u6765\u8bf4\u53ea\u8981\u5b83\u4eec\u4e00\u76f4\u4e0d\u5524\u9192\uff0c\u8c03\u5ea6\u5668\u5c31\u4e00\u76f4\u4e0d\u4f1a\u8003\u8651\u8c03\u5ea6\u5b83\u4eec </li> </ul> </li> <li>\u3010\u7ec8\u6b62\u72b6\u6001\u3011\u8868\u793a\u7ebf\u7a0b\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5\uff0c\u751f\u547d\u5468\u671f\u5df2\u7ecf\u7ed3\u675f\uff0c\u4e0d\u4f1a\u518d\u8f6c\u6362\u4e3a\u5176\u5b83\u72b6\u6001</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B/#\u516d\u79cd\u72b6\u6001","title":"\u516d\u79cd\u72b6\u6001","text":"<p>\u4ece Java API \u5c42\u9762\u6765\u63cf\u8ff0\uff1a</p> <p><code>Thread.State</code> \u679a\u4e3e\uff0c\u5206\u4e3a\u516d\u79cd\u72b6\u6001</p> <p></p> <ul> <li><code>NEW</code>  \u7ebf\u7a0b\u521a\u88ab\u521b\u5efa\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u8c03\u7528  start() \u65b9\u6cd5 </li> <li><code>RUNNABLE</code> \u5f53\u8c03\u7528\u4e86 start() \u65b9\u6cd5\u4e4b\u540e\uff0c\u6ce8\u610f\uff0cJava API \u5c42\u9762\u7684  RUNNABLE \u72b6\u6001\u6db5\u76d6\u4e86 \u64cd\u4f5c\u7cfb\u7edf \u5c42\u9762\u7684 \u3010\u53ef\u8fd0\u884c\u72b6\u6001\u3011\u3001\u3010\u8fd0\u884c\u72b6\u6001\u3011\u548c\u3010\u963b\u585e\u72b6\u6001\u3011\uff08\u7531\u4e8e BIO \u5bfc\u81f4\u7684\u7ebf\u7a0b\u963b\u585e\uff0c\u5728 Java \u91cc\u65e0\u6cd5\u533a\u5206\uff0c\u4ecd\u7136\u8ba4\u4e3a\u662f\u53ef\u8fd0\u884c\uff09 </li> <li><code>BLOCKED</code> \uff0c <code>WAITING</code> \uff0c <code>TIMED_WAITING</code> \u90fd\u662f Java API \u5c42\u9762\u5bf9\u3010\u963b\u585e\u72b6\u6001\u3011\u7684\u7ec6\u5206</li> <li><code>TERMINATED</code> \u7ebf\u7a0b\u4ee3\u7801\u8fd0\u884c\u7ed3\u675f</li> </ul> <p>\u4e0a\u4e00\u8282\uff1a \u8fdb\u7a0b\u4e0e\u7ebf\u7a0b</p> <p>\u4e0b\u4e00\u8282\uff1a \u9501</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Overview/","title":"\u6982\u89c8","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Overview/#\u6574\u4f53\u5185\u5bb9","title":"\u6574\u4f53\u5185\u5bb9","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Overview/#\u9884\u5907\u77e5\u8bc6","title":"\u9884\u5907\u77e5\u8bc6","text":"<ul> <li>\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u63a5\u89e6\u8fc7 Java Web \u5f00\u53d1\u3001Jdbc \u5f00\u53d1\u3001Web \u670d\u52a1\u5668\u3001\u5206\u5e03\u5f0f\u6846\u67b6</li> <li>\u57fa\u4e8e JDK 8\uff0c\u6700\u597d\u5bf9\u51fd\u6570\u5f0f\u7f16\u7a0b\u3001lambda \u6709\u4e00\u5b9a\u4e86\u89e3 </li> <li>\u91c7\u7528 slf4j \u6253\u5370\u65e5\u5fd7\uff0c\u8fd9\u662f\u597d\u7684\u5b9e\u8df5</li> <li>\u91c7\u7528 lombok \u7b80\u5316 java bean \u7f16\u5199 </li> <li>\u7ed9\u6bcf\u4e2a\u7ebf\u7a0b\u597d\u540d\u5b57\uff0c\u8fd9\u4e5f\u662f\u4e00\u9879\u597d\u7684\u5b9e\u8df5</li> </ul> <p>\u4f9d\u8d56</p> <pre><code>&lt;properties&gt;\n    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;\n&lt;/properties&gt;\n\n&lt;dependencies&gt;\n     &lt;dependency&gt;\n        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n        &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n        &lt;version&gt;1.18.10&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;\n        &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;\n        &lt;version&gt;1.2.3&lt;/version&gt;\n    &lt;/dependency&gt;\n &lt;/dependencies&gt;\n</code></pre> <p>logback\u914d\u7f6e</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n    &lt;statusListener class=\"ch.qos.logback.core.status.NopStatusListener\"/&gt; &lt;!-- \u7981\u7528logback\u5185\u90e8\u65e5\u5fd7  --&gt;\n\n    &lt;property name=\"pattern\" value=\"%d{HH:mm:ss} [%thread] %-5level %logger{50} - %msg %n\"/&gt;\n    &lt;property name=\"pattern-color\"\n              value=\"%yellow(|%d{HH:mm:ss}|) [%thread] %highlight(%-5level) %green(%logger{50}) - %highlight(%msg) %n\"/&gt;\n\n    &lt;!-- \u63a7\u5236\u53f0\u8f93\u51fa --&gt;\n    &lt;appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt;\n        &lt;encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\"&gt;\n            &lt;pattern&gt;${pattern}&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n\n    &lt;!-- \u63a7\u5236\u53f0\u8f93\u51fa-\u5e26\u989c\u8272 --&gt;\n    &lt;appender name=\"CONSOLE-WITH-COLOR\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt;\n        &lt;encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\"&gt;\n            &lt;pattern&gt;${pattern-color}&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n\n    &lt;root level=\"INFO\"&gt;\n        &lt;appender-ref ref=\"CONSOLE-WITH-COLOR\"/&gt;\n    &lt;/root&gt;\n&lt;/configuration&gt;\n</code></pre> <p>\u4e0b\u4e00\u8282\uff1a\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB/","title":"\u4e0d\u53ef\u53d8\u7c7b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB/#\u5b9a\u4e49\u53ca\u5b9e\u73b0","title":"\u5b9a\u4e49\u53ca\u5b9e\u73b0","text":"<p>\u4e0d\u53ef\u53d8\u7c7b\u662f\u4e00\u65e6\u521b\u5efa\u540e\u5176\u72b6\u6001\u5c31\u4e0d\u80fd\u88ab\u4fee\u6539\u7684\u7c7b\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5177\u6709\u7ebf\u7a0b\u5b89\u5168\u3001\u65e0\u9700\u540c\u6b65\u7b49\u4f18\u52bf\uff0c\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u548c\u5e76\u53d1\u7f16\u7a0b\u7684\u91cd\u8981\u57fa\u7840\u3002</p> <p>\u4e00\u4e2a\u4e25\u683c\u7684\u4e0d\u53ef\u53d8\u7c7b\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a</p> \u7279\u5f81 \u8bf4\u660e \u6240\u6709\u5b57\u6bb5final \u9632\u6b62\u5b57\u6bb5\u88ab\u91cd\u65b0\u8d4b\u503c \u7c7b\u672c\u8eabfinal \u9632\u6b62\u5b50\u7c7b\u7834\u574f\u4e0d\u53ef\u53d8\u6027 \u65e0setter\u65b9\u6cd5 \u4e0d\u63d0\u4f9b\u4fee\u6539\u72b6\u6001\u7684\u9014\u5f84 \u9632\u5fa1\u6027\u62f7\u8d1d \u8fd4\u56de\u53ef\u53d8\u5bf9\u8c61\u65f6\u521b\u5efa\u526f\u672c \u6784\u9020\u5668\u5b8c\u5168\u521d\u59cb\u5316 \u5bf9\u8c61\u521b\u5efa\u540e\u72b6\u6001\u5373\u786e\u5b9a <p>\u5b9e\u73b0\u4e0d\u53ef\u53d8\u7c7b\u7684\u5173\u952e\u6280\u672f:\u9632\u5fa1\u6027\u62f7\u8d1d\uff08Defensive Copy\uff09</p> <p>\u5f53\u7c7b\u5305\u542b\u53ef\u53d8\u5bf9\u8c61\u5b57\u6bb5\u65f6\uff1a</p> <pre><code>public final class ImmutableData {\n    private final Date createDate;\n\n    public ImmutableData(Date date) {\n        this.createDate = new Date(date.getTime()); // \u62f7\u8d1d\u800c\u975e\u76f4\u63a5\u5f15\u7528\n    }\n\n    public Date getCreateDate() {\n        return (Date) createDate.clone(); // \u8fd4\u56de\u62f7\u8d1d\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB/#\u4eab\u5143\u6a21\u5f0f","title":"\u4eab\u5143\u6a21\u5f0f","text":"<p>\u4eab\u5143\u6a21\u5f0f\u662f\u4e00\u79cd\u7ed3\u6784\u578b\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5b83\u901a\u8fc7\u5171\u4eab\u5bf9\u8c61\u6765\u6700\u5c0f\u5316\u5185\u5b58\u4f7f\u7528\u548c\u63d0\u9ad8\u6027\u80fd\uff0c\u7279\u522b\u9002\u5408\u5904\u7406\u5927\u91cf\u7ec6\u7c92\u5ea6\u5bf9\u8c61\u7684\u60c5\u51b5\u3002</p> \u6838\u5fc3\u6982\u5ff5 \u8bf4\u660e \u5185\u5728\u72b6\u6001\uff08Intrinsic\uff09 \u53ef\u5171\u4eab\u7684\u3001\u4e0d\u53d8\u7684\u90e8\u5206\uff08\u5982\u5b57\u7b26\u7684Unicode\u503c\uff09 \u5916\u5728\u72b6\u6001\uff08Extrinsic\uff09 \u4e0d\u53ef\u5171\u4eab\u7684\u3001\u53d8\u5316\u7684\u90e8\u5206\uff08\u5982\u5b57\u7b26\u7684\u4f4d\u7f6e/\u989c\u8272\uff09 \u4eab\u5143\u5de5\u5382 \u7ba1\u7406\u5171\u4eab\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u590d\u7528 <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB/#\u8fde\u63a5\u6c60","title":"\u8fde\u63a5\u6c60","text":"<p>\u8fde\u63a5\u6c60\u662f\u4eab\u5143\u6a21\u5f0f\u7684\u7ecf\u5178\u5e94\u7528\uff0c\u901a\u8fc7\u590d\u7528\u6570\u636e\u5e93\u8fde\u63a5\u5bf9\u8c61\uff0c\u51cf\u5c11\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u8fde\u63a5\u7684\u5f00\u9500\u3002</p> <p></p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>class Pool {\n    private final int SIZE;\n\n    private final Connection[] connections;\n\n    private final AtomicIntegerArray states;\n\n    public Pool(int SIZE) {\n        this.SIZE = SIZE;\n        connections = new Connection[SIZE];\n        states = new AtomicIntegerArray(new int[SIZE]);\n        for (int i = 0; i &lt; SIZE; i++) {\n            connections[i] = new MockConnection();\n            states.set(i, 0);\n        }\n    }\n\n    public Connection getConnection() {\n        while (true) {\n            for (int i = 0; i &lt; SIZE; i++) {\n                if (states.get(i) == 0 &amp;&amp; states.compareAndSet(i, 0, 1)) {\n                    log.info(\"\u83b7\u53d6\u8fde\u63a5: {}\", i);\n                    return connections[i];\n                }\n            }\n            // \u65e0\u53ef\u7528\u8fde\u63a5\uff0c\u7b49\u5f85\n            synchronized (this) {\n                try {\n                    log.info(\"{}--&gt;\u65e0\u53ef\u7528\u8fde\u63a5\uff0c\u7b49\u5f85\", Thread.currentThread().getName());\n                    this.wait();\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n        }\n    }\n\n    public void releaseConnection(Connection connection) {\n        for (int i = 0; i &lt; SIZE; i++) {\n            if (connections[i] == connection) {\n                log.info(\"\u91ca\u653e\u8fde\u63a5: {}\", i);\n\n                // \u6b64\u65f6\u65e0\u9700\u52a0\u9501\uff0c\u56e0\u4e3a\u53ea\u6709\u6301\u6709\u8be5\u8fde\u63a5\u7684\u7ebf\u7a0b\u624d\u80fd\u4fee\u6539\u72b6\u6001\n                states.set(i, 0);\n\n                synchronized (this) {\n                    this.notifyAll();\n                }\n                break;\n            }\n        }\n    }\n}\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u4e50\u89c2\u9501</p> <p>\u4e0b\u4e00\u8282\uff1a\u5e76\u53d1\u5de5\u5177</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/","title":"\u4e50\u89c2\u9501","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u5f15\u4f8b","title":"\u5f15\u4f8b","text":"<p><pre><code>class AccountWithoutLock {\n    private final AtomicInteger balance;\n\n    public AccountWithoutLock(int balance) {\n        this.balance = new AtomicInteger(balance);\n    }\n\n    public int getBalance() {\n        return balance.get();\n    }\n\n    public void withdraw(int amount) {\n        while (true) {\n            int prev = balance.get();\n            int next = prev - amount;\n            if (balance.compareAndSet(prev, next)) {\n                break;\n            }\n        }\n    }\n}\n</code></pre> \u8be5\u7c7b\u5e76\u6ca1\u6709\u4f7f\u7528\u9501\u6280\u672f\uff0c\u4f46\u662f\u8be5\u7c7b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684</p> <p></p> <p>\u5176\u4e2d\u7684\u5173\u952e\u662f compareAndSet\uff0c\u5b83\u7684\u7b80\u79f0\u5c31\u662f CAS \uff08\u4e5f\u6709 Compare And Swap \u7684\u8bf4\u6cd5\uff09\uff0c\u5b83\u5fc5\u987b\u662f\u539f\u5b50\u64cd\u4f5c\u3002</p> <p></p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#cas-\u548c-volatile","title":"CAS \u548c volatile","text":"<p>\u83b7\u53d6\u5171\u4eab\u53d8\u91cf\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8be5\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0c\u9700\u8981\u4f7f\u7528 volatile \u4fee\u9970\u3002</p> <pre><code>    private volatile int value;\n\n    public final int get() {\n        return value;\n    }\n</code></pre> <p>Attention</p> <p>CAS \u5fc5\u987b\u501f\u52a9 volatile \u624d\u80fd\u8bfb\u53d6\u5230\u5171\u4eab\u53d8\u91cf\u7684\u6700\u65b0\u503c\u6765\u5b9e\u73b0\u3010\u6bd4\u8f83\u5e76\u4ea4\u6362\u3011\u7684\u6548\u679c</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#cas\u6548\u7387\u66f4\u9ad8","title":"CAS\u6548\u7387\u66f4\u9ad8","text":"<ul> <li> <p>\u65e0\u9501\u60c5\u51b5\u4e0b\uff0c\u5373\u4f7f\u91cd\u8bd5\u5931\u8d25\uff0c\u7ebf\u7a0b\u59cb\u7ec8\u5728\u9ad8\u901f\u8fd0\u884c\uff0c\u4e0d\u4f1a\u963b\u585e\uff0c\u800c synchronized \u4f1a\u8ba9\u7ebf\u7a0b\u5728\u6ca1\u6709\u83b7\u5f97\u9501\u7684\u65f6\u5019\uff0c\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fdb\u5165\u963b\u585e\u3002</p> </li> <li> <p>\u4f46\u65e0\u9501\u60c5\u51b5\u4e0b\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u8981\u4fdd\u6301\u8fd0\u884c\uff0c\u9700\u8981\u989d\u5916 CPU \u7684\u652f\u6301\uff0c\u867d\u7136\u4e0d\u4f1a\u8fdb\u5165\u963b\u585e\uff0c\u4f46\u7531\u4e8e\u6ca1\u6709\u5206\u5230\u65f6\u95f4\u7247\uff0c\u4ecd\u7136\u4f1a\u8fdb\u5165\u53ef\u8fd0\u884c\u72b6\u6001\uff0c\u8fd8\u662f\u4f1a\u5bfc\u81f4\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> </li> </ul> <p>Danger</p> <p>\u9ad8\u7ade\u4e89\u60c5\u51b5\uff1aCAS\u53ef\u80fd\u56e0\u6301\u7eed\u91cd\u8bd5\u5bfc\u81f4CPU\u8d44\u6e90\u6d6a\u8d39\uff0c\u6b64\u65f6\u60b2\u89c2\u9501\u53ef\u80fd\u66f4\u5408\u9002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#cas-\u7279\u70b9","title":"CAS \u7279\u70b9","text":"<p>\u7ed3\u5408 CAS \u548c volatile \u53ef\u4ee5\u5b9e\u73b0\u65e0\u9501\u5e76\u53d1\uff0c\u9002\u7528\u4e8e\u7ebf\u7a0b\u6570\u5c11\u3001\u591a\u6838 CPU \u7684\u573a\u666f\u4e0b\u3002</p> <ul> <li>CAS \u662f\u57fa\u4e8e\u4e50\u89c2\u9501\u7684\u601d\u60f3\uff1a\u6700\u4e50\u89c2\u7684\u4f30\u8ba1\uff0c\u8ba4\u4e3a\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81</li> <li>synchronized \u662f\u57fa\u4e8e\u60b2\u89c2\u9501\u7684\u601d\u60f3\uff1a\u6700\u60b2\u89c2\u7684\u4f30\u8ba1\uff0c\u8ba4\u4e3a\u603b\u4f1a\u53d1\u751f\u51b2\u7a81</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u539f\u5b50\u6574\u6570","title":"\u539f\u5b50\u6574\u6570","text":"<p><code>AtomicBoolean</code></p> <p><code>AtomicInteger</code></p> <p><code>AtomicLong</code></p> <p>\u76f8\u5173API\uff1a</p> <pre><code>AtomicInteger i = new AtomicInteger(0);\n\n// CAS\u64cd\u4f5c\ni.compareAndSet(0, 1);\n\n\ni.incrementAndGet();// \u81ea\u589e1\u518d\u83b7\u53d6\ni.getAndIncrement();// \u83b7\u53d6\u518d\u81ea\u589e1\n\n// \u81ea\u51cf1\u7c7b\u4f3c\n...\n\ni.addAndGet(10);// \u81ea\u589e\u6307\u5b9a\u503c\u518d\u83b7\u53d6\n\ni.updateAndGet(x -&gt; x * 100);// \u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u66f4\u52a0\u7075\u6d3b\n</code></pre> <p>Info</p> <p>\u8fd9\u4e9bAPI\u90fd\u662f\u57fa\u4e8e<code>compareAndSet</code>\u6765\u5b9e\u73b0\u7684</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u539f\u5b50\u5f15\u7528","title":"\u539f\u5b50\u5f15\u7528","text":"<p>Java\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u539f\u5b50\u5f15\u7528\u7c7b\uff0c\u7528\u4e8e\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5b89\u5168\u5730\u66f4\u65b0\u5bf9\u8c61\u5f15\u7528\u3002</p> <p>\u8fd9\u4e9b\u7c7b\u57fa\u4e8e CAS\uff08Compare-And-Swap\uff09 \u673a\u5236\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u907f\u514d\u4f7f\u7528\u9501\u5e26\u6765\u7684\u6027\u80fd\u5f00\u9500\u3002</p> <p><code>AtomicReference</code></p> <p><code>AtomicMarkableReference</code></p> <p><code>AtomicStampedReference</code></p> <p>Java\u4e2d\u7684\u539f\u5b50\u5f15\u7528\u7c7b\u4f4d\u4e8e <code>java.util.concurrent.atomic</code> \u5305\uff0c\u4e3b\u8981\u5305\u62ec\uff1a</p> \u7c7b \u8bf4\u660e <code>AtomicReference&lt;V&gt;</code> \u666e\u901a\u539f\u5b50\u5f15\u7528\uff0c\u53ef\u539f\u5b50\u66f4\u65b0\u5bf9\u8c61\u5f15\u7528 <code>AtomicStampedReference&lt;V&gt;</code> \u5e26\u7248\u672c\u53f7\u7684\u539f\u5b50\u5f15\u7528\uff0c\u89e3\u51b3 ABA\u95ee\u9898 <code>AtomicMarkableReference&lt;V&gt;</code> \u5e26\u6807\u8bb0\u4f4d\u7684\u539f\u5b50\u5f15\u7528\uff08\u7c7b\u4f3c <code>AtomicStampedReference</code>\uff0c\u4f46\u7528\u5e03\u5c14\u503c\u6807\u8bb0\uff09 <pre><code>class DecimalAccount {\n    private final AtomicReference&lt;BigDecimal&gt; balance;\n\n    DecimalAccount(BigDecimal balance) {\n        this.balance = new AtomicReference&lt;&gt;(balance);\n    }\n\n    public BigDecimal getBalance() {\n        return balance.get();\n    }\n\n    public void withdraw(BigDecimal amount) {\n        BigDecimal prev, next;\n        do {\n            prev = balance.get();\n            next = prev.subtract(amount);\n        } while (!balance.compareAndSet(prev, next));\n    }\n}\n</code></pre> <p>Info</p> <p><code>BigDecimal</code>\u662f\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u6bcf\u6b21\u4fee\u6539\u90fd\u4f1a\u521b\u5efa\u65b0\u5bf9\u8c61\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528<code>AtomicReference</code>\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#aba-\u95ee\u9898","title":"ABA \u95ee\u9898","text":"<p>ABA\u95ee\u9898\u662f CAS\uff08Compare-And-Swap\uff09 \u64cd\u4f5c\u4e2d\u7684\u4e00\u4e2a\u7ecf\u5178\u5e76\u53d1\u95ee\u9898\uff0c\u5b83\u53ef\u80fd\u5bfc\u81f4\u7a0b\u5e8f\u903b\u8f91\u9519\u8bef\uff0c\u5373\u4f7fCAS\u64cd\u4f5c\u6210\u529f\uff0c\u4f46\u5b9e\u9645\u6570\u636e\u53ef\u80fd\u5df2\u7ecf\u88ab\u5176\u4ed6\u7ebf\u7a0b\u4fee\u6539\u8fc7\u591a\u6b21\u3002</p> <p>ABA\u95ee\u9898\u662f\u6307\uff1a</p> <ul> <li>\u7ebf\u7a0b A \u8bfb\u53d6\u5171\u4eab\u53d8\u91cf\u7684\u503c\u4e3a A\u3002</li> <li>\u7ebf\u7a0b B \u5728\u6b64\u671f\u95f4\u4fee\u6539\u8be5\u53d8\u91cf\u7684\u503c A \u2192 B \u2192 A\uff08\u5373\u5148\u6539\u6210B\uff0c\u53c8\u6539\u56deA\uff09\u3002</li> <li>\u7ebf\u7a0b A \u6267\u884cCAS\u64cd\u4f5c\u65f6\uff0c\u53d1\u73b0\u503c\u4ecd\u7136\u662f A\uff0c\u4e8e\u662f\u8ba4\u4e3a\u6ca1\u6709\u88ab\u4fee\u6539\u8fc7\uff0c\u4ece\u800cCAS\u6210\u529f\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u53d8\u91cf\u5df2\u7ecf\u88ab\u4fee\u6539\u8fc7\uff08B\u2192A\uff09\uff0c\u53ef\u80fd\u5bfc\u81f4\u903b\u8f91\u9519\u8bef\u3002</li> </ul> <p></p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u7248\u672c\u53f7/\u65f6\u95f4\u6233\uff08Stamped Reference\uff09</p> <ul> <li>\u6bcf\u6b21\u4fee\u6539\u5171\u4eab\u53d8\u91cf\u65f6\uff0c\u589e\u52a0\u4e00\u4e2a\u7248\u672c\u53f7\uff08\u6216\u65f6\u95f4\u6233\uff09\u3002</li> <li>CAS\u4e0d\u4ec5\u8981\u6bd4\u8f83\u503c\uff0c\u8fd8\u8981\u6bd4\u8f83\u7248\u672c\u53f7\u3002</li> <li>Java\u4e2d\u7684 <code>AtomicStampedReference</code> \u5c31\u662f\u57fa\u4e8e\u6b64\u5b9e\u73b0\u3002</li> </ul> <pre><code>AtomicStampedReference&lt;Integer&gt; atomicRef = new AtomicStampedReference&lt;&gt;(100, 0); // \u521d\u59cb\u503c=100\uff0c\u7248\u672c\u53f7=0\n\nint stampHolder = atomicRef.getStamp();\nint currentValue = atomicRef.getReference; // \u83b7\u53d6\u503c\u548c\u7248\u672c\u53f7\nint newValue = currentValue + 1;\nboolean success = atomicRef.compareAndSet(currentValue, newValue, stampHolder, stampHolder + 1);\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u539f\u5b50\u6570\u7ec4","title":"\u539f\u5b50\u6570\u7ec4","text":"<p>Java\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u539f\u5b50\u6570\u7ec4\u7c7b\uff0c\u7528\u4e8e\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5b89\u5168\u5730\u64cd\u4f5c\u6570\u7ec4\u5143\u7d20\uff0c\u800c\u65e0\u9700\u4f7f\u7528\u9501\u3002\u8fd9\u4e9b\u7c7b\u57fa\u4e8e CAS\uff08Compare-And-Swap\uff09 \u673a\u5236\uff0c\u4fdd\u8bc1\u5bf9\u6570\u7ec4\u5143\u7d20\u7684\u539f\u5b50\u6027\u64cd\u4f5c\u3002</p> \u7c7b \u8bf4\u660e <code>AtomicIntegerArray</code> \u539f\u5b50\u6574\u578b\u6570\u7ec4\uff0c\u53ef\u539f\u5b50\u66f4\u65b0 <code>int[]</code> <code>AtomicLongArray</code> \u539f\u5b50\u957f\u6574\u578b\u6570\u7ec4\uff0c\u53ef\u539f\u5b50\u66f4\u65b0 <code>long[]</code> <code>AtomicReferenceArray&lt;E&gt;</code> \u539f\u5b50\u5f15\u7528\u6570\u7ec4\uff0c\u53ef\u539f\u5b50\u66f4\u65b0\u5bf9\u8c61\u5f15\u7528\u6570\u7ec4 <pre><code>// \u521d\u59cb\u5316\u4e00\u4e2a\u957f\u5ea6\u4e3a 5 \u7684\u539f\u5b50\u6574\u578b\u6570\u7ec4\nAtomicIntegerArray atomicArray = new AtomicIntegerArray(5);\n\n// \u591a\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u4fee\u6539\u6570\u7ec4\nRunnable task = () -&gt; {\n    for (int i = 0; i &lt; atomicArray.length(); i++) {\n        atomicArray.incrementAndGet(i); // \u539f\u5b50\u9012\u589e\n    }\n};\n\nThread thread1 = new Thread(task);\nThread thread2 = new Thread(task);\n\nthread1.start();\nthread2.start();\n\ntry {\n    thread1.join();\n    thread2.join();\n} catch (InterruptedException e) {\n    e.printStackTrace();\n}\n\n// \u8f93\u51fa\u6700\u7ec8\u6570\u7ec4\nfor (int i = 0; i &lt; atomicArray.length(); i++) {\n    System.out.println(\"Index \" + i + \": \" + atomicArray.get(i));\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u539f\u5b50\u66f4\u65b0\u5668","title":"\u539f\u5b50\u66f4\u65b0\u5668","text":"<p>\u539f\u5b50\u66f4\u65b0\u5668\u662fJava\u63d0\u4f9b\u7684\u4e00\u79cd\u9ad8\u6548\u7684\u65e0\u9501\u539f\u5b50\u64cd\u4f5c\u65b9\u5f0f\uff0c\u5b83\u5141\u8bb8\u5bf9 \u5df2\u6709\u7684\u666e\u901a\u7c7b \u7684 <code>volatile</code> \u5b57\u6bb5\u8fdb\u884c\u539f\u5b50\u66f4\u65b0\uff0c\u800c\u65e0\u9700\u5c06\u6574\u4e2a\u7c7b\u6539\u4e3a\u539f\u5b50\u7c7b\u3002\u9002\u7528\u4e8e\u5f53\u67d0\u4e2a\u7c7b\u7684\u67d0\u4e2a\u5b57\u6bb5\u9700\u8981\u539f\u5b50\u64cd\u4f5c\uff0c\u4f46\u53c8\u4e0d\u5e0c\u671b\u4f7f\u7528 <code>AtomicInteger</code>\u3001<code>AtomicReference</code> \u7b49\u5305\u88c5\u7c7b\u65f6\u3002</p> \u7c7b \u8bf4\u660e <code>AtomicIntegerFieldUpdater&lt;T&gt;</code> \u539f\u5b50\u66f4\u65b0 <code>int</code> \u7c7b\u578b\u5b57\u6bb5 <code>AtomicLongFieldUpdater&lt;T&gt;</code> \u539f\u5b50\u66f4\u65b0 <code>long</code> \u7c7b\u578b\u5b57\u6bb5 <code>AtomicReferenceFieldUpdater&lt;T,V&gt;</code> \u539f\u5b50\u66f4\u65b0\u5bf9\u8c61\u5f15\u7528\u5b57\u6bb5 <pre><code>class Student {\n    volatile String name;\n\n    @Override\n    public String toString() {\n        return \"Student{\" +\n                \"name='\" + name + '\\'' +\n                '}';\n    }\n}\n\nStudent student = new Student();\nstudent.name = \"Tom\";\nAtomicReferenceFieldUpdater&lt;Student, String&gt; updater = AtomicReferenceFieldUpdater.newUpdater(Student.class, String.class, \"name\");\nupdater.compareAndSet(student, \"Tom\", \"\u516d\u516d\");\nSystem.out.println(student);\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u539f\u5b50\u7d2f\u52a0\u5668","title":"\u539f\u5b50\u7d2f\u52a0\u5668","text":"<p>\u539f\u5b50\u7d2f\u52a0\u5668\uff08<code>LongAdder</code>\u3001<code>DoubleAdder</code>\uff09\u662fJava 8\u5f15\u5165\u7684\u9ad8\u6027\u80fd\u539f\u5b50\u8ba1\u6570\u5668\uff0c\u9002\u7528\u4e8e\u9ad8\u5e76\u53d1\u5199\u591a\u8bfb\u5c11\u7684\u573a\u666f\uff0c\u6bd4<code>AtomicLong</code>\u548c<code>AtomicDouble</code>\u5177\u6709\u66f4\u9ad8\u7684\u541e\u5410\u91cf\u3002</p> \u7c7b \u8bf4\u660e \u9002\u7528\u573a\u666f <code>LongAdder</code> \u9ad8\u6027\u80fd<code>long</code>\u7d2f\u52a0\u5668 \u8ba1\u6570\u5668\u3001\u7edf\u8ba1 <code>DoubleAdder</code> \u9ad8\u6027\u80fd<code>double</code>\u7d2f\u52a0\u5668 \u6d6e\u70b9\u6570\u7edf\u8ba1 <code>LongAccumulator</code> \u652f\u6301\u81ea\u5b9a\u4e49\u8fd0\u7b97\u89c4\u5219 \u66f4\u7075\u6d3b\u7684\u64cd\u4f5c <code>DoubleAccumulator</code> \u652f\u6301\u81ea\u5b9a\u4e49\u6d6e\u70b9\u8fd0\u7b97 \u6d6e\u70b9\u8fd0\u7b97 <pre><code>    static void testAtomicLong() {\n        AtomicLong counter = new AtomicLong();\n        long start = System.currentTimeMillis();\n\n        IntStream.range(0, 1000).parallel().forEach(i -&gt; {\n            for (int j = 0; j &lt; 10_000; j++) {\n                counter.incrementAndGet();\n            }\n        });\n\n        System.out.println(\"AtomicLong: \" + (System.currentTimeMillis() - start) + \"ms\");\n    }\n\n    static void testLongAdder() {\n        LongAdder adder = new LongAdder();\n        long start = System.currentTimeMillis();\n\n        IntStream.range(0, 1000).parallel().forEach(i -&gt; {\n            for (int j = 0; j &lt; 10_000; j++) {\n                adder.increment();\n            }\n        });\n\n        System.out.println(\"LongAdder: \" + (System.currentTimeMillis() - start) + \"ms\");\n    }\n</code></pre> <pre><code>AtomicLong: 209ms\nLongAdder: 38ms\n</code></pre> <p>\u7d2f\u52a0\u5668\u539f\u7406</p> <p>1. \u65e0\u7ade\u4e89\uff1a\u76f4\u63a5CAS\u4fee\u6539<code>base</code>\uff08\u7c7b\u4f3cAtomicLong\uff09</p> <p>2. \u6709\u7ade\u4e89\uff1a</p> <ul> <li>\u521d\u59cb\u5316<code>Cell[]</code>\u6570\u7ec4\uff08\u9ed8\u8ba4CPU\u6838\u6570\uff09</li> <li>\u7ebf\u7a0b\u54c8\u5e0c\u6620\u5c04\u5230\u4e0d\u540cCell\uff0c\u51cf\u5c11\u51b2\u7a81</li> <li>\u6700\u7ec8\u7ed3\u679c = <code>base + \u2211cells[i]</code></li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u4f2a\u5171\u4eab","title":"\u4f2a\u5171\u4eab","text":"<p>\u4f2a\u5171\u4eab\u662f\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u7684\u4e00\u4e2a\u9690\u85cf\u6027\u80fd\u6740\u624b\uff0c\u5b83\u4f1a\u5bfc\u81f4\u591a\u6838CPU\u7684\u7f13\u5b58\u7cfb\u7edf\u5931\u6548\uff0c\u4e25\u91cd\u5f71\u54cd\u5e76\u53d1\u7a0b\u5e8f\u7684\u6027\u80fd\u3002\u7406\u89e3\u5e76\u89e3\u51b3\u4f2a\u5171\u4eab\u95ee\u9898\u5bf9\u7f16\u5199\u9ad8\u6027\u80fd\u5e76\u53d1\u4ee3\u7801\u81f3\u5173\u91cd\u8981\u3002</p> <p></p> <p>\u4f2a\u5171\u4eab\uff08False Sharing\uff09\u662f\u6307\uff1a</p> <ul> <li>\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u4fee\u6539\u4f4d\u4e8e\u540c\u4e00\u7f13\u5b58\u884c\uff08Cache Line\uff09\u4e2d\u7684\u4e0d\u540c\u53d8\u91cf</li> <li>\u7531\u4e8eCPU\u7f13\u5b58\u4ee5\u7f13\u5b58\u884c\u4e3a\u5355\u4f4d\u64cd\u4f5c\uff0c\u5bfc\u81f4\u672c\u65e0\u5173\u8054\u7684\u53d8\u91cf\u4e92\u76f8\u5f71\u54cd</li> <li>\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u7f13\u5b58\u5931\u6548\uff0c\u5f15\u53d1\u4e25\u91cd\u7684\u6027\u80fd\u4e0b\u964d</li> </ul> <p></p> <p>\u7f13\u5b58\u884c\uff08Cache Line\uff09</p> <ul> <li>CPU\u7f13\u5b58\u7684\u6700\u5c0f\u5355\u4f4d\uff08\u901a\u5e3864\u5b57\u8282\uff09</li> <li>\u5f53\u7f13\u5b58\u884c\u4e2d\u4efb\u4e00\u6570\u636e\u88ab\u4fee\u6539\uff0c\u6574\u4e2a\u884c\u5728\u6240\u6709CPU\u6838\u5fc3\u90fd\u4f1a\u5931\u6548</li> </ul> <p></p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>\u4f7f\u7528<code>@Contended</code>\u6ce8\u89e3\uff08JDK8+\uff09</p> <pre><code>class Data {\n    @sun.misc.Contended  // \u81ea\u52a8\u586b\u5145\u7f13\u5b58\u884c\n    volatile long x;\n\n    @sun.misc.Contended\n    volatile long y;\n}\n</code></pre> <p>Warning</p> <p>\u8be5\u6ce8\u89e3\u9ed8\u8ba4\u4e0d\u542f\u7528\uff0c\u9700\u8981\u5728JVM\u53c2\u6570\u4e2d\u5f00\u542f<code>-XX:+RestrictContended</code>\uff0c\u5426\u5219\u4f1a\u88ab\u5ffd\u7565</p> <p>\u539f\u7406</p> <p><code>@Contended</code>\u6ce8\u89e3\u4f1a\u5728\u5b57\u6bb5\u524d\u540e\u6dfb\u52a0\u586b\u5145\u5b57\u6bb5\uff0c\u786e\u4fdd\u6bcf\u4e2a\u5b57\u6bb5\u72ec\u5360\u4e00\u4e2a\u7f13\u5b58\u884c\uff0c\u907f\u514d\u4f2a\u5171\u4eab\u95ee\u9898\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#unsafe","title":"Unsafe","text":"<p>Unsafe \u662f Java \u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u5de5\u5177\u7c7b\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u76f4\u63a5\u64cd\u4f5c\u5185\u5b58\u3001\u7ed5\u8fc7JVM\u5b89\u5168\u673a\u5236\u7684\u5e95\u5c42\u65b9\u6cd5\u3002</p> <p>\u5b83\u5f97\u540d\"Unsafe\"\u6b63\u662f\u56e0\u4e3a\u5b83\u7684\u64cd\u4f5c\u4e0d\u53d7JVM\u5b89\u5168\u7ba1\u7406\u5668\u7ea6\u675f\uff0c\u4f7f\u7528\u4e0d\u5f53\u53ef\u80fd\u5bfc\u81f4JVM\u5d29\u6e83\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u5185\u5b58\u64cd\u4f5c","title":"\u5185\u5b58\u64cd\u4f5c","text":"<ul> <li>\u76f4\u63a5\u5185\u5b58\u5206\u914d/\u91ca\u653e</li> </ul> <pre><code>long address = unsafe.allocateMemory(1024); // \u5206\u914d1KB\u5806\u5916\u5185\u5b58\nunsafe.setMemory(address, 1024, (byte) 0); // \u5185\u5b58\u7f6e\u96f6\nunsafe.freeMemory(address); // \u91ca\u653e\u5185\u5b58\n</code></pre> <ul> <li>\u5185\u5b58\u8bfb\u5199</li> </ul> <pre><code>unsafe.putInt(address, 123);  // \u5728\u6307\u5b9a\u5730\u5740\u5199\u5165int\nint value = unsafe.getInt(address); // \u8bfb\u53d6int\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u5bf9\u8c61\u64cd\u4f5c","title":"\u5bf9\u8c61\u64cd\u4f5c","text":"<ul> <li>\u7ed5\u8fc7\u6784\u9020\u5668\u521b\u5efa\u5bf9\u8c61</li> </ul> <pre><code>MyClass obj = (MyClass) unsafe.allocateInstance(MyClass.class);\n</code></pre> <ul> <li>\u5b57\u6bb5\u504f\u79fb\u91cf\u64cd\u4f5c</li> </ul> <pre><code>long offset = unsafe.objectFieldOffset(MyClass.class.getDeclaredField(\"value\"));\nunsafe.putInt(obj, offset, 100); // \u76f4\u63a5\u4fee\u6539\u5b57\u6bb5\u503c\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u7ebf\u7a0b\u8c03\u5ea6","title":"\u7ebf\u7a0b\u8c03\u5ea6","text":"<ul> <li>\u7ebf\u7a0b\u6302\u8d77/\u6062\u590d</li> </ul> <pre><code>unsafe.park(false, 0); // \u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\nunsafe.unpark(thread); // \u6062\u590d\u6307\u5b9a\u7ebf\u7a0b\n</code></pre> <ul> <li>CAS\u64cd\u4f5c</li> </ul> <pre><code>boolean success = unsafe.compareAndSwapInt(obj, offset, expect, update);\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B9%90%E8%A7%82%E9%94%81/#\u6570\u7ec4\u64cd\u4f5c","title":"\u6570\u7ec4\u64cd\u4f5c","text":"<ul> <li>\u83b7\u53d6\u6570\u7ec4\u5143\u7d20\u504f\u79fb</li> </ul> <pre><code>int base = unsafe.arrayBaseOffset(int[].class);\nint scale = unsafe.arrayIndexScale(int[].class);\n</code></pre> <p>\u83b7\u53d6Unsafe\u5b9e\u4f8b</p> <p>\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0cUnsafe \u88ab\u8bbe\u8ba1\u4e3a\u9650\u5236\u83b7\u53d6\uff1a</p> <p>\u53cd\u5c04\u83b7\u53d6\uff08\u6700\u5e38\u7528\uff09 <pre><code>Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\ntheUnsafe.setAccessible(true);\nUnsafe unsafe = (Unsafe) theUnsafe.get(null);\n</code></pre></p> <p>\u4ece<code>TrustedFinalizer</code>\u83b7\u53d6\uff08JDK\u5185\u90e8\uff09 <pre><code>// \u4ec5\u4f9b\u4e86\u89e3\uff0c\u5b9e\u9645\u4e0d\u63a8\u8350\nUnsafe unsafe = sun.misc.Unsafe.getUnsafe();\n</code></pre></p> <p>\u4e0a\u4e00\u8282\uff1a\u5e76\u53d1\u7f16\u7a0b\u4e09\u8981\u7d20</p> <p>\u4e0b\u4e00\u8282\uff1a\u4e0d\u53ef\u53d8\u7c7b</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/","title":"\u5e76\u53d1\u5de5\u5177","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u7ebf\u7a0b\u6c60","title":"\u7ebf\u7a0b\u6c60","text":"<p>\u7ebf\u7a0b\u6c60\u662f\u5e76\u53d1\u7f16\u7a0b\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u5b83\u901a\u8fc7\u590d\u7528\u7ebf\u7a0b\u6765\u6267\u884c\u591a\u4e2a\u4efb\u52a1\uff0c\u907f\u514d\u4e86\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u6027\u80fd\u548c\u54cd\u5e94\u901f\u5ea6\u3002Java \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd\u7ebf\u7a0b\u6c60\u7684\u57fa\u672c\u6982\u5ff5\u3001\u5de5\u4f5c\u539f\u7406\u4ee5\u53ca\u5e38\u89c1\u7684\u7ebf\u7a0b\u6c60\u7c7b\u578b\u3002</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60","title":"\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>ThreadPool threadPoolExecutor = ThreadPool.builder()\n        .coreSize(2)\n        .timeout(10, TimeUnit.SECONDS)\n        .capacity(10)\n        .rejectPolicy((queue, task) -&gt; {\n            log.info(\"\u4efb\u52a1 {} \u88ab\u62d2\u7edd\", task);\n        }).build();\n\nfor (int i = 0; i &lt; 15; i++) {\n    int k = i;\n    threadPoolExecutor.execute(() -&gt; {\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        log.info(\"\u6267\u884c\u4efb\u52a1 {}\", k);\n    });\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u62d2\u7edd\u7b56\u7565\u51fd\u6570\u5f0f\u63a5\u53e3","title":"\u62d2\u7edd\u7b56\u7565\uff08\u51fd\u6570\u5f0f\u63a5\u53e3\uff09","text":"<p>\u62d2\u7edd\u7b56\u7565\u662f\u6307\u5f53\u7ebf\u7a0b\u6c60\u548c\u4efb\u52a1\u961f\u5217\u90fd\u6ee1\u4e86\u4e4b\u540e\uff0c\u5982\u4f55\u5904\u7406\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u3002</p> <pre><code>/**\n * \u62d2\u7edd\u7b56\u7565\u63a5\u53e3\n *\n * @param &lt;T&gt;\n */\n@FunctionalInterface\ninterface RejectPolicy&lt;T&gt; {\n    void reject(BlockingQueue&lt;T&gt; queue, T task);\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u963b\u585e\u5f0f\u4efb\u52a1\u961f\u5217","title":"\u963b\u585e\u5f0f\u4efb\u52a1\u961f\u5217","text":"<p>\u4efb\u52a1\u961f\u5217\u662f\u7528\u6765\u5b58\u653e\u5f85\u6267\u884c\u4efb\u52a1\u7684\u5bb9\u5668\uff0c\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u90fd\u5728\u5fd9\u788c\u65f6\uff0c\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u4f1a\u88ab\u653e\u5165\u4efb\u52a1\u961f\u5217\u4e2d\u7b49\u5f85\u6267\u884c\u3002</p> <pre><code>@Slf4j\nclass BlockingQueue&lt;T&gt; {\n    /**\n     * \u4efb\u52a1\u961f\u5217\n     */\n    private final Deque&lt;T&gt; queue = new ArrayDeque&lt;&gt;();\n\n    /**\n     * \u961f\u5217\u9501\n     */\n    public ReentrantLock lock = new ReentrantLock();\n\n    /**\n     * \u751f\u4ea7\u8005\u6761\u4ef6\u53d8\u91cf\n     */\n    private final Condition fullWaitSet = lock.newCondition();\n\n    /**\n     * \u6d88\u8d39\u8005\u6761\u4ef6\u53d8\u91cf\n     */\n    private final Condition emptyWaitSet = lock.newCondition();\n\n    /**\n     * \u961f\u5217\u5bb9\u91cf\n     */\n    private final int capacity;\n\n    public BlockingQueue(int capacity) {\n        this.capacity = capacity;\n    }\n\n    /**\n     * \u963b\u585e\u8d85\u65f6\u83b7\u53d6\n     */\n    public T poll(long timeout, TimeUnit unit) {\n        lock.lock();\n        try {\n            long nanos = unit.toNanos(timeout);\n            while (queue.isEmpty()) {\n                try {\n                    // \u8d85\u65f6\u8fd4\u56de\n                    if (nanos &lt;= 0) {\n                        return null;\n                    }\n                    // awaitNanos \u8fd4\u56de\u5269\u4f59\u65f6\u95f4\n                    nanos = emptyWaitSet.awaitNanos(nanos);\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            fullWaitSet.signal();\n            log.info(\"\u53d6\u51fa\u4efb\u52a1 {}\", queue.peek());\n            return queue.removeFirst();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * \u963b\u585e\u83b7\u53d6\n     */\n    public T take() {\n        lock.lock();\n        try {\n            while (queue.isEmpty()) {\n                try {\n                    emptyWaitSet.await();\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            fullWaitSet.signal();\n            log.info(\"\u53d6\u51fa\u4efb\u52a1 {}\", queue.peek());\n            return queue.removeFirst();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * \u5c1d\u8bd5\u6dfb\u52a0\u4efb\u52a1\n     *\n     * @param rejectPolicy \u62d2\u7edd\u7b56\u7565\n     * @param task         \u4efb\u52a1\n     */\n    public void tryPut(RejectPolicy&lt;T&gt; rejectPolicy, T task) {\n        lock.lock();\n        try {\n            if (queue.size() == capacity) {\n                rejectPolicy.reject(this, task);\n            } else {\n                queue.addLast(task);\n                emptyWaitSet.signal();\n            }\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * \u963b\u585e\u6dfb\u52a0\n     */\n    public void put(T task) {\n        lock.lock();\n        try {\n            while (queue.size() == capacity) {\n                try {\n                    log.info(\"\u961f\u5217\u5df2\u6ee1\uff0c\u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\");\n                    fullWaitSet.await();\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            log.info(\"\u6dfb\u52a0\u4efb\u52a1 {}\", task);\n            queue.addLast(task);\n            emptyWaitSet.signal();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * \u8d85\u65f6\u963b\u585e\u6dfb\u52a0\n     *\n     * @return true \u6210\u529f false \u8d85\u65f6\u5931\u8d25\n     */\n    public boolean offer(T task, long timeout, TimeUnit unit) {\n        lock.lock();\n        try {\n            long nanos = unit.toNanos(timeout);\n            while (queue.size() == capacity) {\n                try {\n                    log.info(\"\u961f\u5217\u5df2\u6ee1\uff0c\u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\");\n                    if (nanos &lt;= 0) {\n                        log.info(\"\u6dfb\u52a0\u4efb\u52a1\u8d85\u65f6\");\n                        return false;\n                    }\n                    nanos = fullWaitSet.awaitNanos(nanos);\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            log.info(\"\u6dfb\u52a0\u4efb\u52a1 {}\", task);\n            queue.addLast(task);\n            emptyWaitSet.signal();\n            return true;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public int size() {\n        lock.lock();\n        try {\n            return queue.size();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u7ebf\u7a0b\u6c60_1","title":"\u7ebf\u7a0b\u6c60","text":"<pre><code>@Slf4j\nclass ThreadPool {\n    /**\n     * \u4efb\u52a1\u961f\u5217\n     */\n    private final BlockingQueue&lt;Runnable&gt; taskQueue;\n\n    /**\n     * \u6267\u884c\u7ebf\u7a0b\u961f\u5217\n     */\n    private final HashSet&lt;Worker&gt; workers = new HashSet&lt;&gt;();\n\n    /**\n     * \u6838\u5fc3\u7ebf\u7a0b\u6570\n     */\n    private final int coreSize;\n\n    /**\n     * \u8d85\u65f6\u65f6\u95f4\n     */\n    private final long timeout;\n\n    /**\n     * \u8d85\u65f6\u65f6\u95f4\u5355\u4f4d\n     */\n    private final TimeUnit unit;\n\n    /**\n     * \u62d2\u7edd\u7b56\u7565\n     */\n    private final RejectPolicy&lt;Runnable&gt; rejectPolicy;\n\n    private ThreadPool(Builder builder) {\n        this.coreSize = builder.coreSize;\n        this.timeout = builder.timeout;\n        this.unit = builder.unit;\n        this.rejectPolicy = builder.rejectPolicy;\n        this.taskQueue = new BlockingQueue&lt;&gt;(builder.capacity);\n    }\n\n    public static Builder builder() {\n        return new Builder();\n    }\n\n    /**\n     * Builder\u6784\u5efa\u5668\n     */\n    public static class Builder {\n        private int coreSize = 5; // \u9ed8\u8ba4\u6838\u5fc3\u7ebf\u7a0b\u6570\n        private long timeout = 5; // \u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\n        private TimeUnit unit = TimeUnit.SECONDS; // \u9ed8\u8ba4\u65f6\u95f4\u5355\u4f4d\n        private RejectPolicy&lt;Runnable&gt; rejectPolicy = (queue, task) -&gt; {\n            log.info(\"\u4efb\u52a1 {} \u88ab\u62d2\u7edd\", task);\n        }; // \u9ed8\u8ba4\u62d2\u7edd\u7b56\u7565\n        private int capacity = 100; // \u9ed8\u8ba4\u4efb\u52a1\u961f\u5217\u5bb9\u91cf\n\n        public Builder coreSize(int coreSize) {\n            this.coreSize = coreSize;\n            return this;\n        }\n\n        public Builder timeout(long timeout, TimeUnit unit) {\n            this.timeout = timeout;\n            this.unit = unit;\n            return this;\n        }\n\n        public Builder rejectPolicy(RejectPolicy&lt;Runnable&gt; rejectPolicy) {\n            this.rejectPolicy = rejectPolicy;\n            return this;\n        }\n\n        public Builder capacity(int capacity) {\n            this.capacity = capacity;\n            return this;\n        }\n\n        public ThreadPool build() {\n            return new ThreadPool(this);\n        }\n    }\n\n    /**\n     * \u6267\u884c\u4efb\u52a1\n     *\n     * @param task \u4efb\u52a1\n     */\n    public synchronized void execute(Runnable task) {\n        if (workers.size() &lt; coreSize) {\n            Worker worker = new Worker(task);\n            synchronized (workers) {\n                workers.add(worker);\n            }\n            worker.start();\n        } else {\n            // \u961f\u5217\u5df2\u6ee1\uff0c\u5c1d\u8bd5\u62d2\u7edd\u7b56\u7565\n            taskQueue.tryPut(rejectPolicy, task);\n        }\n    }\n\n    /**\n     * \u5de5\u4f5c\u7ebf\u7a0b\n     */\n    class Worker extends Thread {\n        private Runnable task;\n\n        public Worker(Runnable task) {\n            this.task = task;\n        }\n\n        @SneakyThrows\n        @Override\n        public void run() {\n            while (task != null || (task = taskQueue.poll(timeout, unit)) != null) {\n                try {\n                    task.run();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                } finally {\n                    task = null;\n                }\n            }\n            synchronized (workers) {\n                log.info(\"\u79fb\u9664\u7ebf\u7a0b {}\", this);\n                workers.remove(this);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#threadpoolexecutor","title":"ThreadPoolExecutor","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u7ebf\u7a0b\u72b6\u6001","title":"\u7ebf\u7a0b\u72b6\u6001","text":"<p><code>ThreadPoolExecutor</code> \u4f7f\u7528 int \u7684\u9ad8 3 \u4f4d\u6765\u8868\u793a\u7ebf\u7a0b\u6c60\u72b6\u6001\uff0c\u4f4e 29 \u4f4d\u8868\u793a\u7ebf\u7a0b\u6570\u91cf</p> \u72b6\u6001 \u9ad83\u4f4d \u8bf4\u660e \u5f71\u54cd RUNNING 111 \u7ebf\u7a0b\u6c60\u6b63\u5e38\u8fd0\u884c\u72b6\u6001\uff0c\u53ef\u4ee5\u63a5\u6536\u65b0\u4efb\u52a1\u5e76\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1 \u65b0\u4efb\u52a1\u4f1a\u88ab\u63a5\u53d7\u5e76\u6267\u884c SHUTDOWN 000 \u5173\u95ed\u72b6\u6001\uff0c\u4e0d\u518d\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u4f46\u4f1a\u5904\u7406\u961f\u5217\u4e2d\u5df2\u5b58\u5728\u7684\u4efb\u52a1 \u65b0\u4efb\u52a1\u88ab\u62d2\u7edd\uff0c\u961f\u5217\u4efb\u52a1\u7ee7\u7eed\u6267\u884c STOP 001 \u505c\u6b62\u72b6\u6001\uff0c\u4e0d\u518d\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u4e5f\u4e0d\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u5e76\u4e2d\u65ad\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1 \u65b0\u4efb\u52a1\u88ab\u62d2\u7edd\uff0c\u961f\u5217\u4efb\u52a1\u4e0d\u6267\u884c\uff0c\u4e2d\u65ad\u5de5\u4f5c\u7ebf\u7a0b TIDYING 010 \u6574\u7406\u72b6\u6001\uff0c\u6240\u6709\u4efb\u52a1\u5df2\u7ec8\u6b62\uff0cworkerCount=0\uff0c\u5c06\u6267\u884cterminated()\u94a9\u5b50\u65b9\u6cd5 \u8fc7\u6e21\u72b6\u6001\uff0c\u5373\u5c06\u53d8\u4e3aTERMINATED TERMINATED 011 \u7ec8\u6b62\u72b6\u6001\uff0cterminated()\u65b9\u6cd5\u5df2\u5b8c\u6210 \u7ebf\u7a0b\u6c60\u5b8c\u5168\u7ed3\u675f <p>\u8fd9\u4e9b\u4fe1\u606f\u5b58\u50a8\u5728\u4e00\u4e2a\u539f\u5b50\u53d8\u91cf ctl \u4e2d\uff0c\u76ee\u7684\u662f\u5c06\u7ebf\u7a0b\u6c60\u72b6\u6001\u4e0e\u7ebf\u7a0b\u4e2a\u6570\u5408\u4e8c\u4e3a\u4e00\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528\u4e00\u6b21 cas \u539f\u5b50\u64cd\u4f5c \u8fdb\u884c\u8d4b\u503c</p> <pre><code>    // c \u4e3a\u65e7\u503c\uff0c ctlOf \u8fd4\u56de\u7ed3\u679c\u4e3a\u65b0\u503c\n    ctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))));\n    // rs \u4e3a\u9ad8 3 \u4f4d\u4ee3\u8868\u7ebf\u7a0b\u6c60\u72b6\u6001\uff0c wc \u4e3a\u4f4e 29 \u4f4d\u4ee3\u8868\u7ebf\u7a0b\u4e2a\u6570\uff0cctl \u662f\u5408\u5e76\u5b83\u4eec\n    private static int ctlOf(int rs, int wc) { return rs | wc; }\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u6784\u9020\u65b9\u6cd5","title":"\u6784\u9020\u65b9\u6cd5","text":"<pre><code>    public ThreadPoolExecutor(int corePoolSize,\n                              int maximumPoolSize,\n                              long keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue&lt;Runnable&gt; workQueue,\n                              RejectedExecutionHandler handler)\n</code></pre> <ul> <li><code>corePoolSize</code> \u6838\u5fc3\u7ebf\u7a0b\u6570\u76ee (\u6700\u591a\u4fdd\u7559\u7684\u7ebf\u7a0b\u6570) </li> <li><code>maximumPoolSize</code> \u6700\u5927\u7ebf\u7a0b\u6570\u76ee </li> <li><code>keepAliveTime</code> \u751f\u5b58\u65f6\u95f4 - \u9488\u5bf9\u6551\u6025\u7ebf\u7a0b </li> <li><code>unit</code> \u65f6\u95f4\u5355\u4f4d - \u9488\u5bf9\u6551\u6025\u7ebf\u7a0b </li> <li><code>workQueue</code> \u963b\u585e\u961f\u5217 </li> <li><code>threadFactory</code> \u7ebf\u7a0b\u5de5\u5382 - \u53ef\u4ee5\u4e3a\u7ebf\u7a0b\u521b\u5efa\u65f6\u6307\u5b9a\u66f4\u6709\u610f\u4e49\u7684\u540d\u5b57 </li> <li><code>handler</code> \u62d2\u7edd\u7b56\u7565</li> </ul> <p>\u6838\u5fc3\u7ebf\u7a0b vs \u6551\u6025\u7ebf\u7a0b</p> \u7279\u6027 \u6838\u5fc3\u7ebf\u7a0b (Core Threads) \u6551\u6025\u7ebf\u7a0b (\u6551\u6025\u7ebf\u7a0b/\u975e\u6838\u5fc3\u7ebf\u7a0b) \u521b\u5efa\u65f6\u673a \u7ebf\u7a0b\u6c60\u521d\u59cb\u5316\u65f6\u9884\u521b\u5efa\u6216\u6309\u9700\u521b\u5efa \u5f53\u4efb\u52a1\u6570 &gt; (\u6838\u5fc3\u7ebf\u7a0b\u6570+\u961f\u5217\u5bb9\u91cf)\u65f6\u521b\u5efa \u6570\u91cf\u63a7\u5236 \u7531<code>corePoolSize</code>\u53c2\u6570\u51b3\u5b9a \u7531<code>maximumPoolSize - corePoolSize</code>\u51b3\u5b9a \u5b58\u6d3b\u65f6\u95f4 \u9ed8\u8ba4\u957f\u671f\u5b58\u6d3b(\u5373\u4f7f\u7a7a\u95f2) \u7a7a\u95f2\u8d85\u8fc7<code>keepAliveTime</code>\u540e\u88ab\u56de\u6536 \u56de\u6536\u7b56\u7565 <code>allowCoreThreadTimeOut=true</code>\u65f6\u53ef\u88ab\u56de\u6536 \u603b\u662f\u53ef\u88ab\u56de\u6536 \u4efb\u52a1\u5904\u7406\u4f18\u5148\u7ea7 \u4f18\u5148\u4f7f\u7528\u6838\u5fc3\u7ebf\u7a0b\u5904\u7406\u4efb\u52a1 \u961f\u5217\u6ee1\u4e14\u6838\u5fc3\u7ebf\u7a0b\u5fd9\u65f6\u624d\u4f1a\u4f7f\u7528 \u5178\u578b\u5e94\u7528\u573a\u666f \u7ef4\u6301\u57fa\u672c\u5e76\u53d1\u80fd\u529b \u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf <pre><code>\u65b0\u4efb\u52a1\u5230\u8fbe\u65f6:\n1. \u4f18\u5148\u4f7f\u7528\u6838\u5fc3\u7ebf\u7a0b\u5904\u7406\n   \u2193 (\u6838\u5fc3\u7ebf\u7a0b\u5168\u5fd9)\n2. \u4efb\u52a1\u8fdb\u5165\u5de5\u4f5c\u961f\u5217\n   \u2193 (\u961f\u5217\u5df2\u6ee1)\n3. \u521b\u5efa\u6551\u6025\u7ebf\u7a0b\u5904\u7406\n   \u2193 (\u8fbe\u5230maximumPoolSize)\n4. \u89e6\u53d1\u62d2\u7edd\u7b56\u7565\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u62d2\u7edd\u7b56\u7565","title":"\u62d2\u7edd\u7b56\u7565","text":"\u7b56\u7565\u540d\u79f0 \u5bf9\u5e94\u7c7b \u884c\u4e3a\u63cf\u8ff0 \u9002\u7528\u573a\u666f AbortPolicy <code>AbortPolicy</code> \u76f4\u63a5\u629b\u51faRejectedExecutionException\u5f02\u5e38 \u9700\u8981\u660e\u786e\u77e5\u9053\u4efb\u52a1\u88ab\u62d2\u7edd\u7684\u573a\u666f\uff08\u9ed8\u8ba4\u7b56\u7565\uff09 CallerRunsPolicy <code>CallerRunsPolicy</code> \u7531\u8c03\u7528\u8005\u7ebf\u7a0b\u76f4\u63a5\u6267\u884c\u88ab\u62d2\u7edd\u7684\u4efb\u52a1 \u4e0d\u5e0c\u671b\u4e22\u5931\u4efb\u52a1\u4e14\u53ef\u4ee5\u63a5\u53d7\u4efb\u52a1\u6267\u884c\u53d8\u6162\u7684\u573a\u666f DiscardPolicy <code>DiscardPolicy</code> \u9759\u9ed8\u4e22\u5f03\u88ab\u62d2\u7edd\u7684\u4efb\u52a1\uff0c\u4e0d\u629b\u51fa\u5f02\u5e38\u4e5f\u4e0d\u6267\u884c \u5141\u8bb8\u4e22\u5f03\u90e8\u5206\u4efb\u52a1\u7684\u573a\u666f DiscardOldestPolicy <code>DiscardOldestPolicy</code> \u4e22\u5f03\u961f\u5217\u4e2d\u6700\u65e7\u7684\u4efb\u52a1\uff0c\u7136\u540e\u5c1d\u8bd5\u91cd\u65b0\u63d0\u4ea4\u5f53\u524d\u4efb\u52a1 \u5141\u8bb8\u4e22\u5f03\u65e7\u4efb\u52a1\uff0c\u5e0c\u671b\u5c3d\u91cf\u6267\u884c\u65b0\u4efb\u52a1\u7684\u573a\u666f \u81ea\u5b9a\u4e49\u62d2\u7edd\u7b56\u7565 \u5b9e\u73b0<code>RejectedExecutionHandler</code>\u63a5\u53e3 \u6839\u636e\u4e1a\u52a1\u9700\u6c42\u81ea\u5b9a\u4e49\u5904\u7406\u88ab\u62d2\u7edd\u4efb\u52a1\u7684\u903b\u8f91 \u9700\u8981\u7279\u6b8a\u5904\u7406\u88ab\u62d2\u7edd\u4efb\u52a1\u7684\u573a\u666f"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#executors\u5de5\u5382\u65b9\u6cd5","title":"Executors\u5de5\u5382\u65b9\u6cd5","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#newfixedthreadpool","title":"newFixedThreadPool","text":"<pre><code>    public static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue&lt;Runnable&gt;());\n    }\n</code></pre> <p>Note</p> <ul> <li>\u7279\u70b9\uff1a<ul> <li>\u56fa\u5b9a\u7ebf\u7a0b\u6570\uff08\u6838\u5fc3\u7ebf\u7a0b=\u6700\u5927\u7ebf\u7a0b\uff09</li> <li>\u65e0\u754c\u4efb\u52a1\u961f\u5217\uff08<code>LinkedBlockingQueue</code>\uff09</li> <li>\u9002\u5408\u7a33\u5b9a\u8d1f\u8f7d\u573a\u666f</li> </ul> </li> <li>\u6ce8\u610f\uff1a<ul> <li>\u4efb\u52a1\u5806\u79ef\u53ef\u80fd\u5bfc\u81f4OOM</li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#newcachedthreadpool","title":"newCachedThreadPool","text":"<pre><code>    public static ExecutorService newCachedThreadPool() {\n        return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                      60L, TimeUnit.SECONDS,\n                                      new SynchronousQueue&lt;Runnable&gt;());\n    }\n</code></pre> <p>Note</p> <ul> <li>\u7279\u70b9\uff1a<ul> <li>\u7ebf\u7a0b\u6570\u65e0\u4e0a\u9650\uff08<code>Integer.MAX_VALUE</code>\uff09</li> <li>\u7a7a\u95f2\u7ebf\u7a0b60\u79d2\u540e\u56de\u6536</li> <li>\u9002\u5408\u5927\u91cf\u77ed\u751f\u547d\u5468\u671f\u7684\u5f02\u6b65\u4efb\u52a1</li> </ul> </li> <li>\u6ce8\u610f\uff1a<ul> <li>\u53ef\u80fd\u521b\u5efa\u8fc7\u591a\u7ebf\u7a0b\u5bfc\u81f4OOM</li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#newsinglethreadexecutor","title":"newSingleThreadExecutor","text":"<pre><code>    public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) {\n        return new FinalizableDelegatedExecutorService\n            (new ThreadPoolExecutor(1, 1,\n                                    0L, TimeUnit.MILLISECONDS,\n                                    new LinkedBlockingQueue&lt;Runnable&gt;(),\n                                    threadFactory));\n    }\n</code></pre> <p>Note</p> <ul> <li>\u7279\u70b9\uff1a<ul> <li>\u4fdd\u8bc1\u4efb\u52a1\u987a\u5e8f\u6267\u884c\uff08FIFO\uff09</li> <li>\u9002\u7528\u4e8e\u9700\u8981\u4e25\u683c\u4e32\u884c\u5316\u7684\u573a\u666f</li> </ul> </li> </ul> <p>\u6ce8\u610f</p> <ul> <li>\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u5355\u7ebf\u7a0b\u4e32\u884c\u6267\u884c\u4efb\u52a1\uff0c\u5982\u679c\u4efb\u52a1\u6267\u884c\u5931\u8d25\u800c\u7ec8\u6b62\u90a3\u4e48\u6ca1\u6709\u4efb\u4f55\u8865\u6551\u63aa\u65bd\uff0c\u800c\u7ebf\u7a0b\u6c60\u8fd8\u4f1a\u65b0\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4fdd\u8bc1\u6c60\u7684\u6b63\u5e38\u5de5\u4f5c <ul> <li>Executors.newSingleThreadExecutor() \u7ebf\u7a0b\u4e2a\u6570\u59cb\u7ec8\u4e3a1\uff0c\u4e0d\u80fd\u4fee\u6539 </li> <li>FinalizableDelegatedExecutorService \u5e94\u7528\u7684\u662f\u88c5\u9970\u5668\u6a21\u5f0f\uff0c\u53ea\u5bf9\u5916\u66b4\u9732\u4e86 ExecutorService \u63a5\u53e3\uff0c\u56e0\u6b64\u4e0d\u80fd\u8c03\u7528 ThreadPoolExecutor \u4e2d\u7279\u6709\u7684\u65b9\u6cd5 </li> </ul> </li> <li>Executors.newFixedThreadPool(1) \u521d\u59cb\u65f6\u4e3a1\uff0c\u4ee5\u540e\u8fd8\u53ef\u4ee5\u4fee\u6539 <ul> <li>\u5bf9\u5916\u66b4\u9732\u7684\u662f ThreadPoolExecutor \u5bf9\u8c61\uff0c\u53ef\u4ee5\u5f3a\u8f6c\u540e\u8c03\u7528 setCorePoolSize \u7b49\u65b9\u6cd5\u8fdb\u884c\u4fee\u6539</li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u63d0\u4ea4\u4efb\u52a1","title":"\u63d0\u4ea4\u4efb\u52a1","text":"<pre><code>// \u6267\u884c\u4efb\u52a1\nvoid execute(Runnable command);\n\n// \u63d0\u4ea4\u4efb\u52a1 task\uff0c\u7528\u8fd4\u56de\u503c Future \u83b7\u5f97\u4efb\u52a1\u6267\u884c\u7ed3\u679c\n&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);\n\n// \u63d0\u4ea4 tasks \u4e2d\u6240\u6709\u4efb\u52a1\n&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;\n\n// \u63d0\u4ea4 tasks \u4e2d\u6240\u6709\u4efb\u52a1\uff0c\u5e26\u8d85\u65f6\u65f6\u95f4\n&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,long timeout, TimeUnit unit)\n        throws InterruptedException;\n\n// \u63d0\u4ea4 tasks \u4e2d\u6240\u6709\u4efb\u52a1\uff0c\u54ea\u4e2a\u4efb\u52a1\u5148\u6210\u529f\u6267\u884c\u5b8c\u6bd5\uff0c\u8fd4\u56de\u6b64\u4efb\u52a1\u6267\u884c\u7ed3\u679c\uff0c\u5176\u5b83\u4efb\u52a1\u53d6\u6d88\n&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)\n        throws InterruptedException, ExecutionException;\n\n// \u63d0\u4ea4 tasks \u4e2d\u6240\u6709\u4efb\u52a1\uff0c\u54ea\u4e2a\u4efb\u52a1\u5148\u6210\u529f\u6267\u884c\u5b8c\u6bd5\uff0c\u8fd4\u56de\u6b64\u4efb\u52a1\u6267\u884c\u7ed3\u679c\uff0c\u5176\u5b83\u4efb\u52a1\u53d6\u6d88\uff0c\u5e26\u8d85\u65f6\u65f6\u95f4\n&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n</code></pre> \u65b9\u6cd5 \u8fd4\u56de\u503c \u662f\u5426\u963b\u585e \u5f02\u5e38\u5904\u7406 \u9002\u7528\u573a\u666f <code>execute()</code> void \u5426 \u63a7\u5236\u53f0\u6253\u5370 \u7b80\u5355\u5f02\u6b65\u4efb\u52a1 <code>submit(Runnable)</code> Future&lt;?&gt; \u5426 Future\u83b7\u53d6 \u9700\u8981\u4efb\u52a1\u72b6\u6001 <code>submit(Callable)</code> Future \u5426 Future\u83b7\u53d6 \u9700\u8981\u8fd4\u56de\u7ed3\u679c <code>invokeAll()</code> List&gt; \u662f Future\u83b7\u53d6 \u6279\u91cf\u5e76\u884c\u4efb\u52a1 <code>invokeAny()</code> T \u662f \u76f4\u63a5\u629b\u51fa \u83b7\u53d6\u6700\u5feb\u7ed3\u679c <code>schedule()</code> ScheduledFuture \u5426 Future\u83b7\u53d6 \u5ef6\u8fdf/\u5b9a\u65f6\u4efb\u52a1"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#1-executerunnable---\u57fa\u7840\u63d0\u4ea4","title":"1. <code>execute(Runnable)</code> - \u57fa\u7840\u63d0\u4ea4","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u63d0\u4ea4<code>Runnable</code>\u4efb\u52a1</li> <li>\u65e0\u8fd4\u56de\u503c</li> <li>\u4efb\u52a1\u5f02\u5e38\u4f1a\u6253\u5370\u5230\u63a7\u5236\u53f0\u4f46\u4e0d\u4f1a\u629b\u51fa</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u4e0d\u9700\u8981\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u7684\u7b80\u5355\u4efb\u52a1</li> <li>\u65e5\u5fd7\u8bb0\u5f55\u3001\u5f02\u6b65\u901a\u77e5\u7b49</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#2-submitrunnable---\u63d0\u4ea4\u53ef\u83b7\u53d6\u72b6\u6001\u7684\u4efb\u52a1","title":"2. <code>submit(Runnable)</code> - \u63d0\u4ea4\u53ef\u83b7\u53d6\u72b6\u6001\u7684\u4efb\u52a1","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u8fd4\u56de<code>Future&lt;?&gt;</code>\u5bf9\u8c61</li> <li>\u53ef\u4ee5\u901a\u8fc7<code>Future.get()</code>\u5224\u65ad\u4efb\u52a1\u662f\u5426\u5b8c\u6210</li> <li>\u4efb\u52a1\u5f02\u5e38\u4f1a\u88ab\u5c01\u88c5\u5728<code>Future</code>\u4e2d</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u9700\u8981\u77e5\u9053\u4efb\u52a1\u662f\u5426\u6267\u884c\u5b8c\u6210</li> <li>\u4e0d\u9700\u8981\u8fd4\u56de\u7ed3\u679c\u4f46\u9700\u8981\u5f02\u5e38\u5904\u7406</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#3-submitcallable---\u63d0\u4ea4\u6709\u8fd4\u56de\u503c\u7684\u4efb\u52a1","title":"3. <code>submit(Callable&lt;T&gt;)</code> - \u63d0\u4ea4\u6709\u8fd4\u56de\u503c\u7684\u4efb\u52a1","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u63d0\u4ea4<code>Callable</code>\u4efb\u52a1</li> <li>\u8fd4\u56de<code>Future&lt;T&gt;</code>\u53ef\u83b7\u53d6\u8ba1\u7b97\u7ed3\u679c</li> <li>\u4efb\u52a1\u5f02\u5e38\u53ef\u901a\u8fc7<code>Future.get()</code>\u6355\u83b7</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u9700\u8981\u83b7\u53d6\u5f02\u6b65\u8ba1\u7b97\u7ed3\u679c</li> <li>\u5e76\u884c\u8ba1\u7b97\u3001\u8fdc\u7a0b\u8c03\u7528\u7b49</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#4-invokeall---\u6279\u91cf\u63d0\u4ea4\u5e76\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210","title":"4. <code>invokeAll()</code> - \u6279\u91cf\u63d0\u4ea4\u5e76\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u63d0\u4ea4<code>Callable</code>\u4efb\u52a1\u96c6\u5408</li> <li>\u8fd4\u56de<code>List&lt;Future&lt;T&gt;&gt;</code></li> <li>\u963b\u585e\u76f4\u5230\u6240\u6709\u4efb\u52a1\u5b8c\u6210</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u5e76\u884c\u5904\u7406\u591a\u4e2a\u4efb\u52a1\u5e76\u6536\u96c6\u6240\u6709\u7ed3\u679c</li> <li>\u5206\u5e03\u5f0f\u8ba1\u7b97\u805a\u5408</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#5-invokeany---\u63d0\u4ea4\u591a\u4e2a\u4efb\u52a1\u83b7\u53d6\u9996\u4e2a\u5b8c\u6210\u7ed3\u679c","title":"5. <code>invokeAny()</code> - \u63d0\u4ea4\u591a\u4e2a\u4efb\u52a1\u83b7\u53d6\u9996\u4e2a\u5b8c\u6210\u7ed3\u679c","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u63d0\u4ea4<code>Callable</code>\u4efb\u52a1\u96c6\u5408</li> <li>\u8fd4\u56de\u9996\u4e2a\u5b8c\u6210\u7684\u4efb\u52a1\u7ed3\u679c</li> <li>\u5176\u4ed6\u672a\u5b8c\u6210\u4efb\u52a1\u4f1a\u88ab\u53d6\u6d88</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u591a\u4e2a\u670d\u52a1\u63d0\u4f9b\u76f8\u540c\u529f\u80fd\u65f6\u83b7\u53d6\u6700\u5feb\u54cd\u5e94</li> <li>\u7ade\u901f\u67e5\u8be2\uff08\u5982\u591a\u6570\u636e\u6e90\u67e5\u8be2\uff09</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u5173\u95ed\u7ebf\u7a0b\u6c60","title":"\u5173\u95ed\u7ebf\u7a0b\u6c60","text":"\u65b9\u6cd5 \u8bf4\u660e \u884c\u4e3a\u7279\u70b9 <code>shutdown()</code> \u5e73\u7f13\u5173\u95ed \u505c\u6b62\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u5df2\u63d0\u4ea4\u4efb\u52a1\u7ee7\u7eed\u6267\u884c <code>shutdownNow()</code> \u7acb\u5373\u5173\u95ed \u5c1d\u8bd5\u505c\u6b62\u6240\u6709\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\uff0c\u8fd4\u56de\u672a\u6267\u884c\u4efb\u52a1\u5217\u8868 <code>awaitTermination()</code> \u7b49\u5f85\u7ec8\u6b62 \u4e3b\u7ebf\u7a0b\u963b\u585e\u76f4\u5230\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u6216\u8d85\u65f6"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u5de5\u4f5c\u7ebf\u7a0b\u6a21\u5f0f","title":"\u5de5\u4f5c\u7ebf\u7a0b\u6a21\u5f0f","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u5b9a\u4e49","title":"\u5b9a\u4e49","text":"<p>\u8ba9\u6709\u9650\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff08Worker Thread\uff09\u6765\u8f6e\u6d41\u5f02\u6b65\u5904\u7406\u65e0\u9650\u591a\u7684\u4efb\u52a1\u3002</p> <p>\u5de5\u4f5c\u7ebf\u7a0b\u6a21\u5f0f\uff08\u4e5f\u79f0\u4e3a\u7ebf\u7a0b\u6c60\u6a21\u5f0f\uff09\u662f\u4e00\u79cd\u5e76\u53d1\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5b83\u901a\u8fc7\u7ef4\u62a4\u4e00\u7ec4\u9884\u5148\u521b\u5efa\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u907f\u514d\u4e86\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\uff0c\u662fJava\u5e76\u53d1\u7f16\u7a0b\u7684\u6838\u5fc3\u6a21\u5f0f\u4e4b\u4e00\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u9965\u997f","title":"\u9965\u997f","text":"<p>\u7ebf\u7a0b\u9965\u997f\u662f\u6307\u67d0\u4e9b\u4efb\u52a1\u56e0\u957f\u671f\u65e0\u6cd5\u83b7\u53d6\u6267\u884c\u8d44\u6e90\u800c\u5ef6\u8fdf\u6267\u884c\u7684\u73b0\u8c61</p> <p>\u56fa\u5b9a\u7ebf\u7a0b\u6c60\u5927\u5c0f\u5bb9\u6613\u53d1\u751f</p> <ul> <li>\u5d4c\u5957\u63d0\u4ea4\u4efb\u52a1</li> <li>\u957f\u4efb\u52a1\u963b\u585e\u77ed\u4efb\u52a1</li> <li>\u4e0d\u516c\u5e73\u7684\u4efb\u52a1\u8c03\u5ea6</li> </ul> <p>Quote</p> <p>Link \u7236\u5b50\u4efb\u52a1\u4f7f\u7528\u540c\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u5bfc\u81f4\u7684\u95ee\u9898</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>ExecutorService executor = Executors.newFixedThreadPool(1); // \u5355\u7ebf\u7a0b\u6c60\n\nexecutor.execute(() -&gt; {\n    Future&lt;String&gt; future = executor.submit(() -&gt; \"result\"); // \u5d4c\u5957\u63d0\u4ea4\u4efb\u52a1\n    try {\n        future.get(); // \u963b\u585e\u7b49\u5f85\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n});\n</code></pre> <p></p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>\u907f\u514d\u5d4c\u5957\u63d0\u4ea4\uff0c\u4e0d\u540c\u7684\u4efb\u52a1\u4f7f\u7528\u4e0d\u540c\u7ebf\u7a0b\u6c60</p> <pre><code>// \u4f7f\u7528\u4e0d\u540c\u7684\u7ebf\u7a0b\u6c60\nExecutorService executor1 = Executors.newFixedThreadPool(1);\nExecutorService executor2 = Executors.newFixedThreadPool(1);\n\nexecutor1.execute(() -&gt; {\n    Future&lt;String&gt; future = executor2.submit(() -&gt; \"result\");\n    future.get(); // \u4e0d\u4f1a\u9965\u997f\n});\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u5408\u9002\u7684\u7ebf\u7a0b\u6c60\u5927\u5c0f","title":"\u5408\u9002\u7684\u7ebf\u7a0b\u6c60\u5927\u5c0f","text":"<p>CPU\u5bc6\u96c6\u578b\u4efb\u52a1</p> <ul> <li> <p>\u7279\u70b9\uff1a\u5927\u91cf\u8ba1\u7b97\uff0c\u5f88\u5c11I/O\u7b49\u5f85\uff08\u5982\u6570\u5b66\u8fd0\u7b97\u3001\u89c6\u9891\u7f16\u7801\uff09</p> </li> <li> <p>\u516c\u5f0f\uff1a</p> </li> </ul> <pre><code>\u7ebf\u7a0b\u6570 = CPU\u6838\u5fc3\u6570 + 1\n</code></pre> <p>+1\u662f\u4e3a\u4e86\u9632\u6b62\u7ebf\u7a0b\u610f\u5916\u6682\u505c\u65f6\u80fd\u5229\u7528\u7a7a\u95f2CPU</p> <p>I/O\u5bc6\u96c6\u578b\u4efb\u52a1</p> <ul> <li> <p>\u7279\u70b9\uff1a\u5927\u91cf\u7b49\u5f85\u65f6\u95f4\uff08\u5982\u6570\u636e\u5e93\u67e5\u8be2\u3001HTTP\u8bf7\u6c42\uff09</p> </li> <li> <p>\u516c\u5f0f\uff1a</p> </li> </ul> <pre><code>\u7ebf\u7a0b\u6570 = CPU\u6838\u5fc3\u6570 \u00d7 (1 + \u5e73\u5747\u7b49\u5f85\u65f6\u95f4/\u5e73\u5747\u8ba1\u7b97\u65f6\u95f4)\n</code></pre> <p>\u7ecf\u9a8c\u503c\u901a\u5e38\u4e3a\uff1a</p> <pre><code>\u7ebf\u7a0b\u6570 = CPU\u6838\u5fc3\u6570 \u00d7 2 ~ 5\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u4efb\u52a1\u8c03\u5ea6\u7ebf\u7a0b\u6c60","title":"\u4efb\u52a1\u8c03\u5ea6\u7ebf\u7a0b\u6c60","text":"<p>\u5728\u300e\u4efb\u52a1\u8c03\u5ea6\u7ebf\u7a0b\u6c60\u300f\u529f\u80fd\u52a0\u5165\u4e4b\u524d\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>java.util.Timer</code> \u6765\u5b9e\u73b0\u5b9a\u65f6\u529f\u80fd\uff0cTimer \u7684\u4f18\u70b9\u5728\u4e8e\u7b80\u5355\u6613\u7528\uff0c\u4f46\u7531\u4e8e\u6240\u6709\u4efb\u52a1\u90fd\u662f\u7531\u540c\u4e00\u4e2a\u7ebf\u7a0b\u6765\u8c03\u5ea6\uff0c\u56e0\u6b64\u6240\u6709\u4efb\u52a1\u90fd\u662f\u4e32\u884c\u6267\u884c\u7684\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u6709\u4e00\u4e2a\u4efb\u52a1\u5728\u6267\u884c\uff0c\u524d\u4e00\u4e2a\u4efb\u52a1\u7684\u5ef6\u8fdf\u6216\u5f02\u5e38\u90fd\u5c06\u4f1a\u5f71\u54cd\u5230\u4e4b\u540e\u7684\u4efb\u52a1\u3002</p> <pre><code>ScheduledExecutorService pool = Executors.newScheduledThreadPool(3);\n\n// \u5ef6\u65f6\u6267\u884c\nlog.info(\"task start\");\npool.schedule(() -&gt; {\n    log.info(\"running...\");\n}, 1000, TimeUnit.MILLISECONDS);\n\n// \u5b9a\u65f6\u6267\u884c\npool.scheduleAtFixedRate(() -&gt; {\n    log.info(\"running...\");\n},0, 1, TimeUnit.SECONDS);\n\n// \u4efb\u52a1\u7ed3\u675f\u540e\u624d\u5f00\u59cb\u8ba1\u7b97\u5ef6\u8fdf\u65f6\u95f4\npool.scheduleWithFixedDelay(() -&gt; {\n    log.info(\"running...\");\n},0, 1, TimeUnit.SECONDS);\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u7ebf\u7a0b\u6c60\u5f02\u5e38\u5904\u7406","title":"\u7ebf\u7a0b\u6c60\u5f02\u5e38\u5904\u7406","text":"<p>Info</p> <p>\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1\u9ed8\u8ba4\u4e0d\u5904\u7406\u5f02\u5e38\uff0c\u9700\u8981\u81ea\u5df1\u5904\u7406</p> <ul> <li>\u76f4\u63a5\u5728\u4efb\u52a1\u5185\u90e8 try-catch</li> </ul> <pre><code>executor.scheduleAtFixedRate(() -&gt; {\n    try {\n        // \u4e1a\u52a1\u4ee3\u7801\n        log.info(\"Running...\");\n    } catch (Exception e) {\n        log.error(\"Task failed\", e); // \u660e\u786e\u6355\u83b7\u5e76\u8bb0\u5f55\u5f02\u5e38\n    }\n}, 0, 1, TimeUnit.SECONDS);\n</code></pre> <ul> <li>\u901a\u8fc7 <code>Future</code> \u83b7\u53d6\u5f02\u5e38\uff08\u9002\u7528\u4e8e\u4e00\u6b21\u6027\u4efb\u52a1\uff09</li> </ul> <pre><code>Future&lt;?&gt; future = executor.submit(() -&gt; {\n    // \u53ef\u80fd\u629b\u51fa\u5f02\u5e38\u7684\u4efb\u52a1\n});\ntry {\n    future.get(); // \u4f1a\u629b\u51fa ExecutionException\uff08\u5305\u88c5\u5b9e\u9645\u5f02\u5e38\uff09\n} catch (ExecutionException e) {\n    Throwable realException = e.getCause(); // \u83b7\u53d6\u539f\u59cb\u5f02\u5e38\n    log.error(\"Task failed\", realException);\n}\n</code></pre> <ul> <li>\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\u7684 <code>UncaughtExceptionHandler</code></li> </ul> <pre><code>ThreadFactory factory = r -&gt; {\n    Thread thread = new Thread(r);\n    thread.setUncaughtExceptionHandler((t, e) -&gt; {\n        log.error(\"Thread {} crashed\", t.getName(), e);\n    });\n    return thread;\n};\n\nExecutorService executor = Executors.newScheduledThreadPool(2, factory);\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#tomcat\u7ebf\u7a0b\u6c60","title":"Tomcat\u7ebf\u7a0b\u6c60","text":"<ul> <li>LimitLatch \u7528\u6765\u9650\u6d41\uff0c\u53ef\u4ee5\u63a7\u5236\u6700\u5927\u8fde\u63a5\u4e2a\u6570\uff0c\u7c7b\u4f3c J.U.C \u4e2d\u7684 Semaphore </li> <li>Acceptor \u53ea\u8d1f\u8d23\u3010\u63a5\u6536\u65b0\u7684 socket \u8fde\u63a5\u3011 </li> <li>Poller \u53ea\u8d1f\u8d23\u76d1\u542c socket channel \u662f\u5426\u6709\u3010\u53ef\u8bfb\u7684 I/O \u4e8b\u4ef6\u3011 \u4e00\u65e6\u53ef\u8bfb\uff0c\u5c01\u88c5\u4e00\u4e2a\u4efb\u52a1\u5bf9\u8c61\uff08socketProcessor\uff09\uff0c\u63d0\u4ea4\u7ed9 Executor \u7ebf\u7a0b\u6c60\u5904\u7406 </li> <li>Executor \u7ebf\u7a0b\u6c60\u4e2d\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6700\u7ec8\u8d1f\u8d23\u3010\u5904\u7406\u8bf7\u6c42\u3011</li> </ul> <p>Connector \u914d\u7f6e</p> \u914d\u7f6e\u9879 \u9ed8\u8ba4\u503c \u8bf4\u660e acceptorThreadCount 1 acceptor \u7ebf\u7a0b\u6570\u91cf pollerThreadCount 1 poller \u7ebf\u7a0b\u6570\u91cf minSpareThreads 10 \u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u5373 corePoolSize maxThreads 200 \u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5373 maximumPoolSize executor - Executor \u540d\u79f0\uff0c\u7528\u6765\u5f15\u7528\u4e0b\u9762\u7684 Executor <p>Executor \u7ebf\u7a0b\u914d\u7f6e</p> \u914d\u7f6e\u9879 \u9ed8\u8ba4\u503c \u8bf4\u660e threadPriority 5 \u7ebf\u7a0b\u4f18\u5148\u7ea7 daemon true \u662f\u5426\u5b88\u62a4\u7ebf\u7a0b minSpareThreads 25 \u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u5373 corePoolSize maxThreads 200 \u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5373 maximumPoolSize maxIdleTime 60000 \u7ebf\u7a0b\u751f\u5b58\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u9ed8\u8ba4\u503c\u5373 1 \u5206\u949f maxQueueSize Integer.MAX_VALUE \u961f\u5217\u957f\u5ea6 prestartminSpareThreads false \u6838\u5fc3\u7ebf\u7a0b\u662f\u5426\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u542f\u52a8 <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#forkjoin\u7ebf\u7a0b\u6c60","title":"ForkJoin\u7ebf\u7a0b\u6c60","text":"<p>Fork/Join \u662f JDK 1.7 \u52a0\u5165\u7684\u65b0\u7684\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u5b83\u4f53\u73b0\u7684\u662f\u4e00\u79cd\u5206\u6cbb\u601d\u60f3\uff0c\u9002\u7528\u4e8e\u80fd\u591f\u8fdb\u884c\u4efb\u52a1\u62c6\u5206\u7684 cpu \u5bc6\u96c6\u578b\u8fd0\u7b97 </p> <p>\u6240\u8c13\u7684\u4efb\u52a1\u62c6\u5206\uff0c\u662f\u5c06\u4e00\u4e2a\u5927\u4efb\u52a1\u62c6\u5206\u4e3a\u7b97\u6cd5\u4e0a\u76f8\u540c\u7684\u5c0f\u4efb\u52a1\uff0c\u76f4\u81f3\u4e0d\u80fd\u62c6\u5206\u53ef\u4ee5\u76f4\u63a5\u6c42\u89e3\u3002\u8ddf\u9012\u5f52\u76f8\u5173\u7684\u4e00\u4e9b\u8ba1 \u7b97\uff0c\u5982\u5f52\u5e76\u6392\u5e8f\u3001\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3001\u90fd\u53ef\u4ee5\u7528\u5206\u6cbb\u601d\u60f3\u8fdb\u884c\u6c42\u89e3 </p> <p>Fork/Join \u5728\u5206\u6cbb\u7684\u57fa\u7840\u4e0a\u52a0\u5165\u4e86\u591a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u628a\u6bcf\u4e2a\u4efb\u52a1\u7684\u5206\u89e3\u548c\u5408\u5e76\u4ea4\u7ed9\u4e0d\u540c\u7684\u7ebf\u7a0b\u6765\u5b8c\u6210\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u8fd0\u7b97\u6548\u7387 </p> <p>Fork/Join \u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e0e cpu \u6838\u5fc3\u6570\u5927\u5c0f\u76f8\u540c\u7684\u7ebf\u7a0b\u6c60</p> <pre><code>// \u521b\u5efaForkJoinPool\u7ebf\u7a0b\u6c60\nForkJoinPool pool = new ForkJoinPool();\n// \u63d0\u4ea4AddTask\u4efb\u52a1\u5230\u7ebf\u7a0b\u6c60\uff0cn\u521d\u59cb\u503c\u4e3a10\nForkJoinTask&lt;Integer&gt; submit = pool.submit(new AddTask(10));\n// \u83b7\u53d6\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u5e76\u6253\u5370\nlog.debug(\"submit() {}\", submit.get());\n\n\n@Slf4j\n// AddTask\u7ee7\u627fRecursiveTask&lt;Integer&gt;\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u9012\u5f52\u5206\u89e3\u7684\u4efb\u52a1\uff0c\u8fd4\u56deInteger\u7c7b\u578b\u7ed3\u679c\nclass AddTask extends RecursiveTask&lt;Integer&gt; {\n    int n;  // \u4efb\u52a1\u5904\u7406\u7684\u6570\u503c\n\n    public AddTask(int n) {\n        this.n = n;\n    }\n\n    @Override\n    public String toString() {\n        return \"{\" + n + '}';  // \u65b9\u4fbf\u6253\u5370\u4efb\u52a1\u4fe1\u606f\n    }\n\n    @Override\n    protected Integer compute() {\n        // \u57fa\u51c6\u6761\u4ef6\uff1a\u5982\u679cn\u5df2\u7ecf\u4e3a1\uff0c\u76f4\u63a5\u8fd4\u56de1\n        if (n == 1) {\n            log.debug(\"join() {}\", n);\n            return n;\n        }\n        // \u9012\u5f52\u6761\u4ef6\uff1a\u5c06\u4efb\u52a1\u62c6\u5206\u4e3a\u66f4\u5c0f\u7684\u5b50\u4efb\u52a1\n        AddTask t1 = new AddTask(n - 1);  // \u521b\u5efa\u5904\u7406n-1\u7684\u5b50\u4efb\u52a1\n        t1.fork();  // \u5f02\u6b65\u6267\u884c\u5b50\u4efb\u52a1\n        log.debug(\"fork() {} + {}\", n, t1);\n        // \u5408\u5e76\u5b50\u4efb\u52a1\u7684\u7ed3\u679c\uff1a\u5f53\u524dn\u7684\u503c\u52a0\u4e0a\u5b50\u4efb\u52a1\u7684\u7ed3\u679c\n        int result = n + t1.join();  // \u7b49\u5f85\u5b50\u4efb\u52a1\u5b8c\u6210\u5e76\u83b7\u53d6\u7ed3\u679c\n        log.debug(\"join() {} + {} = {}\", n, t1, result);\n        return result;\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#juc","title":"JUC","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#aqs\u539f\u7406","title":"AQS\u539f\u7406","text":"<p>\u5168\u79f0 AbstractQueuedSynchronizer\uff0c\u662f\u963b\u585e\u5f0f\u9501\u548c\u76f8\u5173\u7684\u540c\u6b65\u5668\u5de5\u5177\u7684\u6846\u67b6</p> <p>\u7279\u70b9\uff1a </p> <ul> <li>\u7528 state \u5c5e\u6027\u6765\u8868\u793a\u8d44\u6e90\u7684\u72b6\u6001\uff08\u5206\u72ec\u5360\u6a21\u5f0f\u548c\u5171\u4eab\u6a21\u5f0f\uff09\uff0c\u5b50\u7c7b\u9700\u8981\u5b9a\u4e49\u5982\u4f55\u7ef4\u62a4\u8fd9\u4e2a\u72b6\u6001\uff0c\u63a7\u5236\u5982\u4f55\u83b7\u53d6 \u9501\u548c\u91ca\u653e\u9501 <ul> <li>getState - \u83b7\u53d6 state \u72b6\u6001</li> <li>setState - \u8bbe\u7f6e state \u72b6\u6001</li> <li>compareAndSetState - cas \u673a\u5236\u8bbe\u7f6e state \u72b6\u6001</li> <li>\u72ec\u5360\u6a21\u5f0f\u662f\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u591f\u8bbf\u95ee\u8d44\u6e90\uff0c\u800c\u5171\u4eab\u6a21\u5f0f\u53ef\u4ee5\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u8d44\u6e90</li> </ul> </li> <li>\u63d0\u4f9b\u4e86\u57fa\u4e8e FIFO \u7684\u7b49\u5f85\u961f\u5217\uff0c\u7c7b\u4f3c\u4e8e Monitor \u7684 EntryList </li> <li>\u6761\u4ef6\u53d8\u91cf\u6765\u5b9e\u73b0\u7b49\u5f85\u3001\u5524\u9192\u673a\u5236\uff0c\u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53d8\u91cf\uff0c\u7c7b\u4f3c\u4e8e Monitor \u7684 WaitSet</li> </ul> <p>\u5b50\u7c7b\u4e3b\u8981\u5b9e\u73b0\u5982\u4e0b\u65b9\u6cd5\uff08\u9ed8\u8ba4\u629b\u51fa UnsupportedOperationException\uff09 </p> <ul> <li><code>tryAcquire</code></li> <li><code>tryRelease</code> </li> <li><code>tryAcquireShared</code> </li> <li><code>tryReleaseShared</code></li> <li><code>isHeldExclusively</code></li> </ul> <p>\u81ea\u5b9a\u4e49\u9501demo</p> <pre><code>class MyLock implements Lock {\n\n    // \u540c\u6b65\u5668\u7c7b\n    static class MySync extends AbstractQueuedSynchronizer {\n        @Override\n        protected boolean tryAcquire(int arg) {\n            if (compareAndSetState(arg, arg + 1)) {\n                // \u83b7\u53d6\u9501\u6210\u529f\uff0c\u8bbe\u7f6e\u72ec\u5360\u7ebf\u7a0b\n                setExclusiveOwnerThread(Thread.currentThread());\n                return true;\n            }\n            return false;\n        }\n\n        @Override\n        protected boolean tryRelease(int arg) {\n            // \u91ca\u653e\u9501\uff0c\u5c06\u72b6\u6001\u8bbe\u7f6e\u4e3a0\uff0c\u5e76\u5c06\u72ec\u5360\u7ebf\u7a0b\u8bbe\u7f6e\u4e3anull\n            setExclusiveOwnerThread(null);\n            setState(arg - 1); // volatile \u53d8\u91cf\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u95f4\u53ef\u89c1\u6027\n            return true;\n        }\n\n        @Override\n        protected boolean isHeldExclusively() {\n            return getState() == 1;\n        }\n\n        public Condition newCondition() {\n            return new ConditionObject();\n        }\n    }\n\n    private final MySync sync = new MySync();\n\n    private volatile int state = 0;\n\n\n    // \u52a0\u9501\n    @Override\n    public void lock() {\n        sync.acquire(state);\n    }\n\n    // \u53ef\u6253\u65ad\u52a0\u9501\n    @Override\n    public void lockInterruptibly() throws InterruptedException {\n        sync.acquireInterruptibly(state);\n    }\n\n    @Override\n    public boolean tryLock() {\n        return sync.tryAcquire(state);\n    }\n\n    // \u5e26\u8d85\u65f6\u52a0\u9501\n    @Override\n    public boolean tryLock(long time, TimeUnit unit) throws InterruptedException {\n        return sync.tryAcquireNanos(state, unit.toNanos(time));\n    }\n\n    // \u89e3\u9501\n    @Override\n    public void unlock() {\n        sync.release(state);\n    }\n\n    // \u6761\u4ef6\u53d8\u91cf\n    @Override\n    public Condition newCondition() {\n        return sync.newCondition();\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u8bfb\u5199\u9501","title":"\u8bfb\u5199\u9501","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#reentrantreadwritelock","title":"ReentrantReadWriteLock","text":"<p>\u5f53\u8bfb\u64cd\u4f5c\u8fdc\u8fdc\u9ad8\u4e8e\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u65f6\u5019\u4f7f\u7528\u8bfb\u5199\u9501\u8ba9 \u8bfb-\u8bfb \u53ef\u4ee5\u5e76\u53d1\uff0c\u63d0\u9ad8\u6027\u80fd\uff0c\u8fd9\u79cd\u9501\u673a\u5236\u9002\u7528\u4e8e\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd\u3002</p> <pre><code>class DataContainer {\n    Object data = new Object();\n    private final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();\n    private final ReentrantReadWriteLock.ReadLock readLock = lock.readLock();\n    private final ReentrantReadWriteLock.WriteLock writeLock = lock.writeLock();\n\n    public Object read() throws InterruptedException {\n        log.info(\"\u5c1d\u8bd5\u83b7\u53d6\u8bfb\u53d6\u9501\");\n        readLock.lock();\n        try {\n            log.info(\"\u83b7\u53d6\u8bfb\u9501\u6210\u529f\");\n            Thread.sleep(1000);\n            return data;\n        } finally {\n            log.info(\"\u91ca\u653e\u8bfb\u9501\");\n            readLock.unlock();\n        }\n    }\n\n    public void write(Object data) {\n        log.info(\"\u5c1d\u8bd5\u83b7\u53d6\u5199\u9501\");\n        writeLock.lock();\n        try {\n            log.info(\"\u83b7\u53d6\u5199\u9501\u6210\u529f\");\n            this.data = data;\n        } finally {\n            log.info(\"\u91ca\u653e\u5199\u9501\");\n            writeLock.unlock();\n        }\n    }\n}\n</code></pre> <p>Info</p> <ul> <li>\u8bfb\u9501\u4e0d\u652f\u6301\u6761\u4ef6\u53d8\u91cf</li> <li>\u91cd\u5165\u65f6\u5347\u7ea7\u4e0d\u652f\u6301\uff1a\u5373\u6301\u6709\u8bfb\u9501\u7684\u60c5\u51b5\u4e0b\u53bb\u83b7\u53d6\u5199\u9501\uff0c\u4f1a\u5bfc\u81f4\u83b7\u53d6\u5199\u9501\u6c38\u4e45\u7b49\u5f85</li> <li>\u91cd\u5165\u65f6\u964d\u7ea7\u652f\u6301\uff1a\u5373\u6301\u6709\u5199\u9501\u7684\u60c5\u51b5\u4e0b\u53bb\u83b7\u53d6\u8bfb\u9501</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#stampedlock","title":"StampedLock","text":"<p>\u5b83\u662f\u4e00\u79cd\u6539\u8fdb\u7684\u8bfb\u5199\u9501\uff0c\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u66f4\u7075\u6d3b\u7684\u529f\u80fd\uff0c\u5c24\u5176\u662f\u5728\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u4e0b\uff0c\u6027\u80fd\u4f18\u4e8e <code>ReentrantReadWriteLock</code>\u3002</p> <p>\u5e94\u7528\u573a\u666f</p> <pre><code>- \u9ad8\u5e76\u53d1\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002\n- \u5bf9\u6027\u80fd\u8981\u6c42\u8f83\u9ad8\u7684\u573a\u666f\u3002\n- \u9700\u8981\u4e50\u89c2\u8bfb\u9501\u7684\u573a\u666f\u3002\n</code></pre> <pre><code>public class StampedLockExample {\n    private final StampedLock stampedLock = new StampedLock();\n    private int sharedData = 0;\n\n    public void writeData(int data) {\n        long stamp = stampedLock.writeLock(); // \u83b7\u53d6\u5199\u9501\n        try {\n            sharedData = data;\n            System.out.println(\"Write data: \" + sharedData);\n        } finally {\n            stampedLock.unlockWrite(stamp); // \u91ca\u653e\u5199\u9501\n        }\n}\n\n\npublic void readData() {\n    long stamp = stampedLock.readLock(); // \u83b7\u53d6\u60b2\u89c2\u8bfb\u9501\n    try {\n        System.out.println(\"Read data: \" + sharedData);\n    } finally {\n        stampedLock.unlockRead(stamp); // \u91ca\u653e\u8bfb\u9501\n    }\n}\n\npublic void optimisticReadData() {\n    long stamp = stampedLock.tryOptimisticRead(); // \u5c1d\u8bd5\u83b7\u53d6\u4e50\u89c2\u8bfb\u9501\n    int data = sharedData; // \u8bfb\u53d6\u6570\u636e\n    if (!stampedLock.validate(stamp)) { // \u9a8c\u8bc1\u4e50\u89c2\u8bfb\u9501\u662f\u5426\u6709\u6548\n        stamp = stampedLock.readLock(); // \u5982\u679c\u65e0\u6548\uff0c\u964d\u7ea7\u4e3a\u60b2\u89c2\u8bfb\u9501\n        try {\n            data = sharedData; // \u518d\u6b21\u8bfb\u53d6\u6570\u636e\n        } finally {\n            stampedLock.unlockRead(stamp); // \u91ca\u653e\u60b2\u89c2\u8bfb\u9501\n        }\n    }\n    System.out.println(\"Optimistic read data: \" + data);\n}\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879</p> <ol> <li>\u4e0d\u53ef\u91cd\u5165\uff1a<code>StampedLock</code> \u662f\u4e0d\u53ef\u91cd\u5165\u7684\uff0c\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5982\u679c\u591a\u6b21\u83b7\u53d6\u9501\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6b7b\u9501\u3002</li> <li>\u9501\u7684\u91ca\u653e\uff1a\u5fc5\u987b\u901a\u8fc7 <code>unlockRead</code> \u6216 <code>unlockWrite</code> \u65b9\u6cd5\u91ca\u653e\u9501\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6b7b\u9501\u3002</li> <li>\u4e50\u89c2\u8bfb\u9501\u7684\u9a8c\u8bc1\uff1a\u4f7f\u7528\u4e50\u89c2\u8bfb\u9501\u65f6\uff0c\u5fc5\u987b\u901a\u8fc7 <code>validate</code> \u65b9\u6cd5\u9a8c\u8bc1\u9501\u7684\u6709\u6548\u6027\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002</li> <li>\u9501\u7684\u8f6c\u6362\uff1a\u9501\u7684\u8f6c\u6362\u9700\u8981\u5c0f\u5fc3\u5904\u7406\uff0c\u907f\u514d\u6b7b\u9501\u6216\u8d44\u6e90\u6cc4\u6f0f\u3002</li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#semaphore","title":"Semaphore","text":"<p><code>Semaphore</code>\uff08\u4fe1\u53f7\u91cf\uff09\u662f Java \u5e76\u53d1\u5305 (<code>java.util.concurrent</code>) \u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u5de5\u5177\u7c7b\uff0c\u7528\u4e8e\u63a7\u5236\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u5e76\u53d1\u8bbf\u95ee\u6570\u91cf\u3002\u5b83\u57fa\u4e8e\u7ecf\u5178\u7684 Dijkstra \u4fe1\u53f7\u91cf\u6982\u5ff5\u5b9e\u73b0\uff0c\u662f\u4e00\u79cd\u8ba1\u6570\u4fe1\u53f7\u91cf\u3002</p> <p>\u6838\u5fc3\u65b9\u6cd5</p> <pre><code>Semaphore(int permits)  // \u521b\u5efa\u975e\u516c\u5e73\u4fe1\u53f7\u91cf\nSemaphore(int permits, boolean fair)  // \u521b\u5efa\u516c\u5e73/\u975e\u516c\u5e73\u4fe1\u53f7\u91cf\n\nvoid acquire()  // \u83b7\u53d61\u4e2a\u8bb8\u53ef\u8bc1\uff0c\u963b\u585e\u76f4\u5230\u83b7\u53d6\u6210\u529f\nvoid acquire(int permits)  // \u83b7\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u8bb8\u53ef\u8bc1\nvoid release()  // \u91ca\u653e1\u4e2a\u8bb8\u53ef\u8bc1\nvoid release(int permits)  // \u91ca\u653e\u6307\u5b9a\u6570\u91cf\u7684\u8bb8\u53ef\u8bc1\n\nboolean tryAcquire()  // \u5c1d\u8bd5\u83b7\u53d61\u4e2a\u8bb8\u53ef\u8bc1\uff0c\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\nboolean tryAcquire(long timeout, TimeUnit unit)  // \u8d85\u65f6\u5c1d\u8bd5\u83b7\u53d6\nboolean tryAcquire(int permits)  // \u5c1d\u8bd5\u83b7\u53d6\u591a\u4e2a\u8bb8\u53ef\u8bc1\nint availablePermits()  // \u8fd4\u56de\u5f53\u524d\u53ef\u7528\u8bb8\u53ef\u8bc1\u6570\u91cf\nvoid drainPermits()  // \u83b7\u53d6\u5e76\u8fd4\u56de\u6240\u6709\u7acb\u5373\u53ef\u7528\u7684\u8bb8\u53ef\u8bc1\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>// \u521b\u5efa\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u521d\u59cb\u503c\u4e3a3\nSemaphore semaphore = new Semaphore(3);\nfor (int i = 0; i &lt; 10; i++) {\n    new Thread(() -&gt; {\n        try {\n            semaphore.acquire();\n            log.info(\"\u6210\u529f\u83b7\u5f97\u4fe1\u53f7\u91cf\");\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        } finally {\n            semaphore.release();\n        }\n    }).start();\n}\n</code></pre> <p>\u5e94\u7528\u573a\u666f</p> <ol> <li>\u8d44\u6e90\u6c60\u7ba1\u7406\uff08\u5982\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff09</li> <li>\u9650\u6d41\u63a7\u5236\uff08\u9650\u5236\u5e76\u53d1\u8bf7\u6c42\u6570\uff09\uff0c\u4ec5\u9650\u5355\u673a\u6a21\u5f0f</li> </ol> <p>\u539f\u7406\uff1a\u8ba1\u6570\u5668\u9650\u5236\u8d44\u6e90\u8bbf\u95ee\u6570</p> <p></p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#countdownlatch","title":"CountDownLatch","text":"<p><code>CountDownLatch</code> \u662f Java \u5e76\u53d1\u7f16\u7a0b\u4e2d\u7b80\u5355\u9ad8\u6548\u7684\u540c\u6b65\u5de5\u5177\uff0c\u7279\u522b\u9002\u5408\"\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u591a\u4e2a\u5b50\u7ebf\u7a0b\u5b8c\u6210\"\u7684\u573a\u666f\u3002</p> <p>\u6838\u5fc3\u65b9\u6cd5</p> <pre><code>CountDownLatch(int count)  // \u521d\u59cb\u5316\u8ba1\u6570\u5668\u503c\n\nvoid await()  // \u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u76f4\u5230\u8ba1\u6570\u5668\u5f52\u96f6\nboolean await(long timeout, TimeUnit unit)  // \u5e26\u8d85\u65f6\u7684\u7b49\u5f85\nvoid countDown()  // \u8ba1\u6570\u5668\u51cf1\nlong getCount()  // \u83b7\u53d6\u5f53\u524d\u8ba1\u6570\u503c\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u4e0d\u53ef\u91cd\u7f6e\uff1a\u8ba1\u6570\u5668\u5f52\u96f6\u540e\u65e0\u6cd5\u91cd\u590d\u4f7f\u7528</li> <li>\u7b49\u5f85\u673a\u5236\uff1a\u652f\u6301\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u540c\u4e00\u4e2a\u4e8b\u4ef6</li> <li>\u8ba1\u6570\u9012\u51cf\uff1a\u53ea\u80fd\u51cf\u5c11\u8ba1\u6570\uff0c\u4e0d\u80fd\u589e\u52a0</li> <li>\u7ebf\u7a0b\u534f\u4f5c\uff1a\u534f\u8c03\u591a\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u987a\u5e8f</li> </ul> <p>\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u7ed3\u675f</p> <pre><code>        CountDownLatch latch = new CountDownLatch(10);\n\n        for (int i = 0; i &lt; 10; i++) {\n            new Thread(() -&gt; {\n                System.out.println(Thread.currentThread().getName() + \" is running\");\n                try {\n                    latch.countDown();\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }).start();\n        }\n        latch.await();\n</code></pre> <p>Tip</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528join()\u6765\u5b9e\u73b0\uff0c\u4e0d\u8fc7CountDownLatch\u662f\u5c01\u88c5\u8fc7\u7684API\uff0c\u4f7f\u7528\u66f4\u65b9\u4fbf</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#cyclicbarrier","title":"CyclicBarrier","text":"<ul> <li>\u5faa\u73af\u5c4f\u969c\uff1a\u53ef\u91cd\u590d\u4f7f\u7528\u7684\u540c\u6b65\u5c4f\u969c</li> <li>\u6838\u5fc3\u601d\u60f3\uff1a\u4e00\u7ec4\u7ebf\u7a0b\u76f8\u4e92\u7b49\u5f85\uff0c\u76f4\u5230\u6240\u6709\u7ebf\u7a0b\u90fd\u5230\u8fbe\u5c4f\u969c\u70b9</li> <li>\u53ef\u91cd\u7528\u6027\uff1a\u4e0e <code>CountDownLatch</code> \u4e0d\u540c\uff0c<code>CyclicBarrier</code> \u53ef\u91cd\u590d\u4f7f\u7528\uff08\u5c4f\u969c\u88ab\u89e6\u53d1\u540e\u81ea\u52a8\u91cd\u7f6e\uff0c\u53ef\u518d\u6b21\u4f7f\u7528\uff09</li> <li>\u53ef\u9009\u56de\u8c03\uff1a\u53ef\u4ee5\u8bbe\u7f6e\u5c4f\u969c\u89e6\u53d1\u65f6\u7684\u56de\u8c03\u52a8\u4f5c\uff08\u7531\u6700\u540e\u4e00\u4e2a\u5230\u8fbe\u5c4f\u969c\u7684\u7ebf\u7a0b\u6267\u884c\uff09</li> </ul> <p>\u5e94\u7528\u573a\u666f\uff1a 1. \u591a\u7ebf\u7a0b\u8ba1\u7b97\u4efb\u52a1\u7684\u5206\u6bb5\u5904\u7406 2. \u9700\u8981\u591a\u7ebf\u7a0b\u534f\u4f5c\u5b8c\u6210\u67d0\u4e2a\u9636\u6bb5\u6027\u4efb\u52a1 3. \u9700\u8981\u5728\u591a\u4e2a\u7ebf\u7a0b\u95f4\u8fdb\u884c\u9636\u6bb5\u6027\u540c\u6b65\u7684\u573a\u666f</p> <p>\u6838\u5fc3\u65b9\u6cd5</p> <pre><code>CyclicBarrier(int parties)  // \u521b\u5efa\u5c4f\u969c\uff0c\u6307\u5b9a\u53c2\u4e0e\u7ebf\u7a0b\u6570\nCyclicBarrier(int parties, Runnable barrierAction)  // \u521b\u5efa\u5e26\u56de\u8c03\u7684\u5c4f\u969c\n\nint await()  // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5230\u8fbe\u5c4f\u969c\nint await(long timeout, TimeUnit unit)  // \u5e26\u8d85\u65f6\u7684\u7b49\u5f85\nvoid reset()  // \u91cd\u7f6e\u5c4f\u969c\nint getParties()  // \u83b7\u53d6\u53c2\u4e0e\u7ebf\u7a0b\u6570\nint getNumberWaiting()  // \u83b7\u53d6\u5f53\u524d\u7b49\u5f85\u7684\u7ebf\u7a0b\u6570\nboolean isBroken()  // \u68c0\u67e5\u5c4f\u969c\u662f\u5426\u88ab\u7834\u574f\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>public class CyclicBarrierDemo {\n    private static final int THREAD_COUNT = 3;\n    private static final CyclicBarrier barrier = new CyclicBarrier(THREAD_COUNT, \n        () -&gt; System.out.println(\"\u6240\u6709\u7ebf\u7a0b\u5df2\u5230\u8fbe\u5c4f\u969c\uff0c\u7ee7\u7eed\u6267\u884c\"));\n\n    public static void main(String[] args) {\n        ExecutorService executor = Executors.newFixedThreadPool(THREAD_COUNT);\n\n        for (int i = 0; i &lt; THREAD_COUNT; i++) {\n            final int threadNum = i;\n            executor.execute(() -&gt; {\n                try {\n                    System.out.println(\"\u7ebf\u7a0b\" + threadNum + \"\u5f00\u59cb\u5de5\u4f5c\");\n                    Thread.sleep((long) (Math.random() * 2000)); // \u6a21\u62df\u5de5\u4f5c\u8017\u65f6\n                    System.out.println(\"\u7ebf\u7a0b\" + threadNum + \"\u5230\u8fbe\u5c4f\u969c\uff0c\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\");\n                    barrier.await();\n                    System.out.println(\"\u7ebf\u7a0b\" + threadNum + \"\u7ee7\u7eed\u6267\u884c\");\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n        executor.shutdown();\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u7c7b","title":"\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u7c7b","text":"<p>\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u7c7b\u53ef\u4ee5\u5206\u4e3a\u4e09\u5927\u7c7b\uff1a </p> <ul> <li>\u9057\u7559\u7684\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u5982  <code>Hashtable</code> \uff0c <code>Vector</code></li> <li>\u4f7f\u7528 Collections \u88c5\u9970\u7684\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408:<ul> <li><code>Collections.synchronizedCollection</code></li> <li><code>Collections.synchronizedList</code></li> <li><code>Collections.synchronizedMap</code></li> <li><code>Collections.synchronizedSet</code></li> <li><code>Collections.synchronizedNavigableMap</code></li> <li><code>Collections.synchronizedNavigableSet</code></li> <li><code>Collections.synchronizedSortedMap</code></li> <li><code>Collections.synchronizedSortedSet</code></li> </ul> </li> <li><code>java.util.concurrent.*</code></li> </ul> <p><code>java.util.concurrent.*</code> \u4e0b\u7684\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u7c7b\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u4eec\u6709\u89c4\u5f8b\uff0c\u91cc\u9762\u5305\u542b\u4e09\u7c7b\u5173\u952e\u8bcd\uff1a Blocking\u3001CopyOnWrite\u3001Concurrent</p> <ul> <li>Blocking \u5927\u90e8\u5206\u5b9e\u73b0\u57fa\u4e8e\u9501\uff0c\u5e76\u63d0\u4f9b\u7528\u6765\u963b\u585e\u7684\u65b9\u6cd5 </li> <li>CopyOnWrite \u7c7b\u578b\u5bb9\u5668\u4fee\u6539\u5f00\u9500\u76f8\u5bf9\u8f83\u91cd </li> <li>Concurrent \u7c7b\u578b\u7684\u5bb9\u5668<ul> <li>\u5185\u90e8\u5f88\u591a\u64cd\u4f5c\u4f7f\u7528 CAS \u4f18\u5316\uff0c\u4e00\u822c\u53ef\u4ee5\u63d0\u4f9b\u8f83\u9ad8\u541e\u5410\u91cf </li> <li>\u5f31\u4e00\u81f4\u6027<ul> <li>\u904d\u5386\u65f6\u5f31\u4e00\u81f4\u6027\uff0c\u4f8b\u5982\uff0c\u5f53\u5229\u7528\u8fed\u4ee3\u5668\u904d\u5386\u65f6\uff0c\u5982\u679c\u5bb9\u5668\u53d1\u751f\u4fee\u6539\uff0c\u8fed\u4ee3\u5668\u4ecd\u7136\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c\u904d\u5386\uff0c\u8fd9\u65f6\u5185\u5bb9\u662f\u65e7\u7684</li> <li>\u6c42\u5927\u5c0f\u5f31\u4e00\u81f4\u6027\uff0csize \u64cd\u4f5c\u672a\u5fc5\u662f 100% \u51c6\u786e </li> <li>\u8bfb\u53d6\u5f31\u4e00\u81f4\u6027</li> </ul> </li> </ul> </li> </ul> <p>\u5feb\u901f\u5931\u8d25\u673a\u5236</p> <p>\u904d\u5386\u65f6\u5982\u679c\u53d1\u751f\u4e86\u4fee\u6539\uff0c\u5bf9\u4e8e\u975e\u5b89\u5168\u5bb9\u5668\u6765\u8bb2\uff0c\u4f7f\u7528 fail-fast \u673a\u5236\u4e5f\u5c31\u662f\u8ba9\u904d\u5386\u7acb\u523b\u5931\u8d25\uff0c\u629b\u51fa <code>ConcurrentModificationException</code>\uff0c\u4e0d\u518d\u7ee7\u7eed\u904d\u5386</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#concurrenthashmap","title":"ConcurrentHashMap","text":"<p>\u7ebf\u7a0b\u5b89\u5168\u7684\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u4e13\u4e3a\u9ad8\u5e76\u53d1\u573a\u666f\u8bbe\u8ba1\uff0c\u6bd4 <code>Hashtable</code> \u548c <code>Collections.synchronizedMap()</code> \u6709\u66f4\u597d\u7684\u5e76\u53d1\u6027\u80fd\u3002</p> <p>\u57fa\u672c\u64cd\u4f5c</p> <pre><code>V put(K key, V value)  // \u63d2\u5165\u952e\u503c\u5bf9\nV get(Object key)      // \u83b7\u53d6\u503c\nV remove(Object key)   // \u5220\u9664\u952e\u503c\u5bf9\nboolean containsKey(Object key) // \u68c0\u67e5\u952e\u662f\u5426\u5b58\u5728\n\nV putIfAbsent(K key, V value)  // \u4e0d\u5b58\u5728\u5219\u63d2\u5165\nboolean remove(Object key, Object value) // \u5339\u914d\u5219\u5220\u9664\nV replace(K key, V value)      // \u66ff\u6362\u503c\n\nvoid forEach(BiConsumer&lt;? super K, ? super V&gt; action) // \u5e76\u884c\u904d\u5386\nV reduce(long parallelismThreshold, BiFunction&lt;? super K, ? super V, ? extends U&gt; transformer, BiFunction&lt;? super U, ? super U, ? extends U&gt; reducer) // MapReduce\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u5e76\u53d1\u6b7b\u94fe","title":"\u5e76\u53d1\u6b7b\u94fe","text":"<p>\u5728 JDK 1.7 \u7248\u672c\u7684 <code>HashMap</code> \u5b9e\u73b0\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u53ef\u80fd\u5bfc\u81f4\u5e76\u53d1\u6b7b\u94fe(dead chain)\u7684\u95ee\u9898\uff0c\u8fd9\u662f\u5728\u7279\u5b9a\u5e76\u53d1\u64cd\u4f5c\u573a\u666f\u4e0b\u53ef\u80fd\u53d1\u751f\u7684\u4e25\u91cd\u95ee\u9898\u3002</p> <p>\u89e6\u53d1\u6761\u4ef6\uff1a\u591a\u7ebf\u7a0b\u5e76\u53d1\u6269\u5bb9\u65f6\u53ef\u80fd\u5f62\u6210\u73af\u5f62\u94fe\u8868</p> <p>JDK 1.7 \u7684\u6269\u5bb9\u91c7\u7528\u5934\u63d2\u6cd5\u8fc1\u79fb\u6570\u636e</p> <pre><code>void transfer(Entry[] newTable) {\n    for (Entry&lt;K,V&gt; e : table) {\n        while (e != null) {\n            Entry&lt;K,V&gt; next = e.next;  // \u8bb0\u5f55\u4e0b\u4e00\u4e2a\u8282\u70b9\n            int i = indexFor(e.hash, newTable.length);\n            e.next = newTable[i];     // \u5934\u63d2\u6cd5\uff1a\u5c06\u5f53\u524d\u8282\u70b9\u6307\u5411\u6876\u5934\n            newTable[i] = e;          // \u66f4\u65b0\u6876\u5934\u4e3a\u5f53\u524d\u8282\u70b9\n            e = next;                 // \u5904\u7406\u4e0b\u4e00\u4e2a\u8282\u70b9\n        }\n    }\n}\n</code></pre> <p>\u5047\u8bbe\u521d\u59cb\u94fe\u8868\uff1a<code>A \u2192 B \u2192 null</code> \u4e24\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u6269\u5bb9\u65f6\u53ef\u80fd\u4ea7\u751f\u4ee5\u4e0b\u65f6\u5e8f\uff1a</p> \u64cd\u4f5c\u6b65\u9aa4 \u7ebf\u7a0b1\uff08\u88ab\u6302\u8d77\uff09 \u7ebf\u7a0b2\uff08\u5b8c\u6574\u6267\u884c\uff09 \u94fe\u8868\u72b6\u6001\u53d8\u5316 \u5f00\u59cb\u6269\u5bb9 \u8bfb\u53d6 <code>e = A</code>, <code>next = B</code> A \u2192 B \u2192 null \u7ebf\u7a0b1\u6302\u8d77 \u6682\u505c\u6267\u884c\uff08\u6301\u6709 <code>e=A</code>, <code>next=B</code>\uff09 \u5f00\u59cb\u6269\u5bb9 \u7ebf\u7a0b2\u6267\u884c \u5b8c\u6574\u6267\u884c\u6269\u5bb9\uff1a \u2460 \u8fc1\u79fbA\uff1a<code>newTable[i] = A \u2192 null</code> \u2461 \u8fc1\u79fbB\uff1a<code>newTable[i] = B \u2192 A \u2192 null</code> \u7ebf\u7a0b2\u7684\u65b0\u94fe\u8868\uff1a<code>B \u2192 A \u2192 null</code> \u7ebf\u7a0b1\u6062\u590d \u7ee7\u7eed\u6267\u884c\uff08\u4ecd\u7528\u65e7\u6307\u9488 <code>e=A</code>, <code>next=B</code>\uff09 \u7ebf\u7a0b1\u9519\u8bef\u64cd\u4f5c \u2460 \u5c06A\u63d2\u5165\u65b0\u6876\uff1a<code>A.next = newTable[i]</code>\uff08\u6b64\u65f6<code>newTable[i]=B</code>\uff09 \u2461 \u7ed3\u679c\uff1a<code>A \u2192 B \u2192 A \u2192 B...</code> \u5f62\u6210\u73af\u5f62\u94fe\u8868\uff1aB \u2192 A \u2192 B <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#\u91cd\u8981\u5c5e\u6027\u548c\u5185\u90e8\u7c7b","title":"\u91cd\u8981\u5c5e\u6027\u548c\u5185\u90e8\u7c7b","text":"<pre><code>// \u9ed8\u8ba4\u4e3a 0\n// \u5f53\u521d\u59cb\u5316\u65f6, \u4e3a -1\n// \u5f53\u6269\u5bb9\u65f6, \u4e3a -(1 + \u6269\u5bb9\u7ebf\u7a0b\u6570)\n// \u5f53\u521d\u59cb\u5316\u6216\u6269\u5bb9\u5b8c\u6210\u540e\uff0c\u4e3a \u4e0b\u4e00\u6b21\u7684\u6269\u5bb9\u7684\u9608\u503c\u5927\u5c0f\nprivate transient volatile int sizeCtl;\n\n// \u6574\u4e2a ConcurrentHashMap \u5c31\u662f\u4e00\u4e2a Node[]\nstatic class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {}\n\n// hash \u8868\ntransient volatile Node&lt;K,V&gt;[] table;\n\n// \u6269\u5bb9\u65f6\u7684 \u65b0 hash \u8868\nprivate transient volatile Node&lt;K,V&gt;[] nextTable;\n\n// \u6269\u5bb9\u65f6\u5982\u679c\u67d0\u4e2a bin \u8fc1\u79fb\u5b8c\u6bd5, \u7528 ForwardingNode \u4f5c\u4e3a\u65e7 table bin \u7684\u5934\u7ed3\u70b9\nstatic final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; {}\n\n// \u7528\u5728 compute \u4ee5\u53ca computeIfAbsent \u65f6, \u7528\u6765\u5360\u4f4d, \u8ba1\u7b97\u5b8c\u6210\u540e\u66ff\u6362\u4e3a\u666e\u901a Node\nstatic final class ReservationNode&lt;K,V&gt; extends Node&lt;K,V&gt; {}\n\n// \u4f5c\u4e3a treebin \u7684\u5934\u8282\u70b9, \u5b58\u50a8 root \u548c first\nstatic final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; {}\n\n// \u4f5c\u4e3a treebin \u7684\u8282\u70b9, \u5b58\u50a8 parent, left, right\nstatic final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; {}\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7/#linkedblockingqueue","title":"LinkedBlockingQueue","text":"<p>\u57fa\u4e8e\u94fe\u8868\u7684\u963b\u585e\u961f\u5217\u5b9e\u73b0\uff0c\u652f\u6301\u516c\u5e73\u548c\u975e\u516c\u5e73\u4e24\u79cd\u9501\u7b56\u7565\uff0c\u9002\u7528\u4e8e\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u573a\u666f\u3002</p> <p>\u57fa\u672c\u64cd\u4f5c</p> <pre><code>void put(E e) throws InterruptedException // \u963b\u585e\u63d2\u5165\nE take() throws InterruptedException         // \u963b\u585e\u83b7\u53d6\nboolean offer(E e, long timeout, TimeUnit unit) throws InterruptedException // \u8d85\u65f6\u63d2\u5165\nE poll(long timeout, TimeUnit unit) throws InterruptedException // \u8d85\u65f6\u83b7\u53d6\n</code></pre> <p>\u6838\u5fc3\u5c5e\u6027</p> <pre><code>private final int capacity; // \u961f\u5217\u5bb9\u91cf\nprivate final AtomicInteger count = new AtomicInteger(0); // \u5f53\u524d\u5143\u7d20\u6570\u91cf\ntransient Node&lt;E&gt; head; // \u5934\u8282\u70b9\ntransient Node&lt;E&gt; last; // \u5c3e\u8282\u70b9\nprivate final ReentrantLock takeLock = new ReentrantLock(); // \u83b7\u53d6\u9501\nprivate final ReentrantLock putLock = new ReentrantLock(); // \u63d2\u5165\u9501\nprivate final Condition notEmpty = takeLock.newCondition(); // \u975e\u7a7a\u6761\u4ef6\nprivate final Condition notFull = putLock.newCondition(); // \u975e\u6ee1\u6761\u4ef6\n</code></pre> <p>\u5e94\u7528\u573a\u666f</p> <ol> <li>\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b</li> <li>\u4efb\u52a1\u8c03\u5ea6</li> <li>\u6d41\u91cf\u63a7\u5236</li> <li>\u7ebf\u7a0b\u6c60\u4efb\u52a1\u961f\u5217</li> <li>\u5f02\u6b65\u5904\u7406</li> </ol> <p>\u4e0a\u4e00\u8282\uff1a\u4e0d\u53ef\u53d8\u7c7b</p> <p>\u5b8c</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/","title":"\u5e76\u53d1\u7f16\u7a0b\u4e09\u8981\u7d20","text":"<p>\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u3001\u6709\u5e8f\u6027</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u539f\u5b50\u6027","title":"\u539f\u5b50\u6027","text":"<p>\u539f\u5b50\u6027\u662f\u6307\u4e00\u4e2a\u64cd\u4f5c\u4e0d\u53ef\u88ab\u4e2d\u65ad\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\uff0c\u4e0d\u4f1a\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u6253\u65ad</p> <p>\u901a\u8fc7\u9501\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u53ef\u89c1\u6027","title":"\u53ef\u89c1\u6027","text":"<p>\u9000\u4e0d\u51fa\u7684\u5faa\u73af</p> <pre><code>    static boolean run = true;\n\n    public static void main(String[] args) {\n\n        new Thread(() -&gt; {\n            while (run) {\n                // do something\n            }\n        }).start();\n\n        log.info(\"stop thread\");\n        run = false;\n    }\n</code></pre> <p>\u4ee5\u4e0a\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u5728<code>run</code>\u7684\u503c\u6539\u53d8\u540e\u9000\u51fa</p> <p>\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <ol> <li>JMM\u7684\u53ef\u89c1\u6027\u95ee\u9898\uff1a<ul> <li>\u5728Java\u5185\u5b58\u6a21\u578b\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58(\u7f13\u5b58)</li> <li><code>run</code>\u53d8\u91cf\u662f\u666e\u901a\u53d8\u91cf(\u975evolatile)\uff0c\u4fee\u6539\u53ef\u80fd\u4e0d\u4f1a\u7acb\u5373\u5bf9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u89c1</li> <li>\u4e3b\u7ebf\u7a0b\u4fee\u6539<code>run=false</code>\u540e\uff0c\u5b50\u7ebf\u7a0b\u53ef\u80fd\u4ecd\u7136\u8bfb\u53d6\u7684\u662f\u81ea\u5df1\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u65e7\u503c<code>true</code></li> </ul> </li> <li>\u7f16\u8bd1\u5668/JIT\u4f18\u5316\uff1a<ul> <li>JIT\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5c06<code>while(run)</code>\u4f18\u5316\u4e3a<code>while(true)</code>\uff0c\u56e0\u4e3a\u5faa\u73af\u4f53\u5185\u6ca1\u6709\u64cd\u4f5c</li> <li>\u8fd9\u79cd\u4f18\u5316\u79f0\u4e3a\"\u5faa\u73af\u63d0\u5347\"(Loop Hoisting)</li> </ul> </li> </ol> <p>\u89e3\u51b3\u65b9\u6848</p> <p>1.\u4f7f\u7528volatile\u5173\u952e\u5b57(\u63a8\u8350)</p> <pre><code>static volatile boolean run = true;\n</code></pre> <p><code>volatile</code>\u4fdd\u8bc1\uff1a</p> <ul> <li>\u53ef\u89c1\u6027\uff1a\u4fee\u6539\u7acb\u5373\u5bf9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u89c1</li> <li>\u6709\u5e8f\u6027\uff1a\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f</li> </ul> <p></p> <p>2.\u4f7f\u7528synchronized\u540c\u6b65</p> <p><pre><code>static boolean run = true;\nstatic final Object lock = new Object();\n\n// \u5199\u64cd\u4f5c\nsynchronized(lock) {\n    run = false;\n}\n\n// \u8bfb\u64cd\u4f5c\nsynchronized(lock) {\n    while(run) { ... }\n}\n</code></pre> synchronized\u4fdd\u8bc1\u540c\u6b65\u5757\u5185\u5bf9\u53d8\u91cf\u7684\u4fee\u6539\u5bf9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u89c1</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u4e24\u9636\u6bb5\u7ec8\u6b62\u6a21\u5f0f","title":"\u4e24\u9636\u6bb5\u7ec8\u6b62\u6a21\u5f0f","text":"<p>\u53ef\u4ee5\u4f7f\u7528<code>volatile</code>\u5b9e\u73b0\u8be5\u6a21\u5f0f</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#balking\u6a21\u5f0f","title":"Balking\u6a21\u5f0f","text":"<p>Balking\u6a21\u5f0f\u662f\u4e00\u79cd\u591a\u7ebf\u7a0b\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u5728\u5bf9\u8c61\u5904\u4e8e\u4e0d\u9002\u5f53\u72b6\u6001\u65f6\u7acb\u5373\u653e\u5f03\u5f53\u524d\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u7b49\u5f85\u72b6\u6001\u53d8\u4e3a\u53ef\u7528\u72b6\u6001\u3002</p> <p>\u5178\u578b\u573a\u666f</p> <ol> <li>\u6587\u4ef6\u81ea\u52a8\u4fdd\u5b58\u529f\u80fd\uff08\u5982\u679c\u5df2\u7ecf\u4fdd\u5b58\u8fc7\u5219\u4e0d\u518d\u91cd\u590d\u4fdd\u5b58\uff09</li> <li>\u670d\u52a1\u521d\u59cb\u5316\uff08\u53ea\u521d\u59cb\u5316\u4e00\u6b21\uff09</li> <li>\u7f51\u7edc\u8bf7\u6c42\u53d6\u6d88\uff08\u5982\u679c\u5df2\u7ecf\u5f00\u59cb\u5904\u7406\u5219\u4e0d\u63a5\u53d7\u53d6\u6d88\uff09</li> <li>\u7ebf\u7a0b\u542f\u52a8\u68c0\u67e5\uff08\u5982\u679c\u7ebf\u7a0b\u5df2\u5728\u8fd0\u884c\u5219\u4e0d\u91cd\u590d\u542f\u52a8\uff09</li> </ol> <pre><code>class VolatileBalking {\n    private volatile boolean initialized = false;\n\n    public void init() {\n        if (initialized) {\n            return;\n        }\n        synchronized (this) {\n            if (initialized) { // \u53cc\u91cd\u68c0\u67e5\n                return;\n            }\n            doInit();\n            initialized = true;\n        }\n    }\n\n    private void doInit() {\n        // \u521d\u59cb\u5316\u903b\u8f91\n    }\n}\n</code></pre> <p>\u4f8b\uff1a\u7ebf\u7a0b\u5b89\u5168\u7684\u5355\u4f8b\u6a21\u5f0f</p> <pre><code>public class Singleton {\n    private static volatile Singleton instance;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        if (instance == null) {                  // \u7b2c\u4e00\u6b21\u68c0\u67e5\uff1aBalking\uff0c\u76f4\u63a5\u8fd4\u56de\u907f\u514d\u540c\u6b65\uff0c\u4f18\u5316\u6027\u80fd\n            synchronized (Singleton.class) {      // \u540c\u6b65\n                if (instance == null) {          // \u7b2c\u4e8c\u6b21\u68c0\u67e5\uff1a\u7ebf\u7a0b\u5b89\u5168\n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u6709\u5e8f\u6027","title":"\u6709\u5e8f\u6027","text":"<p>\u6307\u4ee4\u91cd\u6392\uff1a\u5728\u4e0d\u6539\u53d8\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u8bed\u4e49\u7684\u524d\u63d0\u4e0b\uff0c\u7f16\u8bd1\u5668\u3001\u8fd0\u884c\u65f6\u6216\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u6539\u53d8\u4ee3\u7801\u7684\u6267\u884c\u987a\u5e8f</p> <p>\u8fd9\u4e2a\u73b0\u8c61\u9700\u8981\u901a\u8fc7\u5927\u91cf\u6d4b\u8bd5\u624d\u80fd\u590d\u73b0\uff08 java \u5e76\u53d1\u538b\u6d4b\u5de5\u5177 jcstress\uff09</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>    boolean ready = false;\n    int num = 0;\n    // \u7ebf\u7a0b1 \u6267\u884c\u6b64\u65b9\u6cd5\n    public void actor1(I_Result r) {\n        if(ready) {\n            r.r1 = num + num;\n        }\n        else {\n            r.r1 = 1;\n        }\n    }\n    // \u7ebf\u7a0b2 \u6267\u884c\u6b64\u65b9\u6cd5\n    public void actor2(I_Result r) {\n        num = 2;\n        ready = true;\n    }\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\uff0c<code>r.r1</code>\u7684\u503c\u53ef\u80fd\u662f1\uff0c4\uff0c0\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b00\u5462\uff1f</p> <p>\u539f\u56e0\uff1a</p> <p>\u6307\u4ee4\u91cd\u6392\uff1a</p> <ul> <li>\u7f16\u8bd1\u5668\u6216\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u5c06<code>num=2</code>\u548c<code>ready=true</code>\u7684\u987a\u5e8f\u8c03\u6362</li> <li>\u5bfc\u81f4\u7ebf\u7a0b1\u770b\u5230<code>ready=true</code>\u65f6\uff0c<code>num</code>\u53ef\u80fd\u8fd8\u672a\u88ab\u8d4b\u503c\u4e3a2</li> </ul> <p></p> <p>\u7981\u6b62\u91cd\u6392\u5e8f\uff1a</p> <ul> <li>\u5728volatile\u53d8\u91cf\u5199\u4e4b\u524d\u7684\u6240\u6709\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91cd\u6392\u5e8f\u5230\u5199\u4e4b\u540e</li> <li>\u5728volatile\u53d8\u91cf\u8bfb\u4e4b\u540e\u7684\u6240\u6709\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91cd\u6392\u5e8f\u5230\u8bfb\u4e4b\u524d</li> </ul> <p>\u6ce8\u610f</p> <p><code>synchronized</code> \u662f\u4e0d\u80fd\u963b\u6b62\u6307\u4ee4\u91cd\u6392\u7684</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#volatile","title":"volatile","text":"<p>\u5185\u5b58\u5c4f\u969c\u662f\u5904\u7406\u5668\u63d0\u4f9b\u7684\u4e00\u7ec4\u7279\u6b8a\u6307\u4ee4\uff0c\u7528\u4e8e\u63a7\u5236\u6307\u4ee4\u6267\u884c\u987a\u5e8f\u548c\u5185\u5b58\u53ef\u89c1\u6027\uff0c\u5728\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u8bfb\u5c4f\u969c\u548c\u5199\u5c4f\u969c\u662f\u4e24\u79cd\u57fa\u672c\u7684\u5185\u5b58\u5c4f\u969c\u7c7b\u578b\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u8bfb\u5c4f\u969c","title":"\u8bfb\u5c4f\u969c","text":"<ul> <li>\u786e\u4fdd\u5c4f\u969c\u540e\u7684\u8bfb\u64cd\u4f5c\u4e0d\u4f1a\u91cd\u6392\u5e8f\u5230\u5c4f\u969c\u524d</li> <li>\u5f3a\u5236\u4ece\u4e3b\u5185\u5b58\uff08\u800c\u975e\u7f13\u5b58\uff09\u91cd\u65b0\u52a0\u8f7d\u6570\u636e</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u5199\u5c4f\u969c","title":"\u5199\u5c4f\u969c","text":"<ul> <li>\u786e\u4fdd\u5c4f\u969c\u524d\u7684\u5199\u64cd\u4f5c\u4e0d\u4f1a\u91cd\u6392\u5e8f\u5230\u5c4f\u969c\u540e</li> <li>\u5f3a\u5236\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u5165\u4e3b\u5185\u5b58</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#double-checked-locking-\u95ee\u9898","title":"double-checked locking \u95ee\u9898","text":"<pre><code>public final class Singleton {\n    private Singleton() { }\n    private static Singleton INSTANCE = null;\n    public static Singleton getInstance() {\n        // \u5b9e\u4f8b\u6ca1\u521b\u5efa\uff0c\u624d\u4f1a\u8fdb\u5165\u5185\u90e8\u7684 synchronized\u4ee3\u7801\u5757\n        if (INSTANCE == null) {\n            synchronized (Singleton.class) { // t2\n                // \u4e5f\u8bb8\u6709\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u521b\u5efa\u5b9e\u4f8b\uff0c\u6240\u4ee5\u518d\u5224\u65ad\u4e00\u6b21\n                if (INSTANCE == null) { // t1\n                    INSTANCE = new Singleton();\n                }\n            }\n        }\n        return INSTANCE;\n    }\n}\n</code></pre> <p>\u5b57\u8282\u7801\uff1a</p> <pre><code>0: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n3: ifnonnull     37\n6: ldc           #3                  // class cn/itcast/n5/Singleton\n8: dup\n9: astore_0\n10: monitorenter\n11: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n14: ifnonnull     27\n17: new           #3                  // class cn/itcast/n5/Singleton\n20: dup\n21: invokespecial #4                  // Method \"&lt;init&gt;\":()V\n24: putstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n27: aload_0\n28: monitorexit\n29: goto          37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic     #2                  // Field INSTANCE:Lcn/itcast/n5/Singleton;\n40: areturn\n</code></pre> <p>\u5176\u4e2d </p> <p>17 \u8868\u793a\u521b\u5efa\u5bf9\u8c61\uff0c\u5c06\u5bf9\u8c61\u5f15\u7528\u5165\u6808  // new Singleton </p> <p>20 \u8868\u793a\u590d\u5236\u4e00\u4efd\u5bf9\u8c61\u5f15\u7528  // \u5f15\u7528\u5730\u5740 </p> <p>21 \u8868\u793a\u5229\u7528\u4e00\u4e2a\u5bf9\u8c61\u5f15\u7528\uff0c\u8c03\u7528\u6784\u9020\u65b9\u6cd5  </p> <p>24 \u8868\u793a\u5229\u7528\u4e00\u4e2a\u5bf9\u8c61\u5f15\u7528\uff0c\u8d4b\u503c\u7ed9 static INSTANCE </p> <p></p> <p>jvm \u53ef\u80fd\u4f1a\u4f18\u5316\u4e3a\uff1a\u5148\u6267\u884c 24 \uff08\u5bf9\u8c61\u8fd8\u672a\u521d\u59cb\u5316\uff09\uff0c\u518d\u6267\u884c 21\u3002\u5982\u679c\u4e24\u4e2a\u7ebf\u7a0b t1\uff0ct2 \u6309\u5982\u4e0b\u65f6\u95f4\u5e8f\u5217\u6267\u884c\uff1a</p> <p></p> <p>\u5173\u952e\u5728\u4e8e </p> <p>0: getstatic \u8fd9\u884c\u4ee3\u7801\u5728 monitor \u63a7\u5236\u4e4b\u5916\uff0c\u53ef\u4ee5\u8d8a\u8fc7 monitor \u8bfb\u53d6 INSTANCE \u53d8\u91cf\u7684\u503c </p> <p>\u8fd9\u65f6 t1 \u8fd8\u672a\u5b8c\u5168\u5c06\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\uff0c\u5982\u679c\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u8981\u6267\u884c\u5f88\u591a\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u90a3\u4e48 t2 \u62ff\u5230\u7684\u662f\u5c06\u662f\u4e00\u4e2a\u672a\u521d\u59cb\u5316\u5b8c\u6bd5\u7684\u5355\u4f8b </p> <p>\u5bf9 INSTANCE \u4f7f\u7528 volatile \u4fee\u9970\u5373\u53ef\uff0c\u53ef\u4ee5\u7981\u7528\u6307\u4ee4\u91cd\u6392\uff0c\u4f46\u8981\u6ce8\u610f\u5728 JDK 5 \u4ee5\u4e0a\u7684\u7248\u672c\u7684 volatile \u624d\u4f1a\u771f\u6b63\u6709\u6548</p> <p></p> <p>\u8bfb\u5199 volatile \u53d8\u91cf\u65f6\u4f1a\u52a0\u5165\u5185\u5b58\u5c4f\u969c\uff08Memory Barrier\uff08Memory Fence\uff09\uff09</p> <ul> <li>\u53ef\u89c1\u6027<ul> <li>\u5199\u5c4f\u969c\uff08sfence\uff09\u4fdd\u8bc1\u5728\u8be5\u5c4f\u969c\u4e4b\u524d\u7684 t1 \u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u6539\u52a8\uff0c\u90fd\u540c\u6b65\u5230\u4e3b\u5b58\u5f53\u4e2d </li> <li>\u800c\u8bfb\u5c4f\u969c\uff08lfence\uff09\u4fdd\u8bc1\u5728\u8be5\u5c4f\u969c\u4e4b\u540e t2 \u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u8bfb\u53d6\uff0c\u52a0\u8f7d\u7684\u662f\u4e3b\u5b58\u4e2d\u6700\u65b0\u6570\u636e </li> </ul> </li> <li> <p>\u6709\u5e8f\u6027</p> <ul> <li>\u5199\u5c4f\u969c\u4f1a\u786e\u4fdd\u6307\u4ee4\u91cd\u6392\u5e8f\u65f6\uff0c\u4e0d\u4f1a\u5c06\u5199\u5c4f\u969c\u4e4b\u524d\u7684\u4ee3\u7801\u6392\u5728\u5199\u5c4f\u969c\u4e4b\u540e </li> <li>\u8bfb\u5c4f\u969c\u4f1a\u786e\u4fdd\u6307\u4ee4\u91cd\u6392\u5e8f\u65f6\uff0c\u4e0d\u4f1a\u5c06\u8bfb\u5c4f\u969c\u4e4b\u540e\u7684\u4ee3\u7801\u6392\u5728\u8bfb\u5c4f\u969c\u4e4b\u524d</li> </ul> </li> <li> <p>\u66f4\u5e95\u5c42\u662f\u8bfb\u5199\u53d8\u91cf\u65f6\u4f7f\u7528 lock \u6307\u4ee4\u6765\u5b9e\u73b0\u591a\u6838 CPU \u4e4b\u95f4\u7684\u53ef\u89c1\u6027\u4e0e\u6709\u5e8f\u6027</p> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#happens-before","title":"happens-before","text":"<p>happens-before \u89c4\u5b9a\u4e86\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u5bf9\u5176\u5b83\u7ebf\u7a0b\u7684\u8bfb\u64cd\u4f5c\u53ef\u89c1\uff0c\u5b83\u662f\u53ef\u89c1\u6027\u4e0e\u6709\u5e8f\u6027\u7684\u4e00\u5957\u89c4\u5219\u603b\u7ed3\u3002\u5982\u679c\u6ca1\u6709 happens-before \u89c4\u5219\u7684\u4fdd\u8bc1\uff0cJMM \u5e76\u4e0d\u80fd\u786e\u4fdd\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u5bf9\u4e8e\u5176\u5b83\u7ebf\u7a0b\u5bf9\u8be5\u5171\u4eab\u53d8\u91cf\u7684\u8bfb\u64cd\u4f5c\u53ef\u89c1\u3002</p> <p>happens-before \u539f\u5219\u5305\u62ec\uff1a</p> <ol> <li> <p>\u7ebf\u7a0b\u89e3\u9501 m \u4e4b\u524d\u5bf9\u53d8\u91cf\u7684\u5199\uff0c\u5bf9\u4e8e\u63a5\u4e0b\u6765\u5bf9 m \u52a0\u9501\u7684\u5176\u5b83\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u7684\u8bfb\u53ef\u89c1</p> <pre><code>static int x;\nstatic Object m = new Object();\n\nnew Thread(() -&gt; {\n    synchronized (m) {\n        x = 10;\n    }\n}, \"t1\").start();\n\nnew Thread(() -&gt; {\n    synchronized (m) {\n        System.out.println(x);\n    }\n}, \"t2\").start();\n</code></pre> </li> <li> <p>\u7ebf\u7a0b\u5bf9 volatile \u53d8\u91cf\u7684\u5199\uff0c\u5bf9\u63a5\u4e0b\u6765\u5176\u5b83\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u7684\u8bfb\u53ef\u89c1</p> <pre><code>volatile static int x;\n\nnew Thread(()-&gt;{\n    x = 10;\n},\"t1\").start();\n\nnew Thread(()-&gt;{\n    System.out.println(x);\n},\"t2\").start();\n</code></pre> </li> <li> <p>\u7ebf\u7a0b start \u524d\u5bf9\u53d8\u91cf\u7684\u5199\uff0c\u5bf9\u8be5\u7ebf\u7a0b\u5f00\u59cb\u540e\u5bf9\u8be5\u53d8\u91cf\u7684\u8bfb\u53ef\u89c1</p> <pre><code>static int x;\nx = 10;\n\nnew Thread(()-&gt;{\n    System.out.println(x);\n},\"t2\").start();\n</code></pre> </li> <li> <p>\u7ebf\u7a0b\u7ed3\u675f\u524d\u5bf9\u53d8\u91cf\u7684\u5199\uff0c\u5bf9\u5176\u5b83\u7ebf\u7a0b\u5f97\u77e5\u5b83\u7ed3\u675f\u540e\u7684\u8bfb\u53ef\u89c1\uff08\u6bd4\u5982\u5176\u5b83\u7ebf\u7a0b\u8c03\u7528 t1.isAlive() \u6216 t1.join()\u7b49\u5f85\u5b83\u7ed3\u675f\uff09</p> <pre><code>static int x;\n\nThread t1 = new Thread(()-&gt;{\n    x = 10;\n},\"t1\");\nt1.start();\nt1.join();\n\nSystem.out.println(x);\n</code></pre> </li> <li> <p>\u7ebf\u7a0b t1 \u6253\u65ad t2\uff08interrupt\uff09\u524d\u5bf9\u53d8\u91cf\u7684\u5199\uff0c\u5bf9\u4e8e\u5176\u4ed6\u7ebf\u7a0b\u5f97\u77e5 t2 \u88ab\u6253\u65ad\u540e\u5bf9\u53d8\u91cf\u7684\u8bfb\u53ef\u89c1\uff08\u901a\u8fc7 t2.interrupted \u6216 t2.isInterrupted\uff09</p> <pre><code>static int x;\n\nThread t2 = new Thread(()-&gt;{\n    while(true) {\n        if(Thread.currentThread().isInterrupted()) {\n            System.out.println(x);\n            break;\n        }\n    }\n},\"t2\");\nt2.start();\nnew Thread(()-&gt;{\n    sleep(1);\n    x = 10;\n    t2.interrupt();\n},\"t1\").start();\n\nwhile(!t2.isInterrupted()) {\n    Thread.yield();\n}\nSystem.out.println(x);\n</code></pre> </li> <li> <p>\u5bf9\u53d8\u91cf\u9ed8\u8ba4\u503c\uff080\uff0cfalse\uff0cnull\uff09\u7684\u5199\uff0c\u5bf9\u5176\u5b83\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u7684\u8bfb\u53ef\u89c1</p> </li> <li> <p>\u5177\u6709\u4f20\u9012\u6027\uff0c\u5982\u679c  x -&gt; y \u5e76\u4e14  y -&gt; z \u90a3\u4e48\u6709  x -&gt; z \uff0c\u914d\u5408 volatile \u7684\u9632\u6307\u4ee4\u91cd\u6392</p> <pre><code>volatile static int x;\nstatic int y;\nnew Thread(()-&gt;{\n    y = 10;\n    x = 20;\n},\"t1\").start();\nnew Thread(()-&gt;{\n    // x=20 \u5bf9 t2 \u53ef\u89c1, \u540c\u65f6 y=10 \u4e5f\u5bf9 t2 \u53ef\u89c1\n    System.out.println(x);\n},\"t2\").start();\n</code></pre> </li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%89%E8%A6%81%E7%B4%A0/#\u7ebf\u7a0b\u5b89\u5168\u7684\u5355\u4f8b\u6a21\u5f0f\u5b9e\u73b0","title":"\u7ebf\u7a0b\u5b89\u5168\u7684\u5355\u4f8b\u6a21\u5f0f\u5b9e\u73b0","text":"<ul> <li>\u997f\u6c49\u5f0f</li> </ul> <pre><code>public final class Singleton {\n    private Singleton(){}\n    private static final Singleton INSTANCE = new Singleton();\n    public static Singleton getInstance() {\n        return INSTANCE;\n    }\n}\n</code></pre> <ul> <li>\u53cc\u91cd\u68c0\u67e5</li> </ul> <pre><code>public final class Singleton implements Serializable {\n    private Singleton() {}\n    private volatile static Singleton INSTANCE = null;\n    public static Singleton getInstance() {\n        // \u5b9e\u4f8b\u6ca1\u521b\u5efa\uff0c\u624d\u4f1a\u8fdb\u5165\u5185\u90e8\u7684 synchronized\u4ee3\u7801\u5757\n        if (INSTANCE == null) {\n            // \u53ef\u80fd\u6709\u591a\u4e2a\u7ebf\u7a0b\u5230\u8fbe\u8be5\u5206\u652f\n            synchronized (Singleton.class) {\n                // \u4e5f\u8bb8\u6709\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u521b\u5efa\u5b9e\u4f8b\uff0c\u6240\u4ee5\u518d\u5224\u65ad\u4e00\u6b21\n                if (INSTANCE == null) {\n                    INSTANCE = new Singleton();\n                }\n            }\n        }\n        return INSTANCE;\n    }\n\n    // \u9632\u6b62\u53cd\u5e8f\u5217\u5316\u91cd\u65b0\u521b\u5efa\u5bf9\u8c61\n    public Object readResolve() {\n        return INSTANCE;\n    }\n}\n</code></pre> <ul> <li>\u679a\u4e3e</li> </ul> <pre><code>enum Singleton {\n    INSTANCE;\n}\n</code></pre> <ul> <li>\u9759\u6001\u5185\u90e8\u7c7b</li> </ul> <pre><code>final class Singleton {\n    // \u79c1\u6709\u6784\u9020\u51fd\u6570\uff0c\u9632\u6b62\u5916\u90e8\u5b9e\u4f8b\u5316\n    private Singleton() {\n\n    }\n\n    // \u9759\u6001\u5185\u90e8\u7c7b\uff0c\u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u5355\u4f8b\u5b9e\u4f8b\n    private static class SingletonHolder {\n        private static final Singleton INSTANCE = new Singleton();\n    }\n\n    // \u63d0\u4f9b\u5168\u5c40\u8bbf\u95ee\u70b9\uff0c\u8fd4\u56de\u5355\u4f8b\u5b9e\u4f8b\n    public static Singleton getInstance() {\n        return SingletonHolder.INSTANCE;\n    }\n}\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1a\u9501</p> <p>\u4e0b\u4e00\u8282\uff1a\u4e50\u89c2\u9501</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/","title":"\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u8fdb\u7a0b","title":"\u8fdb\u7a0b","text":"<ul> <li>\u7a0b\u5e8f\u7531\u6307\u4ee4\u548c\u6570\u636e\u7ec4\u6210\uff0c\u4f46\u8fd9\u4e9b\u6307\u4ee4\u8981\u8fd0\u884c\uff0c\u6570\u636e\u8981\u8bfb\u5199\uff0c\u5c31\u5fc5\u987b\u5c06\u6307\u4ee4\u52a0\u8f7d\u81f3 CPU\uff0c\u6570\u636e\u52a0\u8f7d\u81f3\u5185\u5b58\u3002\u5728\u6307\u4ee4\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8fd8\u9700\u8981\u7528\u5230\u78c1\u76d8\u3001\u7f51\u7edc\u7b49\u8bbe\u5907\u3002\u8fdb\u7a0b\u5c31\u662f\u7528\u6765\u52a0\u8f7d\u6307\u4ee4\u3001\u7ba1\u7406\u5185\u5b58\u3001\u7ba1\u7406 IO \u7684</li> <li>\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u88ab\u8fd0\u884c\uff0c\u4ece\u78c1\u76d8\u52a0\u8f7d\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u4ee3\u7801\u81f3\u5185\u5b58\uff0c\u8fd9\u65f6\u5c31\u5f00\u542f\u4e86\u4e00\u4e2a\u8fdb\u7a0b\u3002 </li> <li>\u8fdb\u7a0b\u53ef\u4ee5\u89c6\u4e3a\u7a0b\u5e8f\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5927\u90e8\u5206\u7a0b\u5e8f\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u5b9e\u4f8b\u8fdb\u7a0b\uff08\u4f8b\u5982\u8bb0\u4e8b\u672c\u3001\u753b\u56fe\u3001\u6d4f\u89c8\u5668 \u7b49\uff09\uff0c\u4e5f\u6709\u7684\u7a0b\u5e8f\u53ea\u80fd\u542f\u52a8\u4e00\u4e2a\u5b9e\u4f8b\u8fdb\u7a0b\uff08\u4f8b\u5982\u7f51\u6613\u4e91\u97f3\u4e50\u3001360 \u5b89\u5168\u536b\u58eb\u7b49\uff09</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u7ebf\u7a0b","title":"\u7ebf\u7a0b","text":"<ul> <li>\u4e00\u4e2a\u8fdb\u7a0b\u5185\u53ef\u4ee5\u5206\u4e3a\u4e00\u5230\u591a\u4e2a\u7ebf\u7a0b\u3002 </li> <li>\u4e00\u4e2a\u7ebf\u7a0b\u5c31\u662f\u4e00\u4e2a\u6307\u4ee4\u6d41\uff0c\u5c06\u6307\u4ee4\u6d41\u4e2d\u7684\u4e00\u6761\u6761\u6307\u4ee4\u4ee5\u4e00\u5b9a\u7684\u987a\u5e8f\u4ea4\u7ed9 CPU \u6267\u884c </li> <li>Java \u4e2d\uff0c\u7ebf\u7a0b\u4f5c\u4e3a\u6700\u5c0f\u8c03\u5ea6\u5355\u4f4d\uff0c\u8fdb\u7a0b\u4f5c\u4e3a\u8d44\u6e90\u5206\u914d\u7684\u6700\u5c0f\u5355\u4f4d\u3002 </li> <li>\u5728 windows \u4e2d\u8fdb\u7a0b\u662f\u4e0d\u6d3b\u52a8\u7684\uff0c\u53ea\u662f\u4f5c\u4e3a\u7ebf\u7a0b\u7684\u5bb9\u5668</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u5bf9\u6bd4","title":"\u5bf9\u6bd4","text":"<ul> <li>\u8fdb\u7a0b\u57fa\u672c\u4e0a\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u800c\u7ebf\u7a0b\u5b58\u5728\u4e8e\u8fdb\u7a0b\u5185\uff0c\u662f\u8fdb\u7a0b\u7684\u4e00\u4e2a\u5b50\u96c6 </li> <li>\u8fdb\u7a0b\u62e5\u6709\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u5982\u5185\u5b58\u7a7a\u95f4\u7b49\uff0c\u4f9b\u5176\u5185\u90e8\u7684\u7ebf\u7a0b\u5171\u4eab </li> <li>\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8f83\u4e3a\u590d\u6742<ul> <li>\u540c\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u8fdb\u7a0b\u901a\u4fe1\u79f0\u4e3a IPC\uff08Inter-process communication\uff09 </li> <li>\u4e0d\u540c\u8ba1\u7b97\u673a\u4e4b\u95f4\u7684\u8fdb\u7a0b\u901a\u4fe1\uff0c\u9700\u8981\u901a\u8fc7\u7f51\u7edc\uff0c\u5e76\u9075\u5b88\u5171\u540c\u7684\u534f\u8bae\uff0c\u4f8b\u5982 HTTP </li> </ul> </li> <li>\u7ebf\u7a0b\u901a\u4fe1\u76f8\u5bf9\u7b80\u5355\uff0c\u56e0\u4e3a\u5b83\u4eec\u5171\u4eab\u8fdb\u7a0b\u5185\u7684\u5185\u5b58\uff0c\u4e00\u4e2a\u4f8b\u5b50\u662f\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf </li> <li>\u7ebf\u7a0b\u66f4\u8f7b\u91cf\uff0c\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6210\u672c\u4e00\u822c\u4e0a\u8981\u6bd4\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u4f4e</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u5e76\u884c\u4e0e\u5e76\u53d1","title":"\u5e76\u884c\u4e0e\u5e76\u53d1","text":"<p>\u5355\u6838 cpu \u4e0b\uff0c\u7ebf\u7a0b\u5b9e\u9645\u8fd8\u662f \u4e32\u884c\u6267\u884c \u7684\u3002\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6709\u4e00\u4e2a\u7ec4\u4ef6\u53eb\u505a\u4efb\u52a1\u8c03\u5ea6\u5668\uff0c\u5c06 cpu \u7684\u65f6\u95f4\u7247\uff08windows \u4e0b\u65f6\u95f4\u7247\u6700\u5c0f\u7ea6\u4e3a 15 \u6beb\u79d2\uff09\u5206\u7ed9\u4e0d\u540c\u7684\u7a0b\u5e8f\u4f7f\u7528\uff0c\u53ea\u662f\u7531\u4e8e cpu \u5728\u7ebf\u7a0b\u95f4\uff08\u65f6\u95f4\u7247\u5f88\u77ed\uff09\u7684\u5207\u6362\u975e\u5e38\u5feb\uff0c\u8ba9\u4eba\u611f\u89c9\u662f\u540c\u65f6\u8fd0\u884c\u7684 \u3002</p> <p>Note</p> <p>\u603b\u7ed3\u4e3a\u4e00\u53e5\u8bdd\u5c31\u662f\uff1a\u5fae\u89c2\u4e32\u884c\uff0c\u5b8f\u89c2\u5e76\u884c\uff0c \u4e00\u822c\u4f1a\u5c06\u8fd9\u79cd\u7ebf\u7a0b\u8f6e\u6d41\u4f7f\u7528CPU\u7684\u505a\u6cd5\u79f0\u4e3a\u5e76\u53d1\uff0c <code>concurrent</code></p> <p>\u5f15\u7528 Rob Pike \u7684\u4e00\u6bb5\u63cf\u8ff0\uff1a </p> <ul> <li>\u5e76\u53d1\uff08concurrent\uff09\u662f\u540c\u4e00\u65f6\u95f4\u5e94\u5bf9\uff08dealing with\uff09\u591a\u4ef6\u4e8b\u60c5\u7684\u80fd\u529b </li> <li>\u5e76\u884c\uff08parallel\uff09\u662f\u540c\u4e00\u65f6\u95f4\u52a8\u624b\u505a\uff08doing\uff09\u591a\u4ef6\u4e8b\u60c5\u7684\u80fd\u529b</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u5e94\u7528","title":"\u5e94\u7528","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u5f02\u6b65\u8c03\u7528","title":"\u5f02\u6b65\u8c03\u7528","text":"<p>\u4ee5\u8c03\u7528\u65b9\u89d2\u5ea6\u6765\u8bb2\uff0c\u5982\u679c </p> <ul> <li>\u9700\u8981\u7b49\u5f85\u7ed3\u679c\u8fd4\u56de\uff0c\u624d\u80fd\u7ee7\u7eed\u8fd0\u884c\u5c31\u662f\u540c\u6b65 </li> <li>\u4e0d\u9700\u8981\u7b49\u5f85\u7ed3\u679c\u8fd4\u56de\uff0c\u5c31\u80fd\u7ee7\u7eed\u8fd0\u884c\u5c31\u662f\u5f02\u6b65</li> </ul> <p>\u591a\u7ebf\u7a0b\u53ef\u4ee5\u8ba9\u65b9\u6cd5\u6267\u884c\u53d8\u4e3a\u5f02\u6b65\u7684\uff0c\u6bd4\u5982\u8bf4\u8bfb\u53d6\u78c1\u76d8\u6587\u4ef6\u65f6\uff0c\u5047\u8bbe\u8bfb\u53d6\u64cd\u4f5c\u82b1\u8d39\u4e86 5 \u79d2\u949f\uff0c\u5982\u679c\u6ca1\u6709\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\uff0c\u8fd9 5 \u79d2 cpu \u4ec0\u4e48\u90fd\u505a\u4e0d\u4e86\uff0c\u5176\u5b83\u4ee3\u7801\u90fd\u5f97\u6682\u505c... </p> <p>\u5e94\u7528\u6848\u4f8b</p> <ul> <li>\u6bd4\u5982\u5728\u9879\u76ee\u4e2d\uff0c\u89c6\u9891\u6587\u4ef6\u9700\u8981\u8f6c\u6362\u683c\u5f0f\u7b49\u64cd\u4f5c\u6bd4\u8f83\u8d39\u65f6\uff0c\u8fd9\u65f6\u5f00\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u5904\u7406\u89c6\u9891\u8f6c\u6362\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b </li> <li>tomcat \u7684\u5f02\u6b65 servlet \u4e5f\u662f\u7c7b\u4f3c\u7684\u76ee\u7684\uff0c\u8ba9\u7528\u6237\u7ebf\u7a0b\u5904\u7406\u8017\u65f6\u8f83\u957f\u7684\u64cd\u4f5c\uff0c\u907f\u514d\u963b\u585e tomcat \u7684\u5de5\u4f5c\u7ebf\u7a0b </li> <li>ui \u7a0b\u5e8f\u4e2d\uff0c\u4f7f\u7528\u7ebf\u7a0b\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\uff0c\u907f\u514d\u963b\u585e ui \u7ebf\u7a0b</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/#\u63d0\u9ad8\u6548\u7387","title":"\u63d0\u9ad8\u6548\u7387","text":"<p>\u5145\u5206\u5229\u7528\u591a\u6838 cpu \u7684\u4f18\u52bf\uff0c\u63d0\u9ad8\u8fd0\u884c\u6548\u7387\u3002</p> <p>\u60f3\u8c61\u4e0b\u9762\u7684\u573a\u666f\uff0c\u6267\u884c 3 \u4e2a\u8ba1\u7b97\uff0c\u6700\u540e\u5c06\u8ba1\u7b97\u7ed3\u679c\u6c47\u603b\u3002 </p> <pre><code>\u8ba1\u7b97 1 \u82b1\u8d39 10 ms \n\u8ba1\u7b97 2 \u82b1\u8d39 11 ms \n\u8ba1\u7b97 3 \u82b1\u8d39 9 ms \n\u6c47\u603b\u9700\u8981 1 ms\n</code></pre> <p>\u5982\u679c\u662f\u4e32\u884c\u6267\u884c\uff0c\u90a3\u4e48\u603b\u5171\u82b1\u8d39\u7684\u65f6\u95f4\u662f  10 + 11 + 9 + 1 = 31ms </p> <p>\u4f46\u5982\u679c\u662f\u56db\u6838 cpu\uff0c\u5404\u4e2a\u6838\u5fc3\u5206\u522b\u4f7f\u7528\u7ebf\u7a0b 1 \u6267\u884c\u8ba1\u7b97 1\uff0c\u7ebf\u7a0b 2 \u6267\u884c\u8ba1\u7b97 2\uff0c\u7ebf\u7a0b 3 \u6267\u884c\u8ba1\u7b97 3\uff0c\u90a3\u4e48 3 \u4e2a \u7ebf\u7a0b\u662f\u5e76\u884c\u7684\uff0c\u82b1\u8d39\u65f6\u95f4\u53ea\u53d6\u51b3\u4e8e\u6700\u957f\u7684\u90a3\u4e2a\u7ebf\u7a0b\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5373 11ms ,\u52a0\u4e0a\u6c47\u603b\u662f 12ms </p> <p>\u6ce8\u610f</p> <p>\u9700\u8981\u5728\u591a\u6838 cpu \u624d\u80fd\u63d0\u9ad8\u6548\u7387\uff0c\u5355\u6838\u4ecd\u7136\u65f6\u662f\u8f6e\u6d41\u6267\u884c</p> <ol> <li>\u5355\u6838 cpu \u4e0b\uff0c\u591a\u7ebf\u7a0b\u4e0d\u80fd\u5b9e\u9645\u63d0\u9ad8\u7a0b\u5e8f\u8fd0\u884c\u6548\u7387\uff0c\u53ea\u662f\u4e3a\u4e86\u80fd\u591f\u5728\u4e0d\u540c\u7684\u4efb\u52a1\u4e4b\u95f4\u5207\u6362\uff0c\u4e0d\u540c\u7ebf\u7a0b\u8f6e\u6d41\u4f7f\u7528 cpu \uff0c\u4e0d\u81f3\u4e8e\u4e00\u4e2a\u7ebf\u7a0b\u603b\u5360\u7528 cpu\uff0c\u522b\u7684\u7ebf\u7a0b\u6ca1\u6cd5\u8fd0\u884c</li> <li>\u591a\u6838 cpu \u53ef\u4ee5\u5e76\u884c\u8dd1\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u80fd\u5426\u63d0\u9ad8\u7a0b\u5e8f\u8fd0\u884c\u6548\u7387\u8fd8\u662f\u8981\u5206\u60c5\u51b5\u7684 <ul> <li>\u6709\u4e9b\u4efb\u52a1\uff0c\u7ecf\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1\uff0c\u5c06\u4efb\u52a1\u62c6\u5206\uff0c\u5e76\u884c\u6267\u884c\uff0c\u5f53\u7136\u53ef\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u7684\u8fd0\u884c\u6548\u7387\u3002</li> <li>\u4f46\u4e0d\u662f\u6240\u6709\u8ba1\u7b97\u4efb \u52a1\u90fd\u80fd\u62c6\u5206\uff08\u53c2\u8003\u540e\u6587\u7684\u3010\u963f\u59c6\u8fbe\u5c14\u5b9a\u5f8b\u3011\uff09 \u4e5f\u4e0d\u662f\u6240\u6709\u4efb\u52a1\u90fd\u9700\u8981\u62c6\u5206\uff0c\u4efb\u52a1\u7684\u76ee\u7684\u5982\u679c\u4e0d\u540c\uff0c\u8c08\u62c6\u5206\u548c\u6548\u7387\u6ca1\u5565\u610f\u4e49 </li> </ul> </li> <li>IO \u64cd\u4f5c\u4e0d\u5360\u7528 cpu\uff0c\u53ea\u662f\u6211\u4eec\u4e00\u822c\u62f7\u8d1d\u6587\u4ef6\u4f7f\u7528\u7684\u662f\u3010\u963b\u585e IO\u3011\uff0c\u8fd9\u76f8\u5f53\u4e8e\u7ebf\u7a0b\u867d\u7136\u4e0d\u7528 cpu\uff0c\u4f46\u9700\u8981\u4e00\u76f4\u7b49\u5f85 IO \u7ed3\u675f\uff0c\u6ca1\u80fd\u5145\u5206\u5229\u7528\u7ebf\u7a0b\u3002\u6240\u4ee5\u624d\u6709\u540e\u9762\u7684\u3010\u975e\u963b\u585e IO\u3011\u548c\u3010\u5f02\u6b65 IO\u3011\u4f18\u5316</li> </ol> <p>\u4e0a\u4e00\u8282\uff1a\u5e76\u53d1\u7f16\u7a0b\u6982\u8ff0</p> <p>\u4e0b\u4e00\u8282\uff1aJava\u7ebf\u7a0b</p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/","title":"\u9501","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898","title":"\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898","text":"<p>\u5bf9\u4e8e\u5982\u4e0b\u4ee3\u7801\uff1a <pre><code>static int count = 0;\nThread t1 = new Thread(() -&gt; {\n    for (int i = 0; i &lt; 10000; i++) {\n        count++;\n    }\n});\n\nThread t2 = new Thread(() -&gt; {\n    for (int i = 0; i &lt; 10000; i++) {\n        count++;\n    }\n});\n\nt1.start();\nt2.start();\n\nt1.join();\nt2.join();\n\nSystem.out.println(count);\n</code></pre></p> <p>Danger</p> <p>\u4ee5\u4e0a\u4ee3\u7801\u8f93\u51fa\u7684\u503c count &lt; 20000</p> <p>\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u4fee\u6539\u540c\u4e00\u4e2a\u53d8\u91cf\u5c31\u53ef\u80fd\u53d1\u751f\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u4e34\u754c\u533a","title":"\u4e34\u754c\u533a","text":"<ul> <li>\u4e00\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\u672c\u8eab\u662f\u6ca1\u6709\u95ee\u9898\u7684</li> <li>\u95ee\u9898\u51fa\u5728\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90<ul> <li>\u591a\u4e2a\u7ebf\u7a0b\u8bfb\u5171\u4eab\u8d44\u6e90\u4e5f\u6ca1\u6709\u95ee\u9898</li> <li>\u5728\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u8bfb\u5199\u64cd\u4f5c\u65f6\u53d1\u751f\u6307\u4ee4\u4ea4\u9519\uff0c\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898</li> </ul> </li> <li>\u4e00\u6bb5\u4ee3\u7801\u5757\u5185\u5982\u679c\u5b58\u5728\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u591a\u7ebf\u7a0b\u8bfb\u5199\u64cd\u4f5c\uff0c\u79f0\u8fd9\u6bb5\u4ee3\u7801\u5757\u4e3a\u4e34\u754c\u533a</li> </ul> <pre><code>static int counter = 0;\n\nstatic void increment()\n// \u4e34\u754c\u533a\n{\n    counter++;\n}\n\nstatic void decrement()\n// \u4e34\u754c\u533a\n{\n    counter--;\n}\n</code></pre>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#synchronized","title":"synchronized","text":"<p>\u4e3a\u4e86\u907f\u514d\u4e34\u754c\u533a\u7684\u7ade\u6001\u6761\u4ef6\u53d1\u751f\uff0c\u6709\u591a\u79cd\u624b\u6bb5\u53ef\u4ee5\u8fbe\u5230\u76ee\u7684\u3002 </p> <ul> <li>\u963b\u585e\u5f0f\u7684\u89e3\u51b3\u65b9\u6848\uff1a<code>synchronized</code>\uff0c<code>Lock</code></li> <li>\u975e\u963b\u585e\u5f0f\u7684\u89e3\u51b3\u65b9\u6848\uff1a\u539f\u5b50\u53d8\u91cf</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#synchronized\u5bf9\u8c61\u9501","title":"<code>synchronized</code>\u5bf9\u8c61\u9501","text":"<p>\u8bed\u6cd5</p> <pre><code>synchronized(\u5bf9\u8c61)\n{\n    \u4e34\u754c\u533a\n}\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>private static int count = 0;\nprivate static final Object lock = new Object();// \u9501\u5bf9\u8c61\n\nThread t1 = new Thread(() -&gt; {\n    for (int i = 0; i &lt; 10000; i++) {\n        synchronized (lock) {\n            count++;\n        }\n    }\n});\n\nThread t2 = new Thread(() -&gt; {\n    for (int i = 0; i &lt; 10000; i++) {\n        synchronized (lock) {\n            count--;\n        }\n    }\n});\n\nt1.start();\nt2.start();\n\nt1.join();\nt2.join();\n\nSystem.out.println(count);\n</code></pre> <p>Info</p> <p>synchronized \u5b9e\u9645\u662f\u7528\u5bf9\u8c61\u9501\u4fdd\u8bc1\u4e86\u4e34\u754c\u533a\u5185\u4ee3\u7801\u7684\u539f\u5b50\u6027\uff0c\u4e34\u754c\u533a\u5185\u7684\u4ee3\u7801\u5bf9\u5916\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u4e0d\u4f1a\u88ab\u7ebf\u7a0b\u5207\u6362\u6240\u6253\u65ad\u3002</p> <p>\u5c01\u88c5\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u5bf9\u8c61</p> <pre><code>class Room {\n    private int count = 0;\n\n    public void encrement() {\n        // \u4ee5\u81ea\u8eab\u4e3a\u9501\u5bf9\u8c61\n        synchronized (this) {\n            count++;\n        }\n    }\n\n    public void decrment() {\n        synchronized (this) {\n            count--;\n        }\n    }\n\n    public int getCount() {\n        synchronized (this) {\n            return count;\n        }\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u5b9e\u4f8b\u65b9\u6cd5\u4e0a\u7684synchronized","title":"\u5b9e\u4f8b\u65b9\u6cd5\u4e0a\u7684<code>synchronized</code>","text":"<pre><code>class Room {\n    private int count = 0;\n\n    public synchronized void encrement() {\n        count++;\n    }\n\n    public synchronized void decrment() {\n        count--;\n    }\n\n    public synchronized int getCount() {\n        return count;\n    }\n}\n</code></pre> <p>Note</p> <p>\u7b49\u540c\u4e8e\u5728\u65b9\u6cd5\u4f53\u5185\u4f7f\u7528</p> <pre><code>synchronized (this) {\n...\n}\n</code></pre> <p>Info</p> <p><code>synchronized</code>\u4f7f\u7528\u5728\u9759\u6001\u65b9\u6cd5\u524d\uff0c\u76f8\u5f53\u4e8e\u5bf9\u7c7b\u7684class\u5bf9\u8c61\u52a0\u9501</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u7ebf\u7a0b\u5b89\u5168\u5206\u6790","title":"\u7ebf\u7a0b\u5b89\u5168\u5206\u6790","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6210\u5458\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf","title":"\u6210\u5458\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf","text":"<ul> <li>\u5982\u679c\u5b83\u4eec\u6ca1\u6709\u5171\u4eab\uff0c\u5219\u7ebf\u7a0b\u5b89\u5168 </li> <li>\u5982\u679c\u5b83\u4eec\u88ab\u5171\u4eab\u4e86\uff0c\u6839\u636e\u5b83\u4eec\u7684\u72b6\u6001\u662f\u5426\u80fd\u591f\u6539\u53d8\uff0c\u53c8\u5206\u4e24\u79cd\u60c5\u51b5 <ul> <li>\u5982\u679c\u53ea\u6709\u8bfb\u64cd\u4f5c\uff0c\u5219\u7ebf\u7a0b\u5b89\u5168 </li> <li>\u5982\u679c\u6709\u8bfb\u5199\u64cd\u4f5c\uff0c\u5219\u8fd9\u6bb5\u4ee3\u7801\u662f\u4e34\u754c\u533a\uff0c\u9700\u8981\u8003\u8651\u7ebf\u7a0b\u5b89\u5168</li> </ul> </li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u5c40\u90e8\u53d8\u91cf","title":"\u5c40\u90e8\u53d8\u91cf","text":"<ul> <li>\u5c40\u90e8\u53d8\u91cf\u662f\u7ebf\u7a0b\u5b89\u5168\u7684 </li> </ul> <p>Info</p> <p>\u5c40\u90e8\u53d8\u91cf\u5b58\u653e\u5728\u865a\u62df\u673a\u6808\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u6808\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u4e0d\u5171\u4eab</p> <ul> <li>\u4f46\u5c40\u90e8\u53d8\u91cf\u5f15\u7528\u7684\u5bf9\u8c61\u5219\u53ef\u80fd\u4e0d\u5b89\u5168 <ul> <li>\u5982\u679c\u8be5\u5bf9\u8c61\u6ca1\u6709\u9003\u79bb\u65b9\u6cd5\u7684\u4f5c\u7528\u8303\u56f4\uff0c\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684 </li> <li>\u5982\u679c\u8be5\u5bf9\u8c61\u9003\u79bb\u65b9\u6cd5\u7684\u4f5c\u7528\u8303\u56f4\uff0c\u9700\u8981\u8003\u8651\u7ebf\u7a0b\u5b89\u5168</li> </ul> </li> </ul> <pre><code>class ThreadSafe {\n    public void method1(int loopNumber) {\n        ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; loopNumber; i++) {\n            method2(list);\n            method3(list);\n        }\n    }\n    public void method2(ArrayList&lt;String&gt; list) {\n        list.add(\"1\");\n    }\n    public void method3(ArrayList&lt;String&gt; list) {\n        list.remove(0);\n    }\n}\n\nclass ThreadSafeSubClass extends ThreadSafe{\n    @Override\n    public void method3(ArrayList&lt;String&gt; list) {\n        // \u4ea7\u751f\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\n        new Thread(() -&gt; {\n            list.remove(0);\n        }).start();\n    }\n}\n</code></pre> <p>Warning</p> <p>\u4ee5\u4e0a\u7684\u4ee3\u7801\u4e2d\uff0c\u5b50\u7c7b\u91cd\u5199\u4e86 method3 \u65b9\u6cd5\uff0c\u5bfc\u81f4 list \u9003\u79bb\u4e86 method1 \u65b9\u6cd5\u7684\u4f5c\u7528\u8303\u56f4\uff0c\u4ece\u800c\u4ea7\u751f\u4e86\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898</p> <p>\u53ef\u5c06\u65b9\u6cd52\u548c3\u4f7f\u7528private\u4fee\u9970\uff0c\u9632\u6b62\u5b50\u7c7b\u91cd\u5199\uff0c\u4f7f\u7528final\u4fee\u9970\u65b9\u6cd51\u9632\u6b62\u5b50\u7c7b\u91cd\u5199</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u5e38\u89c1\u7ebf\u7a0b\u5b89\u5168\u7c7b","title":"\u5e38\u89c1\u7ebf\u7a0b\u5b89\u5168\u7c7b","text":"<p>\u591a\u4e2a\u7ebf\u7a0b\u8c03\u7528\u5b83\u4eec\u540c\u4e00\u4e2a\u5b9e\u4f8b\u7684\u67d0\u4e2a\u65b9\u6cd5\u65f6\uff0c\u662f\u7ebf\u7a0b\u5b89\u5168\u7684</p> <ul> <li><code>String</code></li> <li><code>Integer</code> </li> <li><code>StringBuffer</code></li> <li><code>Random</code></li> <li><code>Vector</code></li> <li><code>Hashtable</code></li> <li><code>java.util.concurrent</code> \u5305\u4e0b\u7684\u7c7b</li> </ul> <p>\u6ce8\u610f</p> <p>\u5b83\u4eec\u7684\u6bcf\u4e2a\u65b9\u6cd5\u662f\u539f\u5b50\u7684</p> <p>\u4f46\u6ce8\u610f\u5b83\u4eec\u591a\u4e2a\u65b9\u6cd5\u7684\u7ec4\u5408\u4e0d\u662f\u539f\u5b50\u7684</p> <pre><code>Hashtable table = new Hashtable();\n// \u7ebf\u7a0b1 get\uff0c\u7ebf\u7a0b2 put \u53ef\u80fd\u5bfc\u81f4\u8986\u76d6\nif(table.get(\"key\") == null) {\n    table.put(\"key\", value);\n}\n</code></pre> <p>Note</p> <p><code>String</code>\u3001<code>Integer</code> \u7b49\u90fd\u662f\u4e0d\u53ef\u53d8\u7c7b\uff0c\u56e0\u4e3a\u5176\u5185\u90e8\u7684\u72b6\u6001\u4e0d\u53ef\u4ee5\u6539\u53d8\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\u65b9\u6cd5\u90fd\u662f\u7ebf\u7a0b\u5b89\u5168\u7684</p> <p>\u793a\u4f8b\u89e3\u6790</p> <ul> <li>\u4f8b1</li> </ul> <pre><code>public class MyServlet extends HttpServlet {\n    // \u4e0d\u5b89\u5168\n    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n    // \u4e0d\u53ef\u53d8\u7c7b\uff0c\u5b89\u5168\n    String S1 = \"...\";\n    // \u5b89\u5168\n    final String S2 = \"...\";\n    // \u4e0d\u5b89\u5168\n    Date D1 = new Date();\n    // \u4e0d\u5b89\u5168\uff0cDate\u5f15\u7528\u4e0d\u53ef\u53d8\uff0c\u4f46\u662fDate\u7684\u5185\u5bb9\u53ef\u53d8\n    final Date D2 = new Date();\n\n    public void doGet(HttpServletRequest request, HttpServletResponse response) {\n        // \u4f7f\u7528\u4e0a\u8ff0\u53d8\u91cf\n    }\n}\n</code></pre> <ul> <li>\u4f8b2</li> </ul> <pre><code>public class MyServlet extends HttpServlet {\n    // \u4e0d\u5b89\u5168\uff0c\u539f\u56e0\u662fUserServiceImpl\u5b58\u5728\u4e0d\u5b89\u5168\u7684\u6210\u5458\u53d8\u91cf\n    private UserService userService = new UserServiceImpl();\n    public void doGet(HttpServletRequest request, HttpServletResponse response) {\n        userService.update(...);\n    }\n}\npublic class UserServiceImpl implements UserService {\n    // \u8bb0\u5f55\u8c03\u7528\u6b21\u6570\n    private int count = 0;\n    public void update() {\n        // ...\n        count++;\n    }\n}\n</code></pre> <ul> <li>\u4f8b3</li> </ul> <pre><code>@Aspect\n@Component\npublic class MyAspect {\n    // \u4e0d\u5b89\u5168\uff0c\u5efa\u8bae\u4f7f\u7528\u73af\u7ed5\u901a\u77e5\u5c06start\u53d8\u6210\u5c40\u90e8\u53d8\u91cf\n    private long start = 0L;\n\n    @Before(\"execution(* *(..))\")\n    public void before() {\n        start = System.nanoTime();\n    }\n\n    @After(\"execution(* *(..))\")\n    public void after() {\n        long end = System.nanoTime();\n        System.out.println(\"cost time:\" + (end - start));\n    }\n}\n</code></pre> <ul> <li>\u4f8b4</li> </ul> <pre><code>public class MyServlet extends HttpServlet {\n    // \u5b89\u5168\n    private UserService userService = new UserServiceImpl();\n    public void doGet(HttpServletRequest request, HttpServletResponse response) {\n        userService.update(...);\n    }\n}\npublic class UserServiceImpl implements UserService {\n    // \u5b89\u5168\n    private UserDao userDao = new UserDaoImpl();\n    public void update() {\n        userDao.update();\n    }\n}\npublic class UserDaoImpl implements UserDao {\n    public void update() {\n        // \u5b89\u5168\n        String sql = \"update user set password = ? where username = ?\";\n        try (Connection conn = DriverManager.getConnection(\"\", \"\", \"\")) {\n            // ...\n        } catch (Exception e) {}\n    }\n}\n</code></pre> <ul> <li>\u4f8b5</li> </ul> <pre><code>public class MyServlet extends HttpServlet {\n    // \u4e0d\u5b89\u5168\n    private UserService userService = new UserServiceImpl();\n    public void doGet(HttpServletRequest request, HttpServletResponse response) {\n        userService.update(...);\n    }\n}\npublic class UserServiceImpl implements UserService {\n    // \u4e0d\u5b89\u5168\n    private UserDao userDao = new UserDaoImpl();\n    public void update() {\n        userDao.update();\n    }\n}\npublic class UserDaoImpl implements UserDao {\n    // \u4e0d\u5b89\u5168\uff0c\u7ebf\u7a0b\u53ef\u5171\u4eabconn\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5173\u95ed\u8fde\u63a5\u540e\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u5f97conn\n    private Connection conn = null;\n    public void update() throws SQLException {\n        String sql = \"update user set password = ? where username = ?\";\n        conn = DriverManager.getConnection(\"\",\"\",\"\");\n        // ...\n        conn.close();\n    }\n}\n</code></pre> <ul> <li>\u4f8b6</li> </ul> <pre><code>public class MyServlet extends HttpServlet {\n    // \u5b89\u5168\n    private UserService userService = new UserServiceImpl();\n    public void doGet(HttpServletRequest request, HttpServletResponse response) {\n        userService.update(...);\n    }\n}\npublic class UserServiceImpl implements UserService {\n    // \u5b89\u5168\uff0c\u4e0d\u540c\u7ebf\u7a0b\u4f7f\u7528\u4e0d\u540c\u7684UserDaoImpl\u5bf9\u8c61\uff0c\u65e0\u6cd5\u5171\u4eab\u5185\u90e8\u4e0d\u5b89\u5168\u7684connection\u53d8\u91cf\n    public void update() {\n        UserDao userDao = new UserDaoImpl();\n        userDao.update();\n    }\n}\npublic class UserDaoImpl implements UserDao {\n    // \u4e0d\u5b89\u5168\n    private Connection = null;\n    public void update() throws SQLException {\n        String sql = \"update user set password = ? where username = ?\";\n        conn = DriverManager.getConnection(\"\",\"\",\"\");\n        // ...\n        conn.close();\n    }\n}\n</code></pre> <ul> <li>\u4f8b7</li> </ul> <pre><code>public abstract class Test {\n    public void bar() {\n        // \u4e0d\u5b89\u5168\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n        foo(sdf);\n    }\n    // \u5b50\u7c7b\u5b9e\u73b0\u8be5\u65b9\u6cd5\uff0c\u5e76\u5c06SimpleDateFormat\u5171\u4eab\u81f3\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\n    public abstract foo(SimpleDateFormat sdf);\n    public static void main(String[] args) {\n        new Test().bar();\n    }\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#monitor","title":"Monitor","text":"<p>Java \u5bf9\u8c61\u5934\u4e2d\u7684 <code>Mark Word</code> \u6807\u8bb0\u5b57\u6bb5\uff0c\u7528\u4e8e\u6807\u8bb0\u5bf9\u8c61\u7684\u72b6\u6001</p> <p>Monitor \u88ab\u7ffb\u8bd1\u4e3a\u76d1\u89c6\u5668\u6216\u7ba1\u7a0b</p> <p>\u6bcf\u4e2a Java \u5bf9\u8c61\u90fd\u53ef\u4ee5\u5173\u8054\u4e00\u4e2a Monitor \u5bf9\u8c61\uff0c\u5982\u679c\u4f7f\u7528 synchronized \u7ed9\u5bf9\u8c61\u4e0a\u9501\uff08\u91cd\u91cf\u7ea7\u9501\uff09\u4e4b\u540e\uff0c\u8be5\u5bf9\u8c61\u5934\u7684 Mark Word \u4e2d\u5c31\u88ab\u8bbe\u7f6e\u4e3a\u6307\u5411 Monitor \u5bf9\u8c61\u7684\u6307\u9488</p> <p></p> <ul> <li>\u521a\u5f00\u59cb Monitor \u4e2d Owner \u4e3a null </li> <li>\u5f53 Thread-2 \u6267\u884c synchronized(obj) \u5c31\u4f1a\u5c06 Monitor \u7684\u6240\u6709\u8005 Owner \u7f6e\u4e3a Thread-2\uff0cMonitor\u4e2d\u53ea\u80fd\u6709\u4e00 \u4e2a Owner </li> <li>\u5728 Thread-2 \u4e0a\u9501\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c Thread-3\uff0cThread-4\uff0cThread-5 \u4e5f\u6765\u6267\u884c synchronized(obj)\uff0c\u5c31\u4f1a\u8fdb\u5165  EntryList\uff0c\u7ebf\u7a0b\u72b6\u6001\u53d8\u6210BLOCKED </li> <li>Thread-2 \u6267\u884c\u5b8c\u540c\u6b65\u4ee3\u7801\u5757\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5524\u9192 EntryList \u4e2d\u7b49\u5f85\u7684\u7ebf\u7a0b\u6765\u7ade\u4e89\u9501\uff0c\u7ade\u4e89\u662f\u975e\u516c\u5e73\u7684</li> <li>WaitSet \u4e2d\u7684 Thread-0\uff0cThread-1 \u662f\u4e4b\u524d\u83b7\u5f97\u8fc7\u9501\uff0c\u4f46\u6761\u4ef6\u4e0d\u6ee1\u8db3\u8fdb\u5165 WAITING \u72b6\u6001\u7684\u7ebf\u7a0b</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#synchronized-\u4f18\u5316\u539f\u7406\u8fdb\u9636","title":"synchronized \u4f18\u5316\u539f\u7406\u8fdb\u9636","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u8f7b\u91cf\u7ea7\u9501","title":"\u8f7b\u91cf\u7ea7\u9501","text":"<p>\u8f7b\u91cf\u7ea7\u9501\u7684\u4f7f\u7528\u573a\u666f\uff1a\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u6709\u591a\u7ebf\u7a0b\u8981\u52a0\u9501\uff0c\u4f46\u52a0\u9501\u7684\u65f6\u95f4\u662f\u9519\u5f00\u7684\uff08\u4e5f\u5c31\u662f\u6ca1\u6709\u7ade\u4e89\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u8f7b\u91cf\u7ea7\u9501\u6765\u4f18\u5316\u3002</p> <p>\u8f7b\u91cf\u7ea7\u9501\u5bf9\u4f7f\u7528\u8005\u662f\u900f\u660e\u7684\uff0c\u5373\u8bed\u6cd5\u4ecd\u7136\u662f  <code>synchronized</code></p> <p>\u4f8b\u5982\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>static final Object obj = new Object();\npublic static void method1() {\n    synchronized( obj ) {\n        // \u540c\u6b65\u5757 A\n        method2();\n    }\n}\npublic static void method2() {\n    synchronized( obj ) {\n        // \u540c\u6b65\u5757 B\n    }\n}\n</code></pre> <p>\u52a0\u9501\u8fc7\u7a0b\uff1a</p> <ul> <li>\u521b\u5efa\u9501\u8bb0\u5f55\uff08Lock Record\uff09\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u6808\u5e27\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u9501\u8bb0\u5f55\u7684\u7ed3\u6784\uff0c\u5185\u90e8\u53ef\u4ee5\u5b58\u50a8\u9501\u5b9a\u5bf9\u8c61\u7684  Mark Word</li> </ul> <p></p> <ul> <li> <p>\u8ba9\u9501\u8bb0\u5f55\u4e2d Object reference \u6307\u5411\u9501\u5bf9\u8c61\uff0c\u5e76\u5c1d\u8bd5\u7528 cas \u66ff\u6362 Object \u7684 Mark Word\uff0c\u5c06 Mark Word \u7684\u503c\u5b58\u5165\u9501\u8bb0\u5f55</p> </li> <li> <p>\u5982\u679c cas \u66ff\u6362\u6210\u529f\uff0c\u5bf9\u8c61\u5934\u4e2d\u5b58\u50a8\u4e86 \u9501\u8bb0\u5f55\u5730\u5740\u548c\u72b6\u6001 00 \uff0c\u8868\u793a\u7531\u8be5\u7ebf\u7a0b\u7ed9\u5bf9\u8c61\u52a0\u9501</p> </li> <li> <p>\u5982\u679c cas \u5931\u8d25\uff0c\u6709\u4e24\u79cd\u60c5\u51b5 </p> <ul> <li>\u5982\u679c\u662f\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u4e86\u8be5 Object \u7684\u8f7b\u91cf\u7ea7\u9501\uff0c\u8fd9\u65f6\u8868\u660e\u6709\u7ade\u4e89\uff0c\u8fdb\u5165\u9501\u81a8\u80c0\u8fc7\u7a0b </li> <li>\u5982\u679c\u662f\u81ea\u5df1\u6267\u884c\u4e86 synchronized \u9501\u91cd\u5165\uff0c\u90a3\u4e48\u518d\u6dfb\u52a0\u4e00\u6761 Lock Record \u4f5c\u4e3a\u91cd\u5165\u7684\u8ba1\u6570</li> </ul> </li> <li>\u5f53\u9000\u51fa synchronized \u4ee3\u7801\u5757\uff08\u89e3\u9501\u65f6\uff09\u5982\u679c\u6709\u53d6\u503c\u4e3a null \u7684\u9501\u8bb0\u5f55\uff0c\u8868\u793a\u6709\u91cd\u5165\uff0c\u8fd9\u65f6\u91cd\u7f6e\u9501\u8bb0\u5f55\uff0c\u8868\u793a\u91cd\u5165\u8ba1\u6570\u51cf\u4e00</li> <li>\u5f53\u9000\u51fa synchronized \u4ee3\u7801\u5757\uff08\u89e3\u9501\u65f6\uff09\u9501\u8bb0\u5f55\u7684\u503c\u4e0d\u4e3a null\uff0c\u8fd9\u65f6\u4f7f\u7528 cas \u5c06 Mark Word \u7684\u503c\u6062\u590d\u7ed9\u5bf9\u8c61 \u5934 <ul> <li>\u6210\u529f\uff0c\u5219\u89e3\u9501\u6210\u529f </li> <li>\u5931\u8d25\uff0c\u8bf4\u660e\u8f7b\u91cf\u7ea7\u9501\u8fdb\u884c\u4e86\u9501\u81a8\u80c0\u6216\u5df2\u7ecf\u5347\u7ea7\u4e3a\u91cd\u91cf\u7ea7\u9501\uff0c\u8fdb\u5165\u91cd\u91cf\u7ea7\u9501\u89e3\u9501\u6d41\u7a0b</li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u9501\u81a8\u80c0","title":"\u9501\u81a8\u80c0","text":"<p>\u5982\u679c\u5728\u5c1d\u8bd5\u52a0\u8f7b\u91cf\u7ea7\u9501\u7684\u8fc7\u7a0b\u4e2d\uff0cCAS \u64cd\u4f5c\u65e0\u6cd5\u6210\u529f\uff0c\u8fd9\u65f6\u4e00\u79cd\u60c5\u51b5\u5c31\u662f\u6709\u5176\u5b83\u7ebf\u7a0b\u4e3a\u6b64\u5bf9\u8c61\u52a0\u4e0a\u4e86\u8f7b\u91cf\u7ea7\u9501\uff08\u6709\u7ade\u4e89\uff09\uff0c\u8fd9\u65f6\u9700\u8981\u8fdb\u884c\u9501\u81a8\u80c0\uff0c\u5c06\u8f7b\u91cf\u7ea7\u9501\u53d8\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002</p> <p>\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53 Thread-1 \u8fdb\u884c\u8f7b\u91cf\u7ea7\u52a0\u9501\u65f6\uff0cThread-0 \u5df2\u7ecf\u5bf9\u8be5\u5bf9\u8c61\u52a0\u4e86\u8f7b\u91cf\u7ea7\u9501</li> <li>\u8fd9\u65f6 Thread-1 \u52a0\u8f7b\u91cf\u7ea7\u9501\u5931\u8d25\uff0c\u8fdb\u5165\u9501\u81a8\u80c0\u6d41\u7a0b <ul> <li>\u5373\u4e3a Object \u5bf9\u8c61\u7533\u8bf7 Monitor \u9501\uff0c\u8ba9 Object \u6307\u5411\u91cd\u91cf\u7ea7\u9501\u5730\u5740 </li> <li>\u7136\u540e\u81ea\u5df1\u8fdb\u5165 Monitor \u7684 EntryList\uff0c\u72b6\u6001\u53d8\u6210BLOCKED</li> </ul> </li> <li>\u5f53 Thread-0 \u9000\u51fa\u540c\u6b65\u5757\u89e3\u9501\u65f6\uff0c\u4f7f\u7528 CAS \u5c06 Mark Word \u7684\u503c\u6062\u590d\u7ed9\u5bf9\u8c61\u5934\uff0c\u5931\u8d25\u3002\u8fd9\u65f6\u4f1a\u8fdb\u5165\u91cd\u91cf\u7ea7\u89e3\u9501\u6d41\u7a0b\uff0c\u5373\u6309\u7167 Monitor \u5730\u5740\u627e\u5230 Monitor \u5bf9\u8c61\uff0c\u8bbe\u7f6e Owner \u4e3a null\uff0c\u5524\u9192 EntryList \u4e2d BLOCKED \u7ebf\u7a0b</li> </ul> <p></p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u81ea\u65cb\u4f18\u5316","title":"\u81ea\u65cb\u4f18\u5316","text":"<p>\u91cd\u91cf\u7ea7\u9501\u7ade\u4e89\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u81ea\u65cb\u6765\u8fdb\u884c\u4f18\u5316\uff0c\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u81ea\u65cb\u6210\u529f\uff08\u5373\u8fd9\u65f6\u5019\u6301\u9501\u7ebf\u7a0b\u5df2\u7ecf\u9000\u51fa\u4e86\u540c\u6b65\u5757\uff0c\u91ca\u653e\u4e86\u9501\uff09\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u907f\u514d\u963b\u585e\u3002</p> <ul> <li>\u81ea\u65cb\u4f1a\u5360\u7528 CPU \u65f6\u95f4\uff0c\u5355\u6838 CPU \u81ea\u65cb\u5c31\u662f\u6d6a\u8d39\uff0c\u591a\u6838 CPU \u81ea\u65cb\u624d\u80fd\u53d1\u6325\u4f18\u52bf\u3002 </li> <li>\u5728 Java 6 \u4e4b\u540e\u81ea\u65cb\u9501\u662f\u81ea\u9002\u5e94\u7684\uff0c\u6bd4\u5982\u5bf9\u8c61\u521a\u521a\u7684\u4e00\u6b21\u81ea\u65cb\u64cd\u4f5c\u6210\u529f\u8fc7\uff0c\u90a3\u4e48\u8ba4\u4e3a\u8fd9\u6b21\u81ea\u65cb\u6210\u529f\u7684\u53ef\u80fd\u6027\u4f1a\u9ad8\uff0c\u5c31\u591a\u81ea\u65cb\u51e0\u6b21\uff1b\u53cd\u4e4b\uff0c\u5c31\u5c11\u81ea\u65cb\u751a\u81f3\u4e0d\u81ea\u65cb\u3002</li> <li>Java 7 \u4e4b\u540e\u4e0d\u80fd\u63a7\u5236\u662f\u5426\u5f00\u542f\u81ea\u65cb\u529f\u80fd\u3002</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u504f\u5411\u9501","title":"\u504f\u5411\u9501","text":"<p>\u8f7b\u91cf\u7ea7\u9501\u5728\u6ca1\u6709\u7ade\u4e89\u65f6\uff08\u65e0\u5176\u4ed6\u7ebf\u7a0b\u9700\u8981\u4e0e\u5176\u7ade\u4e89\u9501\u5bf9\u8c61\uff09\uff0c\u6bcf\u6b21\u91cd\u5165\u4ecd\u7136\u9700\u8981\u6267\u884c CAS \u64cd\u4f5c\u3002</p> <p>Java 6 \u4e2d\u5f15\u5165\u4e86\u504f\u5411\u9501\u6765\u505a\u8fdb\u4e00\u6b65\u4f18\u5316\uff1a</p> <ul> <li> <p>\u504f\u5411\u9501\u662fJVM\u4e3a\u4e86\u63d0\u9ad8\u540c\u6b65\u6027\u80fd\u800c\u8bbe\u8ba1\u7684\u4e00\u79cd\u9501\u4f18\u5316\u673a\u5236\u3002\u5b83\u57fa\u4e8e\"\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u9501\u4e0d\u5b58\u5728\u7ade\u4e89\"\u7684\u5047\u8bbe\uff0c\u8ba9\u9501\u504f\u5411\u4e8e\u7b2c\u4e00\u4e2a\u83b7\u53d6\u5b83\u7684\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u53ea\u6709\u7b2c\u4e00\u6b21\u4f7f\u7528 CAS \u624d\u5c06\u7ebf\u7a0b ID \u8bbe\u7f6e\u5230\u5bf9\u8c61\u7684 Mark Word \u5934\uff0c\u4e4b\u540e\u53d1\u73b0\u8fd9\u4e2a\u7ebf\u7a0b ID \u662f\u81ea\u5df1\u7684\u5c31\u8868\u793a\u6ca1\u6709\u7ade\u4e89\uff0c\u4e0d\u7528\u91cd\u65b0 CAS\u3002\u4ee5\u540e\u53ea\u8981\u4e0d\u53d1\u751f\u7ade\u4e89\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u5f52\u8be5\u7ebf\u7a0b\u6240\u6709\u3002</p> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u504f\u5411\u72b6\u6001","title":"\u504f\u5411\u72b6\u6001","text":"<p>\u5bf9\u8c61\u5934(64 bit) Mark Word \u72b6\u6001\uff1a</p> <p></p> <p>\u4e00\u4e2a\u5bf9\u8c61\u521b\u5efa\u65f6\uff1a</p> <ul> <li>\u5982\u679c\u5f00\u542f\u4e86\u504f\u5411\u9501\uff08\u9ed8\u8ba4\u5f00\u542f\uff09\uff0c\u90a3\u4e48\u5bf9\u8c61\u521b\u5efa\u540e\uff0c<code>markword</code> \u503c\u4e3a <code>0x05</code> \u5373\u6700\u540e 3 \u4f4d\u4e3a 101\uff0c\u8fd9\u65f6\u5b83\u7684  thread\u3001epoch\u3001age \u90fd\u4e3a 0</li> <li>\u504f\u5411\u9501\u662f\u9ed8\u8ba4\u662f\u5ef6\u8fdf\u7684\uff0c\u4e0d\u4f1a\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u7acb\u5373\u751f\u6548\uff0c\u5982\u679c\u60f3\u907f\u514d\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u673a\u53c2\u6570  <code>-XX:BiasedLockingStartupDelay=0</code> \u6765\u7981\u7528\u5ef6\u8fdf</li> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f\u504f\u5411\u9501\uff0c\u90a3\u4e48\u5bf9\u8c61\u521b\u5efa\u540e\uff0c<code>markword</code> \u503c\u4e3a <code>0x01</code> \u5373\u6700\u540e 3 \u4f4d\u4e3a 001\uff0c\u8fd9\u65f6\u5b83\u7684 <code>hashcode</code>\u3001 age \u90fd\u4e3a 0\uff0c\u7b2c\u4e00\u6b21\u7528\u5230 <code>hashcode</code> \u65f6\u624d\u4f1a\u8d4b\u503c</li> </ul> <p>Tip</p> <p><code>-XX:-UseBiasedLocking</code> \u7981\u7528\u504f\u5411\u9501</p> <p><code>-XX:+UseBiasedLocking</code> \u542f\u7528\u504f\u5411\u9501\uff08\u9ed8\u8ba4\uff09</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u64a4\u9500-\u8c03\u7528\u5bf9\u8c61\u7684-hashcode","title":"\u64a4\u9500-\u8c03\u7528\u5bf9\u8c61\u7684 <code>hashCode</code>","text":"<p>\u504f\u5411\u9501\u7684\u5bf9\u8c61 MarkWord \u4e2d\u5b58\u50a8\u7684\u662f\u7ebf\u7a0b id\uff0c\u5982\u679c\u8c03\u7528 hashCode \uff0c\u7531\u4e8e\u957f\u5ea6\u9650\u5236\uff0c\u5bf9\u8c61\u5934\u4e2d\u4e0d\u80fd\u540c\u65f6\u5b58\u50a8 \u7ebf\u7a0bID \u548c hashCode\uff0c\u4f1a\u5bfc\u81f4\u504f\u5411\u9501\u88ab\u64a4\u9500</p> <ul> <li>\u8f7b\u91cf\u7ea7\u9501\u4f1a\u5728\u9501\u8bb0\u5f55\u4e2d\u8bb0\u5f55 hashCode </li> <li>\u91cd\u91cf\u7ea7\u9501\u4f1a\u5728 Monitor \u4e2d\u8bb0\u5f55 hashCode</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u64a4\u9500-\u5176\u4ed6\u7ebf\u7a0b\u4f7f\u7528\u5bf9\u8c61","title":"\u64a4\u9500-\u5176\u4ed6\u7ebf\u7a0b\u4f7f\u7528\u5bf9\u8c61","text":"<p>\u5f53\u6709\u5176\u5b83\u7ebf\u7a0b\u4f7f\u7528\u504f\u5411\u9501\u5bf9\u8c61\u65f6\uff0c\u4f1a\u5c06\u504f\u5411\u9501\u5347\u7ea7\u4e3a\u8f7b\u91cf\u7ea7\u9501</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u64a4\u9500-\u8c03\u7528-waitnotify","title":"\u64a4\u9500-\u8c03\u7528 <code>wait/notify</code>","text":"<p><code>wait/notify</code> \u9700\u8981\u4f7f\u7528\u91cd\u91cf\u7ea7\u9501\uff0c\u56e0\u6b64\u4f1a\u64a4\u9500\u504f\u5411\u9501</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6279\u91cf\u91cd\u504f\u5411","title":"\u6279\u91cf\u91cd\u504f\u5411","text":"<p>\u200b\u5f53\u504f\u5411\u9501\u7684\u5047\u8bbe\u4e0d\u6210\u7acb(\u5373\u5b58\u5728\u591a\u4e2a\u7ebf\u7a0b\u7ade\u4e89\u9501)\u65f6\uff0cJVM\u9700\u8981\u64a4\u9500\u504f\u5411\u9501\u3002\u5982\u679c\u9891\u7e41\u53d1\u751f\u504f\u5411\u9501\u64a4\u9500\uff0c\u4f1a\u5f71\u54cd\u6027\u80fd\u3002</p> <p>\u6279\u91cf\u91cd\u504f\u5411\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <ol> <li>\u5f53\u67d0\u4e2a\u7c7b\u7684\u504f\u5411\u9501\u64a4\u9500\u6b21\u6570\u8fbe\u5230\u9608\u503c(\u9ed8\u8ba420\u6b21)\u65f6\uff0cJVM\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u7c7b\u7684\u9501\u4e0d\u9002\u5408\u4f7f\u7528\u504f\u5411\u6a21\u5f0f</li> <li>JVM\u4f1a\u6267\u884c\u6279\u91cf\u91cd\u504f\u5411\uff0c\u5c06\u8fd9\u4e2a\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b\u7684\u504f\u5411\u9501\u72b6\u6001\u91cd\u7f6e</li> <li>\u4e4b\u540e\u8fd9\u4e9b\u5b9e\u4f8b\u7684\u9501\u53ef\u4ee5\u91cd\u65b0\u504f\u5411\u4e8e\u65b0\u7684\u7ebf\u7a0b\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5347\u7ea7\u4e3a\u8f7b\u91cf\u7ea7\u9501</li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6279\u91cf\u64a4\u9500","title":"\u6279\u91cf\u64a4\u9500","text":"<p>\u6279\u91cf\u64a4\u9500\u662fJVM\u5728\u68c0\u6d4b\u5230\u67d0\u4e2a\u7c7b\u7684\u504f\u5411\u9501\u9891\u7e41\u53d1\u751f\u7ade\u4e89\u65f6\uff0c\u5f7b\u5e95\u7981\u7528\u8be5\u7c7b\u7684\u504f\u5411\u9501\u4f18\u5316\u7684\u673a\u5236\u3002\u5982\u679c\u64a4\u9500\u6b21\u6570\u589e\u957f\u523040\u6b21\uff0c\u5c31\u4f1a\u89e6\u53d1\u6279\u91cf\u64a4\u9500\u3002</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u9501\u6d88\u9664","title":"\u9501\u6d88\u9664","text":"<p>JVM\u5728\u8fd0\u884c\u65f6\u4f1a\u8fdb\u884c\u9003\u9038\u5206\u6790\uff0c\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u53ef\u80fd\u88ab\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff1a</p> <ul> <li>\u4e0d\u9003\u9038\uff08No Escape\uff09\uff1a\u5bf9\u8c61\u4ec5\u5728\u5f53\u524d\u65b9\u6cd5\u6216\u7ebf\u7a0b\u5185\u4f7f\u7528\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee\u3002</li> <li>\u65b9\u6cd5\u9003\u9038\uff08Method Escape\uff09\uff1a\u5bf9\u8c61\u53ef\u80fd\u88ab\u5176\u4ed6\u65b9\u6cd5\u8bbf\u95ee\uff0c\u4f46\u4ecd\u9650\u4e8e\u5f53\u524d\u7ebf\u7a0b\u3002</li> <li>\u7ebf\u7a0b\u9003\u9038\uff08Thread Escape\uff09\uff1a\u5bf9\u8c61\u53ef\u80fd\u88ab\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee\uff08\u9700\u8981\u540c\u6b65\uff09\u3002</li> </ul> <p>\u5982\u679cJVM\u53d1\u73b0\u67d0\u4e2a\u9501\u5bf9\u8c61\u4e0d\u4f1a\u9003\u9038\u5230\u5176\u4ed6\u7ebf\u7a0b\uff08\u5373\u4e0d\u5b58\u5728\u771f\u6b63\u7684\u7ade\u4e89\uff09\uff0c\u5c31\u4f1a\u76f4\u63a5\u6d88\u9664\u9501\uff0c\u51cf\u5c11\u540c\u6b65\u5f00\u9500\u3002</p> <p>\u4f8b\u5982\uff1a\u5355\u7ebf\u7a0b\u73af\u5883\u4e0bStringBuffer \u4f1a\u88ab\u66ff\u6362\u6210 StringBuilder</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#waitnotify","title":"wait/notify","text":"<ul> <li>Owner \u7ebf\u7a0b\u53d1\u73b0\u6761\u4ef6\u4e0d\u6ee1\u8db3\uff0c\u8c03\u7528 wait \u65b9\u6cd5\uff0c\u5373\u53ef\u8fdb\u5165 WaitSet \u53d8\u4e3a WAITING \u72b6\u6001 </li> <li>BLOCKED \u548c WAITING \u7684\u7ebf\u7a0b\u90fd\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u4e0d\u5360\u7528 CPU \u65f6\u95f4\u7247 </li> <li>BLOCKED \u7ebf\u7a0b\u4f1a\u5728 Owner \u7ebf\u7a0b\u91ca\u653e\u9501\u65f6\u5524\u9192 </li> <li>WAITING \u7ebf\u7a0b\u4f1a\u5728 Owner \u7ebf\u7a0b\u8c03\u7528 notify \u6216 notifyAll \u65f6\u5524\u9192\uff0c\u4f46\u5524\u9192\u540e\u5e76\u4e0d\u610f\u5473\u8005\u7acb\u523b\u83b7\u5f97\u9501\uff0c\u4ecd\u9700\u8fdb\u5165  EntryList \u91cd\u65b0\u7ade\u4e89</li> </ul> \u65b9\u6cd5 \u4f5c\u7528 \u8bf4\u660e <code>wait()</code> \u8ba9\u5f53\u524d\u7ebf\u7a0b\u8fdb\u5165\u7b49\u5f85\u72b6\u6001 \u91ca\u653e\u9501\uff0c\u8fdb\u5165\u7b49\u5f85\u961f\u5217\uff0c\u76f4\u5230\u88ab <code>notify()</code>/<code>notifyAll()</code> \u5524\u9192\u6216\u8d85\u65f6 <code>notify()</code> \u968f\u673a\u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7ebf\u7a0b \u4ece\u7b49\u5f85\u961f\u5217\u4e2d\u9009\u62e9\u4e00\u4e2a\u7ebf\u7a0b\u5524\u9192\uff08\u4e0d\u4fdd\u8bc1\u516c\u5e73\u6027\uff09 <code>notifyAll()</code> \u5524\u9192\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b \u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u7ade\u4e89\u9501\uff0c\u53ea\u6709\u4e00\u4e2a\u80fd\u7ee7\u7eed\u6267\u884c <p>\u6ce8\u610f</p> <p>\u5b83\u4eec\u5fc5\u987b\u5728 <code>synchronized</code> \u4ee3\u7801\u5757\u6216\u65b9\u6cd5\u4e2d\u4f7f\u7528\u3002</p> <p>\u8c03\u7528 <code>wait()/notify()</code> \u524d\uff0c\u7ebf\u7a0b\u5fc5\u987b\u6301\u6709\u8be5\u5bf9\u8c61\u7684\u9501\uff0c\u5426\u5219\u4f1a\u629b\u51fa <code>IllegalMonitorStateException</code>\u3002</p> <p></p> <p><code>wait()</code> \u548c <code>sleep()</code> \u7684\u533a\u522b</p> <code>wait()</code> <code>sleep()</code> \u91ca\u653e\u9501 \u4e0d\u91ca\u653e\u9501 \u5c5e\u4e8e <code>Object</code> \u7c7b \u5c5e\u4e8e <code>Thread</code> \u7c7b \u5fc5\u987b\u548c <code>synchronized</code> \u4e00\u8d77\u4f7f\u7528 \u53ef\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u8c03\u7528 \u53ef\u88ab <code>notify()</code> \u5524\u9192 \u53ea\u80fd\u7b49\u65f6\u95f4\u5230\u6216 <code>interrupt()</code> \u7ebf\u7a0b\u72b6\u6001 TIMED_WAITING \u7ebf\u7a0b\u72b6\u6001 TIMED_WAITING <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u865a\u5047\u5524\u9192","title":"\u865a\u5047\u5524\u9192","text":"<p>\u865a\u5047\u5524\u9192\u662f\u6307\u7ebf\u7a0b\u5728\u6ca1\u6709\u6536\u5230\u660e\u786e\u901a\u77e5\u7684\u60c5\u51b5\u4e0b\u4ece\u7b49\u5f85\u72b6\u6001\u4e2d\u88ab\u5524\u9192\u7684\u73b0\u8c61\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u865a\u5047\u5524\u9192\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\uff1a</p> <ol> <li> <p>\u603b\u662f\u5728\u5faa\u73af\u4e2d\u68c0\u67e5\u6761\u4ef6\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684if\u8bed\u53e5</p> </li> <li> <p>\u4f7f\u7528while\u5faa\u73af\u800c\u4e0d\u662fif\u6765\u68c0\u67e5\u6761\u4ef6\u53d8\u91cf</p> </li> </ol> <p>\u793a\u4f8b\u4ee3\u7801:</p> <pre><code>// \u4e0d\u5b89\u5168\u7684\u5199\u6cd5 - \u53ef\u80fd\u56e0\u865a\u5047\u5524\u9192\u5bfc\u81f4\u95ee\u9898\nsynchronized(lock) {\n    if(!condition) {\n        lock.wait();\n    }\n    // \u6267\u884c\u64cd\u4f5c\n}\n\n// \u6b63\u786e\u7684\u5199\u6cd5 - \u9632\u6b62\u865a\u5047\u5524\u9192\nsynchronized(lock) {\n    while(!condition) {  // \u4f7f\u7528while\u5faa\u73af\n        lock.wait();\n    }\n    // \u6267\u884c\u64cd\u4f5c\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u4fdd\u62a4\u6027\u6682\u505c","title":"\u4fdd\u62a4\u6027\u6682\u505c","text":"<p>\u4fdd\u62a4\u6027\u6682\u505c\u662f\u4e00\u79cd\u591a\u7ebf\u7a0b\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6ee1\u8db3\u540e\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u7684\u60c5\u51b5\u3002</p> <p>\u4fdd\u62a4\u6027\u6682\u505c\u6a21\u5f0f\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a</p> <ul> <li>\u4fdd\u62a4\u6761\u4ef6\uff1a\u7ebf\u7a0b\u6267\u884c\u524d\u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6</li> <li>\u6682\u505c\u673a\u5236\uff1a\u5f53\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\uff0c\u7ebf\u7a0b\u4e3b\u52a8\u6682\u505c\u6267\u884c</li> <li>\u6062\u590d\u673a\u5236\uff1a\u5f53\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u7ebf\u7a0b\u88ab\u5524\u9192\u7ee7\u7eed\u6267\u884c</li> </ul> <p>\u793a\u4f8b\u4ee3\u7801:</p> <pre><code>public class GuardedObject {\n    private Object response;\n\n    /**\n     * \u83b7\u53d6\u7ed3\u679c\n     * @param timeout \u8d85\u65f6\u65f6\u95f4\n     * @return \u7ed3\u679c\n     */\n    public Object get(long timeout){\n        synchronized(this) {\n            long remaining = timeout;\n            long endTime = System.currentTimeMillis() + timeout;\n\n            while(response == null &amp;&amp; remaining &gt; 0) {\n                try {\n                    this.wait(remaining);\n                } catch (InterruptedException e) {\n                    Thread.currentThread().interrupt();\n                    throw new RuntimeException(e);\n                }\n                // \u865a\u5047\u5524\u9192\u65f6\u5269\u4f59\u7b49\u5f85\u65f6\u95f4\n                remaining = endTime - System.currentTimeMillis();\n            }\n            return response;\n        }\n    }\n\n    public void complete(Object response) {\n        synchronized(this) {\n            this.response = response;\n            this.notifyAll();\n        }\n    }\n}\n</code></pre> <p>Info</p> <p><code>join()</code>\u65b9\u6cd5\u5e95\u5c42\u5c31\u662f\u901a\u8fc7\u8be5\u65b9\u5f0f\u5b9e\u73b0\u7684</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u5f0f","title":"\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u5f0f","text":"<ul> <li>\u4e0e\u524d\u9762\u7684\u4fdd\u62a4\u6027\u6682\u505c\u4e2d\u7684 GuardObject \u4e0d\u540c\uff0c\u4e0d\u9700\u8981\u4ea7\u751f\u7ed3\u679c\u548c\u6d88\u8d39\u7ed3\u679c\u7684\u7ebf\u7a0b\u4e00\u4e00\u5bf9\u5e94 </li> <li>\u6d88\u8d39\u961f\u5217\u53ef\u4ee5\u7528\u6765\u5e73\u8861\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u7ebf\u7a0b\u8d44\u6e90 </li> <li>\u751f\u4ea7\u8005\u4ec5\u8d1f\u8d23\u4ea7\u751f\u7ed3\u679c\u6570\u636e\uff0c\u4e0d\u5173\u5fc3\u6570\u636e\u8be5\u5982\u4f55\u5904\u7406\uff0c\u800c\u6d88\u8d39\u8005\u4e13\u5fc3\u5904\u7406\u7ed3\u679c\u6570\u636e </li> <li>\u6d88\u606f\u961f\u5217\u662f\u6709\u5bb9\u91cf\u9650\u5236\u7684\uff0c\u6ee1\u65f6\u4e0d\u4f1a\u518d\u52a0\u5165\u6570\u636e\uff0c\u7a7a\u65f6\u4e0d\u4f1a\u518d\u6d88\u8017\u6570\u636e </li> <li>JDK \u4e2d\u5404\u79cd\u963b\u585e\u961f\u5217\uff0c\u91c7\u7528\u7684\u5c31\u662f\u8fd9\u79cd\u6a21\u5f0f</li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>@Slf4j\npublic class TestMessageQueue {\n\n    public static void main(String[] args) throws InterruptedException {\n        MessageQueue queue = new MessageQueue(2);\n\n        for (int i = 0; i &lt; 3; i++) {\n            int id = i;\n            new Thread(() -&gt; {\n                log.info(\"\u751f\u4ea7\u8005{}\u5f00\u59cb\u751f\u4ea7\u6d88\u606f\", id);\n                queue.put(new Message(id, \"\u6d88\u606f\" + id));\n            }, \"\u751f\u4ea7\u8005\" + i).start();\n        }\n\n        Thread.sleep(1000);\n\n        new Thread(() -&gt; {\n            while (true) {\n                try {\n                    Thread.sleep(500);\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n                Message msg = queue.take();\n                log.info(\"\u6d88\u8d39\u8005\u5f00\u59cb\u6d88\u8d39\u6d88\u606f\uff1a{}\", msg.getValue());\n            }\n        }, \"\u6d88\u8d39\u8005\").start();\n    }\n\n}\n\n@Slf4j\nclass MessageQueue {\n\n    /**\n     * \u961f\u5217\u5bb9\u91cf\n     */\n    private final int capacity;\n\n    /**\n     * \u6d88\u606f\u961f\u5217\n     */\n    private final LinkedList&lt;Message&gt; list;\n\n    public MessageQueue(int capacity) {\n        this.capacity = capacity;\n        list = new LinkedList&lt;&gt;();\n    }\n\n    /**\n     * \u83b7\u53d6\u6d88\u606f\n     * @return \u6d88\u606f\n     */\n    public Message take() {\n        synchronized (list) {\n            // \u961f\u5217\u4e3a\u7a7a\uff0c\u7b49\u5f85\u751f\u4ea7\u8005\u751f\u4ea7\n            while (list.isEmpty()) {\n                log.info(\"\u961f\u5217\u4e3a\u7a7a\uff0c\u7b49\u5f85\u751f\u4ea7\u8005\u751f\u4ea7\");\n                try {\n                    list.wait();\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            Message message = list.removeFirst();\n            list.notifyAll();\n            return message;\n        }\n    }\n\n    /**\n     * \u653e\u5165\u6d88\u606f\n     * @param message \u6d88\u606f\n     */\n    public void put(Message message) {\n        synchronized (list) {\n            // \u961f\u5217\u5df2\u6ee1\uff0c\u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\n            while (list.size() == capacity) {\n                log.info(\"\u961f\u5217\u5df2\u6ee1\uff0c\u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\");\n                try {\n                    list.wait();\n                } catch (InterruptedException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n            list.addLast(message);\n            list.notifyAll();\n        }\n    }\n\n}\n\n@Getter\nclass Message {\n    private final int id;\n    private final Object value;\n\n    public Message(int id, Object value) {\n        this.id = id;\n        this.value = value;\n    }\n\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#parkunpark","title":"park/unpark","text":"<p>\u5b83\u4eec\u662f LockSupport \u7c7b\u4e2d\u7684\u65b9\u6cd5</p> <pre><code>// \u6682\u505c\u5f53\u524d\u7ebf\u7a0b\nLockSupport.park();\n\n// \u6062\u590d\u67d0\u4e2a\u7ebf\u7a0b\u7684\u8fd0\u884c\nLockSupport.unpark(\u6682\u505c\u7ebf\u7a0b\u5bf9\u8c61);\n</code></pre> <p>\u4e0e Object \u7684 wait &amp; notify \u76f8\u6bd4</p> <ul> <li>wait\uff0cnotify \u548c notifyAll \u5fc5\u987b\u914d\u5408 Object Monitor \u4e00\u8d77\u4f7f\u7528\uff0c\u800c park\uff0cunpark \u4e0d\u9700\u8981</li> <li>park &amp; unpark \u662f\u4ee5\u7ebf\u7a0b\u4e3a\u5355\u4f4d\u6765\u3010\u963b\u585e\u3011\u548c\u3010\u5524\u9192\u3011\u7ebf\u7a0b\uff0c\u800c notify \u53ea\u80fd\u968f\u673a\u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7ebf\u7a0b\uff0cnotifyAll  \u662f\u5524\u9192\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\uff0c\u5c31\u4e0d\u90a3\u4e48\u3010\u7cbe\u786e\u3011</li> <li>park &amp; unpark \u53ef\u4ee5\u5148\u6267\u884c unpark\uff0c\u800c wait &amp; notify \u4e0d\u80fd\u5148 notify</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u539f\u7406","title":"\u539f\u7406","text":"<p>\u8bb8\u53ef\u673a\u5236\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u5173\u8054\u7684\u8bb8\u53ef(\u6700\u591a\u4e00\u4e2a)</p> <ul> <li><code>unpark()</code>\u63d0\u4f9b\u8bb8\u53ef</li> <li><code>park()</code>\u6d88\u8017\u8bb8\u53ef</li> </ul> <p>\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u4e2a Parker \u5bf9\u8c61\uff08\u975eJava\u8bed\u8a00\u5b9e\u73b0\uff09\uff0c\u7531\u4e09\u90e8\u5206\u7ec4\u6210  _counter \uff0c _cond \u548c  _mutex</p> <p></p> <ol> <li>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528 Unsafe.park() \u65b9\u6cd5</li> <li>\u68c0\u67e5 _counter \uff0c\u672c\u60c5\u51b5\u4e3a 0\uff0c\u8fd9\u65f6\uff0c\u83b7\u5f97 _mutex \u4e92\u65a5\u9501 </li> <li>\u7ebf\u7a0b\u8fdb\u5165 _cond \u6761\u4ef6\u53d8\u91cf\u963b\u585e</li> <li>\u8bbe\u7f6e _counter = 0</li> </ol> <p></p> <ol> <li>\u8c03\u7528 Unsafe.unpark(Thread_0) \u65b9\u6cd5\uff0c\u8bbe\u7f6e _counter \u4e3a 1 </li> <li>\u5524\u9192 _cond \u6761\u4ef6\u53d8\u91cf\u4e2d\u7684 Thread_0 </li> <li>Thread_0 \u6062\u590d\u8fd0\u884c</li> <li>\u8bbe\u7f6e _counter \u4e3a 0</li> </ol> <p></p> <ol> <li>\u8c03\u7528 Unsafe.unpark(Thread_0) \u65b9\u6cd5\uff0c\u8bbe\u7f6e _counter \u4e3a 1 </li> <li>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528 Unsafe.park() \u65b9\u6cd5 </li> <li>\u68c0\u67e5 _counter \uff0c\u672c\u60c5\u51b5\u4e3a 1\uff0c\u8fd9\u65f6\u7ebf\u7a0b\u65e0\u9700\u963b\u585e\uff0c\u7ee7\u7eed\u8fd0\u884c </li> <li>\u8bbe\u7f6e _counter \u4e3a 0</li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362","title":"\u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-1-new----runnable","title":"\u60c5\u51b5 1  NEW --&gt; RUNNABLE","text":"<p>\u5f53\u8c03\u7528  t.start() \u65b9\u6cd5\u65f6\uff0c\u7531  NEW --&gt; RUNNABLE </p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-2-runnable--waiting","title":"\u60c5\u51b5 2  RUNNABLE &lt;--&gt; WAITING","text":"<p>\u7ebf\u7a0b\u7528  <code>synchronized(obj)</code>  \u83b7\u53d6\u4e86\u5bf9\u8c61\u9501\u540e </p> <ul> <li>\u8c03\u7528 <code>obj.wait()</code> \u65b9\u6cd5\u65f6\uff0ct \u7ebf\u7a0b\u4ece RUNNABLE --&gt; WAITING</li> <li>\u8c03\u7528 <code>obj.notify()</code> \uff0c <code>obj.notifyAll()</code> \uff0c<code>t.interrupt()</code> \u65f6<ul> <li>\u7ade\u4e89\u9501\u6210\u529f\uff0ct \u7ebf\u7a0b\u4ece   WAITING --&gt; RUNNABLE  </li> <li>\u7ade\u4e89\u9501\u5931\u8d25\uff0ct \u7ebf\u7a0b\u4ece   WAITING --&gt; BLOCKED </li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-3-runnable--waiting","title":"\u60c5\u51b5 3  RUNNABLE &lt;--&gt; WAITING","text":"<ul> <li> <p>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528  <code>t.join()</code> \u65b9\u6cd5\u65f6\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece  RUNNABLE --&gt; WAITING </p> <ul> <li>\u6ce8\u610f\u662f\u5f53\u524d\u7ebf\u7a0b\u5728t \u7ebf\u7a0b\u5bf9\u8c61\u7684\u76d1\u89c6\u5668\u4e0a\u7b49\u5f85</li> </ul> </li> <li> <p>t \u7ebf\u7a0b\u8fd0\u884c\u7ed3\u675f\uff0c\u6216\u8c03\u7528\u4e86\u5f53\u524d\u7ebf\u7a0b\u7684  <code>interrupt()</code> \u65f6\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece WAITING --&gt; RUNNABLE</p> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-4-runnable--waiting","title":"\u60c5\u51b5 4  RUNNABLE &lt;--&gt; WAITING","text":"<ul> <li>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528 <code>LockSupport.park()</code> \u65b9\u6cd5\u4f1a\u8ba9\u5f53\u524d\u7ebf\u7a0b\u4ece  RUNNABLE --&gt; WAITING</li> <li>\u8c03\u7528  <code>LockSupport.unpark(\u76ee\u6807\u7ebf\u7a0b)</code> \u6216\u8c03\u7528\u4e86\u7ebf\u7a0b \u7684  <code>interrupt()</code> \uff0c\u4f1a\u8ba9\u76ee\u6807\u7ebf\u7a0b\u4ece  WAITING --&gt;RUNNABLE</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-5-runnable--timed_waiting","title":"\u60c5\u51b5 5  RUNNABLE &lt;--&gt; TIMED_WAITING","text":"<p>\u7ebf\u7a0b\u7528  <code>synchronized(obj)</code> \u83b7\u53d6\u4e86\u5bf9\u8c61\u9501\u540e </p> <ul> <li>\u8c03\u7528  <code>obj.wait(long n)</code> \u65b9\u6cd5\u65f6\uff0ct \u7ebf\u7a0b\u4ece  RUNNABLE --&gt; TIMED_WAITING</li> <li>t \u7ebf\u7a0b\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u4e86 n \u6beb\u79d2\uff0c\u6216\u8c03\u7528  <code>obj.notify()</code> \uff0c <code>obj.notifyAll()</code> ,<code>t.interrupt()</code> \u65f6<ul> <li>\u7ade\u4e89\u9501\u6210\u529f\uff0ct \u7ebf\u7a0b\u4ece   TIMED_WAITING --&gt; RUNNABLE  </li> <li>\u7ade\u4e89\u9501\u5931\u8d25\uff0ct \u7ebf\u7a0b\u4ece   TIMED_WAITING --&gt; BLOCKED</li> </ul> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-6-runnable--timed_waiting","title":"\u60c5\u51b5 6  RUNNABLE &lt;--&gt; TIMED_WAITING","text":"<ul> <li> <p>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528 <code>t.join(long n)</code> \u65b9\u6cd5\u65f6\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece  RUNNABLE --&gt; TIMED_WAITING</p> </li> <li> <p>\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u4e86 n \u6beb\u79d2\uff0c\u6216t \u7ebf\u7a0b\u8fd0\u884c\u7ed3\u675f\uff0c\u6216\u8c03\u7528\u4e86\u5f53\u524d\u7ebf\u7a0b\u7684  <code>interrupt()</code> \u65f6\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece TIMED_WAITING --&gt; RUNNABLE</p> </li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-7-runnable--timed_waiting","title":"\u60c5\u51b5 7  RUNNABLE &lt;--&gt; TIMED_WAITING","text":"<ul> <li>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528  Thread.sleep(long n) \uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece  RUNNABLE --&gt; TIMED_WAITING  </li> <li>\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u4e86 n \u6beb\u79d2\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece   TIMED_WAITING --&gt; RUNNABLE</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-8-runnable--timed_waiting","title":"\u60c5\u51b5 8  RUNNABLE &lt;--&gt; TIMED_WAITING","text":"<ul> <li>\u5f53\u524d\u7ebf\u7a0b\u8c03\u7528  <code>LockSupport.parkNanos(long nanos)</code> \u6216  \u7a0b \u8c03\u7528  <code>LockSupport.parkUntil(long millis)</code>\u65f6\uff0c\u5f53\u524d\u7ebf\u7a0b\u4ece  RUNNABLE --&gt; TIMED_WAITING</li> <li>\u8c03\u7528 <code>LockSupport.unpark(\u76ee\u6807\u7ebf\u7a0b)</code> \u6216\u8c03\u7528\u4e86\u7ebf\u7a0b \u7684 <code>interrupt()</code> \uff0c\u6216\u662f\u7b49\u5f85\u8d85\u65f6\uff0c\u4f1a\u8ba9\u76ee\u6807\u7ebf\u7a0b\u4ece  TIMED_WAITING--&gt; RUNNABLE</li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-9-runnable--blocked","title":"\u60c5\u51b5 9  RUNNABLE &lt;--&gt; BLOCKED","text":"<ul> <li>t \u7ebf\u7a0b\u7528  <code>synchronized(obj)</code>\u83b7\u53d6\u4e86\u5bf9\u8c61\u9501\u65f6\u5982\u679c\u7ade\u4e89\u5931\u8d25\uff0c\u4ece   RUNNABLE --&gt; BLOCKED  </li> <li>\u6301 obj \u9501\u7ebf\u7a0b\u7684\u540c\u6b65\u4ee3\u7801\u5757\u6267\u884c\u5b8c\u6bd5\uff0c\u4f1a\u5524\u9192\u8be5\u5bf9\u8c61\u4e0a\u6240\u6709  BLOCKED  \u7684\u7ebf\u7a0b\u91cd\u65b0\u7ade\u4e89\uff0c\u5982\u679c\u5176\u4e2d t \u7ebf\u7a0b\u7ade\u4e89 \u6210\u529f\uff0c\u4ece  BLOCKED --&gt; RUNNABLE \uff0c\u5176\u5b83\u5931\u8d25\u7684\u7ebf\u7a0b\u4ecd\u7136   BLOCKED </li> </ul>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u60c5\u51b5-10-runnable--terminated","title":"\u60c5\u51b5 10  RUNNABLE &lt;--&gt; TERMINATED","text":"<p>\u5f53\u524d\u7ebf\u7a0b\u6240\u6709\u4ee3\u7801\u8fd0\u884c\u5b8c\u6bd5\uff0c\u8fdb\u5165 TERMINATED</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u591a\u628a\u9501","title":"\u591a\u628a\u9501","text":"<p>\u5f15\u4f8b\uff1a</p> <p>\u4e00\u95f4\u5927\u5c4b\u5b50\u6709\u4e24\u4e2a\u529f\u80fd\uff1a\u7761\u89c9\u3001\u5b66\u4e60\uff0c\u4e92\u4e0d\u76f8\u5e72\u3002 </p> <p>\u73b0\u5728A\u8981\u5b66\u4e60\uff0cB\u8981\u7761\u89c9\uff0c\u4f46\u5982\u679c\u53ea\u7528\u4e00\u95f4\u5c4b\u5b50\uff08\u4e00\u4e2a\u5bf9\u8c61\u9501\uff09\u7684\u8bdd\uff0c\u90a3\u4e48\u5e76\u53d1\u5ea6\u5f88\u4f4e </p> <p>\u89e3\u51b3\u65b9\u6cd5\u662f\u51c6\u5907\u591a\u4e2a\u623f\u95f4\uff08\u591a\u4e2a\u5bf9\u8c61\u9501\uff09</p> <pre><code>class BigRoom {\n    private final Object studyRoom = new Object();\n    private final Object bedRoom = new Object();\n\n    public void sleep() {\n        synchronized (bedRoom) {\n            log.debug(\"sleeping 2 \u5c0f\u65f6\");\n            Sleeper.sleep(2);\n        }\n    }\n\n    public void study() {\n        synchronized (studyRoom) {\n            log.debug(\"study 1 \u5c0f\u65f6\");\n            Sleeper.sleep(1);\n        }\n    }\n}\n</code></pre> <p>\u5c06\u9501\u7684\u7c92\u5ea6\u7ec6\u5206 </p> <ul> <li>\u597d\u5904\uff0c\u53ef\u4ee5\u589e\u5f3a\u5e76\u53d1\u5ea6 </li> <li>\u574f\u5904\uff0c\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u540c\u65f6\u83b7\u5f97\u591a\u628a\u9501\uff0c\u5c31\u5bb9\u6613\u53d1\u751f\u6b7b\u9501</li> </ul> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6d3b\u8dc3\u6027","title":"\u6d3b\u8dc3\u6027","text":""},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6b7b\u9501","title":"\u6b7b\u9501","text":"<p>\u6b7b\u9501\u662f\u6307\u4e24\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u4e89\u593a\u8d44\u6e90\u800c\u9020\u6210\u7684\u4e00\u79cd\u4e92\u76f8\u7b49\u5f85\u7684\u73b0\u8c61\uff0c\u82e5\u65e0\u5916\u529b\u5e72\u6d89\uff0c\u5b83\u4eec\u90fd\u5c06\u65e0\u6cd5\u63a8\u8fdb\u4e0b\u53bb\u3002</p> <p>\u6b7b\u9501\u56db\u8981\u7d20\uff1a</p> <ol> <li>\u4e92\u65a5\uff1a\u8d44\u6e90\u4e00\u6b21\u53ea\u80fd\u88ab\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u5360\u7528</li> <li>\u6301\u6709\u5e76\u7b49\u5f85\uff1a\u8fdb\u7a0b/\u7ebf\u7a0b\u5728\u6301\u6709\u81f3\u5c11\u4e00\u4e2a\u8d44\u6e90\u7684\u540c\u65f6\uff0c\u8fd8\u5728\u7b49\u5f85\u83b7\u53d6\u5176\u4ed6\u88ab\u5360\u7528\u7684\u8d44\u6e90\u3002</li> <li>\u975e\u62a2\u5360\u6761\u4ef6\uff1a\u5df2\u5206\u914d\u7ed9\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u8d44\u6e90\u4e0d\u80fd\u88ab\u5176\u4ed6\u8fdb\u7a0b\u5f3a\u884c\u593a\u53d6</li> <li>\u5faa\u73af\u7b49\u5f85\uff1a\u5b58\u5728\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u5faa\u73af\u94fe\uff0c\u94fe\u4e2d\u7684\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5728\u7b49\u5f85\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u6240\u5360\u7528\u7684\u8d44\u6e90\u3002</li> </ol> <p></p> <p>\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u540c\u65f6\u83b7\u53d6\u591a\u628a\u9501\uff0c\u5c31\u5bb9\u6613\u53d1\u751f\u6b7b\u9501</p> <p>\u4f8b\u5982\uff1a</p> <ul> <li> <p>t1 \u7ebf\u7a0b\u5148\u83b7\u5f97 A \u5bf9\u8c61\u9501\uff0c\u63a5\u4e0b\u6765\u60f3\u83b7\u53d6 B \u5bf9\u8c61\u9501  </p> </li> <li> <p>t2 \u7ebf\u7a0b\u5148\u83b7\u5f97 B \u5bf9\u8c61\u9501\uff0c\u63a5\u4e0b\u6765\u60f3\u83b7\u53d6 A \u5bf9\u8c61\u9501 </p> </li> </ul> <p>\u8fd9\u6837\u5c31\u9020\u6210\u4e86t1\u548ct2\u76f8\u4e92\u7b49\u5f85</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u5b9a\u4f4d\u6b7b\u9501","title":"\u5b9a\u4f4d\u6b7b\u9501","text":"<p>\u68c0\u6d4b\u6b7b\u9501\u53ef\u4ee5\u4f7f\u7528 jconsole \u5de5\u5177\uff0c\u6216\u8005\u4f7f\u7528 jps \u5b9a\u4f4d\u8fdb\u7a0b id\uff0c\u518d\u7528 jstack \u5b9a\u4f4d\u6b7b\u9501</p> <p>\u68c0\u6d4b\u5230\u6b7b\u9501\u8f93\u51fa\uff1a</p> <pre><code>Found one Java-level deadlock:\n...\n</code></pre> <p>Note</p> <p>\u7834\u574f\u6b7b\u9501\u56db\u8981\u7d20\u4e2d\u4efb\u610f\u4e00\u4e2a\u5373\u53ef\u89e3\u51b3\u6b7b\u9501</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u54f2\u5b66\u5bb6\u5c31\u9910\u95ee\u9898","title":"\u54f2\u5b66\u5bb6\u5c31\u9910\u95ee\u9898","text":"<p>\u95ee\u9898\u573a\u666f\u8bbe\u5b9a\u5982\u4e0b\uff1a</p> <ul> <li>\u4e94\u4f4d\u54f2\u5b66\u5bb6\u56f4\u5750\u5728\u4e00\u5f20\u5706\u684c\u5468\u56f4</li> <li>\u6bcf\u4f4d\u54f2\u5b66\u5bb6\u9762\u524d\u6709\u4e00\u76d8\u98df\u7269</li> <li>\u6bcf\u4e24\u4f4d\u54f2\u5b66\u5bb6\u4e4b\u95f4\u653e\u6709\u4e00\u6839\u7b77\u5b50(\u5171\u4e94\u6839)</li> <li>\u54f2\u5b66\u5bb6\u53ea\u6709\u540c\u65f6\u62ff\u5230\u5de6\u53f3\u4e24\u8fb9\u7684\u7b77\u5b50\u624d\u80fd\u8fdb\u9910</li> <li>\u8fdb\u9910\u7ed3\u675f\u540e\u4f1a\u653e\u4e0b\u7b77\u5b50\u7ee7\u7eed\u601d\u8003</li> </ul> <p></p> <p>\u95ee\u9898\u7684\u5173\u952e\u5728\u4e8e\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u7b97\u6cd5\uff0c\u4f7f\u5f97\uff1a</p> <ol> <li>\u4e0d\u4f1a\u53d1\u751f\u6b7b\u9501(\u6240\u6709\u54f2\u5b66\u5bb6\u90fd\u62ff\u7740\u4e00\u6839\u7b77\u5b50\u7b49\u5f85\u53e6\u4e00\u6839)</li> <li>\u4e0d\u4f1a\u53d1\u751f\u9965\u997f(\u67d0\u4e9b\u54f2\u5b66\u5bb6\u6c38\u8fdc\u65e0\u6cd5\u8fdb\u9910)</li> <li>\u5141\u8bb8\u6700\u5927\u7a0b\u5ea6\u7684\u5e76\u884c(\u5c3d\u53ef\u80fd\u591a\u7684\u54f2\u5b66\u5bb6\u540c\u65f6\u8fdb\u9910)</li> </ol> <p>\u89e3\u51b3\u65b9\u6848</p> <ol> <li>\u8d44\u6e90\u8bf7\u6c42\u987a\u5e8f\uff1a\u89c4\u5b9a\u54f2\u5b66\u5bb6\u5fc5\u987b\u6309\u7167\u4e00\u5b9a\u987a\u5e8f\u8bf7\u6c42\u7b77\u5b50\uff0c\u4f8b\u5982\uff1a\u5148\u62ff\u5de6\u8fb9\u7684\u7b77\u5b50\uff0c\u518d\u62ff\u53f3\u8fb9\u7684\u7b77\u5b50\u3002\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5faa\u73af\u7b49\u5f85\u3002</li> <li>\u9650\u5236\u5e76\u53d1\uff1a\u9650\u5236\u540c\u65f6\u8fdb\u9910\u7684\u54f2\u5b66\u5bb6\u6570\u91cf\uff0c\u4f8b\u5982\uff1a\u6700\u591a\u5141\u8bb8 4 \u4f4d\u54f2\u5b66\u5bb6\u540c\u65f6\u8fdb\u9910\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u7ade\u4e89\u3002</li> <li>\u968f\u673a\u7b49\u5f85\uff1a\u5728\u8bf7\u6c42\u7b77\u5b50\u5931\u8d25\u65f6\uff0c\u54f2\u5b66\u5bb6\u53ef\u4ee5\u968f\u673a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u5c1d\u8bd5\uff0c\u8fd9\u6837\u53ef\u4ee5\u964d\u4f4e\u51b2\u7a81\u6982\u7387\u3002</li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6d3b\u9501","title":"\u6d3b\u9501","text":"<p>\u6d3b\u9501\u662f\u591a\u7ebf\u7a0b\u6216\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\u73b0\u8c61\uff0c\u4e0e\u6b7b\u9501\u7c7b\u4f3c\u4f46\u53c8\u6709\u91cd\u8981\u533a\u522b\u3002</p> <p>\u5728\u6d3b\u9501\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u6216\u8fdb\u7a0b\u5e76\u6ca1\u6709\u88ab\u963b\u585e\uff0c\u800c\u662f\u5728\u4e0d\u65ad\u5730\u5c1d\u8bd5\u89e3\u51b3\u51b2\u7a81\uff0c\u4f46\u7531\u4e8e\u5f7c\u6b64\u4e4b\u95f4\u7684\u76f8\u4e92\u8ba9\u6b65\u6216\u534f\u8c03\u4e0d\u5f53\uff0c\u5bfc\u81f4\u7cfb\u7edf\u65e0\u6cd5\u7ee7\u7eed\u5411\u524d\u63a8\u8fdb\u3002</p> <p>\u6d3b\u9501\u4e0e\u6b7b\u9501\u7684\u533a\u522b</p> \u7279\u6027 \u6b7b\u9501(Deadlock) \u6d3b\u9501(Livelock) \u7ebf\u7a0b\u72b6\u6001 \u7ebf\u7a0b\u88ab\u963b\u585e\uff0c\u4e0d\u6267\u884c\u4efb\u4f55\u64cd\u4f5c \u7ebf\u7a0b\u4ecd\u5728\u6267\u884c\uff0c\u4f46\u6ca1\u6709\u8fdb\u5c55 \u8d44\u6e90\u5360\u7528 \u8d44\u6e90\u88ab\u6c38\u4e45\u5360\u7528 \u8d44\u6e90\u53ef\u80fd\u88ab\u4e0d\u65ad\u83b7\u53d6\u548c\u91ca\u653e CPU\u4f7f\u7528 \u4f4e \u9ad8(\u56e0\u4e3a\u7ebf\u7a0b\u4ecd\u5728\u5fd9\u788c) \u8868\u73b0\u5f62\u5f0f \u5b8c\u5168\u505c\u6b62 \u770b\u4f3c\u5fd9\u788c\u4f46\u65e0\u5b9e\u9645\u8fdb\u5c55 <p></p> <p>\u6d3b\u9501\u7684\u5178\u578b\u573a\u666f</p> <ol> <li>\u8fc7\u5ea6\u793c\u8c8c\u7684\u54f2\u5b66\u5bb6\uff1a\u5728\u54f2\u5b66\u5bb6\u5c31\u9910\u95ee\u9898\u4e2d\uff0c\u5982\u679c\u6240\u6709\u54f2\u5b66\u5bb6\u540c\u65f6\u62ff\u8d77\u5de6\u8fb9\u7684\u7b77\u5b50\uff0c\u53d1\u73b0\u53f3\u8fb9\u7684\u7b77\u5b50\u4e0d\u53ef\u7528\uff0c\u7136\u540e\u540c\u65f6\u653e\u4e0b\u5de6\u8fb9\u7684\u7b77\u5b50\uff0c\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u6b21\u5c1d\u8bd5\uff0c\u5982\u6b64\u5faa\u73af\u3002</li> <li>\u6d88\u606f\u91cd\u8bd5\u673a\u5236\uff1a\u4e24\u4e2a\u8fdb\u7a0b\u4e92\u76f8\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u606f\u4e22\u5931\u540e\u90fd\u91cd\u8bd5\uff0c\u4f46\u91cd\u8bd5\u65f6\u95f4\u540c\u6b65\u5bfc\u81f4\u6301\u7eed\u51b2\u7a81\u3002</li> <li>\u8d44\u6e90\u5206\u914d\u7b56\u7565\uff1a\u591a\u4e2a\u7ebf\u7a0b\u5728\u68c0\u6d4b\u5230\u51b2\u7a81\u65f6\u90fd\u4e3b\u52a8\u91ca\u653e\u8d44\u6e90\u5e76\u91cd\u8bd5\uff0c\u5bfc\u81f4\u6301\u7eed\u7684\u8d44\u6e90\u7ade\u4e89\u5faa\u73af\u3002</li> </ol> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u9965\u997f","title":"\u9965\u997f","text":"<p>\u9965\u997f\uff08Starvation\uff09\u662f\u591a\u7ebf\u7a0b\u6216\u8d44\u6e90\u5206\u914d\u7cfb\u7edf\u4e2d\u4e00\u79cd\u73b0\u8c61\uff0c\u6307\u7684\u662f\u67d0\u4e9b\u7ebf\u7a0b\u6216\u8fdb\u7a0b\u7531\u4e8e\u957f\u671f\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u8d44\u6e90\u800c\u65e0\u6cd5\u6267\u884c\uff0c\u800c\u5176\u4ed6\u7ebf\u7a0b\u5374\u80fd\u6b63\u5e38\u6267\u884c\u3002</p> <p>\u9965\u997f\u4e0d\u540c\u4e8e\u6b7b\u9501\uff08Deadlock\uff09\u548c\u6d3b\u9501\uff08Livelock\uff09\uff0c\u56e0\u4e3a\u9965\u997f\u7684\u7ebf\u7a0b\u6ca1\u6709\u88ab\u963b\u585e\uff0c\u800c\u662f\u4e00\u76f4\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u4f46\u5f97\u4e0d\u5230\u8c03\u5ea6\u3002</p> <p>\u9965\u997f vs. \u6b7b\u9501 vs. \u6d3b\u9501</p> \u7279\u6027 \u6b7b\u9501 (Deadlock) \u6d3b\u9501 (Livelock) \u9965\u997f (Starvation) \u7ebf\u7a0b\u72b6\u6001 \u5b8c\u5168\u963b\u585e\uff08\u4e0d\u6267\u884c\uff09 \u6301\u7eed\u6267\u884c\u4f46\u65e0\u8fdb\u5c55 \u53ef\u8fd0\u884c\u4f46\u5f97\u4e0d\u5230\u8d44\u6e90 \u8d44\u6e90\u5360\u7528 \u8d44\u6e90\u88ab\u6c38\u4e45\u5360\u7528 \u8d44\u6e90\u53ef\u80fd\u88ab\u53cd\u590d\u83b7\u53d6\u548c\u91ca\u653e \u8d44\u6e90\u88ab\u9ad8\u4f18\u5148\u7ea7\u7ebf\u7a0b\u62a2\u5360 CPU\u4f7f\u7528 \u4f4e\uff08\u7ebf\u7a0b\u963b\u585e\uff09 \u9ad8\uff08\u7ebf\u7a0b\u5fd9\u788c\u4f46\u65e0\u8fdb\u5c55\uff09 \u53ef\u80fd\u9ad8\uff08\u7ebf\u7a0b\u5728\u7b49\u5f85\uff09 \u89e3\u51b3\u65b9\u6848 \u7834\u574f\u6b7b\u9501\u6761\u4ef6 \u5f15\u5165\u968f\u673a\u6027/\u4f18\u5148\u7ea7 \u516c\u5e73\u8c03\u5ea6/\u907f\u514d\u4f18\u5148\u7ea7\u53cd\u8f6c <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>1. \u516c\u5e73\u8c03\u5ea6\uff08Fairness\uff09</p> <ul> <li>\u4f7f\u7528\u516c\u5e73\u9501\uff08<code>ReentrantLock(true)</code>\uff09\uff1a</li> </ul> <pre><code>ReentrantLock fairLock = new ReentrantLock(true); // \u516c\u5e73\u9501\n</code></pre> <ul> <li>\u7ebf\u7a0b\u6c60\u4f7f\u7528\u516c\u5e73\u961f\u5217\uff08\u5982<code>newFixedThreadPool</code> + <code>LinkedBlockingQueue</code>\uff09\u3002</li> </ul> <p>2. \u907f\u514d\u4f18\u5148\u7ea7\u53cd\u8f6c\uff08Priority Inversion\uff09</p> <ul> <li>\u5728\u5b9e\u65f6\u7cfb\u7edf\u4e2d\uff08\u5982RTOS\uff09\uff0c\u786e\u4fdd\u4f4e\u4f18\u5148\u7ea7\u4efb\u52a1\u4e0d\u4f1a\u88ab\u65e0\u9650\u62a2\u5360\u3002</li> <li>\u4f7f\u7528\u4f18\u5148\u7ea7\u7ee7\u627f\uff08Priority Inheritance\uff09\u6216\u4f18\u5148\u7ea7\u5929\u82b1\u677f\uff08Priority Ceiling\uff09\u534f\u8bae\u3002</li> </ul> <p>3. \u65f6\u95f4\u7247\u8f6e\u8f6c\uff08Round-Robin Scheduling\uff09</p> <ul> <li>\u64cd\u4f5c\u7cfb\u7edf/\u7ebf\u7a0b\u8c03\u5ea6\u5668\u53ef\u4ee5\u5f3a\u5236\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u80fd\u83b7\u5f97\u6267\u884c\u673a\u4f1a\uff08\u5982Linux\u7684CFS\u8c03\u5ea6\u5668\uff09\u3002</li> </ul> <p>4. \u8d44\u6e90\u5206\u914d\u8d85\u65f6</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#reentrantlock","title":"ReentrantLock","text":"<p>\u76f8\u5bf9\u4e8e synchronized \u5b83\u5177\u5907\u5982\u4e0b\u7279\u70b9 </p> <ul> <li>\u53ef\u4e2d\u65ad </li> <li>\u53ef\u4ee5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4 </li> <li>\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u516c\u5e73\u9501 </li> <li>\u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53d8\u91cf</li> </ul> <p>\u4e0e<code>synchronized</code>\u4e00\u6837\u90fd\u662f\u53ef\u91cd\u5165\u9501</p> <p>Info</p> <p>\u53ef\u91cd\u5165\u662f\u6307\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5982\u679c\u9996\u6b21\u83b7\u5f97\u4e86\u8fd9\u628a\u9501\uff0c\u90a3\u4e48\u56e0\u4e3a\u5b83\u662f\u8fd9\u628a\u9501\u7684\u62e5\u6709\u8005\uff0c\u56e0\u6b64\u6709\u6743\u5229\u518d\u6b21\u83b7\u53d6\u8fd9\u628a\u9501</p> <p>\u57fa\u672c\u8bed\u6cd5:</p> <pre><code>reentrantLock.lock();\ntry {\n    // \u4e34\u754c\u533a\n} finally {\n    reentrantLock.unlock();\n}\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u53ef\u91cd\u5165","title":"\u53ef\u91cd\u5165","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>    private static final ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) {\n        lock.lock();\n        try {\n            log.info(\"lock acquired\");\n            method();\n        } finally {\n            log.info(\"lock released\");\n            lock.unlock();\n        }\n    }\n\n    public static void method() {\n        lock.lock();// \u91cd\u5165\n        try {\n            log.info(\"reentrant lock acquired\");\n        } finally {\n            log.info(\"reentrant lock released\");\n            lock.unlock();\n        }\n    }\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u53ef\u6253\u65ad","title":"\u53ef\u6253\u65ad","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>    private static final ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread( () -&gt; {\n            try {\n                log.info(\"\u5c1d\u8bd5\u83b7\u5f97\u9501\");\n                lock.lockInterruptibly();// \n            } catch (InterruptedException e) {\n                log.error(\"\u83b7\u53d6\u9501\u5931\u8d25\", e);\n                throw new RuntimeException(e);\n            }\n            try {\n                lock.lock();\n                log.info(\"\u5df2\u83b7\u5f97\u9501\");\n            } finally {\n                lock.unlock();\n            }\n        });\n        lock.lock();\n        t1.start();\n        t1.interrupt();\n        lock.unlock();\n    }\n</code></pre> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u9501\u8d85\u65f6","title":"\u9501\u8d85\u65f6","text":"<pre><code>    private static final ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread( () -&gt; {\n            log.info(\"\u5c1d\u8bd5\u83b7\u5f97\u9501\");\n            try {\n                if (!lock.tryLock(1, TimeUnit.SECONDS)) {\n                    log.info(\"\u5c1d\u8bd5\u83b7\u5f97\u9501\u5931\u8d25\");\n                    return;\n                }\n            } catch (InterruptedException e) {\n                log.error(\"\u83b7\u53d6\u9501\u5931\u8d25\", e);\n                return;\n            }\n            try {\n                log.info(\"\u5df2\u83b7\u5f97\u9501\");\n            } finally {\n                lock.unlock();\n            }\n        });\n        lock.lock();\n        t1.start();\n//        lock.unlock();\n    }\n</code></pre> <p>Tip</p> <p><code>lock.tryLock()</code>\u8fd4\u56de\u5e03\u5c14\u503c <code>lock.tryLock()</code>\u4e0d\u5e26\u53c2\u6570\uff0c\u65e0\u6cd5\u83b7\u5f97\u9501\u4f1a\u7acb\u523b\u5931\u8d25</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u516c\u5e73\u9501","title":"\u516c\u5e73\u9501","text":"<p><code>ReentrantLock</code>\u9ed8\u8ba4\u662f\u4e0d\u516c\u5e73\u7684\uff0c\u53ef\u901a\u8fc7</p> <pre><code>ReentrantLock lock = new ReentrantLock(true);\n</code></pre> <p>\u5c06\u5176\u8bbe\u7f6e\u4e3a\u516c\u5e73\u9501</p> <p></p>"},{"location":"%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E9%94%81/#\u6761\u4ef6\u53d8\u91cf","title":"\u6761\u4ef6\u53d8\u91cf","text":"<p><code>Condition</code> \u662f <code>ReentrantLock</code> \u63d0\u4f9b\u7684\u4e00\u79cd\u7ebf\u7a0b\u7b49\u5f85/\u5524\u9192\u673a\u5236\uff0c\u7c7b\u4f3c\u4e8e <code>Object.wait()</code> \u548c <code>Object.notify()</code>\uff0c\u4f46\u66f4\u5f3a\u5927\uff1a</p> <ul> <li>\u4e00\u4e2a <code>ReentrantLock</code> \u53ef\u4ee5\u521b\u5efa\u591a\u4e2a <code>Condition</code>\uff0c\u5b9e\u73b0\u4e0d\u540c\u6761\u4ef6\u7684\u7b49\u5f85\u961f\u5217\u3002</li> <li>\u9002\u7528\u4e8e\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u3001\u7ebf\u7a0b\u6c60\u4efb\u52a1\u8c03\u5ea6\u7b49\u573a\u666f\u3002</li> </ul> \u65b9\u6cd5 \u8bf4\u660e <code>await()</code> \u91ca\u653e\u9501\u5e76\u8fdb\u5165\u7b49\u5f85\uff08\u7c7b\u4f3c <code>wait()</code>\uff09 <code>awaitUninterruptibly()</code> \u4e0d\u53ef\u4e2d\u65ad\u7684\u7b49\u5f85 <code>awaitNanos(long nanos)</code> \u8d85\u65f6\u7b49\u5f85\uff08\u7eb3\u79d2\u7ea7\uff09 <code>await(long time, TimeUnit unit)</code> \u8d85\u65f6\u7b49\u5f85 <code>signal()</code> \u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7ebf\u7a0b\uff08\u7c7b\u4f3c <code>notify()</code>\uff09 <code>signalAll()</code> \u5524\u9192\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\uff08\u7c7b\u4f3c <code>notifyAll()</code>\uff09 <p>\u6ce8\u610f</p> <p><code>await</code>\u524d\u9700\u8981\u83b7\u5f97\u9501\uff0c\u4e14<code>await</code>\u4f1a\u91ca\u653e\u9501</p> <pre><code>ReentrantLock lock = new ReentrantLock();\nCondition readCondition = lock.newCondition();\nCondition writeCondition = lock.newCondition();\n\nvolatile boolean canRead = true;\nvolatile boolean canWrite = false;\n\n// \u8bfb\u64cd\u4f5c\nlock.lock();\ntry {\n    while (!canRead) {\n        readCondition.await();\n    }\n    canRead = false;\n    // \u6267\u884c\u8bfb\u64cd\u4f5c\n    canWrite = true;\n    writeCondition.signalAll();  // \u5524\u9192\u6240\u6709\u5199\u7ebf\u7a0b\n} finally {\n    lock.unlock();\n}\n\n// \u5199\u64cd\u4f5c\nlock.lock();\ntry {\n    while (!canWrite) {\n        writeCondition.await();\n    }\n    canWrite = false;\n    // \u6267\u884c\u5199\u64cd\u4f5c\n    canRead = true;\n    readCondition.signalAll();  // \u5524\u9192\u6240\u6709\u8bfb\u7ebf\u7a0b\n} finally {\n    lock.unlock();\n}\n</code></pre> <p>\u4e0a\u4e00\u8282\uff1aJava\u7ebf\u7a0b</p> <p>\u4e0b\u4e00\u8282\uff1a\u5e76\u53d1\u7f16\u7a0b\u4e09\u8981\u7d20</p>"},{"location":"blog/archive/2025/12/","title":"2025\u5e7412\u6708","text":""},{"location":"blog/archive/2025/09/","title":"2025\u5e7409\u6708","text":""},{"location":"blog/category/backend/","title":"Backend","text":""},{"location":"blog/category/ai/","title":"AI","text":""},{"location":"blog/category/%E9%9A%8F%E7%AC%94/","title":"\u968f\u7b14","text":""}]}